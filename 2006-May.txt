From ximian at berlios.de  Tue May  2 12:11:26 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 2 May 2006 12:11:26 +0200
Subject: [ydf-devel] r1899 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax/js
Message-ID: <200605021011.k42ABQjJ017777@sheep.berlios.de>

Author: ximian
Date: 2006-05-02 12:11:15 +0200 (Tue, 02 May 2006)
New Revision: 1899

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/js/xajax.js
Log:
YDAjax by default, in the latest xajax release, used a 400ms delay to show the waiting message.
I really didn't like that because it shows an slow ajax processing to an common user (and it's not true).. so.. now we have 0ms ;)

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/js/xajax.js
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/js/xajax.js	2006-04-26 14:41:36 UTC (rev 1898)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/js/xajax.js	2006-05-02 10:11:15 UTC (rev 1899)
@@ -1 +1 @@
-function Xajax(){this.DebugMessage=function(text){try{if(this.debugWindow==undefined||this.debugWindow.closed==true){this.debugWindow=window.open('about:blank','xajax-debug','width=800,height=600,scrollbars=1,resizable,status');this.debugWindow.document.write('<html><head><title>Xajax debug output</title></head><body><h2>Xajax debug output</h2><div id="debugTag"></div></body></html>');}; text=text.replace(/&/g,"&amp;"); text=text.replace(/</g,"&lt;"); text=text.replace(/>/g,"&gt;"); debugTag=this.debugWindow.document.getElementById('debugTag');debugTag.innerHTML=('<b>'+(new Date()).toString()+'</b>: '+text+'<hr/>')+debugTag.innerHTML;}catch(e){alert("Xajax Debug:\n "+text);} };this.workId='xajaxWork'+new Date().getTime();this.depth=0;this.getRequestObject=function(){if(xajaxDebug)this.DebugMessage("Initializing Request Object..");var req=null;if(typeof XMLHttpRequest!="undefined") req=new XMLHttpRequest();if(!req&&typeof ActiveXObject!="undefined"){try{req=new ActiveXObject!
 ("Msxml2.XMLHTTP");} catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP");} catch(e2){try{req=new ActiveXObject("Msxml2.XMLHTTP.4.0");} catch(e3){req=null;} } } } if(!req&&window.createRequest) req=window.createRequest();if(!req)this.DebugMessage("Request Object Instantiation failed.");return req;}; this.$=function(sId){if(!sId){return null;} var returnObj=document.getElementById(sId);if(!returnObj&&document.all){returnObj=document.all[sId];} if(xajaxDebug&&!returnObj&&sId!=this.workId){this.DebugMessage("Element with the id \""+sId+"\" not found.");} return returnObj;}; this.include=function(sFileName){var objHead=document.getElementsByTagName('head');var objScript=document.createElement('script');objScript.type='text/javascript';objScript.src=sFileName;objHead[0].appendChild(objScript);}; this.stripOnPrefix=function(sEventName){sEventName=sEventName.toLowerCase();if(sEventName.indexOf('on')==0){sEventName=sEventName.replace(/on/,'');} return sEventName;}; this.addOnPre!
 fix=function(sEventName){sEventName=sEventName.toLowerCase();i!
 f(sEvent
Name.indexOf('on')!=0){sEventName='on'+sEventName;} return sEventName;}; this.addHandler=function(sElementId,sEvent,sFunctionName){if(window.addEventListener){sEvent=this.stripOnPrefix(sEvent);eval("this.$('"+sElementId+"').addEventListener('"+sEvent+"',"+sFunctionName+",false);");} else{sAltEvent=this.addOnPrefix(sEvent);eval("this.$('"+sElementId+"').attachEvent('"+sAltEvent+"',"+sFunctionName+",false);");} }; this.removeHandler=function(sElementId,sEvent,sFunctionName){if(window.addEventListener){sEvent=this.stripOnPrefix(sEvent);eval("this.$('"+sElementId+"').removeEventListener('"+sEvent+"',"+sFunctionName+",false);");} else{sAltEvent=this.addOnPrefix(sEvent);eval("this.$('"+sElementId+"').detachEvent('"+sAltEvent+"',"+sFunctionName+",false);");} }; this.create=function(sParentId,sTag,sId){var objParent=this.$(sParentId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);if(objParent) objParent.appendChild(objElement);}; this.insert=function(sBefo!
 reId,sTag,sId){var objSibling=this.$(sBeforeId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);objSibling.parentNode.insertBefore(objElement,objSibling);}; this.insertAfter=function(sAfterId,sTag,sId){var objSibling=this.$(sAfterId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);objSibling.parentNode.insertBefore(objElement,objSibling.nextSibling);}; this.getInput=function(sType,sName,sId){var Obj;if(sType=="radio"&&!window.addEventListener){Obj=document.createElement('<input type="radio" id="'+sId+'" name="'+sName+'">');} else{Obj=document.createElement('input');Obj.setAttribute('type',sType);Obj.setAttribute('name',sName);Obj.setAttribute('id',sId);} return Obj;}; this.createInput=function(sParentId,sType,sName,sId){var objParent=this.$(sParentId);var objElement=this.getInput(sType,sName,sId);if(objParent&&objElement) objParent.appendChild(objElement);}; this.insertInput=function(sBeforeId,sType,sName,sId){var objSibli!
 ng=this.$(sBeforeId);var objElement=this.getInput(sType,sName,!
 sId);if(
objElement&&objSibling&&objSibling.parentNode) objSibling.parentNode.insertBefore(objElement,objSibling);}; this.remove=function(sId){objElement=this.$(sId);if(objElement&&objElement.parentNode&&objElement.parentNode.removeChild){objElement.parentNode.removeChild(objElement);} }; this.replace=function(sId,sAttribute,sSearch,sReplace){var bFunction=false;if(sAttribute=="innerHTML") sSearch=this.getBrowserHTML(sSearch);eval("var txt=this.$('"+sId+"')."+sAttribute);if(typeof txt=="function"){txt=txt.toString();bFunction=true;} if(txt.indexOf(sSearch)>-1){var newTxt='';while(txt.indexOf(sSearch)>-1){x=txt.indexOf(sSearch)+sSearch.length+1;newTxt+=txt.substr(0,x).replace(sSearch,sReplace);txt=txt.substr(x,txt.length-x);} newTxt+=txt;if(bFunction){eval('this.$("'+sId+'").'+sAttribute+'=newTxt;');} else if(this.willChange(sId,sAttribute,newTxt)){eval('this.$("'+sId+'").'+sAttribute+'=newTxt;');} } }; this.getFormValues=function(frm){var objForm;var submitDisabledElements=false;if(a!
 rguments.length > 1&&arguments[1]==true) submitDisabledElements=true;var prefix="";if(arguments.length > 2) prefix=arguments[2];if(typeof(frm)=="string") objForm=this.$(frm);else objForm=frm;var sXml="<xjxquery><q>";if(objForm&&objForm.tagName=='FORM'){var formElements=objForm.elements;for(var i=0;i < formElements.length;i++){if(!formElements[i].name) continue;if(formElements[i].name.substring(0,prefix.length)!=prefix) continue;if(formElements[i].type&&(formElements[i].type=='radio'||formElements[i].type=='checkbox')&&formElements[i].checked==false) continue;if(formElements[i].disabled&&formElements[i].disabled==true&&submitDisabledElements==false) continue;var name=formElements[i].name;if(name){if(sXml!='<xjxquery><q>') sXml+='&';if(formElements[i].type=='select-multiple'){for(var j=0;j < formElements[i].length;j++){if(formElements[i].options[j].selected==true) sXml+=name+"="+encodeURIComponent(formElements[i].options[j].value)+"&";} } else{sXml+=name+"="+encodeURIComponen!
 t(formElements[i].value);} } } } sXml+="</q></xjxquery>";retur!
 n sXml;}
; this.objectToXML=function(obj){var sXml="<xjxobj>";for(i in obj){try{if(i=='constructor') continue;if(obj[i]&&typeof(obj[i])=='function') continue;var key=i;var value=obj[i];if(value&&typeof(value)=="object"&&this.depth <=50){this.depth++;value=this.objectToXML(value);this.depth--;} sXml+="<e><k>"+key+"</k><v>"+value+"</v></e>";}  catch(e){if(xajaxDebug)this.DebugMessage(e.name+": "+e.message);} } sXml+="</xjxobj>";return sXml;}; this.loadingFunction=function(){};this.doneLoadingFunction=function(){};var loadingTimeout;this.call=function(sFunction,aArgs,sRequestType){var i,r,postData;if(document.body&&xajaxWaitCursor) document.body.style.cursor='wait';if(xajaxStatusMessages==true)window.status='Sending Request...';clearTimeout(loadingTimeout);loadingTimeout=setTimeout("xajax.loadingFunction();",400);if(xajaxDebug)this.DebugMessage("Starting xajax...");if(sRequestType==null){var xajaxRequestType=xajaxDefinedPost;} else{var xajaxRequestType=sRequestType;} var uri=xajaxReques!
 tUri;var value;switch(xajaxRequestType){case xajaxDefinedGet:{var uriGet=uri.indexOf("?")==-1?"?xajax="+encodeURIComponent(sFunction):"&xajax="+encodeURIComponent(sFunction);if(aArgs){for(i=0;i<aArgs.length;i++){value=aArgs[i];if(typeof(value)=="object") value=this.objectToXML(value);uriGet+="&xajaxargs[]="+encodeURIComponent(value);} } uriGet+="&xajaxr="+new Date().getTime();uri+=uriGet;postData=null;}break;case xajaxDefinedPost:{postData="xajax="+encodeURIComponent(sFunction);postData+="&xajaxr="+new Date().getTime();if(aArgs){for(i=0;i <aArgs.length;i++){value=aArgs[i];if(typeof(value)=="object") value=this.objectToXML(value);postData=postData+"&xajaxargs[]="+encodeURIComponent(value);} } }break;default: alert("Illegal request type: "+xajaxRequestType);return false;break;} r=this.getRequestObject();if(!r)return false;r.open(xajaxRequestType==xajaxDefinedGet?"GET":"POST",uri,true);if(xajaxRequestType==xajaxDefinedPost){try{r.setRequestHeader("Method","POST "+uri+" HTTP/1.!
 1");r.setRequestHeader("Content-Type","application/x-www-form-!
 urlencod
ed");} catch(e){alert("Your browser does not appear to  support asynchronous requests using POST.");return false;} } r.onreadystatechange=function(){if(r.readyState!=4) return;if(r.status==200){if(xajaxDebug)xajax.DebugMessage("Received:\n"+r.responseText);if(r.responseXML&&r.responseXML.documentElement) xajax.processResponse(r.responseXML);else{var errorString="Error: the XML response that was returned from the server is invalid.";errorString+="\nReceived:\n"+r.responseText;trimmedResponseText=r.responseText.replace(/^\s+/g,"");trimmedResponseText=trimmedResponseText.replace(/\s+$/g,"");if(trimmedResponseText!=r.responseText) errorString+="\nYou have whitespace in your response.";alert(errorString);document.body.style.cursor='default';if(xajaxStatusMessages==true)window.status='Invalid XML response error';} } else{var errorString="Error: the server returned the following HTTP status: "+r.status;errorString+="\nReceived:\n"+r.responseText;alert(errorString);document.body.sty!
 le.cursor='default';if(xajaxStatusMessages==true)window.status='Invalid XML response error';} delete r;r=null;}; if(xajaxDebug)this.DebugMessage("Calling "+sFunction+" uri="+uri+" (post:"+postData+")");r.send(postData);if(xajaxStatusMessages==true)window.status='Waiting for data...';delete r;return true;}; this.getBrowserHTML=function(html){tmpXajax=this.$(this.workId);if(!tmpXajax){tmpXajax=document.createElement("div");tmpXajax.setAttribute('id',this.workId);tmpXajax.style.display="none";tmpXajax.style.visibility="hidden";document.body.appendChild(tmpXajax);} tmpXajax.innerHTML=html;var browserHTML=tmpXajax.innerHTML;tmpXajax.innerHTML='';return browserHTML;}; this.willChange=function(element,attribute,newData){if(!document.body){return true;}; if(attribute=="innerHTML"){newData=this.getBrowserHTML(newData);} elementObject=this.$(element);if(elementObject){var oldData;eval("oldData=this.$('"+element+"')."+attribute);if(newData!==oldData) return true;} return false;}; this!
 .viewSource=function(){return "<html>"+document.getElementsByT!
 agName("
HTML")[0].innerHTML+"</html>";}; this.processResponse=function(xml){clearTimeout(loadingTimeout);this.doneLoadingFunction();if(xajaxStatusMessages==true)window.status='Processing...';var tmpXajax=null;xml=xml.documentElement;if(xml==null) return;for(var i=0;i<xml.childNodes.length;i++){if(xml.childNodes[i].nodeName=="cmd"){var cmd;var id;var property;var data;var search;var type;var before;for(var j=0;j<xml.childNodes[i].attributes.length;j++){if(xml.childNodes[i].attributes[j].name=="n"){cmd=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="t"){id=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="p"){property=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="c"){type=xml.childNodes[i].attributes[j].value;} } if(xml.childNodes[i].childNodes.length > 1&&xml.childNodes[i].firstChild.nodeName=="#cdata-section"){data="";for(var j=0;j<xml.childNodes[i].childNodes.length;!
 j++){data+=xml.childNodes[i].childNodes[j].data;} } else if(xml.childNodes[i].childNodes.length > 1){for(var j=0;j<xml.childNodes[i].childNodes.length;j++){if(xml.childNodes[i].childNodes[j].childNodes.length > 1&&xml.childNodes[i].childNodes[j].firstChild.nodeName=="#cdata-section"){var internalData="";for(var k=0;k<xml.childNodes[i].childNodes[j].childNodes.length;k++){internalData+=xml.childNodes[i].childNodes[j].childNodes[k].nodeValue;} }else{var internalData=xml.childNodes[i].childNodes[j].firstChild.nodeValue;} if(xml.childNodes[i].childNodes[j].nodeName=="s"){search=internalData;} if(xml.childNodes[i].childNodes[j].nodeName=="r"){data=internalData;} } } else if(xml.childNodes[i].firstChild) data=xml.childNodes[i].firstChild.nodeValue;else data="";var objElement=this.$(id);var cmdFullname;try{if(cmd=="al"){cmdFullname="addAlert";alert(data);} else if(cmd=="js"){cmdFullname="addScript/addRedirect";eval(data);} else if(cmd=="in"){cmdFullname="addIncludeScript";this.inc!
 lude(data);} else if(cmd=="as"){cmdFullname="addAssign/addClea!
 r";if(th
is.willChange(id,property,data)){eval("objElement."+property+"=data;");} } else if(cmd=="ap"){cmdFullname="addAppend";eval("objElement."+property+"+=data;");} else if(cmd=="pp"){cmdFullname="addPrepend";eval("objElement."+property+"=data+objElement."+property);} else if(cmd=="rp"){cmdFullname="addReplace";this.replace(id,property,search,data) } else if(cmd=="rm"){cmdFullname="addRemove";this.remove(id);} else if(cmd=="ce"){cmdFullname="addCreate";this.create(id,data,property);} else if(cmd=="ie"){cmdFullname="addInsert";this.insert(id,data,property);} else if(cmd=="ia"){cmdFullname="addInsertAfter";this.insertAfter(id,data,property);} else if(cmd=="ci"){cmdFullname="addCreateInput";this.createInput(id,type,data,property);} else if(cmd=="ii"){cmdFullname="addInsertInput";this.insertInput(id,type,data,property);} else if(cmd=="ev"){cmdFullname="addEvent";property=this.addOnPrefix(property);eval("this.$('"+id+"')."+property+"= function(){"+data+";}");} else if(cmd=="ah"){cmdFul!
 lname="addHandler";this.addHandler(id,property,data);} else if(cmd=="rh"){cmdFullname="addRemoveHandler";this.removeHandler(id,property,data);} } catch(e){if(xajaxDebug) alert("While trying to '"+cmdFullname+"' (command number "+i+"), the following error occured:\n" +e.name+": "+e.message+"\n" +(id&&!objElement?"Object with id='"+id+"' wasn't found.\n":""));} delete objElement;delete cmd;delete cmdFullname;delete id;delete property;delete search;delete data;delete type;delete before;delete internalData;delete j;delete k;} } delete xml;delete i;document.body.style.cursor='default';if(xajaxStatusMessages==true)window.status='Done';} } var xajax=new Xajax();xajaxLoaded=true;
\ No newline at end of file
+function Xajax(){this.DebugMessage=function(text){try{if(this.debugWindow==undefined||this.debugWindow.closed==true){this.debugWindow=window.open('about:blank','xajax-debug','width=800,height=600,scrollbars=1,resizable,status');this.debugWindow.document.write('<html><head><title>Xajax debug output</title></head><body><h2>Xajax debug output</h2><div id="debugTag"></div></body></html>');}; text=text.replace(/&/g,"&amp;"); text=text.replace(/</g,"&lt;"); text=text.replace(/>/g,"&gt;"); debugTag=this.debugWindow.document.getElementById('debugTag');debugTag.innerHTML=('<b>'+(new Date()).toString()+'</b>: '+text+'<hr/>')+debugTag.innerHTML;}catch(e){alert("Xajax Debug:\n "+text);} };this.workId='xajaxWork'+new Date().getTime();this.depth=0;this.getRequestObject=function(){if(xajaxDebug)this.DebugMessage("Initializing Request Object..");var req=null;if(typeof XMLHttpRequest!="undefined") req=new XMLHttpRequest();if(!req&&typeof ActiveXObject!="undefined"){try{req=new ActiveXObject!
 ("Msxml2.XMLHTTP");} catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP");} catch(e2){try{req=new ActiveXObject("Msxml2.XMLHTTP.4.0");} catch(e3){req=null;} } } } if(!req&&window.createRequest) req=window.createRequest();if(!req)this.DebugMessage("Request Object Instantiation failed.");return req;}; this.$=function(sId){if(!sId){return null;} var returnObj=document.getElementById(sId);if(!returnObj&&document.all){returnObj=document.all[sId];} if(xajaxDebug&&!returnObj&&sId!=this.workId){this.DebugMessage("Element with the id \""+sId+"\" not found.");} return returnObj;}; this.include=function(sFileName){var objHead=document.getElementsByTagName('head');var objScript=document.createElement('script');objScript.type='text/javascript';objScript.src=sFileName;objHead[0].appendChild(objScript);}; this.stripOnPrefix=function(sEventName){sEventName=sEventName.toLowerCase();if(sEventName.indexOf('on')==0){sEventName=sEventName.replace(/on/,'');} return sEventName;}; this.addOnPre!
 fix=function(sEventName){sEventName=sEventName.toLowerCase();i!
 f(sEvent
Name.indexOf('on')!=0){sEventName='on'+sEventName;} return sEventName;}; this.addHandler=function(sElementId,sEvent,sFunctionName){if(window.addEventListener){sEvent=this.stripOnPrefix(sEvent);eval("this.$('"+sElementId+"').addEventListener('"+sEvent+"',"+sFunctionName+",false);");} else{sAltEvent=this.addOnPrefix(sEvent);eval("this.$('"+sElementId+"').attachEvent('"+sAltEvent+"',"+sFunctionName+",false);");} }; this.removeHandler=function(sElementId,sEvent,sFunctionName){if(window.addEventListener){sEvent=this.stripOnPrefix(sEvent);eval("this.$('"+sElementId+"').removeEventListener('"+sEvent+"',"+sFunctionName+",false);");} else{sAltEvent=this.addOnPrefix(sEvent);eval("this.$('"+sElementId+"').detachEvent('"+sAltEvent+"',"+sFunctionName+",false);");} }; this.create=function(sParentId,sTag,sId){var objParent=this.$(sParentId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);if(objParent) objParent.appendChild(objElement);}; this.insert=function(sBefo!
 reId,sTag,sId){var objSibling=this.$(sBeforeId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);objSibling.parentNode.insertBefore(objElement,objSibling);}; this.insertAfter=function(sAfterId,sTag,sId){var objSibling=this.$(sAfterId);objElement=document.createElement(sTag);objElement.setAttribute('id',sId);objSibling.parentNode.insertBefore(objElement,objSibling.nextSibling);}; this.getInput=function(sType,sName,sId){var Obj;if(sType=="radio"&&!window.addEventListener){Obj=document.createElement('<input type="radio" id="'+sId+'" name="'+sName+'">');} else{Obj=document.createElement('input');Obj.setAttribute('type',sType);Obj.setAttribute('name',sName);Obj.setAttribute('id',sId);} return Obj;}; this.createInput=function(sParentId,sType,sName,sId){var objParent=this.$(sParentId);var objElement=this.getInput(sType,sName,sId);if(objParent&&objElement) objParent.appendChild(objElement);}; this.insertInput=function(sBeforeId,sType,sName,sId){var objSibli!
 ng=this.$(sBeforeId);var objElement=this.getInput(sType,sName,!
 sId);if(
objElement&&objSibling&&objSibling.parentNode) objSibling.parentNode.insertBefore(objElement,objSibling);}; this.remove=function(sId){objElement=this.$(sId);if(objElement&&objElement.parentNode&&objElement.parentNode.removeChild){objElement.parentNode.removeChild(objElement);} }; this.replace=function(sId,sAttribute,sSearch,sReplace){var bFunction=false;if(sAttribute=="innerHTML") sSearch=this.getBrowserHTML(sSearch);eval("var txt=this.$('"+sId+"')."+sAttribute);if(typeof txt=="function"){txt=txt.toString();bFunction=true;} if(txt.indexOf(sSearch)>-1){var newTxt='';while(txt.indexOf(sSearch)>-1){x=txt.indexOf(sSearch)+sSearch.length+1;newTxt+=txt.substr(0,x).replace(sSearch,sReplace);txt=txt.substr(x,txt.length-x);} newTxt+=txt;if(bFunction){eval('this.$("'+sId+'").'+sAttribute+'=newTxt;');} else if(this.willChange(sId,sAttribute,newTxt)){eval('this.$("'+sId+'").'+sAttribute+'=newTxt;');} } }; this.getFormValues=function(frm){var objForm;var submitDisabledElements=false;if(a!
 rguments.length > 1&&arguments[1]==true) submitDisabledElements=true;var prefix="";if(arguments.length > 2) prefix=arguments[2];if(typeof(frm)=="string") objForm=this.$(frm);else objForm=frm;var sXml="<xjxquery><q>";if(objForm&&objForm.tagName=='FORM'){var formElements=objForm.elements;for(var i=0;i < formElements.length;i++){if(!formElements[i].name) continue;if(formElements[i].name.substring(0,prefix.length)!=prefix) continue;if(formElements[i].type&&(formElements[i].type=='radio'||formElements[i].type=='checkbox')&&formElements[i].checked==false) continue;if(formElements[i].disabled&&formElements[i].disabled==true&&submitDisabledElements==false) continue;var name=formElements[i].name;if(name){if(sXml!='<xjxquery><q>') sXml+='&';if(formElements[i].type=='select-multiple'){for(var j=0;j < formElements[i].length;j++){if(formElements[i].options[j].selected==true) sXml+=name+"="+encodeURIComponent(formElements[i].options[j].value)+"&";} } else{sXml+=name+"="+encodeURIComponen!
 t(formElements[i].value);} } } } sXml+="</q></xjxquery>";retur!
 n sXml;}
; this.objectToXML=function(obj){var sXml="<xjxobj>";for(i in obj){try{if(i=='constructor') continue;if(obj[i]&&typeof(obj[i])=='function') continue;var key=i;var value=obj[i];if(value&&typeof(value)=="object"&&this.depth <=50){this.depth++;value=this.objectToXML(value);this.depth--;} sXml+="<e><k>"+key+"</k><v>"+value+"</v></e>";}  catch(e){if(xajaxDebug)this.DebugMessage(e.name+": "+e.message);} } sXml+="</xjxobj>";return sXml;}; this.loadingFunction=function(){};this.doneLoadingFunction=function(){};var loadingTimeout;this.call=function(sFunction,aArgs,sRequestType){var i,r,postData;if(document.body&&xajaxWaitCursor) document.body.style.cursor='wait';if(xajaxStatusMessages==true)window.status='Sending Request...';clearTimeout(loadingTimeout);loadingTimeout=setTimeout("xajax.loadingFunction();",0);if(xajaxDebug)this.DebugMessage("Starting xajax...");if(sRequestType==null){var xajaxRequestType=xajaxDefinedPost;} else{var xajaxRequestType=sRequestType;} var uri=xajaxRequestU!
 ri;var value;switch(xajaxRequestType){case xajaxDefinedGet:{var uriGet=uri.indexOf("?")==-1?"?xajax="+encodeURIComponent(sFunction):"&xajax="+encodeURIComponent(sFunction);if(aArgs){for(i=0;i<aArgs.length;i++){value=aArgs[i];if(typeof(value)=="object") value=this.objectToXML(value);uriGet+="&xajaxargs[]="+encodeURIComponent(value);} } uriGet+="&xajaxr="+new Date().getTime();uri+=uriGet;postData=null;}break;case xajaxDefinedPost:{postData="xajax="+encodeURIComponent(sFunction);postData+="&xajaxr="+new Date().getTime();if(aArgs){for(i=0;i <aArgs.length;i++){value=aArgs[i];if(typeof(value)=="object") value=this.objectToXML(value);postData=postData+"&xajaxargs[]="+encodeURIComponent(value);} } }break;default: alert("Illegal request type: "+xajaxRequestType);return false;break;} r=this.getRequestObject();if(!r)return false;r.open(xajaxRequestType==xajaxDefinedGet?"GET":"POST",uri,true);if(xajaxRequestType==xajaxDefinedPost){try{r.setRequestHeader("Method","POST "+uri+" HTTP/1.1"!
 );r.setRequestHeader("Content-Type","application/x-www-form-ur!
 lencoded
");} catch(e){alert("Your browser does not appear to  support asynchronous requests using POST.");return false;} } r.onreadystatechange=function(){if(r.readyState!=4) return;if(r.status==200){if(xajaxDebug)xajax.DebugMessage("Received:\n"+r.responseText);if(r.responseXML&&r.responseXML.documentElement) xajax.processResponse(r.responseXML);else{var errorString="Error: the XML response that was returned from the server is invalid.";errorString+="\nReceived:\n"+r.responseText;trimmedResponseText=r.responseText.replace(/^\s+/g,"");trimmedResponseText=trimmedResponseText.replace(/\s+$/g,"");if(trimmedResponseText!=r.responseText) errorString+="\nYou have whitespace in your response.";alert(errorString);document.body.style.cursor='default';if(xajaxStatusMessages==true)window.status='Invalid XML response error';} } else{var errorString="Error: the server returned the following HTTP status: "+r.status;errorString+="\nReceived:\n"+r.responseText;alert(errorString);document.body.style!
 .cursor='default';if(xajaxStatusMessages==true)window.status='Invalid XML response error';} delete r;r=null;}; if(xajaxDebug)this.DebugMessage("Calling "+sFunction+" uri="+uri+" (post:"+postData+")");r.send(postData);if(xajaxStatusMessages==true)window.status='Waiting for data...';delete r;return true;}; this.getBrowserHTML=function(html){tmpXajax=this.$(this.workId);if(!tmpXajax){tmpXajax=document.createElement("div");tmpXajax.setAttribute('id',this.workId);tmpXajax.style.display="none";tmpXajax.style.visibility="hidden";document.body.appendChild(tmpXajax);} tmpXajax.innerHTML=html;var browserHTML=tmpXajax.innerHTML;tmpXajax.innerHTML='';return browserHTML;}; this.willChange=function(element,attribute,newData){if(!document.body){return true;}; if(attribute=="innerHTML"){newData=this.getBrowserHTML(newData);} elementObject=this.$(element);if(elementObject){var oldData;eval("oldData=this.$('"+element+"')."+attribute);if(newData!==oldData) return true;} return false;}; this.v!
 iewSource=function(){return "<html>"+document.getElementsByTag!
 Name("HT
ML")[0].innerHTML+"</html>";}; this.processResponse=function(xml){clearTimeout(loadingTimeout);this.doneLoadingFunction();if(xajaxStatusMessages==true)window.status='Processing...';var tmpXajax=null;xml=xml.documentElement;if(xml==null) return;for(var i=0;i<xml.childNodes.length;i++){if(xml.childNodes[i].nodeName=="cmd"){var cmd;var id;var property;var data;var search;var type;var before;for(var j=0;j<xml.childNodes[i].attributes.length;j++){if(xml.childNodes[i].attributes[j].name=="n"){cmd=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="t"){id=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="p"){property=xml.childNodes[i].attributes[j].value;} else if(xml.childNodes[i].attributes[j].name=="c"){type=xml.childNodes[i].attributes[j].value;} } if(xml.childNodes[i].childNodes.length > 1&&xml.childNodes[i].firstChild.nodeName=="#cdata-section"){data="";for(var j=0;j<xml.childNodes[i].childNodes.length;j+!
 +){data+=xml.childNodes[i].childNodes[j].data;} } else if(xml.childNodes[i].childNodes.length > 1){for(var j=0;j<xml.childNodes[i].childNodes.length;j++){if(xml.childNodes[i].childNodes[j].childNodes.length > 1&&xml.childNodes[i].childNodes[j].firstChild.nodeName=="#cdata-section"){var internalData="";for(var k=0;k<xml.childNodes[i].childNodes[j].childNodes.length;k++){internalData+=xml.childNodes[i].childNodes[j].childNodes[k].nodeValue;} }else{var internalData=xml.childNodes[i].childNodes[j].firstChild.nodeValue;} if(xml.childNodes[i].childNodes[j].nodeName=="s"){search=internalData;} if(xml.childNodes[i].childNodes[j].nodeName=="r"){data=internalData;} } } else if(xml.childNodes[i].firstChild) data=xml.childNodes[i].firstChild.nodeValue;else data="";var objElement=this.$(id);var cmdFullname;try{if(cmd=="al"){cmdFullname="addAlert";alert(data);} else if(cmd=="js"){cmdFullname="addScript/addRedirect";eval(data);} else if(cmd=="in"){cmdFullname="addIncludeScript";this.inclu!
 de(data);} else if(cmd=="as"){cmdFullname="addAssign/addClear"!
 ;if(this
.willChange(id,property,data)){eval("objElement."+property+"=data;");} } else if(cmd=="ap"){cmdFullname="addAppend";eval("objElement."+property+"+=data;");} else if(cmd=="pp"){cmdFullname="addPrepend";eval("objElement."+property+"=data+objElement."+property);} else if(cmd=="rp"){cmdFullname="addReplace";this.replace(id,property,search,data) } else if(cmd=="rm"){cmdFullname="addRemove";this.remove(id);} else if(cmd=="ce"){cmdFullname="addCreate";this.create(id,data,property);} else if(cmd=="ie"){cmdFullname="addInsert";this.insert(id,data,property);} else if(cmd=="ia"){cmdFullname="addInsertAfter";this.insertAfter(id,data,property);} else if(cmd=="ci"){cmdFullname="addCreateInput";this.createInput(id,type,data,property);} else if(cmd=="ii"){cmdFullname="addInsertInput";this.insertInput(id,type,data,property);} else if(cmd=="ev"){cmdFullname="addEvent";property=this.addOnPrefix(property);eval("this.$('"+id+"')."+property+"= function(){"+data+";}");} else if(cmd=="ah"){cmdFulln!
 ame="addHandler";this.addHandler(id,property,data);} else if(cmd=="rh"){cmdFullname="addRemoveHandler";this.removeHandler(id,property,data);} } catch(e){if(xajaxDebug) alert("While trying to '"+cmdFullname+"' (command number "+i+"), the following error occured:\n" +e.name+": "+e.message+"\n" +(id&&!objElement?"Object with id='"+id+"' wasn't found.\n":""));} delete objElement;delete cmd;delete cmdFullname;delete id;delete property;delete search;delete data;delete type;delete before;delete internalData;delete j;delete k;} } delete xml;delete i;document.body.style.cursor='default';if(xajaxStatusMessages==true)window.status='Done';} } var xajax=new Xajax();xajaxLoaded=true;
\ No newline at end of file



From ximian at berlios.de  Tue May  2 12:12:48 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 2 May 2006 12:12:48 +0200
Subject: [ydf-devel] r1900 - YDFramework2.0/trunk/YDFramework2/addons/YDCMPage
Message-ID: <200605021012.k42ACm7N017918@sheep.berlios.de>

Author: ximian
Date: 2006-05-02 12:12:37 +0200 (Tue, 02 May 2006)
New Revision: 1900

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
Log:
return content id (instead of just true/false) when updating/adding a new page

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-02 10:11:15 UTC (rev 1899)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-02 10:12:37 UTC (rev 1900)
@@ -123,7 +123,7 @@
          *
          *  @param $formvalues  Array with page attributes from the standard form
          *
-         *  @returns    true if updated, array with form errors otherwise
+         *  @returns    content_id updated or new content_id
          */
 		function savePageForm( $formvalues = array() ){
 
@@ -175,7 +175,9 @@
 			
 			$this->setValues( $page );
 
-			return $this->insert();
+			$this->insert();
+			
+			return $id;
 		}
 
 



From ximian at berlios.de  Tue May  2 12:15:00 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 2 May 2006 12:15:00 +0200
Subject: [ydf-devel] r1901 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605021015.k42AF0v5018021@sheep.berlios.de>

Author: ximian
Date: 2006-05-02 12:14:50 +0200 (Tue, 02 May 2006)
New Revision: 1901

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
added array comparation in YDStringUtil::formatDate. useful for date form elements

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-02 10:12:37 UTC (rev 1900)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-02 10:14:50 UTC (rev 1901)
@@ -531,6 +531,11 @@
                 $timestamp = strtotime( $timestamp );
             }
 
+            // If array, is a date YDForm element value
+            if ( is_array( $timestamp ) ) {
+                $timestamp = $timestamp[ 'timestamp' ];
+            }
+
             // Check the standard formats
             if ( strtolower( $format ) == 'date' ) {
                 $format = '%d %B %Y';



From ximian at berlios.de  Tue May  2 13:04:43 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 2 May 2006 13:04:43 +0200
Subject: [ydf-devel] r1902 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605021104.k42B4hPk008516@sheep.berlios.de>

Author: ximian
Date: 2006-05-02 13:01:10 +0200 (Tue, 02 May 2006)
New Revision: 1902

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
fixed: YDDatabaseTree::updateNode was not creating the correct sql query

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-05-02 10:14:50 UTC (rev 1901)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-05-02 11:01:10 UTC (rev 1902)
@@ -744,7 +744,7 @@
 
             // Perform the insert
             $this->db->executeUpdate(
-                $this->table, $values, sprintf( '%s = %', $idField, $this->db->escapeSql( $id ) )
+                $this->table, $values, sprintf( '%s = %s', $idField, $this->db->escapeSql( $id ) )
             );
 
             // Rebuild the tree



From pclaerhout at berlios.de  Tue May  2 17:02:37 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 2 May 2006 17:02:37 +0200
Subject: [ydf-devel] r1903 - in YDFramework2.0/trunk/examples/weblog: manage skins/default
Message-ID: <200605021502.k42F2bF5026548@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-02 17:01:44 +0200 (Tue, 02 May 2006)
New Revision: 1903

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
Log:
Fixed the link in the new item emails.

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-05-02 11:01:10 UTC (rev 1902)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-05-02 15:01:44 UTC (rev 1903)
@@ -134,6 +134,7 @@
                         // Add the comment to the email template
                         $this->tpl->assign( 'item', $values );
                         $this->tpl->assign( 'weblog_link', YDUrl::makeLinkAbsolute( '../index.php' ) );
+                        $this->tpl->assign( 'item_link', YDTplModLinkWithID( '../item.php', $values['id'] ) );
 
                         // Create the email and send it
                         $eml = new YDEmail();

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-05-02 11:01:10 UTC (rev 1902)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-05-02 15:01:44 UTC (rev 1903)
@@ -32,7 +32,7 @@
 
             <p>
                 <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>
-                <b>{t w="item_title"}</b>: <a href="{$item|@link_item}">{$item.title}</a><br/>
+                <b>{t w="item_title"}</b>: <a href="{$item_link}">{$item.title}</a><br/>
             </p>
 
             <blockquote>



From ximian at berlios.de  Tue May  2 18:44:53 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 2 May 2006 18:44:53 +0200
Subject: [ydf-devel] r1904 - YDFramework2.0/trunk/YDFramework2/addons/YDCMPage
Message-ID: <200605021644.k42GirVK010493@sheep.berlios.de>

Author: ximian
Date: 2006-05-02 18:43:51 +0200 (Tue, 02 May 2006)
New Revision: 1904

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
Log:
- new method YDCMPage::deleteElement to delete a page
- parse html and xhtml content
- fix html and xhtml array keys

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-02 15:01:44 UTC (rev 1903)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-02 16:43:51 UTC (rev 1904)
@@ -90,7 +90,7 @@
 	        $form->addElement( 'textarea',       'html',                 t('page_html') );
 	        $form->addElement( 'textarea',       'xhtml',                t('page_xhtml') );
 	        $form->addElement( 'select',         'access',               t('page_access'),         array(), $access);
-	        $form->addElement( 'select',         'state',                t('page_state'),      array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+	        $form->addElement( 'select',         'state',                t('page_state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
 	        $form->addElement( 'datetimeselect', 'published_date_start', t('page_startdate') );
 	        $form->addElement( 'datetimeselect', 'published_date_end',   t('page_enddate'));
 	        $form->addElement( 'select',         'template_pack',        '',                       array(), $template_pack );
@@ -159,8 +159,8 @@
 			$page[ 'content_id' ]    = $id;
 			$page[ 'language_id' ]   = $form->getValue( 'language_id' );
 			$page[ 'title' ]         = $form->getValue( 'title' );
-			$page[ 'hmtl' ]          = $form->getValue( 'html' );
-			$page[ 'xhmtl' ]         = $form->getValue( 'xhtml' );
+			$page[ 'html' ]          = $form->getValue( 'html' );
+			$page[ 'xhtml' ]         = $form->getValue( 'xhtml' );
 			$page[ 'template_pack' ] = $form->getValue( 'template_pack' );
 			$page[ 'template' ]      = $form->getValue( 'template' );
 			$page[ 'metatags' ]      = $form->getValue( 'metatags' );
@@ -202,10 +202,33 @@
 			
 			// find node
 			$this->findAll();
+			
+			// parse html
+			if ( isset( $this->html ) )  $this->html  = htmlentities( $this->html );
+			if ( isset( $this->xhtml ) ) $this->xhtml = htmlentities( $this->xhtml );
 
 			// return node attributes without relation prefixs
 			return $this->getValues( false, false, false, false );
 		}
 
+
+        /**
+         *  This function will delete a page node (and not its children)
+         *
+         *  @param $id  Node id
+         */
+		function deleteElement( $id ){
+
+			// delete all element from this node
+			$this->resetValues();
+
+			$this->content_id = intval( $id );
+		
+			$this->delete();
+			
+			// delete node from tree
+			$this->deleteNode( $id );
+		}
+
     }
 ?>
\ No newline at end of file



From ximian at berlios.de  Wed May  3 16:34:15 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Wed, 3 May 2006 16:34:15 +0200
Subject: [ydf-devel] r1905 - YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200605031434.k43EYFEg023240@sheep.berlios.de>

Author: ximian
Date: 2006-05-03 16:33:39 +0200 (Wed, 03 May 2006)
New Revision: 1905

Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner.png
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
- updated db scheme
- deleted the png file (it can be exported with DBDesigner4 anyway)

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner.png
===================================================================
(Binary files differ)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-02 16:43:51 UTC (rev 1904)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-03 14:33:39 UTC (rev 1905)
@@ -474,16 +474,12 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1206" ColName="published_date_start" PrevColName="date_start" Pos="16" idDatatype="5" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
+<COLUMN ID="1206" ColName="published_date_start" PrevColName="date_start" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1207" ColName="published_date_end" PrevColName="date_end" Pos="17" idDatatype="5" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
+<COLUMN ID="1207" ColName="published_date_end" PrevColName="date_end" Pos="17" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
 </COLUMNS>



From ximian at berlios.de  Wed May  3 16:36:04 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Wed, 3 May 2006 16:36:04 +0200
Subject: [ydf-devel] r1906 - in YDFramework2.0/trunk/YDFramework2/addons: YDCMLanguages/languages YDCMPage/languages
Message-ID: <200605031436.k43Ea4CT025098@sheep.berlios.de>

Author: ximian
Date: 2006-05-03 16:35:05 +0200 (Wed, 03 May 2006)
New Revision: 1906

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php
Log:
moved some translations from page specific to generic

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php	2006-05-03 14:33:39 UTC (rev 1905)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php	2006-05-03 14:35:05 UTC (rev 1906)
@@ -14,4 +14,6 @@
 $GLOBALS['t']['public'] = 'Public';
 $GLOBALS['t']['private'] = 'Private';
 
+$GLOBALS['t']['add page'] = 'Add page';
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php	2006-05-03 14:33:39 UTC (rev 1905)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php	2006-05-03 14:35:05 UTC (rev 1906)
@@ -14,4 +14,6 @@
 $GLOBALS['t']['public'] = 'P&uacute;blico';
 $GLOBALS['t']['private'] = 'Privado';
 
+$GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php	2006-05-03 14:33:39 UTC (rev 1905)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php	2006-05-03 14:35:05 UTC (rev 1906)
@@ -24,7 +24,6 @@
 $GLOBALS['t']['page access'] = 'Access';
 $GLOBALS['t']['new page'] = 'New page';
 $GLOBALS['t']['edit page'] = 'Edit page';
-$GLOBALS['t']['add page'] = 'Add page';
 $GLOBALS['t']['use custom template'] = 'Use custom template';
 $GLOBALS['t']['use templatepack'] = 'Use template pack';
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php	2006-05-03 14:33:39 UTC (rev 1905)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php	2006-05-03 14:35:05 UTC (rev 1906)
@@ -24,7 +24,6 @@
 $GLOBALS['t']['page access'] = 'Acesso';
 $GLOBALS['t']['new page'] = 'Nova p&aacute;gina';
 $GLOBALS['t']['edit page'] = 'Editar p&aacute;gina';
-$GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
 $GLOBALS['t']['use custom template'] = 'Usar template especial';
 $GLOBALS['t']['use templatepack'] = 'Usar template pack';
 



From ximian at berlios.de  Wed May  3 16:39:30 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Wed, 3 May 2006 16:39:30 +0200
Subject: [ydf-devel] r1907 - in YDFramework2.0/trunk/YDFramework2/addons: . YDCMHelpdesk
Message-ID: <200605031439.k43EdUjK028697@sheep.berlios.de>

Author: ximian
Date: 2006-05-03 16:38:25 +0200 (Wed, 03 May 2006)
New Revision: 1907

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
Log:
added a new YDCM component draft: YDCMHelpdesk, a very simple helpdesk management

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-03 14:35:05 UTC (rev 1906)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-03 14:38:25 UTC (rev 1907)
@@ -0,0 +1,234 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMHelpdesk extends YDCMComponent {
+    
+        function YDCMHelpdesk() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk' );
+
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '0.1';
+            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
+            $this->_description = 'This is a simple helpdesk component';
+
+			// register custom fields
+			$this->registerField( 'title' );
+						
+			// custom relation
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'component_id' );
+            $rel->setForeignKey( 'component_id' );
+			$rel->setForeignJoin( 'LEFT' );
+		}
+
+
+        /**
+         *  This function creates a new helpdesk
+         *
+         *  @param $title  Helpdesk title
+         *  @param $language_id  (Optional) Language code of the heldesk
+         *  @param $reference  (Optional) Node reference
+         *  @param $parent_id  (Optional) Id of the parent help desk
+         */
+		function create( $title, $language_id = 'all', $reference = '', $parent_id = 0 ){
+		
+			// add node to content tree
+			$node = array();
+			$node[ 'type' ]        = 'YDCMHelpdesk';
+			$node[ 'reference' ]   = $reference;
+			$node[ 'state' ]       = 1;
+			$node[ 'access' ]      = 1;
+			$node[ 'searcheable' ] = 0;
+
+			// add tree node
+			// TODO: check if parent_id exist
+			$id = $this->addNode( $node, intval( $parent_id ) );
+		
+			// add a standard title
+			return $this->addTitle( $id, $title, $language_id );
+		}
+
+		
+		function addTitle( $id, $title, $language_id ){
+		
+			// reset values
+			$this->resetValues();
+
+			// add a default helpdesk title
+			// TODO: check if language code exist
+			$this->content_id  = $id;
+			$this->title       = $title;
+			$this->language_id = $language_id;
+
+			// insert values
+			return $this->insert();
+		}
+
+		
+    }
+
+
+
+    class YDCMHelpdesk_posts extends YDCMComponent {
+    
+        function YDCMHelpdesk_posts() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk_posts', false );
+
+			// register Key
+			$this->registerKey( 'post_id', true );
+
+			// register custom fields
+			$this->registerField( 'component_id' );
+			$this->registerField( 'user_id' );
+			$this->registerField( 'subject' );
+			$this->registerField( 'localization' );
+			$this->registerField( 'urgency_id' );
+			$this->registerField( 'state_id' );
+			$this->registerField( 'text' );
+			$this->registerField( 'created_in' );
+			$this->registerField( 'reported_in' );
+			$this->registerField( 'reported_by' );
+			$this->registerField( 'reported_to_in' );
+			$this->registerField( 'reported_to' );
+			$this->registerField( 'reported_to_local' );
+
+			// custom relation
+            $rel = & $this->registerRelation( 'YDCMHelpdesk', false, 'YDCMHelpdesk' );
+			$rel->setLocalKey( 'component_id' );
+            $rel->setForeignKey( 'component_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+
+            $relResponse = & $this->registerRelation( 'YDCMHelpdesk_response', false, 'YDCMHelpdesk_response' );
+			$relResponse->setLocalKey( 'post_id' );
+            $relResponse->setForeignKey( 'post_id' );
+			$relResponse->setForeignJoin( 'LEFT' );
+
+            $relUrgency = & $this->registerRelation( 'YDCMHelpdesk_urgency', false, 'YDCMHelpdesk_urgency' );
+			$relUrgency->setLocalKey( 'urgency_id' );
+            $relUrgency->setForeignKey( 'urgency_id' );
+
+            $relState = & $this->registerRelation( 'YDCMHelpdesk_state', false, 'YDCMHelpdesk_state' );
+			$relState->setLocalKey( 'state_id' );
+            $relState->setForeignKey( 'state_id' );
+		}
+
+	}
+
+
+
+    class YDCMHelpdesk_response extends YDCMComponent {
+    
+        function YDCMHelpdesk_response() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk_response', false );
+
+			// register Key
+			$this->registerKey( 'response_id', true );
+
+			// register custom fields
+			$this->registerField( 'post_id' );
+			$this->registerField( 'user_id' );
+			$this->registerField( 'date' );
+			$this->registerField( 'description' );
+
+			// custom relations
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'post_id' );
+            $rel->setForeignKey( 'post_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+	}	
+
+
+
+    class YDCMHelpdesk_urgency extends YDCMComponent {
+    
+        function YDCMHelpdesk_urgency() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk_urgency', false );
+
+			// register Key
+			$this->registerKey( 'urgency_id', true );
+
+			// register custom fields
+			$this->registerField( 'description' );
+			$this->registerField( 'color' );
+						
+			// custom relations
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'urgency_id' );
+            $rel->setForeignKey( 'urgency_id' );
+			$rel->setForeignJoin( 'LEFT' );
+		}
+
+	}	
+
+
+
+
+    class YDCMHelpdesk_state extends YDCMComponent {
+    
+        function YDCMHelpdesk_state() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk_state', false );
+
+			// register Key
+			$this->registerKey( 'state_id', true );
+
+			// register custom fields
+			$this->registerField( 'description' );
+						
+			// custom relations
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'state_id' );
+            $rel->setForeignKey( 'state_id' );
+			$rel->setForeignJoin( 'LEFT' );
+		}
+
+	}	
+
+
+
+
+
+
+?>
\ No newline at end of file



From pieter at yellowduck.be  Wed May  3 17:43:17 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 3 May 2006 17:43:17 +0200
Subject: [ydf-devel] YDCM feedback
In-Reply-To: <4450E8BE.40003@fusemail.com>
References: <444518AC.1080102@fusemail.com>
	 <4aef63030604252350y7ed6f36bqbaeb34bdc879f4c@mail.gmail.com>
	 <4aef63030604260346w41b35917i7419bb8b30bad7c3@mail.gmail.com>
	 <444F51C7.2050402@fusemail.com>
	 <4aef63030604260418m4954bbbblfa7e2b146dd332c2@mail.gmail.com>
	 <444F708C.6010907@fusemail.com>
	 <4aef63030604260829y7673249eka2b9b3e05e9ed93c@mail.gmail.com>
	 <444F9F4A.9020904@fusemail.com>
	 <4aef63030604270842o4683e83ei358c8def8a50d8b0@mail.gmail.com>
	 <4450E8BE.40003@fusemail.com>
Message-ID: <4aef63030605030843r45068badse057d7597a2cfd8a@mail.gmail.com>

Hi Francisco,

I don't mind adding the position management. Can you send me the samples on
how you did it in the past?

Regards,


pieter

On 4/27/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi Pieter
>
>
> > I did some thinking about your request about the position field in the
> > YDDatabaseTree class, but I don't think we should hardcode it in the
> > class. The class is very generic right now and that's what most people
> > prefer. The application could and should take care of maintaining the
> > data for the position column.
>
> Sorry to disagree but this is a internal tree state. If some
> applications don't use that it will be no problem.
> I can change the tree state externally but it would become an violation
> (like changing 'nleft' or 'nright').
>
> It's not trivial to implement but i made that tree position management
> in the past and i think it can be done with 2 sql queries before the
> adding/moving sql query.
>
> I think that can be incorporated.. if the developer want's to use
> position, those 2 queries will be executed, otherwise it will be like
> it's now.
>
> What do you think?
>
> Francisco A
>
> >
> > On 4/26/06, *Francisco Azevedo* <francisco at fusemail.com
> > <mailto:francisco at fusemail.com>> wrote:
> >
> >
> >      > That's why I added the position field for every node. Using
> >     updateNode
> >      > and addingNode, you can take care of the ordering, provided the
> node
> >      > contains a field called "position" with the right value.
> >
> >     Well.. now i'm confused. You added a new column 'position' but..
> addNode
> >     and updateNode are still the same (read: they don't care about node
> >     reordering).
> >
> >     I mean.. imagine this example
> >
> >
> >        + A (1)
> >        | +- B  (1)
> >        | +- C  (2)
> >        |
> >        +-D     (2)
> >
> >     Inside '()' we have the correspondent position value for each node.
> >
> >     When i use addNode like:  addNode( X, A, 2 ), this is will be the
> tree
> >     with current addNode implementation:
> >
> >        + A (1)
> >        | +- B  (1)
> >        | +- X  (2)
> >        | +- C  (2)
> >        |
> >        +-D     (2)
> >
> >     but it's _wrong_ because addNode didn't update new brother with
> upper
> >     position value than 2.
> >
> >
> >     The same for moveNode... if i have the next _correct_ tree
> >
> >        + A (1)
> >        | +- B  (1)
> >        | +- X  (2)
> >        | +- C  (3)
> >        |
> >        +-D     (2)
> >
> >
> >     and i want to move node X to be the first child of A i use:
> >     moveNode( X,
> >     A, 1 ) ... but with current moveNode implementation i will get:
> >
> >
> >        + A (1)
> >        | +- B  (1)
> >        | +- X  (1)
> >        | +- C  (3)
> >        |
> >        +-D     (2)
> >
> >     and not:
> >
> >        + A (1)
> >        | +- X  (1)
> >        | +- B  (2)
> >        | +- C  (3)
> >        |
> >        +-D     (2)
> >
> >
> >     because of the update stuff again..
> >
> >     So, these methods must care about position changing of brothers..
> and
> >     they aren't yet.
> >
> >     Francisco A
> >
> >
> >      > On 4/26/06, *Francisco Azevedo* <francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>
> >      > <mailto:francisco at fusemail.com <mailto:francisco at fusemail.com>>>
> >     wrote:
> >      >
> >      >
> >      >      > They way I did it now was to add an extra field called
> >     position
> >      >     that can
> >      >      > be used to sort on. By default, the sorting is done on
> >     title, but
> >      >     now
> >      >      > it's changed to first sort on position, and then on title.
> >     From
> >      >     what I
> >      >      > can see, that should work just fine and have no influence
> >     on the
> >      >      > nleft/nright/nlevel values.
> >      >
> >      >     Yes, nleft, nright and nlevel should not be touched.. but we
> >     will need
> >      >     another value 'nposition' to control the order of nodes with
> >     same parent
> >      >     (that, of course, have the same nlevel too).
> >      >
> >      >     Unless you have some idea how to manage positions.. basically
> >     all we
> >      >     need is support in addNode and moveNode to define the
> position.
> >      >     This way we can do things like move node C upper, moveNode(
> >     B, A, 2 ):
> >      >
> >      >     + A          + A
> >      >     | +- B       | +- C
> >      >     | +- C    => | +- B
> >      >     |            |
> >      >     +-D          +-D
> >      >
> >      >
> >      >     or... addNode X after B, addNode( X, A, 2 ):
> >      >
> >      >
> >      >     + A          + A
> >      >     | +- B       | +- B
> >      >     | +- C    => | +- X
> >      >     |            | +- C
> >      >     +-D          |
> >      >                  +-D
> >      >
> >      >
> >      >     This is really needed..
> >      >
> >      >     Francisco A
> >      >
> >      >
> >      >      > pieter
> >      >      >
> >      >      > On 4/26/06, *Francisco Azevedo* <francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>
> >      >     <mailto: francisco at fusemail.com <mailto:
> francisco at fusemail.com>>
> >      >      > <mailto:francisco at fusemail.com
> >     <mailto:francisco at fusemail.com> <mailto:francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>>>>
> >      >     wrote:
> >      >      >
> >      >      >
> >      >      >      > Done in build 1888.
> >      >      >
> >      >      >     Well.. feature #001986 is missing :)
> >      >      >
> >      >      >     YDDatabaseTree should internally care about positions
> >     (eg: like
> >      >      >     'nleft')
> >      >      >     and manage that automatically. This way:
> >      >      >     - when we are inserting a node, it should calculate
> >     the last
> >      >     position
> >      >      >     for that parent
> >      >      >     - when deleting a node, it should decrease positions
> >     of bigger
> >      >      >     brothers..
> >      >      >
> >      >      >     it's not trivial. ;)
> >      >      >
> >      >      >     Francisco A
> >      >      >
> >      >      >      > On 4/26/06, *Pieter Claerhout*
> >     <pieter at yellowduck.be <mailto:pieter at yellowduck.be>
> >      >     <mailto:pieter at yellowduck.be <mailto:pieter at yellowduck.be>>
> >      >      >     <mailto:pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be> <mailto:pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be>>>
> >      >      >      > <mailto: pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be> <mailto:pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be>>
> >      >     <mailto:pieter at yellowduck.be <mailto:pieter at yellowduck.be>
> >     <mailto:pieter at yellowduck.be <mailto:pieter at yellowduck.be>>>>>
> wrote:
> >      >      >      >
> >      >      >      >     I will take care of that.
> >      >      >      >
> >      >      >      >     pieter
> >      >      >      >
> >      >      >      >     On 4/25/06, *Francisco Azevedo* <
> >      >     francisco at fusemail.com <mailto:francisco at fusemail.com>
> >     <mailto: francisco at fusemail.com <mailto:francisco at fusemail.com>>
> >      >      >     <mailto: francisco at fusemail.com
> >     <mailto:francisco at fusemail.com> <mailto:francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>>>
> >      >      >      >     <mailto: francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>
> >      >     <mailto:francisco at fusemail.com <mailto:francisco at fusemail.com
> >>
> >      >      >     <mailto: francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>
> >      >     <mailto:francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>> >>> wrote:
> >      >      >      >
> >      >      >      >         >  If there's anything we can help with,
> >     let us know.
> >      >      >      >
> >      >      >      >         Sure.. Now, a good help could be:
> >      >      >      >
> >      >      >      >         - add YDDatabaseTree::updateNode
> >      >      >      >
> >      >      >      >         - add the position column feature #001986
> >      >      >      >
> >      >      >      >         - be able to define: setSortField(
> >     "parent_id ASC,
> >      >      >     position ASC"
> >      >      >      >         ) that
> >      >      >      >         will sort nodes by parent and nodes with
> same
> >      >     parent will be
> >      >      >      >         sorted by
> >      >      >      >         its position ;)
> >      >      >      >
> >      >      >      >         Francisco A
> >      >      >
> >      >      >     _______________________________________________
> >      >      >     YDFramework-devel mailing list
> >      >      >     YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>
> >      >     <mailto:YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de> >
> >      >      >     <mailto: YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>
> >      >     <mailto:YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>>>
> >      >      >
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >      >     < http://lists.berlios.de/mailman/listinfo/ydframework-devel>
> >      >      >
> >     <http://lists.berlios.de/mailman/listinfo/ydframework-devel >
> >      >      >
> >      >      >
> >      >      >
> >      >      >
> >      >      > --
> >      >      > pieter claerhout . pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be>
> >      >     <mailto: pieter at yellowduck.be <mailto:pieter at yellowduck.be>>
> >     <mailto:pieter at yellowduck.be <mailto:pieter at yellowduck.be>
> >      >     <mailto:pieter at yellowduck.be <mailto:pieter at yellowduck.be>>>
> .
> >      >      > http://www.yellowduck.be/
> >      >
> >      >     _______________________________________________
> >      >     YDFramework-devel mailing list
> >      >     YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>
> >      >     <mailto:YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>>
> >      >     http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >      >
> >      >
> >      >
> >      >
> >      > --
> >      > pieter claerhout . pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be> <mailto:pieter at yellowduck.be
> >     <mailto:pieter at yellowduck.be>> .
> >      > http://www.yellowduck.be/
> >
> >     _______________________________________________
> >     YDFramework-devel mailing list
> >     YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>
> >     http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >     <http://lists.berlios.de/mailman/listinfo/ydframework-devel>
> >
> >
> >
> >
> > --
> > pieter claerhout . pieter at yellowduck.be <mailto:pieter at yellowduck.be> .
> > http://www.yellowduck.be/
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060503/d5275c99/attachment.html>

From pclaerhout at berlios.de  Thu May  4 16:35:34 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Thu, 4 May 2006 16:35:34 +0200
Subject: [ydf-devel] r1908 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200605041435.k44EZYKH015563@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-04 16:35:34 +0200 (Thu, 04 May 2006)
New Revision: 1908

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
Log:
Fixed two bugs in the recording of the statistics:
- Cached pages are now also logged to the statistics
- The index page is now also logged to the statistics

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-05-03 14:38:25 UTC (rev 1907)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-05-04 14:35:34 UTC (rev 1908)
@@ -241,6 +241,11 @@
                 }
             }
 
+            // Add index.php
+            if ( empty( $values['uri'] ) && basename( YD_SELF_SCRIPT ) == 'index.php' ) {
+                $values['uri'] = 'index.php';
+            }
+
             // Add them to the database
             $this->weblog->logRequestToStats( $values );
 

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-05-03 14:38:25 UTC (rev 1907)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-05-04 14:35:34 UTC (rev 1908)
@@ -42,6 +42,15 @@
     $cache_file = YD_DIR_TEMP . '/' . YD_WEBLOG_CACHE_PREFIX . md5( YDRequest::getNormalizedCurrentUrl() ) . '.' . YD_WEBLOG_CACHE_SUFFIX;
     @define( 'YD_WEBLOG_CACHE_FNAME', $cache_file );
 
+    // Include the standard modules
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDDatabaseMetaData.php' );
+    YDInclude( 'YDTemplate.php' );
+
+    // Include other libraries
+    YDInclude( dirname( __FILE__ ) . '/YDWeblogAPI.php' );
+    YDInclude( dirname( __FILE__ ) . '/YDWeblogRequest.php' );
+
     // Check if the user wanted to use caching
     if ( YDConfig::get( 'use_cache', false ) ) {
 
@@ -59,6 +68,12 @@
 
                 // Add the elapsed time
                 $elapsed = $GLOBALS['timer']->getElapsed();
+
+                // Log the request to the statistics
+                $req = new YDWeblogRequest();
+                $req->_logRequest();
+
+                // Add the statistics
                 die( $data . YD_CRLF . '<!-- #cached: ' . $elapsed . ' ms -->' );
 
             }
@@ -71,16 +86,9 @@
     YDInclude( 'YDUrl.php' );
     YDInclude( 'YDUtil.php' );
     YDInclude( 'YDForm.php' );
-    YDInclude( 'YDTemplate.php' );
-    YDInclude( 'YDDatabase.php' );
-    YDInclude( 'YDDatabaseMetaData.php' );
     YDInclude( 'YDFileSystem.php' );
     YDInclude( 'YDFormElements/YDFormElement_BBTextArea.php' );
 
-    // Include other libraries
-    YDInclude( dirname( __FILE__ ) . '/YDWeblogAPI.php' );
-    YDInclude( dirname( __FILE__ ) . '/YDWeblogRequest.php' );
-
     // Check if the weblog application is locked or not
     $db = YDDatabase::getInstance(
         'mysql',



From francisco at fusemail.com  Thu May  4 18:01:33 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 04 May 2006 17:01:33 +0100
Subject: [ydf-devel] YDCM feedback
In-Reply-To: <4aef63030605030843r45068badse057d7597a2cfd8a@mail.gmail.com>
References: <444518AC.1080102@fusemail.com>	 <4aef63030604252350y7ed6f36bqbaeb34bdc879f4c@mail.gmail.com>	 <4aef63030604260346w41b35917i7419bb8b30bad7c3@mail.gmail.com>	 <444F51C7.2050402@fusemail.com>	 <4aef63030604260418m4954bbbblfa7e2b146dd332c2@mail.gmail.com>	 <444F708C.6010907@fusemail.com>	 <4aef63030604260829y7673249eka2b9b3e05e9ed93c@mail.gmail.com>	 <444F9F4A.9020904@fusemail.com>	 <4aef63030604270842o4683e83ei358c8def8a50d8b0@mail.gmail.com>	 <4450E8BE.40003@fusemail.com> <4aef63030605030843r45068badse057d7597a2cfd8a@mail.gmail.com>
Message-ID: <445A255D.3060809@fusemail.com>

Hi Pieter


>  
> I don't mind adding the position management. Can you send me the samples 
> on how you did it in the past?


I can tell you the algorithm.. ;) It's simple:

- onDelete( NODE ):
   sql: delete node row with id = NODE
   sql: set position = position - 1 where parent_id = NODE[parent_id]

   .. after delete node we should update brother position to smaller




- onAddNode( NODE, POSITION ):
   sql: set position = position + 1 where parent_id = NODE[parent_id] 
AND  position > POSITION
   sql: insert node

   .. before insert we must reserve an position (increasing positions of 
brother that have position bigger than POSITION)




- onMoveNode( NODEFROM, NODETO, POSITION ):
   sql: set position = position - 1 where parent_id = 
NODEFROM[parent_id] AND position > POSITION
   sql: set position = position + 1 where parent_id = NODETO[parent_id] 
AND position > POSITION
   sql: update node parent


   .. before moving we must:
   1 - decrease position of old brothers
   2 - increase position of new brothers
   3 - insert node in new parent
   .. here we must note that we can move inside a parent (to a new 
position) and to a new parent (with a custom position) too! The 
algorithm will work in the 2 ways ;)


regards
Francisco A


From ximian at berlios.de  Thu May  4 18:09:52 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 4 May 2006 18:09:52 +0200
Subject: [ydf-devel] r1909 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent
Message-ID: <200605041609.k44G9qKH024289@sheep.berlios.de>

Author: ximian
Date: 2006-05-04 18:09:26 +0200 (Thu, 04 May 2006)
New Revision: 1909

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
- added 2 new node attributes that define is node is dragable and dropable
- updated DBDesigner scheme
- added method YDCMComponent::moveNode
- added method YDCMComponent::getDragDropElements that validates if 2 nodes are valid drag and valid drop


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-04 14:35:34 UTC (rev 1908)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-04 16:09:26 UTC (rev 1909)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="73.00" XPos="25" YPos="329" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="73.00" XPos="0" YPos="405" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -482,6 +482,18 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1588" ColName="candrag" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be dragged">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1589" ColName="candrop" PrevColName="" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be droppable">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1340" />
@@ -816,13 +828,13 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1374" ColName="urgency_id" PrevColName="urgency" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="">
+<COLUMN ID="1374" ColName="urgency_id" PrevColName="urgency" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1375" ColName="state_id" PrevColName="state" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="1" Comments="">
+<COLUMN ID="1375" ColName="state_id" PrevColName="state" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="1" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -832,11 +844,11 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1377" ColName="created_in" PrevColName="" Pos="7" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1377" ColName="created_in" PrevColName="" Pos="7" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1378" ColName="reported_in" PrevColName="" Pos="8" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1378" ColName="reported_in" PrevColName="" Pos="8" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -845,7 +857,7 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1380" ColName="reported_to_in" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1380" ColName="reported_to_in" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -1133,7 +1145,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1565" Tablename="YDCMHelpdesk" PrevTableName="Table_20" XPos="360" YPos="1520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
+<TABLE ID="1565" Tablename="YDCMHelpdesk" PrevTableName="Table_20" XPos="360" YPos="1540" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
 <COLUMNS>
 <COLUMN ID="1567" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-04 14:35:34 UTC (rev 1908)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-04 16:09:26 UTC (rev 1909)
@@ -84,6 +84,8 @@
 			$this->tree->addField( 'searcheable' );
 			$this->tree->addField( 'published_date_start' );
 			$this->tree->addField( 'published_date_end' );
+			$this->tree->addField( 'candrag' );
+			$this->tree->addField( 'candrop' );
 		}
 
 
@@ -98,6 +100,22 @@
 
 
         /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x => 'PHCMPage', $y => 'PHCMRootmenu ))'
+         */
+		function getDragDropElements( $x, $y ){
+		
+			$treeObj = new YDCMTree();
+			return $treeObj->getDragDropElements( $x, $y );
+		}
+
+
+        /**
          *  This function returns the component author
          *
          *  @returns    component author
@@ -206,6 +224,18 @@
 		}
 
 
+        /**
+         *  This function moves a node
+         *
+         *  @param $values  Node values
+         */
+		function moveNode( $x, $y ){
+
+			// use YDDatabasetree method
+			return $this->tree->moveNode( $x, $y );
+		}
+
+
     }
 
 
@@ -236,7 +266,39 @@
 			$this->registerField( 'searcheable' );			
 			$this->registerField( 'published_date_start' );
 			$this->registerField( 'published_date_end' );			
+			$this->registerField( 'candrag' );
+			$this->registerField( 'candrop' );
 		}
+
+
+        /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node information
+         */
+		function getDragDropElements( $x, $y ){
+		
+			// check if elements are numeric
+			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
+		
+			// reset old values and get current table	
+			$this->resetValues();
+
+			// set custom where to get those 2 elements
+			$this->where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
+
+			// we must get always 2 elements otherwise they were not valid
+			if ( $this->find() != 2 ) return false;
+
+			// return associative array
+			return $this->getResultsAsAssocArray( 'content_id' );
+		}
+
+
 	}
 
 ?>
\ No newline at end of file



From ximian at berlios.de  Thu May  4 18:11:38 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 4 May 2006 18:11:38 +0200
Subject: [ydf-devel] r1910 - YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk
Message-ID: <200605041611.k44GBcxc024449@sheep.berlios.de>

Author: ximian
Date: 2006-05-04 18:11:15 +0200 (Thu, 04 May 2006)
New Revision: 1910

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
Log:
lots of updates in YCMHelpdesk

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-04 16:09:26 UTC (rev 1909)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-04 16:11:15 UTC (rev 1910)
@@ -57,7 +57,7 @@
          *  @param $reference  (Optional) Node reference
          *  @param $parent_id  (Optional) Id of the parent help desk
          */
-		function create( $title, $language_id = 'all', $reference = '', $parent_id = 0 ){
+		function addHelpdesk( $title, $language_id = 'all', $reference = '', $parent_id = 0 ){
 		
 			// add node to content tree
 			$node = array();
@@ -91,7 +91,19 @@
 			return $this->insert();
 		}
 
+/*
+		function deleteHelpdesk( $id ){
 		
+			$this->resetValues();
+			
+			$this->content_id = intval( $id );
+			
+			// delete all post that have this parent
+			$posts = new YDCMHelpdesk_posts();
+			$posts->deleteParent( $id );
+		
+		}
+		*/
     }
 
 
@@ -144,6 +156,64 @@
             $relState->setForeignKey( 'state_id' );
 		}
 
+
+		function addPost( $helpdesk_id, $user_id, $values ){
+		
+			$this->resetValues();
+		
+			// add required fields
+			// TODO: check if user, urgency and state exist
+			$this->component_id = $helpdesk_id;
+			$this->user_id      = $user_id;
+			$this->urgency_id   = $values['urgency_id'];
+			$this->state_id     = $values['state_id'];
+
+
+			// add optional fields
+			if ( isset( $values['subject'] ) )           $this->subject           = $values['subject'];
+			if ( isset( $values['localization'] ) )      $this->localization      = $values['localization'];
+			if ( isset( $values['text'] ) )              $this->text              = $values['text'];
+			if ( isset( $values['created_in'] ) )        $this->created_in        = $values['created_in'];
+			if ( isset( $values['reported_in'] ) )       $this->reported_in       = $values['reported_in'];
+			if ( isset( $values['reported_by'] ) )       $this->reported_by       = $values['reported_by'];
+			if ( isset( $values['reported_to_in'] ) )    $this->reported_to_in    = $values['reported_to_in'];
+			if ( isset( $values['reported_to'] ) )       $this->reported_to       = $values['reported_to'];
+			if ( isset( $values['reported_to_local'] ) ) $this->reported_to_local = $values['reported_to_local'];
+			
+			return $this->insert();
+		}
+		
+		
+		function deletePost( $post_id ){
+		
+			$this->resetValues();
+			
+			$this->post_id = intval( $post_id );
+			
+			return $this->delete();
+		}
+
+
+		function deleteAll( $helpdesk_id ){
+		
+			$this->resetValues();
+			
+			$this->component_id = intval( $helpdesk_id );
+			
+			return $this->delete();
+		}
+
+
+		function deleteParent( $parent_id ){
+		
+			$this->resetValues();
+			
+			$this->parent_id = intval( $parent_id );
+			
+			return $this->delete();
+		}
+
+		
 	}
 
 
@@ -174,6 +244,24 @@
             $relUsers->setForeignKey( 'user_id' );
 		}
 
+
+		function addResponse( $post_id, $user_id, $message ){
+		
+			YDInclude( 'YDUtil.php' );
+
+			$this->resetValues();
+		
+			// create response
+			// TODO: check if post_id and user_id are valid
+			$this->post_id     = intval( $post_id );
+			$this->user_id     = intval( $user_id );
+			$this->date        = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$this->description = $message;
+
+			return $this->insert();
+		}
+		
+		
 	}	
 
 
@@ -199,6 +287,20 @@
 			$rel->setForeignJoin( 'LEFT' );
 		}
 
+
+		function addUrgency( $description, $color = '#FF0000' ){
+		
+			$this->resetValues();
+
+			// create urgency
+			$this->description  = $description;
+			$this->color        = $color;
+
+			return $this->insert();
+		}
+
+
+
 	}	
 
 
@@ -224,6 +326,18 @@
 			$rel->setForeignJoin( 'LEFT' );
 		}
 
+
+		function addState( $description ){
+		
+			$this->resetValues();
+
+			// create state
+			$this->description  = $description;
+
+			return $this->insert();
+		}
+
+
 	}	
 
 



From ximian at berlios.de  Thu May  4 18:35:41 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 4 May 2006 18:35:41 +0200
Subject: [ydf-devel] r1911 - in YDFramework2.0/trunk/YDFramework2: YDClasses/YDCMComponent addons/YDCMLanguages/languages
Message-ID: <200605041635.k44GZfYg031167@sheep.berlios.de>

Author: ximian
Date: 2006-05-04 18:35:02 +0200 (Thu, 04 May 2006)
New Revision: 1911

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php
Log:
- updated sql inserts file (2 new columns 'candrag & candrop' were added)
- new generic translation added

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql	2006-05-04 16:11:15 UTC (rev 1910)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql	2006-05-04 16:35:02 UTC (rev 1911)
@@ -19,17 +19,17 @@
 
 
 
-INSERT INTO `ydcmtree` VALUES (1,0,1,22,1,1,'YDCMRoot','',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (5,4,7,8,3,1,'YDCMPage','Apache',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (6,4,9,10,3,1,'YDCMPage','PostegreSQL',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (7,4,11,12,3,1,'YDCMPage','mysql',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (8,1,14,21,2,1,'YDCMRootmenu','links',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (9,8,15,16,3,1,'YDCMPage','databases',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (10,8,17,18,3,1,'YDCMPage','generators',1,1,1,0,0);
-INSERT INTO `ydcmtree` VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,0,0);
+INSERT INTO `ydcmtree` VALUES (1,0,1,22,1,1,'YDCMRoot','',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (5,4,7,8,3,1,'YDCMPage','Apache',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (6,4,9,10,3,1,'YDCMPage','PostegreSQL',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (7,4,11,12,3,1,'YDCMPage','mysql',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (8,1,14,21,2,1,'YDCMRootmenu','links',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (9,8,15,16,3,1,'YDCMPage','databases',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (10,8,17,18,3,1,'YDCMPage','generators',1,1,1,0,0,0,0);
+INSERT INTO `ydcmtree` VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,0,0,0,0);
 
 
 INSERT INTO `ydcmpage` VALUES (1,  5, 'en', 1, 'Apache in english', '', '', 0, '', 0, '', '');

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php	2006-05-04 16:11:15 UTC (rev 1910)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/en.php	2006-05-04 16:35:02 UTC (rev 1911)
@@ -13,6 +13,7 @@
 $GLOBALS['t']['toggle state'] = 'Toggle state';
 $GLOBALS['t']['public'] = 'Public';
 $GLOBALS['t']['private'] = 'Private';
+$GLOBALS['t']['not allowed'] = 'Not allowed';
 
 $GLOBALS['t']['add page'] = 'Add page';
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php	2006-05-04 16:11:15 UTC (rev 1910)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/languages/pt.php	2006-05-04 16:35:02 UTC (rev 1911)
@@ -13,6 +13,7 @@
 $GLOBALS['t']['toggle state'] = 'Inverter estado';
 $GLOBALS['t']['public'] = 'P&uacute;blico';
 $GLOBALS['t']['private'] = 'Privado';
+$GLOBALS['t']['not allowed'] = 'N&atilde;o permitido';
 
 $GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
 



From ximian at berlios.de  Mon May  8 11:40:19 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 11:40:19 +0200
Subject: [ydf-devel] r1912 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200605080940.k489eJhf012625@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 11:39:39 +0200 (Mon, 08 May 2006)
New Revision: 1912

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
YDAjax now shows waiting message correctly h-centered in screen

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-05-04 16:35:02 UTC (rev 1911)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-05-08 09:39:39 UTC (rev 1912)
@@ -68,7 +68,7 @@
 
             // Setup the module
             $this->_author = 'Francisco Azevedo';
-            $this->_version = '2.81b';
+            $this->_version = '2.82b';
             $this->_copyright = '(c) Copyright 2002-2006 Francisco Azevedo';
             $this->_description = 'This class makes ajax easy for YDF developers';
 
@@ -211,14 +211,16 @@
 
 			// check custom options
 			if ( !isset( $options['style.backgroundColor'] ) ) $options['style.backgroundColor'] = '#cccccc';
-			if ( !isset( $options['style.top'] ) )             $options['style.top']             = '40%';
-			if ( !isset( $options['style.left'] ) )            $options['style.left']            = '42%';
 			if ( !isset( $options['style.border'] ) )          $options['style.border']          = '1px solid #110000';
+			if ( !isset( $options['style.width'] ) )           $options['style.width']           = '200px';
 
 			// static values
-			$options['innerHTML']      = $html;
-			$options['style.position'] = "absolute";
-			$options['style.zindex']   = 9999;
+			$options['style.position']   = "absolute";
+			$options['style.top']        = '40%';
+			$options['style.left']       = '50%';
+			$options['style.marginLeft'] = '-' . round( intval( $options['style.width'] ) / 2) . 'px';
+			$options['style.zindex']     = 9999;
+			$options['innerHTML']        = '<center>' . $html . '</center>';
 
 			// create js for html element creation
 			$this->waitingMessageCode  = "var " . $this->wtID . " = document.createElement('div');";



From ximian at berlios.de  Mon May  8 11:44:54 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 11:44:54 +0200
Subject: [ydf-devel] r1913 - YDFramework2.0/trunk/examples/ajax
Message-ID: <200605080944.k489isZq013310@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 11:44:29 +0200 (Mon, 08 May 2006)
New Revision: 1913

Modified:
   YDFramework2.0/trunk/examples/ajax/waiting.php
Log:
waiting message example with standard message

Modified: YDFramework2.0/trunk/examples/ajax/waiting.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/waiting.php	2006-05-08 09:39:39 UTC (rev 1912)
+++ YDFramework2.0/trunk/examples/ajax/waiting.php	2006-05-08 09:44:29 UTC (rev 1913)
@@ -37,7 +37,7 @@
 			$onHide  = new YDAjaxEffect('', 'opacity', "toggle()" );
 
 			// use waiting message with custom effects
-			$this->ajax->useWaitingMessage( 'test<p class="aaa">test with class</p>', array(), $onStart, $onShow, $onHide );
+			$this->ajax->useWaitingMessage( '<h2>Please wait . . .</h2>', array(), $onStart, $onShow, $onHide );
 
 			// to use default waiting message just try:
 			// $this->ajax->useWaitingMessage();



From ximian at berlios.de  Mon May  8 13:06:45 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 13:06:45 +0200
Subject: [ydf-devel] r1914 - YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200605081106.k48B6j6t009106@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 13:06:20 +0200 (Mon, 08 May 2006)
New Revision: 1914

Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
much better YDCM database scheme on DBDesigner:
- added colored regions
- splited lines in long references
- standard inserts on the DBDesigner4.xml instead of a separated file
.. now it's much more easy to understand it.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-08 09:44:29 UTC (rev 1913)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-08 11:06:20 UTC (rev 1914)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="73.00" XPos="0" YPos="405" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="40.00" XPos="50" YPos="48" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -258,9 +258,16 @@
 </SETTINGS>
 <METADATA>
 <REGIONS>
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="140" YPos="680" Width="280" Height="340" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
+<REGION ID="1613" RegionName="Guestbook component" XPos="1180" YPos="890" Width="500" Height="280" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1615" RegionName="Helpdesk component" XPos="1180" YPos="1210" Width="800" Height="520" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1616" RegionName="Rootmenu component ( YDCMRootmenu )" XPos="1180" YPos="170" Width="280" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1180" YPos="350" Width="260" Height="300" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1620" RegionName="Link component" XPos="1180" YPos="690" Width="260" Height="160" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1621" RegionName="MASTER COMPONENT ( YDCMComponent )" XPos="140" YPos="150" Width="940" Height="480" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
 </REGIONS>
 <TABLES>
-<TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="700" YPos="260" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
+<TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="500" YPos="490" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
 <COLUMNS>
 <COLUMN ID="1169" ColName="YDCMAudit_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement action">
 <OPTIONSELECTED>
@@ -306,7 +313,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="360" YPos="800" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
+<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1200" YPos="390" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` VALUES (1,  5, \aen\a, 1, \aApache in english\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\nINSERT INTO `ydcmpage` VALUES (2,  6, \aall\a, 1, \aPostgreSQL in all lang\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\nINSERT INTO `ydcmpage` VALUES (3,  7, \apt\a, 1, \amySQL in PT\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\nINSERT INTO `ydcmpage` VALUES (4,  9, \aen\a, 1, \aOur databases\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\nINSERT INTO `ydcmpage` VALUES (5, 10, \aen\a, 1, \aGenerators\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\nINSERT INTO `ydcmpage` VALUES (6, 11, \aall\a, 1, \aPortals for all\a, \a\a, \a\a, 0, \a\a, 0, \a\a, \a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLi!
 nkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
 <COLUMNS>
 <COLUMN ID="1315" ColName="component_id" PrevColName="" Pos="10" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="page id">
 <OPTIONSELECTED>
@@ -382,41 +389,15 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1161" Tablename="YDCMConfiguration" PrevTableName="configuration" XPos="1420" YPos="60" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO configuration(name, value)\nVALUES(\aname\a, \a\A.$site_name.\A\a);\nINSERT INTO configuration(name, value)\nVALUES(\aadministrator_id\a, \a1\a);\nINSERT INTO configuration(name, value)\nVALUES(\aserver_type\a, \a0\a);\nINSERT INTO configuration(name, value)\nVALUES(\agmt\a, \a0\a);\nINSERT INTO configuration(name, value)\nVALUES(\acharset\a, \aiso-8859-15\a);\nINSERT INTO configuration(name, value)\nVALUES(\astate\a, \a1\a);\nINSERT INTO configuration(name, value)\nVALUES(\aoffline_msg\a, \aPortal indisponivel\a);\nINSERT INTO configuration(name, value)\nVALUES(\aerror_msg\a, \aOcorreu um erro\a);\nINSERT INTO configuration(name, value)\nVALUES(\avisits_total\a, \a0\a);\nINSERT INTO configuration(name, value)\nVALUES(\avisits_current\a, \a0\a);\nINSERT INTO configuratio!
 n(name, value)\nVALUES(\apack\a, \adefault\a);\nINSERT INTO configuration(name, value)\nVALUES(\ainstalation_date\a, \a123123123\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_server\a, \a0\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_from\a, \a\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_host\a, \alocalhost\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_port\a, \a25\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_user\a, \a\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_pass\a, \a\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_priority\a, \a1\a);\nINSERT INTO configuration(name, value)\nVALUES(\aemail_helo\a, \a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="5" >
+<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="210" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` VALUES (1,NULL,1,22,1,1,\aYDCMRoot\a,\a\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (6,4,9,10,3,1,\aYDCMPage\a,\aPostegreSQL\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,0,0,0,0);\!
 nINSERT INTO `ydcmtree` VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,0,0,0,0);\nINSERT INTO `ydcmtree` VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,0,0,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
 <COLUMNS>
-<COLUMN ID="1188" ColName="name" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(50)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="variable name">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1189" ColName="value" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="value">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<INDICES>
-<INDEX ID="1281" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1188" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-<INDEX ID="1190" IndexName="name" IndexKind="1" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1188" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="40" YPos="820" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO content(id, parent, path, pathname, position, type, children, reference, state, services, author, date, access, search, published, date_start, date_end, published_after, published_after_notify)\nVALUES(2, 1, \a1\a, \a/\a, 1, \amenu\a, 0, \astandard\a, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0);\nINSERT INTO content(id, parent, path, pathname, position, type, children, reference, state, services, author, date, access, search, published, date_start, date_end, published_after, published_after_notify)\nVALUES(3, 1, \a1\a, \a/\a, 9999999, \amenu_archive\a, 0, \aarchive\a, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6"!
  >
-<COLUMNS>
 <COLUMN ID="1191" ColName="content_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1192" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Parent node id">
+<COLUMN ID="1192" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="Parent node id">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -499,10 +480,14 @@
 <RELATION_START ID="1340" />
 <RELATION_START ID="1341" />
 <RELATION_START ID="1437" />
-<RELATION_START ID="1526" />
 <RELATION_START ID="1535" />
 <RELATION_START ID="1572" />
+<RELATION_START ID="1526" />
+<RELATION_START ID="1646" />
 </RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="1646" />
+</RELATIONS_END>
 <INDICES>
 <INDEX ID="1210" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
 <INDEXCOLUMNS>
@@ -511,7 +496,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="360" YPos="1060" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
+<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1200" YPos="720" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
 <COLUMNS>
 <COLUMN ID="1318" ColName="component_id" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -540,6 +525,12 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1661" ColName="num_visits" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="total of visits">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <RELATIONS_END>
 <RELATION_END ID="1332" />
@@ -553,34 +544,8 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1164" Tablename="YDCMConfiguration_files" PrevTableName="files" XPos="1420" YPos="160" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO files(name, value)\nVALUES(\amaxfilesize_mb\a, \a5\a);\nINSERT INTO files(name, value)\nVALUES(\aimage\a, \ajpeg, gif, png, ico, psd, bmp\a);\nINSERT INTO files(name, value)\nVALUES(\atext\a, \ahtm, html, xml, js, css, doc, pdf, xls, ppt, txt\a);\nINSERT INTO files(name, value)\nVALUES(\avideo\a, \ampg, mpeg, avi, wmv\a);\nINSERT INTO files(name, value)\nVALUES(\aaudio\a, \amp3, wav, ogg, mid\a);\nINSERT INTO files(name, value)\nVALUES(\acompress\a, \azip, rar, gz, tgz\a);\nINSERT INTO files(name, value)\nVALUES(\aother\a, \aswf\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="8" >
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="210" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` VALUES (\aall\a,\aAll\a,1,0,0);\nINSERT INTO `ydcmlanguages` VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
 <COLUMNS>
-<COLUMN ID="1214" ColName="name" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(50)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1215" ColName="value" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<INDICES>
-<INDEX ID="1282" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1214" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-<INDEX ID="1216" IndexName="name" IndexKind="1" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1214" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="700" YPos="920" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO languages(interface, name, lang, active, default_lang)\nVALUES(\aadmin\a, \aen\a, \aEnglish\a, 1, 1);\nINSERT INTO languages(interface, name, lang, active, default_lang)\nVALUES(\aadmin\a, \apt\a, \aPortugu\234s\a, 1, 0);\nINSERT INTO languages(interface, name, lang, active, default_lang)\nVALUES(\aclient\a, \aen\a, \aEnglish\a, 1, 1);\nINSERT INTO languages(interface, name, lang, active, default_lang)\nVALUES(\aclient\a, \apt\a, \aPortugu\234s\a, 1, 0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
-<COLUMNS>
 <COLUMN ID="1219" ColName="language_id" PrevColName="lang" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
@@ -626,7 +591,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1166" Tablename="YDCMVisits" PrevTableName="site_log" XPos="1120" YPos="60" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="10" >
+<TABLE ID="1166" Tablename="YDCMStatistics_visits" PrevTableName="site_log" XPos="180" YPos="720" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="10" >
 <COLUMNS>
 <COLUMN ID="1222" ColName="visit_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
 <OPTIONSELECTED>
@@ -648,6 +613,17 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1624" ColName="url" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1659" ColName="hits" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <INDICES>
 <INDEX ID="1230" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -657,7 +633,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1167" Tablename="YDCMSearches" PrevTableName="site_searches" XPos="940" YPos="60" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
+<TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="180" YPos="860" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
 <COLUMNS>
 <COLUMN ID="1231" ColName="search_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
 <OPTIONSELECTED>
@@ -683,7 +659,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="900" YPos="480" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO users(id, parent, path, position, children, master, username, password, name, email, other, language, state, login_start, login_end, created, created_user, login_counter, login_last, login_current, personalconfig_access, content_access, content_create, content_edit, content_approve, content_move, content_copy, content_block, content_delete, content_custom, visits_access, searches_access, downloads_access, information_access, database_access, audit_access, files_access, files_configuration, users_access, configuration_general_access, configuration_languages_access)\nVALUES(1, 0, \a0\a, 1, 0, 0, \a21232f297a57a5a\a, \a21232f297a57a5a743894a0e4a801fc3\a, \apH cms - Super administrator\a, \a \a, \a \a, \aEnglish\a, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1!
 , 1, 1, 1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
+<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="820" YPos="220" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` VALUES (1,NULL,0,0,0,\aadmin\a,\a21232f297a57a5a743894a0e4a801fc3\a,\aname\a,\aemail at host.com\a,\aother info\a,\aen\a,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,\a0000-00-00 00:00:00\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
 <COLUMNS>
 <COLUMN ID="1238" ColName="user_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
 <OPTIONSELECTED>
@@ -691,7 +667,7 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1239" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional parent of this user">
+<COLUMN ID="1239" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="optional parent of this user">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -788,9 +764,11 @@
 <RELATION_START ID="1383" />
 <RELATION_START ID="1410" />
 <RELATION_START ID="1436" />
+<RELATION_START ID="1648" />
 </RELATIONS_START>
 <RELATIONS_END>
 <RELATION_END ID="1366" />
+<RELATION_END ID="1648" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -800,7 +778,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="740" YPos="1540" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
+<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1460" YPos="1270" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
 <COLUMNS>
 <COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -824,10 +802,6 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1373" ColName="localization" PrevColName="" Pos="3" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
 <COLUMN ID="1374" ColName="urgency_id" PrevColName="urgency" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
@@ -844,33 +818,58 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1377" ColName="created_in" PrevColName="" Pos="7" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1377" ColName="creation_user" PrevColName="created_in" Pos="7" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1378" ColName="reported_in" PrevColName="" Pos="8" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1600" ColName="creation_date" PrevColName="" Pos="13" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1379" ColName="reported_by" PrevColName="" Pos="9" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1379" ColName="reported_by_user" PrevColName="reported_by" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1380" ColName="reported_to_in" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1382" ColName="reported_by_type" PrevColName="reported_to_local" Pos="12" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1381" ColName="reported_to" PrevColName="" Pos="11" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1380" ColName="reported_by_local" PrevColName="reported_to_in" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1382" ColName="reported_to_local" PrevColName="" Pos="12" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1381" ColName="reported_by_date" PrevColName="reported_to" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1601" ColName="assignedto_user" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1602" ColName="assignedto_type" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1603" ColName="assignedto_local" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1604" ColName="assignedto_date" PrevColName="" Pos="16" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1409" />
@@ -880,6 +879,8 @@
 <RELATION_END ID="1392" />
 <RELATION_END ID="1413" />
 <RELATION_END ID="1575" />
+<RELATION_END ID="1608" />
+<RELATION_END ID="1610" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1582" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -889,7 +890,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1384" Tablename="YDCMHelpdesk_state" PrevTableName="Table_12" XPos="1080" YPos="1760" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="22" >
+<TABLE ID="1384" Tablename="YDCMHelpdesk_state" PrevTableName="Table_12" XPos="1760" YPos="1570" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="22" >
 <COLUMNS>
 <COLUMN ID="1386" ColName="state_id" PrevColName="" Pos="0" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -914,7 +915,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1393" Tablename="YDCMHelpdesk_urgency" PrevTableName="Table_13" XPos="1080" YPos="1680" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="24" >
+<TABLE ID="1393" Tablename="YDCMHelpdesk_urgency" PrevTableName="Table_13" XPos="1760" YPos="1450" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="24" >
 <COLUMNS>
 <COLUMN ID="1395" ColName="urgency_id" PrevColName="" Pos="0" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -944,7 +945,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1080" YPos="1560" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
+<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1760" YPos="1310" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
 <COLUMNS>
 <COLUMN ID="1403" ColName="response_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -985,7 +986,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="40" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
+<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="500" YPos="380" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
 <COLUMNS>
 <COLUMN ID="1578" ColName="lock_id" PrevColName="" Pos="2" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="lock ID">
 <OPTIONSELECTED>
@@ -1018,7 +1019,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1519" Tablename="YDCMRootmenu" PrevTableName="Table_21" XPos="360" YPos="680" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="31" >
+<TABLE ID="1519" Tablename="YDCMRootmenu" PrevTableName="Table_21" XPos="1200" YPos="210" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmrootmenu` (`component_id`,`content_id`,`language_id`,`title`) VALUES (1,2,\aall\a,\amy menu paste\a);\nINSERT INTO `ydcmrootmenu` (`component_id`,`content_id`,`language_id`,`title`) VALUES (2,3,\aen\a,\adocumentation in EN\a);\nINSERT INTO `ydcmrootmenu` (`component_id`,`content_id`,`language_id`,`title`) VALUES (3,4,\apt\a,\aPT books menu\a);\nINSERT INTO `ydcmrootmenu` (`component_id`,`content_id`,`language_id`,`title`) VALUES (4,8,\aall\a,\alinks menu\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="31" >
 <COLUMNS>
 <COLUMN ID="1521" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1026,7 +1027,7 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1523" ColName="content_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1612" ColName="content_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -1044,8 +1045,8 @@
 </COLUMN>
 </COLUMNS>
 <RELATIONS_END>
+<RELATION_END ID="1527" />
 <RELATION_END ID="1526" />
-<RELATION_END ID="1527" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1522" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -1055,7 +1056,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1528" Tablename="YDCMGuestbook" PrevTableName="Table_22" XPos="360" YPos="1200" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="34" >
+<TABLE ID="1528" Tablename="YDCMGuestbook" PrevTableName="Table_22" XPos="1200" YPos="930" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="34" >
 <COLUMNS>
 <COLUMN ID="1530" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1095,7 +1096,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="640" YPos="1320" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1460" YPos="1010" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement post id">
 <OPTIONSELECTED>
@@ -1145,7 +1146,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1565" Tablename="YDCMHelpdesk" PrevTableName="Table_20" XPos="360" YPos="1540" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
+<TABLE ID="1565" Tablename="YDCMHelpdesk" PrevTableName="Table_20" XPos="1200" YPos="1270" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
 <COLUMNS>
 <COLUMN ID="1567" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1185,29 +1186,85 @@
 </INDEX>
 </INDICES>
 </TABLE>
+<TABLE ID="1590" Tablename="YDCMHelpdesk_type" PrevTableName="Table_20" XPos="1500" YPos="1650" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" >
+<COLUMNS>
+<COLUMN ID="1592" ColName="type_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1594" ColName="description" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="eg: \aemail\a, \aphone\a">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1608" />
+<RELATION_START ID="1610" />
+</RELATIONS_START>
+<INDICES>
+<INDEX ID="1593" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1592" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="180" YPos="940" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
+<COLUMNS>
+<COLUMN ID="1631" ColName="download_is" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1633" ColName="date" PrevColName="" Pos="1" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1634" ColName="filename" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<INDICES>
+<INDEX ID="1632" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1631" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
 </TABLES>
 <RELATIONS>
-<RELATION ID="1331" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1160" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" />
-<RELATION ID="1332" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1163" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="13" />
-<RELATION ID="1333" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1158" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="14" />
-<RELATION ID="1340" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1160" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="15" />
-<RELATION ID="1341" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1163" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="11" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="16" />
-<RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
-<RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
+<RELATION ID="1331" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1160" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="1" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" />
+<RELATION ID="1332" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1163" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="13" />
+<RELATION ID="1333" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1158" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="-22" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-42" CaptionOffsetY="-25" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="14" />
+<RELATION ID="1340" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1160" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="-71" StartIntervalOffsetY="-7" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="15" />
+<RELATION ID="1341" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1163" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="16" />
+<RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="38" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="38" CaptionOffsetY="19" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
+<RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="1" EndIntervalOffsetY="10" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
 <RELATION ID="1392" RelationName="state_id" Kind="2" SrcTable="1384" DestTable="1367" FKFields="state_id=state_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="23" />
 <RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
-<RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1413" RelationName="urgency_id" Kind="2" SrcTable="1393" DestTable="1367" FKFields="urgency_id=urgency_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
-<RELATION ID="1526" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1519" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="32" />
-<RELATION ID="1527" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1519" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="18" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="33" />
-<RELATION ID="1535" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1528" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-15" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="35" />
-<RELATION ID="1536" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1528" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="14" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="28" CaptionOffsetY="-48" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
-<RELATION ID="1547" RelationName="component_id" Kind="2" SrcTable="1528" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
-<RELATION ID="1572" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1565" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="110" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
-<RELATION ID="1573" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1565" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="236" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
-<RELATION ID="1575" RelationName="component_id" Kind="2" SrcTable="1565" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1413" RelationName="urgency_id" Kind="2" SrcTable="1393" DestTable="1367" FKFields="urgency_id=urgency_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-4" CaptionOffsetY="3" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="26" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="49" CaptionOffsetY="-27" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
+<RELATION ID="1527" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1519" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="18" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="33" />
+<RELATION ID="1535" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1528" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="60" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="-4" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="35" />
+<RELATION ID="1536" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1528" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="28" CaptionOffsetY="-48" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
+<RELATION ID="1547" RelationName="component_id" Kind="2" SrcTable="1528" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="58" CaptionOffsetY="-33" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+<RELATION ID="1572" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1565" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="73" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="10" EndIntervalOffsetY="4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
+<RELATION ID="1573" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1565" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="109" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="3" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1575" RelationName="component_id" Kind="2" SrcTable="1565" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="51" CaptionOffsetY="-40" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1608" RelationName="reported_by_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=reported_by_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-68" CaptionOffsetY="-22" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
+<RELATION ID="1610" RelationName="assignedto_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=assignedto_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="63" CaptionOffsetY="-22" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="44" />
+<RELATION ID="1526" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1519" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="20" CaptionOffsetY="-20" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="32" />
+<RELATION ID="1646" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
+<RELATION ID="1648" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="user_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="52" />
 </RELATIONS>
 <NOTES>
 </NOTES>

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql	2006-05-08 09:44:29 UTC (rev 1913)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/inserts.sql	2006-05-08 11:06:20 UTC (rev 1914)
@@ -1,51 +0,0 @@
-
-
-INSERT INTO `ydcmconfiguration_files` VALUES ('audio','mp3, wav, ogg, mid');
-INSERT INTO `ydcmconfiguration_files` VALUES ('compress','zip, rar, gz, tgz');
-INSERT INTO `ydcmconfiguration_files` VALUES ('image','jpeg, gif, png, ico, psd, bmp');
-INSERT INTO `ydcmconfiguration_files` VALUES ('maxfilesize_mb','5');
-INSERT INTO `ydcmconfiguration_files` VALUES ('other','swf');
-INSERT INTO `ydcmconfiguration_files` VALUES ('text','htm, html, xml, js, css, doc, pdf, xls, ppt, txt');
-INSERT INTO `ydcmconfiguration_files` VALUES ('video','mpg, mpeg, avi, wmv');
-
-
-
-
-
-INSERT INTO `ydcmlanguages` VALUES ('all','All',1,0,0);
-INSERT INTO `ydcmlanguages` VALUES ('en','English',1,1,1);
-INSERT INTO `ydcmlanguages` VALUES ('pt','Portugu?s',1,0,0);
-
-
-
-
-INSERT INTO `ydcmtree` VALUES (1,0,1,22,1,1,'YDCMRoot','',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (5,4,7,8,3,1,'YDCMPage','Apache',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (6,4,9,10,3,1,'YDCMPage','PostegreSQL',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (7,4,11,12,3,1,'YDCMPage','mysql',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (8,1,14,21,2,1,'YDCMRootmenu','links',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (9,8,15,16,3,1,'YDCMPage','databases',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (10,8,17,18,3,1,'YDCMPage','generators',1,1,1,0,0,0,0);
-INSERT INTO `ydcmtree` VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,0,0,0,0);
-
-
-INSERT INTO `ydcmpage` VALUES (1,  5, 'en', 1, 'Apache in english', '', '', 0, '', 0, '', '');
-INSERT INTO `ydcmpage` VALUES (2,  6, 'all', 1, 'PostgreSQL in all lang', '', '', 0, '', 0, '', '');
-INSERT INTO `ydcmpage` VALUES (3,  7, 'pt', 1, 'mySQL in PT', '', '', 0, '', 0, '', '');
-INSERT INTO `ydcmpage` VALUES (4,  9, 'en', 1, 'Our databases', '', '', 0, '', 0, '', '');
-INSERT INTO `ydcmpage` VALUES (5, 10, 'en', 1, 'Generators', '', '', 0, '', 0, '', '');
-INSERT INTO `ydcmpage` VALUES (6, 11, 'all', 1, 'Portals for all', '', '', 0, '', 0, '', '');
-
-INSERT INTO `ydcmrootmenu` VALUES (1, 2, 'all', 'my menu paste');
-INSERT INTO `ydcmrootmenu` VALUES (2, 3, 'en',  'documentation in EN');
-INSERT INTO `ydcmrootmenu` VALUES (3, 4, 'pt',  'PT books menu');
-INSERT INTO `ydcmrootmenu` VALUES (4, 8, 'all', 'links menu');
-
-
-INSERT INTO `ydcmusers` VALUES (2,0,0,0,0,'admin','21232f297a57a5a743894a0e4a801fc3','name','email at test.com','a','en',1,NULL,NULL,7,'2006-04-23 17:02:27','2006-04-23 17:02:34',0,'0000-00-00 00:00:00');
-
-
-



From ximian at berlios.de  Mon May  8 15:21:55 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 15:21:55 +0200
Subject: [ydf-devel] r1915 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200605081321.k48DLtQm008886@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 15:21:06 +0200 (Mon, 08 May 2006)
New Revision: 1915

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
added default cursor style to YDAjax waiting message

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-05-08 11:06:20 UTC (rev 1914)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-05-08 13:21:06 UTC (rev 1915)
@@ -215,6 +215,7 @@
 			if ( !isset( $options['style.width'] ) )           $options['style.width']           = '200px';
 
 			// static values
+			$options['style.cursor']     = "default";
 			$options['style.position']   = "absolute";
 			$options['style.top']        = '40%';
 			$options['style.left']       = '50%';



From ximian at berlios.de  Mon May  8 16:17:51 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:17:51 +0200
Subject: [ydf-devel] r1916 - in YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent: . YDCMLanguages YDCMLanguages/languages YDCMTemplates YDCMTree YDCMUsers YDCMUsers/languages
Message-ID: <200605081417.k48EHpu7015674@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:17:09 +0200 (Mon, 08 May 2006)
New Revision: 1916

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/YDCMLanguages.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/pt.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/pt.php
Log:
deleted YDCM libs that are YDCM core parts and not components

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/YDCMLanguages.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/YDCMLanguages.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/YDCMLanguages.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,102 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+
+    class YDCMLanguages extends YDDatabaseObject {
+
+        function YDCMLanguages() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLanguages' );
+
+            // define custom key
+            $this->registerKey( 'language_id', true );
+
+			// Fields
+			$this->registerField( 'name' );
+			$this->registerField( 'active' );
+			$this->registerField( 'visitors_default' );
+			$this->registerField( 'admin_default' );
+
+			// we don't have relations from here (just TO here, and we don't need to define that)
+		}
+
+
+        /**
+         *  This function returns all active languages
+         *
+         *  @returns    Array of languages, eg: array( 'en' => 'English', 'pt' => ... )
+         */
+		function active(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want only results where active is 1
+			$this->active = 1;
+
+			// find all languages
+			$this->find();
+
+			// return results as array
+			return $this->getResultsAsAssocArray( 'language_id', 'name' );
+		}
+
+
+        /**
+         *  This function returns the default language for content creation
+         *
+         *  @returns    Language code, eg: 'en'. or false
+         */
+		function adminDefault(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want the result where admin default is 1
+			$this->admin_default = 1;
+			$this->limit( 1 );
+			
+			// find language
+			if ( $this->find() == 1 ) return $this->language_id;
+			
+			return false;
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/en.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/en.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,20 @@
+<?php
+
+$GLOBALS['t']['save'] = 'Save';
+$GLOBALS['t']['close'] = 'Close';
+$GLOBALS['t']['open'] = 'Open';
+$GLOBALS['t']['help'] = 'Help';
+$GLOBALS['t']['back'] = 'Back';
+$GLOBALS['t']['not applicable'] = 'Not applicable';
+$GLOBALS['t']['yes'] = 'Yes';
+$GLOBALS['t']['no'] = 'No';
+$GLOBALS['t']['schedule'] = 'Schedule';
+$GLOBALS['t']['delete'] = 'Delete';
+$GLOBALS['t']['toggle state'] = 'Toggle state';
+$GLOBALS['t']['public'] = 'Public';
+$GLOBALS['t']['private'] = 'Private';
+$GLOBALS['t']['not allowed'] = 'Not allowed';
+
+$GLOBALS['t']['add page'] = 'Add page';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/pt.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/languages/pt.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,20 @@
+<?php
+
+$GLOBALS['t']['save'] = 'Guardar';
+$GLOBALS['t']['close'] = 'Fechar';
+$GLOBALS['t']['open'] = 'Abrir';
+$GLOBALS['t']['help'] = 'Ajuda';
+$GLOBALS['t']['back'] = 'Voltar';
+$GLOBALS['t']['not applicable'] = 'N&atilde;o aplic&aacute;vel';
+$GLOBALS['t']['yes'] = 'Sim';
+$GLOBALS['t']['no'] = 'N&atilde;o';
+$GLOBALS['t']['schedule'] = 'Calend&aacute;rio';
+$GLOBALS['t']['delete'] = 'Eliminar';
+$GLOBALS['t']['toggle state'] = 'Inverter estado';
+$GLOBALS['t']['public'] = 'P&uacute;blico';
+$GLOBALS['t']['private'] = 'Privado';
+$GLOBALS['t']['not allowed'] = 'N&atilde;o permitido';
+
+$GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/YDCMTemplates.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/YDCMTemplates.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,160 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// set admin template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', YD_SELF_DIR, false );
+
+	// set admin template name
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_TEMPLATE', '', false );
+
+	// set visitors template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_PATH', YD_SELF_DIR, false );
+
+	// set visitors template name
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_TEMPLATE', '', false );
+
+	// set template pack ( a pH technology )
+	YDConfig::set( 'YDCMTEMPLATES_PACK', false, false );
+
+
+	// this is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
+    class YDCMTemplates {
+
+        function YDCMTemplates() {
+        
+			$this->admin_path        = YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' );
+			$this->admin_template    = YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' );
+			$this->visitors_path     = YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' );
+			$this->visitors_template = YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' );
+			$this->template_pack     = YDConfig::get( 'YDCMTEMPLATES_PACK' );
+		}
+
+
+        /**
+         *  This function returns all possible templates for administration side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function admin_templates(){
+		
+			return $this->__getFiles( $this->admin_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function admin_template(){
+		
+			return $this->admin_template;
+		}
+
+
+        /**
+         *  This function return the full template path of administration side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function admin_complete( $subdir = '' ){
+		
+			return $this->admin_path . '/' . $this->admin_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This function return the template pack
+         *
+         *  @returns    full path
+         */
+		function template_pack(){
+		
+			return $this->template_pack;
+		}
+
+
+        /**
+         *  This function returns all possible templates for visitors side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function visitors_templates(){
+		
+			return $this->__getFiles( $this->visitors_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function visitors_template(){
+		
+			return $this->visitors_template;
+		}
+
+
+        /**
+         *  This function return the full template path of visitors side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function visitors_complete( $subdir = '' ){
+		
+			return $this->visitors_path . '/' . $this->visitors_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This private function returns all filenames of a directory
+         *
+         *  @returns    Array of filenames, eg: array( 'default' => 'Default', 'orange' => ... )
+         */
+		function __getFiles( $dir ){
+		
+			// init directories
+			$directories = array();
+
+			// init template directory
+			$dir = new YDFSDirectory( $dir );
+			
+			// compute directories array
+			foreach( $dir->getContents( '!.*', '', 'YDFSDirectory' ) as $d )
+				$directories[ $d ] = $d;
+
+			return $directories;
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/YDCMTree.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/YDCMTree.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,90 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMTree extends YDDatabaseObject {
+    
+        function YDCMTree() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMTree' );
+
+            // register custom key
+            $this->registerKey( 'content_id', true );
+
+			// register fields	
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'type' );
+			$this->registerField( 'state' );
+			$this->registerField( 'reference' );
+			$this->registerField( 'access' );			
+			$this->registerField( 'searcheable' );			
+			$this->registerField( 'published_date_start' );
+			$this->registerField( 'published_date_end' );			
+			$this->registerField( 'candrag' );
+			$this->registerField( 'candrop' );
+		}
+
+
+        /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node information
+         */
+		function getDragDropElements( $x, $y ){
+		
+			// check if elements are numeric
+			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
+		
+			// reset old values and get current table	
+			$this->resetValues();
+
+			// set custom where to get those 2 elements
+			$this->where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
+
+			// we must get always 2 elements otherwise they were not valid
+			if ( $this->find() != 2 ) return false;
+
+			// return associative array
+			return $this->getResultsAsAssocArray( 'content_id' );
+		}
+
+
+	}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/YDCMUsers.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/YDCMUsers.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,387 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+	// set user form name
+	YDConfig::set( 'YDCMUSERS_FORMUSER', 'YDCMUsersForm', false );
+
+	// set password form name
+	YDConfig::set( 'YDCMUSERS_FORMPASSWORD', 'YDCMUsersFormPassword', false );
+
+
+    class YDCMUsers extends YDDatabaseObject {
+    
+        function YDCMUsers() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUsers' );
+
+            // register custom key
+            $this->registerKey( 'user_id', true );
+
+			// register custom fields
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'nleft' );
+			$this->registerField( 'nright' );
+			$this->registerField( 'nlevel' );
+			$this->registerField( 'username' );
+			$this->registerField( 'password' );
+			$this->registerField( 'name' );
+			$this->registerField( 'email' );			
+			$this->registerField( 'other' );			
+			$this->registerField( 'language_id' );
+			$this->registerField( 'state' );			
+			$this->registerField( 'login_start' );
+			$this->registerField( 'login_end' );
+			$this->registerField( 'login_counter' );			
+			$this->registerField( 'login_last' );
+			$this->registerField( 'login_current' );
+			$this->registerField( 'created_user' );
+			$this->registerField( 'created_date' );
+
+			// custom relations
+            $relLocks = & $this->registerRelation( 'YDCMLocks', false, 'YDCMLocks' );
+			$relLocks->setLocalKey( 'user_id' );
+            $relLocks->setForeignKey( 'user_id' );
+			$relLocks->setForeignJoin( 'LEFT' );
+			
+            $relLanguages = & $this->registerRelation( 'YDCMLanguages', false, 'YDCMLanguages' );
+			$relLanguages->setLocalKey( 'language_id' );
+            $relLanguages->setForeignKey( 'language_id' );
+
+			// setup tree (NOT USED YET)
+			$this->tree = new YDDatabaseTree( 'default', 'YDCMUsers', 'content_id', 'parent_id', 'parent_id' );
+		}
+
+
+        /**
+         *  This function returns the id of the current user
+         *
+         *  @returns    User id if user exists, false otherwise
+         */
+		function currentID(){
+		
+			// reset user values
+			$this->resetValues();
+		
+			// check if user is valid and get user id ( YDCMUsers::valid does it )
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			// if user is not valid we should return false
+			if ( $valid === false ) return false;
+
+			// return user id found
+			return $this->user_id;
+		}
+
+        /**
+         *  This function checks if a username and password are valid
+         *
+         *  @param $username  User username
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it)
+         *
+         *  @returns    true if valid, false otherwise
+         */
+		function valid( $username = '', $password = '' ){
+
+			// teste username and password rules
+			if (!YDValidateRules::alphanumeric(	$username))			return false;
+			if (!YDValidateRules::maxlength(	$username, 100))	return false;
+			if (!YDValidateRules::alphanumeric(	$password))			return false;
+			if (!YDValidateRules::maxlength(	$password, 32))		return false;
+
+			// reset values
+			$this->resetValues();
+
+			// set username
+			$this->username = $username;
+
+			// if password is not in md5 format we must set it
+			if ( strlen( $password ) != 32 ) $password = md5( $password );
+
+			// set password
+			$this->password = $password;
+			
+			// check user state based on state and/or user login schedule
+			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
+
+			// test if we get just one user
+			if ( $this->find() == 1 ) return true;
+
+			return false;
+		}
+		
+		
+        /**
+         *  This function updates the current user attributes (ignoring passwords and statistics)
+         *
+         *  @param $values  User attributes as array
+         *
+         *  @returns    true if updated, false if current user is not valid
+         */
+		function changeCurrentUser( $values ){
+		
+			$this->resetValues();
+
+			// check if user is valid
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			if ( $valid === false ) return false;
+
+			// reset values added from valid method
+			$this->resetValues();
+
+			// set new values
+			$this->name        = $values['name'];
+			$this->email       = $values['email'];
+			$this->other       = $values['other'];
+			$this->language_id = $values['language_id'];
+			$this->template    = $values['template'];
+
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+
+
+        /**
+         *  This function updates the current user attributes (ignoring passwords and statistics) using form values
+         *
+         *  @param $formvalues  Array with user attributes
+         *
+         *  @returns    true if updated, array with form errors otherwise
+         */
+		function changeCurrentUserForm( $formvalues = array() ){
+
+			// get user YDForm object
+			$form = $this->getFormUser();
+
+			// check form validation
+			if ( !$form->validate( $formvalues ) )
+				return $form->getErrors();
+
+			return $this->changeCurrentUser( $form->getValues() );
+		}
+		
+
+        /**
+         *  This function return the user form
+         *
+         *  @returns    form object
+         */
+		function getFormUser(){
+
+			// include languages and templates lib
+			YDInclude( 'YDCMLanguages.php' );
+			YDInclude( 'YDCMTemplates.php' );
+
+			// create languages and templates object
+			$languages = new YDCMLanguages();
+			$templates = new YDCMTemplates();
+
+			// create form object
+            $form = new YDForm( YDConfig::get( 'YDCMUSERS_FORMUSER' ) );
+
+	        $form->addElement( 'span',      'username',     t('user_username') );
+            $form->addElement( 'text',      'name',         t('user_name'),     array('size' => 50, 'maxlength' => 255) );
+            $form->addElement( 'text',      'email',        t('user_email') );
+            $form->addElement( 'textarea',  'other',        t('user_other'),    array('rows' => 4, 'cols' => 30) );
+            $form->addElement( 'select',    'language_id',  t('user_language'), array(), $languages->active() );
+            $form->addElement( 'select',    'template',     t('user_template'), array(), $templates->admin_templates() );
+            $form->addElement( 'span',      'login_start',  t('login_start') );
+            $form->addElement( 'span',      'login_end',    t('login_end') );
+            $form->addElement( 'span',      'login_counter',t('login_counter') );
+            $form->addElement( 'span',      'login_last',   t('login_last') );
+            $form->addElement( 'span',      'login_current',t('login_current') );
+            $form->addElement( 'span',      'created_user', t('created_user') );
+            $form->addElement( 'span',      'created_date', t('created_date') );
+
+			// add rules
+			$form->addRule( 'name',        'maxlength', t('name too big'),       255 );
+			$form->addRule( 'email',       'email',     t('email not valid') );
+			$form->addRule( 'other',       'maxlength', t('other too big'),      5000 );
+			$form->addRule( 'language_id', 'in_array',  t('language not valid'), array_keys( $languages->active() ) );
+			$form->addRule( 'template',    'in_array',  t('template not valid'), array_keys( $templates->admin_templates() ) );
+
+			return $form;
+		}
+
+
+        /**
+         *  This function updates the current user password
+         *
+         *  @param $oldpassword  Old user password
+         *  @param $newpassword  New password
+         *
+         *  @returns    true if updated, false when old password is incorrect or user is invalid
+         */
+		function changeCurrentUserPassword( $oldpassword = '', $newpassword = '' ){
+		
+			$this->resetValues();
+
+			// check if user is valid
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			if ( $valid === false ) return false;
+
+			// reset values added from valid method
+			$this->resetValues();
+
+			// set new password
+			$this->password = md5( $newpassword );
+
+			// change only current user
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+			$this->where( 'password = "' . md5( $oldpassword )            . '"' );
+
+			// update user and get result
+			if ( $this->update() == 1 ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This function updates the current user password using form values
+         *
+         *  @param $formvalues  Array with 3 passwords (old, new and new_confirm)
+         *
+         *  @returns    true if updated, array with form errors, 0 if old password is incorrect
+         */
+		function changeCurrentUserPasswordForm( $formvalues = array() ){
+
+			// get password form
+			$form = $this->getFormPassword();
+
+			// check form validation
+			if ( !$form->validate( $formvalues ) )
+				return $form->getErrors();
+
+			return $this->changeCurrentUserPassword( $form->getValue( 'old' ), $form->getValue( 'new' ) );
+		}
+
+
+        /**
+         *  This function return the form of password changing
+         *
+         *  @returns    form object
+         */
+		function getFormPassword(){
+
+			// create form object
+            $form = new YDForm( YDConfig::get( 'YDCMUSERS_FORMPASSWORD' ) );
+
+			// add form elements
+            $form->addElement( 'password', 'old',         t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+            $form->addElement( 'password', 'new',         t('password_new'),         array('size' => 30, 'maxlength' => 31) );
+            $form->addElement( 'password', 'new_confirm', t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+
+			// add rules
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'required',     t('passwords are required') );
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'maxlength',    t('passwords too big'), 31 );
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'alphanumeric', t('passwords not alphanumeric') );
+
+			// add compare rule
+			$form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			return $form;
+		}
+
+
+        /**
+         *  This function return the current user attributes
+         *
+         *  @returns    current user id
+         */
+		function getCurrentUser(){
+		
+			$this->resetValues();
+			
+			// get current user id
+			$this->user_id = $this->currentID();
+			
+			// get all attributes
+			$this->find();
+
+			// return values
+			return $this->getValues();
+		}
+
+
+        /**
+         *  This function updates user login details
+         *
+         *  @returns    true if user login details updated, false user is not valid or details not updated
+         */
+		function updateLogin(){
+
+			YDInclude( 'YDUtil.php' );
+
+			$this->resetValues();
+			
+			// get current user id
+			$res = $this->currentID();
+			
+			if ( $res == false ) return false;
+			
+			// get all attributes
+			$this->find();
+
+			// increase login value
+			$this->login_counter ++;
+
+			// set last login date
+			$this->login_last = $this->login_current;
+
+			// set current login
+			$this->login_current = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+
+		
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/en.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/en.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,48 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_name'] = 'Name';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Other';
+$GLOBALS['t']['user_language'] = 'Language';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_start'] = 'Login start date';
+$GLOBALS['t']['login_end'] = 'Login end date';
+$GLOBALS['t']['login_counter'] = 'Total of logins';
+$GLOBALS['t']['login_last'] = 'Last login date';
+$GLOBALS['t']['login_current'] = 'Current login date';
+$GLOBALS['t']['created_user'] = 'Created by';
+$GLOBALS['t']['created_date'] = 'Created in';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'Name is too big';
+$GLOBALS['t']['email not valid'] = 'Email is not valid';
+$GLOBALS['t']['other too big'] = 'Other informations about the user are to big';
+$GLOBALS['t']['language not valid'] = 'Language is not valid';
+$GLOBALS['t']['template not valid'] = 'Template is not valid';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Current password';
+$GLOBALS['t']['password_new'] = 'New password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirm new password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'All passwords are required';
+$GLOBALS['t']['passwords dont match'] = 'Passwords do not match';
+$GLOBALS['t']['passwords too big'] = 'There is at least one password too big';
+$GLOBALS['t']['passwords not alphanumeric'] = 'All passwords must be alphanumeric';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Change password';
+$GLOBALS['t']['personal info'] = 'Personal informations';
+$GLOBALS['t']['access'] = 'Access';
+$GLOBALS['t']['old password is incorrect'] = 'Current password is incorrect';
+$GLOBALS['t']['user password updated'] = 'Password is updated';
+$GLOBALS['t']['user is incorrect'] = 'Current user is not valid';
+$GLOBALS['t']['user details updated'] = 'User details updated';
+$GLOBALS['t']['password not updated'] = 'Password was not updated';
+$GLOBALS['t']['user not updated'] = 'User was not updated';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/pt.php	2006-05-08 13:21:06 UTC (rev 1915)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/languages/pt.php	2006-05-08 14:17:09 UTC (rev 1916)
@@ -0,0 +1,48 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_name'] = 'Nome';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Outras informa&ccedil;oes';
+$GLOBALS['t']['user_language'] = 'Idioma';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_start'] = 'Data para inicio de login';
+$GLOBALS['t']['login_end'] = 'Data em que o login expira';
+$GLOBALS['t']['login_counter'] = 'Total de logins';
+$GLOBALS['t']['login_last'] = 'Data do &uacute;ltimo login';
+$GLOBALS['t']['login_current'] = 'Data do login actual';
+$GLOBALS['t']['created_user'] = 'Criado por';
+$GLOBALS['t']['created_date'] = 'Criado em';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'O nome &eacute; demasiado grande';
+$GLOBALS['t']['email not valid'] = 'O email n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['other too big'] = 'As informa&ccedil;&otilde;es adicionais s&atilde;o demasiado grandes';
+$GLOBALS['t']['language not valid'] = 'O idioma n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['template not valid'] = 'O template n&atilde;o &eacute; v&aacute;lido';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Password actual';
+$GLOBALS['t']['password_new'] = 'Nova password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirme a nova password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'Todas as passwords s&atilde;o obrigat&oacute;rias';
+$GLOBALS['t']['passwords dont match'] = 'As passwords n&atilde;o s&atilde;o iguais';
+$GLOBALS['t']['passwords too big'] = 'Existe pelo menos uma password demasiado grande';
+$GLOBALS['t']['passwords not alphanumeric'] = 'As password t&ecirc;em de ser alfanum&eacute;ricas';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Modificar a password';
+$GLOBALS['t']['personal info'] = 'Configura&ccedil;&otilde;es pessoais';
+$GLOBALS['t']['access'] = 'Acesso';
+$GLOBALS['t']['old password is incorrect'] = 'A password actual &eacute; incorrecta';
+$GLOBALS['t']['user password updated'] = 'A password foi actualizada';
+$GLOBALS['t']['user is incorrect'] = 'O utilizador actual &eacute; incorrecto';
+$GLOBALS['t']['user details updated'] = 'Informa&ccedil;&otilde;es do utilizador actualizadas';
+$GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
+$GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
+
+?>
\ No newline at end of file



From ximian at berlios.de  Mon May  8 16:20:25 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:20:25 +0200
Subject: [ydf-devel] r1918 - YDFramework2.0/trunk/YDFramework2/addons
Message-ID: <200605081420.k48EKPCn015857@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:20:06 +0200 (Mon, 08 May 2006)
New Revision: 1918

Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMUsers/
Log:
deleted YDCMUsers part



From ximian at berlios.de  Mon May  8 16:19:33 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:19:33 +0200
Subject: [ydf-devel] r1917 - YDFramework2.0/trunk/YDFramework2/addons
Message-ID: <200605081419.k48EJXF5015790@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:19:16 +0200 (Mon, 08 May 2006)
New Revision: 1917

Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMTemplates/
Log:
deleted YDCMTemplate part



From ximian at berlios.de  Mon May  8 16:24:16 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:24:16 +0200
Subject: [ydf-devel] r1919 - YDFramework2.0/trunk/YDFramework2/addons
Message-ID: <200605081424.k48EOGvw016943@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:23:56 +0200 (Mon, 08 May 2006)
New Revision: 1919

Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLanguages/
Log:
deleted YDCMLanguages part



From ximian at berlios.de  Mon May  8 16:25:31 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:25:31 +0200
Subject: [ydf-devel] r1920 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent
Message-ID: <200605081425.k48EPVOP017048@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:25:01 +0200 (Mon, 08 May 2006)
New Revision: 1920

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
updated YDCMComponent for new structure and db scheme

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-08 14:23:56 UTC (rev 1919)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-08 14:25:01 UTC (rev 1920)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="40.00" XPos="50" YPos="48" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="75.00" XPos="73" YPos="123" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -1096,9 +1096,9 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1460" YPos="1010" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
-<COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement post id">
+<COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
@@ -1114,17 +1114,17 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1543" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="post user name">
+<COLUMN ID="1543" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster username">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1544" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="email of poster">
+<COLUMN ID="1544" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster email">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1545" ColName="message" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1545" ColName="message" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -1134,6 +1134,16 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1663" ColName="website" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1664" ColName="ip" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(15)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <RELATIONS_END>
 <RELATION_END ID="1547" />
@@ -1252,11 +1262,11 @@
 <RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1413" RelationName="urgency_id" Kind="2" SrcTable="1393" DestTable="1367" FKFields="urgency_id=urgency_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-4" CaptionOffsetY="3" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="26" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="49" CaptionOffsetY="-27" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
+<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="49" CaptionOffsetY="-12" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
 <RELATION ID="1527" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1519" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="18" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="33" />
 <RELATION ID="1535" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1528" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="60" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="-4" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="35" />
 <RELATION ID="1536" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1528" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="28" CaptionOffsetY="-48" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
-<RELATION ID="1547" RelationName="component_id" Kind="2" SrcTable="1528" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="58" CaptionOffsetY="-33" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+<RELATION ID="1547" RelationName="component_id" Kind="2" SrcTable="1528" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="51" CaptionOffsetY="-43" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
 <RELATION ID="1572" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1565" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="73" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="10" EndIntervalOffsetY="4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
 <RELATION ID="1573" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1565" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="109" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="3" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
 <RELATION ID="1575" RelationName="component_id" Kind="2" SrcTable="1565" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="51" CaptionOffsetY="-40" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:23:56 UTC (rev 1919)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:25:01 UTC (rev 1920)
@@ -26,9 +26,17 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+	// include YDF libs
     YDInclude( 'YDDatabaseObject.php' );
+	YDInclude( 'YDDatabaseTree.php' );
 
+	// include core YDCM libs
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMUsers/YDCMUsers.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTree/YDCMTree.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTemplates/YDCMTemplates.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLanguages/YDCMLanguages.php' );
 
+
     class YDCMComponent extends YDDatabaseObject {
 
         function YDCMComponent( $name, $standardComponent = true ) {
@@ -238,67 +246,4 @@
 
     }
 
-
-
-
-    class YDCMTree extends YDDatabaseObject {
-    
-        function YDCMTree() {
-        
-			// init component as non default
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMTree' );
-
-            // register custom key
-            $this->registerKey( 'content_id', true );
-
-			// register fields	
-			$this->registerField( 'parent_id' );
-			$this->registerField( 'type' );
-			$this->registerField( 'state' );
-			$this->registerField( 'reference' );
-			$this->registerField( 'access' );			
-			$this->registerField( 'searcheable' );			
-			$this->registerField( 'published_date_start' );
-			$this->registerField( 'published_date_end' );			
-			$this->registerField( 'candrag' );
-			$this->registerField( 'candrop' );
-		}
-
-
-        /**
-         *  This function checks if elements are valid drag&dropable
-         *
-         *  @param $x  Id of dragable node
-         *
-         *  @param $y  Id of dropable node
-
-         *  @returns    false if elements are invalid, an associative array with node information
-         */
-		function getDragDropElements( $x, $y ){
-		
-			// check if elements are numeric
-			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
-		
-			// reset old values and get current table	
-			$this->resetValues();
-
-			// set custom where to get those 2 elements
-			$this->where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
-
-			// we must get always 2 elements otherwise they were not valid
-			if ( $this->find() != 2 ) return false;
-
-			// return associative array
-			return $this->getResultsAsAssocArray( 'content_id' );
-		}
-
-
-	}
-
 ?>
\ No newline at end of file



From ximian at berlios.de  Mon May  8 16:28:40 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:28:40 +0200
Subject: [ydf-devel] r1921 - in YDFramework2.0/trunk/YDFramework2/addons: YDCMHelpdesk YDCMLink YDCMPage YDCMRootmenu
Message-ID: <200605081428.k48ESeAl017398@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:28:05 +0200 (Mon, 08 May 2006)
New Revision: 1921

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMRootmenu/YDCMRootmenu.php
Log:
some YDCM addons updates and new YDCMHelpdesk version

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-08 14:25:01 UTC (rev 1920)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-08 14:28:05 UTC (rev 1921)
@@ -26,6 +26,16 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+
+	YDInclude( 'YDForm.php' );
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+	// set posts form name
+	YDConfig::set( 'YDCMHELPDESK_FORMPOST', 'YDCMHelpdeskFormPost', false );
+
+
     class YDCMHelpdesk extends YDCMComponent {
     
         function YDCMHelpdesk() {
@@ -157,6 +167,46 @@
 		}
 
 
+		function getFormPost(){
+		
+			// create a form for new posts
+            $form = new YDForm( YDConfig::get( 'YDCMHELPDESK_FORMPOST' ) );
+
+			// get urgencies
+			$urgencies = new YDCMHelpdesk_urgency();
+			$urgencies = $urgencies->getUrgencies();
+			
+			// get states
+			$states    = new YDCMHelpdesk_state();
+			$states    = $states->getStates();
+
+			// get types
+			$types     = new YDCMHelpdesk_type();
+			$types     = $types->getTypes();
+
+			// add new form elements
+            $form->addElement( 'text',			'subject',			 t('ticket_subject'),           array('size' => 50) );
+            $form->addElement( 'select', 		'urgency_id',		 t('ticket_urgency_id'),        array(), $urgencies );
+            $form->addElement( 'select',		'state_id',			 t('ticket_state_id'),          array(), $states );
+            $form->addElement( 'textarea',		'text',              t('ticket_text'),              array('cols' => 60, 'rows' => 12) );
+
+            $form->addElement( 'span',			'creation_user',	 t('ticket_creation_user') );
+            $form->addElement( 'datetimeselect','creation_date',     t('ticket_creation_date') );
+
+            $form->addElement( 'span',			'reported_by_user',	 t('ticket_reported_by_user'),  array('size' => 50) );
+            $form->addElement( 'select', 		'reported_by_type',	 t('ticket_reported_by_type'),  array(), $types );
+            $form->addElement( 'text',			'reported_by_local', t('ticket_reported_by_local') );
+            $form->addElement( 'datetimeselect','reported_by_date',	 t('ticket_reported_by_date') );
+  
+            $form->addElement( 'span',          'assignedto_user',	 t('ticket_assignedto_user') );
+            $form->addElement( 'text',			'assignedto_type',	 t('ticket_assignedto_type'),   array('size' => 50) );
+            $form->addElement( 'select', 		'assignedto_local',	 t('ticket_assignedto_local'),  array(), $types );
+            $form->addElement( 'text',			'assignedto_date',   t('ticket_assignedto_date') );
+		
+			return $form;
+		}
+
+
 		function addPost( $helpdesk_id, $user_id, $values ){
 		
 			$this->resetValues();
@@ -300,7 +350,24 @@
 		}
 
 
+		function getUrgencies(){
+		
+			$this->resetValues();
+			
+			// find all urgencies
+			$this->find();
 
+			// get associative array
+			$res = $this->getResultsAsAssocArray( 'urgency_id' );
+
+			// translate urgency description
+			foreach( $res as $id => $arr )
+				$res[ $id ][ 'description'] = t( $res[ $id ][ 'description'] );
+
+			// return urgencies
+			return $res;
+		}
+
 	}	
 
 
@@ -338,6 +405,25 @@
 		}
 
 
+		function getStates(){
+		
+			$this->resetValues();
+			
+			// find all states
+			$this->find();
+
+			// get associative array
+			$res = $this->getResultsAsAssocArray( 'state_id' );
+
+			// translate state description
+			foreach( $res as $id => $arr )
+				$res[ $id ][ 'description'] = t( $res[ $id ][ 'description'] );
+
+			// return urgencies
+			return $res;
+		}
+
+
 	}	
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php	2006-05-08 14:25:01 UTC (rev 1920)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php	2006-05-08 14:28:05 UTC (rev 1921)
@@ -26,6 +26,9 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+	YDInclude( 'YDCMComponent.php' );
+
+
     class YDCMLink extends YDCMComponent {
     
         function YDCMLink() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-08 14:25:01 UTC (rev 1920)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-08 14:28:05 UTC (rev 1921)
@@ -26,6 +26,8 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+	YDInclude( 'YDCMComponent.php' );
+
 	// add local translation directory
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
 
@@ -68,8 +70,6 @@
 		function getFormPage(){
 		
 			YDInclude( 'YDForm.php' );
-			YDInclude( 'YDCMTemplates.php' );
-			YDInclude( 'YDCMLanguages.php' );
 
 			// init template and language object
 			$templates = new YDCMTemplates();

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMRootmenu/YDCMRootmenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMRootmenu/YDCMRootmenu.php	2006-05-08 14:25:01 UTC (rev 1920)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMRootmenu/YDCMRootmenu.php	2006-05-08 14:28:05 UTC (rev 1921)
@@ -26,6 +26,9 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+	YDInclude( 'YDCMComponent.php' );
+
+
     class YDCMRootmenu extends YDCMComponent {
     
         function YDCMRootmenu() {



From ximian at berlios.de  Mon May  8 16:33:55 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:33:55 +0200
Subject: [ydf-devel] r1922 - in YDFramework2.0/trunk/YDFramework2: YDClasses YDClasses/YDCMComponent YDClasses/YDCMComponent/YDCMLocks addons
Message-ID: <200605081433.k48EXtWJ017746@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:33:20 +0200 (Mon, 08 May 2006)
New Revision: 1922

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/YDCMLocks.php
Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLocks/
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
Log:
moved YDCMLocks to YDCMComponent core

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/YDCMLocks.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/YDCMLocks.php	2006-05-08 14:28:05 UTC (rev 1921)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/YDCMLocks.php	2006-05-08 14:33:20 UTC (rev 1922)
@@ -0,0 +1,58 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMLocks extends YDDatabaseObject {
+    
+        function YDCMLocks() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLocks' );
+
+            // register custom fields
+			$this->registerField( 'content_id' );
+			$this->registerField( 'user_id' );
+
+			// register custom relations
+            $relTree = & $this->registerRelation( 'YDCMTree', false, 'YDCMTree' );
+			$relTree->setLocalKey( 'content_id' );
+            $relTree->setForeignKey( 'content_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:28:05 UTC (rev 1921)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:33:20 UTC (rev 1922)
@@ -33,6 +33,7 @@
 	// include core YDCM libs
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMUsers/YDCMUsers.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTree/YDCMTree.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLocks/YDCMLocks.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTemplates/YDCMTemplates.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLanguages/YDCMLanguages.php' );
 



From ximian at berlios.de  Mon May  8 16:48:15 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 8 May 2006 16:48:15 +0200
Subject: [ydf-devel] r1923 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent YDCMComponent/YDCMAudit
Message-ID: <200605081448.k48EmFxt018705@sheep.berlios.de>

Author: ximian
Date: 2006-05-08 16:47:48 +0200 (Mon, 08 May 2006)
New Revision: 1923

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/YDCMAudit.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
Log:
added initial YDCMAudit draft to YDCMComponent core

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/YDCMAudit.php	2006-05-08 14:33:20 UTC (rev 1922)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/YDCMAudit.php	2006-05-08 14:47:48 UTC (rev 1923)
@@ -0,0 +1,60 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMAudit extends YDDatabaseObject {
+    
+        function YDCMAudit() {
+        
+			// init database object
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMAudit' );
+
+            // register custom key
+            $this->registerKey( 'audit_id', true );
+
+            // register custom fields
+			$this->registerField( 'user_id' );
+			$this->registerField( 'date' );
+			$this->registerField( 'object' );
+			$this->registerField( 'object_action' );
+			$this->registerField( 'object_id' );
+
+			// register custom relation
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:33:20 UTC (rev 1922)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:47:48 UTC (rev 1923)
@@ -34,6 +34,7 @@
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMUsers/YDCMUsers.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTree/YDCMTree.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLocks/YDCMLocks.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMAudit/YDCMAudit.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTemplates/YDCMTemplates.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLanguages/YDCMLanguages.php' );
 



From francisco at fusemail.com  Mon May  8 18:23:28 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 08 May 2006 17:23:28 +0100
Subject: [ydf-devel] Propose for YDCM development
Message-ID: <445F7080.3050406@fusemail.com>

Hi all

Currently, we have a good start draft about Content Management components.

We have a master component class that involves logic about:
- content tree management
- user management
- content locking (to control multi-edition)
- language management
- auditing (to store user actions)

and we have some initial component structures:
- pages
- rootmenus
- links
- guestbook

After some time analysing the weblog db scheme i think we have already a 
good start to porting. The weblog structure can be (easily, i think) be 
converted to use all the power of the YDCM.

As you can see, the structure is identical:

- 'categories' are 'rootmenus'
   these are elements with just a title that can have any caind of child

- 'comments' are a part of a guestbook
    basically we can convert this making a guestbook node that
    has a page as parent.

- 'items' and 'pages' are identical
   (maybe a merge here?)

- 'links' have a YDCM component created named 'link'
   these are nodes that can be saved as menu children

- 'statistics' have YDCMStatistics_visits correspondence

- 'users' have YDCMUsers correspondence


Well.. open the current DBDesigner file and understand how YDCM is 
structured. In the latest build it's much more clear.


- What's your opinion about that structure?

- What's your opinion about porting some weblog methods to YDCM modules?



regards
Francisco A




From ximian at berlios.de  Tue May  9 11:44:30 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 9 May 2006 11:44:30 +0200
Subject: [ydf-devel] r1924 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent YDCMComponent/languages YDCMComponent/languages/YDCMUsers
Message-ID: <200605090944.k499iUOh030792@sheep.berlios.de>

Author: ximian
Date: 2006-05-09 11:43:55 +0200 (Tue, 09 May 2006)
New Revision: 1924

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers/
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
Log:
big YDCMComponent optimization. 
- instead of including all modules we only define the path to include them only when needed
- new static method to get internal YDCMComponent modules
- generic translations are part of YDCMComponent instead of YDCMLanguages

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMAudit.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,60 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMAudit extends YDDatabaseObject {
+    
+        function YDCMAudit() {
+        
+			// init database object
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMAudit' );
+
+            // register custom key
+            $this->registerKey( 'audit_id', true );
+
+            // register custom fields
+			$this->registerField( 'user_id' );
+			$this->registerField( 'date' );
+			$this->registerField( 'object' );
+			$this->registerField( 'object_action' );
+			$this->registerField( 'object_id' );
+
+			// register custom relation
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLanguages.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,99 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMLanguages extends YDDatabaseObject {
+
+        function YDCMLanguages() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLanguages' );
+
+            // define custom key
+            $this->registerKey( 'language_id', true );
+
+			// Fields
+			$this->registerField( 'name' );
+			$this->registerField( 'active' );
+			$this->registerField( 'visitors_default' );
+			$this->registerField( 'admin_default' );
+
+			// we don't have relations from here (just TO here, and we don't need to define that)
+		}
+
+
+        /**
+         *  This function returns all active languages
+         *
+         *  @returns    Array of languages, eg: array( 'en' => 'English', 'pt' => ... )
+         */
+		function active(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want only results where active is 1
+			$this->active = 1;
+
+			// find all languages
+			$this->find();
+
+			// return results as array
+			return $this->getResultsAsAssocArray( 'language_id', 'name' );
+		}
+
+
+        /**
+         *  This function returns the default language for content creation
+         *
+         *  @returns    Language code, eg: 'en'. or false
+         */
+		function adminDefault(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want the result where admin default is 1
+			$this->admin_default = 1;
+			$this->limit( 1 );
+			
+			// find language
+			if ( $this->find() == 1 ) return $this->language_id;
+			
+			return false;
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMLocks.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,58 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMLocks extends YDDatabaseObject {
+    
+        function YDCMLocks() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLocks' );
+
+            // register custom fields
+			$this->registerField( 'content_id' );
+			$this->registerField( 'user_id' );
+
+			// register custom relations
+            $relTree = & $this->registerRelation( 'YDCMTree', false, 'YDCMTree' );
+			$relTree->setLocalKey( 'content_id' );
+            $relTree->setForeignKey( 'content_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,160 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// set admin template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', YD_SELF_DIR, false );
+
+	// set admin template name
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_TEMPLATE', '', false );
+
+	// set visitors template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_PATH', YD_SELF_DIR, false );
+
+	// set visitors template name
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_TEMPLATE', '', false );
+
+	// set template pack ( a pH technology )
+	YDConfig::set( 'YDCMTEMPLATES_PACK', false, false );
+
+
+	// this is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
+    class YDCMTemplates {
+
+        function YDCMTemplates() {
+        
+			$this->admin_path        = YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' );
+			$this->admin_template    = YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' );
+			$this->visitors_path     = YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' );
+			$this->visitors_template = YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' );
+			$this->template_pack     = YDConfig::get( 'YDCMTEMPLATES_PACK' );
+		}
+
+
+        /**
+         *  This function returns all possible templates for administration side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function admin_templates(){
+		
+			return $this->__getFiles( $this->admin_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function admin_template(){
+		
+			return $this->admin_template;
+		}
+
+
+        /**
+         *  This function return the full template path of administration side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function admin_complete( $subdir = '' ){
+		
+			return $this->admin_path . '/' . $this->admin_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This function return the template pack
+         *
+         *  @returns    full path
+         */
+		function template_pack(){
+		
+			return $this->template_pack;
+		}
+
+
+        /**
+         *  This function returns all possible templates for visitors side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function visitors_templates(){
+		
+			return $this->__getFiles( $this->visitors_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function visitors_template(){
+		
+			return $this->visitors_template;
+		}
+
+
+        /**
+         *  This function return the full template path of visitors side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function visitors_complete( $subdir = '' ){
+		
+			return $this->visitors_path . '/' . $this->visitors_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This private function returns all filenames of a directory
+         *
+         *  @returns    Array of filenames, eg: array( 'default' => 'Default', 'orange' => ... )
+         */
+		function __getFiles( $dir ){
+		
+			// init directories
+			$directories = array();
+
+			// init template directory
+			$dir = new YDFSDirectory( $dir );
+			
+			// compute directories array
+			foreach( $dir->getContents( '!.*', '', 'YDFSDirectory' ) as $d )
+				$directories[ $d ] = $d;
+
+			return $directories;
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,90 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMTree extends YDDatabaseObject {
+    
+        function YDCMTree() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMTree' );
+
+            // register custom key
+            $this->registerKey( 'content_id', true );
+
+			// register fields	
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'type' );
+			$this->registerField( 'state' );
+			$this->registerField( 'reference' );
+			$this->registerField( 'access' );			
+			$this->registerField( 'searcheable' );			
+			$this->registerField( 'published_date_start' );
+			$this->registerField( 'published_date_end' );			
+			$this->registerField( 'candrag' );
+			$this->registerField( 'candrop' );
+		}
+
+
+        /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node information
+         */
+		function getDragDropElements( $x, $y ){
+		
+			// check if elements are numeric
+			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
+		
+			// reset old values and get current table	
+			$this->resetValues();
+
+			// set custom where to get those 2 elements
+			$this->where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
+
+			// we must get always 2 elements otherwise they were not valid
+			if ( $this->find() != 2 ) return false;
+
+			// return associative array
+			return $this->getResultsAsAssocArray( 'content_id' );
+		}
+
+
+	}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,387 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
+
+	// set user form name
+	YDConfig::set( 'YDCMUSERS_FORMUSER', 'YDCMUsersForm', false );
+
+	// set password form name
+	YDConfig::set( 'YDCMUSERS_FORMPASSWORD', 'YDCMUsersFormPassword', false );
+
+
+    class YDCMUsers extends YDDatabaseObject {
+    
+        function YDCMUsers() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUsers' );
+
+            // register custom key
+            $this->registerKey( 'user_id', true );
+
+			// register custom fields
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'nleft' );
+			$this->registerField( 'nright' );
+			$this->registerField( 'nlevel' );
+			$this->registerField( 'username' );
+			$this->registerField( 'password' );
+			$this->registerField( 'name' );
+			$this->registerField( 'email' );			
+			$this->registerField( 'other' );			
+			$this->registerField( 'language_id' );
+			$this->registerField( 'state' );			
+			$this->registerField( 'login_start' );
+			$this->registerField( 'login_end' );
+			$this->registerField( 'login_counter' );			
+			$this->registerField( 'login_last' );
+			$this->registerField( 'login_current' );
+			$this->registerField( 'created_user' );
+			$this->registerField( 'created_date' );
+
+			// custom relations
+            $relLocks = & $this->registerRelation( 'YDCMLocks', false, 'YDCMLocks' );
+			$relLocks->setLocalKey( 'user_id' );
+            $relLocks->setForeignKey( 'user_id' );
+			$relLocks->setForeignJoin( 'LEFT' );
+			
+            $relLanguages = & $this->registerRelation( 'YDCMLanguages', false, 'YDCMLanguages' );
+			$relLanguages->setLocalKey( 'language_id' );
+            $relLanguages->setForeignKey( 'language_id' );
+
+			// setup tree (NOT USED YET)
+			$this->tree = new YDDatabaseTree( 'default', 'YDCMUsers', 'content_id', 'parent_id', 'parent_id' );
+		}
+
+
+        /**
+         *  This function returns the id of the current user
+         *
+         *  @returns    User id if user exists, false otherwise
+         */
+		function currentID(){
+		
+			// reset user values
+			$this->resetValues();
+		
+			// check if user is valid and get user id ( YDCMUsers::valid does it )
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			// if user is not valid we should return false
+			if ( $valid === false ) return false;
+
+			// return user id found
+			return $this->user_id;
+		}
+
+        /**
+         *  This function checks if a username and password are valid
+         *
+         *  @param $username  User username
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it)
+         *
+         *  @returns    true if valid, false otherwise
+         */
+		function valid( $username = '', $password = '' ){
+
+			// teste username and password rules
+			if (!YDValidateRules::alphanumeric(	$username))			return false;
+			if (!YDValidateRules::maxlength(	$username, 100))	return false;
+			if (!YDValidateRules::alphanumeric(	$password))			return false;
+			if (!YDValidateRules::maxlength(	$password, 32))		return false;
+
+			// reset values
+			$this->resetValues();
+
+			// set username
+			$this->username = $username;
+
+			// if password is not in md5 format we must set it
+			if ( strlen( $password ) != 32 ) $password = md5( $password );
+
+			// set password
+			$this->password = $password;
+			
+			// check user state based on state and/or user login schedule
+			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
+
+			// test if we get just one user
+			if ( $this->find() == 1 ) return true;
+
+			return false;
+		}
+		
+		
+        /**
+         *  This function updates the current user attributes (ignoring passwords and statistics)
+         *
+         *  @param $values  User attributes as array
+         *
+         *  @returns    true if updated, false if current user is not valid
+         */
+		function changeCurrentUser( $values ){
+		
+			$this->resetValues();
+
+			// check if user is valid
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			if ( $valid === false ) return false;
+
+			// reset values added from valid method
+			$this->resetValues();
+
+			// set new values
+			$this->name        = $values['name'];
+			$this->email       = $values['email'];
+			$this->other       = $values['other'];
+			$this->language_id = $values['language_id'];
+			$this->template    = $values['template'];
+
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+
+
+        /**
+         *  This function updates the current user attributes (ignoring passwords and statistics) using form values
+         *
+         *  @param $formvalues  Array with user attributes
+         *
+         *  @returns    true if updated, array with form errors otherwise
+         */
+		function changeCurrentUserForm( $formvalues = array() ){
+
+			// get user YDForm object
+			$form = $this->getFormUser();
+
+			// check form validation
+			if ( !$form->validate( $formvalues ) )
+				return $form->getErrors();
+
+			return $this->changeCurrentUser( $form->getValues() );
+		}
+		
+
+        /**
+         *  This function return the user form
+         *
+         *  @returns    form object
+         */
+		function getFormUser(){
+
+			// include languages and templates lib
+			YDInclude( 'YDCMLanguages.php' );
+			YDInclude( 'YDCMTemplates.php' );
+
+			// create languages and templates object
+			$languages = new YDCMLanguages();
+			$templates = new YDCMTemplates();
+
+			// create form object
+            $form = new YDForm( YDConfig::get( 'YDCMUSERS_FORMUSER' ) );
+
+	        $form->addElement( 'span',      'username',     t('user_username') );
+            $form->addElement( 'text',      'name',         t('user_name'),     array('size' => 50, 'maxlength' => 255) );
+            $form->addElement( 'text',      'email',        t('user_email') );
+            $form->addElement( 'textarea',  'other',        t('user_other'),    array('rows' => 4, 'cols' => 30) );
+            $form->addElement( 'select',    'language_id',  t('user_language'), array(), $languages->active() );
+            $form->addElement( 'select',    'template',     t('user_template'), array(), $templates->admin_templates() );
+            $form->addElement( 'span',      'login_start',  t('login_start') );
+            $form->addElement( 'span',      'login_end',    t('login_end') );
+            $form->addElement( 'span',      'login_counter',t('login_counter') );
+            $form->addElement( 'span',      'login_last',   t('login_last') );
+            $form->addElement( 'span',      'login_current',t('login_current') );
+            $form->addElement( 'span',      'created_user', t('created_user') );
+            $form->addElement( 'span',      'created_date', t('created_date') );
+
+			// add rules
+			$form->addRule( 'name',        'maxlength', t('name too big'),       255 );
+			$form->addRule( 'email',       'email',     t('email not valid') );
+			$form->addRule( 'other',       'maxlength', t('other too big'),      5000 );
+			$form->addRule( 'language_id', 'in_array',  t('language not valid'), array_keys( $languages->active() ) );
+			$form->addRule( 'template',    'in_array',  t('template not valid'), array_keys( $templates->admin_templates() ) );
+
+			return $form;
+		}
+
+
+        /**
+         *  This function updates the current user password
+         *
+         *  @param $oldpassword  Old user password
+         *  @param $newpassword  New password
+         *
+         *  @returns    true if updated, false when old password is incorrect or user is invalid
+         */
+		function changeCurrentUserPassword( $oldpassword = '', $newpassword = '' ){
+		
+			$this->resetValues();
+
+			// check if user is valid
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			if ( $valid === false ) return false;
+
+			// reset values added from valid method
+			$this->resetValues();
+
+			// set new password
+			$this->password = md5( $newpassword );
+
+			// change only current user
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+			$this->where( 'password = "' . md5( $oldpassword )            . '"' );
+
+			// update user and get result
+			if ( $this->update() == 1 ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This function updates the current user password using form values
+         *
+         *  @param $formvalues  Array with 3 passwords (old, new and new_confirm)
+         *
+         *  @returns    true if updated, array with form errors, 0 if old password is incorrect
+         */
+		function changeCurrentUserPasswordForm( $formvalues = array() ){
+
+			// get password form
+			$form = $this->getFormPassword();
+
+			// check form validation
+			if ( !$form->validate( $formvalues ) )
+				return $form->getErrors();
+
+			return $this->changeCurrentUserPassword( $form->getValue( 'old' ), $form->getValue( 'new' ) );
+		}
+
+
+        /**
+         *  This function return the form of password changing
+         *
+         *  @returns    form object
+         */
+		function getFormPassword(){
+
+			// create form object
+            $form = new YDForm( YDConfig::get( 'YDCMUSERS_FORMPASSWORD' ) );
+
+			// add form elements
+            $form->addElement( 'password', 'old',         t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+            $form->addElement( 'password', 'new',         t('password_new'),         array('size' => 30, 'maxlength' => 31) );
+            $form->addElement( 'password', 'new_confirm', t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+
+			// add rules
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'required',     t('passwords are required') );
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'maxlength',    t('passwords too big'), 31 );
+			$form->addRule( array( 'old', 'new', 'new_confirm' ), 'alphanumeric', t('passwords not alphanumeric') );
+
+			// add compare rule
+			$form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			return $form;
+		}
+
+
+        /**
+         *  This function return the current user attributes
+         *
+         *  @returns    current user id
+         */
+		function getCurrentUser(){
+		
+			$this->resetValues();
+			
+			// get current user id
+			$this->user_id = $this->currentID();
+			
+			// get all attributes
+			$this->find();
+
+			// return values
+			return $this->getValues();
+		}
+
+
+        /**
+         *  This function updates user login details
+         *
+         *  @returns    true if user login details updated, false user is not valid or details not updated
+         */
+		function updateLogin(){
+
+			YDInclude( 'YDUtil.php' );
+
+			$this->resetValues();
+			
+			// get current user id
+			$res = $this->currentID();
+			
+			if ( $res == false ) return false;
+			
+			// get all attributes
+			$this->find();
+
+			// increase login value
+			$this->login_counter ++;
+
+			// set last login date
+			$this->login_last = $this->login_current;
+
+			// set current login
+			$this->login_current = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+
+		
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,48 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_name'] = 'Name';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Other';
+$GLOBALS['t']['user_language'] = 'Language';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_start'] = 'Login start date';
+$GLOBALS['t']['login_end'] = 'Login end date';
+$GLOBALS['t']['login_counter'] = 'Total of logins';
+$GLOBALS['t']['login_last'] = 'Last login date';
+$GLOBALS['t']['login_current'] = 'Current login date';
+$GLOBALS['t']['created_user'] = 'Created by';
+$GLOBALS['t']['created_date'] = 'Created in';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'Name is too big';
+$GLOBALS['t']['email not valid'] = 'Email is not valid';
+$GLOBALS['t']['other too big'] = 'Other informations about the user are to big';
+$GLOBALS['t']['language not valid'] = 'Language is not valid';
+$GLOBALS['t']['template not valid'] = 'Template is not valid';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Current password';
+$GLOBALS['t']['password_new'] = 'New password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirm new password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'All passwords are required';
+$GLOBALS['t']['passwords dont match'] = 'Passwords do not match';
+$GLOBALS['t']['passwords too big'] = 'There is at least one password too big';
+$GLOBALS['t']['passwords not alphanumeric'] = 'All passwords must be alphanumeric';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Change password';
+$GLOBALS['t']['personal info'] = 'Personal informations';
+$GLOBALS['t']['access'] = 'Access';
+$GLOBALS['t']['old password is incorrect'] = 'Current password is incorrect';
+$GLOBALS['t']['user password updated'] = 'Password is updated';
+$GLOBALS['t']['user is incorrect'] = 'Current user is not valid';
+$GLOBALS['t']['user details updated'] = 'User details updated';
+$GLOBALS['t']['password not updated'] = 'Password was not updated';
+$GLOBALS['t']['user not updated'] = 'User was not updated';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,48 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_name'] = 'Nome';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Outras informa&ccedil;oes';
+$GLOBALS['t']['user_language'] = 'Idioma';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_start'] = 'Data para inicio de login';
+$GLOBALS['t']['login_end'] = 'Data em que o login expira';
+$GLOBALS['t']['login_counter'] = 'Total de logins';
+$GLOBALS['t']['login_last'] = 'Data do &uacute;ltimo login';
+$GLOBALS['t']['login_current'] = 'Data do login actual';
+$GLOBALS['t']['created_user'] = 'Criado por';
+$GLOBALS['t']['created_date'] = 'Criado em';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'O nome &eacute; demasiado grande';
+$GLOBALS['t']['email not valid'] = 'O email n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['other too big'] = 'As informa&ccedil;&otilde;es adicionais s&atilde;o demasiado grandes';
+$GLOBALS['t']['language not valid'] = 'O idioma n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['template not valid'] = 'O template n&atilde;o &eacute; v&aacute;lido';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Password actual';
+$GLOBALS['t']['password_new'] = 'Nova password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirme a nova password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'Todas as passwords s&atilde;o obrigat&oacute;rias';
+$GLOBALS['t']['passwords dont match'] = 'As passwords n&atilde;o s&atilde;o iguais';
+$GLOBALS['t']['passwords too big'] = 'Existe pelo menos uma password demasiado grande';
+$GLOBALS['t']['passwords not alphanumeric'] = 'As password t&ecirc;em de ser alfanum&eacute;ricas';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Modificar a password';
+$GLOBALS['t']['personal info'] = 'Configura&ccedil;&otilde;es pessoais';
+$GLOBALS['t']['access'] = 'Acesso';
+$GLOBALS['t']['old password is incorrect'] = 'A password actual &eacute; incorrecta';
+$GLOBALS['t']['user password updated'] = 'A password foi actualizada';
+$GLOBALS['t']['user is incorrect'] = 'O utilizador actual &eacute; incorrecto';
+$GLOBALS['t']['user details updated'] = 'Informa&ccedil;&otilde;es do utilizador actualizadas';
+$GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
+$GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,20 @@
+<?php
+
+$GLOBALS['t']['save'] = 'Save';
+$GLOBALS['t']['close'] = 'Close';
+$GLOBALS['t']['open'] = 'Open';
+$GLOBALS['t']['help'] = 'Help';
+$GLOBALS['t']['back'] = 'Back';
+$GLOBALS['t']['not applicable'] = 'Not applicable';
+$GLOBALS['t']['yes'] = 'Yes';
+$GLOBALS['t']['no'] = 'No';
+$GLOBALS['t']['schedule'] = 'Schedule';
+$GLOBALS['t']['delete'] = 'Delete';
+$GLOBALS['t']['toggle state'] = 'Toggle state';
+$GLOBALS['t']['public'] = 'Public';
+$GLOBALS['t']['private'] = 'Private';
+$GLOBALS['t']['not allowed'] = 'Not allowed';
+
+$GLOBALS['t']['add page'] = 'Add page';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -0,0 +1,20 @@
+<?php
+
+$GLOBALS['t']['save'] = 'Guardar';
+$GLOBALS['t']['close'] = 'Fechar';
+$GLOBALS['t']['open'] = 'Abrir';
+$GLOBALS['t']['help'] = 'Ajuda';
+$GLOBALS['t']['back'] = 'Voltar';
+$GLOBALS['t']['not applicable'] = 'N&atilde;o aplic&aacute;vel';
+$GLOBALS['t']['yes'] = 'Sim';
+$GLOBALS['t']['no'] = 'N&atilde;o';
+$GLOBALS['t']['schedule'] = 'Calend&aacute;rio';
+$GLOBALS['t']['delete'] = 'Eliminar';
+$GLOBALS['t']['toggle state'] = 'Inverter estado';
+$GLOBALS['t']['public'] = 'P&uacute;blico';
+$GLOBALS['t']['private'] = 'Privado';
+$GLOBALS['t']['not allowed'] = 'N&atilde;o permitido';
+
+$GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-08 14:47:48 UTC (rev 1923)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-09 09:43:55 UTC (rev 1924)
@@ -30,15 +30,13 @@
     YDInclude( 'YDDatabaseObject.php' );
 	YDInclude( 'YDDatabaseTree.php' );
 
-	// include core YDCM libs
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMUsers/YDCMUsers.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTree/YDCMTree.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLocks/YDCMLocks.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMAudit/YDCMAudit.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMTemplates/YDCMTemplates.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMLanguages/YDCMLanguages.php' );
+	// set core libs directory
+    YDConfig::set( 'YD_DBOBJECT_PATH', dirname( __FILE__ ) . '/YDCMComponent/');
 
+	// add generic translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/YDCMComponent/languages/' );
 
+
     class YDCMComponent extends YDDatabaseObject {
 
         function YDCMComponent( $name, $standardComponent = true ) {
@@ -100,6 +98,23 @@
 
 
         /**
+         *  This static function returns an YDCMComponent module
+         *
+         *  @returns    an module object
+         */
+		function module( $name ){
+
+			// include lib
+			// TODO: check is name is a valid lib name
+			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
+
+			// return class
+			return new $name();
+		}
+
+
+
+        /**
          *  This function returns all elements (except root)
          *
          *  @returns    all tree elements 



From ximian at berlios.de  Tue May  9 11:49:32 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 9 May 2006 11:49:32 +0200
Subject: [ydf-devel] r1925 - YDFramework2.0/trunk/YDFramework2/addons/YDCMPage
Message-ID: <200605090949.k499nWEi031220@sheep.berlios.de>

Author: ximian
Date: 2006-05-09 11:49:19 +0200 (Tue, 09 May 2006)
New Revision: 1925

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
Log:
port page content module to new static YDCMComponent::module

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-09 09:43:55 UTC (rev 1924)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-09 09:49:19 UTC (rev 1925)
@@ -72,8 +72,8 @@
 			YDInclude( 'YDForm.php' );
 
 			// init template and language object
-			$templates = new YDCMTemplates();
-			$languages = new YDCMLanguages();
+			$templates = YDCMComponent::module( 'YDCMTemplates' );
+			$languages = YDCMComponent::module( 'YDCMLanguages' );
 
 			// create access options
 			$access = array( 0 => t('public'), 1 => t('private') );



From pieter at yellowduck.be  Tue May  9 02:50:04 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 9 May 2006 02:50:04 +0200
Subject: [ydf-devel] Propose for YDCM development
In-Reply-To: <445F7080.3050406@fusemail.com>
References: <445F7080.3050406@fusemail.com>
Message-ID: <4aef63030605081750h174c740ak88c334467d479fc0@mail.gmail.com>

Hi Francisco,

It looks like a good idea to implement YDWeblog with the content management
infrastructure you've build. I would however make it a separate item so that
we can still continue with the current version of the weblog system.

How do you plan to handle the admin side of things? Will that also be
provided by the framework or is that something the user has to implement
himself?

Cheers,


pieter

On 5/8/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi all
>
> Currently, we have a good start draft about Content Management components.
>
> We have a master component class that involves logic about:
> - content tree management
> - user management
> - content locking (to control multi-edition)
> - language management
> - auditing (to store user actions)
>
> and we have some initial component structures:
> - pages
> - rootmenus
> - links
> - guestbook
>
> After some time analysing the weblog db scheme i think we have already a
> good start to porting. The weblog structure can be (easily, i think) be
> converted to use all the power of the YDCM.
>
> As you can see, the structure is identical:
>
> - 'categories' are 'rootmenus'
>   these are elements with just a title that can have any caind of child
>
> - 'comments' are a part of a guestbook
>    basically we can convert this making a guestbook node that
>    has a page as parent.
>
> - 'items' and 'pages' are identical
>   (maybe a merge here?)
>
> - 'links' have a YDCM component created named 'link'
>   these are nodes that can be saved as menu children
>
> - 'statistics' have YDCMStatistics_visits correspondence
>
> - 'users' have YDCMUsers correspondence
>
>
> Well.. open the current DBDesigner file and understand how YDCM is
> structured. In the latest build it's much more clear.
>
>
> - What's your opinion about that structure?
>
> - What's your opinion about porting some weblog methods to YDCM modules?
>
>
>
> regards
> Francisco A
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060509/f52ab4b5/attachment.html>

From francisco at fusemail.com  Tue May  9 15:38:48 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 09 May 2006 14:38:48 +0100
Subject: [ydf-devel] Propose for YDCM development
In-Reply-To: <4aef63030605081750h174c740ak88c334467d479fc0@mail.gmail.com>
References: <445F7080.3050406@fusemail.com> <4aef63030605081750h174c740ak88c334467d479fc0@mail.gmail.com>
Message-ID: <44609B68.5000006@fusemail.com>

Hi Pieter


> It looks like a good idea to implement YDWeblog with the content 
> management infrastructure you've build. I would however make it a 
> separate item so that we can still continue with the current version of 
> the weblog system.
>  
> How do you plan to handle the admin side of things? Will that also be 
> provided by the framework or is that something the user has to implement 
> himself?

Every YDCM compontent has methods for the admin side (btw, they only 
have those now and not the visitors side yet).

Imagine a page. Currently you have methods to:
- get the form (with rules.. etc),
- make the validation (you only need to control the result)
- db store/update/delete is done
...

Basically the idea is that you only need to create the request class and 
invoke those methods about that component.


Francisco A


>  
> On 5/8/06, *Francisco Azevedo* <francisco at fusemail.com 
> <mailto:francisco at fusemail.com>> wrote:
> 
>     Hi all
> 
>     Currently, we have a good start draft about Content Management
>     components.
> 
>     We have a master component class that involves logic about:
>     - content tree management
>     - user management
>     - content locking (to control multi-edition)
>     - language management
>     - auditing (to store user actions)
> 
>     and we have some initial component structures:
>     - pages
>     - rootmenus
>     - links
>     - guestbook
> 
>     After some time analysing the weblog db scheme i think we have already a
>     good start to porting. The weblog structure can be (easily, i think) be
>     converted to use all the power of the YDCM.
> 
>     As you can see, the structure is identical:
> 
>     - 'categories' are 'rootmenus'
>       these are elements with just a title that can have any caind of child
> 
>     - 'comments' are a part of a guestbook
>        basically we can convert this making a guestbook node that
>        has a page as parent.
> 
>     - 'items' and 'pages' are identical
>       (maybe a merge here?)
> 
>     - 'links' have a YDCM component created named 'link'
>       these are nodes that can be saved as menu children
> 
>     - 'statistics' have YDCMStatistics_visits correspondence
> 
>     - 'users' have YDCMUsers correspondence
> 
> 
>     Well.. open the current DBDesigner file and understand how YDCM is
>     structured. In the latest build it's much more clear.
> 
> 
>     - What's your opinion about that structure?
> 
>     - What's your opinion about porting some weblog methods to YDCM modules?
> 
> 
> 
>     regards
>     Francisco A
> 
> 
>     _______________________________________________
>     YDFramework-devel mailing list
>     YDFramework-devel at lists.berlios.de
>     <mailto:YDFramework-devel at lists.berlios.de>
>     http://lists.berlios.de/mailman/listinfo/ydframework-devel
>     <http://lists.berlios.de/mailman/listinfo/ydframework-devel>
> 
> 
> 
> 
> -- 
> pieter claerhout . pieter at yellowduck.be <mailto:pieter at yellowduck.be> . 
> http://www.yellowduck.be/



From pieter at yellowduck.be  Tue May  9 16:12:18 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 9 May 2006 16:12:18 +0200
Subject: [ydf-devel] Propose for YDCM development
In-Reply-To: <44609B68.5000006@fusemail.com>
References: <445F7080.3050406@fusemail.com>
	 <4aef63030605081750h174c740ak88c334467d479fc0@mail.gmail.com>
	 <44609B68.5000006@fusemail.com>
Message-ID: <4aef63030605090712t5db0ccedsd068050d6b2271a0@mail.gmail.com>

Are you planning on making a simple example on how to use these classes?
Having a small example that shows the basics of creating an admin side
(which can be very basic) would really help people to get up to speed
faster.

pieter

On 5/9/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi Pieter
>
>
> > It looks like a good idea to implement YDWeblog with the content
> > management infrastructure you've build. I would however make it a
> > separate item so that we can still continue with the current version of
> > the weblog system.
> >
> > How do you plan to handle the admin side of things? Will that also be
> > provided by the framework or is that something the user has to implement
> > himself?
>
> Every YDCM compontent has methods for the admin side (btw, they only
> have those now and not the visitors side yet).
>
> Imagine a page. Currently you have methods to:
> - get the form (with rules.. etc),
> - make the validation (you only need to control the result)
> - db store/update/delete is done
> ...
>
> Basically the idea is that you only need to create the request class and
> invoke those methods about that component.
>
>
> Francisco A
>
>
> >
> > On 5/8/06, *Francisco Azevedo* <francisco at fusemail.com
> > <mailto:francisco at fusemail.com>> wrote:
> >
> >     Hi all
> >
> >     Currently, we have a good start draft about Content Management
> >     components.
> >
> >     We have a master component class that involves logic about:
> >     - content tree management
> >     - user management
> >     - content locking (to control multi-edition)
> >     - language management
> >     - auditing (to store user actions)
> >
> >     and we have some initial component structures:
> >     - pages
> >     - rootmenus
> >     - links
> >     - guestbook
> >
> >     After some time analysing the weblog db scheme i think we have
> already a
> >     good start to porting. The weblog structure can be (easily, i think)
> be
> >     converted to use all the power of the YDCM.
> >
> >     As you can see, the structure is identical:
> >
> >     - 'categories' are 'rootmenus'
> >       these are elements with just a title that can have any caind of
> child
> >
> >     - 'comments' are a part of a guestbook
> >        basically we can convert this making a guestbook node that
> >        has a page as parent.
> >
> >     - 'items' and 'pages' are identical
> >       (maybe a merge here?)
> >
> >     - 'links' have a YDCM component created named 'link'
> >       these are nodes that can be saved as menu children
> >
> >     - 'statistics' have YDCMStatistics_visits correspondence
> >
> >     - 'users' have YDCMUsers correspondence
> >
> >
> >     Well.. open the current DBDesigner file and understand how YDCM is
> >     structured. In the latest build it's much more clear.
> >
> >
> >     - What's your opinion about that structure?
> >
> >     - What's your opinion about porting some weblog methods to YDCM
> modules?
> >
> >
> >
> >     regards
> >     Francisco A
> >
> >
> >     _______________________________________________
> >     YDFramework-devel mailing list
> >     YDFramework-devel at lists.berlios.de
> >     <mailto:YDFramework-devel at lists.berlios.de>
> >     http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >     <http://lists.berlios.de/mailman/listinfo/ydframework-devel>
> >
> >
> >
> >
> > --
> > pieter claerhout . pieter at yellowduck.be <mailto:pieter at yellowduck.be> .
> > http://www.yellowduck.be/
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060509/d97f5d20/attachment.html>

From francisco at fusemail.com  Mon May  8 23:49:45 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 08 May 2006 22:49:45 +0100
Subject: [ydf-devel] YDF Weblog
Message-ID: <445FBCF9.7050408@fusemail.com>

Hi Pieter

After so much months i have installed the YDFWeblog . . to use it and
not only for testing (shame on me).
I don't know if you are interested in my opinion about it as a USER
point of view (and not as developer)..

Well.. here it goes anyway.


This what i liked:

- Excellent admin design
- Easy to deal
- All important features are there
.. i think it does the job and most important.. can be used by anyone!


What i didn't liked:

- make the weblog package myself to be able to use the latest features
- just one skin



Features i think are important:

- imho, it should not display the db pass in general settings
- an option to define the max size of an image doesn't exist.. if i
upload a image with 100000x100000 px it will display it in the original
size instead of limiting... currently i must use an image editor before
upload to scale big images
- an option to set if comments are automatically displayed or must be
approved by admin is important i think.
- we could define custom image names when uploading (instead of
automatically use the filename).


And that's all for now.

Francisco A





From francisco at fusemail.com  Mon May  8 22:57:35 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 08 May 2006 21:57:35 +0100
Subject: [ydf-devel] YDF Weblog
Message-ID: <445FB0BF.3020609@fusemail.com>

Hi Pieter

After so much months i have installed the YDFWeblog . . to use it and 
not only for testing (shame on me).
I don't know if you are interested in my opinion about it as a USER 
point of view (and not as developer)..

Well.. here it goes anyway.


This what i liked:

- Excellent admin design
- Easy to deal
- All important features are there
.. i think it does the job and most important.. can be used by anyone!


What i didn't liked:

- make the weblog package myself to be able to use the latest features
- just one skin



Features i think are important:

- imho, it should not display the db pass in general settings
- an option to define the max size of an image doesn't exist.. if i 
upload a image with 100000x100000 px it will display it in the original 
size instead of limiting... currently i must use an image editor before 
upload to scale big images
- an option to set if comments are automatically displayed or must be 
approved by admin is important i think.
- we could define custom image names when uploading (instead of 
automatically use the filename).


And that's all for now.

Francisco A




From ximian at berlios.de  Fri May 12 17:10:37 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Fri, 12 May 2006 17:10:37 +0200
Subject: [ydf-devel] r1926 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent
Message-ID: <200605121510.k4CFAblh027681@sheep.berlios.de>

Author: ximian
Date: 2006-05-12 17:07:51 +0200 (Fri, 12 May 2006)
New Revision: 1926

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMStatistics_visits.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
updated YDCMComponent for module structure
added Statistics management form YDCM

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-09 09:49:19 UTC (rev 1925)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-12 15:07:51 UTC (rev 1926)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="75.00" XPos="73" YPos="123" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="75.00" XPos="791" YPos="875" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -1196,7 +1196,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1590" Tablename="YDCMHelpdesk_type" PrevTableName="Table_20" XPos="1500" YPos="1650" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" >
+<TABLE ID="1590" Tablename="YDCMHelpdesk_type" PrevTableName="Table_20" XPos="1480" YPos="1640" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" >
 <COLUMNS>
 <COLUMN ID="1592" ColName="type_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1270,8 +1270,8 @@
 <RELATION ID="1572" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1565" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="73" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="10" EndIntervalOffsetY="4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
 <RELATION ID="1573" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1565" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="109" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="3" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
 <RELATION ID="1575" RelationName="component_id" Kind="2" SrcTable="1565" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="51" CaptionOffsetY="-40" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
-<RELATION ID="1608" RelationName="reported_by_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=reported_by_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-68" CaptionOffsetY="-22" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
-<RELATION ID="1610" RelationName="assignedto_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=assignedto_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="63" CaptionOffsetY="-22" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="44" />
+<RELATION ID="1608" RelationName="reported_by_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=reported_by_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-61" CaptionOffsetY="-38" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
+<RELATION ID="1610" RelationName="assignedto_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=assignedto_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="58" CaptionOffsetY="-38" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="44" />
 <RELATION ID="1526" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1519" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="20" CaptionOffsetY="-20" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="32" />
 <RELATION ID="1646" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
 <RELATION ID="1648" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="user_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="52" />

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMStatistics_visits.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMStatistics_visits.php	2006-05-09 09:49:19 UTC (rev 1925)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMStatistics_visits.php	2006-05-12 15:07:51 UTC (rev 1926)
@@ -0,0 +1,55 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMStatistics_visits extends YDDatabaseObject {
+    
+        function YDCMStatistics_visits() {
+        
+			// init database object
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMStatistics_visits' );
+
+            // register custom key
+            $this->registerKey( 'visit_id', true );
+
+            // register custom fields
+			$this->registerField( 'date' );
+			$this->registerField( 'browser' );
+			$this->registerField( 'platform' );
+			$this->registerField( 'url' );
+			$this->registerField( 'hits' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php	2006-05-09 09:49:19 UTC (rev 1925)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTree.php	2006-05-12 15:07:51 UTC (rev 1926)
@@ -66,7 +66,7 @@
 
          *  @returns    false if elements are invalid, an associative array with node information
          */
-		function getDragDropElements( $x, $y ){
+		function getDragDropElements( $x = null, $y = null){
 		
 			// check if elements are numeric
 			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-05-09 09:49:19 UTC (rev 1925)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-05-12 15:07:51 UTC (rev 1926)
@@ -210,13 +210,9 @@
          */
 		function getFormUser(){
 
-			// include languages and templates lib
-			YDInclude( 'YDCMLanguages.php' );
-			YDInclude( 'YDCMTemplates.php' );
-
 			// create languages and templates object
-			$languages = new YDCMLanguages();
-			$templates = new YDCMTemplates();
+			$languages = YDCMComponent::module( 'YDCMLanguages' );
+			$templates = YDCMComponent::module( 'YDCMTemplates' );
 
 			// create form object
             $form = new YDForm( YDConfig::get( 'YDCMUSERS_FORMUSER' ) );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-09 09:49:19 UTC (rev 1925)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-12 15:07:51 UTC (rev 1926)
@@ -105,7 +105,7 @@
 		function module( $name ){
 
 			// include lib
-			// TODO: check is name is a valid lib name
+			// TODO: check if name is a valid lib name
 			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
 
 			// return class
@@ -133,9 +133,12 @@
 
          *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x => 'PHCMPage', $y => 'PHCMRootmenu ))'
          */
-		function getDragDropElements( $x, $y ){
+		function getDragDropElements( $x = null, $y = null ){
 		
-			$treeObj = new YDCMTree();
+			// get object tree
+			$treeObj = YDCMComponent::module( 'YDCMTree' );
+
+			// check drop validation
 			return $treeObj->getDragDropElements( $x, $y );
 		}
 



From pclaerhout at berlios.de  Mon May 15 09:45:37 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 15 May 2006 09:45:37 +0200
Subject: [ydf-devel] r1927 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples/weblog examples/weblog/include
Message-ID: <200605150745.k4F7jboF015606@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-15 09:45:36 +0200 (Mon, 15 May 2006)
New Revision: 1927

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Added support for logging statistics on the RSS feeds access.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-12 15:07:51 UTC (rev 1926)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-15 07:45:36 UTC (rev 1927)
@@ -822,7 +822,10 @@
                 $this->agent = $_SERVER['HTTP_USER_AGENT'];
 
                 // Determine the browser name
-                if ( preg_match( '/MSIE ([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
+                if ( substr( strtolower( $this->agent ), 0, 10 ) == 'rss reader' ) {
+                    $this->version = '';
+                    $this->browser = 'rss reader';
+                } elseif ( preg_match( '/MSIE ([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
                     $this->version = $ver[1];
                     $this->browser = 'ie';
                 } elseif ( preg_match( '/Safari\/([0-9]+)/', $this->agent, $ver ) ) {

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-12 15:07:51 UTC (rev 1926)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-15 07:45:36 UTC (rev 1927)
@@ -605,7 +605,8 @@
         function getStatsBrowser() {
             $browsers = array(
                 'ie' => 'Internet Explorer', 'mozilla' => 'Netscape/Mozilla', 'safari' => 'Apple Safari',
-                'opera' => 'Opera', 'firefox' => 'FireFox', 'other' => t('other'), 'unknown' => t('other')
+                'opera' => 'Opera', 'firefox' => 'FireFox', 'other' => t('other'), 'unknown' => t('other'),
+                'rss reader' => 'RSS Reader'
             );
             $browserStats = $this->db->getRecords(
                 'SELECT browser, SUM(hits) AS hits FROM #_statistics GROUP BY browser ORDER BY hits DESC'

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-12 15:07:51 UTC (rev 1926)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-15 07:45:36 UTC (rev 1927)
@@ -12,9 +12,15 @@
         // Class constructor
         function xml() {
 
+            // Fix up the user agent (to make sure RSS Readers show up in the user agents)
+            $_SERVER['HTTP_USER_AGENT'] = 'RSS Reader ' . $_SERVER['HTTP_USER_AGENT'];
+
             // Initialize the parent
             $this->YDWeblogRequest();
 
+            // Log the request
+            $this->_logRequest();
+
         }
 
         // Default action



From ximian at berlios.de  Mon May 15 16:59:08 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 15 May 2006 16:59:08 +0200
Subject: [ydf-devel] r1928 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDFormElements
Message-ID: <200605151459.k4FEx80d027203@sheep.berlios.de>

Author: ximian
Date: 2006-05-15 16:58:43 +0200 (Mon, 15 May 2006)
New Revision: 1928

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
added new simple form element to be used with ajax: grid
added new recordset methods
updated ydform for new element

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-15 07:45:36 UTC (rev 1927)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-15 14:58:43 UTC (rev 1928)
@@ -439,8 +439,53 @@
             return $this->set;
         }
 
+
+        /**
+         *  Sets fields names
+         */
+        function setFields( $fields ) {
+            return $this->gr_fields = $fields;
+        }
+
+
+        /**
+         *  Gets fields names
+         */
+        function getFields() {
+            return ( isset( $this->gr_fields ) ? $this->gr_fields : array() );
+        }
+
+
+        /**
+         *  Set current field name
+         */
+        function setCurrentField( $field ) {
+            return $this->gr_currentField = $field;
+        }
+
+
+        /**
+         *  Get current field name
+         */
+        function getCurrentField() {
+            return ( isset( $this->gr_currentField ) ? $this->gr_currentField : array() );
+        }
+
+
+        /**
+         *  Set sort direction
+         */
+        function getSortdirection( $reverse = false ) {
+
+			if ( $reverse ) return ( $this->sortdirection == 'ASC' ? 'DESC' : 'ASC' ) ;
+
+			return $this->sortdirection;
+        }
+
+
     }
 
+
     /**
      *  This class defines a database object.
      */

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-15 07:45:36 UTC (rev 1927)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-15 14:58:43 UTC (rev 1928)
@@ -123,7 +123,9 @@
             $this->registerElement( 'div', 'YDFormElement_Div', 'YDFormElement_Div.php' );
             $this->registerElement( 'autocompleter', 'YDFormElement_Autocompleter', 'YDFormElement_Autocompleter.php' );
             $this->registerElement( 'switchmenu', 'YDFormElement_SwitchMenu', 'YDFormElement_SwitchMenu.php' );
+            $this->registerElement( 'grid', 'YDFormElement_Grid', 'YDFormElement_Grid.php' );
 
+
             // Add the rules
             $this->registerRule( 'required', array( 'YDValidateRules', 'required' ), 'YDValidateRules.php' );
             $this->registerRule( 'maxlength', array( 'YDValidateRules', 'maxlength' ), 'YDValidateRules.php' );

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2006-05-15 07:45:36 UTC (rev 1927)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2006-05-15 14:58:43 UTC (rev 1928)
@@ -0,0 +1,109 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php');
+    include_once( YD_DIR_HOME_CLS . '/YDTemplate.php');
+
+    /**
+     *        This is the class that defines a simple ajax grid element
+     */
+    class YDFormElement_Grid extends YDFormElement {
+
+        /**
+         *        This is the class constructor for the YDFormElement_Grid class.
+         *
+         *        @param $form                The name of the form to which this element is connected.
+         *        @param $name                The name of the form element.
+         *        @param $label                (optional) The label for the form element.
+         *        @param $attributes        (optional) The attributes for the form element.
+         *        @param $options                (optional) The options for the elment.
+         */
+        function YDFormElement_Grid( $form = '', $name = '_gr', $label='', $attributes=array(), $options=array() ) {
+
+            // Initialize the parent
+            $this->YDFormElement( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'grid';
+
+            // Set the value correctly
+            $this->_placeLabel = 'none';
+
+            // Indicate if filters need to be applied
+            $this->_applyFilters = false;
+
+            // Indicate we are a button type
+            $this->_isButton = false;
+        }
+
+
+        /**
+         *      This function returns a boolean indicating if the element value was
+         *      modified from it's default value.
+         *
+         *      @returns        Boolean indicating if the element was modified.
+         */
+        function isModified() {
+            return false;
+        }
+
+
+        /**
+         *      This function adds a ajax event to handle header calls
+         */
+		function setAjax( &$ajax, $method ){
+		
+			$ajax->addEvent( 'ticketReload(order, dir, page)', $method, array( 'var order', 'var dir', 'var page' ) );
+		}
+
+
+        /**
+         *        This function will return the element as HTML.
+         *
+         *        @returns        The form element as HTML text.
+         */
+        function toHtml() {
+
+            // Create the list of attributes
+            $attribs = array(
+                'id' => $this->_form . '_' . $this->_name
+            );
+            $attribs = array_merge( $this->_attributes, $attribs );
+
+			// get record template and assign recordset
+			$template_record = new YDTemplate();
+			$template_record->assign( 'recordset', $this->_value );
+
+            // Get the HTML
+			return $template_record->fetch( dirname( __FILE__ ) . '/YDFormElement_Grid.tpl' );
+        }
+
+    }
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-15 07:45:36 UTC (rev 1927)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-15 14:58:43 UTC (rev 1928)
@@ -0,0 +1,38 @@
+<table width="100%"  border="0">
+  <tr>
+    <td align="right">
+	<span class="field_previous" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$recordset->pagePrevious}');">{t w="previous"}</span>
+    {foreach from=$recordset->pages item="page"}
+		{if ($page != $recordset->page)}
+			<span class="field_page" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$page}');">{$page}</span>
+		{else}
+			<span class="field_page_current">{$page}</span>
+		{/if}
+	{/foreach}
+	<span class="field_next" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$recordset->pageNext}');">{t w="next"}</span>
+	</td>
+  </tr>
+</table>
+<br />
+        <table width="100%" border="0">
+
+            <tr class="rowHeader">
+                {foreach from=$recordset->getFields() item="field"}
+					{if ($field != $recordset->getCurrentField())}
+	                    <td height="24" align="right" class="fieldHeader" onClick="ticketReload('{$field}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$field}&nbsp;</td>
+					{else}
+	                    <td height="24" align="right" class="fieldHeader_order" onClick="ticketReload('{$field}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$field}&nbsp;</td>
+					{/if}
+                {/foreach}
+            </tr>
+
+
+        {foreach from=$recordset->set item="record"}
+            <tr class="{cycle values='row1,row2'}">
+                {foreach from=$record item="val"}
+                    <td height="24" align="right">{$val}&nbsp;</td>
+                {/foreach}
+            </tr>
+        {/foreach}
+
+</table>



From ximian at berlios.de  Mon May 15 17:01:07 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 15 May 2006 17:01:07 +0200
Subject: [ydf-devel] r1929 - YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk
Message-ID: <200605151501.k4FF17Wv027408@sheep.berlios.de>

Author: ximian
Date: 2006-05-15 17:00:40 +0200 (Mon, 15 May 2006)
New Revision: 1929

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
Log:
updated helpdesk component and added new method to get a recordset of posts

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-15 14:58:43 UTC (rev 1928)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-15 15:00:40 UTC (rev 1929)
@@ -28,7 +28,11 @@
 
 
 	YDInclude( 'YDForm.php' );
+	YDInclude( 'YDCMComponent.php' );
 
+	// load master component modules
+	YDCMComponent::module( 'YDCMUsers' );
+
 	// add local translation directory
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
 
@@ -101,30 +105,23 @@
 			return $this->insert();
 		}
 
-/*
-		function deleteHelpdesk( $id ){
-		
-			$this->resetValues();
-			
-			$this->content_id = intval( $id );
-			
-			// delete all post that have this parent
-			$posts = new YDCMHelpdesk_posts();
-			$posts->deleteParent( $id );
-		
-		}
-		*/
     }
 
 
 
-    class YDCMHelpdesk_posts extends YDCMComponent {
+    class YDCMHelpdesk_posts extends YDDatabaseObject {
     
         function YDCMHelpdesk_posts() {
         
 			// init component
-            $this->YDCMComponent( 'YDCMHelpdesk_posts', false );
+            $this->YDDatabaseObject();
 
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_posts' );
+
 			// register Key
 			$this->registerKey( 'post_id', true );
 
@@ -132,23 +129,26 @@
 			$this->registerField( 'component_id' );
 			$this->registerField( 'user_id' );
 			$this->registerField( 'subject' );
-			$this->registerField( 'localization' );
 			$this->registerField( 'urgency_id' );
 			$this->registerField( 'state_id' );
 			$this->registerField( 'text' );
-			$this->registerField( 'created_in' );
-			$this->registerField( 'reported_in' );
-			$this->registerField( 'reported_by' );
-			$this->registerField( 'reported_to_in' );
-			$this->registerField( 'reported_to' );
-			$this->registerField( 'reported_to_local' );
+			$this->registerField( 'creation_user' );
+			$this->registerField( 'creation_date' );
+			$this->registerField( 'reported_by_user' );
+			$this->registerField( 'reported_by_type' );
+			$this->registerField( 'reported_by_local' );
+			$this->registerField( 'reported_by_date' );
+			$this->registerField( 'assignedto_user' );
+			$this->registerField( 'assignedto_type' );
+			$this->registerField( 'assignedto_local' );
+			$this->registerField( 'assignedto_date' );
 
 			// custom relation
             $rel = & $this->registerRelation( 'YDCMHelpdesk', false, 'YDCMHelpdesk' );
 			$rel->setLocalKey( 'component_id' );
             $rel->setForeignKey( 'component_id' );
 
-            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+            $relUsers = & $this->registerRelation( 'users', false, 'YDCMUsers' );
 			$relUsers->setLocalKey( 'user_id' );
             $relUsers->setForeignKey( 'user_id' );
 
@@ -164,9 +164,16 @@
             $relState = & $this->registerRelation( 'YDCMHelpdesk_state', false, 'YDCMHelpdesk_state' );
 			$relState->setLocalKey( 'state_id' );
             $relState->setForeignKey( 'state_id' );
+
+            $relAss = & $this->registerRelation( 'YDCMHelpdesk_type', false, 'YDCMHelpdesk_type' );
+			$relAss->setLocalKey( 'reported_by_type' );
+            $relAss->setForeignKey( 'type_id' );
 		}
 
 
+        /**
+         *  This function returns a form for posts
+         */
 		function getFormPost(){
 		
 			// create a form for new posts
@@ -207,6 +214,13 @@
 		}
 
 
+        /**
+         *  This function adds a new post
+         *
+         *  @param $helpdesk_id  helpdesk id of this post
+         *  @param $user_id  User id
+         *  @param $values  Array of values
+         */
 		function addPost( $helpdesk_id, $user_id, $values ){
 		
 			$this->resetValues();
@@ -233,7 +247,12 @@
 			return $this->insert();
 		}
 		
-		
+
+        /**
+         *  This function just deletes a post given its id
+         *
+         *  @param $post_id  Post id to delete
+         */
 		function deletePost( $post_id ){
 		
 			$this->resetValues();
@@ -244,6 +263,11 @@
 		}
 
 
+        /**
+         *  This function deletes all posts of a helpdesk
+         *
+         *  @param $helpdesk_id  Helpdesk id
+         */
 		function deleteAll( $helpdesk_id ){
 		
 			$this->resetValues();
@@ -254,6 +278,11 @@
 		}
 
 
+        /**
+         *  This function deletes all posts using a parent id
+         *
+         *  @param $parent_id  parent id
+         */
 		function deleteParent( $parent_id ){
 		
 			$this->resetValues();
@@ -263,18 +292,56 @@
 			return $this->delete();
 		}
 
-		
+
+        /**
+         *  This function returns a special recordset with posts
+         *
+         *  @param $field_order  Field to sort
+         *  @param $field_order_direction  Sort direction
+         *  @param $field_page  Page to retrieve
+         */
+		function getRS( $field_order = 'creation_date', $field_order_direction = 'DESC', $field_page = 1 ){
+
+			// delete previous values
+			$this->resetValues();
+
+			// set current order
+			$this->order( $this->getTable() . '.' . $field_order . ' ' . $field_order_direction . ', creation_date DESC' );
+
+			// get only posts with state 1
+			$this->state_id = 1;
+
+			// get information of users too
+			$this->find( 'users' );
+
+			// define columns we want
+			$fields = array( 'post_id', 'subject', 'name', 'creation_date' );
+
+			// create a recordset
+			$recordset = new YDRecordSet( $this->getResultsAsAssocArray( 'post_id', $fields, false, false, false, false ), $field_page, 9 );
+			$recordset->setFields( $fields );
+			$recordset->setCurrentField( $field_order );
+
+			return $recordset;
+		}
+
 	}
 
 
 
-    class YDCMHelpdesk_response extends YDCMComponent {
+    class YDCMHelpdesk_response extends YDDatabaseObject {
     
         function YDCMHelpdesk_response() {
         
 			// init component
-            $this->YDCMComponent( 'YDCMHelpdesk_response', false );
+            $this->YDDatabaseObject();
 
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_response' );
+
 			// register Key
 			$this->registerKey( 'response_id', true );
 
@@ -295,6 +362,7 @@
 		}
 
 
+
 		function addResponse( $post_id, $user_id, $message ){
 		
 			YDInclude( 'YDUtil.php' );
@@ -316,13 +384,19 @@
 
 
 
-    class YDCMHelpdesk_urgency extends YDCMComponent {
+    class YDCMHelpdesk_urgency extends YDDatabaseObject {
     
         function YDCMHelpdesk_urgency() {
         
 			// init component
-            $this->YDCMComponent( 'YDCMHelpdesk_urgency', false );
+            $this->YDDatabaseObject();
 
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_urgency' );
+
 			// register Key
 			$this->registerKey( 'urgency_id', true );
 
@@ -373,13 +447,19 @@
 
 
 
-    class YDCMHelpdesk_state extends YDCMComponent {
+    class YDCMHelpdesk_state extends YDDatabaseObject {
     
         function YDCMHelpdesk_state() {
         
 			// init component
-            $this->YDCMComponent( 'YDCMHelpdesk_state', false );
+            $this->YDDatabaseObject();
 
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_state' );
+
 			// register Key
 			$this->registerKey( 'state_id', true );
 
@@ -430,5 +510,29 @@
 
 
 
+    class YDCMHelpdesk_type extends YDDatabaseObject {
+    
+        function YDCMHelpdesk_type() {
+        
+			// init component
+            $this->YDDatabaseObject();
 
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_type' );
+
+			// register Key
+			$this->registerKey( 'type_id', true );
+
+			// register custom fields
+			$this->registerField( 'description' );
+						
+			// custom relations
+		}
+
+	}	
+
+
 ?>
\ No newline at end of file



From ximian at berlios.de  Mon May 15 17:03:44 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 15 May 2006 17:03:44 +0200
Subject: [ydf-devel] r1930 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605151503.k4FF3i32028133@sheep.berlios.de>

Author: ximian
Date: 2006-05-15 17:03:11 +0200 (Mon, 15 May 2006)
New Revision: 1930

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php
Log:
added first release of the second master YDCM compoment: YDCMStatistics

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php	2006-05-15 15:00:40 UTC (rev 1929)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php	2006-05-15 15:03:11 UTC (rev 1930)
@@ -0,0 +1,111 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMStatistics {
+
+        function YDCMStatistics() {
+		}
+		
+
+        /**
+         *  This static function returns php informations
+         *
+         *  @returns    an array with php info
+         */
+		function php(){
+		
+            // Get the general PHP info
+            ob_start();
+            phpinfo( INFO_GENERAL );
+            $phpInfo .= ob_get_contents();
+            ob_end_clean();
+
+            // Get the right part
+            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
+            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
+
+            // Strip unneeded things
+            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
+            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
+            $phpInfo = trim( $phpInfo );
+
+            // Get the settings
+            $settings = array();
+            foreach ( explode( "\n", $phpInfo ) as $line ) {
+                $line = explode( ' </td><td class="v">', $line );
+                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
+                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
+            }
+
+			// export other values
+			$settings[ 'version' ]     = phpversion();
+			$settings[ 'modules' ]     = implode( get_loaded_extensions(), ', ' );
+			$settings[ 'os' ]          = PHP_OS;
+			$settings[ 'includePath' ] = $GLOBALS['YD_INCLUDE_PATH'];
+
+			return $settings;
+		}
+
+
+        /**
+         *  This static function returns the mail info
+         *
+         *  @returns    an array with mail info
+         */
+		function mailer(){
+
+		    // Includes
+		    require_once( dirname( __FILE__ ) . '/../3rdparty/phpmailer/class.phpmailer.php' );
+
+            // Get the version of phpMailer
+            $PHPMailer = new PHPMailer();
+
+			return array( 'version' => $PHPMailer->Version, 'complete' => 'PHPMailer [version ' . $PHPMailer->Version . ']' );
+		}
+
+
+        /**
+         *  This static function returns an YDCMStatistics module
+         *
+         *  @returns    an module object
+         */
+		function module( $name ){
+
+			// include lib
+			// TODO: check if name is a valid lib name
+			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
+
+			// return class
+			return new $name();
+		}
+
+
+    }
+
+?>
\ No newline at end of file



From ximian at berlios.de  Mon May 15 17:05:58 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 15 May 2006 17:05:58 +0200
Subject: [ydf-devel] r1931 - YDFramework2.0/trunk/YDFramework2/addons/YDCMPage
Message-ID: <200605151505.k4FF5wMW028384@sheep.berlios.de>

Author: ximian
Date: 2006-05-15 17:05:23 +0200 (Mon, 15 May 2006)
New Revision: 1931

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
Log:
added YDCMPage form rules

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-15 15:03:11 UTC (rev 1930)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-05-15 15:05:23 UTC (rev 1931)
@@ -71,7 +71,7 @@
 		
 			YDInclude( 'YDForm.php' );
 
-			// init template and language object
+			// get template and language object
 			$templates = YDCMComponent::module( 'YDCMTemplates' );
 			$languages = YDCMComponent::module( 'YDCMLanguages' );
 
@@ -95,10 +95,10 @@
 	        $form->addElement( 'datetimeselect', 'published_date_end',   t('page_enddate'));
 	        $form->addElement( 'select',         'template_pack',        '',                       array(), $template_pack );
 	        $form->addElement( 'select',         'template',             t('page_template'),       array(), $templates->visitors_templates());
-	        $form->addElement( 'select',         'metatags',             t('page_metatags'),       array(), array(0 => t('no'), 1 => t('yes')));
-	        $form->addElement( 'textarea',       'description',          t('page_description'),    array('cols' => 50, 'rows' => 5) );
-	        $form->addElement( 'textarea',       'keywords',             t('page_keywords'),       array('cols' => 50, 'rows' => 5) );
-	        $form->addElement( 'select',         'searcheable',          t('page_search'),         array(), array(0 => t('no'), 1 => t('yes')) );
+	        $form->addElement( 'select',         'metatags',             t('page_metatags'),       array(), array( 0 => t('no'), 1 => t('yes') ) );
+	        $form->addElement( 'textarea',       'description',          t('page_description'),    array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'textarea',       'keywords',             t('page_keywords'),       array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'select',         'searcheable',          t('page_search'),         array(), array( 0 => t('no'), 1 => t('yes') ) );
 	        $form->addElement( 'hidden',         'content_id' );
 	        $form->addElement( 'hidden',         'parent_id' );
 	        $form->addElement( 'hidden',         'language_id' );
@@ -108,10 +108,24 @@
 			$form->setDefault( 'parent_id',   0 );
 			$form->setDefault( 'language_id', $languages->adminDefault() );
 
-			// TODO: add form rules
-			
-			// content_id .. integer
-			// language_id .. valid in possible languages
+			// add form rules
+			$form->addRule( 'reference',      'required',       t('reference_required') );
+			$form->addRule( 'reference',      'alphanumeric',   t('reference_alphanumeric') );
+			$form->addRule( 'reference',      'maxwords',       t('reference_maxwords'),  1 );
+			$form->addRule( 'reference',      'maxlength',      t('reference_maxlength'), 100 );
+			$form->addRule( 'title',          'required',       t('title_required') );
+			$form->addRule( 'title',          'maxlength',      t('title_maxlength'), 255 );
+			$form->addRule( 'content_id',     'required',       t('content_id_required') );
+			$form->addRule( 'content_id',     'numeric',        t('content_id_numeric') );
+			$form->addRule( 'parent_id',      'required',       t('parent_id_required') );
+			$form->addRule( 'parent_id',      'numeric',        t('parent_id_numeric') );
+			$form->addRule( 'html',           'maxlength',      t('html_maxlength'),  50000 );
+			$form->addRule( 'xhtml',          'maxlength',      t('xhtml_maxlength'), 50000 );
+			$form->addRule( 'template_pack',  'in_array',       t('template_pack_invalid'), array( 0, 1 ) );
+			$form->addRule( 'template',       'in_array',       t('template_invalid'),      array_keys( $templates->visitors_templates() ) );
+			$form->addRule( 'metatags',       'in_array',       t('metatags_invalid'),      array( 0, 1 ) );
+			$form->addRule( 'description',    'maxlength',      t('description_maxlength'), 2000 );
+			$form->addRule( 'keywords',       'maxlength',      t('keywords_maxlength'),    2000 );
 
 			return $form;
 		}



From ximian at berlios.de  Mon May 15 17:57:51 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 15 May 2006 17:57:51 +0200
Subject: [ydf-devel] r1932 - in YDFramework2.0/trunk/YDFramework2: YDClasses YDClasses/YDFormElements addons/YDCMHelpdesk
Message-ID: <200605151557.k4FFvpV0002265@sheep.berlios.de>

Author: ximian
Date: 2006-05-15 17:57:14 +0200 (Mon, 15 May 2006)
New Revision: 1932

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
Log:
fixed small issue regarding sorting on special recordsets

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-15 15:05:23 UTC (rev 1931)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-15 15:57:14 UTC (rev 1932)
@@ -458,9 +458,13 @@
 
         /**
          *  Set current field name
+         *
+         *  @param $field          Field name of sort
+         *  @param $sortdirection  Sort direction
          */
-        function setCurrentField( $field ) {
-            return $this->gr_currentField = $field;
+        function setCurrentField( $field, $sortdirection ) {
+            $this->gr_currentField = $field;
+			$this->sortdirection   = $sortdirection;
         }
 
 
@@ -473,11 +477,14 @@
 
 
         /**
-         *  Set sort direction
+         *  Get sort direction
+         *
+         *  @param $reverse    (optional) Boolean if we want a reverse direction
+         *
          */
         function getSortdirection( $reverse = false ) {
 
-			if ( $reverse ) return ( $this->sortdirection == 'ASC' ? 'DESC' : 'ASC' ) ;
+			if ( $reverse ) return ( strtoupper( $this->sortdirection ) == 'ASC' ? 'DESC' : 'ASC' );
 
 			return $this->sortdirection;
         }

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-15 15:05:23 UTC (rev 1931)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-15 15:57:14 UTC (rev 1932)
@@ -1,4 +1,4 @@
-<table width="100%"  border="0">
+<table width="100%" border="0">
   <tr>
     <td align="right">
 	<span class="field_previous" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$recordset->pagePrevious}');">{t w="previous"}</span>

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-15 15:05:23 UTC (rev 1931)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-15 15:57:14 UTC (rev 1932)
@@ -320,7 +320,7 @@
 			// create a recordset
 			$recordset = new YDRecordSet( $this->getResultsAsAssocArray( 'post_id', $fields, false, false, false, false ), $field_page, 9 );
 			$recordset->setFields( $fields );
-			$recordset->setCurrentField( $field_order );
+			$recordset->setCurrentField( $field_order, $field_order_direction );
 
 			return $recordset;
 		}



From pclaerhout at berlios.de  Mon May 15 20:23:49 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 15 May 2006 20:23:49 +0200
Subject: [ydf-devel] r1933 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200605151823.k4FINnnj007113@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-15 20:23:34 +0200 (Mon, 15 May 2006)
New Revision: 1933

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
If there are no hits, it's now properly shown in the admin -> stats part.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-15 15:57:14 UTC (rev 1932)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-15 18:23:34 UTC (rev 1933)
@@ -554,7 +554,11 @@
 
         // Get the total num of hits
         function getTotalHits() {
-            return $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics' );
+            $result = $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics' );
+            if ( empty( $result ) ) {
+                $result = 0;
+            }
+            return $result;
         }
 
         // Get the number of items



From ximian at berlios.de  Tue May 16 11:45:58 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 16 May 2006 11:45:58 +0200
Subject: [ydf-devel] r1934 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDFormElements
Message-ID: <200605160945.k4G9jwxZ023097@sheep.berlios.de>

Author: ximian
Date: 2006-05-16 11:45:45 +0200 (Tue, 16 May 2006)
New Revision: 1934

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
Log:
- ajax grid can handle correctly headers that cannot be sorted (a new css class added too)
- added total of pages to ajax grid


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-15 18:23:34 UTC (rev 1933)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-05-16 09:45:45 UTC (rev 1934)
@@ -442,6 +442,8 @@
 
         /**
          *  Sets fields names
+         *
+         *  @param $field          Field name of sort
          */
         function setFields( $fields ) {
             return $this->gr_fields = $fields;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-15 18:23:34 UTC (rev 1933)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-16 09:45:45 UTC (rev 1934)
@@ -17,11 +17,13 @@
         <table width="100%" border="0">
 
             <tr class="rowHeader">
-                {foreach from=$recordset->getFields() item="field"}
-					{if ($field != $recordset->getCurrentField())}
-	                    <td height="24" align="right" class="fieldHeader" onClick="ticketReload('{$field}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$field}&nbsp;</td>
+                {foreach from=$recordset->getFields() item="field" key="key"}
+					{if ($field.sortable == false)}
+	                    <td height="24" align="right" class="fieldHeader_off">{t w=$key}&nbsp;</td>
+					{elseif ($key != $recordset->getCurrentField())}
+	                    <td height="24" align="right" class="fieldHeader" onClick="ticketReload('{$key}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$key}&nbsp;</td>
 					{else}
-	                    <td height="24" align="right" class="fieldHeader_order" onClick="ticketReload('{$field}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$field}&nbsp;</td>
+	                    <td height="24" align="right" class="fieldHeader_order" onClick="ticketReload('{$key}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$key}&nbsp;</td>
 					{/if}
                 {/foreach}
             </tr>
@@ -36,3 +38,11 @@
         {/foreach}
 
 </table>
+        <table width="100%"  border="0">
+          <tr>
+            <td align="right" class="field_total">&nbsp;</td>
+          </tr>
+          <tr>
+            <td align="right" class="field_total">{t w="total"}: {$recordset->totalRows}&nbsp;&nbsp;</td>
+          </tr>
+        </table>



From pieter at yellowduck.be  Tue May 16 15:11:30 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 16 May 2006 15:11:30 +0200
Subject: [ydf-devel] YDF Weblog
In-Reply-To: <445FB0BF.3020609@fusemail.com>
References: <445FB0BF.3020609@fusemail.com>
Message-ID: <4aef63030605160611v2dd92d9fs88dd8611570efa1d@mail.gmail.com>

Hi Francisco,

the 4 feature requests you mentioned in your previous email are already on
my todo list for a while. Hopefully, I will soon have some time to implement
them.

pieter

On 5/8/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi Pieter
>
> After so much months i have installed the YDFWeblog . . to use it and
> not only for testing (shame on me).
> I don't know if you are interested in my opinion about it as a USER
> point of view (and not as developer)..
>
> Well.. here it goes anyway.
>
>
> This what i liked:
>
> - Excellent admin design
> - Easy to deal
> - All important features are there
> .. i think it does the job and most important.. can be used by anyone!
>
>
> What i didn't liked:
>
> - make the weblog package myself to be able to use the latest features
> - just one skin
>
>
>
> Features i think are important:
>
> - imho, it should not display the db pass in general settings
> - an option to define the max size of an image doesn't exist.. if i
> upload a image with 100000x100000 px it will display it in the original
> size instead of limiting... currently i must use an image editor before
> upload to scale big images
> - an option to set if comments are automatically displayed or must be
> approved by admin is important i think.
> - we could define custom image names when uploading (instead of
> automatically use the filename).
>
>
> And that's all for now.
>
> Francisco A
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060516/e5cc5c41/attachment.html>

From pieter at yellowduck.be  Tue May 16 15:14:28 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 16 May 2006 15:14:28 +0200
Subject: [ydf-devel] YDF Weblog
In-Reply-To: <4aef63030605160611v2dd92d9fs88dd8611570efa1d@mail.gmail.com>
References: <445FB0BF.3020609@fusemail.com>
	 <4aef63030605160611v2dd92d9fs88dd8611570efa1d@mail.gmail.com>
Message-ID: <4aef63030605160614v4772d96cq7c78e8e9bd40f2fa@mail.gmail.com>

Also, can you log them as feature requests on berlios?

pieter

On 5/16/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
>  Hi Francisco,
>
> the 4 feature requests you mentioned in your previous email are already on
> my todo list for a while. Hopefully, I will soon have some time to implement
> them.
>
> pieter
>
>  On 5/8/06, Francisco Azevedo <francisco at fusemail.com> wrote:
> >
> > Hi Pieter
> >
> > After so much months i have installed the YDFWeblog . . to use it and
> > not only for testing (shame on me).
> > I don't know if you are interested in my opinion about it as a USER
> > point of view (and not as developer)..
> >
> > Well.. here it goes anyway.
> >
> >
> > This what i liked:
> >
> > - Excellent admin design
> > - Easy to deal
> > - All important features are there
> > .. i think it does the job and most important.. can be used by anyone!
> >
> >
> > What i didn't liked:
> >
> > - make the weblog package myself to be able to use the latest features
> > - just one skin
> >
> >
> >
> > Features i think are important:
> >
> > - imho, it should not display the db pass in general settings
> > - an option to define the max size of an image doesn't exist.. if i
> > upload a image with 100000x100000 px it will display it in the original
> > size instead of limiting... currently i must use an image editor before
> > upload to scale big images
> > - an option to set if comments are automatically displayed or must be
> > approved by admin is important i think.
> > - we could define custom image names when uploading (instead of
> > automatically use the filename).
> >
> >
> > And that's all for now.
> >
> > Francisco A
> >
> >
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060516/527dd9f9/attachment.html>

From francisco at fusemail.com  Wed May 17 23:17:59 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 17 May 2006 22:17:59 +0100
Subject: [ydf-devel] YDF Weblog
In-Reply-To: <4aef63030605160614v4772d96cq7c78e8e9bd40f2fa@mail.gmail.com>
References: <445FB0BF.3020609@fusemail.com>	 <4aef63030605160611v2dd92d9fs88dd8611570efa1d@mail.gmail.com> <4aef63030605160614v4772d96cq7c78e8e9bd40f2fa@mail.gmail.com>
Message-ID: <446B9307.4030405@fusemail.com>

Hi Pieter

> Also, can you log them as feature requests on berlios?

done

Francisco A


From pclaerhout at berlios.de  Fri May 19 07:25:29 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 07:25:29 +0200
Subject: [ydf-devel] r1935 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples examples/weblog examples/weblog/include examples/weblog/include/languages examples/weblog/manage
Message-ID: <200605190525.k4J5PTMP002439@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 07:25:25 +0200 (Fri, 19 May 2006)
New Revision: 1935

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/examples/browserinfo.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/stats.php
   YDFramework2.0/trunk/examples/weblog/manage/stats.tpl
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
- Rewrote the browser sniffer to improve the statistics logged by the weblog application.
- Browser sniffer supports more browsers now
- Recognizes feedreaders and automatic bots
- Removed the version information sniffer from YDBrowserInfo as the information it returns was too ambigous
- Added the total avarage statistics without bots
- Added an option to reset the statistics
- Added the neccesary translations

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -806,59 +806,63 @@
             // Initialize YDBase
             $this->YDBase();
 
-            // Check if the user agent was specified
-            if ( ! isset( $_SERVER['HTTP_USER_AGENT'] ) ) {
+            // The matching list for browsers
+            $browsers = array(
+                'bot'       => array( 'bot', 'Yahoo! Slurp', 'crawler' ),
+                'opera'     => array( 'opera' ),
+                'ie'        => array( 'msie' ),
+                'safari'    => array( 'safari' ),
+                'konqueror' => array( 'Konqueror' ),
+                'feed'      => array( 'feed', 'rss', 'synd', 'bloglines', 'newsgator' ),
+                'mozilla'   => array( 'mozilla', 'firefox' ),
+            );
 
-                // Mark everything as unknown
-                $this->agent = 'unknown';
-                $this->browser = 'unknown';
-                $this->version = 'unknown';
-                $this->platform = 'unknown';
-                $this->dotnet = 'unknown';
+            // The matching list for platforms
+            $platforms = array(
+                'win'       => array( 'win' ),
+                'mac'       => array( 'mac', 'apple' ),
+                'linux'     => array( 'linux', 'bsd' ),
+                'unix'      => array( 'unix', 'sun', 'risc', 'aix' ),
+                'bot'       => array( 'bot', 'Yahoo! Slurp', 'crawler' ),
+                'feed'      => array( 'feed', 'rss', 'synd', 'bloglines', 'newsgator' ),
+            );
 
-            } else {
+            // Mark everything as unknown
+            $this->agent = 'unknown';
+            $this->browser = 'unknown';
+            $this->platform = 'unknown';
+            $this->dotnet = 'unknown';
 
+            // Check if the user agent was specified
+            if ( isset( $_SERVER['HTTP_USER_AGENT'] ) ) {
+
                 // Get the user agent
                 $this->agent = $_SERVER['HTTP_USER_AGENT'];
 
-                // Determine the browser name
-                if ( substr( strtolower( $this->agent ), 0, 10 ) == 'rss reader' ) {
-                    $this->version = '';
-                    $this->browser = 'rss reader';
-                } elseif ( preg_match( '/MSIE ([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
-                    $this->version = $ver[1];
-                    $this->browser = 'ie';
-                } elseif ( preg_match( '/Safari\/([0-9]+)/', $this->agent, $ver ) ) {
-                    $this->version = '1.0b' . $ver[1];
-                    $this->browser = 'safari';
-                } elseif ( preg_match( '/Opera ([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
-                    $this->version = $ver[1];
-                    $this->browser = 'opera';
-                } elseif ( preg_match( '/Opera\/([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
-                    $this->version = $ver[1];
-                    $this->browser = 'opera';
-                } elseif ( preg_match( '/Firefox\/([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
-                    $this->version = $ver[1];
-                    $this->browser = 'firefox';
-                } elseif ( preg_match( '/Mozilla\/([0-9].[0-9]{1,2})/', $this->agent, $ver ) ) {
-                    $this->version = $ver[1];
-                    $this->browser = 'mozilla';
-                } else {
-                    $this->version = 0;
-                    $this->browser = 'other';
+                // Get the browser name
+                foreach ( $browsers as $browser => $browserpatterns ) {
+                    foreach ( $browserpatterns as $browserpattern ) {
+                        if ( stristr( $this->agent, $browserpattern ) ) {
+                            $this->browser = $browser;
+                            continue;
+                        }
+                    }
+                    if ( $this->browser != 'unknown' ) {
+                        break;
+                    }
                 }
 
-                // Determine the platform
-                if ( stristr( $this->agent,'Win' ) ) {
-                    $this->platform = 'win';
-                } elseif ( stristr( $this->agent,'Mac' ) ) {
-                    $this->platform = 'mac';
-                } elseif ( stristr( $this->agent,'Linux' ) ) {
-                    $this->platform = 'linux';
-                } elseif ( stristr( $this->agent,'Unix' ) ) {
-                    $this->platform = 'unix';
-                } else {
-                    $this->platform = 'other';
+                // Get the browser name
+                foreach ( $platforms as $platform => $platformpatterns ) {
+                    foreach ( $platformpatterns as $platformpattern ) {
+                        if ( stristr( $this->agent, $platformpattern ) ) {
+                            $this->platform = $platform;
+                            continue;
+                        }
+                    }
+                    if ( $this->platform != 'unknown' ) {
+                        break;
+                    }
                 }
 
                 // Get the .NET runtime version

Modified: YDFramework2.0/trunk/examples/browserinfo.php
===================================================================
--- YDFramework2.0/trunk/examples/browserinfo.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/browserinfo.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -21,7 +21,6 @@
             $browser = new YDBrowserInfo();
             YDDebugUtil::dump( $browser->agent, 'Agent' );
             YDDebugUtil::dump( $browser->browser, 'Browser name' );
-            YDDebugUtil::dump( $browser->version, 'Version' );
             YDDebugUtil::dump( $browser->platform, 'Platform' );
             YDDebugUtil::dump( $browser->dotnet, 'Installed .NET runtimes' );
             YDDebugUtil::dump( $browser->getBrowserLanguages(), 'Languages supported by the browser' );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -555,12 +555,22 @@
         // Get the total num of hits
         function getTotalHits() {
             $result = $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics' );
-            if ( empty( $result ) ) {
-                $result = 0;
-            }
-            return $result;
+            return empty( $result ) ? 0 : $result;
         }
 
+        // Get the total num of hits without the bots
+        function getTotalHitsNoBots() {
+            $result = $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics WHERE browser != \'bot\'' );
+            return empty( $result ) ? 0 : $result;
+        }
+
+        // Reset the statistics
+        function resetStats() {
+            $this->db->executeSql( 'truncate #_statistics' );
+            $this->db->executeSql( 'truncate #_statistics_init' );
+            $this->db->executeInsert( '#_statistics_init', array( 'created' => $this->db->getDate( '__NOW__' ) ) );
+        }
+
         // Get the number of items
         function getStatsItemCount() {
             return $this->db->getValue( 'SELECT count(*) FROM #_items' );
@@ -608,9 +618,14 @@
         // Get the browser statistics
         function getStatsBrowser() {
             $browsers = array(
-                'ie' => 'Internet Explorer', 'mozilla' => 'Netscape/Mozilla', 'safari' => 'Apple Safari',
-                'opera' => 'Opera', 'firefox' => 'FireFox', 'other' => t('other'), 'unknown' => t('other'),
-                'rss reader' => 'RSS Reader'
+                'bot'       => 'Automatic Bots',
+                'opera'     => 'Opera',
+                'ie'        => 'Internet Explorer',
+                'safari'    => 'Apple Safari',
+                'konqueror' => 'Konqueror',
+                'feed'      => 'RSS Reader',
+                'mozilla'   => 'Netscape/Mozilla/FireFox',
+                'unknown'   => t('other'),
             );
             $browserStats = $this->db->getRecords(
                 'SELECT browser, SUM(hits) AS hits FROM #_statistics GROUP BY browser ORDER BY hits DESC'
@@ -626,7 +641,13 @@
         // Get the OS statistics
         function getStatsOs() {
             $platforms = array(
-                'win' => 'Windows', 'mac' => 'Macintosh', 'linux' => 'Linux', 'unix' => 'Unix', 'other' => 'Other', 'unknown' => t('other')
+                'win'       => 'Microsoft Windows',
+                'mac'       => 'Apple Macintosh',
+                'linux'     => 'Linux',
+                'unix'      => 'Unix',
+                'bot'       => 'Automatic Bots',
+                'feed'      => 'RSS Reader',
+                'unknown'   => t('other'),
             );
             $osStats = $this->db->getRecords(
                 'SELECT platform, SUM(hits) AS hits FROM #_statistics GROUP BY platform ORDER BY hits DESC'

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -27,6 +27,7 @@
 $GLOBALS['t']['back'] = 'Go back';
 $GLOBALS['t']['yes'] = 'yes';
 $GLOBALS['t']['no'] = 'no';
+$GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';
@@ -168,8 +169,12 @@
 $GLOBALS['t']['num_days_online'] = 'Number of days online';
 $GLOBALS['t']['days'] = 'day(s)';
 $GLOBALS['t']['hits'] = 'hit(s)';
+$GLOBALS['t']['no_bots'] = ' (without automatic bots)';
 $GLOBALS['t']['total_hits'] = 'Total number of hits';
+$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
 $GLOBALS['t']['avg_hits_per_day'] = 'Average number of hits per day';
+$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['total_average_stats'] = 'Totals and averages';
 $GLOBALS['t']['hits_last_6_months'] = 'Hits last 6 months';
 $GLOBALS['t']['all_months'] = 'All months';
 $GLOBALS['t']['hits_last_7_days'] = 'Hits last 7 days';
@@ -185,6 +190,7 @@
 $GLOBALS['t']['items'] = 'item(s)';
 $GLOBALS['t']['top_10_commenters'] = 'The 10 most active commenters';
 $GLOBALS['t']['all_commenters'] = 'All commenters';
+$GLOBALS['t']['reset_stats'] = 'Reset all statistics';
 
 // manage/users.tpl
 $GLOBALS['t']['useremail'] = 'Email address';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -167,8 +167,12 @@
 $GLOBALS['t']['num_days_online'] = 'Nombre de jours en ligne';
 $GLOBALS['t']['days'] = 'jour(s)';
 $GLOBALS['t']['hits'] = 'hit(s)';
+$GLOBALS['t']['no_bots'] = ' (sans automatic bots)';
 $GLOBALS['t']['total_hits'] = 'Nombre total de hits';
+$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
 $GLOBALS['t']['avg_hits_per_day'] = 'Nombre moyen de hits par jour';
+$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['total_average_stats'] = 'Totals et moyens';
 $GLOBALS['t']['hits_last_6_months'] = 'Hits les 6 derniers mois';
 $GLOBALS['t']['all_months'] = 'Tous les mois';
 $GLOBALS['t']['hits_last_7_days'] = 'Hits les 7 derniers jours';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -27,6 +27,7 @@
 $GLOBALS['t']['back'] = 'Ga terug';
 $GLOBALS['t']['yes'] = 'ja';
 $GLOBALS['t']['no'] = 'nee';
+$GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';
@@ -168,9 +169,13 @@
 $GLOBALS['t']['num_days_online'] = 'Aantal dagen online';
 $GLOBALS['t']['days'] = 'dag(en)';
 $GLOBALS['t']['hits'] = 'hit(s)';
+$GLOBALS['t']['no_bots'] = ' (zonder automatic bots)';
 $GLOBALS['t']['total_hits'] = 'Totaal aantal hits';
+$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
 $GLOBALS['t']['avg_hits_per_day'] = 'Gemiddeld aantal hits per dag';
+$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
 $GLOBALS['t']['hits_last_6_months'] = 'Hits van de laatste 6 maanden';
+$GLOBALS['t']['total_average_stats'] = 'Totalen en gemiddelden';
 $GLOBALS['t']['all_months'] = 'Alle maanden';
 $GLOBALS['t']['hits_last_7_days'] = 'Hits laatste 7 dagen';
 $GLOBALS['t']['all_days'] = 'Alle dagen';
@@ -185,6 +190,7 @@
 $GLOBALS['t']['items'] = 'item(s)';
 $GLOBALS['t']['top_10_commenters'] = 'De 10 meest actieve commentators';
 $GLOBALS['t']['all_commenters'] = 'Alle commentators';
+$GLOBALS['t']['reset_stats'] = 'Reset alle statistieken';
 
 // manage/users.tpl
 $GLOBALS['t']['useremail'] = 'Email adres';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-05-19 05:25:25 UTC (rev 1935)
@@ -9,10 +9,14 @@
     <script language="JavaScript">
     <!--
 
-        {literal}function YDConfirmDelete( img ) {{/literal}
-            return confirm( '{t w="confirm_delete"}\n\n"' + img + '"?');
+        {literal}function YDConfirmDelete( name ) {{/literal}
+            return confirm( '{t w="confirm_delete"}\n\n"' + name + '"?');
         {literal}}{/literal}
 
+        {literal}function YDConfirmAction( name ) {{/literal}
+            return confirm( '{t w="confirm_action"}\n\n"' + name + '"' );
+        {literal}}{/literal}
+
         {literal}function YDRowMouseOver( obj ) {{/literal}
             obj.bgColor = '#EDF3FE';
         {literal}}{/literal}

Modified: YDFramework2.0/trunk/examples/weblog/manage/stats.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -20,6 +20,13 @@
                 "update #_statistics set uri = concat( 'item', uri ) where uri like '.php?id=%'"
             );
 
+            // Merge the other and unknown values
+            $this->weblog->db->executeSql( "update #_statistics set browser = 'unknown' where browser = 'other'" );
+            $this->weblog->db->executeSql( "update #_statistics set browser = 'bot' where browser = 'search'" );
+            $this->weblog->db->executeSql( "update #_statistics set browser = 'feed' where browser = 'rss reader'" );
+            $this->weblog->db->executeSql( "update #_statistics set browser = 'mozilla' where browser = 'firefox'" );
+            $this->weblog->db->executeSql( "update #_statistics set platform = 'unknown' where platform = 'other'" );
+
         }
 
         // Special template function to draw a graph
@@ -45,20 +52,24 @@
         function actionDefault() {
 
             // Get the install date
-            $installDate   = $this->weblog->getInstallDate();
-            $daysOnline    = round( ( time() - $installDate ) / 86400 );
-            $totalHits     = $this->weblog->getTotalHits();
-            $avg_hitsaday  = @ intval( $totalHits / $daysOnline );
-            $totalItems    = $this->weblog->getStatsItemCount();
-            $totalComments = $this->weblog->getStatsCommentCount();
+            $installDate        = $this->weblog->getInstallDate();
+            $daysOnline         = round( ( time() - $installDate ) / 86400 );
+            $totalHits          = $this->weblog->getTotalHits();
+            $totalHitsNoBots    = $this->weblog->getTotalHitsNoBots();
+            $avg_hitsaday       = @ intval( $totalHits / $daysOnline );
+            $avg_hitsadayNoBots = @ intval( $totalHitsNoBots / $daysOnline );
+            $totalItems         = $this->weblog->getStatsItemCount();
+            $totalComments      = $this->weblog->getStatsCommentCount();
 
             // Assign these to the template
-            $this->tpl->assign( 'installDate',   $installDate );
-            $this->tpl->assign( 'daysOnline',    $daysOnline );
-            $this->tpl->assign( 'totalHits',     $totalHits );
-            $this->tpl->assign( 'avg_hitsaday',  $avg_hitsaday );
-            $this->tpl->assign( 'totalItems',    $totalItems );
-            $this->tpl->assign( 'totalComments', $totalComments );
+            $this->tpl->assign( 'installDate',        $installDate );
+            $this->tpl->assign( 'daysOnline',         $daysOnline );
+            $this->tpl->assign( 'totalHits',          $totalHits );
+            $this->tpl->assign( 'totalHitsNoBots',    $totalHitsNoBots );
+            $this->tpl->assign( 'avg_hitsaday',       $avg_hitsaday );
+            $this->tpl->assign( 'avg_hitsadayNoBots', $avg_hitsadayNoBots );
+            $this->tpl->assign( 'totalItems',         $totalItems );
+            $this->tpl->assign( 'totalComments',      $totalComments );
 
             // Get the list of the last 6 months
             $last6Months  = $this->weblog->getStatsMonths();
@@ -129,6 +140,12 @@
 
         }
 
+        // Reset the statistics
+        function actionReset() {
+            $this->weblog->resetStats();
+            $this->redirectToAction();
+        }
+
         // Function to calculate the width of the graph elements
         function _calculateGraph( $data, $field='hits' ) {
             if ( sizeof( $data ) > 0 ) {

Modified: YDFramework2.0/trunk/examples/weblog/manage/stats.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/stats.tpl	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/manage/stats.tpl	2006-05-19 05:25:25 UTC (rev 1935)
@@ -6,7 +6,11 @@
 
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr>
-            <th colspan="3" class="adminRowLG">&raquo; {t w="general_stats"}</th>
+            <th class="adminRowLG">&raquo; {t w="general_stats"}</th>
+            <th colspan="2" class="adminRowLGR">
+                <a href="{$YD_SELF_SCRIPT}?do=reset"
+                 onClick="return YDConfirmAction( '{t w="reset_stats"}' );"><b>{t w="reset_stats"}</b></a>
+            </th>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL" width="350">{t w="installed_since"}</td>
@@ -24,18 +28,30 @@
             <td class="adminRowL">{t w="totalComments"}</td>
             <td class="adminRowL" colspan="2">{$totalComments} {t w="comments" lower=true}</td>
         </tr>
+    </table>
+
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+        <tr><td colspan="3">&nbsp;</td></tr>
+        <tr>
+            <th colspan="3" class="adminRowLG">&raquo; {t w="total_average_stats"}</th>
+        </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="total_hits"}</td>
             <td class="adminRowL" colspan="2">{$totalHits} {t w="hits"}</td>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="total_hits_no_bots"}</td>
+            <td class="adminRowL" colspan="2">{$totalHitsNoBots} {t w="hits"}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="avg_hits_per_day"}</td>
             <td class="adminRowL" colspan="2">{$avg_hitsaday} {t w="hits"}</td>
         </tr>
-    </table>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="avg_hits_per_day_no_bots"}</td>
+            <td class="adminRowL" colspan="2">{$avg_hitsadayNoBots} {t w="hits"}</td>
+        </tr>
 
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-
         <tr><td colspan="3">&nbsp;</td></tr>
         <tr>
             <th class="adminRowLG">&raquo; {t w="hits_last_6_months"}</th>

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-16 09:45:45 UTC (rev 1934)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-19 05:25:25 UTC (rev 1935)
@@ -12,9 +12,6 @@
         // Class constructor
         function xml() {
 
-            // Fix up the user agent (to make sure RSS Readers show up in the user agents)
-            $_SERVER['HTTP_USER_AGENT'] = 'RSS Reader ' . $_SERVER['HTTP_USER_AGENT'];
-
             // Initialize the parent
             $this->YDWeblogRequest();
 



From pclaerhout at berlios.de  Fri May 19 13:16:45 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 13:16:45 +0200
Subject: [ydf-devel] r1936 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200605191116.k4JBGjiA001239@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 13:16:42 +0200 (Fri, 19 May 2006)
New Revision: 1936

Modified:
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
The RSS feeds are now only counted if they are really output to the browser (so it excludes the cached ones).

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-19 05:25:25 UTC (rev 1935)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-05-19 11:16:42 UTC (rev 1936)
@@ -15,9 +15,12 @@
             // Initialize the parent
             $this->YDWeblogRequest();
 
-            // Log the request
+        }
+
+        // Function to output the feed
+        function outputXml( $type ) {
+            $this->feed->outputXml( $type );
             $this->_logRequest();
-
         }
 
         // Default action
@@ -28,37 +31,37 @@
         // RSS action
         function actionRss() {
             $this->initMainFeed();
-            $this->feed->outputXml( 'RSS2.0' );
+            $this->outputXml( 'RSS2.0' );
         }
 
         // ATOM action
         function actionAtom() {
             $this->initMainFeed();
-            $this->feed->outputXml( 'ATOM' );
+            $this->outputXml( 'ATOM' );
         }
 
         // RSS / Comments action
         function actionRssComments() {
             $this->initCommentsFeed();
-            $this->feed->outputXml( 'RSS2.0' );
+            $this->outputXml( 'RSS2.0' );
         }
 
         // ATOM / Comments action
         function actionAtomComments() {
             $this->initCommentsFeed();
-            $this->feed->outputXml( 'ATOM' );
+            $this->outputXml( 'ATOM' );
         }
 
         // RSS / Gallery action
         function actionRssGallery() {
             $this->initGalleryFeed();
-            $this->feed->outputXml( 'RSS2.0' );
+            $this->outputXml( 'RSS2.0' );
         }
 
         // ATOM / Gallery action
         function actionAtomGallery() {
             $this->initGalleryFeed();
-            $this->feed->outputXml( 'ATOM' );
+            $this->outputXml( 'ATOM' );
         }
 
         // Function to init the main feed



From pclaerhout at berlios.de  Fri May 19 13:43:47 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 13:43:47 +0200
Subject: [ydf-devel] r1937 - in YDFramework2.0/trunk/examples/weblog: include skins/default
Message-ID: <200605191143.k4JBhl4c004391@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 13:43:46 +0200 (Fri, 19 May 2006)
New Revision: 1937

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Cleaned up the printed versions of the pages (cleaned up the stylesheets).

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-05-19 11:16:42 UTC (rev 1936)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-05-19 11:43:46 UTC (rev 1937)
@@ -141,6 +141,7 @@
             $this->tpl->assign( 'weblog_title',                YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
             $this->tpl->assign( 'weblog_description',          YDConfig::get( 'weblog_description', 'Untitled Weblog Description' ) );
             $this->tpl->assign( 'weblog_dir',                  YDUrl::makeLinkAbsolute( '.' ) );
+            $this->tpl->assign( 'weblog_current_url',          YDUrl::makeLinkAbsolute( YD_SELF_URI ) );
             $this->tpl->assign( 'weblog_link',                 YDUrl::makeLinkAbsolute( 'index.php' ) );
             $this->tpl->assign( 'weblog_link_rss',             YDUrl::makeLinkAbsolute( 'xml.php?do=rss' ) );
             $this->tpl->assign( 'weblog_link_atom',            YDUrl::makeLinkAbsolute( 'xml.php?do=atom' ) );

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl	2006-05-19 11:16:42 UTC (rev 1936)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl	2006-05-19 11:43:46 UTC (rev 1937)
@@ -18,8 +18,16 @@
         #header     {literal}{{/literal} margin: 0 !important; margin: 0 0 0 1px; padding: 1px; height: 198px; width: 758px;    {literal}}{/literal}
         #headerimg  {literal}{{/literal} margin: 7px 9px 0; height: 192px; width: 740px;                                        {literal}}{/literal}
         .bbtextarea {literal}{{/literal} width: 650px; height: 160px;                                                           {literal}}{/literal}
+        .printonly  {literal}{{/literal} display: none; {literal}}{/literal}
+        .screenonly {literal}{{/literal} display: inline; {literal}}{/literal}
     </style>
 
+    <style type="text/css" media="print">
+        #sidebar    {literal}{{/literal} display: none;  {literal}}{/literal}
+        .printonly  {literal}{{/literal} display: inline; {literal}}{/literal}
+        .screenonly {literal}{{/literal} display: none; {literal}}{/literal}
+    </style>
+
     <link rel="alternate" type="application/rss+xml"  title="RSS 2.0"  href="{$weblog_link_rss}"  />
     <link rel="alternate" type="text/xml"             title="RSS 0.92"  href="{$weblog_link_rss}"  />
     <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="{$weblog_link_atom}" />
@@ -48,6 +56,9 @@
                 <div class="description">
                     {if $weblog_description}{$weblog_description}{else}{t w="another_powered_by"}{/if}
                 </div>
+                <div class="printonly">
+                    <p><a href="{$weblog_current_url}">{$weblog_current_url}</a></p>
+                </div>
             </div>
         </div>
 

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 11:16:42 UTC (rev 1936)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 11:43:46 UTC (rev 1937)
@@ -3,13 +3,15 @@
 <div id="content" class="narrowcolumn">
 
     {if $item.older_id or $item.newer_id}
-        <div class="navigation">
-            {if $item.older_id}
-                <div class="alignleft">&laquo; <a href="{$item.older_id|link_item}">{t w="older_post"}</a></div>
-            {/if}
-            {if $item.newer_id}
-                <div class="alignright"><a href="{$item.newer_id|link_item}">{t w="newer_post"}</a> &raquo;</div>
-            {/if}
+        <div class="screenonly">
+            <div class="navigation">
+                {if $item.older_id}
+                    <div class="alignleft">&laquo; <a href="{$item.older_id|link_item}">{t w="older_post"}</a></div>
+                {/if}
+                {if $item.newer_id}
+                    <div class="alignright"><a href="{$item.newer_id|link_item}">{t w="newer_post"}</a> &raquo;</div>
+                {/if}
+            </div>
         </div>
     {/if}
 



From pclaerhout at berlios.de  Fri May 19 14:02:01 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 14:02:01 +0200
Subject: [ydf-devel] r1938 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200605191202.k4JC21Z4006411@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 14:02:00 +0200 (Fri, 19 May 2006)
New Revision: 1938

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php
   YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl
Log:
Added a table that shows the database contents to the database backup screen.

Modified: YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php	2006-05-19 11:43:46 UTC (rev 1937)
+++ YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php	2006-05-19 12:02:00 UTC (rev 1938)
@@ -20,6 +20,19 @@
         // Default action
         function actionDefault() {
 
+            // Get the table statistics
+            $tables_size = 0;
+            $tables = $this->weblog->db->getRecords( 'SHOW TABLE STATUS' );
+            foreach ( $tables as $key=>$table ) {
+                $tables[$key] = array();
+                $tables[$key]['name'] = $table['name'];
+                $tables[$key]['rows'] = intval( $table['rows'] );
+                $tables[$key]['size'] = intval( $table['data_length'] ) + intval( $table['index_length'] );
+                $tables_size = $tables_size + $tables[$key]['size'];
+            }
+            $this->tpl->assign( 'tables', $tables );
+            $this->tpl->assign( 'tables_size', $tables_size );
+
             // The backup types we have
             $bck_types = array(
                 0 => t( 'bck_full' ) . '<br/>',

Modified: YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl	2006-05-19 11:43:46 UTC (rev 1937)
+++ YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl	2006-05-19 12:02:00 UTC (rev 1938)
@@ -17,6 +17,24 @@
     </table></p>
 {/if}
 
+<table width="700" cellspacing="0" cellpadding="0" border="0">
+    <tr>
+        <th class="adminRowLG" colspan="3">&raquo; {t w="tables"}</th>
+    </tr>
+    {foreach from=$tables item="table"}
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{$table.name}</td>
+            <td class="adminRowR" width="200">{$table.size|fmtfilesize}</td>
+            <td class="adminRowR" width="200">{$table.rows} {t w="rows"}</td>
+        </tr>
+    {/foreach}
+    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+        <td class="adminRowLNB"></td>
+        <td class="adminRowRNB" align="right" width="200">{$tables_size|fmtfilesize}</td>
+        <td class="adminRowLNB"></td>
+    </tr>
+</table>
+
 {$form.tag}
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr>



From pclaerhout at berlios.de  Fri May 19 14:09:17 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 14:09:17 +0200
Subject: [ydf-devel] r1939 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200605191209.k4JC9Hig007317@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 14:09:17 +0200 (Fri, 19 May 2006)
New Revision: 1939

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Added the missing languages.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:02:00 UTC (rev 1938)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:09:17 UTC (rev 1939)
@@ -28,6 +28,8 @@
 $GLOBALS['t']['yes'] = 'yes';
 $GLOBALS['t']['no'] = 'no';
 $GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
+$GLOBALS['t']['rows'] = 'row(s)';
+$GLOBALS['t']['tables'] = 'Tables';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:02:00 UTC (rev 1938)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:09:17 UTC (rev 1939)
@@ -28,6 +28,8 @@
 $GLOBALS['t']['yes'] = 'ja';
 $GLOBALS['t']['no'] = 'nee';
 $GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
+$GLOBALS['t']['rows'] = 'rij(en)';
+$GLOBALS['t']['tables'] = 'Tabellen';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';



From pclaerhout at berlios.de  Fri May 19 14:09:37 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 14:09:37 +0200
Subject: [ydf-devel] r1940 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200605191209.k4JC9bL4007369@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 14:09:37 +0200 (Fri, 19 May 2006)
New Revision: 1940

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
Log:
Fixed a small coding error.

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-05-19 12:09:17 UTC (rev 1939)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-05-19 12:09:37 UTC (rev 1940)
@@ -23,7 +23,7 @@
             // Get the general PHP info
             ob_start();
             phpinfo( INFO_GENERAL );
-            $phpInfo .= ob_get_contents();
+            $phpInfo = ob_get_contents();
             ob_end_clean();
 
             // Get the right part



From pclaerhout at berlios.de  Fri May 19 14:59:55 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 14:59:55 +0200
Subject: [ydf-devel] r1941 - in YDFramework2.0/trunk/examples/weblog: . include include/languages skins/default
Message-ID: <200605191259.k4JCxt0P012627@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 14:59:51 +0200 (Fri, 19 May 2006)
New Revision: 1941

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/index.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Added an option called "related items". It basically pics a number of random posts from the same category as the current post.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -319,6 +319,39 @@
             return $this->_fixItems( $this->db->getRecords( $sql, $limit, $offset ) );
         }
 
+        // Get related items
+        function getRelatedItemsByItem( $limit, $item ) {
+
+            // Get the items from the same category
+            $items = $this->getItems(
+                -1, -1, 'created desc, title', 'AND is_draft = 0 AND i.category_id = '
+              . $this->str( $item['category_id'] ) . ' and i.id <> ' . $this->str( $item['id'] )
+            );
+
+            // Shuffle the items
+            shuffle( $items );
+
+            // Get the right rows
+            $items = array_slice( $items, 0, $limit );
+
+            // Sort them by date
+            $sorted = array();
+            foreach ( $items as $key=>$item ) {
+                $sorted[ $key ] = intval( $item['created'] );
+            }
+            sort( $sorted );
+
+            // Rearrange the array
+            $sorted_items = array();
+            foreach ( $sorted as $key=>$date ) {
+                array_push( $sorted_items, $items[ $key ] );
+            }
+
+            // Return the items
+            return array_values( $sorted_items );
+
+        }
+
         // Get a publc item by it's ID
         function getPublicItemByID( $item_id ) {
             return $this->getItem( 'AND is_draft = 0 AND i.id = ' . $this->str( $item_id ) );

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,7 @@
 $GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
 $GLOBALS['t']['rows'] = 'row(s)';
 $GLOBALS['t']['tables'] = 'Tables';
+$GLOBALS['t']['related_items'] = 'Related items to';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,7 @@
 $GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
 $GLOBALS['t']['rows'] = 'rij(en)';
 $GLOBALS['t']['tables'] = 'Tabellen';
+$GLOBALS['t']['related_items'] = 'Gerelateerde items aan';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';

Modified: YDFramework2.0/trunk/examples/weblog/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/index.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/index.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -28,7 +28,7 @@
 
             // Get the weblog items and 5 older items
             $items     = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
-            $old_items = $this->weblog->getPublicItems( 5, sizeof( $items ) );
+            $old_items = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ), sizeof( $items ) );
 
             // Assign them to the template
             $this->tpl->assign( 'items',     $items );

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,9 @@
             $item  = @ $this->weblog->getPublicItemById( $id );
             $this->redirectIfMissing( $item );
 
+            // Get the related items
+            $related_items = $this->weblog->getRelatedItemsByItem( YDConfig::get( 'weblog_entries_fp', 5 ), $item );
+
             // Convert the list of images to a table of 3 columns
             $item['images_as_table'] = YDArrayUtil::convertToTable( $item['images'], 3, true );
 
@@ -38,6 +41,7 @@
 
             // Add them to the template
             $this->tpl->assign( 'item', $item );
+            $this->tpl->assign( 'related_items', $related_items );
             $this->tpl->assign( 'comments', $comments );
 
             // Only if comments are allowed

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 12:59:51 UTC (rev 1941)
@@ -78,6 +78,22 @@
 
     </div>
 
+    <a name="related"></a>
+    {if $related_items}
+        <h3>{t w="related_items"} &#8220;{$item.title}&#8221;</h3>
+        <ul>
+            {foreach from=$related_items item="rel_item"}
+                <li>
+                    {$rel_item.created|date:'%d %B %Y'|lower}:
+                    <a href="{$rel_item|@link_item}">{$rel_item.title}</a>
+                    {if $rel_item.num_comments != '0' or $rel_item.num_images != '0'}
+                        <span class="postmetadata">({$rel_item|@text_num_images:false}{if $rel_item.num_comments != '0' and $rel_item.num_images != '0'}, {/if}{$rel_item|@text_num_comments:false})</span>
+                    {/if}
+                </li>
+            {/foreach}
+        </ul>
+    {/if}
+
     <a name="comment"></a>
     {if $comments}
         <h3>{$item|@text_num_comments:true} {t w="to"} &#8220;{$item.title}&#8221;</h3>



From maximus_meridius79 at yahoo.com  Fri May 19 15:01:18 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Fri, 19 May 2006 06:01:18 -0700 (PDT)
Subject: [ydf-devel] Fix action urls generated by YDForm (convert & to &amp;)
Message-ID: <20060519130118.52962.qmail@web53806.mail.yahoo.com>

Hi,

I have put a small fix in the YDForm constructor so
that it produces 
valid Urls for form action. i.e. & is converted to
&amp;.

This is the code added after the variables are
initialised:

            // clean the action url
            $url = new YDUrl( $this->_action );
            $this->_action = $url->getUrl();


I registered on the developer site with the intention
of submitting a 
bug report but the registration confirmation mail did
not come.

Thanks,

Graeme

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 


From pclaerhout at berlios.de  Fri May 19 15:11:59 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 15:11:59 +0200
Subject: [ydf-devel] r1942 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605191311.k4JDBxAR013758@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 15:11:58 +0200 (Fri, 19 May 2006)
New Revision: 1942

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
The YDForm class now constructs correct action URLs.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 12:59:51 UTC (rev 1941)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 13:11:58 UTC (rev 1942)
@@ -176,6 +176,10 @@
             $this->registerRenderer( 'html', 'YDFormRenderer_html', 'YDFormRenderer_html.php' );
             $this->registerRenderer( 'xml', 'YDFormRenderer_xml', 'YDFormRenderer_xml.php' );
 
+            // Clean the action URL
+            $url = new YDUrl( $this->_action );
+            $this->_action = $url->getUrl();
+
         }
 
         /**



From pieter at yellowduck.be  Fri May 19 15:10:01 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 19 May 2006 15:10:01 +0200
Subject: [ydf-devel] Fix action urls generated by YDForm (convert & to &amp;)
In-Reply-To: <20060519130118.52962.qmail@web53806.mail.yahoo.com>
References: <20060519130118.52962.qmail@web53806.mail.yahoo.com>
Message-ID: <4aef63030605190610ma2375afudbb78fcf086db3fa@mail.gmail.com>

Added this in build 1942.

pieter

On 5/19/06, maximus meridius <maximus_meridius79 at yahoo.com> wrote:
>
> Hi,
>
> I have put a small fix in the YDForm constructor so
> that it produces
> valid Urls for form action. i.e. & is converted to
> &.
>
> This is the code added after the variables are
> initialised:
>
>            // clean the action url
>            $url = new YDUrl( $this->_action );
>            $this->_action = $url->getUrl();
>
>
> I registered on the developer site with the intention
> of submitting a
> bug report but the registration confirmation mail did
> not come.
>
> Thanks,
>
> Graeme
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060519/6f095372/attachment.html>

From maximus_meridius79 at yahoo.com  Fri May 19 15:31:02 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Fri, 19 May 2006 06:31:02 -0700 (PDT)
Subject: [ydf-devel] Fix action urls generated by YDForm (convert & to &amp;)
Message-ID: <20060519133102.24455.qmail@web53814.mail.yahoo.com>

Correction!

            // clean the action url
            $url = new YDUrl( $this->_action );
            $this->_action = $url->getUri();

The previous code was putting localhost in the url.

Regards,

Graeme

maximus meridius wrote:
> Hi,
>
> I have put a small fix in the YDForm constructor so
> that it produces 
> valid Urls for form action. i.e. & is converted to
> &amp;.
>
> This is the code added after the variables are
> initialised:
>
>             // clean the action url
>             $url = new YDUrl( $this->_action );
>             $this->_action = $url->getUrl();
>
>
> I registered on the developer site with the
intention
> of submitting a 
> bug report but the registration confirmation mail
did
> not come.
>
> Thanks,
>
> Graeme
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam
protection around 
> http://mail.yahoo.com 
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
>
http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>   


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 


From pclaerhout at berlios.de  Fri May 19 16:34:05 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 16:34:05 +0200
Subject: [ydf-devel] r1943 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605191434.k4JEY5W7022513@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 16:33:57 +0200 (Fri, 19 May 2006)
New Revision: 1943

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
The form url is now no longer including the hostname, just the path.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 13:11:58 UTC (rev 1942)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 14:33:57 UTC (rev 1943)
@@ -178,7 +178,7 @@
 
             // Clean the action URL
             $url = new YDUrl( $this->_action );
-            $this->_action = $url->getUrl();
+            $this->_action = $url->getUri();
 
         }
 



From pieter at yellowduck.be  Fri May 19 16:32:07 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 19 May 2006 16:32:07 +0200
Subject: [ydf-devel] Fix action urls generated by YDForm (convert & to &amp;)
In-Reply-To: <20060519133102.24455.qmail@web53814.mail.yahoo.com>
References: <20060519133102.24455.qmail@web53814.mail.yahoo.com>
Message-ID: <4aef63030605190732g7eb911ebo6361f2a10d92ea9a@mail.gmail.com>

Fixed in build 1943.

pieter

On 5/19/06, maximus meridius <maximus_meridius79 at yahoo.com> wrote:
>
> Correction!
>
>            // clean the action url
>            $url = new YDUrl( $this->_action );
>            $this->_action = $url->getUri();
>
> The previous code was putting localhost in the url.
>
> Regards,
>
> Graeme
>
> maximus meridius wrote:
> > Hi,
> >
> > I have put a small fix in the YDForm constructor so
> > that it produces
> > valid Urls for form action. i.e. & is converted to
> > &.
> >
> > This is the code added after the variables are
> > initialised:
> >
> >             // clean the action url
> >             $url = new YDUrl( $this->_action );
> >             $this->_action = $url->getUrl();
> >
> >
> > I registered on the developer site with the
> intention
> > of submitting a
> > bug report but the registration confirmation mail
> did
> > not come.
> >
> > Thanks,
> >
> > Graeme
> >
> > __________________________________________________
> > Do You Yahoo!?
> > Tired of spam?  Yahoo! Mail has the best spam
> protection around
> > http://mail.yahoo.com
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> >
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
> >
> >
>
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060519/110dc6a9/attachment.html>

From phmassa at gmail.com  Fri May 19 16:37:41 2006
From: phmassa at gmail.com (ph-m)
Date: Fri, 19 May 2006 16:37:41 +0200
Subject: [ydf-devel] r1943 - YDFramework2.0/trunk/YDFramework2/YDClasses
In-Reply-To: <200605191434.k4JEY5W7022513@sheep.berlios.de>
References: <200605191434.k4JEY5W7022513@sheep.berlios.de>
Message-ID: <829084a60605190737v6a3cffb7m7ca99d92ff10db@mail.gmail.com>

On 5/19/06, pclaerhout at BerliOS <pclaerhout at berlios.de> wrote:
> Author: pclaerhout
> Date: 2006-05-19 16:33:57 +0200 (Fri, 19 May 2006)
> New Revision: 1943
>
> Modified:
>    YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
> Log:
> The form url is now no longer including the hostname, just the path.
>
> Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
> ===================================================================
> --- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php      2006-05-19 13:11:58 UTC (rev 1942)
> +++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php      2006-05-19 14:33:57 UTC (rev 1943)
> @@ -178,7 +178,7 @@
>
>              // Clean the action URL
>              $url = new YDUrl( $this->_action );
> -            $this->_action = $url->getUrl();
> +            $this->_action = $url->getUri();
>
>          }
>
>

hi, with YDUrl, I've got

PHP Fatal error:  Cannot instantiate non-existent class:  ydurl in
e:\\wamp\\phpshare\\includes\\YDFramework2\\YDClasses\\YDForm.php on
line 180

with PHP 4.4.2

thanks
ph-m
ps : don't forget php4 ;)


From pclaerhout at berlios.de  Fri May 19 17:33:16 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 May 2006 17:33:16 +0200
Subject: [ydf-devel] r1944 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605191533.k4JFXGAa030276@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-19 17:33:15 +0200 (Fri, 19 May 2006)
New Revision: 1944

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Added a missing include for YDUrl in YDForm.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 14:33:57 UTC (rev 1943)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-05-19 15:33:15 UTC (rev 1944)
@@ -33,6 +33,7 @@
 
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDRequest.php');
+    include_once( YD_DIR_HOME_CLS . '/YDUrl.php');
 
     /**
      *  This class defines an object oriented HTML form.



From pieter at yellowduck.be  Fri May 19 17:31:21 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 19 May 2006 17:31:21 +0200
Subject: [ydf-devel] r1943 - YDFramework2.0/trunk/YDFramework2/YDClasses
In-Reply-To: <829084a60605190737v6a3cffb7m7ca99d92ff10db@mail.gmail.com>
References: <200605191434.k4JEY5W7022513@sheep.berlios.de>
	 <829084a60605190737v6a3cffb7m7ca99d92ff10db@mail.gmail.com>
Message-ID: <4aef63030605190831r1611e721td652d08d6e740eff@mail.gmail.com>

Fixed in build 1944.

p.

On 5/19/06, ph-m <phmassa at gmail.com> wrote:
>
> On 5/19/06, pclaerhout at BerliOS <pclaerhout at berlios.de> wrote:
> > Author: pclaerhout
> > Date: 2006-05-19 16:33:57 +0200 (Fri, 19 May 2006)
> > New Revision: 1943
> >
> > Modified:
> >    YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
> > Log:
> > The form url is now no longer including the hostname, just the path.
> >
> > Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
> > ===================================================================
> > --- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php      2006-05-19
> 13:11:58 UTC (rev 1942)
> > +++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php      2006-05-19
> 14:33:57 UTC (rev 1943)
> > @@ -178,7 +178,7 @@
> >
> >              // Clean the action URL
> >              $url = new YDUrl( $this->_action );
> > -            $this->_action = $url->getUrl();
> > +            $this->_action = $url->getUri();
> >
> >          }
> >
> >
>
> hi, with YDUrl, I've got
>
> PHP Fatal error:  Cannot instantiate non-existent class:  ydurl in
> e:\\wamp\\phpshare\\includes\\YDFramework2\\YDClasses\\YDForm.php on
> line 180
>
> with PHP 4.4.2
>
> thanks
> ph-m
> ps : don't forget php4 ;)
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060519/44891872/attachment.html>

From pclaerhout at berlios.de  Mon May 22 10:46:19 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 May 2006 10:46:19 +0200
Subject: [ydf-devel] r1945 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200605220846.k4M8kJ4f002329@sheep.berlios.de>

Author: pclaerhout
Date: 2006-05-22 10:46:13 +0200 (Mon, 22 May 2006)
New Revision: 1945

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Added some more bots that can be recognized by YDBrowserInfo.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-19 15:33:15 UTC (rev 1944)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-05-22 08:46:13 UTC (rev 1945)
@@ -808,7 +808,7 @@
 
             // The matching list for browsers
             $browsers = array(
-                'bot'       => array( 'bot', 'Yahoo! Slurp', 'crawler' ),
+                'bot'       => array( 'bot', 'Yahoo! Slurp', 'crawler', 'scooter', 'mercator', 'altavista', 'Gulliver', 'spider', 'Ask Jeeves' ),
                 'opera'     => array( 'opera' ),
                 'ie'        => array( 'msie' ),
                 'safari'    => array( 'safari' ),



From ximian at berlios.de  Mon May 29 19:20:12 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Mon, 29 May 2006 19:20:12 +0200
Subject: [ydf-devel] r1946 - in YDFramework2.0/trunk/YDFramework2: YDClasses/YDCMComponent YDClasses/YDCMComponent/languages YDClasses/YDFormElements addons/YDCMHelpdesk
Message-ID: <200605291720.k4THKCJd030434@sheep.berlios.de>

Author: ximian
Date: 2006-05-29 19:19:32 +0200 (Mon, 29 May 2006)
New Revision: 1946

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
Log:
- YDCMHelpdesk component:
  * new methods, deleted some tables

- new generic translation

- ajaxGrid is redesigned to be extensible

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-29 17:19:32 UTC (rev 1946)
@@ -786,32 +786,30 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1369" ColName="component_id" PrevColName="ticket_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1671" ColName="state_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1371" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1673" ColName="urgency_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1372" ColName="subject" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1369" ColName="component_id" PrevColName="ticket_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1374" ColName="urgency_id" PrevColName="urgency" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="">
+<COLUMN ID="1371" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1375" ColName="state_id" PrevColName="state" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="1" Comments="">
+<COLUMN ID="1372" ColName="subject" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
 <COLUMN ID="1376" ColName="text" PrevColName="" Pos="6" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
@@ -834,12 +832,6 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1382" ColName="reported_by_type" PrevColName="reported_to_local" Pos="12" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
 <COLUMN ID="1380" ColName="reported_by_local" PrevColName="reported_to_in" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
@@ -849,13 +841,12 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1601" ColName="assignedto_user" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1676" ColName="reported_by_type" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1602" ColName="assignedto_type" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1601" ColName="assignedto_user" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
@@ -870,17 +861,18 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1675" ColName="assignedto_type" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1409" />
 </RELATIONS_START>
 <RELATIONS_END>
 <RELATION_END ID="1383" />
-<RELATION_END ID="1392" />
-<RELATION_END ID="1413" />
 <RELATION_END ID="1575" />
-<RELATION_END ID="1608" />
-<RELATION_END ID="1610" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1582" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -890,61 +882,6 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1384" Tablename="YDCMHelpdesk_state" PrevTableName="Table_12" XPos="1760" YPos="1570" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="22" >
-<COLUMNS>
-<COLUMN ID="1386" ColName="state_id" PrevColName="" Pos="0" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1388" ColName="description" PrevColName="state_name" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1392" />
-</RELATIONS_START>
-<INDICES>
-<INDEX ID="1387" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1386" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1393" Tablename="YDCMHelpdesk_urgency" PrevTableName="Table_13" XPos="1760" YPos="1450" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="24" >
-<COLUMNS>
-<COLUMN ID="1395" ColName="urgency_id" PrevColName="" Pos="0" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1397" ColName="description" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1416" ColName="color" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(45)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1413" />
-</RELATIONS_START>
-<INDICES>
-<INDEX ID="1396" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1395" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
 <TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1760" YPos="1310" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
 <COLUMNS>
 <COLUMN ID="1403" ColName="response_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
@@ -1196,32 +1133,6 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1590" Tablename="YDCMHelpdesk_type" PrevTableName="Table_20" XPos="1480" YPos="1640" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" >
-<COLUMNS>
-<COLUMN ID="1592" ColName="type_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1594" ColName="description" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="eg: \aemail\a, \aphone\a">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1608" />
-<RELATION_START ID="1610" />
-</RELATIONS_START>
-<INDICES>
-<INDEX ID="1593" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1592" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
 <TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="180" YPos="940" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
 <COLUMNS>
 <COLUMN ID="1631" ColName="download_is" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
@@ -1257,10 +1168,8 @@
 <RELATION ID="1341" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1163" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="16" />
 <RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="38" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="38" CaptionOffsetY="19" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
 <RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="1" EndIntervalOffsetY="10" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
-<RELATION ID="1392" RelationName="state_id" Kind="2" SrcTable="1384" DestTable="1367" FKFields="state_id=state_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="23" />
 <RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
 <RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1413" RelationName="urgency_id" Kind="2" SrcTable="1393" DestTable="1367" FKFields="urgency_id=urgency_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-4" CaptionOffsetY="3" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="26" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="49" CaptionOffsetY="-12" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
 <RELATION ID="1527" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1519" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="18" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="33" />
@@ -1270,8 +1179,6 @@
 <RELATION ID="1572" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1565" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="73" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="10" EndIntervalOffsetY="4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
 <RELATION ID="1573" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1565" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="109" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="3" EndIntervalOffsetY="3" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
 <RELATION ID="1575" RelationName="component_id" Kind="2" SrcTable="1565" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="51" CaptionOffsetY="-40" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
-<RELATION ID="1608" RelationName="reported_by_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=reported_by_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-61" CaptionOffsetY="-38" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
-<RELATION ID="1610" RelationName="assignedto_type" Kind="2" SrcTable="1590" DestTable="1367" FKFields="type_id=assignedto_type\n" FKFieldsComments="\n" relDirection="1" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="58" CaptionOffsetY="-38" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="44" />
 <RELATION ID="1526" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1519" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="20" CaptionOffsetY="-20" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="32" />
 <RELATION ID="1646" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
 <RELATION ID="1648" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="user_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="52" />

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-05-29 17:19:32 UTC (rev 1946)
@@ -14,7 +14,10 @@
 $GLOBALS['t']['public'] = 'Public';
 $GLOBALS['t']['private'] = 'Private';
 $GLOBALS['t']['not allowed'] = 'Not allowed';
+$GLOBALS['t']['total'] = 'Total';
+$GLOBALS['t']['previous'] = 'Previous';
+$GLOBALS['t']['next'] = 'Next';
 
 $GLOBALS['t']['add page'] = 'Add page';
-
+$GLOBALS['t']['please wait'] = 'Please wait';
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-05-29 17:19:32 UTC (rev 1946)
@@ -14,7 +14,10 @@
 $GLOBALS['t']['public'] = 'P&uacute;blico';
 $GLOBALS['t']['private'] = 'Privado';
 $GLOBALS['t']['not allowed'] = 'N&atilde;o permitido';
+$GLOBALS['t']['total'] = 'Total';
+$GLOBALS['t']['previous'] = 'Anterior';
+$GLOBALS['t']['next'] = 'Seguinte';
 
 $GLOBALS['t']['add page'] = 'Adicionar p&aacute;gina';
-
+$GLOBALS['t']['please wait'] = 'Por favor aguarde';
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2006-05-29 17:19:32 UTC (rev 1946)
@@ -44,7 +44,7 @@
          *        @param $attributes        (optional) The attributes for the form element.
          *        @param $options                (optional) The options for the elment.
          */
-        function YDFormElement_Grid( $form = '', $name = '_gr', $label='', $attributes=array(), $options=array() ) {
+        function YDFormElement_Grid( $form = '', $name = 'gr', $label='', $attributes=array(), $options=array() ) {
 
             // Initialize the parent
             $this->YDFormElement( $form, $name, $label, $attributes, $options );
@@ -60,6 +60,17 @@
 
             // Indicate we are a button type
             $this->_isButton = false;
+
+			// column names
+			$this->columns = array();
+			
+			// default values
+			$this->defaults = array();
+			
+			$this->form = new YDForm( 'gridform' . $name );
+			$this->form->addElement( 'hidden', 'gr_column',    '', array('id' => 'gr_column') );
+			$this->form->addElement( 'hidden', 'gr_direction', '', array('id' => 'gr_direction') );
+			$this->form->addElement( 'hidden', 'gr_page',      '', array('id' => 'gr_page') );
         }
 
 
@@ -76,14 +87,53 @@
 
         /**
          *      This function adds a ajax event to handle header calls
+         *
+         *      @param $ajax    YDAjax object to assign grid events
+         *      @param $method  Method name where to send events
+         *
          */
 		function setAjax( &$ajax, $method ){
 		
-			$ajax->addEvent( 'ticketReload(order, dir, page)', $method, array( 'var order', 'var dir', 'var page' ) );
+			$ajax->addForm( $this->form );
+			$ajax->addEvent( 'ticketReload()', $method, $this->form->getName() );
 		}
 
 
         /**
+         *      This function returns the grid form object
+         */
+		function getForm(){
+
+			// return form object
+			return $this->form;
+		}
+
+
+        /**
+         *      This function defines all columns
+         *
+         *      @param $columns    Column names
+         *
+         */
+		function setColumns( $columns ){
+
+			$this->columns = $columns;
+		}
+
+
+        /**
+         *      This function defines all columns
+         *
+         *      @param $defaults    Default details for grid columns
+         *
+         */
+		function setDefaults( $defaults ){
+
+			$this->defaults = $defaults;
+		}
+
+
+        /**
          *        This function will return the element as HTML.
          *
          *        @returns        The form element as HTML text.
@@ -96,9 +146,15 @@
             );
             $attribs = array_merge( $this->_attributes, $attribs );
 
+			// set form defaults
+			if ( isset ( $this->defaults ) ) $this->form->setDefaults( $this->defaults );
+
 			// get record template and assign recordset
 			$template_record = new YDTemplate();
 			$template_record->assign( 'recordset', $this->_value );
+			$template_record->assign( 'columns',   $this->columns );
+			$template_record->assign( 'defaults',  $this->defaults );
+			$template_record->assignForm( 'form',  $this->form );
 
             // Get the HTML
 			return $template_record->fetch( dirname( __FILE__ ) . '/YDFormElement_Grid.tpl' );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.tpl	2006-05-29 17:19:32 UTC (rev 1946)
@@ -1,34 +1,34 @@
+
 <table width="100%" border="0">
   <tr>
     <td align="right">
-	<span class="field_previous" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$recordset->pagePrevious}');">{t w="previous"}</span>
+	<span class="field_previous" onClick="document.getElementById('gr_page').value='{$recordset->pagePrevious}';ticketReload();">&laquo; {t w="previous"}</span>
+	&nbsp;
     {foreach from=$recordset->pages item="page"}
 		{if ($page != $recordset->page)}
-			<span class="field_page" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$page}');">{$page}</span>
+			<span class="field_page" onClick="document.getElementById('gr_page').value='{$page}';ticketReload();">{$page}</span>
 		{else}
 			<span class="field_page_current">{$page}</span>
 		{/if}
 	{/foreach}
-	<span class="field_next" onClick="ticketReload('{$recordset->getCurrentField()}', '{$recordset->getSortdirection()}', '{$recordset->pageNext}');">{t w="next"}</span>
+	&nbsp;
+	<span class="field_next" onClick="document.getElementById('gr_page').value='{$recordset->pageNext}';ticketReload();">{t w="next"} &raquo;</span>
 	</td>
   </tr>
 </table>
 <br />
         <table width="100%" border="0">
-
             <tr class="rowHeader">
-                {foreach from=$recordset->getFields() item="field" key="key"}
+                {foreach from=$columns item="field" key="key"}
 					{if ($field.sortable == false)}
 	                    <td height="24" align="right" class="fieldHeader_off">{t w=$key}&nbsp;</td>
-					{elseif ($key != $recordset->getCurrentField())}
-	                    <td height="24" align="right" class="fieldHeader" onClick="ticketReload('{$key}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$key}&nbsp;</td>
+					{elseif ($key != $defaults.grid_column)}
+	                    <td height="24" align="right" class="fieldHeader" onClick="document.getElementById('gr_column').value='{$key}'; document.getElementById('gr_direction').value = 1-document.getElementById('gr_direction').value; ticketReload();">{t w=$key}&nbsp;</td>
 					{else}
-	                    <td height="24" align="right" class="fieldHeader_order" onClick="ticketReload('{$key}', '{$recordset->getSortdirection(true)}', '{$recordset->page}');">{t w=$key}&nbsp;</td>
+	                    <td height="24" align="right" class="fieldHeader_order" onClick="document.getElementById('gr_column').value='{$key}'; document.getElementById('gr_direction').value = 1-document.getElementById('gr_direction').value; ticketReload();">{t w=$key}&nbsp;</td>
 					{/if}
                 {/foreach}
             </tr>
-
-
         {foreach from=$recordset->set item="record"}
             <tr class="{cycle values='row1,row2'}">
                 {foreach from=$record item="val"}
@@ -36,11 +36,15 @@
                 {/foreach}
             </tr>
         {/foreach}
-
 </table>
         <table width="100%"  border="0">
           <tr>
-            <td align="right" class="field_total">&nbsp;</td>
+            <td align="right" class="field_total">
+			&nbsp;
+			{$form.gr_column.html}
+			{$form.gr_direction.html}
+			{$form.gr_page.html}
+			</td>
           </tr>
           <tr>
             <td align="right" class="field_total">{t w="total"}: {$recordset->totalRows}&nbsp;&nbsp;</td>

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-22 08:46:13 UTC (rev 1945)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/YDCMHelpdesk.php	2006-05-29 17:19:32 UTC (rev 1946)
@@ -30,7 +30,7 @@
 	YDInclude( 'YDForm.php' );
 	YDInclude( 'YDCMComponent.php' );
 
-	// load master component modules
+	// load users module of YDCMComponent
 	YDCMComponent::module( 'YDCMUsers' );
 
 	// add local translation directory
@@ -39,7 +39,19 @@
 	// set posts form name
 	YDConfig::set( 'YDCMHELPDESK_FORMPOST', 'YDCMHelpdeskFormPost', false );
 
+	// set default states
+	YDConfig::set( 'YDCMHELPDESK_STATES', array( 'allstates', 'closed', 'open', 'pendent' ), false );
 
+	// set default types
+	YDConfig::set( 'YDCMHELPDESK_TYPES', array( 'email', 'telephone', 'personal' ), false );
+
+    // set default urgencies (TODO: maybe 'priorities')
+    YDConfig::set( 'YDCMHELPDESK_URGENCIES', array( 'allurgencies' => array(),
+	                                                'low'          => array( 'color' => '#00FF00' ), 
+                                                    'medium'       => array( 'color' => '#FF9900' ), 
+													'high'         => array( 'color' => '#FF9900' ) ), false );
+
+
     class YDCMHelpdesk extends YDCMComponent {
     
         function YDCMHelpdesk() {
@@ -105,6 +117,47 @@
 			return $this->insert();
 		}
 
+
+        /**
+         *  This static function returns an array of possible states
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getStates( $translated = false ){
+		
+			return YDCMHelpdesk::getInfo( $translated, YDConfig::get( 'YDCMHELPDESK_STATES' ) );
+		}
+
+
+        /**
+         *  This static function returns an array of possible urgencies
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getUrgencies( $translated = false ){
+		
+			return YDCMHelpdesk::getInfo( $translated, array_keys( YDConfig::get( 'YDCMHELPDESK_URGENCIES' ) ) );
+		}
+		
+		
+        /**
+         *  This private static function returns an array/associative array based on states/urgencies
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getInfo( $translated, $arr ){
+			
+			// if we don't want translation, just return
+			if ( $translated != false ) return $arr;
+			
+			// compute associative array
+			$tmp = array();
+			foreach( $states as $s )
+				$tmp[ $s ] = t( $s );
+
+			return $tmp;
+		}
+
     }
 
 
@@ -157,17 +210,22 @@
             $relResponse->setForeignKey( 'post_id' );
 			$relResponse->setForeignJoin( 'LEFT' );
 
-            $relUrgency = & $this->registerRelation( 'YDCMHelpdesk_urgency', false, 'YDCMHelpdesk_urgency' );
-			$relUrgency->setLocalKey( 'urgency_id' );
-            $relUrgency->setForeignKey( 'urgency_id' );
+			// set default columns information
+			$this->columns = array(	'post_id'       => array('sortable' => true), 
+									'subject'       => array('sortable' => true),
+									'name'          => array('sortable' => true), 
+									'creation_date' => array('sortable' => true) );
+		}
 
-            $relState = & $this->registerRelation( 'YDCMHelpdesk_state', false, 'YDCMHelpdesk_state' );
-			$relState->setLocalKey( 'state_id' );
-            $relState->setForeignKey( 'state_id' );
 
-            $relAss = & $this->registerRelation( 'YDCMHelpdesk_type', false, 'YDCMHelpdesk_type' );
-			$relAss->setLocalKey( 'reported_by_type' );
-            $relAss->setForeignKey( 'type_id' );
+        /**
+         *  This function defines columns to use in recordsets/ajaxgrids
+         *
+         *  @param $columns  Helpdesk post columns for recorsets/ajaxgrids
+         */
+		function setColumns( $columns ){
+		
+			$this->columns = $columns;
 		}
 
 
@@ -294,36 +352,69 @@
 
 
         /**
-         *  This function returns a special recordset with posts
+         *  This function returns a recordset with posts
          *
-         *  @param $field_order  Field to sort
-         *  @param $field_order_direction  Sort direction
-         *  @param $field_page  Page to retrieve
+         *  @param $fields  Array of fields
          */
-		function getRS( $field_order = 'creation_date', $field_order_direction = 'DESC', $field_page = 1 ){
+		function getRecordSet( $fields ){
 
 			// delete previous values
 			$this->resetValues();
 
-			// set current order
-			$this->order( $this->getTable() . '.' . $field_order . ' ' . $field_order_direction . ', creation_date DESC' );
+			// check column name. TODO: check if column is a valid helpdesk or user column
+			if ( isset( $fields[ 'grid_column' ] ) ) $column = $fields[ 'grid_column' ];
+			else                                     $column = 'creation_date';
 
-			// get only posts with state 1
-			$this->state_id = 1;
+			// check direction
+			if ( isset( $fields[ 'grid_direction' ] ) && $fields[ 'grid_direction' ] == 'asc' ) $desc = false;
+			else                                                                                $desc = true;
 
+			// apply column order
+            $this->order( $column, $desc );
+
+			// apply state
+			if ( isset( $fields[ 'grid_state' ] ) && in_array( $fields[ 'grid_state' ], YDConfig::get( 'YDCMHELPDESK_STATES' ) ) )
+				$this->state_id = $fields[ 'grid_state' ];
+
+			// apply urgency
+			if ( isset( $fields[ 'grid_urgency' ] ) && in_array( $fields[ 'grid_urgency' ], YDConfig::get( 'YDCMHELPDESK_URGENCIES' ) ) )
+				$this->urgency_id = $fields[ 'grid_urgency' ];
+
 			// get information of users too
 			$this->find( 'users' );
 
-			// define columns we want
-			$fields = array( 'post_id', 'subject', 'name', 'creation_date' );
+			// check page to show
+			if ( isset( $fields[ 'grid_page' ] ) && is_numeric( $fields[ 'grid_page' ] ) ) $page = intval( $fields[ 'grid_page' ] );
+			else                                                                           $page = 1;
 
 			// create a recordset
-			$recordset = new YDRecordSet( $this->getResultsAsAssocArray( 'post_id', $fields, false, false, false, false ), $field_page, 9 );
-			$recordset->setFields( $fields );
-			$recordset->setCurrentField( $field_order, $field_order_direction );
+			return new YDRecordSet( $this->getResultsAsAssocArray( 'post_id', array_keys( $this->columns ), false, false, false, false ), $page, 9 );
+		}
 
-			return $recordset;
+
+        /**
+         *  This function returns a ajax grid
+         *
+         *  @param $fields  Array of fields
+         */
+		function getAjaxGrid( $fields = array() ){
+		
+			// include grid lib
+			YDInclude( 'YDFormElement_Grid.php' );
+
+			// init grid
+			$grid = new YDFormElement_Grid();
+
+			// add recordset to grid
+			$grid->setValue( $this->getRecordSet( $fields ) );
+			
+			// add columns information to grid
+			$grid->setColumns( $this->columns );
+
+			return $grid;
 		}
+		
+		
 
 	}
 
@@ -383,156 +474,4 @@
 	}	
 
 
-
-    class YDCMHelpdesk_urgency extends YDDatabaseObject {
-    
-        function YDCMHelpdesk_urgency() {
-        
-			// init component
-            $this->YDDatabaseObject();
-
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMHelpdesk_urgency' );
-
-			// register Key
-			$this->registerKey( 'urgency_id', true );
-
-			// register custom fields
-			$this->registerField( 'description' );
-			$this->registerField( 'color' );
-						
-			// custom relations
-            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
-			$rel->setLocalKey( 'urgency_id' );
-            $rel->setForeignKey( 'urgency_id' );
-			$rel->setForeignJoin( 'LEFT' );
-		}
-
-
-		function addUrgency( $description, $color = '#FF0000' ){
-		
-			$this->resetValues();
-
-			// create urgency
-			$this->description  = $description;
-			$this->color        = $color;
-
-			return $this->insert();
-		}
-
-
-		function getUrgencies(){
-		
-			$this->resetValues();
-			
-			// find all urgencies
-			$this->find();
-
-			// get associative array
-			$res = $this->getResultsAsAssocArray( 'urgency_id' );
-
-			// translate urgency description
-			foreach( $res as $id => $arr )
-				$res[ $id ][ 'description'] = t( $res[ $id ][ 'description'] );
-
-			// return urgencies
-			return $res;
-		}
-
-	}	
-
-
-
-
-    class YDCMHelpdesk_state extends YDDatabaseObject {
-    
-        function YDCMHelpdesk_state() {
-        
-			// init component
-            $this->YDDatabaseObject();
-
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMHelpdesk_state' );
-
-			// register Key
-			$this->registerKey( 'state_id', true );
-
-			// register custom fields
-			$this->registerField( 'description' );
-						
-			// custom relations
-            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
-			$rel->setLocalKey( 'state_id' );
-            $rel->setForeignKey( 'state_id' );
-			$rel->setForeignJoin( 'LEFT' );
-		}
-
-
-		function addState( $description ){
-		
-			$this->resetValues();
-
-			// create state
-			$this->description  = $description;
-
-			return $this->insert();
-		}
-
-
-		function getStates(){
-		
-			$this->resetValues();
-			
-			// find all states
-			$this->find();
-
-			// get associative array
-			$res = $this->getResultsAsAssocArray( 'state_id' );
-
-			// translate state description
-			foreach( $res as $id => $arr )
-				$res[ $id ][ 'description'] = t( $res[ $id ][ 'description'] );
-
-			// return urgencies
-			return $res;
-		}
-
-
-	}	
-
-
-
-
-
-    class YDCMHelpdesk_type extends YDDatabaseObject {
-    
-        function YDCMHelpdesk_type() {
-        
-			// init component
-            $this->YDDatabaseObject();
-
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMHelpdesk_type' );
-
-			// register Key
-			$this->registerKey( 'type_id', true );
-
-			// register custom fields
-			$this->registerField( 'description' );
-						
-			// custom relations
-		}
-
-	}	
-
-
 ?>
\ No newline at end of file



