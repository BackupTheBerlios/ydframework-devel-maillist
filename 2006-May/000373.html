<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ydf-devel] r1909 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ydframework-devel/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r1909%20-%20in%20YDFramework2.0/trunk/YDFramework2/YDClasses%3A%20.%20YDCMComponent&In-Reply-To=%3C200605041609.k44G9qKH024289%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000371.html">
   <LINK REL="Next"  HREF="000374.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ydf-devel] r1909 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent</H1>
    <B>ximian at berlios.de</B> 
    <A HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r1909%20-%20in%20YDFramework2.0/trunk/YDFramework2/YDClasses%3A%20.%20YDCMComponent&In-Reply-To=%3C200605041609.k44G9qKH024289%40sheep.berlios.de%3E"
       TITLE="[ydf-devel] r1909 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDCMComponent">ximian at berlios.de
       </A><BR>
    <I>Thu May  4 18:09:52 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000371.html">[ydf-devel] r1908 - YDFramework2.0/trunk/examples/weblog/include
</A></li>
        <LI>Next message: <A HREF="000374.html">[ydf-devel] r1910 - YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#373">[ date ]</a>
              <a href="thread.html#373">[ thread ]</a>
              <a href="subject.html#373">[ subject ]</a>
              <a href="author.html#373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ximian
Date: 2006-05-04 18:09:26 +0200 (Thu, 04 May 2006)
New Revision: 1909

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
- added 2 new node attributes that define is node is dragable and dropable
- updated DBDesigner scheme
- added method YDCMComponent::moveNode
- added method YDCMComponent::getDragDropElements that validates if 2 nodes are valid drag and valid drop


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-04 14:35:34 UTC (rev 1908)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-05-04 16:09:26 UTC (rev 1909)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot; ?&gt;
 &lt;DBMODEL Version=&quot;4.0&quot;&gt;
 &lt;SETTINGS&gt;
-&lt;GLOBALSETTINGS ModelName=&quot;YDCM scheme&quot; IDModel=&quot;0&quot; IDVersion=&quot;0&quot; VersionStr=&quot;1.0.0.0&quot; Comments=&quot;&quot; UseVersionHistroy=&quot;1&quot; AutoIncVersion=&quot;1&quot; DatabaseType=&quot;MySQL&quot; ZoomFac=&quot;73.00&quot; XPos=&quot;25&quot; YPos=&quot;329&quot; DefaultDataType=&quot;5&quot; DefaultTablePrefix=&quot;0&quot; DefSaveDBConn=&quot;&quot; DefSyncDBConn=&quot;&quot; DefQueryDBConn=&quot;&quot; Printer=&quot;&quot; HPageCount=&quot;4.0&quot; PageAspectRatio=&quot;1.440892512336408&quot; PageOrientation=&quot;1&quot; PageFormat=&quot;A4 (210x297 mm, 8.26x11.7 inches)&quot; SelectedPages=&quot;&quot; UsePositionGrid=&quot;1&quot; PositionGridX=&quot;20&quot; PositionGridY=&quot;20&quot; TableNameInRefs=&quot;0&quot; DefaultTableType=&quot;0&quot; ActivateRefDefForNewRelations=&quot;1&quot; FKPrefix=&quot;&quot; FKPostfix=&quot;&quot; CreateFKRefDefIndex=&quot;0&quot; DBQuoteCharacter=&quot;`&quot; CreateSQLforLinkedObjects=&quot;0&quot; DefModelFont=&quot;Tahoma&quot; CanvasWidth=&quot;4096&quot; CanvasHeight=&quot;2842&quot; /&gt;
+&lt;GLOBALSETTINGS ModelName=&quot;YDCM scheme&quot; IDModel=&quot;0&quot; IDVersion=&quot;0&quot; VersionStr=&quot;1.0.0.0&quot; Comments=&quot;&quot; UseVersionHistroy=&quot;1&quot; AutoIncVersion=&quot;1&quot; DatabaseType=&quot;MySQL&quot; ZoomFac=&quot;73.00&quot; XPos=&quot;0&quot; YPos=&quot;405&quot; DefaultDataType=&quot;5&quot; DefaultTablePrefix=&quot;0&quot; DefSaveDBConn=&quot;&quot; DefSyncDBConn=&quot;&quot; DefQueryDBConn=&quot;&quot; Printer=&quot;&quot; HPageCount=&quot;4.0&quot; PageAspectRatio=&quot;1.440892512336408&quot; PageOrientation=&quot;1&quot; PageFormat=&quot;A4 (210x297 mm, 8.26x11.7 inches)&quot; SelectedPages=&quot;&quot; UsePositionGrid=&quot;1&quot; PositionGridX=&quot;20&quot; PositionGridY=&quot;20&quot; TableNameInRefs=&quot;0&quot; DefaultTableType=&quot;0&quot; ActivateRefDefForNewRelations=&quot;1&quot; FKPrefix=&quot;&quot; FKPostfix=&quot;&quot; CreateFKRefDefIndex=&quot;0&quot; DBQuoteCharacter=&quot;`&quot; CreateSQLforLinkedObjects=&quot;0&quot; DefModelFont=&quot;Tahoma&quot; CanvasWidth=&quot;4096&quot; CanvasHeight=&quot;2842&quot; /&gt;
 &lt;DATATYPEGROUPS&gt;
 &lt;DATATYPEGROUP Name=&quot;Numeric Types&quot; Icon=&quot;1&quot; /&gt;
 &lt;DATATYPEGROUP Name=&quot;Date and Time Types&quot; Icon=&quot;2&quot; /&gt;
@@ -482,6 +482,18 @@
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
+&lt;COLUMN ID=&quot;1588&quot; ColName=&quot;candrag&quot; PrevColName=&quot;&quot; Pos=&quot;13&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;0&quot; Comments=&quot;node can be dragged&quot;&gt;
+&lt;OPTIONSELECTED&gt;
+&lt;OPTIONSELECT Value=&quot;1&quot; /&gt;
+&lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
+&lt;/OPTIONSELECTED&gt;
+&lt;/COLUMN&gt;
+&lt;COLUMN ID=&quot;1589&quot; ColName=&quot;candrop&quot; PrevColName=&quot;&quot; Pos=&quot;14&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;0&quot; Comments=&quot;node can be droppable&quot;&gt;
+&lt;OPTIONSELECTED&gt;
+&lt;OPTIONSELECT Value=&quot;1&quot; /&gt;
+&lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
+&lt;/OPTIONSELECTED&gt;
+&lt;/COLUMN&gt;
 &lt;/COLUMNS&gt;
 &lt;RELATIONS_START&gt;
 &lt;RELATION_START ID=&quot;1340&quot; /&gt;
@@ -816,13 +828,13 @@
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1374&quot; ColName=&quot;urgency_id&quot; PrevColName=&quot;urgency&quot; Pos=&quot;4&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;1&quot; DefaultValue=&quot;0&quot; Comments=&quot;&quot;&gt;
+&lt;COLUMN ID=&quot;1374&quot; ColName=&quot;urgency_id&quot; PrevColName=&quot;urgency&quot; Pos=&quot;4&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;1&quot; DefaultValue=&quot;0&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1375&quot; ColName=&quot;state_id&quot; PrevColName=&quot;state&quot; Pos=&quot;5&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;1&quot; DefaultValue=&quot;1&quot; Comments=&quot;&quot;&gt;
+&lt;COLUMN ID=&quot;1375&quot; ColName=&quot;state_id&quot; PrevColName=&quot;state&quot; Pos=&quot;5&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;1&quot; DefaultValue=&quot;1&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
@@ -832,11 +844,11 @@
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1377&quot; ColName=&quot;created_in&quot; PrevColName=&quot;&quot; Pos=&quot;7&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
+&lt;COLUMN ID=&quot;1377&quot; ColName=&quot;created_in&quot; PrevColName=&quot;&quot; Pos=&quot;7&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1378&quot; ColName=&quot;reported_in&quot; PrevColName=&quot;&quot; Pos=&quot;8&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
+&lt;COLUMN ID=&quot;1378&quot; ColName=&quot;reported_in&quot; PrevColName=&quot;&quot; Pos=&quot;8&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
@@ -845,7 +857,7 @@
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1380&quot; ColName=&quot;reported_to_in&quot; PrevColName=&quot;&quot; Pos=&quot;10&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
+&lt;COLUMN ID=&quot;1380&quot; ColName=&quot;reported_to_in&quot; PrevColName=&quot;&quot; Pos=&quot;10&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
@@ -1133,7 +1145,7 @@
 &lt;/INDEX&gt;
 &lt;/INDICES&gt;
 &lt;/TABLE&gt;
-&lt;TABLE ID=&quot;1565&quot; Tablename=&quot;YDCMHelpdesk&quot; PrevTableName=&quot;Table_20&quot; XPos=&quot;360&quot; YPos=&quot;1520&quot; TableType=&quot;0&quot; TablePrefix=&quot;0&quot; nmTable=&quot;0&quot; Temporary=&quot;0&quot; UseStandardInserts=&quot;0&quot; StandardInserts=&quot;\n&quot; TableOptions=&quot;DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n&quot; Comments=&quot;&quot; Collapsed=&quot;0&quot; IsLinkedObject=&quot;0&quot; IDLinkedModel=&quot;-1&quot; Obj_id_Linked=&quot;-1&quot; OrderPos=&quot;39&quot; &gt;
+&lt;TABLE ID=&quot;1565&quot; Tablename=&quot;YDCMHelpdesk&quot; PrevTableName=&quot;Table_20&quot; XPos=&quot;360&quot; YPos=&quot;1540&quot; TableType=&quot;0&quot; TablePrefix=&quot;0&quot; nmTable=&quot;0&quot; Temporary=&quot;0&quot; UseStandardInserts=&quot;0&quot; StandardInserts=&quot;\n&quot; TableOptions=&quot;DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n&quot; Comments=&quot;&quot; Collapsed=&quot;0&quot; IsLinkedObject=&quot;0&quot; IDLinkedModel=&quot;-1&quot; Obj_id_Linked=&quot;-1&quot; OrderPos=&quot;39&quot; &gt;
 &lt;COLUMNS&gt;
 &lt;COLUMN ID=&quot;1567&quot; ColName=&quot;component_id&quot; PrevColName=&quot;&quot; Pos=&quot;0&quot; idDatatype=&quot;5&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;1&quot; NotNull=&quot;1&quot; AutoInc=&quot;1&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-04 14:35:34 UTC (rev 1908)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-05-04 16:09:26 UTC (rev 1909)
@@ -84,6 +84,8 @@
 			$this-&gt;tree-&gt;addField( 'searcheable' );
 			$this-&gt;tree-&gt;addField( 'published_date_start' );
 			$this-&gt;tree-&gt;addField( 'published_date_end' );
+			$this-&gt;tree-&gt;addField( 'candrag' );
+			$this-&gt;tree-&gt;addField( 'candrop' );
 		}
 
 
@@ -98,6 +100,22 @@
 
 
         /**
+         *  This function checks if elements are valid drag&amp;dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x =&gt; 'PHCMPage', $y =&gt; 'PHCMRootmenu ))'
+         */
+		function getDragDropElements( $x, $y ){
+		
+			$treeObj = new YDCMTree();
+			return $treeObj-&gt;getDragDropElements( $x, $y );
+		}
+
+
+        /**
          *  This function returns the component author
          *
          *  @returns    component author
@@ -206,6 +224,18 @@
 		}
 
 
+        /**
+         *  This function moves a node
+         *
+         *  @param $values  Node values
+         */
+		function moveNode( $x, $y ){
+
+			// use YDDatabasetree method
+			return $this-&gt;tree-&gt;moveNode( $x, $y );
+		}
+
+
     }
 
 
@@ -236,7 +266,39 @@
 			$this-&gt;registerField( 'searcheable' );			
 			$this-&gt;registerField( 'published_date_start' );
 			$this-&gt;registerField( 'published_date_end' );			
+			$this-&gt;registerField( 'candrag' );
+			$this-&gt;registerField( 'candrop' );
 		}
+
+
+        /**
+         *  This function checks if elements are valid drag&amp;dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node information
+         */
+		function getDragDropElements( $x, $y ){
+		
+			// check if elements are numeric
+			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
+		
+			// reset old values and get current table	
+			$this-&gt;resetValues();
+
+			// set custom where to get those 2 elements
+			$this-&gt;where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
+
+			// we must get always 2 elements otherwise they were not valid
+			if ( $this-&gt;find() != 2 ) return false;
+
+			// return associative array
+			return $this-&gt;getResultsAsAssocArray( 'content_id' );
+		}
+
+
 	}
 
 ?&gt;
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000371.html">[ydf-devel] r1908 - YDFramework2.0/trunk/examples/weblog/include
</A></li>
	<LI>Next message: <A HREF="000374.html">[ydf-devel] r1910 - YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#373">[ date ]</a>
              <a href="thread.html#373">[ thread ]</a>
              <a href="subject.html#373">[ subject ]</a>
              <a href="author.html#373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ydframework-devel">More information about the YDFramework-devel
mailing list</a><br>
</body></html>
