<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ydf-devel] r1941 - in YDFramework2.0/trunk/examples/weblog: . include include/languages skins/default
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ydframework-devel/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r1941%20-%20in%20YDFramework2.0/trunk/examples/weblog%3A%20.%20include%20include/languages%20skins/default&In-Reply-To=%3C200605191259.k4JCxt0P012627%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000413.html">
   <LINK REL="Next"  HREF="000415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ydf-devel] r1941 - in YDFramework2.0/trunk/examples/weblog: . include include/languages skins/default</H1>
    <B>pclaerhout at BerliOS</B> 
    <A HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r1941%20-%20in%20YDFramework2.0/trunk/examples/weblog%3A%20.%20include%20include/languages%20skins/default&In-Reply-To=%3C200605191259.k4JCxt0P012627%40sheep.berlios.de%3E"
       TITLE="[ydf-devel] r1941 - in YDFramework2.0/trunk/examples/weblog: . include include/languages skins/default">pclaerhout at berlios.de
       </A><BR>
    <I>Fri May 19 14:59:55 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000413.html">[ydf-devel] r1940 - YDFramework2.0/trunk/examples/weblog/manage
</A></li>
        <LI>Next message: <A HREF="000415.html">[ydf-devel] Fix action urls generated by YDForm (convert &amp; to &amp;amp;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#414">[ date ]</a>
              <a href="thread.html#414">[ thread ]</a>
              <a href="subject.html#414">[ subject ]</a>
              <a href="author.html#414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pclaerhout
Date: 2006-05-19 14:59:51 +0200 (Fri, 19 May 2006)
New Revision: 1941

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/index.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Added an option called &quot;related items&quot;. It basically pics a number of random posts from the same category as the current post.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -319,6 +319,39 @@
             return $this-&gt;_fixItems( $this-&gt;db-&gt;getRecords( $sql, $limit, $offset ) );
         }
 
+        // Get related items
+        function getRelatedItemsByItem( $limit, $item ) {
+
+            // Get the items from the same category
+            $items = $this-&gt;getItems(
+                -1, -1, 'created desc, title', 'AND is_draft = 0 AND i.category_id = '
+              . $this-&gt;str( $item['category_id'] ) . ' and i.id &lt;&gt; ' . $this-&gt;str( $item['id'] )
+            );
+
+            // Shuffle the items
+            shuffle( $items );
+
+            // Get the right rows
+            $items = array_slice( $items, 0, $limit );
+
+            // Sort them by date
+            $sorted = array();
+            foreach ( $items as $key=&gt;$item ) {
+                $sorted[ $key ] = intval( $item['created'] );
+            }
+            sort( $sorted );
+
+            // Rearrange the array
+            $sorted_items = array();
+            foreach ( $sorted as $key=&gt;$date ) {
+                array_push( $sorted_items, $items[ $key ] );
+            }
+
+            // Return the items
+            return array_values( $sorted_items );
+
+        }
+
         // Get a publc item by it's ID
         function getPublicItemByID( $item_id ) {
             return $this-&gt;getItem( 'AND is_draft = 0 AND i.id = ' . $this-&gt;str( $item_id ) );

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,7 @@
 $GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
 $GLOBALS['t']['rows'] = 'row(s)';
 $GLOBALS['t']['tables'] = 'Tables';
+$GLOBALS['t']['related_items'] = 'Related items to';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,7 @@
 $GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
 $GLOBALS['t']['rows'] = 'rij(en)';
 $GLOBALS['t']['tables'] = 'Tabellen';
+$GLOBALS['t']['related_items'] = 'Gerelateerde items aan';
 
 // __std_header.tpl
 $GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';

Modified: YDFramework2.0/trunk/examples/weblog/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/index.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/index.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -28,7 +28,7 @@
 
             // Get the weblog items and 5 older items
             $items     = $this-&gt;weblog-&gt;getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
-            $old_items = $this-&gt;weblog-&gt;getPublicItems( 5, sizeof( $items ) );
+            $old_items = $this-&gt;weblog-&gt;getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ), sizeof( $items ) );
 
             // Assign them to the template
             $this-&gt;tpl-&gt;assign( 'items',     $items );

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-05-19 12:59:51 UTC (rev 1941)
@@ -30,6 +30,9 @@
             $item  = @ $this-&gt;weblog-&gt;getPublicItemById( $id );
             $this-&gt;redirectIfMissing( $item );
 
+            // Get the related items
+            $related_items = $this-&gt;weblog-&gt;getRelatedItemsByItem( YDConfig::get( 'weblog_entries_fp', 5 ), $item );
+
             // Convert the list of images to a table of 3 columns
             $item['images_as_table'] = YDArrayUtil::convertToTable( $item['images'], 3, true );
 
@@ -38,6 +41,7 @@
 
             // Add them to the template
             $this-&gt;tpl-&gt;assign( 'item', $item );
+            $this-&gt;tpl-&gt;assign( 'related_items', $related_items );
             $this-&gt;tpl-&gt;assign( 'comments', $comments );
 
             // Only if comments are allowed

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 12:09:37 UTC (rev 1940)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-05-19 12:59:51 UTC (rev 1941)
@@ -78,6 +78,22 @@
 
     &lt;/div&gt;
 
+    &lt;a name=&quot;related&quot;&gt;&lt;/a&gt;
+    {if $related_items}
+        &lt;h3&gt;{t w=&quot;related_items&quot;} &#8220;{$item.title}&#8221;&lt;/h3&gt;
+        &lt;ul&gt;
+            {foreach from=$related_items item=&quot;rel_item&quot;}
+                &lt;li&gt;
+                    {$rel_item.created|date:'%d %B %Y'|lower}:
+                    &lt;a href=&quot;{$rel_item|@link_item}&quot;&gt;{$rel_item.title}&lt;/a&gt;
+                    {if $rel_item.num_comments != '0' or $rel_item.num_images != '0'}
+                        &lt;span class=&quot;postmetadata&quot;&gt;({$rel_item|@text_num_images:false}{if $rel_item.num_comments != '0' and $rel_item.num_images != '0'}, {/if}{$rel_item|@text_num_comments:false})&lt;/span&gt;
+                    {/if}
+                &lt;/li&gt;
+            {/foreach}
+        &lt;/ul&gt;
+    {/if}
+
     &lt;a name=&quot;comment&quot;&gt;&lt;/a&gt;
     {if $comments}
         &lt;h3&gt;{$item|@text_num_comments:true} {t w=&quot;to&quot;} &#8220;{$item.title}&#8221;&lt;/h3&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000413.html">[ydf-devel] r1940 - YDFramework2.0/trunk/examples/weblog/manage
</A></li>
	<LI>Next message: <A HREF="000415.html">[ydf-devel] Fix action urls generated by YDForm (convert &amp; to &amp;amp;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#414">[ date ]</a>
              <a href="thread.html#414">[ thread ]</a>
              <a href="subject.html#414">[ subject ]</a>
              <a href="author.html#414">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ydframework-devel">More information about the YDFramework-devel
mailing list</a><br>
</body></html>
