From pieter at yellowduck.be  Wed Feb  8 09:40:30 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 8 Feb 2006 09:40:30 +0100
Subject: [ydf-devel] Bug/Feature Request database
Message-ID: <4aef63030602080040pcdb2746i105ea55f9b9350f9@mail.gmail.com>

Hi all,

we need to start to think about a bug database and feature request tracker
for the framework.

I was thinking about something along the lines of:

- Combined bug database and feature request database
- Logging of bugs and viewing can be done by anyone
- Updating bugs can only done by the registered users (= developers)
- Each bug/feature request can have the following properties:
  - ID
  - Type: bug/feature request
  - Title
  - Description
  - History
  - Created on/by
  - Modified on/by
  - attachements?
  - Part: YDFramework-core, YDWeblog or addon x/y/x
  - Status: new/assigned/closed/rejected
  - Developer taking care of it

Of course, there should be options to sort/filter/etc...

Sounds like a plan?

If someone knows of anything off the shelve that might suit or needs as
well, please let me know.

cheers,


pieter

--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/d00aab80/attachment.html>

From pclaerhout at berlios.de  Wed Feb  8 10:31:36 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 8 Feb 2006 10:31:36 +0100
Subject: [ydf-devel] r1643 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602080931.k189VaMG026202@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-08 10:31:35 +0100 (Wed, 08 Feb 2006)
New Revision: 1643

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Fixed a bug in YDRequest::getQueryStringParameter where it couldn't return null as the default value.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-02-07 20:07:57 UTC (rev 1642)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-02-08 09:31:35 UTC (rev 1643)
@@ -83,7 +83,7 @@
          *  @returns    The value of the query string variable as a string.
          */
         function getQueryStringParameter( $name, $default='' ) {
-            return isset( $_GET[ $name ] ) ? $_GET[ $name ] : strval( $default );
+            return isset( $_GET[ $name ] ) ? $_GET[ $name ] : $default;
         }
 
         /**



From pclaerhout at berlios.de  Wed Feb  8 13:24:56 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 8 Feb 2006 13:24:56 +0100
Subject: [ydf-devel] r1644 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602081224.k18COucv010363@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-08 13:24:38 +0100 (Wed, 08 Feb 2006)
New Revision: 1644

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Added the YDStringUtil::convertToQueryString function.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-08 09:31:35 UTC (rev 1643)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-08 12:24:38 UTC (rev 1644)
@@ -779,6 +779,34 @@
             return ( substr( $string, -strlen( $substring ) ) == $substring );
         }
 
+        /**
+         *  Converts a query string array to a query string.
+         *
+         *  @param  $values The array to convert.
+         *
+         *  @returns    A string with the query string variables.
+         */
+        function convertToQueryString( $values ) {
+
+            // Start with an empty result
+            $result = '';
+
+            // Add the parameters
+            foreach ( $values as $key1=>$val1 ) {
+                if ( is_array( $val1 ) ) {
+                    foreach ( $val1 as $key2=>$val2 ) {
+                        $result .= rawurlencode( $key1 . '[' . $key2 . ']' ) . '=' . rawurlencode( $val2 ) . '&';
+                    }
+                } else {
+                    $result .= rawurlencode( $key1 ) . '=' . rawurlencode( $val1 ) . '&';
+                }
+            }
+
+            // Return the URL
+            return rtrim( $result, '&' );
+
+        }
+
     }
 
     /**



From pclaerhout at berlios.de  Wed Feb  8 13:29:22 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 8 Feb 2006 13:29:22 +0100
Subject: [ydf-devel] r1645 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602081229.k18CTM61016022@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-08 13:29:21 +0100 (Wed, 08 Feb 2006)
New Revision: 1645

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Removed the YDStringUtil::convertToQueryString function again as it was not really needed after all.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-08 12:24:38 UTC (rev 1644)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-08 12:29:21 UTC (rev 1645)
@@ -779,34 +779,6 @@
             return ( substr( $string, -strlen( $substring ) ) == $substring );
         }
 
-        /**
-         *  Converts a query string array to a query string.
-         *
-         *  @param  $values The array to convert.
-         *
-         *  @returns    A string with the query string variables.
-         */
-        function convertToQueryString( $values ) {
-
-            // Start with an empty result
-            $result = '';
-
-            // Add the parameters
-            foreach ( $values as $key1=>$val1 ) {
-                if ( is_array( $val1 ) ) {
-                    foreach ( $val1 as $key2=>$val2 ) {
-                        $result .= rawurlencode( $key1 . '[' . $key2 . ']' ) . '=' . rawurlencode( $val2 ) . '&';
-                    }
-                } else {
-                    $result .= rawurlencode( $key1 ) . '=' . rawurlencode( $val1 ) . '&';
-                }
-            }
-
-            // Return the URL
-            return rtrim( $result, '&' );
-
-        }
-
     }
 
     /**



From ydfpoi at gmail.com  Wed Feb  8 13:48:26 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Wed, 8 Feb 2006 13:48:26 +0100
Subject: [ydf-devel] Comments are not correctly validated in YDWeblog
Message-ID: <306340e00602080448u289132b0t@mail.gmail.com>

Hi all

(i don't know if my post is correctly addressed, please correct me if
something is wrong.)

Since you added simple spam protection in YDWeblog's item.php file, you
can't add new comment except if you provide a user website address.

Since this field (userwebsite) is not required, i think it's a bug...

The implicated source code probably lies around the line 81 of file
weblog/item.php.

Kind regards

--
po?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/9e853e3d/attachment.html>

From ydfpoi at gmail.com  Wed Feb  8 14:41:24 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Wed, 8 Feb 2006 14:41:24 +0100
Subject: [ydf-devel] YDWeblog typos in adding strip_html filters
Message-ID: <306340e00602080541s7a251d89y@mail.gmail.com>

Hi Pieter

After you added strip_html filter in YDWeblog, i found 3 cut/paste-like
typos:

replace "$form->addFilters( array( 'title' ), 'strip_html' );"
with "$this->form->addFilters( array( 'title' ), 'strip_html' );"

 - in file weblog/manage/categories.php line 25
 - in file weblog/manage/links.php line 27
 - in file weblog/manage/pages.php line 28

Don't you think you should have only one method YDForm::addFilter (without
ending "s") recognizing its parameter's type, rather than two?

Kind regards
--
po?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/75a10173/attachment.html>

From pclaerhout at berlios.de  Wed Feb  8 15:26:54 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 8 Feb 2006 15:26:54 +0100
Subject: [ydf-devel] r1646 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples/weblog examples/weblog/include/languages
Message-ID: <200602081426.k18EQsal025204@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-08 15:26:48 +0100 (Wed, 08 Feb 2006)
New Revision: 1646

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Fixed the basic spam filter by implementing it properly as a form filter.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -153,6 +153,7 @@
             $this->registerRule( 'minlength_escape', array( 'YDValidateRules', 'minlength_escape' ), 'YDValidateRules.php' );
             $this->registerRule( 'maxlength_escape', array( 'YDValidateRules', 'maxlength_escape' ), 'YDValidateRules.php' );
             $this->registerRule( 'rangelength_escape', array( 'YDValidateRules', 'rangelength_escape' ), 'YDValidateRules.php' );
+            $this->registerRule( 'httpurl', array( 'YDValidateRules', 'httpurl' ), 'YDValidateRules.php' );
 
             // Add the filters
             $this->registerFilter( 'trim', 'trim' );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -659,6 +659,52 @@
             return YDValidateRules::date( $val, $opts );
         }
 
+        /**
+         *  This checks if the specified text is a valid HTTP url. It should start with http:// and it should have at
+         *  least one dot in there.
+         *
+         *  @param $val     The value to test.
+         *  @param $opts    (not required)
+         */
+        function httpurl( $val, $opts=array() ) {
+
+            // Return true if empty
+            if ( empty( $val ) ) {
+                return true;
+            }
+
+            // Convert to lowercase and trim
+            $val = strtolower( trim( $val ) );
+
+            // Add http:// if needed
+            if ( substr( $val, 0, 7 ) != 'http://' ) {
+                $val = 'http://' . $val;
+            }
+
+            // Check if it starts with http://
+            if ( ! YDStringUtil::startsWith( $val, 'http://' ) ) {
+                return false;
+            }
+
+            // Check the hostname
+            $host = substr( $val, 7 );
+            if ( strpos( $host, '/' ) !== false ) {
+                $host = trim( substr( $host, 0, strpos( $host, '/' ) ) );
+            }
+            if ( strpos( $host, ':' ) !== false ) {
+                $host = trim( substr( $host, 0, strpos( $host, ':' ) ) );
+            }
+
+            // Localhost is allowed
+            if ( $host == 'localhost' ) {
+                return true;
+            }
+
+            // Check that we have at least a dot
+            return ( strpos( $host, '.' ) === false ) ? false : true;
+
+        }
+
     }
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -84,6 +84,7 @@
 $GLOBALS['t']['err_name'] = 'Name is missing';
 $GLOBALS['t']['err_name_email'] = 'Name should not be an email address';
 $GLOBALS['t']['err_email'] = 'Email is missing or invalid';
+$GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
 $GLOBALS['t']['err_comment'] = 'Comment is required';
 $GLOBALS['t']['with'] = 'for';
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -84,6 +84,7 @@
 $GLOBALS['t']['err_name'] = 'Le nom est manquant';
 $GLOBALS['t']['err_name_email'] = 'Le nom ne doit pas ?tre une adresse email';
 $GLOBALS['t']['err_email'] = 'Email manquant ou invalide';
+$GLOBALS['t']['err_website'] = 'Le site web n\'est pas une URL valide';
 $GLOBALS['t']['err_comment'] = 'Le commentaire est requis';
 $GLOBALS['t']['with'] = 'pour';
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -84,6 +84,7 @@
 $GLOBALS['t']['err_name'] = 'Naam is niet ingegeven';
 $GLOBALS['t']['err_name_email'] = 'Naam mag geen email adres zijn';
 $GLOBALS['t']['err_email'] = 'Email is niet ingegeven of niet correct';
+$GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
 $GLOBALS['t']['with'] = 'bij';
 

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-02-08 12:29:21 UTC (rev 1645)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-02-08 14:26:48 UTC (rev 1646)
@@ -62,11 +62,12 @@
             $form->setDefaults( $defaults );
 
             // Set the rules
-            $form->addRule( 'username',  'required',  t( 'err_name' ) );
-            $form->addRule( 'username',  'not_email', t( 'err_name_email' ) );
-            $form->addRule( 'useremail', 'email',     t( 'err_email' ) );
-            $form->addRule( 'useremail', 'required',  t( 'err_email' ) );
-            $form->addRule( 'comment',   'required',  t( 'err_comment' ) );
+            $form->addRule( 'username',    'required',  t( 'err_name' ) );
+            $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
+            $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
+            $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
+            $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
+            $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
             // Add the filters
             $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
@@ -78,56 +79,56 @@
                 $values = $form->getValues();
 
                 // Simple spam protection
-                if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) !== false ) {
+                if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) === false ) {
+                    $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+                }
 
-                    // Fix any faulty web addresses
-                    if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
-                        $values['userwebsite'] = 'http://' . $values['userwebsite'];
-                    }
+                // Fix any faulty web addresses
+                if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
+                    $values['userwebsite'] = 'http://' . $values['userwebsite'];
+                }
 
-                    // Save the username, useremail and userwebsite
-                    setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
-                    setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
-                    setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
+                // Save the username, useremail and userwebsite
+                setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
+                setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
+                setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
 
-                    // Add the values to the database
-                    $comment_id = $this->weblog->addComment( $values );
+                // Add the values to the database
+                $comment_id = $this->weblog->addComment( $values );
 
-                    // Send an email if configured
-                    if ( YDConfig::get( 'email_new_comment', true ) ) {
+                // Send an email if configured
+                if ( YDConfig::get( 'email_new_comment', true ) ) {
 
-                        // Include the YDEmail library
-                        YDInclude( 'YDEmail.php' );
+                    // Include the YDEmail library
+                    YDInclude( 'YDEmail.php' );
 
-                        // Get the list of subscriptions
-                        $subscribers = $this->weblog->getCommentSubscribers( $id );
+                    // Get the list of subscriptions
+                    $subscribers = $this->weblog->getCommentSubscribers( $id );
 
-                        // Add the comment to the email template
-                        $this->tpl->assign( 'eml_comment', $values );
+                    // Add the comment to the email template
+                    $this->tpl->assign( 'eml_comment', $values );
 
-                        // Create the email and send it
-                        $eml = new YDEmail();
-                        if ( ! empty( $item['user_email'] ) ) {
-                            $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
-                        } else {
-                            $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
-                        }
-                        $eml->setReplyTo( 'no at reply.net' );
-                        $eml->addBcc( $item['user_email'] );
-                        foreach ( $subscribers as $subscriber ) {
-                            $eml->addBcc( $subscriber );
-                        }
-                        $eml->setSubject( 'New comment: ' . strip_tags( $item['title'] ) );
-                        $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
-                        $eml->send();
-
+                    // Create the email and send it
+                    $eml = new YDEmail();
+                    if ( ! empty( $item['user_email'] ) ) {
+                        $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                    } else {
+                        $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
                     }
+                    $eml->setReplyTo( 'no at reply.net' );
+                    $eml->addBcc( $item['user_email'] );
+                    foreach ( $subscribers as $subscriber ) {
+                        $eml->addBcc( $subscriber );
+                    }
+                    $eml->setSubject( 'New comment: ' . strip_tags( $item['title'] ) );
+                    $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
+                    $eml->send();
 
-                    // Clear the cache
-                    $this->clearCache();
-
                 }
 
+                // Clear the cache
+                $this->clearCache();
+
                 // Redirect to the item
                 $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
 



From pieter at yellowduck.be  Wed Feb  8 15:27:22 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 8 Feb 2006 15:27:22 +0100
Subject: [ydf-devel] Comments are not correctly validated in YDWeblog
In-Reply-To: <306340e00602080448u289132b0t@mail.gmail.com>
References: <306340e00602080448u289132b0t@mail.gmail.com>
Message-ID: <4aef63030602080627m29566f64q5764ae0d1fe02be@mail.gmail.com>

I fixed this in build 1646. The check is now implemented as a form filter
instead.

pieter

On 2/8/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi all
>
> (i don't know if my post is correctly addressed, please correct me if
> something is wrong.)
>
> Since you added simple spam protection in YDWeblog's item.php file, you
> can't add new comment except if you provide a user website address.
>
> Since this field (userwebsite) is not required, i think it's a bug...
>
> The implicated source code probably lies around the line 81 of file
> weblog/item.php.
>
> Kind regards
>
> --
> po?




--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/5aec650d/attachment.html>

From pclaerhout at berlios.de  Wed Feb  8 15:36:40 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 8 Feb 2006 15:36:40 +0100
Subject: [ydf-devel] r1647 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602081436.k18EaeEr011753@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-08 15:36:39 +0100 (Wed, 08 Feb 2006)
New Revision: 1647

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/categories.php
   YDFramework2.0/trunk/examples/weblog/manage/links.php
   YDFramework2.0/trunk/examples/weblog/manage/pages.php
Log:
Fixed some copy/paste errors for the strip_html form filter.

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-02-08 14:26:48 UTC (rev 1646)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-02-08 14:36:39 UTC (rev 1647)
@@ -22,7 +22,7 @@
             $this->form->addRule( 'title', 'required', t( 'err_category_title' ) );
 
             // Add the filters
-            $form->addFilters( array( 'title' ), 'strip_html' );
+            $this->form->addFilters( array( 'title' ), 'strip_html' );
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.php	2006-02-08 14:26:48 UTC (rev 1646)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.php	2006-02-08 14:36:39 UTC (rev 1647)
@@ -24,7 +24,7 @@
             $this->form->addRule( 'url', 'required', t( 'err_link_url' ) );
 
             // Add the filters
-            $form->addFilters( array( 'title', 'url' ), 'strip_html' );
+            $this->form->addFilters( array( 'title', 'url' ), 'strip_html' );
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-02-08 14:26:48 UTC (rev 1646)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-02-08 14:36:39 UTC (rev 1647)
@@ -25,7 +25,7 @@
             $this->form->addRule( 'body', 'required', t( 'err_page_body' ) );
 
             // Add the filters
-            $form->addFilters( array( 'title' ), 'strip_html' );
+            $this->form->addFilters( array( 'title' ), 'strip_html' );
 
         }
 



From pieter at yellowduck.be  Wed Feb  8 15:36:55 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 8 Feb 2006 15:36:55 +0100
Subject: [ydf-devel] YDWeblog typos in adding strip_html filters
In-Reply-To: <306340e00602080541s7a251d89y@mail.gmail.com>
References: <306340e00602080541s7a251d89y@mail.gmail.com>
Message-ID: <4aef63030602080636x64c4284cn81297045f19f092c@mail.gmail.com>

Fixed in build 1647.

pieter

On 2/8/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter
>
> After you added strip_html filter in YDWeblog, i found 3 cut/paste-like
> typos:
>
> replace "$form->addFilters( array( 'title' ), 'strip_html' );"
> with "$this->form->addFilters( array( 'title' ), 'strip_html' );"
>
>  - in file weblog/manage/categories.php line 25
>  - in file weblog/manage/links.php line 27
>  - in file weblog/manage/pages.php line 28
>
> Don't you think you should have only one method YDForm::addFilter (without
> ending "s") recognizing its parameter's type, rather than two?
>
> Kind regards
> --
> po?




--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/072f1919/attachment.html>

From francisco at fusemail.com  Wed Feb  8 22:41:42 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 08 Feb 2006 21:41:42 +0000
Subject: [ydf-devel] mailing lists reply-to header in all messages
Message-ID: <43EA6596.8000100@fusemail.com>

Hi all

Pieter, is there possible to define a "Reply-to" in the mailing list? 
This way, it's easier to reply.

Francisco Azevedo


From muitocomplicado at gmail.com  Thu Feb  9 00:29:55 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Wed, 8 Feb 2006 20:29:55 -0300
Subject: [ydf-devel] Releases
Message-ID: <12260be20602081529r7da3abdfnd4a80609cef95981@mail.gmail.com>

Hey Pieter,

Let's release a new version of YDF, please...

There were a few questions in the forum about stuff from RC2 that was so old
that the latest version didn't have.

-db
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060208/6980b84b/attachment.html>

From pieter at yellowduck.be  Thu Feb  9 09:20:04 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 9 Feb 2006 09:20:04 +0100
Subject: [ydf-devel] mailing lists reply-to header in all messages
In-Reply-To: <43EA6596.8000100@fusemail.com>
References: <43EA6596.8000100@fusemail.com>
Message-ID: <4aef63030602090020x6850ac56ie09b2c46829ecb21@mail.gmail.com>

Should be the case now.

pieter


On 2/8/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi all
>
> Pieter, is there possible to define a "Reply-to" in the mailing list?
> This way, it's easier to reply.
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/f05849b8/attachment.html>

From pieter at yellowduck.be  Thu Feb  9 09:21:24 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 9 Feb 2006 09:21:24 +0100
Subject: [ydf-devel] Releases
In-Reply-To: <12260be20602081529r7da3abdfnd4a80609cef95981@mail.gmail.com>
References: <12260be20602081529r7da3abdfnd4a80609cef95981@mail.gmail.com>
Message-ID: <4aef63030602090021w14a6735dydbf096441f9112b5@mail.gmail.com>

I'll release 2.0 final next week.

pieter

On 2/9/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
>
> Hey Pieter,
>
> Let's release a new version of YDF, please...
>
> There were a few questions in the forum about stuff from RC2 that was so
> old that the latest version didn't have.
>
> -db
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/e9cb5f93/attachment.html>

From francisco at fusemail.com  Thu Feb  9 11:44:51 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 9 Feb 2006 04:44:51 -0600 (CST)
Subject: [ydf-devel] simplify YDDatabase usage even more
Message-ID:      <19370.194.38.142.34.1139481891.fusewebmail-15630@webmail.fusemail.com
     >

Hi all

I propose a new YDDatabase feature to better handle db connections. On
some (medium/big) projects we need to initializate db connections on lots
of classes and pass the same arguments to YDDatabase::getInstance.

I propose to make a new YDConfig variable (like YD_DB_TABLEPREFIX) but for
all parameters of YDDatabase::getInstance.

Then we could define the general db parameters in a master class:

YDConfig::set( 'YD_DB_TYPE', 'mysql' );
YDConfig::set( 'YD_DB_TABLE', 'table' );
YDConfig::set( 'YD_DB_USERNAME', 'user' );
YDConfig::set( 'YD_DB_PASSWORD', 'pass' );
YDConfig::set( 'YD_DB_HOST', 'localhost' );

This way, in the other dozens places, we just need to invoke
YDDatabase::getInstance() and that's it:

$db = YDDatabase::getInstance();

Btw, this could be used by YDDatabaseObject too.

What do you think?

Francisco Azevedo


From muitocomplicado at gmail.com  Thu Feb  9 12:08:29 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Thu, 9 Feb 2006 08:08:29 -0300
Subject: [ydf-devel] simplify YDDatabase usage even more
In-Reply-To: <19370.194.38.142.34.1139481891.fusewebmail-15630@webmail.fusemail.com>
References: <19370.194.38.142.34.1139481891.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <12260be20602090308i51b68eage081d61787fa6c04@mail.gmail.com>

It's ok by me... actually I already do this on my own and have another
config for the database instance:

$db = YDConfig::get( 'ydb' );

But your way is more clear and will simplify YDDatabaseObject too, making
optional the registerDatabase function.

-db


But I'm not sure that

On 2/9/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi all
>
> I propose a new YDDatabase feature to better handle db connections. On
> some (medium/big) projects we need to initializate db connections on lots
> of classes and pass the same arguments to YDDatabase::getInstance.
>
> I propose to make a new YDConfig variable (like YD_DB_TABLEPREFIX) but for
> all parameters of YDDatabase::getInstance.
>
> Then we could define the general db parameters in a master class:
>
> YDConfig::set( 'YD_DB_TYPE', 'mysql' );
> YDConfig::set( 'YD_DB_TABLE', 'table' );
> YDConfig::set( 'YD_DB_USERNAME', 'user' );
> YDConfig::set( 'YD_DB_PASSWORD', 'pass' );
> YDConfig::set( 'YD_DB_HOST', 'localhost' );
>
> This way, in the other dozens places, we just need to invoke
> YDDatabase::getInstance() and that's it:
>
> $db = YDDatabase::getInstance();
>
> Btw, this could be used by YDDatabaseObject too.
>
> What do you think?
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/7a6b98a8/attachment.html>

From francisco at fusemail.com  Thu Feb  9 12:19:27 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 9 Feb 2006 05:19:27 -0600 (CST)
Subject: [ydf-devel] simplify YDDatabase usage even more
Message-ID:      <19497.194.38.142.34.1139483967.fusewebmail-15630@webmail.fusemail.com
     >

> It's ok by me... actually I already do this on my own and have another
config for the database instance:$db = YDConfig::get( 'ydb' );

Yes, the objective is to forget globals.. as this seems more a ydf
internal task.

>But your way is more clear and will simplify YDDatabaseObject too, making
optional the registerDatabase function.

Well.. i think you mean to make optional the registerDatabase function
arguments, right?
A YDConfig for YDDatabaseObject to define that YDDatabaseObject should use
YDConfig db variables sounds good to me too (then we don't need to use the
registerDatabase function).

Francisco Azevedo


From pclaerhout at berlios.de  Thu Feb  9 13:13:01 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Thu, 9 Feb 2006 13:13:01 +0100
Subject: [ydf-devel] r1648 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples
Message-ID: <200602091213.k19CD1cU031674@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-09 13:12:58 +0100 (Thu, 09 Feb 2006)
New Revision: 1648

Added:
   YDFramework2.0/trunk/examples/guidutil.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added the YDGuidUtil class and also added examples for using it.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-08 14:36:39 UTC (rev 1647)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-09 12:12:58 UTC (rev 1648)
@@ -945,4 +945,53 @@
 
     }
 
+    /**
+     *  This class allows you to generate GUIDs (global unique identifier).
+     *
+     *  More info: http://www.ietf.org/rfc/rfc4122.txt
+     */
+    class YDGuidUtil extends YDBase {
+
+        /**
+         *  Generate a new GUID.
+         *
+         *  @returns    A new GUID as a string.
+         */
+        function create() {
+            return md5( uniqid( rand(), true ) . $_ENV['COMPUTERNAME'] . $_SERVER['SERVER_ADDR'] );
+        }
+
+        /**
+         *  Generate a new formatted GUID.
+         *
+         *  @returns    A formatted GUID as a string.
+         */
+        function createFormatted() {
+            return YDGuidUtil::format( YDGuidUtil::create() );
+//            YDDebugUtil::dump( $g );
+//            return sprintf(
+//                '%s-%s-%s-%s-%s',
+//                substr( $g, 0, 8 ), substr( $g, 8, 4 ), substr( $g, 12, 4 ), substr( $g, 16, 4 ), substr( $g, 20 )
+//            );
+//            //substr( $g, 0, 8 ) . '-' . substr( $g, 8, 4 ) . '-' . substr( $g, 12, 4 ) . '-' . substr( $g, 16, 4 ) . '-' . substr( $g, 20 );
+        }
+
+        /**
+         *  Formats a GUID.
+         *
+         *  @param $g    GUID to format.
+         *
+         *  @returns    A formatted GUID as a string.
+         */
+         function format( $g ) {
+            $g = str_replace( '-', '', $g );
+            return sprintf(
+                '%s-%s-%s-%s-%s',
+                substr( $g, 0, 8 ), substr( $g, 8, 4 ), substr( $g, 12, 4 ), substr( $g, 16, 4 ), substr( $g, 20 )
+            );
+         }
+
+
+    }
+
 ?>

Added: YDFramework2.0/trunk/examples/guidutil.php
===================================================================
--- YDFramework2.0/trunk/examples/guidutil.php	2006-02-08 14:36:39 UTC (rev 1647)
+++ YDFramework2.0/trunk/examples/guidutil.php	2006-02-09 12:12:58 UTC (rev 1648)
@@ -0,0 +1,40 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+
+    // Class definition
+    class guidutil extends YDRequest {
+
+        // Class constructor
+        function guidutil() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Generate 10 GUIDs
+            foreach ( range( 1, 10 ) as $i ) {
+
+                // Show the raw version
+                $guid = YDGuidUtil::create();
+                YDDebugUtil::dump( $guid, 'GUID ' . $i );
+
+                // Create a formatted one
+                $guid_formatted = YDGuidUtil::format( $guid );
+                YDDebugUtil::dump( $guid_formatted, 'Formatted GUID ' . $i );
+
+            }
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-02-08 14:36:39 UTC (rev 1647)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-02-09 12:12:58 UTC (rev 1648)
@@ -689,7 +689,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="14" valign="top">&nbsp;</td>
+            <td rowspan="15" valign="top">&nbsp;</td>
             <td valign="top"><a href="constants.php">YDFramework2 constants</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=constants.php">constants.php</a>
@@ -759,6 +759,12 @@
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=error.php">error.php</a>
             </td>
         </tr>
+        <tr>
+            <td valign="top"><a href="guidutil.php">Using the YDGuidUtil class</a></td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=guidutil.php">guidutil.php</a>
+            </td>
+        </tr>
         </table>
 
     {/if}



From pieter at yellowduck.be  Thu Feb  9 13:17:19 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 9 Feb 2006 13:17:19 +0100
Subject: [ydf-devel] simplify YDDatabase usage even more
In-Reply-To: <19497.194.38.142.34.1139483967.fusewebmail-15630@webmail.fusemail.com>
References: <19497.194.38.142.34.1139483967.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <4aef63030602090417p41fa648ek9cee81b8187960dd@mail.gmail.com>

I actually prefer we implement some database connection parameters pool, e.g.
in a config or XML file. That way, we could make something like
YDDatabase::getNamedInstance which would return the database connection.

If you make this in a smart way, there can be options to define where the
aliases are defined.

This also raises the issue of a global configuration option for the a web
application. I'm planning on making some basic infrastructure every web
application needs, such as e.g. config files, administration section which
is password protected, skins, etc. A bit like the YDWeblog application but
applicable to different kinds of web applications (compare it to what Ruby
on Rails is doing).

regards,


pieter

On 2/9/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> > It's ok by me... actually I already do this on my own and have another
> config for the database instance:$db = YDConfig::get( 'ydb' );
>
> Yes, the objective is to forget globals.. as this seems more a ydf
> internal task.
>
> >But your way is more clear and will simplify YDDatabaseObject too, making
> optional the registerDatabase function.
>
> Well.. i think you mean to make optional the registerDatabase function
> arguments, right?
> A YDConfig for YDDatabaseObject to define that YDDatabaseObject should use
> YDConfig db variables sounds good to me too (then we don't need to use the
> registerDatabase function).
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/d39655b0/attachment.html>

From ximian at berlios.de  Thu Feb  9 14:46:33 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 9 Feb 2006 14:46:33 +0100
Subject: [ydf-devel] r1649 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602091346.k19DkXWZ007913@sheep.berlios.de>

Author: ximian
Date: 2006-02-09 14:46:09 +0100 (Thu, 09 Feb 2006)
New Revision: 1649

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
response effects can be assigned to simple html ids and not only form elements

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-09 12:12:58 UTC (rev 1648)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-09 13:46:09 UTC (rev 1649)
@@ -427,10 +427,21 @@
 
 			// initialize js to send
 			$js = '';
+
+			// test if effect id is a form element
+			if ( $this->form->isElement( $effect->getId() ) ){
+				
+				// get element
+				$elem = & $this->form->getElement( $effect->getId() );		
+
+				// element id
+				$id = $elem->getAttribute( 'id' );
+			}else{
+			
+				// if effect id is not a form element then its a html id
+				$id = $effect->getId();
+			}
 		
-			// element id
-			$id = $this->form->getName() .'_'. $effect->getId();
-		
 			// if some html id has not already an effect applyed we must send effect header
 			if (!in_array( $effect->getVariable(), $this->effects ))
 				$js = $effect->getJSHead( $id );



From pieter at yellowduck.be  Thu Feb  9 14:50:10 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 9 Feb 2006 14:50:10 +0100
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <4aef63030602080040pcdb2746i105ea55f9b9350f9@mail.gmail.com>
References: <4aef63030602080040pcdb2746i105ea55f9b9350f9@mail.gmail.com>
Message-ID: <4aef63030602090550k1d660471r628a0036ea7997fe@mail.gmail.com>

I've been looking at Eventum from MySQL, and it looks pretty much like what
we need:

http://www.mysql.com/products/eventum

Any suggestions or objections?

Regards,


pieter

On 2/8/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
> Hi all,
>
> we need to start to think about a bug database and feature request tracker
> for the framework.
>
> I was thinking about something along the lines of:
>
> - Combined bug database and feature request database
> - Logging of bugs and viewing can be done by anyone
> - Updating bugs can only done by the registered users (= developers)
> - Each bug/feature request can have the following properties:
>   - ID
>   - Type: bug/feature request
>   - Title
>   - Description
>   - History
>   - Created on/by
>   - Modified on/by
>   - attachements?
>   - Part: YDFramework-core, YDWeblog or addon x/y/x
>   - Status: new/assigned/closed/rejected
>   - Developer taking care of it
>
> Of course, there should be options to sort/filter/etc...
>
> Sounds like a plan?
>
> If someone knows of anything off the shelve that might suit or needs as
> well, please let me know.
>
> cheers,
>
>
> pieter
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/6ce42883/attachment.html>

From francisco at fusemail.com  Thu Feb  9 15:03:29 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 9 Feb 2006 08:03:29 -0600 (CST)
Subject: [ydf-devel] Re: Bug/Feature Request database
Message-ID:      <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com
     >

> I've been looking at Eventum from MySQL, and it looks pretty much like
what we need:
>
> http://www.mysql.com/products/eventum
>
> Any suggestions or objections?

Seems good. Maybe we should try it.

Francisco Azevedo


From pieter at yellowduck.be  Thu Feb  9 15:19:45 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 9 Feb 2006 15:19:45 +0100
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
References: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>

I played around with it a bit more, and it seems like real overkill. Too
many features for us almost.

I'll just keep it under consideration for the moment.

regards,


pieter

On 2/9/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> > I've been looking at Eventum from MySQL, and it looks pretty much like
> what we need:
> >
> > http://www.mysql.com/products/eventum
> >
> > Any suggestions or objections?
>
> Seems good. Maybe we should try it.
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/123074fb/attachment.html>

From muitocomplicado at gmail.com  Fri Feb 10 00:37:38 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Thu, 9 Feb 2006 20:37:38 -0300
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>
References: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
	 <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>
Message-ID: <12260be20602091537w5d6da50cu8cf321026bdb8dd6@mail.gmail.com>

I like Trac a lot.

http://www.edgewall.com/trac/

It's in python, but is very very simple and useful. I already use it in one
project and is very easy to keep track of everything and everybody with it's
clean interface and features.

What Trac can do?

   - software issues
   - bug reports
   - feature requests
   - overall progress over time
   - project tasks
   - source code changes
   - documentation / wiki text

It can access the subversion repository and log the changes,  and in the
wiki we can have pages and documentation easily added.

I recommend it.

-db

On 2/9/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
> I played around with it a bit more, and it seems like real overkill. Too
> many features for us almost.
>
> I'll just keep it under consideration for the moment.
>
> regards,
>
>
> pieter
>
> On 2/9/06, Francisco Azevedo <francisco at fusemail.com> wrote:
> >
> >
> > > I've been looking at Eventum from MySQL, and it looks pretty much like
> > what we need:
> > >
> > > http://www.mysql.com/products/eventum
> > >
> > > Any suggestions or objections?
> >
> > Seems good. Maybe we should try it.
> >
> > Francisco Azevedo
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/840cb7b1/attachment.html>

From muitocomplicado at gmail.com  Fri Feb 10 00:40:53 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Thu, 9 Feb 2006 20:40:53 -0300
Subject: [ydf-devel] Revision's e-mails
Message-ID: <12260be20602091540s655d31eay1cbda308b800812e@mail.gmail.com>

I think the revision e-mails are too big.

Perhaps would be better to have only the information about the changes log
and the modified files, like the information we have in the feed. Example:

Revision 1648 | pclaerhout | Thu, 9 Feb 2006 12:12:59 GMT

Added the YDGuidUtil class and also added examples for using it.

[M] /YDFramework2.0/trunk/examples/index.tpl
[M] /YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
[A] /YDFramework2.0/trunk/examples/guidutil.php

cheers,

-db
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/c1530985/attachment.html>

From muitocomplicado at gmail.com  Fri Feb 10 00:44:01 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Thu, 9 Feb 2006 20:44:01 -0300
Subject: [ydf-devel] YDGuiUtil example notices
Message-ID: <12260be20602091544u395eb9f6x6574dbca1a8cba5a@mail.gmail.com>

I'm getting this notice in the guiutil example. I think is because of the
$_ENV['COMPUTERNAME'] variable.*

Notice*: Undefined index: COMPUTERNAME in *
D:\ApacheFriends\xampp\htdocs\yellow_duck\YDFramework2\YDClasses\YDUtil.php*on
line
*961
*
-db*
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060209/929e119c/attachment.html>

From pieter at yellowduck.be  Fri Feb 10 08:41:56 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 08:41:56 +0100
Subject: [ydf-devel] Revision's e-mails
In-Reply-To: <12260be20602091540s655d31eay1cbda308b800812e@mail.gmail.com>
References: <12260be20602091540s655d31eay1cbda308b800812e@mail.gmail.com>
Message-ID: <4aef63030602092341r5c83f305y46ac642673633e26@mail.gmail.com>

I'm not sure if that's easy to change. I'll see if I can change this.

pieter

On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
> I think the revision e-mails are too big.
>
> Perhaps would be better to have only the information about the changes log
> and the modified files, like the information we have in the feed. Example:
>
> Revision 1648 | pclaerhout | Thu, 9 Feb 2006 12:12:59 GMT
>
> Added the YDGuidUtil class and also added examples for using it.
>
> [M] /YDFramework2.0/trunk/examples/index.tpl
> [M] /YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
> [A] /YDFramework2.0/trunk/examples/guidutil.php
>
> cheers,
>
> -db


--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/


From pieter at yellowduck.be  Fri Feb 10 08:43:30 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 08:43:30 +0100
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <12260be20602091537w5d6da50cu8cf321026bdb8dd6@mail.gmail.com>
References: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
	 <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>
	 <12260be20602091537w5d6da50cu8cf321026bdb8dd6@mail.gmail.com>
Message-ID: <4aef63030602092343j4e811aacx5f820944f3b107@mail.gmail.com>

Do you have any experience with installing it?

I also had a look at mantis for tracking bugs, and it seems more
simple and easier to use than eventum.

One other option of course is to use the standard tools from berlios.de.

pieter

On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
> I like Trac a lot.
>
> http://www.edgewall.com/trac/
>
> It's in python, but is very very simple and useful. I already use it in one
> project and is very easy to keep track of everything and everybody with it's
> clean interface and features.
>
> What Trac can do?
>
> software issues
> bug reports
> feature requests
> overall progress over time
> project tasks
> source code changes
> documentation / wiki text It can access the subversion repository and log
> the changes,  and in the wiki we can have pages and documentation easily
> added.
>
> I recommend it.
>
> -db
>
>
> On 2/9/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
> >
> > I played around with it a bit more, and it seems like real overkill. Too
> many features for us almost.
> >
> > I'll just keep it under consideration for the moment.
> >
> > regards,
> >
> >
> > pieter
> >
> >
> > On 2/9/06, Francisco Azevedo <francisco at fusemail.com > wrote:
> > >
> > > > I've been looking at Eventum from MySQL, and it looks pretty much like
> > > what we need:
> > > >
> > > > http://www.mysql.com/products/eventum
> > > >
> > > > Any suggestions or objections?
> > >
> > > Seems good. Maybe we should try it.
> > >
> > > Francisco Azevedo
> > > _______________________________________________
> > > YDFramework-devel mailing list
> > > YDFramework-devel at lists.berlios.de
> > >
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
> > >
> >
> >
> >
> >
> > --
> > pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>
>


--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/


From muitocomplicado at gmail.com  Fri Feb 10 11:11:09 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 10 Feb 2006 07:11:09 -0300
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <4aef63030602092343j4e811aacx5f820944f3b107@mail.gmail.com>
References: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
	 <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>
	 <12260be20602091537w5d6da50cu8cf321026bdb8dd6@mail.gmail.com>
	 <4aef63030602092343j4e811aacx5f820944f3b107@mail.gmail.com>
Message-ID: <12260be20602100211x5bf84c6bi107ed6f95f8f4646@mail.gmail.com>

Yes, I installed it 2 times already (windows and linux). There are a few
requirements like python, svn, clearsilver, etc.

I don't think clearsilver and trac itself can be installed in berlios.de as
they need root permissions.

I looked around for Trac hosting for open source projects and I found some
but I don't know if they can be configured to access a svn repository in a
different server, like ours at berlios.

I think Mantis is too much... too busy... I don't know.

The tools from berlios are simplier and do what we need: bug tracking and
feature requests.

If there was a way of using Trac I would recommend it over berlios, but this
will be hard, so I think berlios.de is the best way to go.

-db

On 2/10/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
> Do you have any experience with installing it?
>
> I also had a look at mantis for tracking bugs, and it seems more
> simple and easier to use than eventum.
>
> One other option of course is to use the standard tools from berlios.de.
>
> pieter
>
> On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
> > I like Trac a lot.
> >
> > http://www.edgewall.com/trac/
> >
> > It's in python, but is very very simple and useful. I already use it in
> one
> > project and is very easy to keep track of everything and everybody with
> it's
> > clean interface and features.
> >
> > What Trac can do?
> >
> > software issues
> > bug reports
> > feature requests
> > overall progress over time
> > project tasks
> > source code changes
> > documentation / wiki text It can access the subversion repository and
> log
> > the changes,  and in the wiki we can have pages and documentation easily
> > added.
> >
> > I recommend it.
> >
> > -db
> >
> >
> > On 2/9/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
> > >
> > > I played around with it a bit more, and it seems like real overkill.
> Too
> > many features for us almost.
> > >
> > > I'll just keep it under consideration for the moment.
> > >
> > > regards,
> > >
> > >
> > > pieter
> > >
> > >
> > > On 2/9/06, Francisco Azevedo <francisco at fusemail.com > wrote:
> > > >
> > > > > I've been looking at Eventum from MySQL, and it looks pretty much
> like
> > > > what we need:
> > > > >
> > > > > http://www.mysql.com/products/eventum
> > > > >
> > > > > Any suggestions or objections?
> > > >
> > > > Seems good. Maybe we should try it.
> > > >
> > > > Francisco Azevedo
> > > > _______________________________________________
> > > > YDFramework-devel mailing list
> > > > YDFramework-devel at lists.berlios.de
> > > >
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> > > >
> > >
> > >
> > >
> > >
> > > --
> > > pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> >
> >
>
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/52e2c5e0/attachment.html>

From pieter at yellowduck.be  Fri Feb 10 11:20:18 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 11:20:18 +0100
Subject: [ydf-devel] Re: Bug/Feature Request database
In-Reply-To: <12260be20602100211x5bf84c6bi107ed6f95f8f4646@mail.gmail.com>
References: <19704.194.38.142.34.1139493809.fusewebmail-15630@webmail.fusemail.com>
	 <4aef63030602090619w36417b31haa017355994397a9@mail.gmail.com>
	 <12260be20602091537w5d6da50cu8cf321026bdb8dd6@mail.gmail.com>
	 <4aef63030602092343j4e811aacx5f820944f3b107@mail.gmail.com>
	 <12260be20602100211x5bf84c6bi107ed6f95f8f4646@mail.gmail.com>
Message-ID: <4aef63030602100220m25c8190chba37a34dcf1f783b@mail.gmail.com>

Then I would suggest to stick with the options we have in berlios.de. It's
the easiest and most straightforward way of dealing with this.

pieter

On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
>
> Yes, I installed it 2 times already (windows and linux). There are a few
> requirements like python, svn, clearsilver, etc.
>
> I don't think clearsilver and trac itself can be installed in berlios.de as
> they need root permissions.
>
> I looked around for Trac hosting for open source projects and I found some
> but I don't know if they can be configured to access a svn repository in a
> different server, like ours at berlios.
>
> I think Mantis is too much... too busy... I don't know.
>
> The tools from berlios are simplier and do what we need: bug tracking and
> feature requests.
>
> If there was a way of using Trac I would recommend it over berlios, but
> this will be hard, so I think berlios.de is the best way to go.
>
> -db
>
>  On 2/10/06, Pieter Claerhout <pieter at yellowduck.be > wrote:
>
> > Do you have any experience with installing it?
> >
> > I also had a look at mantis for tracking bugs, and it seems more
> > simple and easier to use than eventum.
> >
> > One other option of course is to use the standard tools from berlios.de.
> >
> > pieter
> >
> > On 2/10/06, David Bittencourt < muitocomplicado at gmail.com> wrote:
> > > I like Trac a lot.
> > >
> > > http://www.edgewall.com/trac/
> > >
> > > It's in python, but is very very simple and useful. I already use it
> > in one
> > > project and is very easy to keep track of everything and everybody
> > with it's
> > > clean interface and features.
> > >
> > > What Trac can do?
> > >
> > > software issues
> > > bug reports
> > > feature requests
> > > overall progress over time
> > > project tasks
> > > source code changes
> > > documentation / wiki text It can access the subversion repository and
> > log
> > > the changes,  and in the wiki we can have pages and documentation
> > easily
> > > added.
> > >
> > > I recommend it.
> > >
> > > -db
> > >
> > >
> > > On 2/9/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
> > > >
> > > > I played around with it a bit more, and it seems like real overkill.
> > Too
> > > many features for us almost.
> > > >
> > > > I'll just keep it under consideration for the moment.
> > > >
> > > > regards,
> > > >
> > > >
> > > > pieter
> > > >
> > > >
> > > > On 2/9/06, Francisco Azevedo <francisco at fusemail.com > wrote:
> > > > >
> > > > > > I've been looking at Eventum from MySQL, and it looks pretty
> > much like
> > > > > what we need:
> > > > > >
> > > > > > http://www.mysql.com/products/eventum
> > > > > >
> > > > > > Any suggestions or objections?
> > > > >
> > > > > Seems good. Maybe we should try it.
> > > > >
> > > > > Francisco Azevedo
> > > > > _______________________________________________
> > > > > YDFramework-devel mailing list
> > > > > YDFramework-devel at lists.berlios.de
> > > > >
> > > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> > > > >
> > > >
> > > >
> > > >
> > > >
> > > > --
> > > > pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> > >
> > >
> >
> >
> > --
> > pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>


--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/ef83119b/attachment.html>

From ximian at berlios.de  Fri Feb 10 11:27:47 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Fri, 10 Feb 2006 11:27:47 +0100
Subject: [ydf-devel] r1650 - in YDFramework2.0/trunk/examples: . ajax
Message-ID: <200602101027.k1AARlEa007433@sheep.berlios.de>

Author: ximian
Date: 2006-02-10 11:27:33 +0100 (Fri, 10 Feb 2006)
New Revision: 1650

Modified:
   YDFramework2.0/trunk/examples/ajax/autocompleter.php
   YDFramework2.0/trunk/examples/ajax/date_calculator.php
   YDFramework2.0/trunk/examples/ajax/image2.php
   YDFramework2.0/trunk/examples/ajax/version.php
   YDFramework2.0/trunk/examples/index.tpl
Log:
- small typos on YDAjax examples
- exemple index typo fixed

Modified: YDFramework2.0/trunk/examples/ajax/autocompleter.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/autocompleter.php	2006-02-09 13:46:09 UTC (rev 1649)
+++ YDFramework2.0/trunk/examples/ajax/autocompleter.php	2006-02-10 10:27:33 UTC (rev 1650)
@@ -23,7 +23,7 @@
 		// Default action
 		function actionDefault() {
 
-			// create a form with a 2 texts, a button and a span for result
+			// create a form with a 2 autocompleters and a simple text element
 			$form = new YDForm('myform');
 			$form->addElement('autocompleter', 'arg1', 'Country with standard style:', '', array( &$this, 'getCountry' ) );
 			$form->addElement('text',          'arg2', 'Just a simple text box without autocompleter');

Modified: YDFramework2.0/trunk/examples/ajax/date_calculator.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/date_calculator.php	2006-02-09 13:46:09 UTC (rev 1649)
+++ YDFramework2.0/trunk/examples/ajax/date_calculator.php	2006-02-10 10:27:33 UTC (rev 1650)
@@ -60,10 +60,10 @@
 		
 			// add number to date
 			switch ( intval( $type )){
-				case 0 : $date->addMinute( $number ); break;
-				case 1 : $date->addDay( $number );    break;
-				case 2 : $date->addMonth( $number );  break;
-				case 3 : $date->addYear( $number );   break;
+				case 0 :  $date->addMinute( $number ); break;
+				case 1 :  $date->addDay( $number );    break;
+				case 2 :  $date->addMonth( $number );  break;
+				default : $date->addYear( $number );
 			}
 
 			// assign span with date

Modified: YDFramework2.0/trunk/examples/ajax/image2.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/image2.php	2006-02-09 13:46:09 UTC (rev 1649)
+++ YDFramework2.0/trunk/examples/ajax/image2.php	2006-02-10 10:27:33 UTC (rev 1650)
@@ -31,7 +31,7 @@
 			$this->form->addElement( 'link',    'myspan2',  'Rebuild chart 2', '', '#' );
 			$this->form->addElement( 'link',    'myspan3',  'Rebuild both charts', '', '#' );
 			$this->form->addElement( 'link',    'myspan4',  'Rebuild chart 1 and apply "resize" with "modify(50, 100) to chart 2"', '', '#' );
-			$this->form->addElement( 'link',    'myspan5',  'Apply fade to chart 1 using the response (not on ajax call) and simulate a slow server', '', '#' );
+			$this->form->addElement( 'link',    'myspan5',  'Apply fade to chart 1 using the response (not on ajax call) and simulate a slow server (1 sec)', '', '#' );
 
 			$this->form->addElement( 'img',     'myimage1', '', array( 'width' => 550, 'height' => 250 ) );
 			$this->form->addElement( 'img',     'myimage2', '', array( 'width' => 550, 'height' => 250 ) );
@@ -53,7 +53,7 @@
 			$this->ajax->processEvents();
 
 			// assign title, form and display template
-			$this->tpl->assign( 'title', 'This example will demonstrates the Waiting Message and effects creation' );
+			$this->tpl->assign( 'title', 'This example demonstrates effects creation' );
 			$this->tpl->assign( 'form',  $this->form->render('html') );
 			$this->tpl->display( 'general' );
 		}
@@ -79,7 +79,7 @@
 		function response2(){
 		
 			// simulate slow server (to better see the waiting message)
-			sleep( 3 );
+			sleep( 1 );
 		
 			// create fade effect
 			$fade = new YDAjaxEffect( 'myimage1', 'opacity', "custom(1, 0.5)" );

Modified: YDFramework2.0/trunk/examples/ajax/version.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/version.php	2006-02-09 13:46:09 UTC (rev 1649)
+++ YDFramework2.0/trunk/examples/ajax/version.php	2006-02-10 10:27:33 UTC (rev 1650)
@@ -9,9 +9,6 @@
 	YDInclude( 'YDForm.php' );
 	YDInclude( 'YDAjax.php' );
 
-//  YDConfig::set( 'YD_AJAX_ENCODING', "iso-8859-15" );
-//	YDConfig::set( 'YD_AJAX_DEBUG', true );
-
 	// Class definition
 	class version extends YDRequest {
 

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-02-09 13:46:09 UTC (rev 1649)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-02-10 10:27:33 UTC (rev 1650)
@@ -204,7 +204,7 @@
         <tr>
             <td valign="top"><a href="form2.php">Form handling and validation (new style)</a> </td>
             <td valign="top">
-                <a href="{$YD_SELF_SCRIPT}?do=source&id=form2.php">form.php</a>
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=form2.php">form2.php</a>
             </td>
         </tr>
         <tr>



From francisco at fusemail.com  Fri Feb 10 11:31:01 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 10 Feb 2006 04:31:01 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject warnings
Message-ID:      <20500.194.38.142.34.1139567461.fusewebmail-15630@webmail.fusemail.com
     >

Hi db

I'm getting some warnings on YDDatabaseObject:

"Only variable references should be returned by reference" in:
- YDDatabaseObject line 188
- YDDatabaseObject line 465

Can you take a look?

Francisco Azevedo


From francisco at fusemail.com  Fri Feb 10 11:41:25 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 10 Feb 2006 04:41:25 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject new features
Message-ID:      <20550.194.38.142.34.1139568085.fusewebmail-15630@webmail.fusemail.com
     >

Hi db

Now that i'm using YDDatabaseObject more actively i have some
questions/features ;)

- new method getColumnFull().. that returns the full column name.. eg:
"table.column" and not only "column" (returned by getColumn)

- new method to register protected values that are not equal to something.
registerProtected() will protect values that are equal to some static
value.. i propose some way (or new method) that protects a value with a
custom comparation..
eg: registerProtected('timestamp', '1231231231', '<') that only accepts
timestamps smaller than 1231231231.

What do you think?

Francisco Azevedo




From david_db at berlios.de  Fri Feb 10 11:46:46 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 11:46:46 +0100
Subject: [ydf-devel] r1651 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602101046.k1AAkkHj010422@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 11:46:41 +0100 (Fri, 10 Feb 2006)
New Revision: 1651

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed some returns by reference in YDDatabaseObject.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 10:27:33 UTC (rev 1650)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 10:46:41 UTC (rev 1651)
@@ -179,12 +179,16 @@
          *  This function registers the table name.
          *
          *  @param $name  The table name.
+         *
+         *  @returns  A reference to the alias.
          */
         function & registerTable( $name ) {
             
             $this->_table = $name;
             $this->_alias = $name;
             
+            return $this->_alias;
+            
         }
 
         /**
@@ -436,6 +440,8 @@
             if ( $this->_fields->exists( $name ) ) {
                 return $this->_fields->$name;
             }
+            $null = null;
+            return null;
         }
 
         /**
@@ -449,6 +455,8 @@
             if ( $this->_relations->exists( $name ) ) {
                 return $this->_relations->$name;
             }
+            $null = null;
+            return $null;
         }
 
         /**
@@ -462,6 +470,8 @@
             if ( $this->_selects->exists( $name ) ) {
                 return $this->_selects->$name;
             }
+            $null = null;
+            return $null;
         }
 
         /**



From pieter at yellowduck.be  Fri Feb 10 11:48:08 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 11:48:08 +0100
Subject: [ydf-devel] YDDatabaseObject new features
In-Reply-To: <20550.194.38.142.34.1139568085.fusewebmail-15630@webmail.fusemail.com>
References: <20550.194.38.142.34.1139568085.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <4aef63030602100248k47341b4bpc327a194a59ef1b7@mail.gmail.com>

Can you log them on:
http://developer.berlios.de/feature/?group_id=3988

pieter

On 2/10/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> Hi db
>
> Now that i'm using YDDatabaseObject more actively i have some
> questions/features ;)
>
> - new method getColumnFull().. that returns the full column name.. eg:
> "table.column" and not only "column" (returned by getColumn)
>
> - new method to register protected values that are not equal to something.
> registerProtected() will protect values that are equal to some static
> value.. i propose some way (or new method) that protects a value with a
> custom comparation..
> eg: registerProtected('timestamp', '1231231231', '<') that only accepts
> timestamps smaller than 1231231231.
>
> What do you think?
>
> Francisco Azevedo
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/7f64fa5c/attachment.html>

From muitocomplicado at gmail.com  Fri Feb 10 11:48:40 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 10 Feb 2006 07:48:40 -0300
Subject: [ydf-devel] YDDatabaseObject warnings
In-Reply-To: <20500.194.38.142.34.1139567461.fusewebmail-15630@webmail.fusemail.com>
References: <20500.194.38.142.34.1139567461.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <12260be20602100248g7a4edf76o6f219104bc21817c@mail.gmail.com>

Fixed in build 1651.

Can you test it because I'm not getting these warnings with my PHP version.

-db


On 2/10/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi db
>
> I'm getting some warnings on YDDatabaseObject:
>
> "Only variable references should be returned by reference" in:
> - YDDatabaseObject line 188
> - YDDatabaseObject line 465
>
> Can you take a look?
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/d7c4a665/attachment.html>

From ximian at berlios.de  Fri Feb 10 11:50:52 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Fri, 10 Feb 2006 11:50:52 +0100
Subject: [ydf-devel] r1652 - YDFramework2.0/trunk/examples
Message-ID: <200602101050.k1AAoqwC010845@sheep.berlios.de>

Author: ximian
Date: 2006-02-10 11:50:37 +0100 (Fri, 10 Feb 2006)
New Revision: 1652

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
small typo fixed

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-02-10 10:46:41 UTC (rev 1651)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-02-10 10:50:37 UTC (rev 1652)
@@ -629,7 +629,7 @@
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/date_calculator.php">ajax/date_calculator.php</a> </td>
         </tr>
         <tr>
-          <td valign="top"><a href="ajax/form.php">Form submittion and validation</a><br/>
+          <td valign="top"><a href="ajax/form.php">Form submission and validation</a><br/>
           </td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/form.php">ajax/form.php</a> </td>
         </tr>



From david_db at berlios.de  Fri Feb 10 11:51:25 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 11:51:25 +0100
Subject: [ydf-devel] r1653 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602101051.k1AApPUn010975@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 11:51:20 +0100 (Fri, 10 Feb 2006)
New Revision: 1653

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed a typo in last commit.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 10:50:37 UTC (rev 1652)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 10:51:20 UTC (rev 1653)
@@ -441,7 +441,7 @@
                 return $this->_fields->$name;
             }
             $null = null;
-            return null;
+            return $null;
         }
 
         /**



From francisco at fusemail.com  Fri Feb 10 11:55:18 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 10 Feb 2006 04:55:18 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject warnings
Message-ID:      <20652.194.38.142.34.1139568918.fusewebmail-15630@webmail.fusemail.com
     >

> Fixed in build 1651. Can you test it because I'm not getting these
warnings with my PHP version.

I cannot test it now but i will. My current php version (php 4) is
different from that one that report those warnings (PHP 5.1.2).

Francisco


From pclaerhout at berlios.de  Fri Feb 10 11:56:15 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 10 Feb 2006 11:56:15 +0100
Subject: [ydf-devel] r1654 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602101056.k1AAuFM4011493@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-10 11:56:06 +0100 (Fri, 10 Feb 2006)
New Revision: 1654

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Fixed a notice where we were using $_ENV['COMPUTERNAME'] while we should have used $_SERVER["SERVER_NAME"] instead in YDGuidUTil.

More info:
http://developer.berlios.de/bugs/?func=detailbug&bug_id=6348&group_id=3988

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-10 10:51:20 UTC (rev 1653)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-10 10:56:06 UTC (rev 1654)
@@ -958,7 +958,7 @@
          *  @returns    A new GUID as a string.
          */
         function create() {
-            return md5( uniqid( rand(), true ) . $_ENV['COMPUTERNAME'] . $_SERVER['SERVER_ADDR'] );
+            return md5( uniqid( rand(), true ) . $_SERVER['SERVER_NAME'] . $_SERVER['SERVER_ADDR'] );
         }
 
         /**
@@ -968,12 +968,6 @@
          */
         function createFormatted() {
             return YDGuidUtil::format( YDGuidUtil::create() );
-//            YDDebugUtil::dump( $g );
-//            return sprintf(
-//                '%s-%s-%s-%s-%s',
-//                substr( $g, 0, 8 ), substr( $g, 8, 4 ), substr( $g, 12, 4 ), substr( $g, 16, 4 ), substr( $g, 20 )
-//            );
-//            //substr( $g, 0, 8 ) . '-' . substr( $g, 8, 4 ) . '-' . substr( $g, 12, 4 ) . '-' . substr( $g, 16, 4 ) . '-' . substr( $g, 20 );
         }
 
         /**



From pieter at yellowduck.be  Fri Feb 10 11:56:49 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 11:56:49 +0100
Subject: [ydf-devel] YDGuiUtil example notices
In-Reply-To: <12260be20602091544u395eb9f6x6574dbca1a8cba5a@mail.gmail.com>
References: <12260be20602091544u395eb9f6x6574dbca1a8cba5a@mail.gmail.com>
Message-ID: <4aef63030602100256p137f95fbgb673940b37d6de44@mail.gmail.com>

Fixed in build 1654.

pieter

On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
>
> I'm getting this notice in the guiutil example. I think is because of the
> $_ENV['COMPUTERNAME'] variable.*
>
> Notice*: Undefined index: COMPUTERNAME in *D:\ApacheFriends\xampp\htdocs\yellow_duck\YDFramework2\YDClasses\YDUtil.php
> *on line *961
> *
> -db*
> *




--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/0b955d1d/attachment.html>

From pieter at yellowduck.be  Fri Feb 10 11:57:43 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 10 Feb 2006 11:57:43 +0100
Subject: [ydf-devel] YDDatabaseObject warnings
In-Reply-To: <20652.194.38.142.34.1139568918.fusewebmail-15630@webmail.fusemail.com>
References: <20652.194.38.142.34.1139568918.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <4aef63030602100257t55e9929dl35fc03a90dc46aeb@mail.gmail.com>

The following setting in the .htaccess file should give you the error if
it's still there:

php_value allow_call_time_pass_reference 1

Cheers,


pieter

On 2/10/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> > Fixed in build 1651. Can you test it because I'm not getting these
> warnings with my PHP version.
>
> I cannot test it now but i will. My current php version (php 4) is
> different from that one that report those warnings (PHP 5.1.2).
>
> Francisco
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/503cf246/attachment.html>

From muitocomplicado at gmail.com  Fri Feb 10 11:59:22 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 10 Feb 2006 07:59:22 -0300
Subject: [ydf-devel] YDDatabaseObject warnings
In-Reply-To: <20652.194.38.142.34.1139568918.fusewebmail-15630@webmail.fusemail.com>
References: <20652.194.38.142.34.1139568918.fusewebmail-15630@webmail.fusemail.com>
Message-ID: <12260be20602100259y7e50c697mad98718ebbf3ccf7@mail.gmail.com>

Yes, I think is a php 5 thing. I noticed in another project this kind of fix
I made in YDDatabaseObject.

You can't return by reference null or anything but a variable.

So I just created a variable $null with the value null and return it.

-db

On 2/10/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> > Fixed in build 1651. Can you test it because I'm not getting these
> warnings with my PHP version.
>
> I cannot test it now but i will. My current php version (php 4) is
> different from that one that report those warnings (PHP 5.1.2).
>
> Francisco
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/0d4f2bc9/attachment.html>

From francisco at fusemail.com  Fri Feb 10 12:08:16 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 10 Feb 2006 05:08:16 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject warnings
Message-ID:      <20739.194.38.142.34.1139569696.fusewebmail-15630@webmail.fusemail.com
     >


> Yes, I think is a php 5 thing. I noticed in another project this kind of
fix I made in YDDatabaseObject.You can't return by reference null or
anything but a variable.So I just created a variable $null with the
value null and return it.

Hi db. I have tested (on php 5.1.2) and works fine.

Francisco


From david_db at berlios.de  Fri Feb 10 12:58:08 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 12:58:08 +0100
Subject: [ydf-devel] r1655 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602101158.k1ABw88K002766@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 12:58:02 +0100 (Fri, 10 Feb 2006)
New Revision: 1655

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added YDDatabaseObject::getColumn - request #1731

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 10:56:06 UTC (rev 1654)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 11:58:02 UTC (rev 1655)
@@ -443,6 +443,34 @@
             $null = null;
             return $null;
         }
+        
+        /**
+         *  This function returns the column name of a defined field.
+         *
+         *  @param $field  The field name.
+         *  @param $alias  (optional) If true, returns the table alias 
+         *                 with the column name. Default: false.
+         *
+         *  @returns  The column name with or without the table alias.
+         */
+        function getColumn( $field, $alias=false ) {
+            
+            if ( $f =& $this->getField( $field ) ) {
+            
+                $str = '';
+                $r = '';
+            
+                if ( $alias ) {
+                    $r = $this->_query->getReserved();
+                    $str = $r . $this->getAlias() . $r . '.';
+                }
+                
+                return $str . $r . $f->getColumn() . $r;
+            
+            }
+            
+            return;
+        }
 
         /**
          *  This function returns a reference to a defined relation.
@@ -530,20 +558,16 @@
             // prepare group by
             $groups = & $this->_query->group;
             foreach ( $groups as $n => $group ) {
-                $field = $group['expr'];
-                if ( $field_obj = & $this->getField( $field ) ) {
-                    $groups[ $n ]['expr']  = $r . $alias . $r . '.';
-                    $groups[ $n ]['expr'] .= $r . $field_obj->getColumn() . $r;
+                if ( $expr = $this->getColumn( $group['expr'], true ) ) {
+                    $groups[ $n ]['expr'] = $expr;
                 }
             }
 
             // prepare order by
             $orders = & $this->_query->order;
             foreach ( $orders as $n => $order ) {
-                $field = $order['expr'];
-                if ( $field_obj = & $this->getField( $field ) ) {
-                    $orders[ $n ]['expr']  = $r . $alias . $r . '.';
-                    $orders[ $n ]['expr'] .= $r . $field_obj->getColumn() . $r;
+                if ( $expr = $this->getColumn( $order['expr'], true ) ) {
+                    $orders[ $n ]['expr'] = $expr;
                 }
             }
 
@@ -568,11 +592,13 @@
             
             foreach ( $fields as $field ) {
 
-                if ( ! $this->exists( $field->getName() ) ) {
+                $name = $field->getName();
+                
+                if ( ! $this->exists( $name ) ) {
                     continue;
                 }
 
-                $value = $this->get( $field->getName() );
+                $value = $this->get( $name );
 
                 if ( is_null( $value ) ) {
                     $value = ' IS NULL ';
@@ -596,7 +622,7 @@
                     $value = " = " . $this->_query->escapeSql( $value );
                 }
 
-                $this->where( $r . $alias . $r . '.' . $r . $field->getColumn() . $r . $value );
+                $this->where( $this->getColumn( $name, true ) . $value );
             }
             
             // Replace #. with table alias in WHERE, HAVING, SELECT, ORDER and GROUP
@@ -803,8 +829,7 @@
                         }
                         
                         if ( $columns && $this->_fields->exists( $field ) ) {
-                            $field_obj = & $this->getField( $field );
-                            $res[ $pfx . $field_obj->getColumn() ] = $value;
+                            $res[ $pfx . $this->getColumn( $field ) ] = $value;
                             unset( $res[ $pfx . $field ] );
                         }
                         
@@ -1057,11 +1082,10 @@
                     $l_key = current( $this->_getFieldsByMethod( 'isKey', true ) );
                     $l_key = $l_key->name;
                 }
-                $l_field = & $this->getField( $l_key );
-                if ( ! $l_field ) {
+                
+                if ( ! $l_column = $this->getColumn( $l_key ) ) {
                     trigger_error( 'Invalid local key "' . $l_key . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
                 }
-                $l_column = $l_field->getColumn();
 
                 // Foreign table
                 $f_var   = $rel->getForeignVar();
@@ -1083,11 +1107,9 @@
                     $f_key = $f_key->name;
                 }
                 
-                $f_field = & $this->$f_var->getField( $f_key );
-                if ( ! $f_field ) {
+                if ( ! $f_column = $this->$f_var->getColumn( $f_key ) ) {
                     trigger_error( 'Invalid foreign key "' . $f_key . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
                 }
-                $f_column = $f_field->getColumn();
                 
                 // Prepare the query in the foreign object
                 $this->$f_var->_prepareQuery( true );
@@ -1138,18 +1160,14 @@
                     }
                     
                     // Cross foreign field column name
-                    $c_ffield = & $this->$c_var->getField( $c_fkey );
-                    if ( ! $c_ffield ) {
+                    if ( ! $c_fcolumn = $this->$c_var->getColumn( $c_fkey ) ) {
                         trigger_error( 'Invalid cross foreign key "' . $c_fkey . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
                     }
-                    $c_fcolumn = $c_ffield->getColumn();
                     
                     // Cross local field column name
-                    $c_lfield = & $this->$c_var->getField( $c_lkey );
-                    if ( ! $c_lfield ) {
+                    if ( ! $c_lcolumn = $this->$c_var->getColumn( $c_lkey ) ) {
                         trigger_error( 'Invalid cross local key "' . $c_lkey . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
                     }
-                    $c_lcolumn = $c_lfield->getColumn();
 
                     // Prepare the query in the cross object
                     $this->$c_var->_prepareQuery( true );
@@ -1350,9 +1368,6 @@
             }
             
             $this->_all = true;
-            $r = $this->_query->getReserved();
-            
-            $alias = $this->getAlias();
 
             foreach ( $args as $field ) {
             
@@ -1368,8 +1383,7 @@
                 if ( $select = & $this->getSelect( $field ) ) {
                     $expr = $select->getExpression();
                 } else {
-                    $field_obj = & $this->getField( $field );
-                    $expr = $r . $alias . $r . '.' . $r . $field_obj->getColumn() . $r;
+                    $expr = $this->getColumn( $field, true );
                 }
                 $this->_query->expr( $expr, $field );
             }
@@ -1606,8 +1620,7 @@
                     if ( ! $only_fields  || ( $only_fields && $this->_fields->exists( $field ) ) ) {
                         $key = $prefix . $field;
                         if ( $columns ) {
-                            $field_obj = & $this->getField( $field );
-                            $key = $prefix . $field_obj->getColumn();
+                            $key = $prefix . $this->getColumn( $field );
                         }
                         $new[ $key ] = $value;
                     }



From david_db at berlios.de  Fri Feb 10 13:32:10 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 13:32:10 +0100
Subject: [ydf-devel] r1656 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602101232.k1ACWAUt018413@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 13:31:55 +0100 (Fri, 10 Feb 2006)
New Revision: 1656

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added comparison feature to protected fields in YDDatabaseObject - request #1732

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 11:58:02 UTC (rev 1655)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 12:31:55 UTC (rev 1656)
@@ -298,10 +298,11 @@
         /**
          *  This function registers a protected field.
          *
-         *  @param $name   The field name.
-         *  @param $value  The protected value.
+         *  @param $name       The field name.
+         *  @param $value      The protected value.
+         *  @param $comparison (optional) The comparison keyword. Accepts: = == <= < >= >
          */
-        function registerProtected( $name, $value ) {
+        function registerProtected( $name, $value, $comparison='=' ) {
             
             $name = strtolower( $name );
             
@@ -310,6 +311,7 @@
                                 The field "' . $name . '" is not defined.', YD_ERROR );
             }
             $this->_fields->$name->setProtected( $value );
+            $this->_fields->$name->setComparison( $comparison );
         }
 
         /**
@@ -389,7 +391,33 @@
             $protected = $this->_getFieldsByMethod( 'isProtected' );
 
             foreach ( $protected as $field ) {
-                $this->set( $field->getName(), $field->getProtected() );
+            
+                $compa = $field->getComparison();
+                $value = $field->getProtected();
+                $field = $field->getName();
+                
+                switch ( $compa ) {
+                    
+                    case '<':
+                    case '<=':
+                        if ( ! $this->exists( $field ) || $this->get( $field ) >= $value ) {
+                            $this->set( $field, $value );
+                        }
+                        break;
+                    case '>':
+                    case '>=':
+                        if ( ! $this->exists( $field ) || $this->get( $field ) <= $value ) {
+                            $this->set( $field, $value );
+                        }
+                        break;
+                    case '=':
+                    case '==':
+                    default:
+                        $this->set( $field, $value );
+                        break;
+                        
+                }
+            
             }
 
         }
@@ -800,7 +828,33 @@
                     $protected = $relation->_getFieldsByMethod( 'isProtected' );
 
                     foreach ( $protected as $field ) {
-                        $res[ $field->getName() ] =  $field->getProtected();
+            
+                        $compa = $field->getComparison();
+                        $value = $field->getProtected();
+                        $field = $field->getName();
+                        
+                        switch ( $compa ) {
+                            
+                            case '<':
+                            case '<=':
+                                if ( ! array_key_exists( $field, $res ) || $res[ $field ] >= $value ) {
+                                    $res[ $field ] = $value;
+                                }
+                                break;
+                            case '>':
+                            case '>=':
+                                if ( ! array_key_exists( $field, $res ) || $res[ $field ] <= $value ) {
+                                    $res[ $field ] = $value;
+                                }
+                                break;
+                            case '=':
+                            case '==':
+                            default:
+                                $res[ $field ] = $value;
+                                break;
+                                
+                        }
+            
                     }
                     
                     $pfx = '';
@@ -1896,6 +1950,7 @@
         var $protected;
         var $default;
         var $callback;
+        var $comparison;
 
         /**
          *  The class constructor.
@@ -1968,6 +2023,7 @@
 
             if ( $is ) {
                 $this->unsetDefault();
+                $this->unsetComparison();
             }
         }
 
@@ -1986,6 +2042,35 @@
         }
 
         /**
+         *  This function sets the comparison keyword.
+         *
+         *  @param $keyword  (optional) The comparison keyword. Default: =
+         */
+        function setComparison( $keyword='=' ) {
+            
+            $this->set( 'comparison', '=' );
+        
+            if ( in_array( $keyword, array( '=', '==', '<', '<=', '>', '>=' ) ) ) {
+                $this->set( 'comparison', $keyword );
+            }
+            
+        }
+        
+        /**
+         *  @returns  The comparison keyword.
+         */
+        function getComparison() {
+            return $this->get( 'comparison' );
+        }
+        
+        /**
+         *  This function unsets the comparison keyword.
+         */
+        function unsetComparison() {
+            $this->set( 'comparison', '=' );
+        }
+        
+        /**
          *  @returns  If a field has a default value defined.
          */
         function hasDefault() {



From muitocomplicado at gmail.com  Fri Feb 10 18:23:30 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 10 Feb 2006 14:23:30 -0300
Subject: [ydf-devel] Table key in update
Message-ID: <12260be20602100923o5bd58e34qedaed967054e6b3e@mail.gmail.com>

Just a question guys

There's no need to add the keys to the SET statement in an UPDATE query,
right?

For example:

$user->id = 1;
$user->name = 'David';
$user->update();

UPDATE user SET id = 1, name = 'David' WHERE id = 1

I think some databases don't even allow it.

I wanted to take the keys out from the SET statement in
YDDatabaseObject::update so the resulting query would be:

UPDATE user SET name = 'David' WHERE id = 1

What do you think?

-db
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060210/80f5dc7d/attachment.html>

From david_db at berlios.de  Fri Feb 10 18:25:38 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 18:25:38 +0100
Subject: [ydf-devel] r1657 - YDFramework2.0/trunk/examples/database_object
Message-ID: <200602101725.k1AHPci1031007@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 18:25:32 +0100 (Fri, 10 Feb 2006)
New Revision: 1657

Modified:
   YDFramework2.0/trunk/examples/database_object/index.php
   YDFramework2.0/trunk/examples/database_object/phones.tpl
Log:
Removed some unneeded code in YDDatabaseObject examples.

Modified: YDFramework2.0/trunk/examples/database_object/index.php
===================================================================
--- YDFramework2.0/trunk/examples/database_object/index.php	2006-02-10 12:31:55 UTC (rev 1656)
+++ YDFramework2.0/trunk/examples/database_object/index.php	2006-02-10 17:25:32 UTC (rev 1657)
@@ -236,9 +236,6 @@
             $user = YDDatabaseObject::getInstance( 'user' );
             $user->load( 'phone' ); // now we have a phone object in $user
             
-            $user->resetQuery(); // resets default query statements
-            $user->phone->resetQuery();
-            
             $user->select( 'id', 'name', 'country' );
             $user->phone->select( 'number', 'ord' );
 

Modified: YDFramework2.0/trunk/examples/database_object/phones.tpl
===================================================================
--- YDFramework2.0/trunk/examples/database_object/phones.tpl	2006-02-10 12:31:55 UTC (rev 1656)
+++ YDFramework2.0/trunk/examples/database_object/phones.tpl	2006-02-10 17:25:32 UTC (rev 1657)
@@ -93,9 +93,6 @@
 $user = YDDatabaseObject::getInstance( 'user' );
 $user->load( 'phone' ); // now we have a phone object in $user
 
-$user->resetQuery(); // resets default query statements
-$user->phone->resetQuery();
-
 $user->select( 'id', 'name', 'country' );
 $user->phone->select( 'number', 'ord' );
 
@@ -112,8 +109,6 @@
 
     <pre>{$find3_results}</pre>
     
-    <p>The <b>resetQuery</b> method clears all the default query elements for the following query. By default, all fields of the related objects in the search are added to the select statement, so executing a <b>resetQuery</b> will clear all of them and you can add only the fields you want to retrieve.</p>
-    
     <p>The example above only uses <b>select</b>, <b>where</b>, <b>order</b> and <b>limit</b> but there is also <b>group</b>, <b>having</b> and the possibility of adding values to the objects fields so your filters can be more complex.</p>
 
     <p>&nbsp;</p>



From david_db at berlios.de  Fri Feb 10 18:26:25 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 18:26:25 +0100
Subject: [ydf-devel] r1658 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602101726.k1AHQPS4031096@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 18:26:15 +0100 (Fri, 10 Feb 2006)
New Revision: 1658

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed the building of WHERE statements in YDDatabaseObject when executing UPDATE queries.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 17:25:32 UTC (rev 1657)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 17:26:15 UTC (rev 1658)
@@ -559,7 +559,7 @@
          *
          *  @internal
          */
-        function _prepareQuery( $only_keys=true ) {
+        function _prepareQuery( $only_keys=true, $update=false ) {
             
             $this->resetProtected();
 
@@ -614,43 +614,47 @@
                 
             }
             
-            if ( $only_keys ) {
-                $fields = $keys;
-            }
+            if ( ! $update || ( $update && $only_keys ) ) {
             
-            foreach ( $fields as $field ) {
-
-                $name = $field->getName();
+                if ( $only_keys ) {
+                    $fields = $keys;
+                }
                 
-                if ( ! $this->exists( $name ) ) {
-                    continue;
-                }
+                foreach ( $fields as $field ) {
 
-                $value = $this->get( $name );
+                    $name = $field->getName();
+                    
+                    if ( ! $this->exists( $name ) ) {
+                        continue;
+                    }
 
-                if ( is_null( $value ) ) {
-                    $value = ' IS NULL ';
-                } else if ( is_array( $value ) ) {
-                    $value_string = ' IN ( ';
-                    $first = true;
-                    foreach ( $value as $val ) {
-                        if ( ! $first ) {
-                            $value_string .= ', ';
+                    $value = $this->get( $name );
+
+                    if ( is_null( $value ) ) {
+                        $value = ' IS NULL ';
+                    } else if ( is_array( $value ) ) {
+                        $value_string = ' IN ( ';
+                        $first = true;
+                        foreach ( $value as $val ) {
+                            if ( ! $first ) {
+                                $value_string .= ', ';
+                            }
+                            if ( is_null( $val ) ) {
+                                $value_string .= 'NULL';
+                            } else {
+                                $value_string .= $this->_query->escapeSql( $val );
+                            }
+                            $first = false;
                         }
-                        if ( is_null( $val ) ) {
-                            $value_string .= 'NULL';
-                        } else {
-                            $value_string .= $this->_query->escapeSql( $val );
-                        }
-                        $first = false;
+                        $value_string .= ' )';
+                        $value = $value_string;
+                    } else {
+                        $value = " = " . $this->_query->escapeSql( $value );
                     }
-                    $value_string .= ' )';
-                    $value = $value_string;
-                } else {
-                    $value = " = " . $this->_query->escapeSql( $value );
+
+                    $this->where( $this->getColumn( $name, true ) . $value );
                 }
-
-                $this->where( $this->getColumn( $name, true ) . $value );
+                
             }
             
             // Replace #. with table alias in WHERE, HAVING, SELECT, ORDER and GROUP
@@ -1002,11 +1006,20 @@
             // before update callbacks
             $this->_executeCallbacks( 'update', true );
             
-            $this->_prepareQuery();
+            $this->_prepareQuery( true, true );
 
+            $keys   = $this->_getFieldsByMethod( 'isKey' );
             $values = $this->getValues( true, true, true );
-            $where = $this->_query->getWhere( false );
-
+            $where  = $this->_query->getWhere( false );
+            
+            // remove the keys from the values
+            if ( sizeof( $keys ) ) {
+                foreach ( $keys as $field ) {
+                    unset( $values[ $field->getName() ] );
+                }
+            }
+            
+            // return if no values to set
             if ( ! sizeof( $values ) ) {
                 return;
             }



From david_db at berlios.de  Fri Feb 10 21:03:59 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 21:03:59 +0100
Subject: [ydf-devel] r1659 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602102003.k1AK3wJ2006680@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 21:03:51 +0100 (Fri, 10 Feb 2006)
New Revision: 1659

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added small check in YDDatabaseObject::_getValues for non registered fields.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 17:26:15 UTC (rev 1658)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-10 20:03:51 UTC (rev 1659)
@@ -98,7 +98,7 @@
 
             // Setup the module
             $this->_author = 'David Bittencourt';
-            $this->_version = '4.24';
+            $this->_version = '4.25';
             $this->_copyright = '(c) 2005 David Bittencourt, muitocomplicado at hotmail.com';
             $this->_description = 'This class defines a YDDatabaseObject object.';
 
@@ -1686,7 +1686,7 @@
                 if ( $this->exists( $field ) && ! is_object( $this->$field ) && substr( $field, 0, 1 ) != '_' ) {
                     if ( ! $only_fields  || ( $only_fields && $this->_fields->exists( $field ) ) ) {
                         $key = $prefix . $field;
-                        if ( $columns ) {
+                        if ( $columns && $this->_fields->exists( $field ) ) {
                             $key = $prefix . $this->getColumn( $field );
                         }
                         $new[ $key ] = $value;



From david_db at berlios.de  Fri Feb 10 22:41:54 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 10 Feb 2006 22:41:54 +0100
Subject: [ydf-devel] r1660 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602102141.k1ALfsvP005267@sheep.berlios.de>

Author: david_db
Date: 2006-02-10 22:41:41 +0100 (Fri, 10 Feb 2006)
New Revision: 1660

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Added config YD_TEMPLATE_DIR to YDTemplate - request #1727

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-10 20:03:51 UTC (rev 1659)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-10 21:41:41 UTC (rev 1660)
@@ -36,6 +36,7 @@
 
     // Configure the default for this class
     YDConfig::set( 'YD_TEMPLATE_ENGINE', 'smarty', false );
+    YDConfig::set( 'YD_TEMPLATE_DIR', YD_SELF_DIR, false );
 
     // Use the right class implementation
     if ( strtolower( YDConfig::get( 'YD_TEMPLATE_ENGINE', 'smarty' ) == 'smarty' ) ) {
@@ -58,7 +59,7 @@
                 $this->Smarty();
 
                 // Set the default template directory
-                $this->template_dir = YD_SELF_DIR;
+                $this->template_dir = YDConfig::get( 'YD_TEMPLATE_DIR', YD_SELF_DIR );
 
                 $this->compile_dir = YD_DIR_TEMP;
                 $this->use_sub_dirs = false;
@@ -309,7 +310,7 @@
                 $this->YDBase();
 
                 // Set the default template directory
-                $this->template_dir = YD_SELF_DIR;
+                $this->template_dir = YDConfig::get( 'YD_TEMPLATE_DIR', YD_SELF_DIR );
 
                 // The variables to use
                 $this->vars = array();



From ydf at jocosoft.com  Fri Feb 10 23:44:19 2006
From: ydf at jocosoft.com (Peter)
Date: Fri, 10 Feb 2006 16:44:19 -0600
Subject: [ydf-devel] Table key in update
In-Reply-To: <12260be20602100923o5bd58e34qedaed967054e6b3e@mail.gmail.com>
References: <12260be20602100923o5bd58e34qedaed967054e6b3e@mail.gmail.com>
Message-ID: <43ED1743.8020005@jocosoft.com>

Yep, that's correct as far as I know. If it's an auto-increment (mysql) 
field, it's pretty much a read-only thing.

Peter

David Bittencourt wrote:

> Just a question guys
>
> There's no need to add the keys to the SET statement in an UPDATE 
> query, right?
>
> For example:
>
> $user->id = 1;
> $user->name = 'David';
> $user->update();
>
> UPDATE user SET id = 1, name = 'David' WHERE id = 1
>
> I think some databases don't even allow it.
>
> I wanted to take the keys out from the SET statement in 
> YDDatabaseObject::update so the resulting query would be:
>
> UPDATE user SET name = 'David' WHERE id = 1
>
> What do you think?
>
> -db



From pieter at yellowduck.be  Sat Feb 11 11:51:26 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Sat, 11 Feb 2006 11:51:26 +0100
Subject: [ydf-devel] Revision's e-mails
In-Reply-To: <4aef63030602092341r5c83f305y46ac642673633e26@mail.gmail.com>
References: <12260be20602091540s655d31eay1cbda308b800812e@mail.gmail.com>
	 <4aef63030602092341r5c83f305y46ac642673633e26@mail.gmail.com>
Message-ID: <4aef63030602110251m26f00780w7237fe62de1919dc@mail.gmail.com>

Hi David,

I had a look at it, but it doesn't seem that this can be changed.

Sorry,


pieter

On 2/10/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
> I'm not sure if that's easy to change. I'll see if I can change this.
>
> pieter
>
> On 2/10/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
> > I think the revision e-mails are too big.
> >
> > Perhaps would be better to have only the information about the changes
> log
> > and the modified files, like the information we have in the feed.
> Example:
> >
> > Revision 1648 | pclaerhout | Thu, 9 Feb 2006 12:12:59 GMT
> >
> > Added the YDGuidUtil class and also added examples for using it.
> >
> > [M] /YDFramework2.0/trunk/examples/index.tpl
> > [M] /YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
> > [A] /YDFramework2.0/trunk/examples/guidutil.php
> >
> > cheers,
> >
> > -db
>
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060211/2e650850/attachment.html>

From pclaerhout at berlios.de  Sat Feb 11 12:14:58 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sat, 11 Feb 2006 12:14:58 +0100
Subject: [ydf-devel] r1661 - YDFramework2.0/trunk/doc_src
Message-ID: <200602111114.k1BBEwTb031281@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-11 12:14:54 +0100 (Sat, 11 Feb 2006)
New Revision: 1661

Modified:
   YDFramework2.0/trunk/doc_src/changelog.xml
Log:
Updated the changelog for the release of 2.0 final.

Modified: YDFramework2.0/trunk/doc_src/changelog.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/changelog.xml	2006-02-10 21:41:41 UTC (rev 1660)
+++ YDFramework2.0/trunk/doc_src/changelog.xml	2006-02-11 11:14:54 UTC (rev 1661)
@@ -5,6 +5,70 @@
 
     <para>This is the overview of the different releases.</para>
 
+    <sect1 id="changelog_ydf_v2_0_final">
+
+        <title>Yellow Duck Framework 2.0 Final</title>
+
+        <para>Released on: 11 february 2006</para>
+        <para>Build number: 1661</para>
+
+        <itemizedlist spacing="compact">
+            <listitem>Complete code review with loads of bugfixes.</listitem>
+            <listitem>Cleaned up the user interface of the weblog application and added extra features such as cross linking.</listitem>
+            <listitem>Added the isModified method to YDForm.</listitem>
+            <listitem>Added the YDDatabaseTree class.</listitem>
+            <listitem>Added the YDFormElement_Img class.</listitem>
+            <listitem>Added the isElement method to YDForm.</listitem>
+            <listitem>The YD_FW_REVISION constant is now available in the templates.</listitem>
+            <listitem>Added YDFormElement::isForm that returns the form name of the element.</listitem>
+            <listitem>YDMysqlDump version 1.1. Support for comments and custom export.</listitem>
+            <listitem>Added optional caching to the public pages of the weblog.</listitem>
+            <listitem>Added the YD_WEBLOG_CACHE_PREFIX and YD_WEBLOG_CACHE_SUFFIX constants.</listitem>
+            <listitem>Updated Smarty to version 2.6.12.</listitem>
+            <listitem>Added YDFormElement_Date to handle all combinations of date/time/datetime selects.</listitem>
+            <listitem>Added the escape and escapeSql to YDDatabase drivers and YDDatabaseQuery drivers. The string and sqlString methods are deprecated and they will display a warning to use the new methods instead. Updated the examples and the YDWeblogAPI.</listitem>
+            <listitem>Added YDXml as a wrapper of the phpdomxml package with a few additions, like toArray and loadArray.</listitem>
+            <listitem>The YDFSImage::saveThumbnail function now returns the YDFSImage object for the thumbnail.</listitem>
+            <listitem>Added the toArray function to YDBase.</listitem>
+            <listitem>The ID attribute for form elements is now set by default to the name of the form, followed by an underscore and then followed by the name of the form element (the same as the value of the form elements name attribute in HTML).</listitem>
+            <listitem>Fixed YDRequest::redirect when under IIS.</listitem>
+            <listitem>Added YD_CRLFs to the html form renderer.</listitem>
+            <listitem>Added setTotal and showTotal to YDGraphPie addon.</listitem>
+            <listitem>Added validation rules maxlength_escape, minlength_escape and rangelength_escape.</listitem>
+            <listitem>Added XML form renderer/importer.</listitem>
+            <listitem>Added YDArrayUtil::implode.</listitem>
+            <listitem>Added YDInstaller addon.</listitem>
+            <listitem>Added a patch to HttpClient when 302 redirecting to foreign domains.</listitem>
+            <listitem>Added the YDStringUtil::startsWith and YDStringUtil::endsWith functions.</listitem>
+            <listitem>Added the $failOnError option to the YDDatabaseDriver classes.</listitem>
+            <listitem>The SQL statements that are logged now include filename and line number.</listitem>
+            <listitem>Added a query cache and the _fromNodeArray and _toNodeArray functions to YDDatabaseTree.</listitem>
+            <listitem>Removed the support for PATH_INFO variables from YDRequest::getActionName.</listitem>
+            <listitem>Added YDRecordSet::setTotalRows.</listitem>
+            <listitem>Added YDFormElement_TextAreaCounter.</listitem>
+            <listitem>Added YDConfig var YD_AUTO_EXECUTE to YDF2_process.php to make YDExecutor extensible.</listitem>
+            <listitem>Added option for persistent sorting in recordsets.</listitem>
+            <listitem>Added the checkboxgroup form element.</listitem>
+            <listitem>Added YDForm::getErrors() that returns all active error messages.</listitem>
+            <listitem>Added YDForm::getName() that returns the form name.</listitem>
+            <listitem>Added the form name to the form array.</listitem>
+            <listitem>Added constant YD_DIR_HOME_ADD that holds the path to the addons directory.</listitem>
+            <listitem>Added $success parameter to YDDatabaseObject::_executeCallbacks that indicates if the callback action was successfull (true), not successfull (false) or not executed (null). This parameter will be passed to the callbacks functions as a third parameter.</listitem>
+            <listitem>Added YDDatabaseObject::resetObject that unsets all object variables, fields and non-fields variables leaving the ones that start with underscore. YDDatabaseObject::resetValues only unset fields and select variables. Updated YDDatabaseObject::reset to call resetObject instead of resetValues.</listitem>
+            <listitem>New YDFormElement::setOption method to change an element option.</listitem>
+            <listitem>Added a very basic spam protection to the comments function in the weblog.</listitem>
+            <listitem>YDAjax v2.0.</listitem>
+            <listitem>Added the strip_html filter to YDForm.</listitem>
+            <listitem>Added the YDRequest::getQueryStringParameter and YDRequest::getQueryStringParameterAsInt functions.</listitem>
+            <listitem>Added the YDDatabaseTree::setSortField function.</listitem>
+            <listitem>Added the YDGuidUtil class.</listitem>
+            <listitem>Added YDDatabaseObject::getColumn - request #1731.</listitem>
+            <listitem>Added comparison feature to protected fields in YDDatabaseObject - request #1732.</listitem>
+            <listitem>Added config YD_TEMPLATE_DIR to YDTemplate - request #1727.</listitem>
+        </itemizedlist>
+
+    </sect1>
+
     <sect1 id="changelog_ydf_v2_0rc2">
 
         <title>Yellow Duck Framework 2.0 Release Candidate 2</title>



From pclaerhout at berlios.de  Sat Feb 11 12:19:04 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sat, 11 Feb 2006 12:19:04 +0100
Subject: [ydf-devel] r1662 - YDFramework2.0/tags
Message-ID: <200602111119.k1BBJ4eS032452@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-11 12:19:03 +0100 (Sat, 11 Feb 2006)
New Revision: 1662

Added:
   YDFramework2.0/tags/2.0.0-final/
Log:
Released 2.0.0-final.

Copied: YDFramework2.0/tags/2.0.0-final (from rev 1661, YDFramework2.0/trunk)



From pclaerhout at berlios.de  Sun Feb 12 21:43:24 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sun, 12 Feb 2006 21:43:24 +0100
Subject: [ydf-devel] r1663 - in YDFramework2.0/trunk/YDFramework2: YDClasses addons/YDDatabaseObject addons/YDDatabaseQuery addons/YDInstaller
Message-ID: <200602122043.k1CKhOBu032691@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-12 21:43:08 +0100 (Sun, 12 Feb 2006)
New Revision: 1663

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
   YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
Log:
Did some post 2.0 final cleanup:
- Fixed some docstrings
- Removed the deprecated functions
- Cleaned up some todo items from doxygen

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -888,40 +888,6 @@
          *
          *  @param $string  The string to escape.
          *
-         *  @returns     The escaped string.
-         *  
-         *  @deprecated  Will be removed in version 2.0 final. Use escape() instead.
-         */
-        function string( $string ) {
-            
-            trigger_error( 'The method YDDatabaseDriver::string is deprecated and will be removed in version 2.0 final. Use YDDatabaseDriver::escape instead.', YD_WARNING );
-            
-            return $this->escape( $string );
-        }
-
-        /**
-         *  This function will escape a string so that it's safe to include it in an SQL statement and will surround it
-         *  with the quotes appropriate for the database backend.
-         *
-         *  @param $string  The string to escape.
-         *
-         *  @returns     The escaped string surrounded by quotes.
-         *  
-         *  @deprecated  Will be removed in version 2.0 final. Use escapeSql() instead.
-         */
-        function sqlString( $string ) {
-            
-            trigger_error( 'The method YDDatabaseDriver::sqlString is deprecated and will be removed in version 2.0 final. Use YDDatabaseDriver::escapeSql instead.', YD_WARNING );
-            
-            return $this->escapeSql( $string );
-        
-        }
-
-        /**
-         *  This function will escape a string so that it's safe to include it in an SQL statement.
-         *
-         *  @param $string  The string to escape.
-         *
          *  @returns    The escaped string.
          */
         function escape( $string ) {

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -191,7 +191,9 @@
         /**
          *  Fetch the node data for the node identified by $id.
          *
-         *  @param $id  The ID of the node to fetch
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   The unique field to select on. Defaults to null, which means that the ID field specified
+         *                  when the object was instantiated will be used.
          *
          *  @returns An object containing the node's data, or false if node not found
          */

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -1391,8 +1391,8 @@
         /**
          *      Gets a specific option
          *
-         *      @param  $att    Attribute to search
-         *      @returns        The value
+         *      @param  $option    Attribute to search
+         *      @returns           The value
          */
         function getOption( $option ) {
             return isset( $this->_options[ $option ] ) ? $this->_options[ $option ] : null ;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -37,11 +37,6 @@
     /**
      *	This is the YDHttpClient class. It extends the HttpClient class and adds support for specifying the content
      *	type.
-     *
-     *	@todo
-     *		Redirects to different sites are not supported, and make retrieving of images from pbase fail. This might
-     *		result in the fact that we need to move to a different HTTP library. Another option is to rewrite the ]
-     *		library completely.
      */
     class YDHttpClient extends HttpClient {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -556,6 +556,7 @@
          *  This function prepares a query based on the object values.
          *
          *  @param $only_keys  (optional) Use only the keys for the WHERE clause. Default: true.
+         *  @param $update     (optional) Default: false.
          *
          *  @internal
          */
@@ -1203,7 +1204,7 @@
                     // Cross table
                     $c_var   = $rel->getCrossVar();
                     $c_table = $this->$c_var->getTable();
-                    
+                    
                     if ( $this->$c_var->_all == true ) {
                         $all = true;
                     }
@@ -1340,7 +1341,7 @@
                 
                 if ( $this->_count > 0 ) {
                     $this->_results = array_fill( 0, $this->_count, array() );
-                }
+                }
                 
                 $this->resetQuery();
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -999,7 +999,7 @@
             return '';
 
         }
-        
+
         /**
          *  This function will escape a string so that it's safe to include 
          *  it in an SQL statement.
@@ -1007,43 +1007,7 @@
          *  @param $string  The string to escape.
          *
          *  @returns    The escaped string.
-         *
-         *  @deprecated  Will be removed in version 2.0 final. Use escape() instead.
          */
-        function string( $string ) {
-            
-            trigger_error( 'The method YDDatabaseQueryDriver::string is deprecated and will be removed in version 2.0 final. Use YDDatabaseQueryDriver::escape instead.', YD_WARNING );
-            
-            return $this->escape( $string );
-        }
-        
-        /**
-         *  This function will escape a string so that it's safe to include it 
-         *  in an SQL statement and will surround it with the quotes appropriate 
-         *  for the database backend.
-         *
-         *  @param $string  The string to escape.
-         *
-         *  @returns    The escaped string surrounded by quotes.
-         *
-         *  @deprecated  Will be removed in version 2.0 final. Use escapeSql() instead.
-         */
-        function sqlString( $string ) {
-            
-            trigger_error( 'The method YDDatabaseQueryDriver::sqlString is deprecated and will be removed in version 2.0 final. Use YDDatabaseQueryDriver::escapeSql instead.', YD_WARNING );
-            
-            return $this->escapeSql( $string );
-        
-        }
-        
-        /**
-         *  This function will escape a string so that it's safe to include 
-         *  it in an SQL statement.
-         *
-         *  @param $string  The string to escape.
-         *
-         *  @returns    The escaped string.
-         */
         function escape( $string ) {
             if ( is_string( $string ) ) {
                 if ( strtolower( $string ) != 'null' ) {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2006-02-11 11:19:03 UTC (rev 1662)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2006-02-12 20:43:08 UTC (rev 1663)
@@ -174,7 +174,7 @@
         }
         
         /**
-         *  This function adds a <pre> container to the installer body.
+         *  This function adds a &lt;pre&gt; container to the installer body.
          *
          *  @param  $text        The text
          *  @param  $attributes  (optional) Array of attributes



From david_db at berlios.de  Mon Feb 13 01:29:46 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Mon, 13 Feb 2006 01:29:46 +0100
Subject: [ydf-devel] r1664 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602130029.k1D0TkwO001361@sheep.berlios.de>

Author: david_db
Date: 2006-02-13 01:29:06 +0100 (Mon, 13 Feb 2006)
New Revision: 1664

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added a few helpful functions to YDDatabaseObject_Relation: getForeignInstance, getCrossInstance, getForeignAlias, getCrossAlias, getForeignField, getCrossField, getForeignColumn and getCrossColumn.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-12 20:43:08 UTC (rev 1663)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-13 00:29:06 UTC (rev 1664)
@@ -2345,6 +2345,64 @@
         }
         
         /**
+         *  @returns  The foreign table alias name.
+         */
+        function getForeignAlias() {
+            
+            if ( ! isset( $this->foreign_obj ) ) {
+                $this->foreign_obj = YDDatabaseObject::getInstance( $this->getForeignClass() );
+            }
+            return $this->foreign_obj->getAlias();
+        
+        }
+        
+        /**
+         *  @returns  A reference to the foreign class instance.
+         */
+        function & getForeignInstance() {
+            
+            if ( ! isset( $this->foreign_obj ) ) {
+                $this->foreign_obj = YDDatabaseObject::getInstance( $this->getForeignClass() );
+            }
+            return $this->foreign_obj;
+        
+        }
+        
+        /**
+         *  This function returns a reference to a foreign field object.
+         *
+         *  @param  $field  The field name.
+         *
+         *  @returns  A reference a the foreign field.
+         */
+        function & getForeignField( $field ) {
+            
+            if ( ! isset( $this->foreign_obj ) ) {
+                $this->foreign_obj = YDDatabaseObject::getInstance( $this->getForeignClass() );
+            }
+            return $this->foreign_obj->getField( $field );
+        
+        }
+        
+        /**
+         *  This function returns the column name of a defined field.
+         *
+         *  @param $field  The field name.
+         *  @param $alias  (optional) If true, returns the table alias 
+         *                 with the column name. Default: false.
+         *
+         *  @returns  The column name with or without the table alias.
+         */
+        function getForeignColumn( $field, $alias=false ) {
+            
+            if ( ! isset( $this->foreign_obj ) ) {
+                $this->foreign_obj = YDDatabaseObject::getInstance( $this->getForeignClass() );
+            }
+            return $this->foreign_obj->getColumn( $field, $alias );
+        
+        }
+        
+        /**
          *  This function set the foreign field name.
          *
          *  @param $name  The field name.
@@ -2448,8 +2506,66 @@
             return $this->cross_obj->getTable();
         
         }
+        
+        /**
+         *  @returns  The cross table alias name.
+         */
+        function getCrossAlias() {
+            
+            if ( ! isset( $this->cross_obj ) ) {
+                $this->cross_obj = YDDatabaseObject::getInstance( $this->getCrossClass() );
+            }
+            return $this->cross_obj->getAlias();
+        
+        }
+        
+        /**
+         *  @returns  A reference to the cross class instance.
+         */
+        function & getCrossInstance() {
+            
+            if ( ! isset( $this->cross_obj ) ) {
+                $this->cross_obj = YDDatabaseObject::getInstance( $this->getCrossClass() );
+            }
+            return $this->cross_obj;
+        
+        }
 
         /**
+         *  This function returns a reference to a cross field object.
+         *
+         *  @param  $field  The field name.
+         *
+         *  @returns  A reference a the cross field.
+         */
+        function & getCrossField( $field ) {
+            
+            if ( ! isset( $this->cross_obj ) ) {
+                $this->cross_obj = YDDatabaseObject::getInstance( $this->getCrossClass() );
+            }
+            return $this->cross_obj->getField( $field );
+        
+        }
+        
+        /**
+         *  This function returns the column name of a defined field.
+         *
+         *  @param $field  The field name.
+         *  @param $alias  (optional) If true, returns the table alias 
+         *                 with the column name. Default: false.
+         *
+         *  @returns  The column name with or without the table alias.
+         */
+        function getCrossColumn( $field, $alias=false ) {
+            
+            if ( ! isset( $this->cross_obj ) ) {
+                $this->cross_obj = YDDatabaseObject::getInstance( $this->getCrossClass() );
+            }
+            return $this->cross_obj->getColumn( $field, $alias );
+        
+        }
+        
+        /**
          *  This function set the cross local key.
          *
          *  @param $name  The field name.



From david_db at berlios.de  Mon Feb 13 01:36:05 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Mon, 13 Feb 2006 01:36:05 +0100
Subject: [ydf-devel] r1665 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602130036.k1D0a5Ir004399@sheep.berlios.de>

Author: david_db
Date: 2006-02-13 01:35:45 +0100 (Mon, 13 Feb 2006)
New Revision: 1665

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed YDDatabaseObject_Relation::getForeignAlias and getCrossAlias.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-13 00:29:06 UTC (rev 1664)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-13 00:35:45 UTC (rev 1665)
@@ -2348,11 +2348,7 @@
          *  @returns  The foreign table alias name.
          */
         function getForeignAlias() {
-            
-            if ( ! isset( $this->foreign_obj ) ) {
-                $this->foreign_obj = YDDatabaseObject::getInstance( $this->getForeignClass() );
-            }
-            return $this->foreign_obj->getAlias();
+            return $this->getForeignVar();
         
         }
         
@@ -2511,11 +2507,7 @@
          *  @returns  The cross table alias name.
          */
         function getCrossAlias() {
-            
-            if ( ! isset( $this->cross_obj ) ) {
-                $this->cross_obj = YDDatabaseObject::getInstance( $this->getCrossClass() );
-            }
-            return $this->cross_obj->getAlias();
+            return $this->getCrossVar();
         
         }
         



From maximus_meridius79 at yahoo.com  Mon Feb 13 13:39:45 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 13 Feb 2006 04:39:45 -0800 (PST)
Subject: [ydf-devel] Remove session_start from YDF2_init() ?
Message-ID: <20060213123945.89936.qmail@web53809.mail.yahoo.com>

Hi,

I have been working on setting up the session
management for an 
application I am building.

YDF2 currently has the call to "session_start()" in
YDF2_init.php

To provide for more flexibility in configuring the
session and php 
settings, it would make sense for this call to be made
within 
YDrequest.php or YDF2_process.php .

The svn trunk of YDF2_process.php contains the
following code:

    if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
true ) {
   
        // Instantiate the executor class
        $clsInst = new YDExecutor( YD_SELF_FILE );

        // Execute the execute function
        $clsInst->execute();

    }

If session_start was removed from YDF2_init.php,
session_start() could 
be called just before the class is executed:

    if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
true ) {
   
        // Instantiate the executor class
        $clsInst = new YDExecutor( YD_SELF_FILE );


        @session_start();

        // Execute the execute function
        $clsInst->execute();

    }

This would then allow custome php configuration to be
defined before the 
session is started by placing it in the main script
file, e.g:

    // custom php config and session setup goes here
       .
       .
   
    class index extends YDRequest() {
       .
       .
    }

    // Process the request
    YDInclude( 'YDF2_process.php' );


This of course could otherwise be achieved by
providing the custom 
config before YDF2_init.php is included, but then what
happens if Has 
anyone else been working with sessions or you want to
use some of the 
nice YDF2 utility clasess such as YDConfig and YDUrl ?

Did you find that session_start is called too early?
Is so did you just 
comment it out?

Regards,

Graeme

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 


From maximus_meridius79 at yahoo.com  Mon Feb 13 13:39:32 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 13 Feb 2006 04:39:32 -0800 (PST)
Subject: [ydf-devel] Remove session_start from YDF2_init() ?
Message-ID: <20060213123932.90875.qmail@web53803.mail.yahoo.com>

    Hi,

I have been working on setting up the session management for anapplication I am building.

YDF2 currently has the call to "session_start()" in YDF2_init.php

To provide for more flexibility in configuring the session and phpsettings, it would make sense for this call to be made withinYDrequest.php or YDF2_process.php .

The svn trunk of YDF2_process.php contains the following code:

    if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) == true ) { 
    
        // Instantiate the executor class
        $clsInst = new YDExecutor( YD_SELF_FILE );

        // Execute the execute function
        $clsInst->execute();

    }

If session_start was removed from YDF2_init.php, session_start() couldbe called just before the class is executed:

    if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) == true ) { 
    
        // Instantiate the executor class
        $clsInst = new YDExecutor( YD_SELF_FILE );


        @session_start();

        // Execute the execute function
        $clsInst->execute();

    }

This would then allow custome php configuration to be defined beforethe session is started by placing it in the main script file, e.g:

    // custom php config and session setup goes here
       .
       .
    
    class index extends YDRequest() {
       .
       .
    }

    // Process the request
    YDInclude( 'YDF2_process.php' );


This of course could otherwise be achieved by providing the customconfig before YDF2_init.php is included, but then what happens if Hasanyone else been working with sessions or you want to use some of thenice YDF2 utility clasess such as YDConfig and YDUrl ?

Did you find that session_start is called too early? Is so did you justcomment it out?

Regards,

Graeme
--------------050807080809000305000008--
		
---------------------------------
 
 What are the most popular cars? Find out at Yahoo! Autos 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060213/0c9950de/attachment.html>

From pclaerhout at berlios.de  Mon Feb 13 20:21:19 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 13 Feb 2006 20:21:19 +0100
Subject: [ydf-devel] r1666 - in YDFramework2.0/trunk/examples/weblog: . include include/dbupdates include/languages manage skins/default
Message-ID: <200602131921.k1DJLJ56000102@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-13 20:20:32 +0100 (Mon, 13 Feb 2006)
New Revision: 1666

Added:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/install.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Added the option to automatically disallow comments on items after a number of days.

Feature request 1754.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -88,6 +88,18 @@
                 $this->db->executeSql( 'ALTER TABLE #_users ADD UNIQUE name (name)' );
             }
 
+            // Auto close the old items if needed
+            $auto_close_items = YDConfig::get( 'auto_close_items', '' );
+            if ( $auto_close_items != '' && is_numeric( $auto_close_items ) ) {
+
+                // Calculate the treshold
+                $treshold = time() - ( $auto_close_items * 86400 );
+
+                // Close the items
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE created < ' . $treshold );
+
+            }
+
         }
 
         // Function to log a request to the statistics
@@ -224,6 +236,7 @@
         // Function to get the items of the weblog
         function getItems( $limit=-1, $offset=-1, $order='created desc, title', $where='' ) {
             $sql = 'SELECT i.id, i.category_id, i.title, i.body, i.body_more, i.num_comments, i.created, i.modified, '
+                 . 'i.allow_comments, '
                  . 'c.title as category, u.email as user_email, u.name as user_name FROM #_items i, #_categories c, '
                  . '#_users u WHERE i.category_id = c.id AND i.user_id = u.id ';
             $sql = $this->_prepareQuery( $sql . $where, $order );

Added: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -0,0 +1,29 @@
+<?php
+
+    // Class definition
+    class UPD_001_AllowComments.php {
+
+        // Class constructor
+        function UPD_001_AllowComments.php( $db ) {
+
+            // Publish the database
+            $this->db = $db;
+
+        }
+
+        // Install the update
+        function update() {
+
+            // The SQL to add the `allow_comments` field to the database
+            $sql = 'ALTER TABLE `' . YDConfig::get( 'db_prefix', '' ) . 'items` ADD `allow_comments` TINYINT(1)  DEFAULT "1" NOT NULL AFTER `num_comments`';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the `allow_comments` field to the database
+            $sql = 'ALTER TABLE `' . YDConfig::get( 'db_prefix', '' ) . 'items` ADD INDEX allow_comments (allow_comments)';
+            $this->db->executeSql( $sql );
+
+        }
+
+    }
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -87,6 +87,7 @@
 $GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
 $GLOBALS['t']['err_comment'] = 'Comment is required';
 $GLOBALS['t']['with'] = 'for';
+$GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'New comment';
@@ -265,6 +266,9 @@
 $GLOBALS['t']['cfg_cache'] = 'Caching';
 $GLOBALS['t']['cfg_use_cache_comment'] = 'Cache public pages';
 $GLOBALS['t']['cfg_friendly_urls'] = 'Friendly URLs';
+$GLOBALS['t']['cfg_spam_protection'] = 'Spam protection';
+$GLOBALS['t']['cfg_auto_close_items'] = 'Do not allow comment after x days';
+$GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';
@@ -277,6 +281,7 @@
 $GLOBALS['t']['err_item_title'] = 'Item title is required';
 $GLOBALS['t']['err_item_body'] = 'Item body is required';
 $GLOBALS['t']['gallery'] = 'Photos';
+$GLOBALS['t']['allow_comments'] = 'Allow comments';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'No images yet';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -87,6 +87,7 @@
 $GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
 $GLOBALS['t']['with'] = 'bij';
+$GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'Nieuw commentaar';
@@ -265,6 +266,9 @@
 $GLOBALS['t']['cfg_cache'] = 'Caching';
 $GLOBALS['t']['cfg_use_cache_comment'] = 'Cache publieke pagina\'s';
 $GLOBALS['t']['cfg_friendly_urls'] = 'Vriendelijke URLs';
+$GLOBALS['t']['cfg_spam_protection'] = 'Beveiliging tegen spam';
+$GLOBALS['t']['cfg_auto_close_items'] = 'Laat geen commentaren toe na x dagen';
+$GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';
@@ -277,6 +281,7 @@
 $GLOBALS['t']['err_item_title'] = 'Item titel is vereist';
 $GLOBALS['t']['err_item_body'] = 'Item inhoud is vereist';
 $GLOBALS['t']['gallery'] = 'Foto\'s';
+$GLOBALS['t']['allow_comments'] = 'Laat commentaren toe';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';

Modified: YDFramework2.0/trunk/examples/weblog/install.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/install.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/install.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -147,11 +147,13 @@
                       body longtext NOT NULL,
                       body_more longtext NOT NULL,
                       num_comments int(11) NOT NULL default \'0\',
+                      allow_comments tinyint(1) NOT NULL default \'1\',
                       created int(11) default NULL,
                       modified int(11) default NULL,
                       PRIMARY KEY  (id),
                       KEY category_id (category_id),
-                      KEY user_id (user_id)
+                      KEY user_id (user_id),
+                      KEY allow_comments(allow_comments)
                     ) TYPE=MyISAM;'
                 );
                 $db->executeSql( 'DROP TABLE IF EXISTS ' . $values['db_prefix'] . 'links;' );

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -40,103 +40,108 @@
             $this->tpl->assign( 'item', $item );
             $this->tpl->assign( 'comments', $comments );
 
-            // Create the comments form
-            $form = new YDWeblogForm(
-                'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
-            );
+            // Only if comments are allowed
+            if ( $item['allow_comments'] == '1' ) {
 
-            // Add the fields
-            $form->addElement( 'text', 'username', t( 'name' ) );
-            $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
-            $form->addElement( 'text', 'userwebsite', t( 'website' ) );
-            $form->addElement( 'wlbbtextarea', 'comment', '', array( 'style' => 'width: 450px' ) );
-            $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ), array( 'id' => 'submit' ) );
-            $form->addElement( 'hidden', 'item_id' );
+                // Create the comments form
+                $form = new YDWeblogForm(
+                    'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
+                );
 
-            // Set the defaults
-            $defaults = array();
-            $defaults['item_id']     = $id;
-            $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
-            $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
-            $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
-            $form->setDefaults( $defaults );
+                // Add the fields
+                $form->addElement( 'text', 'username', t( 'name' ) );
+                $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
+                $form->addElement( 'text', 'userwebsite', t( 'website' ) );
+                $form->addElement( 'wlbbtextarea', 'comment', '', array( 'style' => 'width: 450px' ) );
+                $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ), array( 'id' => 'submit' ) );
+                $form->addElement( 'hidden', 'item_id' );
 
-            // Set the rules
-            $form->addRule( 'username',    'required',  t( 'err_name' ) );
-            $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
-            $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
-            $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
-            $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
-            $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
+                // Set the defaults
+                $defaults = array();
+                $defaults['item_id']     = $id;
+                $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
+                $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
+                $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
+                $form->setDefaults( $defaults );
 
-            // Add the filters
-            $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
+                // Set the rules
+                $form->addRule( 'username',    'required',  t( 'err_name' ) );
+                $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
+                $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
+                $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
+                $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
+                $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
-            // Process the form
-            if ( $form->validate() === true ) {
+                // Add the filters
+                $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
 
-                // Get the form values
-                $values = $form->getValues();
+                // Process the form
+                if ( $form->validate() === true ) {
 
-                // Simple spam protection
-                if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) === false ) {
-                    $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
-                }
+                    // Get the form values
+                    $values = $form->getValues();
 
-                // Fix any faulty web addresses
-                if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
-                    $values['userwebsite'] = 'http://' . $values['userwebsite'];
-                }
+                    // Simple spam protection
+                    if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) === false ) {
+                        $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+                    }
 
-                // Save the username, useremail and userwebsite
-                setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
-                setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
-                setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
+                    // Fix any faulty web addresses
+                    if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
+                        $values['userwebsite'] = 'http://' . $values['userwebsite'];
+                    }
 
-                // Add the values to the database
-                $comment_id = $this->weblog->addComment( $values );
+                    // Save the username, useremail and userwebsite
+                    setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
+                    setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
+                    setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
 
-                // Send an email if configured
-                if ( YDConfig::get( 'email_new_comment', true ) ) {
+                    // Add the values to the database
+                    $comment_id = $this->weblog->addComment( $values );
 
-                    // Include the YDEmail library
-                    YDInclude( 'YDEmail.php' );
+                    // Send an email if configured
+                    if ( YDConfig::get( 'email_new_comment', true ) ) {
 
-                    // Get the list of subscriptions
-                    $subscribers = $this->weblog->getCommentSubscribers( $id );
+                        // Include the YDEmail library
+                        YDInclude( 'YDEmail.php' );
 
-                    // Add the comment to the email template
-                    $this->tpl->assign( 'eml_comment', $values );
+                        // Get the list of subscriptions
+                        $subscribers = $this->weblog->getCommentSubscribers( $id );
 
-                    // Create the email and send it
-                    $eml = new YDEmail();
-                    if ( ! empty( $item['user_email'] ) ) {
-                        $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
-                    } else {
-                        $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                        // Add the comment to the email template
+                        $this->tpl->assign( 'eml_comment', $values );
+
+                        // Create the email and send it
+                        $eml = new YDEmail();
+                        if ( ! empty( $item['user_email'] ) ) {
+                            $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                        } else {
+                            $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                        }
+                        $eml->setReplyTo( 'no at reply.net' );
+                        $eml->addBcc( $item['user_email'] );
+                        foreach ( $subscribers as $subscriber ) {
+                            $eml->addBcc( $subscriber );
+                        }
+                        $eml->setSubject( 'New comment: ' . strip_tags( $item['title'] ) );
+                        $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
+                        $eml->send();
+
                     }
-                    $eml->setReplyTo( 'no at reply.net' );
-                    $eml->addBcc( $item['user_email'] );
-                    foreach ( $subscribers as $subscriber ) {
-                        $eml->addBcc( $subscriber );
-                    }
-                    $eml->setSubject( 'New comment: ' . strip_tags( $item['title'] ) );
-                    $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
-                    $eml->send();
 
+                    // Clear the cache
+                    $this->clearCache();
+
+                    // Redirect to the item
+                    $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+
                 }
 
-                // Clear the cache
-                $this->clearCache();
+                // Add the form to the template
+                $this->tpl->assignForm( 'comments_form', $form );
 
-                // Redirect to the item
-                $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
-
             }
 
-            // Add the form to the template
-            $this->tpl->assignForm( 'comments_form', $form );
-
             // Display the template
             $this->display();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -244,6 +244,7 @@
             // Initialize the parent
             $this->YDWeblogAdminRequest();
 
+            // The default action
             if ( $this->getActionName() != 'default' ) {
 
                 // Show as plain text

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -82,6 +82,8 @@
 
             $form->addElement( 'checkbox', 'friendly_urls', t( 'cfg_friendly_urls' ), array( 'style' => 'border: none;' ) );
 
+            $form->addElement( 'text', 'auto_close_items', t( 'cfg_auto_close_items' ), array( 'class' => 'tfM' ) );
+
             $form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 
             // Set the defaults
@@ -96,6 +98,7 @@
             $form->addRule( 'weblog_entries_fp', 'numeric', t( 'err_weblog_entries_fp_num' ) );
             $form->addRule( 'max_syndicated_items', 'required', t( 'err_max_syndicated_items' ) );
             $form->addRule( 'max_syndicated_items', 'numeric', t( 'err_max_syndicated_items_num' ) );
+            $form->addRule( 'auto_close_items', 'numeric', t( 'err_auto_close_items' ) );
 
             // Add the filters
             $form->addFilters( 
@@ -146,6 +149,7 @@
             $config['max_syndicated_items'] = YDConfig::get( 'max_syndicated_items', 20 );
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );
+            $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     30 );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-13 19:20:32 UTC (rev 1666)
@@ -103,6 +103,16 @@
             <td class="adminRowL" width="400">{$config.max_syndicated_items}</td>
         </tr>
     </table>
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+        <tr><td colspan="3">&nbsp;</td></tr>
+        <tr>
+            <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="cfg_auto_close_items"}</td>
+            <td class="adminRowL" width="400">{$config.auto_close_items}</td>
+        </tr>
+    </table>
     <p><input type="button" class="button" onClick="window.location='{$YD_SELF_SCRIPT}?do=edit';" value="{t w="change_config"}" />
 {/if}
 
@@ -195,6 +205,16 @@
                 <td class="adminRowL" width="400">{$form.max_syndicated_items.html}</td>
             </tr>
         </table>
+        <table width="700" cellspacing="0" cellpadding="0" border="0">
+            <tr><td colspan="3">&nbsp;</td></tr>
+            <tr>
+                <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{$form.auto_close_items.label_html}</td>
+                <td class="adminRowL" width="400">{$form.auto_close_items.html}</td>
+            </tr>
+        </table>
         <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-13 19:20:32 UTC (rev 1666)
@@ -42,12 +42,13 @@
 
             // Create the edit form
             $form = new YDWeblogForm( 'itemForm', 'POST', YD_SELF_SCRIPT . '?do=edit' );
-            $form->addElement( 'text',            'title',       t('item_title'),       array( 'class' => 'tfM' ) );
-            $form->addElement( 'wladmintextarea', 'body',        t('item_body'),        array( 'class' => 'tfM' ) );
-            $form->addElement( 'wladmintextarea', 'body_more',   t('item_body_more'),   array( 'class' => 'tfM' ) );
-            $form->addElement( 'select',          'category_id', t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
-            $form->addElement( 'datetimeselect',  'created',     t('created_on'),       array( 'class' => 'tfM' ) );
-            $form->addElement( 'datetimeselect',  'modified',    t('last_modified_on'), array( 'class' => 'tfM' ) );
+            $form->addElement( 'text',            'title',          t('item_title'),       array( 'class' => 'tfM' ) );
+            $form->addElement( 'wladmintextarea', 'body',           t('item_body'),        array( 'class' => 'tfM' ) );
+            $form->addElement( 'wladmintextarea', 'body_more',      t('item_body_more'),   array( 'class' => 'tfM' ) );
+            $form->addElement( 'select',          'category_id',    t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
+            $form->addElement( 'datetimeselect',  'created',        t('created_on'),       array( 'class' => 'tfM' ) );
+            $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );
+            $form->addElement( 'checkbox',        'allow_comments', t( 'allow_comments' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
             $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),               array( 'class' => 'button' ) );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-13 19:20:32 UTC (rev 1666)
@@ -151,6 +151,10 @@
                 <td class="adminRowL">{$form.modified.label_html}</td> 
                 <td class="adminRowL">{$form.modified.html}</td> 
             </tr>
+            <tr> 
+                <td class="adminRowL">{$form.allow_comments.label_html}</td> 
+                <td class="adminRowL">{$form.allow_comments.html}</td> 
+            </tr>
             <tr>
                 <td class="adminRowL" colspan="2" style="border: 0px;">{$form._cmdSubmit.html}</td>
             </tr>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-13 00:35:45 UTC (rev 1665)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-13 19:20:32 UTC (rev 1666)
@@ -108,29 +108,37 @@
     <a name="respond"></a>
     <h3 id="respond">{t w="leave_comment"}</h3>
 
-    {$comments_form.tag}
+    {if $comments_form}
 
-        {if $comments_form.errors_unique_messages}
-            <p class="postmetadata alt" style="color: red; text-align: left;">
-                <b>{t w="error_comment"}<br/></b>
-                {foreach from=$comments_form.errors_unique_messages item="error"}
-                    {$error}<br/>
-                {/foreach}
-            </p>
-        {/if}
+        {$comments_form.tag}
 
-        {$comments_form.item_id.html}
+            {if $comments_form.errors_unique_messages}
+                <p class="postmetadata alt" style="color: red; text-align: left;">
+                    <b>{t w="error_comment"}<br/></b>
+                    {foreach from=$comments_form.errors_unique_messages item="error"}
+                        {$error}<br/>
+                    {/foreach}
+                </p>
+            {/if}
 
-        <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
-        <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
-        <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
+            {$comments_form.item_id.html}
 
-        <p>{$comments_form.comment.html}</p>
+            <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
+            <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
+            <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
 
-        <p>{$comments_form.cmdSubmit.html}</p>
+            <p>{$comments_form.comment.html}</p>
 
-    {$comments_form.endtag}
+            <p>{$comments_form.cmdSubmit.html}</p>
 
+        {$comments_form.endtag}
+
+    {else}
+
+        <p>{t w="item_closed"}</p>
+
+    {/if}
+
 </div>
 
 {include file="__std_sidebar.tpl"}



From david_db at berlios.de  Tue Feb 14 02:52:01 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Tue, 14 Feb 2006 02:52:01 +0100
Subject: [ydf-devel] r1667 - in YDFramework2.0/trunk: YDFramework2/addons/YDDatabaseObject examples/database_object/includes
Message-ID: <200602140152.k1E1q1Wg013358@sheep.berlios.de>

Author: david_db
Date: 2006-02-14 02:51:46 +0100 (Tue, 14 Feb 2006)
New Revision: 1667

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/examples/database_object/includes/user.php
Log:
Fixed protected fields comparisons in YDDatabaseObject and added the "not equal" comparison. Also removed YDDatabaseObject_Field::getDefault, hasDefault, setDefault as they were not being used.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-13 19:20:32 UTC (rev 1666)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-14 01:51:46 UTC (rev 1667)
@@ -98,7 +98,7 @@
 
             // Setup the module
             $this->_author = 'David Bittencourt';
-            $this->_version = '4.25';
+            $this->_version = '4.26';
             $this->_copyright = '(c) 2005 David Bittencourt, muitocomplicado at hotmail.com';
             $this->_description = 'This class defines a YDDatabaseObject object.';
 
@@ -300,7 +300,7 @@
          *
          *  @param $name       The field name.
          *  @param $value      The protected value.
-         *  @param $comparison (optional) The comparison keyword. Accepts: = == <= < >= >
+         *  @param $comparison (optional) The comparison keyword. Accepts: = == <= < >= > != <>
          */
         function registerProtected( $name, $value, $comparison='=' ) {
             
@@ -392,28 +392,43 @@
 
             foreach ( $protected as $field ) {
             
-                $compa = $field->getComparison();
-                $value = $field->getProtected();
+                $p_compar = $field->getComparison();
+                $p_value  = $field->getProtected();
+                
                 $field = $field->getName();
                 
-                switch ( $compa ) {
+                switch ( $p_compar ) {
                     
                     case '<':
+                        if ( $this->get( $field ) >= $p_value ) {
+                            unset( $this->$field );
+                        }
+                        break;
                     case '<=':
-                        if ( ! $this->exists( $field ) || $this->get( $field ) >= $value ) {
-                            $this->set( $field, $value );
+                        if ( $this->get( $field ) > $p_value ) {
+                            unset( $this->$field );
                         }
                         break;
                     case '>':
+                        if ( $this->get( $field ) <= $p_value ) {
+                            unset( $this->$field );
+                        }
+                        break;
                     case '>=':
-                        if ( ! $this->exists( $field ) || $this->get( $field ) <= $value ) {
-                            $this->set( $field, $value );
+                        if ( $this->get( $field ) < $p_value ) {
+                            unset( $this->$field );
                         }
                         break;
+                    case '<>':
+                    case '!=':
+                        if ( $this->get( $field ) == $p_value ) {
+                            unset( $this->$field );
+                        }
+                        break;
                     case '=':
                     case '==':
                     default:
-                        $this->set( $field, $value );
+                        $this->set( $field, $p_value );
                         break;
                         
                 }
@@ -421,22 +436,8 @@
             }
 
         }
-
+        
         /**
-         *  This function resets all default values in the object.
-         */
-        function resetDefaults() {
-
-            $defaults = $this->_getFieldsByMethod( 'hasDefault' );
-
-            foreach ( $defaults as $field ) {
-                $this->set( $field->getName(), $field->getDefault() );
-            }
-
-        }
-
-
-        /**
          *  @returns  The table name of the class.
          */
         function getTable() {
@@ -834,28 +835,43 @@
 
                     foreach ( $protected as $field ) {
             
-                        $compa = $field->getComparison();
-                        $value = $field->getProtected();
+                        $p_compar = $field->getComparison();
+                        $p_value  = $field->getProtected();
+                        
                         $field = $field->getName();
                         
-                        switch ( $compa ) {
+                        switch ( $p_compar ) {
                             
                             case '<':
+                                if ( $this->get( $field ) >= $p_value ) {
+                                    unset( $this->$field );
+                                }
+                                break;
                             case '<=':
-                                if ( ! array_key_exists( $field, $res ) || $res[ $field ] >= $value ) {
-                                    $res[ $field ] = $value;
+                                if ( $this->get( $field ) > $p_value ) {
+                                    unset( $this->$field );
                                 }
                                 break;
                             case '>':
+                                if ( $this->get( $field ) <= $p_value ) {
+                                    unset( $this->$field );
+                                }
+                                break;
                             case '>=':
-                                if ( ! array_key_exists( $field, $res ) || $res[ $field ] <= $value ) {
-                                    $res[ $field ] = $value;
+                                if ( $this->get( $field ) < $p_value ) {
+                                    unset( $this->$field );
                                 }
                                 break;
+                            case '<>':
+                            case '!=':
+                                if ( $this->get( $field ) == $p_value ) {
+                                    unset( $this->$field );
+                                }
+                                break;
                             case '=':
                             case '==':
                             default:
-                                $res[ $field ] = $value;
+                                $this->set( $field, $p_value );
                                 break;
                                 
                         }
@@ -1962,7 +1978,7 @@
         var $auto;
         var $key;
         var $protected;
-        var $default;
+        var $value;
         var $callback;
         var $comparison;
 
@@ -2024,8 +2040,8 @@
          *  @param $value     The protected value.
          */
         function setProtected( $value ) {
-            $this->setDefault( $value );
             $this->set( 'protected', true );
+            $this->set( 'value', $value );
         }
 
         /**
@@ -2036,8 +2052,8 @@
             $this->set( 'protected', false );
 
             if ( $is ) {
-                $this->unsetDefault();
-                $this->unsetComparison();
+                unset( $this->value );
+                unset( $this->comparison );
             }
         }
 
@@ -2052,7 +2068,7 @@
          *  @returns  The protected value.
          */
         function getProtected() {
-            return $this->getDefault();
+            return $this->get( 'value' );
         }
 
         /**
@@ -2061,13 +2077,7 @@
          *  @param $keyword  (optional) The comparison keyword. Default: =
          */
         function setComparison( $keyword='=' ) {
-            
-            $this->set( 'comparison', '=' );
-        
-            if ( in_array( $keyword, array( '=', '==', '<', '<=', '>', '>=' ) ) ) {
-                $this->set( 'comparison', $keyword );
-            }
-            
+            $this->set( 'comparison', $keyword );
         }
         
         /**
@@ -2083,42 +2093,8 @@
         function unsetComparison() {
             $this->set( 'comparison', '=' );
         }
-        
-        /**
-         *  @returns  If a field has a default value defined.
-         */
-        function hasDefault() {
-            return $this->exists( 'default', true );
-        }
 
         /**
-         *  This function sets the default value to the field.
-         *
-         *  @param $value     The default value.
-         */
-        function setDefault( $value ) {
-            if ( ! $this->isProtected() ) {
-                $this->set( 'default', $value );
-            }
-        }
-
-        /**
-         *  This function unsets the default value of a field.
-         */
-        function unsetDefault() {
-            if ( ! $this->isProtected() ) {
-                unset( $this->default );
-            }
-        }
-
-        /**
-         *  @returns  The field default value.
-         */
-        function getDefault() {
-            return $this->get( 'default' );
-        }
-
-        /**
          *  This function sets the field as primary key.
          */
         function setKey() {

Modified: YDFramework2.0/trunk/examples/database_object/includes/user.php
===================================================================
--- YDFramework2.0/trunk/examples/database_object/includes/user.php	2006-02-13 19:20:32 UTC (rev 1666)
+++ YDFramework2.0/trunk/examples/database_object/includes/user.php	2006-02-14 01:51:46 UTC (rev 1667)
@@ -13,7 +13,6 @@
             $this->registerKey( 'id', true );
 
             $name = & $this->registerField( 'name' );
-            $name->setDefault( 'John Doe' );
             
             $this->registerField( 'email' );
             $this->registerField( 'country' );



From david_db at berlios.de  Tue Feb 14 03:26:34 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Tue, 14 Feb 2006 03:26:34 +0100
Subject: [ydf-devel] r1668 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602140226.k1E2QYSh020576@sheep.berlios.de>

Author: david_db
Date: 2006-02-14 03:26:08 +0100 (Tue, 14 Feb 2006)
New Revision: 1668

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed the protected fields comparison in YDDatabaseObject::getResults.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-14 01:51:46 UTC (rev 1667)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-14 02:26:08 UTC (rev 1668)
@@ -843,35 +843,35 @@
                         switch ( $p_compar ) {
                             
                             case '<':
-                                if ( $this->get( $field ) >= $p_value ) {
-                                    unset( $this->$field );
+                                if ( array_key_exists( $field, $res ) && $res[ $field ] >= $p_value ) {
+                                    unset( $res[ $field ] );
                                 }
                                 break;
                             case '<=':
-                                if ( $this->get( $field ) > $p_value ) {
-                                    unset( $this->$field );
+                                if ( array_key_exists( $field, $res ) && $res[ $field ] > $p_value ) {
+                                    unset( $res[ $field ] );
                                 }
                                 break;
                             case '>':
-                                if ( $this->get( $field ) <= $p_value ) {
-                                    unset( $this->$field );
+                                if ( array_key_exists( $field, $res ) && $res[ $field ] <= $p_value ) {
+                                    unset( $res[ $field ] );
                                 }
                                 break;
                             case '>=':
-                                if ( $this->get( $field ) < $p_value ) {
-                                    unset( $this->$field );
+                                if ( array_key_exists( $field, $res ) && $res[ $field ] < $p_value ) {
+                                    unset( $res[ $field ] );
                                 }
                                 break;
                             case '<>':
                             case '!=':
-                                if ( $this->get( $field ) == $p_value ) {
-                                    unset( $this->$field );
+                                if ( array_key_exists( $field, $res ) && $res[ $field ] == $p_value ) {
+                                    unset( $res[ $field ] );
                                 }
                                 break;
                             case '=':
                             case '==':
                             default:
-                                $this->set( $field, $p_value );
+                                $res[ $field ] = $p_value;
                                 break;
                                 
                         }



From pieter at yellowduck.be  Tue Feb 14 11:16:43 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 14 Feb 2006 11:16:43 +0100
Subject: [ydf-devel] Remove session_start from YDF2_init() ?
In-Reply-To: <20060213123945.89936.qmail@web53809.mail.yahoo.com>
References: <20060213123945.89936.qmail@web53809.mail.yahoo.com>
Message-ID: <4aef63030602140216j3c9d95cw7c11ee25894e3a6c@mail.gmail.com>

I will fix this in a future version.

pieter

On 2/13/06, maximus meridius <maximus_meridius79 at yahoo.com> wrote:
> Hi,
>
> I have been working on setting up the session
> management for an
> application I am building.
>
> YDF2 currently has the call to "session_start()" in
> YDF2_init.php
>
> To provide for more flexibility in configuring the
> session and php
> settings, it would make sense for this call to be made
> within
> YDrequest.php or YDF2_process.php .
>
> The svn trunk of YDF2_process.php contains the
> following code:
>
>     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
> true ) {
>
>         // Instantiate the executor class
>         $clsInst = new YDExecutor( YD_SELF_FILE );
>
>         // Execute the execute function
>         $clsInst->execute();
>
>     }
>
> If session_start was removed from YDF2_init.php,
> session_start() could
> be called just before the class is executed:
>
>     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
> true ) {
>
>         // Instantiate the executor class
>         $clsInst = new YDExecutor( YD_SELF_FILE );
>
>
>         @session_start();
>
>         // Execute the execute function
>         $clsInst->execute();
>
>     }
>
> This would then allow custome php configuration to be
> defined before the
> session is started by placing it in the main script
> file, e.g:
>
>     // custom php config and session setup goes here
>        .
>        .
>
>     class index extends YDRequest() {
>        .
>        .
>     }
>
>     // Process the request
>     YDInclude( 'YDF2_process.php' );
>
>
> This of course could otherwise be achieved by
> providing the custom
> config before YDF2_init.php is included, but then what
> happens if Has
> anyone else been working with sessions or you want to
> use some of the
> nice YDF2 utility clasess such as YDConfig and YDUrl ?
>
> Did you find that session_start is called too early?
> Is so did you just
> comment it out?
>
> Regards,
>
> Graeme
>
> __________________________________________________
> Do You Yahoo!?
> Tired of spam?  Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>


--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/


From pclaerhout at berlios.de  Tue Feb 14 14:19:40 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 14:19:40 +0100
Subject: [ydf-devel] r1669 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602141319.k1EDJeQE018606@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 14:19:22 +0100 (Tue, 14 Feb 2006)
New Revision: 1669

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
The allow_comments field is now added even if you don't run the auto update function.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 02:26:08 UTC (rev 1668)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 13:19:22 UTC (rev 1669)
@@ -73,11 +73,20 @@
                 YDConfig::get( 'db_pass', '' ), YDConfig::get( 'db_host', 'localhost' )
             );
 
+            // Get the list of index for the items table
+            $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
+            if ( ! in_array( 'allow_comments', $indexes ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
+            }
+
             // Add any missing body_more field
             $fields = $this->db->getValuesByName( 'show fields from #_items', 'field' );
             if ( ! in_array( 'body_more', $fields ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
             }
+            if ( ! in_array( 'allow_comments', $fields ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
+            }
 
             // Get the list of indexes
             $indexes = $this->db->getValuesByName( 'show keys from #_users', 'key_name' );



From pclaerhout at berlios.de  Tue Feb 14 14:21:09 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 14:21:09 +0100
Subject: [ydf-devel] r1670 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200602141321.k1EDL9pl019307@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 14:21:03 +0100 (Tue, 14 Feb 2006)
New Revision: 1670

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Moved the session start function.

Bug #6423

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-02-14 13:19:22 UTC (rev 1669)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-02-14 13:21:03 UTC (rev 1670)
@@ -39,9 +39,6 @@
     // Disable magic_quotes_runtime
     set_magic_quotes_runtime( 0 );
 
-    // Start the session
-    @session_start();
-
     // Get the path delimiter and newline
     if ( strtoupper( substr( PHP_OS, 0, 3 ) ) == 'WIN' ) {
         @define( 'YD_CRLF', "\r\n" );

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2006-02-14 13:19:22 UTC (rev 1669)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2006-02-14 13:21:03 UTC (rev 1670)
@@ -198,11 +198,15 @@
 
     }
 
+    // Check if we need to auto execute
     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) == true ) { 
-    
+
         // Instantiate the executor class
         $clsInst = new YDExecutor( YD_SELF_FILE );
 
+        // Start the session
+        @session_start();
+
         // Execute the execute function
         $clsInst->execute();
 



From pieter at yellowduck.be  Tue Feb 14 14:21:18 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 14 Feb 2006 14:21:18 +0100
Subject: [ydf-devel] Remove session_start from YDF2_init() ?
In-Reply-To: <4aef63030602140216j3c9d95cw7c11ee25894e3a6c@mail.gmail.com>
References: <20060213123945.89936.qmail@web53809.mail.yahoo.com>
	 <4aef63030602140216j3c9d95cw7c11ee25894e3a6c@mail.gmail.com>
Message-ID: <4aef63030602140521g1ad7c372sd896e643c9b6e849@mail.gmail.com>

Fixed in build 1670.

pieter

On 2/14/06, Pieter Claerhout <pieter at yellowduck.be> wrote:
>
> I will fix this in a future version.
>
> pieter
>
> On 2/13/06, maximus meridius <maximus_meridius79 at yahoo.com> wrote:
> > Hi,
> >
> > I have been working on setting up the session
> > management for an
> > application I am building.
> >
> > YDF2 currently has the call to "session_start()" in
> > YDF2_init.php
> >
> > To provide for more flexibility in configuring the
> > session and php
> > settings, it would make sense for this call to be made
> > within
> > YDrequest.php or YDF2_process.php .
> >
> > The svn trunk of YDF2_process.php contains the
> > following code:
> >
> >     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
> > true ) {
> >
> >         // Instantiate the executor class
> >         $clsInst = new YDExecutor( YD_SELF_FILE );
> >
> >         // Execute the execute function
> >         $clsInst->execute();
> >
> >     }
> >
> > If session_start was removed from YDF2_init.php,
> > session_start() could
> > be called just before the class is executed:
> >
> >     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) ==
> > true ) {
> >
> >         // Instantiate the executor class
> >         $clsInst = new YDExecutor( YD_SELF_FILE );
> >
> >
> >         @session_start();
> >
> >         // Execute the execute function
> >         $clsInst->execute();
> >
> >     }
> >
> > This would then allow custome php configuration to be
> > defined before the
> > session is started by placing it in the main script
> > file, e.g:
> >
> >     // custom php config and session setup goes here
> >        .
> >        .
> >
> >     class index extends YDRequest() {
> >        .
> >        .
> >     }
> >
> >     // Process the request
> >     YDInclude( 'YDF2_process.php' );
> >
> >
> > This of course could otherwise be achieved by
> > providing the custom
> > config before YDF2_init.php is included, but then what
> > happens if Has
> > anyone else been working with sessions or you want to
> > use some of the
> > nice YDF2 utility clasess such as YDConfig and YDUrl ?
> >
> > Did you find that session_start is called too early?
> > Is so did you just
> > comment it out?
> >
> > Regards,
> >
> > Graeme
> >
> > __________________________________________________
> > Do You Yahoo!?
> > Tired of spam?  Yahoo! Mail has the best spam protection around
> > http://mail.yahoo.com
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
> --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060214/3f6ad183/attachment.html>

From pclaerhout at berlios.de  Tue Feb 14 15:07:11 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 15:07:11 +0100
Subject: [ydf-devel] r1671 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602141407.k1EE7BXd009422@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 15:06:58 +0100 (Tue, 14 Feb 2006)
New Revision: 1671

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
When a YDRecordSet object now contains only one page, the pages array will be populated properly.

Bug #6422

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-14 13:21:03 UTC (rev 1670)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-14 14:06:58 UTC (rev 1671)
@@ -220,7 +220,7 @@
             $this->isLastPage = ( $this->pageNext == false ) ? true : false;
 
             // Add the list of pages as an array
-            $this->pages = ( $this->totalPages <= 1 ) ? array() : range( 1, $this->totalPages );
+            $this->pages = ( $this->totalPages <= 1 ) ? array( 1 ) : range( 1, $this->totalPages );
             
             // Get the subset of the records we need
             $this->set = array_slice( $this->records, $this->offset, $this->pagesize );



From pclaerhout at berlios.de  Tue Feb 14 15:11:59 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 15:11:59 +0100
Subject: [ydf-devel] r1672 - in YDFramework2.0/trunk/YDFramework2/addons: YDAjax YDBBCode
Message-ID: <200602141411.k1EEBxQb010781@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 15:11:58 +0100 (Tue, 14 Feb 2006)
New Revision: 1672

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
Log:
Fixed some docstrings.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-14 14:06:58 UTC (rev 1671)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-14 14:11:58 UTC (rev 1672)
@@ -694,7 +694,7 @@
          *
          *	@param $formElementName		Form element name or a generic id string.
          *	@param $result				Result string or array.
-         *	@param $atribute			(Optional) Optional atribute to apply result (auto-detection by default when using null).
+         *	@param $attribute			(Optional) Optional atribute to apply result (auto-detection by default when using null).
          *	@param $options				(Optional) Aditional options.
          */	
 		function addResult( $formElementName, $result, $attribute = null, $options = array() ){
@@ -925,7 +925,7 @@
          *
          *	@param $formElement			Form element object.
          *	@param $result				Result value.
-         *	@param $atribute			Custom atribute (auto-detection by default).
+         *	@param $attribute			Custom atribute (auto-detection by default).
          *	@param $options				Other options.
          */		
 		function assignResult( & $formElement, $result, $attribute = null, $options = array()){
@@ -962,8 +962,8 @@
          *
          *	@param $id			Html element id.
          *	@param $result		Result value.
-         *	@param $atribute	Custom atribute (auto-detection by default).
-         *	@param $option		Other options (not used).
+         *	@param $attribute	Custom atribute (auto-detection by default).
+         *	@param $options		Other options (not used).
          */	
 		function assignId( $id, $result, $attribute, $options ){
 		

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-02-14 14:06:58 UTC (rev 1671)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-02-14 14:11:58 UTC (rev 1672)
@@ -108,7 +108,7 @@
          *	optionally convert line breaks as well as convert the remaining HTML tags to their entities.
          *
          *	@param $data			The data you want to convert.
-         *	@param $convertBr		(optional) Boolean to indicate that new lines should be converted to <br/> tags.
+         *	@param $convertBr		(optional) Boolean to indicate that new lines should be converted to &lt;br/&gt; tags.
          *							This is turned on by default.
          *	@param $convertTags		(optional) Boolean to indicate that tags should be converted to HTML. This is turned
          *							on by default.



From pclaerhout at berlios.de  Tue Feb 14 17:44:28 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 17:44:28 +0100
Subject: [ydf-devel] r1673 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602141644.k1EGiRef008839@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 17:44:27 +0100 (Tue, 14 Feb 2006)
New Revision: 1673

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
Log:
In the listings, the titles of the closed items are now prepended by "[x]".

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-02-14 14:11:58 UTC (rev 1672)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-02-14 16:44:27 UTC (rev 1673)
@@ -22,7 +22,7 @@
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{$item.created|date:'%Y/%m/%d %H:%M'}</td>
             <td class="adminRowL">{$item.user_name}</td>
-            <td class="adminRowL">{$item.title}</td>
+            <td class="adminRowL">{if $item.allow_comments eq '0'}[x] {/if}{$item.title}</td>
             <td class="adminRowR">
                 <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                 |

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 14:11:58 UTC (rev 1672)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 16:44:27 UTC (rev 1673)
@@ -69,7 +69,9 @@
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                 <td class="adminRowL">{$item.created|date:'%Y/%m/%d %H:%M'}</td>
                 <td class="adminRowL">{$item.user_name}</td>
-                <td class="adminRowL">{$item.title}</td>
+                <td class="adminRowL">
+                    {if $item.allow_comments eq '0'}[x] {/if}{$item.title}
+                </td>
                 <td class="adminRowR">
                     <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                     |



From pclaerhout at berlios.de  Tue Feb 14 17:54:46 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 17:54:46 +0100
Subject: [ydf-devel] r1674 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602141654.k1EGskJZ010457@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 17:54:46 +0100 (Tue, 14 Feb 2006)
New Revision: 1674

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Fixed the YDWeblogAPI to make sure that the allow_comments field is created before the index is created.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 16:44:27 UTC (rev 1673)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 16:54:46 UTC (rev 1674)
@@ -73,12 +73,6 @@
                 YDConfig::get( 'db_pass', '' ), YDConfig::get( 'db_host', 'localhost' )
             );
 
-            // Get the list of index for the items table
-            $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
-            if ( ! in_array( 'allow_comments', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
-            }
-
             // Add any missing body_more field
             $fields = $this->db->getValuesByName( 'show fields from #_items', 'field' );
             if ( ! in_array( 'body_more', $fields ) ) {
@@ -88,6 +82,12 @@
                 $this->db->executeSql( 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
             }
 
+            // Get the list of index for the items table
+            $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
+            if ( ! in_array( 'allow_comments', $indexes ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
+            }
+
             // Get the list of indexes
             $indexes = $this->db->getValuesByName( 'show keys from #_users', 'key_name' );
             if ( in_array( 'email', $indexes ) ) {



From pclaerhout at berlios.de  Tue Feb 14 17:55:31 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 17:55:31 +0100
Subject: [ydf-devel] r1675 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602141655.k1EGtV3w010900@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 17:55:31 +0100 (Tue, 14 Feb 2006)
New Revision: 1675

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
The allow_comments field is now reset before being updated to close the right items.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 16:54:46 UTC (rev 1674)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 16:55:31 UTC (rev 1675)
@@ -105,6 +105,7 @@
                 $treshold = time() - ( $auto_close_items * 86400 );
 
                 // Close the items
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1' );
                 $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE created < ' . $treshold );
 
             }



From pclaerhout at berlios.de  Tue Feb 14 17:55:58 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 17:55:58 +0100
Subject: [ydf-devel] r1676 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602141655.k1EGtwwF010980@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 17:55:56 +0100 (Tue, 14 Feb 2006)
New Revision: 1676

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/config.php
Log:
Changed the auto close items config default setting to ''.

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-14 16:55:31 UTC (rev 1675)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-14 16:55:56 UTC (rev 1676)
@@ -149,7 +149,7 @@
             $config['max_syndicated_items'] = YDConfig::get( 'max_syndicated_items', 20 );
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );
-            $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     30 );
+            $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     '' );
 
             // Return the configuration
             return $config;



From ydfpoi at gmail.com  Tue Feb 14 20:14:16 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Tue, 14 Feb 2006 20:14:16 +0100
Subject: [ydf-devel] r1666 - in YDFramework2.0/trunk/examples/weblog: . include include/dbupdates include/languages manage skins/default
Message-ID: <306340e00602141114k36561af7v@mail.gmail.com>

Hi Pieter,

didn't you forgot some french translations in language_fr.php?

From pclaerhout at berlios.de  Tue Feb 14 20:33:46 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 20:33:46 +0100
Subject: [ydf-devel] r1677 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602141933.k1EJXk18010389@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 20:33:44 +0100 (Tue, 14 Feb 2006)
New Revision: 1677

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
Log:
Updated the French translations and fixed the character encoding issues.
Also changed the French language file from UTF-8 to ANSI.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 16:55:56 UTC (rev 1676)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 19:33:44 UTC (rev 1677)
@@ -1,24 +1,24 @@
 <?php
 
 // General stuff
-$GLOBALS['t']['not_found'] = 'Non trouv?';
-$GLOBALS['t']['sorry_not_there'] = 'D?sol?, mais vous cherchez quelque chose qui n\'est pas l?.';
-$GLOBALS['t']['sorry_not_found'] = 'D?sol?, mais vous cherchez quelque chose qui n\'a pas ?t? trouv?.';
-$GLOBALS['t']['no_items_found'] = 'D?sol?, aucun ?l?ment correspondant.';
+$GLOBALS['t']['not_found'] = 'Non trouv&eacute;';
+$GLOBALS['t']['sorry_not_there'] = 'D&eacute;sol&eacute;, mais vous cherchez quelque chose qui n\'est pas l&agrave;.';
+$GLOBALS['t']['sorry_not_found'] = 'D&eacute;sol&eacute;, mais vous cherchez quelque chose qui n\'a pas &eacute;t&eacute; trouv&eacute;.';
+$GLOBALS['t']['no_items_found'] = 'D&eacute;sol&eacute;, aucun &eacute;l&eacute;ment correspondant.';
 $GLOBALS['t']['by'] = 'par';
 $GLOBALS['t']['required'] = 'requis';
 $GLOBALS['t']['login'] = 'Login';
 $GLOBALS['t']['actions'] = 'Actions';
 $GLOBALS['t']['save'] = 'Sauvegarder';
-$GLOBALS['t']['edit'] = '?diter';
+$GLOBALS['t']['edit'] = '&eacute;diter';
 $GLOBALS['t']['delete'] = 'supprimer';
-$GLOBALS['t']['previous'] = 'pr?c?dent';
+$GLOBALS['t']['previous'] = 'pr&eacute;c&eacute;dent';
 $GLOBALS['t']['next'] = 'suivant';
 $GLOBALS['t']['total'] = 'total';
 $GLOBALS['t']['of'] = 'de';
-$GLOBALS['t']['at'] = '?';
+$GLOBALS['t']['at'] = '&agrave;';
 $GLOBALS['t']['title'] = 'Titre';
-$GLOBALS['t']['install_warning'] = 'Vous devez retirer les fichiers install.php et install.tpl pour des raisons de s?curit?!';
+$GLOBALS['t']['install_warning'] = 'Vous devez retirer les fichiers install.php et install.tpl pour des raisons de s&eacute;curit&eacute;!';
 $GLOBALS['t']['home'] = 'Accueil';
 $GLOBALS['t']['view'] = 'voir';
 $GLOBALS['t']['author'] = 'Auteur';
@@ -29,11 +29,11 @@
 $GLOBALS['t']['no'] = 'non';
 
 // __std_header.tpl
-$GLOBALS['t']['another_powered_by'] = 'Juste un autre weblog propuls? par le ' . YD_FW_NAME . '!';
+$GLOBALS['t']['another_powered_by'] = 'Juste un autre weblog propuls&eacute; par le ' . YD_FW_NAME . '!';
 
 // __std_footer.tpl
 $GLOBALS['t']['or'] = 'ou';
-$GLOBALS['t']['powered_by'] = 'Ce weblog est propuls? par le ';
+$GLOBALS['t']['powered_by'] = 'Ce weblog est propuls&eacute; par le ';
 $GLOBALS['t']['syndicate_as'] = 'Syndiquez ce weblog via ';
 $GLOBALS['t']['syndicate_comments_as'] = 'Commentaires via ';
 $GLOBALS['t']['syndicate_gallery_as'] = 'Galeries photo via ';
@@ -46,8 +46,8 @@
 $GLOBALS['t']['page'] = 'Page';
 $GLOBALS['t']['archives'] = 'Archives';
 $GLOBALS['t']['archives_gallery'] = 'Galleries photo';
-$GLOBALS['t']['categories'] = 'Cat?gories';
-$GLOBALS['t']['view_posts_filed_under'] = 'Voir tous les sujets class?s sous';
+$GLOBALS['t']['categories'] = 'Cat&eacute;gories';
+$GLOBALS['t']['view_posts_filed_under'] = 'Voir tous les sujets class&eacute;s sous';
 $GLOBALS['t']['links'] = 'Liens';
 $GLOBALS['t']['link_to'] = 'Lien vers';
 $GLOBALS['t']['admin'] = 'Admin';
@@ -55,47 +55,48 @@
 // archive.tpl
 
 // category.tpl
-$GLOBALS['t']['archive_for_the'] = 'Archive pour la cat?gorie';
+$GLOBALS['t']['archive_for_the'] = 'Archive pour la cat&eacute;gorie';
 $GLOBALS['t']['category'] = '';
 
 // index.tpl
-$GLOBALS['t']['posted_in'] = 'post? dans';
-$GLOBALS['t']['older_items'] = 'Anciennes entr?es';
+$GLOBALS['t']['posted_in'] = 'post&eacute; dans';
+$GLOBALS['t']['older_items'] = 'Anciennes entr&eacute;es';
 
 // item.tpl
-$GLOBALS['t']['older_post'] = 'Entr?e pr?c?dente';
-$GLOBALS['t']['newer_post'] = 'Entr?e suivante';
-$GLOBALS['t']['posted_under'] = 'Entr?e soumise le';
-$GLOBALS['t']['filed_under'] = 'dans la cat?gorie ';
+$GLOBALS['t']['older_post'] = 'Entr&eacute;e pr&eacute;c&eacute;dente';
+$GLOBALS['t']['newer_post'] = 'Entr&eacute;e suivante';
+$GLOBALS['t']['posted_under'] = 'Entr&eacute;e soumise le';
+$GLOBALS['t']['filed_under'] = 'dans la cat&eacute;gorie ';
 $GLOBALS['t']['can_leave_comment'] = 'Vous pouvez <a href="#respond">laisser un commentaire</a>';
 $GLOBALS['t']['trackback'] = ' un lien permanent';
 $GLOBALS['t']['from_your_site'] = 'sur votre propre site.';
-$GLOBALS['t']['to'] = '?';
-$GLOBALS['t']['says'] = 'a ?crit';
+$GLOBALS['t']['to'] = '&agrave;';
+$GLOBALS['t']['says'] = 'a &eacute;crit';
 $GLOBALS['t']['leave_comment'] = 'Laisser un commentaire';
 $GLOBALS['t']['error_comment'] = 'Une erreur est survenue lors de l\'ajout de votre commentaire';
 $GLOBALS['t']['name'] = 'Nom';
-$GLOBALS['t']['mail_not_published'] = 'Email (ne sera pas publi?)';
+$GLOBALS['t']['mail_not_published'] = 'Email (ne sera pas publi&eacute;)';
 $GLOBALS['t']['website'] = 'Site web';
 $GLOBALS['t']['submit_comment'] = 'Ajouter le commentaire';
 $GLOBALS['t']['ta_enter_url'] = 'Saisissez l\'url';
 $GLOBALS['t']['ta_enter_email'] = 'Entrez l\'adresse email';
-$GLOBALS['t']['ta_enter_image'] = 'Entrez l\'url compl?te de l\'image';
+$GLOBALS['t']['ta_enter_image'] = 'Entrez l\'url compl&egrave;te de l\'image';
 $GLOBALS['t']['err_name'] = 'Le nom est manquant';
-$GLOBALS['t']['err_name_email'] = 'Le nom ne doit pas ?tre une adresse email';
+$GLOBALS['t']['err_name_email'] = 'Le nom ne doit pas &ecirc;tre une adresse email';
 $GLOBALS['t']['err_email'] = 'Email manquant ou invalide';
 $GLOBALS['t']['err_website'] = 'Le site web n\'est pas une URL valide';
 $GLOBALS['t']['err_comment'] = 'Le commentaire est requis';
 $GLOBALS['t']['with'] = 'pour';
+$GLOBALS['t']['item_closed'] = 'Les commentaires ne sont pas autoris&eacute;s pour cette entr&eacute;e.';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'Nouveau commentaire';
-$GLOBALS['t']['item_title'] = 'Titre de l\'entr?e';
-$GLOBALS['t']['wrote'] = '?crit';
+$GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';
+$GLOBALS['t']['wrote'] = '&eacute;crit';
 
 // page.tpl
-$GLOBALS['t']['created_on'] = 'Cr?? le';
-$GLOBALS['t']['last_modified_on'] = 'Derni?re modification le';
+$GLOBALS['t']['created_on'] = 'Cr&eacute;&eacute; le';
+$GLOBALS['t']['last_modified_on'] = 'Derni&egrave;re modification le';
 
 // Comments
 $GLOBALS['t']['no_comments_yet'] = 'Aucun commentaire';
@@ -104,7 +105,7 @@
 
 // manage/__mng_header.tpl
 $GLOBALS['t']['confirm_delete'] = 'Etes vous certain de vouloir supprimer:';
-$GLOBALS['t']['logoff'] = 'D?connexion';
+$GLOBALS['t']['logoff'] = 'D&eacute;connexion';
 $GLOBALS['t']['view_site'] = 'voir le site';
 $GLOBALS['t']['user'] = 'utilisateur';
 $GLOBALS['t']['server'] = 'serveur';
@@ -113,13 +114,13 @@
 $GLOBALS['t']['a_view_site'] = 'voir le site';
 $GLOBALS['t']['h_contents'] = 'Contenu';
 $GLOBALS['t']['a_weblogs'] = 'Weblogs';
-$GLOBALS['t']['a_items'] = 'Entr?es';
+$GLOBALS['t']['a_items'] = 'Entr&eacute;es';
 $GLOBALS['t']['a_comments'] = 'Commentaires';
 $GLOBALS['t']['a_links'] = 'Liens';
 $GLOBALS['t']['a_pages'] = 'Pages';
 $GLOBALS['t']['a_images'] = 'Images';
-$GLOBALS['t']['a_categories'] = 'Cat?gories';
-$GLOBALS['t']['h_global_settings'] = 'Options g?n?rales';
+$GLOBALS['t']['a_categories'] = 'Cat&eacute;gories';
+$GLOBALS['t']['h_global_settings'] = 'Options g&eacute;n&eacute;rales';
 $GLOBALS['t']['a_users'] = 'Utilisateurs';
 $GLOBALS['t']['a_settings'] = 'Options';
 $GLOBALS['t']['h_maintenance'] = 'Maintenance';
@@ -127,8 +128,8 @@
 $GLOBALS['t']['a_server_info'] = 'Informations serveur';
 $GLOBALS['t']['h_statistics'] = 'Statistiques';
 $GLOBALS['t']['a_statistics'] = 'Statistiques';
-$GLOBALS['t']['h_logoff'] = 'D?connexion';
-$GLOBALS['t']['a_logoff'] = 'D?connexion';
+$GLOBALS['t']['h_logoff'] = 'D&eacute;connexion';
+$GLOBALS['t']['a_logoff'] = 'D&eacute;connexion';
 
 // manage/login.tpl
 $GLOBALS['t']['username'] = 'Utilisateur';
@@ -136,30 +137,30 @@
 $GLOBALS['t']['msg_login'] = 'Veuillez entrer votre nom d\'utilisateur et votre mot de passe';
 $GLOBALS['t']['err_login'] = 'Une erreur est survenue lors de la connexion';
 $GLOBALS['t']['err_username'] = 'Le nom d\'utilisateur est manquant';
-$GLOBALS['t']['err_password'] = 'Le mot de passe est incorrect ou erron?';
+$GLOBALS['t']['err_password'] = 'Le mot de passe est incorrect ou erron&eacute;';
 $GLOBALS['t']['err_login_all'] = 'Nom d\'utilisateur et/ou mot de passe incorrects';
 
 // manage/cache.tpl
 $GLOBALS['t']['cleanup'] = 'Nettoyer';
-$GLOBALS['t']['cache_cleaned_up'] = 'Les fichiers du cache ont ?t? supprim?s!';
+$GLOBALS['t']['cache_cleaned_up'] = 'Les fichiers du cache ont &eacute;t&eacute; supprim&eacute;s!';
 
 // manage/serverinfo.tpl
-$GLOBALS['t']['system'] = 'Syst?me';
+$GLOBALS['t']['system'] = 'Syst&egrave;me';
 $GLOBALS['t']['server_name'] = 'Nom de la machine';
 $GLOBALS['t']['server_address'] = 'Adresse du serveur';
 $GLOBALS['t']['server_port'] = 'Port du service';
 $GLOBALS['t']['server_software'] = 'Nom du service';
-$GLOBALS['t']['operating_system'] = 'Syst?me d\'exploitation';
+$GLOBALS['t']['operating_system'] = 'Syst&egrave;me d\'exploitation';
 $GLOBALS['t']['version'] = 'version';
-$GLOBALS['t']['loaded_modules'] = 'Modules charg?s';
+$GLOBALS['t']['loaded_modules'] = 'Modules charg&eacute;s';
 $GLOBALS['t']['server_api'] = 'API Serveur';
-$GLOBALS['t']['registered_streams'] = 'Flux PHP d?clar?s';
-$GLOBALS['t']['include_path'] = 'R?pertoire d\'inclusion';
+$GLOBALS['t']['registered_streams'] = 'Flux PHP d&eacute;clar&eacute;s';
+$GLOBALS['t']['include_path'] = 'R&eacute;pertoire d\'inclusion';
 $GLOBALS['t']['full_php_info'] = 'Voir toutes les informations PHP';
 
 // manage/stats.tpl
-$GLOBALS['t']['general_stats'] = 'Statistiques g?n?rales';
-$GLOBALS['t']['installed_since'] = 'Install? depuis le';
+$GLOBALS['t']['general_stats'] = 'Statistiques g&eacute;n&eacute;rales';
+$GLOBALS['t']['installed_since'] = 'Install&eacute; depuis le';
 $GLOBALS['t']['num_days_online'] = 'Nombre de jour en ligne';
 $GLOBALS['t']['days'] = 'jour(s)';
 $GLOBALS['t']['hits'] = 'hit(s)';
@@ -169,25 +170,25 @@
 $GLOBALS['t']['all_months'] = 'Tous les mois';
 $GLOBALS['t']['hits_last_7_days'] = 'Hits les 7 derniers jours';
 $GLOBALS['t']['all_days'] = 'Tous les jours';
-$GLOBALS['t']['nothing_found'] = 'Non trouv?';
-$GLOBALS['t']['top_10_urls'] = 'Les 10 URLs les plus visit?es';
+$GLOBALS['t']['nothing_found'] = 'Non trouv&eacute;';
+$GLOBALS['t']['top_10_urls'] = 'Les 10 URLs les plus visit&eacute;es';
 $GLOBALS['t']['all_urls'] = 'Toutes les URLs';
 $GLOBALS['t']['web_browsers'] = 'Navigateurs';
-$GLOBALS['t']['operating_systems'] = 'Syst?mes d\'exploitation';
+$GLOBALS['t']['operating_systems'] = 'Syst&egrave;mes d\'exploitation';
 $GLOBALS['t']['other'] = 'Autre';
-$GLOBALS['t']['totalitems'] = 'Nombre total d\'entr?es';
+$GLOBALS['t']['totalitems'] = 'Nombre total d\'entr&eacute;es';
 $GLOBALS['t']['totalcomments'] = 'Nombre total de commentaires';
-$GLOBALS['t']['items'] = 'entr?e(s)';
+$GLOBALS['t']['items'] = 'entr&eacute;e(s)';
 $GLOBALS['t']['top_10_commenters'] = 'Les 10 commentateurs les plus actifs';
 $GLOBALS['t']['all_commenters'] = 'Tous les commentateurs';
 
 // manage/users.tpl
 $GLOBALS['t']['useremail'] = 'Adresse email';
-$GLOBALS['t']['created'] = 'Cr?? le';
+$GLOBALS['t']['created'] = 'Cr&eacute;&eacute; le';
 $GLOBALS['t']['add_user'] = 'Ajouter un utilisateur';
 $GLOBALS['t']['req_useremail'] = 'Adresse email manquante ou invalide';
 $GLOBALS['t']['req_loginpass'] = 'Le mot de passe est requis';
-$GLOBALS['t']['user_dup'] = 'L\'utilisateur existe d?j?';
+$GLOBALS['t']['user_dup'] = 'L\'utilisateur existe d&eacute;j&agrave;';
 $GLOBALS['t']['change_user_desc'] = 'Changer l\'utilisateur:';
 
 // manage/images.tpl
@@ -196,15 +197,15 @@
 $GLOBALS['t']['size'] = 'Taille';
 $GLOBALS['t']['type'] = 'Type';
 $GLOBALS['t']['dimensions'] = 'Dimensions';
-$GLOBALS['t']['no_images_found'] = 'Aucune image n\'a ?t? trouv?e';
+$GLOBALS['t']['no_images_found'] = 'Aucune image n\'a &eacute;t&eacute; trouv&eacute;e';
 
 // manage/categories.tpl
-$GLOBALS['t']['add_category'] = 'Ajouter une cat?gorie';
-$GLOBALS['t']['number_of_items'] = 'Nombre d\'entr?es';
-$GLOBALS['t']['change_category_desc'] = 'Editer la cat?gorie';
-$GLOBALS['t']['err_category_title'] = 'Le nom de la cat?gorie est requis';
-$GLOBALS['t']['err_unique_category'] = 'La cat?gorie existe d?j?';
-$GLOBALS['t']['no_categories_found'] = 'Aucune cat?gorie n\'a ?t? trouv?e';
+$GLOBALS['t']['add_category'] = 'Ajouter une cat&eacute;gorie';
+$GLOBALS['t']['number_of_items'] = 'Nombre d\'entr&eacute;es';
+$GLOBALS['t']['change_category_desc'] = 'Editer la cat&eacute;gorie';
+$GLOBALS['t']['err_category_title'] = 'Le nom de la cat&eacute;gorie est requis';
+$GLOBALS['t']['err_unique_category'] = 'La cat&eacute;gorie existe d&eacute;j&agrave;';
+$GLOBALS['t']['no_categories_found'] = 'Aucune cat&eacute;gorie n\'a &eacute;t&eacute; trouv&eacute;e';
 
 // manage/links.tpl
 $GLOBALS['t']['link_title'] = 'Titre du lien';
@@ -212,9 +213,9 @@
 $GLOBALS['t']['add_link'] = 'Ajouter un lien';
 $GLOBALS['t']['err_link_title'] = 'Le titre du lien est requis';
 $GLOBALS['t']['err_link_url'] = 'L\'URL du lien est requise';
-$GLOBALS['t']['err_unique_link'] = 'L\'URL existe d?j?';
+$GLOBALS['t']['err_unique_link'] = 'L\'URL existe d&eacute;j&agrave;';
 $GLOBALS['t']['change_link_desc'] = 'Modification du lien';
-$GLOBALS['t']['no_links_found'] = 'Aucun lien n\'a ?t? trouv?';
+$GLOBALS['t']['no_links_found'] = 'Aucun lien n\'a &eacute;t&eacute; trouv&eacute;';
 $GLOBALS['t']['num_visits'] = 'Visites';
 
 // manage/pages.tpl
@@ -224,18 +225,18 @@
 $GLOBALS['t']['change_page_desc'] = 'Modification de la page';
 $GLOBALS['t']['err_page_title'] = 'Le titre de la page est requis';
 $GLOBALS['t']['err_page_body'] = 'Le corps de la page est requis';
-$GLOBALS['t']['no_pages_found'] = 'Aucune page n\'a ?t? trouv?e';
+$GLOBALS['t']['no_pages_found'] = 'Aucune page n\'a &eacute;t&eacute; trouv&eacute;e';
 
 // manage/comments.tpl
 $GLOBALS['t']['date'] = 'Date';
-$GLOBALS['t']['parent'] = 'Entr?e correspondante';
+$GLOBALS['t']['parent'] = 'Entr&eacute;e correspondante';
 $GLOBALS['t']['change_comment_desc'] = 'Modification du commentaire';
 $GLOBALS['t']['mail'] = 'Email';
-$GLOBALS['t']['no_comments_found'] = 'Aucun commentaire n\'a ?t? trouv?';
-$GLOBALS['t']['posted_from'] = 'Post? depuis l\'adresse IP';
+$GLOBALS['t']['no_comments_found'] = 'Aucun commentaire n\'a &eacute;t&eacute; trouv&eacute;';
+$GLOBALS['t']['posted_from'] = 'Post&eacute; depuis l\'adresse IP';
 
 // manage/config.tpl
-$GLOBALS['t']['cfg_db_settings'] = 'Configuration de la base de donn?es';
+$GLOBALS['t']['cfg_db_settings'] = 'Configuration de la base de donn&eacute;es';
 $GLOBALS['t']['cfg_db_host'] = 'Serveur (hostname)';
 $GLOBALS['t']['cfg_db_name'] = 'Nom de la base';
 $GLOBALS['t']['cfg_db_user'] = 'Utilisateur';
@@ -243,49 +244,53 @@
 $GLOBALS['t']['cfg_weblog_settings'] = 'Options du Weblog';
 $GLOBALS['t']['cfg_weblog_title'] = 'Titre du Weblog';
 $GLOBALS['t']['cfg_weblog_description'] = 'Description du Weblog';
-$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Nombre d\'entr?es sur la page d\'accueil';
-$GLOBALS['t']['cfg_weblog_skin'] = 'Th?me du Weblog';
+$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Nombre d\'entr&eacute;es sur la page d\'accueil';
+$GLOBALS['t']['cfg_weblog_skin'] = 'Th&egrave;me du Weblog';
 $GLOBALS['t']['cfg_weblog_language'] = 'Langage du Weblog';
 $GLOBALS['t']['cfg_weblog_date_format'] = 'Format des dates';
 $GLOBALS['t']['cfg_notification'] = 'Options de notification';
-$GLOBALS['t']['cfg_notification_email_comment'] = 'Pr?venir par email des nouveaux commentaires';
+$GLOBALS['t']['cfg_notification_email_comment'] = 'Pr&eacute;venir par email des nouveaux commentaires';
 $GLOBALS['t']['cfg_rss'] = 'Options de syndication';
-$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Nombre d\'entr?es syndiqu?es';
-$GLOBALS['t']['err_db_host'] = 'Le serveur (hostname) de la base de donn?es est requis';
-$GLOBALS['t']['err_db_name'] = 'Le nom de la base de donn?es est requis';
-$GLOBALS['t']['err_db_user'] = 'L\'utilisateur de la base de donn?es est requis';
+$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Nombre d\'entr&eacute;es syndiqu&eacute;es';
+$GLOBALS['t']['err_db_host'] = 'Le serveur (hostname) de la base de donn&eacute;es est requis';
+$GLOBALS['t']['err_db_name'] = 'Le nom de la base de donn&eacute;es est requis';
+$GLOBALS['t']['err_db_user'] = 'L\'utilisateur de la base de donn&eacute;es est requis';
 $GLOBALS['t']['err_weblog_title'] = 'Le titre du Weblog est requis';
-$GLOBALS['t']['err_weblog_entries_fp'] = 'Le nombre d\'entr?es sur la page d\'accueil est requis';
-$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Le nombre d\'entr?es sur la page d\'accueil doit ?tre num?rique';
-$GLOBALS['t']['err_max_syndicated_items'] = 'Le nombre d\'entr?es syndiqu?es est requis';
-$GLOBALS['t']['err_max_syndicated_items_num'] = 'Le nombre d\'entr?es syndiqu?es doit ?tre num?rique';
+$GLOBALS['t']['err_weblog_entries_fp'] = 'Le nombre d\'entr&eacute;es sur la page d\'accueil est requis';
+$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Le nombre d\'entr&eacute;es sur la page d\'accueil doit &ecirc;tre num&eacute;rique';
+$GLOBALS['t']['err_max_syndicated_items'] = 'Le nombre d\'entr&eacute;es syndiqu&eacute;es est requis';
+$GLOBALS['t']['err_max_syndicated_items_num'] = 'Le nombre d\'entr&eacute;es syndiqu&eacute;es doit &ecirc;tre num&eacute;rique';
 $GLOBALS['t']['change_config'] = 'Modifier';
-$GLOBALS['t']['cfg_db_prefix'] = 'Pr?fixe pour les tables de la base de donn?es';
+$GLOBALS['t']['cfg_db_prefix'] = 'Pr&eacute;fixe pour les tables de la base de donn&eacute;es';
 $GLOBALS['t']['cfg_cache'] = 'Cache';
 $GLOBALS['t']['cfg_use_cache_comment'] = 'Mettre en cache les pages publiques';
 $GLOBALS['t']['cfg_friendly_urls'] = 'URLs sympathiques';
+$GLOBALS['t']['cfg_spam_protection'] = 'Protection anti-spam';
+$GLOBALS['t']['cfg_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours';
+$GLOBALS['t']['err_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours devrait &ecirc;tre num&eacute;rique';
 
 // manage/item.tpl
-$GLOBALS['t']['item_title'] = 'Titre de l\'entr?e';
-$GLOBALS['t']['item_body'] = 'Corps de l\'entr?e';
-$GLOBALS['t']['item_body_more'] = 'Corps de l\'entr?e (?tendu)';
-$GLOBALS['t']['select_image'] = 'S?lectionnez une image';
+$GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';
+$GLOBALS['t']['item_body'] = 'Corps de l\'entr&eacute;e';
+$GLOBALS['t']['item_body_more'] = 'Corps de l\'entr&eacute;e (&eacute;tendu)';
+$GLOBALS['t']['select_image'] = 'S&eacute;lectionnez une image';
 $GLOBALS['t']['view'] = 'voir';
-$GLOBALS['t']['add_item'] = 'Ajouter une entr?e';
-$GLOBALS['t']['change_item_desc'] = 'Modification de l\'entr?e';
-$GLOBALS['t']['err_item_title'] = 'Le titre de l\'entr?e est requis';
-$GLOBALS['t']['err_item_body'] = 'Le corps de l\'entr?e est requis';
+$GLOBALS['t']['add_item'] = 'Ajouter une entr&eacute;e';
+$GLOBALS['t']['change_item_desc'] = 'Modification de l\'entr&eacute;e';
+$GLOBALS['t']['err_item_title'] = 'Le titre de l\'entr&eacute;e est requis';
+$GLOBALS['t']['err_item_body'] = 'Le corps de l\'entr&eacute;e est requis';
 $GLOBALS['t']['gallery'] = 'Photos';
+$GLOBALS['t']['allow_comments'] = 'Autoriser les commentaires';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';
 $GLOBALS['t']['image'] = 'image';
 $GLOBALS['t']['images'] = 'images';
-$GLOBALS['t']['item'] = 'Entr?e';
+$GLOBALS['t']['item'] = 'Entr&eacute;e';
 
 // manage/index.tpl
-$GLOBALS['t']['latest_items'] = 'Derni?res entr?es';
-$GLOBALS['t']['overview'] = 'Aper?u';
+$GLOBALS['t']['latest_items'] = 'Derni&egrave;res entr&eacute;es';
+$GLOBALS['t']['overview'] = 'Aper&ccedil;u';
 
 // manage/dbbackup.tpl
 $GLOBALS['t']['a_db_backup'] = 'Sauvegarde de la base';
@@ -293,18 +298,18 @@
 $GLOBALS['t']['gz_compress'] = 'Compresser la sauvegarde avec GZip';
 $GLOBALS['t']['backup'] = 'Sauvegarder';
 $GLOBALS['t']['err_bck_name'] = 'Le nom du fichier de sauvegarde est requis';
-$GLOBALS['t']['bck_name_comment'] = 'Vous pouvez utiliser "%DBNAME" pour obtenir le nom de la base et <a href="http://www.php.net/strftime" target="_blank">toute option de la fonction strftime</a> pour sp?cifier une date. L\'extension sera automatiquement ajout?e. Tout autre texte sera pr?serv?.';
+$GLOBALS['t']['bck_name_comment'] = 'Vous pouvez utiliser "%DBNAME" pour obtenir le nom de la base et <a href="http://www.php.net/strftime" target="_blank">toute option de la fonction strftime</a> pour sp&eacute;cifier une date. L\'extension sera automatiquement ajout&eacute;e. Tout autre texte sera pr&eacute;serv&eacute;.';
 $GLOBALS['t']['bck_type'] = 'Type de sauvegarde';
-$GLOBALS['t']['bck_full'] = 'Sauvegarde Compl?te (structure et donn?es)';
+$GLOBALS['t']['bck_full'] = 'Sauvegarde Compl&egrave;te (structure et donn&eacute;es)';
 $GLOBALS['t']['bck_structure_only'] = 'Structure seule';
-$GLOBALS['t']['bck_data_only'] = 'Donn?es seules';
+$GLOBALS['t']['bck_data_only'] = 'Donn&eacute;es seules';
 
 // manage/version_info.tpl
 $GLOBALS['t']['h_diagtools'] = 'Outils de diagnostic';
 $GLOBALS['t']['a_version_info'] = 'Auto Update';
-$GLOBALS['t']['version_check'] = 'V?rifier la version';
-$GLOBALS['t']['installed_version'] = 'Version install?e';
-$GLOBALS['t']['development_version'] = 'Version de d?veloppement';
+$GLOBALS['t']['version_check'] = 'V&eacute;rifier la version';
+$GLOBALS['t']['installed_version'] = 'Version install&eacute;e';
+$GLOBALS['t']['development_version'] = 'Version de d&eacute;veloppement';
 $GLOBALS['t']['msg_correct_version'] = 'Il n\'y a pas de nouvelle version disponible';
 $GLOBALS['t']['msg_install_update'] = 'De nouvelles versions sont disponibles';
 $GLOBALS['t']['development_changelog'] = 'Log de modifications';



From pieter at yellowduck.be  Tue Feb 14 20:35:00 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 14 Feb 2006 20:35:00 +0100
Subject: [ydf-devel] r1666 - in YDFramework2.0/trunk/examples/weblog: . include include/dbupdates include/languages manage skins/default
In-Reply-To: <306340e00602141114k36561af7v@mail.gmail.com>
References: <306340e00602141114k36561af7v@mail.gmail.com>
Message-ID: <4aef63030602141135s2139a8bcs1d691e59a08471e2@mail.gmail.com>

Done in build 1677.

pieter

On 2/14/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter,
>
> didn't you forgot some french translations in language_fr.php?
> From the english file it seems that 5 lines are missing.
>
> After line 279:
> $GLOBALS['t']['allow_comments'] = 'Autoriser les commentaires';
>
> After line 267:
> $GLOBALS['t']['cfg_spam_protection'] = 'Protection anti-spam';
> $GLOBALS['t']['cfg_auto_close_items'] = 'Interdire les commentaires
> apr?s x jours';
> $GLOBALS['t']['err_auto_close_items'] = 'Interdire les commentaires
> apr?s x jours devrait ?tre num?rique';
>
> After line 89:
> $GLOBALS['t']['item_closed'] = 'Les commentaires ne sont pas autoris?s
> pour cette entr?e.';
>
> Kind regards
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060214/e3649f4a/attachment.html>

From pclaerhout at berlios.de  Tue Feb 14 20:43:16 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 20:43:16 +0100
Subject: [ydf-devel] r1678 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602141943.k1EJhGTG015374@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 20:43:04 +0100 (Tue, 14 Feb 2006)
New Revision: 1678

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Fixed a bug in the installer script of the weblog application where it would fail to update the items table because the database prefix was not set correctly.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 19:33:44 UTC (rev 1677)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 19:43:04 UTC (rev 1678)
@@ -21,6 +21,9 @@
         if ( ! isset( $values['max_syndicated_items'] ) ) {
             $values['max_syndicated_items'] = 20;
         }
+        if ( ! isset( $values['auto_close_items'] ) ) {
+            $values['auto_close_items'] = 45;
+        }
 
         // Construct the new config text
         $cfg = '<?php' . "\n\n";



From pclaerhout at berlios.de  Tue Feb 14 20:44:28 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 20:44:28 +0100
Subject: [ydf-devel] r1679 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200602141944.k1EJiSKc016270@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 20:44:03 +0100 (Tue, 14 Feb 2006)
New Revision: 1679

Modified:
   YDFramework2.0/trunk/examples/weblog/install.php
Log:
Fixed a bug in the installer script of the weblog application where it would fail to update the items table because the database prefix was not set correctly.


Modified: YDFramework2.0/trunk/examples/weblog/install.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/install.php	2006-02-14 19:43:04 UTC (rev 1678)
+++ YDFramework2.0/trunk/examples/weblog/install.php	2006-02-14 19:44:03 UTC (rev 1679)
@@ -217,15 +217,18 @@
                     $values['db_prefix'] . 'statistics_init', array( 'created' => $db->getDate( '__NOW__' ) )
                 );
 
-                // Include the weblog API
-                YDInclude( dirname( __FILE__ ) . '/include/YDWeblogAPI.php' );
-
                 // Save the config file
                 YDWeblogSaveConfig( $values );
 
                 // Include the config file
                 YDInclude( dirname( __FILE__ ) . '/include/config.php' );
 
+                // Update the database prefix
+                YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix', '' ) );
+
+                // Include the weblog API
+                YDInclude( dirname( __FILE__ ) . '/include/YDWeblogAPI.php' );
+
                 // Create the weblog object
                 $weblog = new YDWeblogAPI();
 



From pclaerhout at berlios.de  Tue Feb 14 21:00:57 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:00:57 +0100
Subject: [ydf-devel] r1680 - in YDFramework2.0/trunk/examples/weblog: include include/languages manage
Message-ID: <200602142000.k1EK0vhj025548@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:00:39 +0100 (Tue, 14 Feb 2006)
New Revision: 1680

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
Log:
Added a configuration option to control the YD_DEBUG setting.

Feature request #1763

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -24,6 +24,9 @@
         if ( ! isset( $values['auto_close_items'] ) ) {
             $values['auto_close_items'] = 45;
         }
+        if ( ! isset( $values['include_debug_info'] ) ) {
+            $values['include_debug_info'] = 0;
+        }
 
         // Construct the new config text
         $cfg = '<?php' . "\n\n";

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -28,6 +28,13 @@
     YDInclude( 'YDRequest.php' );
     YDInclude( dirname( __FILE__ ) . '/config.php' );
 
+    // Set the YD_DEBUG flag
+    if ( YDConfig::get( 'include_debug_info', 1 ) == 1 ) {
+        YDConfig::set( 'YD_DEBUG', 1 );
+    } else {
+        YDConfig::set( 'YD_DEBUG', 0 );
+    }
+
     // Update the database prefix
     YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix', '' ) );
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -269,6 +269,7 @@
 $GLOBALS['t']['cfg_spam_protection'] = 'Spam protection';
 $GLOBALS['t']['cfg_auto_close_items'] = 'Do not allow comment after x days';
 $GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
+$GLOBALS['t']['cfg_include_debug_info'] = 'Show debugging information';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -268,6 +268,7 @@
 $GLOBALS['t']['cfg_spam_protection'] = 'Protection anti-spam';
 $GLOBALS['t']['cfg_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours';
 $GLOBALS['t']['err_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours devrait &ecirc;tre num&eacute;rique';
+$GLOBALS['t']['cfg_include_debug_info'] = 'Affiche des informations de d&eacute;bogage';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -269,6 +269,7 @@
 $GLOBALS['t']['cfg_spam_protection'] = 'Beveiliging tegen spam';
 $GLOBALS['t']['cfg_auto_close_items'] = 'Laat geen commentaren toe na x dagen';
 $GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
+$GLOBALS['t']['cfg_include_debug_info'] = 'Toon debugging informatie';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-14 20:00:39 UTC (rev 1680)
@@ -24,9 +24,10 @@
             $config = $this->getConfig();
 
             // Fix the boolean values
-            $config['email_new_comment'] = ( $config['email_new_comment'] ) ? t('yes') : t('no');
-            $config['use_cache']         = ( $config['use_cache'] ) ? t('yes') : t('no');
-            $config['friendly_urls']     = ( $config['friendly_urls'] ) ? t('yes') : t('no');
+            $config['email_new_comment']  = ( $config['email_new_comment'] ) ? t('yes') : t('no');
+            $config['use_cache']          = ( $config['use_cache'] ) ? t('yes') : t('no');
+            $config['friendly_urls']      = ( $config['friendly_urls'] ) ? t('yes') : t('no');
+            $config['include_debug_info'] = ( $config['include_debug_info'] ) ? t('yes') : t('no');
 
             // Assign it to the template
             $this->tpl->assign( 'config', $config );
@@ -74,6 +75,7 @@
             $form->addElement( 'text', 'weblog_entries_fp', t( 'cfg_weblog_entries_fp' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'select', 'weblog_skin', t( 'cfg_weblog_skin' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $skins );
             $form->addElement( 'select', 'weblog_language', t( 'cfg_weblog_language' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $languages );
+            $form->addElement( 'checkbox', 'include_debug_info', t( 'cfg_include_debug_info' ), array( 'style' => 'border: none;' ) );
 
             $form->addElement( 'checkbox', 'email_new_comment', t( 'cfg_notification_email_comment' ),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'max_syndicated_items', t( 'cfg_rss_max_syndicated_items' ), array( 'class' => 'tfM' ) );
@@ -145,6 +147,7 @@
             $config['weblog_entries_fp']    = YDConfig::get( 'weblog_entries_fp',    1 );
             $config['weblog_skin']          = YDConfig::get( 'weblog_skin',          'default' );
             $config['weblog_language']      = YDConfig::get( 'weblog_language',      'nl' );
+            $config['include_debug_info']   = YDConfig::get( 'include_debug_info',   false );
             $config['email_new_comment']    = YDConfig::get( 'email_new_comment',    true );
             $config['max_syndicated_items'] = YDConfig::get( 'max_syndicated_items', 20 );
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-14 19:44:03 UTC (rev 1679)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-14 20:00:39 UTC (rev 1680)
@@ -72,6 +72,10 @@
             <td class="adminRowL">{t w="cfg_friendly_urls"}</td>
             <td class="adminRowL">{$config.friendly_urls}</td>
         </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="cfg_include_debug_info"}</td>
+            <td class="adminRowL">{$config.include_debug_info}</td>
+        </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>
@@ -174,6 +178,10 @@
                 <td class="adminRowL">{$form.friendly_urls.label_html}</td>
                 <td class="adminRowL">{$form.friendly_urls.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL">{$form.include_debug_info.label_html}</td>
+                <td class="adminRowL">{$form.include_debug_info.html}</td>
+            </tr>
         </table>
         <table width="700" cellspacing="0" cellpadding="0" border="0">
             <tr><td colspan="3">&nbsp;</td></tr>



From pclaerhout at berlios.de  Tue Feb 14 21:04:45 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:04:45 +0100
Subject: [ydf-devel] r1681 - YDFramework2.0/trunk/examples/weblog/include/dbupdates
Message-ID: <200602142004.k1EK4jMW026103@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:04:42 +0100 (Tue, 14 Feb 2006)
New Revision: 1681

Modified:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
Log:
Fixed a typo in the 001 database update script.

Modified: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-14 20:00:39 UTC (rev 1680)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-14 20:04:42 UTC (rev 1681)
@@ -1,10 +1,10 @@
 <?php
 
     // Class definition
-    class UPD_001_AllowComments.php {
+    class UPD_001_AllowComments {
 
         // Class constructor
-        function UPD_001_AllowComments.php( $db ) {
+        function UPD_001_AllowComments( $db ) {
 
             // Publish the database
             $this->db = $db;



From pclaerhout at berlios.de  Tue Feb 14 21:06:20 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:06:20 +0100
Subject: [ydf-devel] r1682 - YDFramework2.0/trunk/examples/weblog/include/dbupdates
Message-ID: <200602142006.k1EK6KEd026519@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:06:17 +0100 (Tue, 14 Feb 2006)
New Revision: 1682

Modified:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
Log:
Did some code cleanup.

Modified: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-14 20:04:42 UTC (rev 1681)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_001_AllowComments.php	2006-02-14 20:06:17 UTC (rev 1682)
@@ -15,11 +15,11 @@
         function update() {
 
             // The SQL to add the `allow_comments` field to the database
-            $sql = 'ALTER TABLE `' . YDConfig::get( 'db_prefix', '' ) . 'items` ADD `allow_comments` TINYINT(1)  DEFAULT "1" NOT NULL AFTER `num_comments`';
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD allow_comments TINYINT(1)  DEFAULT "1" NOT NULL AFTER `num_comments`';
             $this->db->executeSql( $sql );
 
             // The SQL to add the `allow_comments` field to the database
-            $sql = 'ALTER TABLE `' . YDConfig::get( 'db_prefix', '' ) . 'items` ADD INDEX allow_comments (allow_comments)';
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD INDEX allow_comments (allow_comments)';
             $this->db->executeSql( $sql );
 
         }



From pclaerhout at berlios.de  Tue Feb 14 21:21:14 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:21:14 +0100
Subject: [ydf-devel] r1683 - in YDFramework2.0/trunk/examples/weblog: include include/dbupdates include/languages manage
Message-ID: <200602142021.k1EKLEqs032244@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:21:10 +0100 (Tue, 14 Feb 2006)
New Revision: 1683

Added:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
Log:
Improved the way automatic closing of items works:
- You can now indicate if an item is subject to auto close or not.
- The automatic update now only affects items subject to auto close.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -87,12 +87,18 @@
             if ( ! in_array( 'allow_comments', $fields ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
             }
+            if ( ! in_array( 'auto_close', $fields ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
+            }
 
             // Get the list of index for the items table
             $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
             if ( ! in_array( 'allow_comments', $indexes ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
             }
+            if ( ! in_array( 'auto_close', $indexes ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
+            }
 
             // Get the list of indexes
             $indexes = $this->db->getValuesByName( 'show keys from #_users', 'key_name' );
@@ -111,8 +117,8 @@
                 $treshold = time() - ( $auto_close_items * 86400 );
 
                 // Close the items
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1' );
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE created < ' . $treshold );
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1 WHERE auto_close = 1' );
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE auto_close = 1 AND created < ' . $treshold );
 
             }
 
@@ -252,7 +258,7 @@
         // Function to get the items of the weblog
         function getItems( $limit=-1, $offset=-1, $order='created desc, title', $where='' ) {
             $sql = 'SELECT i.id, i.category_id, i.title, i.body, i.body_more, i.num_comments, i.created, i.modified, '
-                 . 'i.allow_comments, '
+                 . 'i.allow_comments, i.auto_close, '
                  . 'c.title as category, u.email as user_email, u.name as user_name FROM #_items i, #_categories c, '
                  . '#_users u WHERE i.category_id = c.id AND i.user_id = u.id ';
             $sql = $this->_prepareQuery( $sql . $where, $order );

Added: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -0,0 +1,29 @@
+<?php
+
+    // Class definition
+    class UPD_002_AutoCloseItem {
+
+        // Class constructor
+        function UPD_002_AutoCloseItem( $db ) {
+
+            // Publish the database
+            $this->db = $db;
+
+        }
+
+        // Install the update
+        function update() {
+
+            // The SQL to add the `allow_comments` field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD auto_close TINYINT(1)  DEFAULT "1" NOT NULL AFTER allow_comments';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the `allow_comments` field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD INDEX auto_close (auto_close)';
+            $this->db->executeSql( $sql );
+
+        }
+
+    }
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -283,6 +283,10 @@
 $GLOBALS['t']['err_item_body'] = 'Item body is required';
 $GLOBALS['t']['gallery'] = 'Photos';
 $GLOBALS['t']['allow_comments'] = 'Allow comments';
+$GLOBALS['t']['auto_close_item'] = 'Automatically close item ';
+if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
+    $GLOBALS['t']['auto_close_item'] .= 'after ' . YDConfig::get( 'auto_close_items', '' ) . ' days';
+}
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'No images yet';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -282,6 +282,10 @@
 $GLOBALS['t']['err_item_body'] = 'Le corps de l\'entr&eacute;e est requis';
 $GLOBALS['t']['gallery'] = 'Photos';
 $GLOBALS['t']['allow_comments'] = 'Autoriser les commentaires';
+$GLOBALS['t']['auto_close_item'] = 'Fermez l\'entr&eacute;e automatiquement ';
+if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
+    $GLOBALS['t']['auto_close_item'] .= 'apr&egrave;s ' . YDConfig::get( 'auto_close_items', '' ) . ' jours';
+}
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -283,6 +283,10 @@
 $GLOBALS['t']['err_item_body'] = 'Item inhoud is vereist';
 $GLOBALS['t']['gallery'] = 'Foto\'s';
 $GLOBALS['t']['allow_comments'] = 'Laat commentaren toe';
+$GLOBALS['t']['auto_close_item'] = 'Sluit item automatisch '
+if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
+    $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
+}
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-14 20:21:10 UTC (rev 1683)
@@ -48,7 +48,8 @@
             $form->addElement( 'select',          'category_id',    t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
             $form->addElement( 'datetimeselect',  'created',        t('created_on'),       array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );
-            $form->addElement( 'checkbox',        'allow_comments', t( 'allow_comments' ), array( 'style' => 'border: none;' ) );
+            $form->addElement( 'checkbox',        'allow_comments', t('allow_comments'),   array( 'style' => 'border: none;' ) );
+            $form->addElement( 'checkbox',        'auto_close',     t('auto_close_item'),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
             $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),               array( 'class' => 'button' ) );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 20:06:17 UTC (rev 1682)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 20:21:10 UTC (rev 1683)
@@ -157,6 +157,10 @@
                 <td class="adminRowL">{$form.allow_comments.label_html}</td> 
                 <td class="adminRowL">{$form.allow_comments.html}</td> 
             </tr>
+            <tr> 
+                <td class="adminRowL">{$form.auto_close.label_html}</td> 
+                <td class="adminRowL">{$form.auto_close.html}</td> 
+            </tr>
             <tr>
                 <td class="adminRowL" colspan="2" style="border: 0px;">{$form._cmdSubmit.html}</td>
             </tr>



From pclaerhout at berlios.de  Tue Feb 14 21:25:23 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:25:23 +0100
Subject: [ydf-devel] r1684 - YDFramework2.0/trunk/examples/weblog/include/dbupdates
Message-ID: <200602142025.k1EKPN3L002203@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:25:21 +0100 (Tue, 14 Feb 2006)
New Revision: 1684

Modified:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php
Log:
Fixed a typo in the comments.

Modified: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php	2006-02-14 20:21:10 UTC (rev 1683)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_002_AutoCloseItem.php	2006-02-14 20:25:21 UTC (rev 1684)
@@ -14,11 +14,11 @@
         // Install the update
         function update() {
 
-            // The SQL to add the `allow_comments` field to the database
+            // The SQL to add the auto_close field to the database
             $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD auto_close TINYINT(1)  DEFAULT "1" NOT NULL AFTER allow_comments';
             $this->db->executeSql( $sql );
 
-            // The SQL to add the `allow_comments` field to the database
+            // The SQL to add the auto_close field to the database
             $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD INDEX auto_close (auto_close)';
             $this->db->executeSql( $sql );
 



From pclaerhout at berlios.de  Tue Feb 14 21:47:13 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:47:13 +0100
Subject: [ydf-devel] r1685 - in YDFramework2.0/trunk/examples/weblog: . include include/dbupdates include/languages manage
Message-ID: <200602142047.k1EKlD6V028949@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:47:09 +0100 (Tue, 14 Feb 2006)
New Revision: 1685

Added:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_003_DraftItems.php
Modified:
   YDFramework2.0/trunk/examples/weblog/archive.php
   YDFramework2.0/trunk/examples/weblog/archive_gallery.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/index.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/item_gallery.php
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/manage/pages.php
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
Log:
Added support for draft to items and pages.

Feature request #1746.

Modified: YDFramework2.0/trunk/examples/weblog/archive.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/archive.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/archive.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -18,7 +18,7 @@
         function actionDefault() {
 
             // Get the weblog items
-            $items = $this->weblog->getItems();
+            $items = $this->weblog->getPublicItems();
 
             // Convert to a nested array
             $items = YDArrayUtil::convertToNested( $items, 'yearmonth' );

Modified: YDFramework2.0/trunk/examples/weblog/archive_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/archive_gallery.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/archive_gallery.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -18,7 +18,7 @@
         function actionDefault() {
 
             // Get the weblog items
-            $items = $this->weblog->getItems();
+            $items = $this->weblog->getPublicItems();
 
             // Strip out the items without images
             foreach ( $items as $key=>$item ) {

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -79,7 +79,7 @@
                 YDConfig::get( 'db_pass', '' ), YDConfig::get( 'db_host', 'localhost' )
             );
 
-            // Add any missing body_more field
+            // Add any missing items field
             $fields = $this->db->getValuesByName( 'show fields from #_items', 'field' );
             if ( ! in_array( 'body_more', $fields ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
@@ -90,8 +90,17 @@
             if ( ! in_array( 'auto_close', $fields ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
             }
+            if ( ! in_array( 'is_draft', $fields ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
+            }
 
-            // Get the list of index for the items table
+            // Add any missing pages field
+            $fields = $this->db->getValuesByName( 'show fields from #_pages', 'field' );
+            if ( ! in_array( 'is_draft', $fields ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
+            }
+
+            // Get the list of indexes for the items table
             $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
             if ( ! in_array( 'allow_comments', $indexes ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
@@ -99,7 +108,16 @@
             if ( ! in_array( 'auto_close', $indexes ) ) {
                 $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
             }
+            if ( ! in_array( 'is_draft', $indexes ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
+            }
 
+            // Get the list of indexes for the items table
+            $indexes = $this->db->getValuesByName( 'show keys from #_pages', 'key_name' );
+            if ( ! in_array( 'is_draft', $indexes ) ) {
+                $this->db->executeSql( 'ALTER TABLE #_pages ADD INDEX is_draft (is_draft)' );
+            }
+
             // Get the list of indexes
             $indexes = $this->db->getValuesByName( 'show keys from #_users', 'key_name' );
             if ( in_array( 'email', $indexes ) ) {
@@ -255,16 +273,26 @@
             return ( $result && sizeof( $result ) == 1 ) ? $result[0] : $result;
         }
 
+        // Get the non draft items
+        function getPublicItems( $limit=-1, $offset=-1, $order='created desc, title', $where='AND is_draft = 0' ) {
+            return $this->getItems( $limit, $offset, $order, $where );
+        }
+
         // Function to get the items of the weblog
         function getItems( $limit=-1, $offset=-1, $order='created desc, title', $where='' ) {
             $sql = 'SELECT i.id, i.category_id, i.title, i.body, i.body_more, i.num_comments, i.created, i.modified, '
-                 . 'i.allow_comments, i.auto_close, '
+                 . 'i.allow_comments, i.auto_close, i.is_draft, '
                  . 'c.title as category, u.email as user_email, u.name as user_name FROM #_items i, #_categories c, '
                  . '#_users u WHERE i.category_id = c.id AND i.user_id = u.id ';
             $sql = $this->_prepareQuery( $sql . $where, $order );
             return $this->_fixItems( $this->db->getRecords( $sql, $limit, $offset ) );
         }
 
+        // Get a publc item by it's ID
+        function getPublicItemByID( $item_id ) {
+            return $this->getItem( 'AND is_draft = 0 AND i.id = ' . $this->str( $item_id ) );
+        }
+
         // Get an item by it's ID
         function getItemById( $item_id ) {
             return $this->getItem( 'AND i.id = ' . $this->str( $item_id ) );
@@ -345,7 +373,7 @@
         // Get the categories
         function getCategories( $order='title' ) {
             $result = $this->_selectFromTable( '#_categories', $order );
-            $sql = $this->_prepareQuery( 'SELECT category_id, COUNT(*) AS num_items FROM #_items i GROUP BY category_id' );
+            $sql = $this->_prepareQuery( 'SELECT category_id, COUNT(*) AS num_items FROM #_items i WHERE is_draft=0 GROUP BY category_id' );
             $num_items = $this->db->getAsAssocArray( $sql, 'category_id', 'num_items' );
             foreach ( $result as $key=>$val ) {
                 if ( isset( $num_items[ $val['id'] ] ) ) {
@@ -376,7 +404,7 @@
 
         // Get the items by category
         function getItemsByCategoryId( $category_id, $limit=-1, $offset=-1, $order='created desc, title' ) {
-            return $this->getItems( $limit, $offset, $order, 'AND i.category_id = ' . $this->str( $category_id ) );
+            return $this->getItems( $limit, $offset, $order, 'AND is_draft = 0 AND i.category_id = ' . $this->str( $category_id ) );
         }
 
         // Add a category
@@ -394,19 +422,27 @@
             return $this->_deleteFromTableUsingID( '#_categories', $category_id );
         }
 
+        // Get the public pages
+        function getPublicPages( $order='title', $where=' AND is_draft=0' ) {
+            return $this->getPages( $order, $where );
+        }
+
         // Get the pages
-        function getPages( $order='title' ) {
+        function getPages( $order='title', $where='' ) {
             $sql = $this->_prepareQuery(
-                'SELECT p.id, p.title, p.body, p.created, p.modified, u.email as user_email, u.name as user_name '
+                'SELECT p.id, p.title, p.body, p.is_draft, p.created, p.modified, u.email as user_email, u.name as user_name '
               . 'FROM #_pages p, #_users u WHERE p.user_id = u.id'
             );
+            if ( ! empty( $where ) ) {
+                $sql .= ' ' . $where;
+            }
             return $this->db->getRecords( $sql );
         }
 
         // Get a page by it's ID
         function getPageByID( $page_id ) {
             $sql = $this->_prepareQuery(
-                'SELECT p.id, p.title, p.body, p.created, p.modified, u.email as user_email, u.name as user_name FROM '
+                'SELECT p.id, p.title, p.body, p.is_draft, p.created, p.modified, u.email as user_email, u.name as user_name FROM '
                 . '#_pages p, #_users u WHERE p.user_id = u.id AND p.id = ' . $this->str( $page_id )
             );
             return $this->db->getRecord( $sql );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -128,7 +128,7 @@
 
             // Standard stuff for the sidebar
             $categories = $this->weblog->getCategories();
-            $pages      = $this->weblog->getPages();
+            $pages      = $this->weblog->getPublicPages();
             $links      = $this->weblog->getLinks();
 
             // Assign them to the template

Added: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_003_DraftItems.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_003_DraftItems.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_003_DraftItems.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -0,0 +1,37 @@
+<?php
+
+    // Class definition
+    class UPD_003_DraftItems {
+
+        // Class constructor
+        function UPD_003_DraftItems( $db ) {
+
+            // Publish the database
+            $this->db = $db;
+
+        }
+
+        // Install the update
+        function update() {
+
+            // The SQL to add the is_draft field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD is_draft TINYINT(1)  DEFAULT "0" NOT NULL AFTER auto_close';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the is_draft field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'items ADD INDEX is_draft (is_draft)';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the is_draft field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'pages ADD is_draft TINYINT(1)  DEFAULT "0" NOT NULL AFTER body';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the is_draft field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'pages ADD INDEX is_draft (is_draft)';
+            $this->db->executeSql( $sql );
+
+        }
+
+    }
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -287,6 +287,7 @@
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'after ' . YDConfig::get( 'auto_close_items', '' ) . ' days';
 }
+$GLOBALS['t']['is_draft'] = 'Draft (do not publish)';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'No images yet';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -286,6 +286,7 @@
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'apr&egrave;s ' . YDConfig::get( 'auto_close_items', '' ) . ' jours';
 }
+$GLOBALS['t']['is_draft'] = 'Concept (pas publi&eacute;r)';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -287,6 +287,7 @@
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
 }
+$GLOBALS['t']['is_draft'] = 'Concept (niet publiceren)';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';

Modified: YDFramework2.0/trunk/examples/weblog/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/index.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/index.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -21,8 +21,8 @@
             }
 
             // Get the weblog items and 5 older items
-            $items     = $this->weblog->getItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
-            $old_items = $this->weblog->getItems( 5, sizeof( $items ) );
+            $items     = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
+            $old_items = $this->weblog->getPublicItems( 5, sizeof( $items ) );
 
             // Assign them to the template
             $this->tpl->assign( 'items',     $items );

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -27,7 +27,7 @@
             $id = $this->getIdFromQS();
 
             // Get the weblog details and go to the default view if none is matched
-            $item  = @ $this->weblog->getItemById( $id );
+            $item  = @ $this->weblog->getPublicItemById( $id );
             $this->redirectIfMissing( $item );
 
             // Convert the list of images to a table of 3 columns

Modified: YDFramework2.0/trunk/examples/weblog/item_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -30,7 +30,7 @@
             $item_id = substr( $id, 5, strpos( $id, '/' )-5 );
 
             // Get the weblog item
-            $item  = @ $this->weblog->getItemById( $item_id );
+            $item  = @ $this->weblog->getPublicItemById( $item_id );
             if ( ! $item ) {
                 die( 'Invalid image specified' );
             }

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-02-14 20:47:09 UTC (rev 1685)
@@ -20,9 +20,15 @@
     {$browsebar}
     {foreach from=$items item="item"}
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{$item.created|date:'%Y/%m/%d %H:%M'}</td>
-            <td class="adminRowL">{$item.user_name}</td>
-            <td class="adminRowL">{if $item.allow_comments eq '0'}[x] {/if}{$item.title}</td>
+            <td class="adminRowL">
+                {if $item.is_draft eq '1'}<i>{/if}{$item.created|date:'%Y/%m/%d %H:%M'}{if $item.is_draft eq '1'}</i>{/if}
+            </td>
+            <td class="adminRowL">
+                {if $item.is_draft eq '1'}<i>{/if}{$item.user_name}{if $item.is_draft eq '1'}</i>{/if}
+            </td>
+            <td class="adminRowL">
+                {if $item.is_draft eq '1'}<i>{/if}{if $item.allow_comments eq '0'}[x] {/if}{$item.title}{if $item.is_draft eq '1'}</i>{/if}
+            </td>
             <td class="adminRowR">
                 <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                 |

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -50,8 +50,9 @@
             $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );
             $form->addElement( 'checkbox',        'allow_comments', t('allow_comments'),   array( 'style' => 'border: none;' ) );
             $form->addElement( 'checkbox',        'auto_close',     t('auto_close_item'),  array( 'style' => 'border: none;' ) );
+            $form->addElement( 'checkbox',        'is_draft',       t('is_draft'),         array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
-            $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),               array( 'class' => 'button' ) );
+            $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),                  array( 'class' => 'button' ) );
 
             // Add the form rules
             $form->addRule( 'title',  'required', t( 'err_item_title' ) );

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-14 20:47:09 UTC (rev 1685)
@@ -67,11 +67,15 @@
         {$browsebar}
         {foreach from=$items->set item="item"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$item.created|date:'%Y/%m/%d %H:%M'}</td>
-                <td class="adminRowL">{$item.user_name}</td>
                 <td class="adminRowL">
-                    {if $item.allow_comments eq '0'}[x] {/if}{$item.title}
+                    {if $item.is_draft eq '1'}<i>{/if}{$item.created|date:'%Y/%m/%d %H:%M'}{if $item.is_draft eq '1'}</i>{/if}
                 </td>
+                <td class="adminRowL">
+                    {if $item.is_draft eq '1'}<i>{/if}{$item.user_name}{if $item.is_draft eq '1'}</i>{/if}
+                </td>
+                <td class="adminRowL">
+                    {if $item.is_draft eq '1'}<i>{/if}{if $item.allow_comments eq '0'}[x] {/if}{$item.title}{if $item.is_draft eq '1'}</i>{/if}
+                </td>
                 <td class="adminRowR">
                     <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                     |
@@ -161,6 +165,10 @@
                 <td class="adminRowL">{$form.auto_close.label_html}</td> 
                 <td class="adminRowL">{$form.auto_close.html}</td> 
             </tr>
+            <tr> 
+                <td class="adminRowL">{$form.is_draft.label_html}</td> 
+                <td class="adminRowL">{$form.is_draft.html}</td> 
+            </tr>
             <tr>
                 <td class="adminRowL" colspan="2" style="border: 0px;">{$form._cmdSubmit.html}</td>
             </tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-02-14 20:47:09 UTC (rev 1685)
@@ -17,6 +17,7 @@
             $this->form->addElement( 'text', 'title', t('page_title'), array( 'class' => 'tfM' ) );
             $this->form->addElement( 'wladmintextarea', 'body', t('page_body'), array( 'class' => 'taM' ) );
             $this->form->addElement( 'datetimeselect', 'created',     t('created_on'), array( 'class' => 'tfM' ) );
+            $this->form->addElement( 'checkbox',       'is_draft',    t('is_draft'), array( 'style' => 'border: none;' ) );
             $this->form->addElement( 'hidden', 'id' );
             $this->form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-02-14 20:25:21 UTC (rev 1684)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-02-14 20:47:09 UTC (rev 1685)
@@ -66,9 +66,15 @@
         </tr>
         {foreach from=$pages->set item="page"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$page.created|date:'%Y/%m/%d %H:%M'}</td>
-                <td class="adminRowL">{$page.user_name}</td>
-                <td class="adminRowL">{$page.title}</td>
+                <td class="adminRowL">
+                    {if $page.is_draft eq '1'}<i>{/if}{$page.created|date:'%Y/%m/%d %H:%M'}{if $page.is_draft eq '1'}</i>{/if}
+                </td>
+                <td class="adminRowL">
+                    {if $page.is_draft eq '1'}<i>{/if}{$page.user_name}{if $page.is_draft eq '1'}</i>{/if}
+                </td>
+                <td class="adminRowL">
+                    {if $page.is_draft eq '1'}<i>{/if}{$page.title}{if $page.is_draft eq '1'}</i>{/if}
+                </td>
                 <td class="adminRowR">
                     <a href="../page.php?id={$page.id}" target="_blank">{t w="view"}</a>
                     |
@@ -119,6 +125,10 @@
                     {$form.body.html}
                 </td>
             </tr>
+            <tr> 
+                <td class="adminRowL">{$form.is_draft.label_html}</td> 
+                <td class="adminRowL">{$form.is_draft.html}</td> 
+            </tr>
             <tr>
                 <td class="adminRowL">{$form.created.label_html}</td>
                 <td class="adminRowL">{$form.created.html}</td>



From pclaerhout at berlios.de  Tue Feb 14 21:56:49 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:56:49 +0100
Subject: [ydf-devel] r1686 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602142056.k1EKunM8009228@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:56:43 +0100 (Tue, 14 Feb 2006)
New Revision: 1686

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Added a missing semicolon.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:47:09 UTC (rev 1685)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-14 20:56:43 UTC (rev 1686)
@@ -283,7 +283,7 @@
 $GLOBALS['t']['err_item_body'] = 'Item inhoud is vereist';
 $GLOBALS['t']['gallery'] = 'Foto\'s';
 $GLOBALS['t']['allow_comments'] = 'Laat commentaren toe';
-$GLOBALS['t']['auto_close_item'] = 'Sluit item automatisch '
+$GLOBALS['t']['auto_close_item'] = 'Sluit item automatisch ';
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
 }



From pclaerhout at berlios.de  Tue Feb 14 21:58:35 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 14 Feb 2006 21:58:35 +0100
Subject: [ydf-devel] r1687 - in YDFramework2.0/trunk/examples/weblog: . include
Message-ID: <200602142058.k1EKwZIJ009457@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-14 21:58:35 +0100 (Tue, 14 Feb 2006)
New Revision: 1687

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/page.php
Log:
Made sure only public pages can be seen.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:56:43 UTC (rev 1686)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-14 20:58:35 UTC (rev 1687)
@@ -423,7 +423,7 @@
         }
 
         // Get the public pages
-        function getPublicPages( $order='title', $where=' AND is_draft=0' ) {
+        function getPublicPages( $order='title', $where=' AND p.is_draft=0' ) {
             return $this->getPages( $order, $where );
         }
 
@@ -439,12 +439,20 @@
             return $this->db->getRecords( $sql );
         }
 
+        // Get a public page by it's ID
+        function getPublicPageByID( $page_id, $where=' AND p.is_draft=0' ) {
+            return $this->getPageByID( $page_id, $where );
+        }
+
         // Get a page by it's ID
-        function getPageByID( $page_id ) {
+        function getPageByID( $page_id, $where='' ) {
             $sql = $this->_prepareQuery(
                 'SELECT p.id, p.title, p.body, p.is_draft, p.created, p.modified, u.email as user_email, u.name as user_name FROM '
                 . '#_pages p, #_users u WHERE p.user_id = u.id AND p.id = ' . $this->str( $page_id )
             );
+            if ( ! empty( $where ) ) {
+                $sql .= ' ' . $where;
+            }
             return $this->db->getRecord( $sql );
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/page.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/page.php	2006-02-14 20:56:43 UTC (rev 1686)
+++ YDFramework2.0/trunk/examples/weblog/page.php	2006-02-14 20:58:35 UTC (rev 1687)
@@ -18,7 +18,7 @@
             $id = $this->getIdFromQS();
 
             // Get the page details
-            $page  = $this->weblog->getPageById( $id );
+            $page  = $this->weblog->getPublicPageById( $id );
             $this->redirectIfMissing( $page );
 
             // Add them to the template



From ydfpoi at gmail.com  Wed Feb 15 12:58:47 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Wed, 15 Feb 2006 12:58:47 +0100
Subject: [ydf-devel] Some typos in weblog french language file
Message-ID: <306340e00602150358x2a937b0es@mail.gmail.com>

Hi Pieter,

I do appreciate the character encoding change for Weblog application!
Other new features are very nice too.
Thanks.

By the way, 4 typos have appeared in the file
weblog/include/languages/language_fr.php:

Line 48:
change "Galleries" to "Galeries"

Line 164:
change "jour" to "jours"

Line 285:
change "Fermez" to "Fermer"

Line 289:
change "publi&eacute;r" to "publi&eacute;"
(and if i can make a suggestion i find "non publi?" better than "pas publi?")

Kind regards
--
po?


From pclaerhout at berlios.de  Wed Feb 15 15:22:36 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 15 Feb 2006 15:22:36 +0100
Subject: [ydf-devel] r1688 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602151422.k1FEMagZ025907@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-15 15:22:32 +0100 (Wed, 15 Feb 2006)
New Revision: 1688

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
Log:
Fixed wrong translations in the french language file for the weblog application.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-14 20:58:35 UTC (rev 1687)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-15 14:22:32 UTC (rev 1688)
@@ -45,7 +45,7 @@
 $GLOBALS['t']['pages'] = 'Pages';
 $GLOBALS['t']['page'] = 'Page';
 $GLOBALS['t']['archives'] = 'Archives';
-$GLOBALS['t']['archives_gallery'] = 'Galleries photo';
+$GLOBALS['t']['archives_gallery'] = 'Galeries photo';
 $GLOBALS['t']['categories'] = 'Cat&eacute;gories';
 $GLOBALS['t']['view_posts_filed_under'] = 'Voir tous les sujets class&eacute;s sous';
 $GLOBALS['t']['links'] = 'Liens';
@@ -161,7 +161,7 @@
 // manage/stats.tpl
 $GLOBALS['t']['general_stats'] = 'Statistiques g&eacute;n&eacute;rales';
 $GLOBALS['t']['installed_since'] = 'Install&eacute; depuis le';
-$GLOBALS['t']['num_days_online'] = 'Nombre de jour en ligne';
+$GLOBALS['t']['num_days_online'] = 'Nombre de jours en ligne';
 $GLOBALS['t']['days'] = 'jour(s)';
 $GLOBALS['t']['hits'] = 'hit(s)';
 $GLOBALS['t']['total_hits'] = 'Nombre total de hits';
@@ -282,11 +282,11 @@
 $GLOBALS['t']['err_item_body'] = 'Le corps de l\'entr&eacute;e est requis';
 $GLOBALS['t']['gallery'] = 'Photos';
 $GLOBALS['t']['allow_comments'] = 'Autoriser les commentaires';
-$GLOBALS['t']['auto_close_item'] = 'Fermez l\'entr&eacute;e automatiquement ';
+$GLOBALS['t']['auto_close_item'] = 'Fermer l\'entr&eacute;e automatiquement ';
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'apr&egrave;s ' . YDConfig::get( 'auto_close_items', '' ) . ' jours';
 }
-$GLOBALS['t']['is_draft'] = 'Concept (pas publi&eacute;r)';
+$GLOBALS['t']['is_draft'] = 'Concept (non publi&eacute;)';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';



From pieter at yellowduck.be  Wed Feb 15 15:22:51 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 15 Feb 2006 15:22:51 +0100
Subject: [ydf-devel] Some typos in weblog french language file
In-Reply-To: <306340e00602150358x2a937b0es@mail.gmail.com>
References: <306340e00602150358x2a937b0es@mail.gmail.com>
Message-ID: <4aef63030602150622o3f01fb80if595938adaaa36d0@mail.gmail.com>

Fixed in build 1688.

pieter

On 2/15/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter,
>
> I do appreciate the character encoding change for Weblog application!
> Other new features are very nice too.
> Thanks.
>
> By the way, 4 typos have appeared in the file
> weblog/include/languages/language_fr.php:
>
> Line 48:
> change "Galleries" to "Galeries"
>
> Line 164:
> change "jour" to "jours"
>
> Line 285:
> change "Fermez" to "Fermer"
>
> Line 289:
> change "publi&eacute;r" to "publi&eacute;"
> (and if i can make a suggestion i find "non publi?" better than "pas
> publi?")
>
> Kind regards
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060215/c1efc14b/attachment.html>

From ydfpoi at gmail.com  Wed Feb 15 16:07:49 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Wed, 15 Feb 2006 16:07:49 +0100
Subject: [ydf-devel] Some typos in weblog french language file
In-Reply-To: <4aef63030602150622o3f01fb80if595938adaaa36d0@mail.gmail.com>
References: <306340e00602150358x2a937b0es@mail.gmail.com>
	 <4aef63030602150622o3f01fb80if595938adaaa36d0@mail.gmail.com>
Message-ID: <306340e00602150707m55ec2884g@mail.gmail.com>

Sorry to bother every body with successive and contradictory posts but
i didn't read the english version prior to my first post (shame on
me!).

Imho there is even a better translation for "Draft (do not publish)"
in file weblog/include/languages/language_fr.php line 289.
It is "Brouillon (ne pas publier)".

I am really sorry.
Kind regards

2006/2/15, Pieter Claerhout <pieter at yellowduck.be>:
> Fixed in build 1688.
>
> pieter
>
> On 2/15/06, ydf poi <ydfpoi at gmail.com> wrote:
> >
> > [...]
> > By the way, 4 typos have appeared in the file
> > weblog/include/languages/language_fr.php:
> > [...]
> > Line 289:
> > change "publi&eacute;r" to "publi&eacute;"
> > (and if i can make a suggestion i find "non publi?" better than "pas
> publi?")
> >

--
po?


From pieter at yellowduck.be  Wed Feb 15 17:01:27 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 15 Feb 2006 17:01:27 +0100
Subject: [ydf-devel] Some typos in weblog french language file
In-Reply-To: <306340e00602150707m55ec2884g@mail.gmail.com>
References: <306340e00602150358x2a937b0es@mail.gmail.com>
	 <4aef63030602150622o3f01fb80if595938adaaa36d0@mail.gmail.com>
	 <306340e00602150707m55ec2884g@mail.gmail.com>
Message-ID: <4aef63030602150801g55099270ub347020654739915@mail.gmail.com>

Fixed in build 1689.

pieter

On 2/15/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Sorry to bother every body with successive and contradictory posts but
> i didn't read the english version prior to my first post (shame on
> me!).
>
> Imho there is even a better translation for "Draft (do not publish)"
> in file weblog/include/languages/language_fr.php line 289.
> It is "Brouillon (ne pas publier)".
>
> I am really sorry.
> Kind regards
>
> 2006/2/15, Pieter Claerhout <pieter at yellowduck.be>:
> > Fixed in build 1688.
> >
> > pieter
> >
> > On 2/15/06, ydf poi <ydfpoi at gmail.com> wrote:
> > >
> > > [...]
> > > By the way, 4 typos have appeared in the file
> > > weblog/include/languages/language_fr.php:
> > > [...]
> > > Line 289:
> > > change "publi&eacute;r" to "publi&eacute;"
> > > (and if i can make a suggestion i find "non publi?" better than "pas
> > publi?")
> > >
>
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060215/5a1f461e/attachment.html>

From pclaerhout at berlios.de  Wed Feb 15 17:01:16 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 15 Feb 2006 17:01:16 +0100
Subject: [ydf-devel] r1689 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602151601.k1FG1G3o007547@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-15 17:01:15 +0100 (Wed, 15 Feb 2006)
New Revision: 1689

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
Log:
Fixed another translation in the french language file for the weblog application.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-15 14:22:32 UTC (rev 1688)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-15 16:01:15 UTC (rev 1689)
@@ -286,7 +286,7 @@
 if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
     $GLOBALS['t']['auto_close_item'] .= 'apr&egrave;s ' . YDConfig::get( 'auto_close_items', '' ) . ' jours';
 }
-$GLOBALS['t']['is_draft'] = 'Concept (non publi&eacute;)';
+$GLOBALS['t']['is_draft'] = 'Brouillon (ne pas publier)';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';



From david_db at berlios.de  Fri Feb 17 06:13:32 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 17 Feb 2006 06:13:32 +0100
Subject: [ydf-devel] r1690 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602170513.k1H5DW2p012334@sheep.berlios.de>

Author: david_db
Date: 2006-02-17 06:13:25 +0100 (Fri, 17 Feb 2006)
New Revision: 1690

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed YDDatabaseObject::getResults to check if there are results in a relation object before retrieving them.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-15 16:01:15 UTC (rev 1689)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-17 05:13:25 UTC (rev 1690)
@@ -831,6 +831,11 @@
                 foreach ( $relations_arr as $name => $relation ) {
                     
                     $res = $relation->_results[ $k ];
+                    
+                    if ( ! sizeof( $res ) ) {
+                        continue;
+                    }
+                    
                     $protected = $relation->_getFieldsByMethod( 'isProtected' );
 
                     foreach ( $protected as $field ) {
@@ -878,6 +883,10 @@
             
                     }
                     
+                    if ( ! sizeof( $res ) ) {
+                        continue;
+                    }
+                    
                     $pfx = '';
                     if ( $prefix ) {
                         $pfx = $name . '_';
@@ -909,7 +918,7 @@
                         }
                         
                     }
-                    
+
                     $result = array_merge( $result, $res );
                     
                 }



From david_db at berlios.de  Fri Feb 17 13:03:24 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Fri, 17 Feb 2006 13:03:24 +0100
Subject: [ydf-devel] r1691 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602171203.k1HC3O3D000540@sheep.berlios.de>

Author: david_db
Date: 2006-02-17 13:02:41 +0100 (Fri, 17 Feb 2006)
New Revision: 1691

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added config variable YD_DBOBJ_EXECUTE to YDDatabaseObject. If defined to false, find(), update(), delete() and insert() will retrieve the SQL query without executing it.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-17 05:13:25 UTC (rev 1690)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-17 12:02:41 UTC (rev 1691)
@@ -67,6 +67,12 @@
      */
     YDConfig::set( 'YD_DBOBJECT_UPDATE', false, false );
 
+    /**
+     *  This config defines if an action should be executed or not.
+     *  Default: true.
+     */
+    YDConfig::set( 'YD_DBOBJECT_EXECUTE', true, false );
+    
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
     include_once( YD_DIR_HOME_ADD . '/YDDatabaseQuery/YDDatabaseQuery.php' );
@@ -1004,6 +1010,10 @@
 
             YDDebugUtil::debug( YDStringUtil::removeWhiteSpace( $sql ) );
             
+            if ( ! YDConfig::get( 'YD_DBOBJECT_EXECUTE' ) ) {
+                return $sql;
+            }
+            
             $result = $this->_db->executeSql( $sql );
             $success = ( $result == -1 || $result === false ) ? false : true;
             
@@ -1063,6 +1073,10 @@
 
             YDDebugUtil::debug( YDStringUtil::removeWhiteSpace( $sql ) );
             
+            if ( ! YDConfig::get( 'YD_DBOBJECT_EXECUTE' ) ) {
+                return $sql;
+            }
+            
             $result = $this->_db->executeSql( $sql );
             $success = ( $result == -1 || $result === false ) ? false : true;
             
@@ -1101,6 +1115,10 @@
             
             YDDebugUtil::debug( YDStringUtil::removeWhiteSpace( $sql ) );
             
+            if ( ! YDConfig::get( 'YD_DBOBJECT_EXECUTE' ) ) {
+                return $sql;
+            }
+            
             $result = $this->_db->executeSql( $sql );
             $success = ( $result == -1 || $result === false ) ? false : true;
 
@@ -1321,6 +1339,10 @@
                                 The SELECT statement is empty', YD_ERROR );
             }
             
+            if ( ! YDConfig::get( 'YD_DBOBJECT_EXECUTE' ) ) {
+                return $this->_query->getQuery();
+            }
+            
             $result = $this->findSql( $this->_query->getQuery(), $slices );
             $success = ( $result == -1 || $result === false ) ? false : true;
             



From pclaerhout at berlios.de  Fri Feb 17 13:24:10 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 17 Feb 2006 13:24:10 +0100
Subject: [ydf-devel] r1692 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602171224.k1HCOAdT009850@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-17 13:24:05 +0100 (Fri, 17 Feb 2006)
New Revision: 1692

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
The installer of the weblog application now correctly sets the permissions for the config file.

Bug #6436

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-17 12:02:41 UTC (rev 1691)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-17 12:24:05 UTC (rev 1692)
@@ -61,6 +61,9 @@
         fwrite( $f, $cfg );
         fclose( $f );
 
+        // Set the right permissions
+        @chmod( dirname( __FILE__ ) . '/config.php', 0700 );
+
     }
 
     // Class defining our weblog API



From pclaerhout at berlios.de  Fri Feb 17 13:31:25 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 17 Feb 2006 13:31:25 +0100
Subject: [ydf-devel] r1693 - YDFramework2.0/trunk/doc_src
Message-ID: <200602171231.k1HCVPpB014311@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-17 13:31:23 +0100 (Fri, 17 Feb 2006)
New Revision: 1693

Modified:
   YDFramework2.0/trunk/doc_src/appendixD.xml
Log:
Added more documentation about make_release.bat.

Feature Request #1773

Modified: YDFramework2.0/trunk/doc_src/appendixD.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/appendixD.xml	2006-02-17 12:24:05 UTC (rev 1692)
+++ YDFramework2.0/trunk/doc_src/appendixD.xml	2006-02-17 12:31:23 UTC (rev 1693)
@@ -42,10 +42,41 @@
 
         <title>Making a new release archive</title>
 
-        <para>When we put a new released version online, we make a .tar.gz copy of that build.</para>
+        <para>When we put a new released version online, we make a .tar.gz copy of that build which goes along with the compiled documentation and API documentation.</para>
 
-        <para>For more info on how to create that, please contact Pieter Claerhout.</para>
+        <para>In the SVN repository, there is a batch script that automates this, but it has some external requirements.</para>
 
+        <sect2 id="appendixD_release_archive_prereqs">
+
+            <title>Prerequisites</title>
+
+            <para>You need the following software before you can run "make_release.bat".</para>
+
+            <itemizedlist spacing="compact">
+                <listitem>Doxygen</listitem>
+                <listitem>xsltproc</listitem>
+                <listitem>fop</listitem>
+                <listitem>cscript</listitem>
+                <listitem>tar</listitem>
+                <listitem>gzip</listitem>
+                <listitem>sed</listitem>
+            </itemizedlist>
+
+        </sect2>
+
+        <sect2 id="appendixD_release_archive_running">
+
+            <title>Running</title>
+
+            <para>You can run the application as follows:</para>
+
+            <programlisting><![CDATA[C:\>make_release.bat --release 2.0.0-final
+C:\>make_release.bat --snapshot 1202]]></programlisting>
+
+            <para>The release option will export from the "tags" branch, while the snapshot option will export the specified revision from the trunk branch.</para>
+
+        </sect2>
+
     </sect1>
 
 </appendix>



From david_db at berlios.de  Sat Feb 18 12:44:22 2006
From: david_db at berlios.de (david_db at berlios.de)
Date: Sat, 18 Feb 2006 12:44:22 +0100
Subject: [ydf-devel] r1694 - YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200602181144.k1IBiM90031535@sheep.berlios.de>

Author: david_db
Date: 2006-02-18 12:44:13 +0100 (Sat, 18 Feb 2006)
New Revision: 1694

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Removed YDDatabaseObject protection that checks the relations keys and foreign keys so you can use another relations keys to do your queries.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-17 12:31:23 UTC (rev 1693)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-02-18 11:44:13 UTC (rev 1694)
@@ -1194,8 +1194,8 @@
                     $l_key = $l_key->name;
                 }
                 
-                if ( ! $l_column = $this->getColumn( $l_key ) ) {
-                    trigger_error( 'Invalid local key "' . $l_key . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
+                if ( ! $l_column = $this->getColumn( $l_key, true ) ) {
+                    $l_column = $l_key;
                 }
 
                 // Foreign table
@@ -1218,8 +1218,8 @@
                     $f_key = $f_key->name;
                 }
                 
-                if ( ! $f_column = $this->$f_var->getColumn( $f_key ) ) {
-                    trigger_error( 'Invalid foreign key "' . $f_key . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
+                if ( ! $f_column = $this->$f_var->getColumn( $f_key, true ) ) {
+                    $f_column = $f_key;
                 }
                 
                 // Prepare the query in the foreign object
@@ -1237,8 +1237,9 @@
 
                     // Join foreign table
                     $this->_query->join( $rel->getForeignJoin(), $f_table, $f_alias );
-                    $this->_query->on( $r . $l_alias . $r . '.' . $r . $l_column . $r . ' = ' .
-                                       $r . $f_alias . $r . '.' . $r . $f_column . $r );
+                    //$this->_query->on( $r . $l_alias . $r . '.' . $r . $l_column . $r . ' = ' .
+                    //                   $r . $f_alias . $r . '.' . $r . $f_column . $r );
+                    $this->_query->on( $l_column . ' = ' . $f_column );
 
                 } else {
 
@@ -1271,13 +1272,13 @@
                     }
                     
                     // Cross foreign field column name
-                    if ( ! $c_fcolumn = $this->$c_var->getColumn( $c_fkey ) ) {
-                        trigger_error( 'Invalid cross foreign key "' . $c_fkey . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
+                    if ( ! $c_fcolumn = $this->$c_var->getColumn( $c_fkey, true ) ) {
+                        $c_fcolumn = $c_fkey;
                     }
                     
                     // Cross local field column name
-                    if ( ! $c_lcolumn = $this->$c_var->getColumn( $c_lkey ) ) {
-                        trigger_error( 'Invalid cross local key "' . $c_lkey . '" - relation "' . $relation . '" - class "' . get_class( $this ) . '"', YD_ERROR );
+                    if ( ! $c_lcolumn = $this->$c_var->getColumn( $c_lkey, true ) ) {
+                        $c_lcolumn = $c_lkey;
                     }
 
                     // Prepare the query in the cross object
@@ -1292,9 +1293,10 @@
 
                     // Join cross table
                     $this->_query->join( $rel->getCrossJoin(), $c_table, $c_alias );
-                    $this->_query->on( $r . $l_alias . $r . '.' . $r . $l_column  . $r . ' = ' .
-                                       $r . $c_alias . $r . '.' . $r . $c_lcolumn . $r );
-
+                    //$this->_query->on( $r . $l_alias . $r . '.' . $r . $l_column  . $r . ' = ' .
+                    //                   $r . $c_alias . $r . '.' . $r . $c_lcolumn . $r );
+                    $this->_query->on( $l_column . ' = ' . $c_lcolumn );
+                    
                     // Cross table additional conditions
                     if ( $where = $rel->getCrossConditions() ) {
                         $this->_query->on( $where );
@@ -1305,9 +1307,10 @@
 
                     // Join foreign table
                     $this->_query->join( $rel->getForeignJoin(), $f_table, $f_alias );
-                    $this->_query->on( $r . $c_alias . $r . '.' . $r . $c_fcolumn . $r . ' = ' .
-                                       $r . $f_alias . $r . '.' . $r . $f_column  . $r );
-
+                    //$this->_query->on( $r . $c_alias . $r . '.' . $r . $c_fcolumn . $r . ' = ' .
+                    //                   $r . $f_alias . $r . '.' . $r . $f_column  . $r );
+                    $this->_query->on( $c_fcolumn . ' = ' . $f_column );
+                    
                 }
 
                 // Foreign table additional conditions



From pclaerhout at berlios.de  Sat Feb 18 16:28:43 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sat, 18 Feb 2006 16:28:43 +0100
Subject: [ydf-devel] r1695 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602181528.k1IFShSP016298@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-18 16:28:42 +0100 (Sat, 18 Feb 2006)
New Revision: 1695

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Fixed the way the filenaming and compile_id values were generated for templates.

Bug #6454

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-18 11:44:13 UTC (rev 1694)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-18 15:28:42 UTC (rev 1695)
@@ -137,13 +137,24 @@
                 // Get the template name
                 $tplName = $this->_getTemplateName( $file );
 
+                // Get the real path to the template file
+                $tplPath = $tplName;
+                if ( ! is_file( $tplPath ) ) {
+                    $tplPath = realpath( $this->template_dir . '/' . $tplName );
+                } else {
+                    $tplPath = realpath( $tplName );
+                }
+
                 // Add pseudo compile id
                 if ( is_null( $compile_id ) ) {
-                    $compile_id = sprintf( '%u', crc32( realpath( $this->template_dir ) . '/' . $tplName ) );
+
+                    // Generate the compile ID
+                    $compile_id = sprintf( '%u', crc32( $tplPath ) );
+
                 }
 
                 // Output the template
-                $result = parent::fetch( $tplName, $cache_id, $compile_id );
+                $result = parent::fetch( $tplPath, $cache_id, $compile_id );
 
                 // Display the template or return the result
                 if ( $display == true ) {



From pclaerhout at berlios.de  Sat Feb 18 16:43:43 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sat, 18 Feb 2006 16:43:43 +0100
Subject: [ydf-devel] r1696 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602181543.k1IFhhg6018462@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-18 16:43:42 +0100 (Sat, 18 Feb 2006)
New Revision: 1696

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Removed trackbacks from the default skin.

Bug #6437

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-18 15:28:42 UTC (rev 1695)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-18 15:43:42 UTC (rev 1696)
@@ -31,8 +31,6 @@
                 <small>
                     {t w="posted_under"} {$item.created|date|lower} {t w="by"} <a href="mailto:{$item.user_email|escape:'hexentity'}">{$item.user_name}</a>
                     {t w="filed_under"} <a href="{$item.category_id|link_category}">{$item.category}</a>.
-                    {t w="can_leave_comment"}, {t w="or"}
-                    <a href="{$item|@link_item}">{t w="trackback"}</a> {t w="from_your_site"}
                     <br/>
                     {if $user.name}
                         <a href="manage/items.php?do=edit&id={$item.id}" target="_blank">{t w="edit"}</a>



From pclaerhout at berlios.de  Sat Feb 18 16:46:07 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Sat, 18 Feb 2006 16:46:07 +0100
Subject: [ydf-devel] r1697 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602181546.k1IFk7QK018706@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-18 16:46:07 +0100 (Sat, 18 Feb 2006)
New Revision: 1697

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
Log:
Fixed a small HTML issue in the item.tpl template for the default skin.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-18 15:43:42 UTC (rev 1696)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-02-18 15:46:07 UTC (rev 1697)
@@ -31,8 +31,8 @@
                 <small>
                     {t w="posted_under"} {$item.created|date|lower} {t w="by"} <a href="mailto:{$item.user_email|escape:'hexentity'}">{$item.user_name}</a>
                     {t w="filed_under"} <a href="{$item.category_id|link_category}">{$item.category}</a>.
-                    <br/>
                     {if $user.name}
+                        <br/>
                         <a href="manage/items.php?do=edit&id={$item.id}" target="_blank">{t w="edit"}</a>
                         | <a href="manage/items.php?do=delete&id={$item.id}"
                              onClick="return YDConfirmDelete( '{$item.title|addslashes}' );">{t w="delete"}</a>



From francisco at fusemail.com  Sat Feb 18 23:20:48 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sat, 18 Feb 2006 22:20:48 +0000
Subject: [ydf-devel] YDDatabaseObject indirect relations
Message-ID: <43F79DC0.6080900@fusemail.com>

Hi

Imagine this "strange" example: I have an db scheme that have 3 tables: 
Cars, People, Phones.
Table Cars has:  id_car (int key), description (string), active (0 or 1)
Table People has:  id_people (int key), id_car (points to table Cars), 
name (string), beautiful (0 or 1)
Table Phones has:  id_phone (int key), id_people  (points to table 
People), description (string)

This means that: we can define phones, each phone belongs to just one 
person, each person belongs to one car and each car can be active or not.

So we have the next relations:

relation "phone" in class Phones and in class People:
* Table Phones (id_phone) <-----> Table People (id_people)

relation "car" in class People and class Cars:
* Table People (id_people) -----> Table Cars (id_car)

Now, how can we get all Phones that belong to beautiful persons that are 
in an "active" cars?

I have tryied the next solution, but YDDatabaseObject seems ignoring 
relations that are indirectly connected to Phones table:

$phone = YDDatabaseObject::getInstance( 'Phones' );

$phone->load('people');
$phone->people->beautiful = 1;
$phone->people->load('car');
$phone->people->car->active = 1;

$phone->findAll();

Is this possible or just a bug?

Francisco Azevedo


From muitocomplicado at gmail.com  Sun Feb 19 00:04:32 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Sat, 18 Feb 2006 20:04:32 -0300
Subject: [ydf-devel] YDDatabaseObject indirect relations
In-Reply-To: <43F79DC0.6080900@fusemail.com>
References: <43F79DC0.6080900@fusemail.com>
Message-ID: <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>

The class can't do this the way you are doing.

Another way is treating the people table as a cross table using a
many-to-many relation.

$rel =& $this->registerRelation( 'people_car', true, 'car', 'people' );
$rel->setLocalKey( 'id_people' );
$rel->setCrossLocalKey( 'id_people' );
$rel->setCrossForeignKey( 'id_car' );
$rel->setForeignKey( 'id_car' );
$rel->setCrossVar( 'people' );
$rel->setForeignVar( 'car' );

$phone = YDDatabaseObject::getInstance( 'Phones' );

$phone->load( 'people_car' );
$phone->people->beautiful = 1;
$phone->car->active = 1;

$phone->find( 'people_car' );

The structure in the object isn't exactly the structure described, but does
the trick.

-db


On 2/18/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi
>
> Imagine this "strange" example: I have an db scheme that have 3 tables:
> Cars, People, Phones.
> Table Cars has:  id_car (int key), description (string), active (0 or 1)
> Table People has:  id_people (int key), id_car (points to table Cars),
> name (string), beautiful (0 or 1)
> Table Phones has:  id_phone (int key), id_people  (points to table
> People), description (string)
>
> This means that: we can define phones, each phone belongs to just one
> person, each person belongs to one car and each car can be active or not.
>
> So we have the next relations:
>
> relation "phone" in class Phones and in class People:
> * Table Phones (id_phone) <-----> Table People (id_people)
>
> relation "car" in class People and class Cars:
> * Table People (id_people) -----> Table Cars (id_car)
>
> Now, how can we get all Phones that belong to beautiful persons that are
> in an "active" cars?
>
> I have tryied the next solution, but YDDatabaseObject seems ignoring
> relations that are indirectly connected to Phones table:
>
> $phone = YDDatabaseObject::getInstance( 'Phones' );
>
> $phone->load('people');
> $phone->people->beautiful = 1;
> $phone->people->load('car');
> $phone->people->car->active = 1;
>
> $phone->findAll();
>
> Is this possible or just a bug?
>
> Francisco Azevedo
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060218/c2ae4f64/attachment.html>

From francisco at fusemail.com  Sun Feb 19 00:28:23 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sat, 18 Feb 2006 23:28:23 +0000
Subject: [ydf-devel] YDDatabaseObject indirect relations
In-Reply-To: <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>
References: <43F79DC0.6080900@fusemail.com> <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>
Message-ID: <43F7AD97.4050002@fusemail.com>

> Another way is treating the people table as a cross table using a 
> many-to-many relation.
> 
> $rel =& $this->registerRelation( 'people_car', true, 'car', 'people' );
> $rel->setLocalKey( 'id_people' );
> $rel->setCrossLocalKey( 'id_people' );
> $rel->setCrossForeignKey( 'id_car' );
> $rel->setForeignKey( 'id_car' );
> $rel->setCrossVar( 'people' );
> $rel->setForeignVar( 'car' );

Yes, but many-to-many is not an option. It works in this example but i 
have db schemes much more complex with more than 6 tables.

If findAll cannot find indirect relations it's not possible to handle 
this. Imagine that, if you define that a class has a column (eg: 
'active') that must be 1 to be selected.. any table that it's not 
directly related with this table will ignore those values and select 
everything.

So, with current way, it's not possible to use relations that are 
defined with a class that it's related with current class and many to 
many cannot be used always.

Is there any way to make findAll check relations that are loaded?

> 
> $phone = YDDatabaseObject::getInstance( 'Phones' );
> 
> $phone->load( 'people_car' );
> $phone->people->beautiful = 1;
> $phone->car->active = 1;
> 
> $phone->find( 'people_car' );
> 
> The structure in the object isn't exactly the structure described, but 
> does the trick.
> 
> -db
> 
> 
> On 2/18/06, *Francisco Azevedo* < francisco at fusemail.com 
> <mailto:francisco at fusemail.com>> wrote:
> 
>     Hi
> 
>     Imagine this "strange" example: I have an db scheme that have 3 tables:
>     Cars, People, Phones.
>     Table Cars has:  id_car (int key), description (string), active (0 or 1)
>     Table People has:  id_people (int key), id_car (points to table Cars),
>     name (string), beautiful (0 or 1)
>     Table Phones has:  id_phone (int key), id_people  (points to table
>     People), description (string)
> 
>     This means that: we can define phones, each phone belongs to just one
>     person, each person belongs to one car and each car can be active or
>     not.
> 
>     So we have the next relations:
> 
>     relation "phone" in class Phones and in class People:
>     * Table Phones (id_phone) <-----> Table People (id_people)
> 
>     relation "car" in class People and class Cars:
>     * Table People (id_people) -----> Table Cars (id_car)
> 
>     Now, how can we get all Phones that belong to beautiful persons that are
>     in an "active" cars?
> 
>     I have tryied the next solution, but YDDatabaseObject seems ignoring
>     relations that are indirectly connected to Phones table:
> 
>     $phone = YDDatabaseObject::getInstance( 'Phones' );
> 
>     $phone->load('people');
>     $phone->people->beautiful = 1;
>     $phone->people->load('car');
>     $phone->people->car->active = 1;
> 
>     $phone->findAll();
> 
>     Is this possible or just a bug?
> 
>     Francisco Azevedo
>  


From muitocomplicado at gmail.com  Sun Feb 19 02:16:38 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Sat, 18 Feb 2006 22:16:38 -0300
Subject: [ydf-devel] YDDatabaseObject indirect relations
In-Reply-To: <43F7AD97.4050002@fusemail.com>
References: <43F79DC0.6080900@fusemail.com>
	 <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>
	 <43F7AD97.4050002@fusemail.com>
Message-ID: <12260be20602181716r6c8c39ccj4c636ab91e4b0a4@mail.gmail.com>

Maybe my last commit yesterday can help you. You can do this now:

// phones class

$rel =& $this->registerRelation( 'people', false, 'people' );
$rel->setLocalKey( 'id_people' );
$rel->setForeignKey( 'id_people' );
$rel->setForeignVar( 'people' );

$rel =& $this->registerRelation( 'car', false, 'car' );
$rel->setLocalKey( 'people.id_car' ); // note: this is not a field from
phones class but from people relation
$rel->setForeignKey( 'id_car' );
$rel->setForeignVar( 'car' );
$rel->setForeignConditions( 'people.active = car.active' ); // more
conditions with other relations

$rel =& $this->registerRelation( 'garage', false, 'garage' );
$rel->setLocalKey( 'car.id_garage' );
$rel->setForeignKey( 'id_garage' );
$rel->setForeignVar( 'garage' );

// making the query

$phone = YDDatabaseObject::getInstance( 'phones' );

$phone->load( 'people', 'car', 'garage' );
$phone->people->beautiful = 1;
$phone->car->active = 1;
$phone->garage->where( 'garage.size > 10' );

$phone->find( 'people', 'car', 'garage' );

I think this can help you.

-db

On 2/18/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> > Another way is treating the people table as a cross table using a
> > many-to-many relation.
> >
> > $rel =& $this->registerRelation( 'people_car', true, 'car', 'people' );
> > $rel->setLocalKey( 'id_people' );
> > $rel->setCrossLocalKey( 'id_people' );
> > $rel->setCrossForeignKey( 'id_car' );
> > $rel->setForeignKey( 'id_car' );
> > $rel->setCrossVar( 'people' );
> > $rel->setForeignVar( 'car' );
>
> Yes, but many-to-many is not an option. It works in this example but i
> have db schemes much more complex with more than 6 tables.
>
> If findAll cannot find indirect relations it's not possible to handle
> this. Imagine that, if you define that a class has a column (eg:
> 'active') that must be 1 to be selected.. any table that it's not
> directly related with this table will ignore those values and select
> everything.
>
> So, with current way, it's not possible to use relations that are
> defined with a class that it's related with current class and many to
> many cannot be used always.
>
> Is there any way to make findAll check relations that are loaded?
>
> >
> > $phone = YDDatabaseObject::getInstance( 'Phones' );
> >
> > $phone->load( 'people_car' );
> > $phone->people->beautiful = 1;
> > $phone->car->active = 1;
> >
> > $phone->find( 'people_car' );
> >
> > The structure in the object isn't exactly the structure described, but
> > does the trick.
> >
> > -db
> >
> >
> > On 2/18/06, *Francisco Azevedo* < francisco at fusemail.com
> > <mailto:francisco at fusemail.com>> wrote:
> >
> >     Hi
> >
> >     Imagine this "strange" example: I have an db scheme that have 3
> tables:
> >     Cars, People, Phones.
> >     Table Cars has:  id_car (int key), description (string), active (0
> or 1)
> >     Table People has:  id_people (int key), id_car (points to table
> Cars),
> >     name (string), beautiful (0 or 1)
> >     Table Phones has:  id_phone (int key), id_people  (points to table
> >     People), description (string)
> >
> >     This means that: we can define phones, each phone belongs to just
> one
> >     person, each person belongs to one car and each car can be active or
> >     not.
> >
> >     So we have the next relations:
> >
> >     relation "phone" in class Phones and in class People:
> >     * Table Phones (id_phone) <-----> Table People (id_people)
> >
> >     relation "car" in class People and class Cars:
> >     * Table People (id_people) -----> Table Cars (id_car)
> >
> >     Now, how can we get all Phones that belong to beautiful persons that
> are
> >     in an "active" cars?
> >
> >     I have tryied the next solution, but YDDatabaseObject seems ignoring
> >     relations that are indirectly connected to Phones table:
> >
> >     $phone = YDDatabaseObject::getInstance( 'Phones' );
> >
> >     $phone->load('people');
> >     $phone->people->beautiful = 1;
> >     $phone->people->load('car');
> >     $phone->people->car->active = 1;
> >
> >     $phone->findAll();
> >
> >     Is this possible or just a bug?
> >
> >     Francisco Azevedo
> >
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060218/69805621/attachment.html>

From francisco at fusemail.com  Sun Feb 19 17:17:46 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 19 Feb 2006 16:17:46 +0000
Subject: [ydf-devel] YDDatabaseObject indirect relations
In-Reply-To: <12260be20602181716r6c8c39ccj4c636ab91e4b0a4@mail.gmail.com>
References: <43F79DC0.6080900@fusemail.com>	 <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>	 <43F7AD97.4050002@fusemail.com> <12260be20602181716r6c8c39ccj4c636ab91e4b0a4@mail.gmail.com>
Message-ID: <43F89A2A.4050809@fusemail.com>

> Maybe my last commit yesterday can help you. You can do this now:
> 
> // phones class
> 
> $rel =& $this->registerRelation( 'people', false, 'people' );
> $rel->setLocalKey( 'id_people' );
> $rel->setForeignKey( 'id_people' );
> $rel->setForeignVar( 'people' );
> 
> $rel =& $this->registerRelation( 'car', false, 'car' );
> $rel->setLocalKey( 'people.id_car' ); // note: this is not a field from 
> phones class but from people relation
> $rel->setForeignKey( 'id_car' );
> $rel->setForeignVar( 'car' );
> $rel->setForeignConditions( 'people.active = car.active' ); // more 
> conditions with other relations

Db, sorry but this is a ugly solution. I have defined all relations and 
the internal state of all classes. The problem is on find() and 
findAll(). These methods don't care about loaded classes. Imho, find() 
should search all arguments and find inside each if they are defined.
In this case:
$phone->find('people','car');
find would:
- get relations to 'people' and 'car' inside 'phone' class.
// would find 1 relation
- get relations to 'car' and 'phone' inside 'people' class.
// would find 2 relations
- get relations to 'phone' and 'people' inside 'car' class.
// would find 1 relation

.. and then make the query.

This has one more BIG advantage. All the internal states of the classes 
will be used. If you define inside 'cars':
$this->registerProtected( 'active', 1 )
The $phone::find() will use it and we don't need to define it _again_.

Imagine that, if we have 10 tables that are indirectly related to 'cars' 
we don't need to create _another_ 10 relations and in _each_ find the 
internal state of cars.


> 
> $rel =& $this->registerRelation( 'garage', false, 'garage' );
> $rel->setLocalKey( 'car.id_garage' );
> $rel->setForeignKey( 'id_garage' );
> $rel->setForeignVar( 'garage' );
> 
> // making the query
> 
> $phone = YDDatabaseObject::getInstance( 'phones' );
> 
> $phone->load( 'people', 'car', 'garage' );
> $phone->people->beautiful = 1;
> $phone->car->active = 1;
> $phone->garage->where( 'garage.size > 10' );
> 
> $phone->find( 'people', 'car', 'garage' );
> 
> I think this can help you.
> 
> -db
> 
> On 2/18/06, *Francisco Azevedo* <francisco at fusemail.com 
> <mailto:francisco at fusemail.com>> wrote:
> 
> 
>      > Another way is treating the people table as a cross table using a
>      > many-to-many relation.
>      >
>      > $rel =& $this->registerRelation( 'people_car', true, 'car',
>     'people' );
>      > $rel->setLocalKey( 'id_people' );
>      > $rel->setCrossLocalKey( 'id_people' );
>      > $rel->setCrossForeignKey( 'id_car' );
>      > $rel->setForeignKey( 'id_car' );
>      > $rel->setCrossVar( 'people' );
>      > $rel->setForeignVar( 'car' );
> 
>     Yes, but many-to-many is not an option. It works in this example but i
>     have db schemes much more complex with more than 6 tables.
> 
>     If findAll cannot find indirect relations it's not possible to handle
>     this. Imagine that, if you define that a class has a column (eg:
>     'active') that must be 1 to be selected.. any table that it's not
>     directly related with this table will ignore those values and select
>     everything.
> 
>     So, with current way, it's not possible to use relations that are
>     defined with a class that it's related with current class and many to
>     many cannot be used always.
> 
>     Is there any way to make findAll check relations that are loaded?
> 
>      >
>      > $phone = YDDatabaseObject::getInstance( 'Phones' );
>      >
>      > $phone->load( 'people_car' );
>      > $phone->people->beautiful = 1;
>      > $phone->car->active = 1;
>      >
>      > $phone->find( 'people_car' );
>      >
>      > The structure in the object isn't exactly the structure
>     described, but
>      > does the trick.
>      >
>      > -db
>      >
>      >
>      > On 2/18/06, *Francisco Azevedo* < francisco at fusemail.com
>     <mailto:francisco at fusemail.com>
>      > <mailto:francisco at fusemail.com <mailto:francisco at fusemail.com>>>
>     wrote:
>      >
>      >     Hi
>      >
>      >     Imagine this "strange" example: I have an db scheme that have
>     3 tables:
>      >     Cars, People, Phones.
>      >     Table Cars has:  id_car (int key), description (string),
>     active (0 or 1)
>      >     Table People has:  id_people (int key), id_car (points to
>     table Cars),
>      >     name (string), beautiful (0 or 1)
>      >     Table Phones has:  id_phone (int key), id_people  (points to
>     table
>      >     People), description (string)
>      >
>      >     This means that: we can define phones, each phone belongs to
>     just one
>      >     person, each person belongs to one car and each car can be
>     active or
>      >     not.
>      >
>      >     So we have the next relations:
>      >
>      >     relation "phone" in class Phones and in class People:
>      >     * Table Phones (id_phone) <-----> Table People (id_people)
>      >
>      >     relation "car" in class People and class Cars:
>      >     * Table People (id_people) -----> Table Cars (id_car)
>      >
>      >     Now, how can we get all Phones that belong to beautiful
>     persons that are
>      >     in an "active" cars?
>      >
>      >     I have tryied the next solution, but YDDatabaseObject seems
>     ignoring
>      >     relations that are indirectly connected to Phones table:
>      >
>      >     $phone = YDDatabaseObject::getInstance( 'Phones' );
>      >
>      >     $phone->load('people');
>      >     $phone->people->beautiful = 1;
>      >     $phone->people->load('car');
>      >     $phone->people->car->active = 1;
>      >
>      >     $phone->findAll();
>      >
>      >     Is this possible or just a bug?
>      >
>      >     Francisco Azevedo
>      >



From muitocomplicado at gmail.com  Sun Feb 19 21:58:55 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Sun, 19 Feb 2006 17:58:55 -0300
Subject: [ydf-devel] YDDatabaseObject indirect relations
In-Reply-To: <43F89A2A.4050809@fusemail.com>
References: <43F79DC0.6080900@fusemail.com>
	 <12260be20602181504p35c5af88ga6276069057996a3@mail.gmail.com>
	 <43F7AD97.4050002@fusemail.com>
	 <12260be20602181716r6c8c39ccj4c636ab91e4b0a4@mail.gmail.com>
	 <43F89A2A.4050809@fusemail.com>
Message-ID: <12260be20602191258i43f55d3dx3d582d2b24bae14f@mail.gmail.com>

You are right.

This would be really better.

I'm gonna take a look at this.

-db

On 2/19/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> > Maybe my last commit yesterday can help you. You can do this now:
> >
> > // phones class
> >
> > $rel =& $this->registerRelation( 'people', false, 'people' );
> > $rel->setLocalKey( 'id_people' );
> > $rel->setForeignKey( 'id_people' );
> > $rel->setForeignVar( 'people' );
> >
> > $rel =& $this->registerRelation( 'car', false, 'car' );
> > $rel->setLocalKey( 'people.id_car' ); // note: this is not a field from
> > phones class but from people relation
> > $rel->setForeignKey( 'id_car' );
> > $rel->setForeignVar( 'car' );
> > $rel->setForeignConditions( 'people.active = car.active' ); // more
> > conditions with other relations
>
> Db, sorry but this is a ugly solution. I have defined all relations and
> the internal state of all classes. The problem is on find() and
> findAll(). These methods don't care about loaded classes. Imho, find()
> should search all arguments and find inside each if they are defined.
> In this case:
> $phone->find('people','car');
> find would:
> - get relations to 'people' and 'car' inside 'phone' class.
> // would find 1 relation
> - get relations to 'car' and 'phone' inside 'people' class.
> // would find 2 relations
> - get relations to 'phone' and 'people' inside 'car' class.
> // would find 1 relation
>
> .. and then make the query.
>
> This has one more BIG advantage. All the internal states of the classes
> will be used. If you define inside 'cars':
> $this->registerProtected( 'active', 1 )
> The $phone::find() will use it and we don't need to define it _again_.
>
> Imagine that, if we have 10 tables that are indirectly related to 'cars'
> we don't need to create _another_ 10 relations and in _each_ find the
> internal state of cars.
>
>
> >
> > $rel =& $this->registerRelation( 'garage', false, 'garage' );
> > $rel->setLocalKey( 'car.id_garage' );
> > $rel->setForeignKey( 'id_garage' );
> > $rel->setForeignVar( 'garage' );
> >
> > // making the query
> >
> > $phone = YDDatabaseObject::getInstance( 'phones' );
> >
> > $phone->load( 'people', 'car', 'garage' );
> > $phone->people->beautiful = 1;
> > $phone->car->active = 1;
> > $phone->garage->where( 'garage.size > 10' );
> >
> > $phone->find( 'people', 'car', 'garage' );
> >
> > I think this can help you.
> >
> > -db
> >
> > On 2/18/06, *Francisco Azevedo* <francisco at fusemail.com
> > <mailto:francisco at fusemail.com>> wrote:
> >
> >
> >      > Another way is treating the people table as a cross table using a
> >      > many-to-many relation.
> >      >
> >      > $rel =& $this->registerRelation( 'people_car', true, 'car',
> >     'people' );
> >      > $rel->setLocalKey( 'id_people' );
> >      > $rel->setCrossLocalKey( 'id_people' );
> >      > $rel->setCrossForeignKey( 'id_car' );
> >      > $rel->setForeignKey( 'id_car' );
> >      > $rel->setCrossVar( 'people' );
> >      > $rel->setForeignVar( 'car' );
> >
> >     Yes, but many-to-many is not an option. It works in this example but
> i
> >     have db schemes much more complex with more than 6 tables.
> >
> >     If findAll cannot find indirect relations it's not possible to
> handle
> >     this. Imagine that, if you define that a class has a column (eg:
> >     'active') that must be 1 to be selected.. any table that it's not
> >     directly related with this table will ignore those values and select
> >     everything.
> >
> >     So, with current way, it's not possible to use relations that are
> >     defined with a class that it's related with current class and many
> to
> >     many cannot be used always.
> >
> >     Is there any way to make findAll check relations that are loaded?
> >
> >      >
> >      > $phone = YDDatabaseObject::getInstance( 'Phones' );
> >      >
> >      > $phone->load( 'people_car' );
> >      > $phone->people->beautiful = 1;
> >      > $phone->car->active = 1;
> >      >
> >      > $phone->find( 'people_car' );
> >      >
> >      > The structure in the object isn't exactly the structure
> >     described, but
> >      > does the trick.
> >      >
> >      > -db
> >      >
> >      >
> >      > On 2/18/06, *Francisco Azevedo* < francisco at fusemail.com
> >     <mailto:francisco at fusemail.com>
> >      > <mailto:francisco at fusemail.com <mailto:francisco at fusemail.com>>>
> >     wrote:
> >      >
> >      >     Hi
> >      >
> >      >     Imagine this "strange" example: I have an db scheme that have
> >     3 tables:
> >      >     Cars, People, Phones.
> >      >     Table Cars has:  id_car (int key), description (string),
> >     active (0 or 1)
> >      >     Table People has:  id_people (int key), id_car (points to
> >     table Cars),
> >      >     name (string), beautiful (0 or 1)
> >      >     Table Phones has:  id_phone (int key), id_people  (points to
> >     table
> >      >     People), description (string)
> >      >
> >      >     This means that: we can define phones, each phone belongs to
> >     just one
> >      >     person, each person belongs to one car and each car can be
> >     active or
> >      >     not.
> >      >
> >      >     So we have the next relations:
> >      >
> >      >     relation "phone" in class Phones and in class People:
> >      >     * Table Phones (id_phone) <-----> Table People (id_people)
> >      >
> >      >     relation "car" in class People and class Cars:
> >      >     * Table People (id_people) -----> Table Cars (id_car)
> >      >
> >      >     Now, how can we get all Phones that belong to beautiful
> >     persons that are
> >      >     in an "active" cars?
> >      >
> >      >     I have tryied the next solution, but YDDatabaseObject seems
> >     ignoring
> >      >     relations that are indirectly connected to Phones table:
> >      >
> >      >     $phone = YDDatabaseObject::getInstance( 'Phones' );
> >      >
> >      >     $phone->load('people');
> >      >     $phone->people->beautiful = 1;
> >      >     $phone->people->load('car');
> >      >     $phone->people->car->active = 1;
> >      >
> >      >     $phone->findAll();
> >      >
> >      >     Is this possible or just a bug?
> >      >
> >      >     Francisco Azevedo
> >      >
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060219/92637960/attachment.html>

From pclaerhout at berlios.de  Mon Feb 20 13:19:31 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:19:31 +0100
Subject: [ydf-devel] r1698 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602201219.k1KCJVF9023152@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:19:27 +0100 (Mon, 20 Feb 2006)
New Revision: 1698

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Fixed a typo in the Dutch translations.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-18 15:46:07 UTC (rev 1697)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-20 12:19:27 UTC (rev 1698)
@@ -178,7 +178,7 @@
 $GLOBALS['t']['operating_systems'] = 'Besturingssystemen';
 $GLOBALS['t']['other'] = 'Andere';
 $GLOBALS['t']['totalitems'] = 'Totaal aantal items';
-$GLOBALS['t']['totalcomments'] = 'Totaal aanta commentaren';
+$GLOBALS['t']['totalcomments'] = 'Totaal aantal commentaren';
 $GLOBALS['t']['items'] = 'item(s)';
 $GLOBALS['t']['top_10_commenters'] = 'De 10 meest actieve commentators';
 $GLOBALS['t']['all_commenters'] = 'Alle commentators';



From pclaerhout at berlios.de  Mon Feb 20 13:30:03 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:30:03 +0100
Subject: [ydf-devel] r1699 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602201230.k1KCU3H7028576@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:29:56 +0100 (Mon, 20 Feb 2006)
New Revision: 1699

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
Log:
Weblog gallery doesn't show big images properly. If they are too big now, they will be put in an iframe.

Bug #6497

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-02-20 12:19:27 UTC (rev 1698)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-02-20 12:29:56 UTC (rev 1699)
@@ -1,5 +1,7 @@
 {include file="__std_header.tpl"}
 
+{assign var="max_img_size" value="450"}
+
 {capture assign="browsebar"}
     {if $image->previous or $image->next}
         <div class="navigation">
@@ -27,7 +29,13 @@
 
         <div class="entrytext">
 
-            <p align="center"><img src="{$uploads_dir}/{$image->relative_path}"></p>
+            <p align="center">
+            {if $image->getWidth() > $max_img_size}
+                <iframe src="{$uploads_dir}/{$image->relative_path}" width="{$max_img_size}" height="{$image->getHeight()+20}" marginwidth="0" marginheight="0"></iframe>
+            {else}
+                <img src="{$uploads_dir}/{$image->relative_path}">
+            {/if}
+            </p>
 
             {$browsebar}
 



From pclaerhout at berlios.de  Mon Feb 20 13:36:33 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:36:33 +0100
Subject: [ydf-devel] r1700 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples/weblog/manage
Message-ID: <200602201236.k1KCaXLF030108@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:36:30 +0100 (Mon, 20 Feb 2006)
New Revision: 1700

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
   YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
Log:
If the auto updater fails to connect to the update server, an error message is now shown instead of just failing the script.

Bug #6498

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2006-02-20 12:29:56 UTC (rev 1699)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2006-02-20 12:36:30 UTC (rev 1700)
@@ -423,10 +423,11 @@
          *
          *	@param $cache	(optional) Indicate if the web content should be cached or not. By default, caching is
          *					turned on.
+         *  @param $fail    (optional) Whether to fail or not if the contents cannot be downloaded. Defaults to true.
          *
          *	@returns	Returns the contents of the URL.
          */
-        function getContents( $cache=true ) {
+        function getContents( $cache=true, $fail=true ) {
 
             // Check if caching is enabled
             $cacheFName = null;
@@ -485,10 +486,14 @@
 
             // Check if there was a result
             if ( $result == false ) {
-                trigger_error(
-                    'Failed to retrieve the data from the url "' . $this->getUrl() . '". ' . $client->getError(),
-                    YD_ERROR
-                );
+                if ( $fail ) {
+                    trigger_error(
+                        'Failed to retrieve the data from the url "' . $this->getUrl() . '". ' . $client->getError(),
+                        YD_ERROR
+                    );
+                } else {
+                    return false;
+                }
             } else {
                 $data = @ $client->getContent();
             }

Modified: YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-20 12:29:56 UTC (rev 1699)
+++ YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-20 12:36:30 UTC (rev 1700)
@@ -56,7 +56,10 @@
         // Class constructor
         function YDUpdateDB() {
             $url = new YDUrl( YDConfig::get( 'updateDbUrl' ) . '?revision=' . YD_FW_REVISION );
-            $this->changes = $url->getContents( false );
+            $this->changes = @ $url->getContents( false, false );
+            if ( ! $this->changes ) {
+                YDUpdateLog::error( 'Failed to connect to the update server.' );
+            }
             if ( @ unserialize( base64_decode( $this->changes ) ) === false ) {
                 YDUpdateLog::error( $this->changes );
             }



From pclaerhout at berlios.de  Mon Feb 20 13:37:51 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:37:51 +0100
Subject: [ydf-devel] r1701 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602201237.k1KCbpgW030335@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:37:16 +0100 (Mon, 20 Feb 2006)
New Revision: 1701

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
Log:
A nice error message is now shown if the data from the update server is not valid.

Modified: YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-20 12:36:30 UTC (rev 1700)
+++ YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-02-20 12:37:16 UTC (rev 1701)
@@ -61,7 +61,7 @@
                 YDUpdateLog::error( 'Failed to connect to the update server.' );
             }
             if ( @ unserialize( base64_decode( $this->changes ) ) === false ) {
-                YDUpdateLog::error( $this->changes );
+                YDUpdateLog::error( 'Invalid contents retrieved from the update server' );
             }
             $this->changes = unserialize( base64_decode( $this->changes ) );
         }



From pclaerhout at berlios.de  Mon Feb 20 13:50:25 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:50:25 +0100
Subject: [ydf-devel] r1702 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602201250.k1KCoP09002724@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:50:10 +0100 (Mon, 20 Feb 2006)
New Revision: 1702

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Fixed a small issue in YDRecordSet where the setTotalRows function with the argument 0 would not work properly.

Bug #6485

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-20 12:37:16 UTC (rev 1701)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-20 12:50:10 UTC (rev 1702)
@@ -182,12 +182,12 @@
          *                    Default: false.
          */
         function setTotalRows( $value, $offset=false ) {
-            
-            // Return if total is 0
-            if ( strval( $value ) == '0' ) {
-                return;
-            }
 
+            //// Return if total is 0
+            //if ( strval( $value ) == '0' ) {
+            //    return;
+            //}
+
             // Set the number of records an integer
             $value = intval( $value );
             



From pclaerhout at berlios.de  Mon Feb 20 13:56:16 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 13:56:16 +0100
Subject: [ydf-devel] r1703 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602201256.k1KCuG6h004706@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 13:56:00 +0100 (Mon, 20 Feb 2006)
New Revision: 1703

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
Log:
The admin cookies are now set for the proper path instead of for the complete domain.

This allows hosting of different instances of YDWeblog on the same domain.

Bug #6499

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-20 12:50:10 UTC (rev 1702)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-20 12:56:00 UTC (rev 1703)
@@ -368,9 +368,16 @@
                 // Get the form values
                 $values = $form->getValues();
 
+                // Get the path for the cookies
+                if ( YDStringUtil::endsWith( dirname( YD_SELF_SCRIPT ), '/manage' ) ) {
+                    $cookiePath = dirname( dirname( YD_SELF_SCRIPT ) ) . '/';
+                } else {
+                    $cookiePath = dirname( YD_SELF_SCRIPT ) . '/';
+                }
+
                 // Set the cookies
-                setcookie( 'YD_USER_NAME', $values['loginName'], time() + 31536000, '/' );
-                setcookie( 'YD_USER_PASS', md5( $values['loginPass'] ), time() + 31536000, '/' );
+                setcookie( 'YD_USER_NAME', $values['loginName'], time() + 31536000, $cookiePath );
+                setcookie( 'YD_USER_PASS', md5( $values['loginPass'] ), time() + 31536000, $cookiePath );
 
                 // Set the username
                 $this->username = $values['loginName'];



From pclaerhout at berlios.de  Mon Feb 20 14:04:49 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 14:04:49 +0100
Subject: [ydf-devel] r1704 - in YDFramework2.0/trunk/examples/weblog: include manage skins/default
Message-ID: <200602201304.k1KD4nke008055@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 14:04:47 +0100 (Mon, 20 Feb 2006)
New Revision: 1704

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl
Log:
Fixed some more bugs and added some features for the login/logout options of the weblog application:
- The public side now properly shows if you are logged in or not.
- The login screen now has a link to allow you to go to the public side.
- The logout action now properly sets the cookie path to allow a successful logout.
- The YDWeblogAdminRequest now has a function called _getCookiePath.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-20 12:56:00 UTC (rev 1703)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-20 13:04:47 UTC (rev 1704)
@@ -333,6 +333,15 @@
 
         }
 
+        // Function to get the cookie path
+        function _getCookiePath() {
+            if ( YDStringUtil::endsWith( dirname( YD_SELF_SCRIPT ), '/manage' ) ) {
+                return dirname( dirname( YD_SELF_SCRIPT ) ) . '/';
+            } else {
+                return dirname( YD_SELF_SCRIPT ) . '/';
+            }
+        }
+
         // The login action
         function actionLogin() {
 
@@ -369,11 +378,7 @@
                 $values = $form->getValues();
 
                 // Get the path for the cookies
-                if ( YDStringUtil::endsWith( dirname( YD_SELF_SCRIPT ), '/manage' ) ) {
-                    $cookiePath = dirname( dirname( YD_SELF_SCRIPT ) ) . '/';
-                } else {
-                    $cookiePath = dirname( YD_SELF_SCRIPT ) . '/';
-                }
+                $cookiePath = $this->_getCookiePath();
 
                 // Set the cookies
                 setcookie( 'YD_USER_NAME', $values['loginName'], time() + 31536000, $cookiePath );
@@ -395,11 +400,18 @@
 
         }
 
-
         // Logout action
         function actionLogout() {
-            setcookie( 'YD_USER_PASS', null, time() - 31536000, '/' );
+
+            // Get the path for the cookies
+            $cookiePath = $this->_getCookiePath();
+
+            // Set the cookie
+            setcookie( 'YD_USER_PASS', null, time() - 31536000, $cookiePath );
+
+            // Redirect to the login
             $this->redirectToAction( 'login' );
+
         }
 
         // Check for authentication

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-02-20 12:56:00 UTC (rev 1703)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-02-20 13:04:47 UTC (rev 1704)
@@ -45,8 +45,8 @@
             <p class="langRow">
                 {if $user.name}
                     <a href="index.php?do=logout" class="langRow">{t w="logoff"}</a> |
-                    <a href="../index.php" class="langRow" target="_blank">{t w="view_site"}</a>
                 {/if}
+                <a href="../index.php" class="langRow" target="_blank">{t w="view_site"}</a>
             </p>
         </td>
         <td class="langRowR">

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl	2006-02-20 12:56:00 UTC (rev 1703)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl	2006-02-20 13:04:47 UTC (rev 1704)
@@ -47,9 +47,17 @@
         {/if}
 
         <li>
-            <h2>{t w="admin"}</h2>
+            <h2>{if $user.name}{$user.name}{else}{t w="admin"}{/if}</h2>
             <ul>
-                <li><a href="manage/index.php">{t w="login"}</a></li>
+                <li>
+                    {if $user.name}
+                        <a href="manage/index.php">{t w="a_admin_home"}</a>
+                        </br>
+                        <a href="manage/index.php?do=logout">{t w="a_logoff"}</a>
+                    {else}
+                        <a href="manage/index.php">{t w="login"}</a>
+                    {/if}
+                </li>
             </ul>
         </li>
 



From pclaerhout at berlios.de  Mon Feb 20 15:04:13 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Feb 2006 15:04:13 +0100
Subject: [ydf-devel] r1705 - in YDFramework2.0/trunk: YDFramework2/3rdparty YDFramework2/3rdparty/safehtml YDFramework2/3rdparty/safehtml/classes YDFramework2/3rdparty/safehtml/classes/HTMLSax3 YDFramework2/YDClasses examples examples/weblog
Message-ID: <200602201404.k1KE4DJ9006746@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-20 15:04:08 +0100 (Mon, 20 Feb 2006)
New Revision: 1705

Added:
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/safehtml.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/license.txt
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/readme.txt
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/safehtml.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/examples/form.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Added the safe_html form filter and enabled it for the comments in the weblog application.

This form filter is based on http://pixel-apes.com/safehtml/.

It's specifically designed to prevent XSS html. It does the following:
- opening tag without its closing tag 
- closing tag without its opening tag 
- any of these tags: ?\226?\128?\156base?\226?\128?\157, ?\226?\128?\156basefont?\226?\128?\157, ?\226?\128?\156head?\226?\128?\157, ?\226?\128?\156html?\226?\128?\157, ?\226?\128?\156body?\226?\128?\157, ?\226?\128?\156applet?\226?\128?\157, ?\226?\128?\156object?\226?\128?\157, ?\226?\128?\156iframe?\226?\128?\157, ?\226?\128?\156frame?\226?\128?\157, ?\226?\128?\156frameset?\226?\128?\157, ?\226?\128?\156script?\226?\128?\157, ?\226?\128?\156layer?\226?\128?\157, ?\226?\128?\156ilayer?\226?\128?\157, ?\226?\128?\156embed?\226?\128?\157, ?\226?\128?\156bgsound?\226?\128?\157, ?\226?\128?\156link?\226?\128?\157, ?\226?\128?\156meta?\226?\128?\157, ?\226?\128?\156style?\226?\128?\157, ?\226?\128?\156title?\226?\128?\157, ?\226?\128?\156blink?\226?\128?\157, ?\226?\128?\156xml?\226?\128?\157 etc.
- any of these attributes: on*, data*, dynsrc 
- javascript:/vbscript:/about: etc. protocols 
- expression/behavior etc. in styles 
- any other active content

This should again prevent strange input from being entered in the comment fields.

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,122 @@
+<?php
+class XML_HTMLSax3_Trim {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_Trim(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function trimData(&$parser, $data) {
+  $data = trim($data);
+  if ($data != '') {
+   $this->orig_obj->{$this->orig_method}($parser, $data);
+  }
+ }
+}
+class XML_HTMLSax3_CaseFolding {
+ var $orig_obj;
+ var $orig_open_method;
+ var $orig_close_method;
+ function XML_HTMLSax3_CaseFolding(&$orig_obj, $orig_open_method, $orig_close_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_open_method = $orig_open_method;
+  $this->orig_close_method = $orig_close_method;
+ }
+ function foldOpen(&$parser, $tag, $attrs=array(), $empty = FALSE) {
+  $this->orig_obj->{$this->orig_open_method}($parser, strtoupper($tag), $attrs, $empty);
+ }
+ function foldClose(&$parser, $tag, $empty = FALSE) {
+  $this->orig_obj->{$this->orig_close_method}($parser, strtoupper($tag), $empty);
+ }
+}
+class XML_HTMLSax3_Linefeed {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_LineFeed(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function breakData(&$parser, $data) {
+  $data = explode("\n",$data);
+  foreach ( $data as $chunk ) {
+   $this->orig_obj->{$this->orig_method}($parser, $chunk);
+  }
+ }
+}
+class XML_HTMLSax3_Tab {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_Tab(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function breakData(&$parser, $data) {
+  $data = explode("\t",$data);
+  foreach ( $data as $chunk ) {
+   $this->orig_obj->{$this->orig_method}($this, $chunk);
+  }
+ }
+}
+class XML_HTMLSax3_Entities_Parsed {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_Entities_Parsed(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function breakData(&$parser, $data) {
+  $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
+  foreach ( $data as $chunk ) {
+   $chunk = html_entity_decode($chunk,ENT_NOQUOTES);
+   $this->orig_obj->{$this->orig_method}($this, $chunk);
+  }
+ }
+}
+if (version_compare(phpversion(), '4.3', '<') && !function_exists('html_entity_decode') ) {
+ function html_entity_decode($str, $style=ENT_NOQUOTES) {
+  return strtr($str,
+   array_flip(get_html_translation_table(HTML_ENTITIES,$style)));
+ }
+}
+class XML_HTMLSax3_Entities_Unparsed {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_Entities_Unparsed(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function breakData(&$parser, $data) {
+  $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
+  foreach ( $data as $chunk ) {
+   $this->orig_obj->{$this->orig_method}($this, $chunk);
+  }
+ }
+}
+
+class XML_HTMLSax3_Escape_Stripper {
+ var $orig_obj;
+ var $orig_method;
+ function XML_HTMLSax3_Escape_Stripper(&$orig_obj, $orig_method) {
+  $this->orig_obj =& $orig_obj;
+  $this->orig_method = $orig_method;
+ }
+ function strip(&$parser, $data) {
+  if ( substr($data,0,2) == '--' ) {
+   $patterns = array(
+    '/^\-\-/',    // Opening comment: --
+    '/\-\-$/',    // Closing comment: --
+   );
+   $data = preg_replace($patterns,'',$data);
+
+  } else if ( substr($data,0,1) == '[' ) {
+   $patterns = array(
+    '/^\[.*CDATA.*\[/s', // Opening CDATA
+    '/\].*\]$/s',    // Closing CDATA
+    );
+   $data = preg_replace($patterns,'',$data);
+  }
+
+  $this->orig_obj->{$this->orig_method}($this, $data);
+ }
+}
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,179 @@
+<?php
+define('XML_HTMLSAX3_STATE_STOP', 0);
+define('XML_HTMLSAX3_STATE_START', 1);
+define('XML_HTMLSAX3_STATE_TAG', 2);
+define('XML_HTMLSAX3_STATE_OPENING_TAG', 3);
+define('XML_HTMLSAX3_STATE_CLOSING_TAG', 4);
+define('XML_HTMLSAX3_STATE_ESCAPE', 6);
+define('XML_HTMLSAX3_STATE_JASP', 7);
+define('XML_HTMLSAX3_STATE_PI', 8);
+class XML_HTMLSax3_StartingState  {
+ function parse(&$context) {
+  $data = $context->scanUntilString('<');
+  if ($data != '') {
+   $context->handler_object_data->
+    {$context->handler_method_data}($context->htmlsax, $data);
+  }
+  $context->IgnoreCharacter();
+  return XML_HTMLSAX3_STATE_TAG;
+ }
+}
+class XML_HTMLSax3_TagState {
+ function parse(&$context) {
+  switch($context->ScanCharacter()) {
+  case '/':
+   return XML_HTMLSAX3_STATE_CLOSING_TAG;
+   break;
+  case '?':
+   return XML_HTMLSAX3_STATE_PI;
+   break;
+  case '%':
+   return XML_HTMLSAX3_STATE_JASP;
+   break;
+  case '!':
+   return XML_HTMLSAX3_STATE_ESCAPE;
+   break;
+  default:
+   $context->unscanCharacter();
+   return XML_HTMLSAX3_STATE_OPENING_TAG;
+  }
+ }
+}
+class XML_HTMLSax3_ClosingTagState {
+ function parse(&$context) {
+  $tag = $context->scanUntilCharacters('/>');
+  if ($tag != '') {
+   $char = $context->scanCharacter();
+   if ($char == '/') {
+    $char = $context->scanCharacter();
+    if ($char != '>') {
+     $context->unscanCharacter();
+    }
+   }
+   $context->handler_object_element->
+    {$context->handler_method_closing}($context->htmlsax, $tag, FALSE);
+  }
+  return XML_HTMLSAX3_STATE_START;
+ }
+}
+class XML_HTMLSax3_OpeningTagState {
+ function parseAttributes(&$context) {
+  $Attributes = array();
+ 
+  $context->ignoreWhitespace();
+  $attributename = $context->scanUntilCharacters("=/> \n\r\t");
+  while ($attributename != '') {
+   $attributevalue = NULL;
+   $context->ignoreWhitespace();
+   $char = $context->scanCharacter();
+   if ($char == '=') {
+    $context->ignoreWhitespace();
+    $char = $context->ScanCharacter();
+    if ($char == '"') {
+     $attributevalue= $context->scanUntilString('"');
+     $context->IgnoreCharacter();
+    } else if ($char == "'") {
+     $attributevalue = $context->scanUntilString("'");
+     $context->IgnoreCharacter();
+    } else {
+     $context->unscanCharacter();
+     $attributevalue =
+      $context->scanUntilCharacters("> \n\r\t");
+    }
+   } else if ($char !== NULL) {
+    $attributevalue = NULL;
+    $context->unscanCharacter();
+   }
+   $Attributes[$attributename] = $attributevalue;
+   
+   $context->ignoreWhitespace();
+   $attributename = $context->scanUntilCharacters("=/> \n\r\t");
+  }
+  return $Attributes;
+ }
+
+ function parse(&$context) {
+  $tag = $context->scanUntilCharacters("/> \n\r\t");
+  if ($tag != '') {
+   $this->attrs = array();
+   $Attributes = $this->parseAttributes($context);
+   $char = $context->scanCharacter();
+   if ($char == '/') {
+    $char = $context->scanCharacter();
+    if ($char != '>') {
+     $context->unscanCharacter();
+    }
+    $context->handler_object_element->
+     {$context->handler_method_opening}($context->htmlsax, $tag, 
+     $Attributes, TRUE);
+    $context->handler_object_element->
+     {$context->handler_method_closing}($context->htmlsax, $tag, 
+     TRUE);
+   } else {
+    $context->handler_object_element->
+     {$context->handler_method_opening}($context->htmlsax, $tag, 
+     $Attributes, FALSE);
+   }
+  }
+  return XML_HTMLSAX3_STATE_START;
+ }
+}
+
+class XML_HTMLSax3_EscapeState {
+ function parse(&$context) {
+  $char = $context->ScanCharacter();
+  if ($char == '-') {
+   $char = $context->ScanCharacter();
+   if ($char == '-') {
+    $context->unscanCharacter();
+    $context->unscanCharacter();
+    $text = $context->scanUntilString('-->');
+    $text .= $context->scanCharacter();
+    $text .= $context->scanCharacter();
+   } else {
+    $context->unscanCharacter();
+    $text = $context->scanUntilString('>');
+   }
+  } else if ( $char == '[') {
+   $context->unscanCharacter();
+   $text = $context->scanUntilString(']>');
+   $text.= $context->scanCharacter();
+  } else {
+   $context->unscanCharacter();
+   $text = $context->scanUntilString('>');
+  }
+
+  $context->IgnoreCharacter();
+  if ($text != '') {
+   $context->handler_object_escape->
+   {$context->handler_method_escape}($context->htmlsax, $text);
+  }
+  return XML_HTMLSAX3_STATE_START;
+ }
+}
+class XML_HTMLSax3_JaspState {
+ function parse(&$context) {
+  $text = $context->scanUntilString('%>');
+  if ($text != '') {
+   $context->handler_object_jasp->
+    {$context->handler_method_jasp}($context->htmlsax, $text);
+  }
+  $context->IgnoreCharacter();
+  $context->IgnoreCharacter();
+  return XML_HTMLSAX3_STATE_START;
+ }
+}
+class XML_HTMLSax3_PiState {
+ function parse(&$context) {
+  $target = $context->scanUntilCharacters(" \n\r\t");
+  $data = $context->scanUntilString('?>');
+  if ($data != '') {
+   $context->handler_object_pi->
+   {$context->handler_method_pi}($context->htmlsax, $target, $data);
+  }
+  $context->IgnoreCharacter();
+  $context->IgnoreCharacter();
+  return XML_HTMLSAX3_STATE_START;
+ }
+}
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,292 @@
+<?php
+// +----------------------------------------------------------------------+
+// | Copyright (c) 1997-2002 The PHP Group                                |
+// +----------------------------------------------------------------------+
+// | This source file is subject to version 2.02 of the PHP license,      |
+// | that is bundled with this package in the file LICENSE, and is        |
+// | available at through the world-wide-web at                           |
+// | http://www.php.net/license/3_0.txt.                                  |
+// | If you did not receive a copy of the PHP license and are unable to   |
+// | obtain it through the world-wide-web, please send a note to          |
+// | license at php.net so we can mail you a copy immediately.               |
+// +----------------------------------------------------------------------+
+// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
+// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
+// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
+// +----------------------------------------------------------------------+
+//
+if (!defined('XML_HTMLSAX3')) {
+ define('XML_HTMLSAX3', 'XML/');
+}
+require_once(XML_HTMLSAX3 . 'HTMLSax3/States.php');
+require_once(XML_HTMLSAX3 . 'HTMLSax3/Decorators.php');
+
+class XML_HTMLSax3_StateParser {
+ var $htmlsax;
+ var $handler_object_element;
+ var $handler_method_opening;
+ var $handler_method_closing;
+ var $handler_object_data;
+ var $handler_method_data;
+ var $handler_object_pi;
+ var $handler_method_pi;
+ var $handler_object_jasp;
+ var $handler_method_jasp;
+ var $handler_object_escape;
+ var $handler_method_escape;
+ var $handler_default;
+ var $parser_options = array();
+ var $rawtext;
+ var $position;
+ var $length;
+ var $State = array();
+
+ function XML_HTMLSax3_StateParser (& $htmlsax) {
+  $this->htmlsax = & $htmlsax;
+  $this->State[XML_HTMLSAX3_STATE_START] =& new XML_HTMLSax3_StartingState();
+
+  $this->State[XML_HTMLSAX3_STATE_CLOSING_TAG] =& new XML_HTMLSax3_ClosingTagState();
+  $this->State[XML_HTMLSAX3_STATE_TAG] =& new XML_HTMLSax3_TagState();
+  $this->State[XML_HTMLSAX3_STATE_OPENING_TAG] =& new XML_HTMLSax3_OpeningTagState();
+
+  $this->State[XML_HTMLSAX3_STATE_PI] =& new XML_HTMLSax3_PiState();
+  $this->State[XML_HTMLSAX3_STATE_JASP] =& new XML_HTMLSax3_JaspState();
+  $this->State[XML_HTMLSAX3_STATE_ESCAPE] =& new XML_HTMLSax3_EscapeState();
+ }
+
+ function unscanCharacter() {
+  $this->position -= 1;
+ }
+
+ function ignoreCharacter() {
+  $this->position += 1;
+ }
+
+ function scanCharacter() {
+  if ($this->position < $this->length) {
+   return $this->rawtext{$this->position++};
+  }
+ }
+
+ function scanUntilString($string) {
+  $start = $this->position;
+  $this->position = strpos($this->rawtext, $string, $start);
+  if ($this->position === FALSE) {
+   $this->position = $this->length;
+  }
+  return substr($this->rawtext, $start, $this->position - $start);
+ }
+
+ function scanUntilCharacters($string) {}
+
+ function ignoreWhitespace() {}
+
+ function parse($data) {
+  if ($this->parser_options['XML_OPTION_TRIM_DATA_NODES']==1) {
+   $decorator =& new XML_HTMLSax3_Trim(
+    $this->handler_object_data,
+    $this->handler_method_data);
+   $this->handler_object_data =& $decorator;
+   $this->handler_method_data = 'trimData';
+  }
+  if ($this->parser_options['XML_OPTION_CASE_FOLDING']==1) {
+   $open_decor =& new XML_HTMLSax3_CaseFolding(
+    $this->handler_object_element,
+    $this->handler_method_opening,
+    $this->handler_method_closing);
+   $this->handler_object_element =& $open_decor;
+   $this->handler_method_opening ='foldOpen';
+   $this->handler_method_closing ='foldClose';
+  }
+  if ($this->parser_options['XML_OPTION_LINEFEED_BREAK']==1) {
+   $decorator =& new XML_HTMLSax3_Linefeed(
+    $this->handler_object_data,
+    $this->handler_method_data);
+   $this->handler_object_data =& $decorator;
+   $this->handler_method_data = 'breakData';
+  }
+  if ($this->parser_options['XML_OPTION_TAB_BREAK']==1) {
+   $decorator =& new XML_HTMLSax3_Tab(
+    $this->handler_object_data,
+    $this->handler_method_data);
+   $this->handler_object_data =& $decorator;
+   $this->handler_method_data = 'breakData';
+  }
+  if ($this->parser_options['XML_OPTION_ENTITIES_UNPARSED']==1) {
+   $decorator =& new XML_HTMLSax3_Entities_Unparsed(
+    $this->handler_object_data,
+    $this->handler_method_data);
+   $this->handler_object_data =& $decorator;
+   $this->handler_method_data = 'breakData';
+  }
+  if ($this->parser_options['XML_OPTION_ENTITIES_PARSED']==1) {
+   $decorator =& new XML_HTMLSax3_Entities_Parsed(
+    $this->handler_object_data,
+    $this->handler_method_data);
+   $this->handler_object_data =& $decorator;
+   $this->handler_method_data = 'breakData';
+  }
+  // Note switched on by default
+  if ($this->parser_options['XML_OPTION_STRIP_ESCAPES']==1) {
+   $decorator =& new XML_HTMLSax3_Escape_Stripper(
+    $this->handler_object_escape,
+    $this->handler_method_escape);
+   $this->handler_object_escape =& $decorator;
+   $this->handler_method_escape = 'strip';
+  }
+  $this->rawtext = $data;
+  $this->length = strlen($data);
+  $this->position = 0;
+  $this->_parse();
+ }
+
+ function _parse($state = XML_HTMLSAX3_STATE_START) {
+  do {
+   $state = $this->State[$state]->parse($this);
+  } while ($state != XML_HTMLSAX3_STATE_STOP &&
+     $this->position < $this->length);
+ }
+}
+
+class XML_HTMLSax3_StateParser_Lt430 extends XML_HTMLSax3_StateParser {
+ function XML_HTMLSax3_StateParser_Lt430(& $htmlsax) {
+  parent::XML_HTMLSax3_StateParser($htmlsax);
+  $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
+  $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
+  $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
+  $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
+  $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
+  $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
+  $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
+ }
+
+ function scanUntilCharacters($string) {
+  $startpos = $this->position;
+  while ($this->position < $this->length && strpos($string, $this->rawtext{$this->position}) === FALSE) {
+   $this->position++;
+  }
+  return substr($this->rawtext, $startpos, $this->position - $startpos);
+ }
+
+ function ignoreWhitespace() {
+  while ($this->position < $this->length && 
+   strpos(" \n\r\t", $this->rawtext{$this->position}) !== FALSE) {
+   $this->position++;
+  }
+ }
+
+ function parse($data) {
+  parent::parse($data);
+ }
+}
+
+class XML_HTMLSax3_StateParser_Gtet430 extends XML_HTMLSax3_StateParser {
+ function XML_HTMLSax3_StateParser_Gtet430(& $htmlsax) {
+  parent::XML_HTMLSax3_StateParser($htmlsax);
+  $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
+  $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
+  $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
+  $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
+  $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
+  $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
+  $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
+ }
+ function scanUntilCharacters($string) {
+  $startpos = $this->position;
+  $length = strcspn($this->rawtext, $string, $startpos);
+  $this->position += $length;
+  return substr($this->rawtext, $startpos, $length);
+ }
+
+ function ignoreWhitespace() {
+  $this->position += strspn($this->rawtext, " \n\r\t", $this->position);
+ }
+
+ function parse($data) {
+  parent::parse($data);
+ }
+}
+
+class XML_HTMLSax3_NullHandler {
+ function DoNothing() {
+ }
+}
+
+class XML_HTMLSax3 {
+ var $state_parser;
+
+ function XML_HTMLSax3() {
+  if (version_compare(phpversion(), '4.3', 'ge')) {
+   $this->state_parser =& new XML_HTMLSax3_StateParser_Gtet430($this);
+  } else {
+   $this->state_parser =& new XML_HTMLSax3_StateParser_Lt430($this);
+  }
+  $nullhandler =& new XML_HTMLSax3_NullHandler();
+  $this->set_object($nullhandler);
+  $this->set_element_handler('DoNothing', 'DoNothing');
+  $this->set_data_handler('DoNothing');
+  $this->set_pi_handler('DoNothing');
+  $this->set_jasp_handler('DoNothing');
+  $this->set_escape_handler('DoNothing');
+ }
+
+ function set_object(&$object) {
+  if ( is_object($object) ) {
+   $this->state_parser->handler_default =& $object;
+   return true;
+  } else {
+   require_once('PEAR.php');
+   PEAR::raiseError('XML_HTMLSax3::set_object requires '.
+    'an object instance');
+  }
+ }
+
+ function set_option($name, $value=1) {
+  if ( array_key_exists($name,$this->state_parser->parser_options) ) {
+   $this->state_parser->parser_options[$name] = $value;
+   return true;
+  } else {
+   require_once('PEAR.php');
+   PEAR::raiseError('XML_HTMLSax3::set_option('.$name.') illegal');
+  }
+ }
+
+ function set_data_handler($data_method) {
+  $this->state_parser->handler_object_data =& $this->state_parser->handler_default;
+  $this->state_parser->handler_method_data = $data_method;
+ }
+
+ function set_element_handler($opening_method, $closing_method) {
+  $this->state_parser->handler_object_element =& $this->state_parser->handler_default;
+  $this->state_parser->handler_method_opening = $opening_method;
+  $this->state_parser->handler_method_closing = $closing_method;
+ }
+
+ function set_pi_handler($pi_method) {
+  $this->state_parser->handler_object_pi =& $this->state_parser->handler_default;
+  $this->state_parser->handler_method_pi = $pi_method;
+ }
+
+ function set_escape_handler($escape_method) {
+  $this->state_parser->handler_object_escape =& $this->state_parser->handler_default;
+  $this->state_parser->handler_method_escape = $escape_method;
+ }
+
+ function set_jasp_handler ($jasp_method) {
+  $this->state_parser->handler_object_jasp =& $this->state_parser->handler_default;
+  $this->state_parser->handler_method_jasp = $jasp_method;
+ }
+
+ function get_current_position() {
+  return $this->state_parser->position;
+ }
+
+ function get_length() {
+  return $this->state_parser->length;
+ }
+
+ function parse($data) {
+  $this->state_parser->parse($data);
+ }
+}
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/safehtml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/safehtml.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/safehtml.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,381 @@
+<?php
+/**
+ * SafeHTML Parser
+ *
+ * @package SafeHTML
+ * @author  Roman Ivanov <thingol at mail.ru>
+ * @copyright  2004-2005 Roman Ivanov
+ * @license http://www.debian.org/misc/bsd.license  BSD License (3 Clause)
+ * @version    1.3.7
+ * @link    http://pixel-apes.com/safehtml/
+ */
+
+require_once(XML_HTMLSAX3 . 'HTMLSax3.php');
+
+class SafeHTML 
+{
+ var $_xhtml = '';
+ 
+ var $_counter = array();
+ 
+ var $_stack = array();
+ 
+ var $_dcCounter = array();
+ 
+ var $_dcStack = array();
+ 
+ var $_listScope = 0; 
+ 
+ var $_liStack = array();
+
+ var $_protoRegexps = array();
+ 
+ var $_cssRegexps = array();
+
+ var $singleTags = array('area', 'br', 'img', 'input', 'hr', 'wbr', );
+
+ var $deleteTags = array(
+  'applet', 'base',   'basefont', 'bgsound', 'blink',  'body', 
+  'embed',  'frame',  'frameset', 'head', 'html',   'ilayer', 
+  'iframe', 'layer',  'link',  'meta', 'object', 'style', 
+  'title',  'script', 
+  );
+
+ var $deleteTagsContent = array('script', 'style', 'title', 'xml', );
+
+ var $protocolFiltering = 'white';
+
+ var $blackProtocols = array(
+  'about',   'chrome',  'data',    'disk',  'hcp',  
+  'help', 'javascript', 'livescript', 'lynxcgi',  'lynxexec', 
+  'ms-help', 'ms-its',  'mhtml',   'mocha', 'opera',   
+  'res',  'resource',   'shell',   'vbscript', 'view-source', 
+  'vnd.ms.radio',    'wysiwyg', 
+  );
+
+ var $whiteProtocols = array(
+  'ed2k',   'file', 'ftp',  'gopher', 'http',  'https', 
+  'irc',    'mailto', 'news', 'nntp', 'telnet', 'webcal', 
+  'xmpp', 'callto',
+  );
+
+ var $protocolAttributes = array(
+  'action', 'background', 'codebase', 'dynsrc', 'href', 'lowsrc', 'src', 
+  );
+
+ var $cssKeywords = array(
+  'absolute', 'behavior',    'behaviour',   'content', 'expression', 
+  'fixed', 'include-source', 'moz-binding',
+  );
+
+ var $noClose = array();
+
+ var $closeParagraph = array(
+  'address', 'blockquote', 'center', 'dd',   'dir',    'div', 
+  'dl',   'dt',   'h1',  'h2',   'h3',  'h4', 
+  'h5',   'h6',   'hr',  'isindex', 'listing',   'marquee', 
+  'menu', 'multicol',   'ol',  'p',    'plaintext', 'pre', 
+  'table',   'ul',   'xmp', 
+  );
+
+ var $tableTags = array(
+  'caption', 'col', 'colgroup', 'tbody', 'td', 'tfoot', 'th', 
+  'thead',   'tr', 
+  );
+
+ var $listTags = array('dir', 'menu', 'ol', 'ul', 'dl', );
+
+ var $attributes = array('dynsrc', 'id', 'name', );
+
+ var $attributesNS = array('xml:lang', );
+
+ function SafeHTML() 
+ {
+  //making regular expressions based on Proto & CSS arrays
+  foreach ($this->blackProtocols as $proto) {
+   $preg = "/[\s\x01-\x1F]*";
+   for ($i=0; $i<strlen($proto); $i++) {
+    $preg .= $proto{$i} . "[\s\x01-\x1F]*";
+   }
+   $preg .= ":/i";
+   $this->_protoRegexps[] = $preg;
+  }
+
+  foreach ($this->cssKeywords as $css) {
+   $this->_cssRegexps[] = '/' . $css . '/i';
+  }
+  return true;
+ }
+
+ function _writeAttrs ($attrs) 
+ {
+  if (is_array($attrs)) {
+   foreach ($attrs as $name => $value) {
+
+    $name = strtolower($name);
+
+    if (strpos($name, 'on') === 0) {
+     continue;
+    }
+    if (strpos($name, 'data') === 0) {
+     continue;
+    }
+    if (in_array($name, $this->attributes)) {
+     continue;
+    }
+    if (!preg_match("/^[a-z0-9]+$/i", $name)) {
+      if (!in_array($name, $this->attributesNS))
+      {
+       continue;
+      }
+    }
+
+    if (($value === TRUE) || (is_null($value))) {
+     $value = $name;
+    }
+
+    if ($name == 'style') {
+                   
+                   // removes insignificant backslahes
+       $value = str_replace("\\", '', $value);
+
+                   // removes CSS comments
+                   while (1)
+                   {
+                     $_value = preg_replace("!/\*.*?\*/!s", '', $value);
+                     if ($_value == $value) break;
+                     $value = $_value;
+                   }
+                   
+                   // replace all & to &amp;
+       $value = str_replace('&amp;', '&', $value);
+       $value = str_replace('&', '&amp;', $value);
+
+       foreach ($this->_cssRegexps as $css) {
+        if (preg_match($css, $value)) { 
+         continue 2;
+        }
+       }
+       foreach ($this->_protoRegexps as $proto) {
+        if (preg_match($proto, $value)) {
+         continue 2;
+        }
+       }
+    }
+
+    $tempval = preg_replace('/&#(\d+);?/me', "chr('\\1')", $value); //"'
+    $tempval = preg_replace('/&#x([0-9a-f]+);?/mei', "chr(hexdec('\\1'))", $tempval);
+
+    if ((in_array($name, $this->protocolAttributes)) && 
+     (strpos($tempval, ':') !== false)) 
+    {
+     if ($this->protocolFiltering == 'black') {
+      foreach ($this->_protoRegexps as $proto) {
+       if (preg_match($proto, $tempval)) continue 2;
+      }
+     } else {
+      $_tempval = explode(':', $tempval);
+      $proto = $_tempval[0];
+      if (!in_array($proto, $this->whiteProtocols)) {
+       continue;
+      }
+     }
+    }
+
+    $value = str_replace("\"", "&quot;", $value);
+    $this->_xhtml .= ' ' . $name . '="' . $value . '"';
+   }
+  }
+  return true;
+ }
+
+ function _openHandler(&$parser, $name, $attrs) 
+ {
+  $name = strtolower($name);
+
+  if (in_array($name, $this->deleteTagsContent)) {
+   array_push($this->_dcStack, $name);
+   $this->_dcCounter[$name] = isset($this->_dcCounter[$name]) ? $this->_dcCounter[$name]+1 : 1;
+  }
+  if (count($this->_dcStack) != 0) {
+   return true;
+  }
+
+  if (in_array($name, $this->deleteTags)) {
+   return true;
+  }
+  
+  if (!preg_match("/^[a-z0-9]+$/i", $name)) {
+   if (preg_match("!(?:\@|://)!i", $name)) {
+    $this->_xhtml .= '&lt;' . $name . '&gt;';
+   }
+   return true;
+  }
+
+  if (in_array($name, $this->singleTags)) {
+   $this->_xhtml .= '<' . $name;
+   $this->_writeAttrs($attrs);
+   $this->_xhtml .= ' />';
+   return true;
+  }
+
+  // TABLES: cannot open table elements when we are not inside table
+  if ((isset($this->_counter['table'])) && ($this->_counter['table'] <= 0) 
+   && (in_array($name, $this->tableTags))) 
+  {
+   return true;
+  }
+
+  // PARAGRAPHS: close paragraph when closeParagraph tags opening
+  if ((in_array($name, $this->closeParagraph)) && (in_array('p', $this->_stack))) {
+   $this->_closeHandler($parser, 'p');
+  }
+
+  // LISTS: we should close <li> if <li> of the same level opening
+  if ($name == 'li' && count($this->_liStack) && 
+   $this->_listScope == $this->_liStack[count($this->_liStack)-1]) 
+  {
+   $this->_closeHandler($parser, 'li');
+  }
+
+  // LISTS: we want to know on what nesting level of lists we are
+  if (in_array($name, $this->listTags)) {
+   $this->_listScope++;
+  }
+  if ($name == 'li') {
+   array_push($this->_liStack, $this->_listScope);
+  }
+   
+  $this->_xhtml .= '<' . $name;
+  $this->_writeAttrs($attrs);
+  $this->_xhtml .= '>';
+  array_push($this->_stack,$name);
+  $this->_counter[$name] = isset($this->_counter[$name]) ? $this->_counter[$name]+1 : 1;
+  return true;
+ }
+
+ function _closeHandler(&$parser, $name) 
+ {
+
+  $name = strtolower($name);
+
+  if (isset($this->_dcCounter[$name]) && ($this->_dcCounter[$name] > 0) && 
+   (in_array($name, $this->deleteTagsContent))) 
+  {
+     while ($name != ($tag = array_pop($this->_dcStack))) {
+   $this->_dcCounter[$tag]--;
+     }
+
+     $this->_dcCounter[$name]--;
+  }
+
+  if (count($this->_dcStack) != 0) {
+   return true;
+  }
+
+  if ((isset($this->_counter[$name])) && ($this->_counter[$name] > 0)) {
+     while ($name != ($tag = array_pop($this->_stack))) {
+      $this->_closeTag($tag);
+     }
+
+     $this->_closeTag($name);
+  }
+  return true;
+ }
+
+ function _closeTag($tag) 
+ {
+  if (!in_array($tag, $this->noClose)) {
+   $this->_xhtml .= '</' . $tag . '>';
+  }
+
+  $this->_counter[$tag]--;
+
+  if (in_array($tag, $this->listTags)) {
+   $this->_listScope--;
+  }
+
+  if ($tag == 'li') {
+   array_pop($this->_liStack);
+  }
+  return true;
+ }
+
+ function _dataHandler(&$parser, $data) 
+ {
+  if (count($this->_dcStack) == 0) {
+   $this->_xhtml .= $data;
+  }
+  return true;
+ }
+
+ function _escapeHandler(&$parser, $data) 
+ {
+  return true;
+ }
+
+ function getXHTML () 
+ {
+  while ($tag = array_pop($this->_stack)) {
+   $this->_closeTag($tag);
+  }
+  
+  return $this->_xhtml;
+ }
+
+ function clear() 
+ {
+  $this->_xhtml = '';
+  return true;
+ }
+
+ function parse($doc) 
+ {
+
+    // Save all '<' symbols
+    $doc = preg_replace("/<(?=[^a-zA-Z\/\!\?\%])/", '&lt;', $doc);
+
+    // Web documents shouldn't contains \x00 symbol
+    $doc = str_replace("\x00", '', $doc);
+
+    // Opera6 bug workaround
+    $doc = str_replace("\xC0\xBC", '&lt;', $doc);
+
+    // UTF-7 encoding ASCII decode
+    $doc = $this->repackUTF7($doc);
+
+    // Instantiate the parser
+    $parser=& new XML_HTMLSax3();
+
+    // Set up the parser
+    $parser->set_object($this);
+
+    $parser->set_element_handler('_openHandler','_closeHandler');
+    $parser->set_data_handler('_dataHandler');
+    $parser->set_escape_handler('_escapeHandler');
+
+    $parser->parse($doc);
+
+    return $this->getXHTML();
+
+ }
+
+    function repackUTF7($str)
+    {
+       return preg_replace_callback('!\+([0-9a-zA-Z/]+)\-!', array($this, 'repackUTF7Callback'), $str);
+    }
+
+    function repackUTF7Callback($str)
+    {
+       $str = base64_decode($str[1]);
+       $str = preg_replace_callback('/^((?:\x00.)*)((?:[^\x00].)+)/', array($this, 'repackUTF7Back'), $str);
+       return preg_replace('/\x00(.)/', '$1', $str);
+    }
+
+    function repackUTF7Back($str)
+    {
+       return $str[1].'+'.rtrim(base64_encode($str[2]), '=').'-';
+    }
+}
+
+?>

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/license.txt
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/license.txt	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/license.txt	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,26 @@
+(c) Roman Ivanov, 2004-2005
+(c) Pixel-Apes ( http://pixel-apes.com/ ), 2004-2005
+(c) JetStyle   ( http://jetstyle.ru/    ), 2004-2005
+Maintainer -- Roman Ivanov <thingol at mail.ru>
+
+Redistribution and use in source and binary forms, with or without
+modification, are permitted provided that the following conditions
+are met:
+1. Redistributions of source code must retain the above copyright
+   notice, this list of conditions and the following disclaimer.
+2. Redistributions in binary form must reproduce the above copyright
+   notice, this list of conditions and the following disclaimer in the
+   documentation and/or other materials provided with the distribution.
+3. The name of the author may not be used to endorse or promote products
+   derived from this software without specific prior written permission.
+
+THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
+IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
+IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
+INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
+NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
+THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/readme.txt
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/readme.txt	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/readme.txt	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,81 @@
+SafeHTML
+--------
+Version 1.3.7.
+http://pixel-apes.com/safehtml/
+--------
+
+This parser strips down all potentially dangerous content within HTML:
+  * opening tag without its closing tag
+  * closing tag without its opening tag
+  * any of these tags: "base", "basefont", "head", "html", "body", "applet", "object", 
+    "iframe", "frame", "frameset", "script", "layer", "ilayer", "embed", "bgsound", 
+    "link", "meta", "style", "title", "blink", "xml" etc.
+  * any of these attributes: on*, data*, dynsrc
+  * javascript:/vbscript:/about: etc. protocols
+  * expression/behavior etc. in styles
+  * any other active content
+It also tries to convert code to XHTML valid, but htmltidy is far better solution for this task.
+
+If you found any bugs in this parser, please inform me -- ICQ:551593 or mailto:thingol at mail.ru
+
+Please, subscribe to http://pixel-apes.com/safehtml/feed/rss feed in order to receive notices 
+when SAFEHTML will be updated.
+
+-- Roman Ivanov.
+-- Pixel-Apes ( http://pixel-apes.com ).
+-- JetStyle ( http://jetstyle.ru/ ).
+
+
+
+--------
+Version history:
+--------
+1.3.7.
+ * Added 'dl' to the list of 'lists' tags.
+ * Added 'callto' to the white list of protocols.
+ * Added white list of "namespaced" attributes.
+1.3.6.
+ * More accurate UTF-7 decoding.
+1.3.5.
+ * Two serious security flaws fixed: UTF-7 XSS and CSS comments handling.
+1.3.2.
+ * Security flaw (improper quotes handling in attributes' values) fixed. Big thanks to Nick Cleaton.
+1.3.1.
+ * Dumb bug fixed (some closing tags were ignored).
+1.3.0.
+ * Two holes (with decimal HTML entities and with \x00 symbol) fixed.
+ * Class rewritten under PEAR coding standarts.
+ * Class now uses unmodified HTMLSax3 from PEAR.
+ * To the list of table tags added: "caption", "col", "colgroup".
+1.2.1.
+ * It was possible to create XSS with hexadecimal HTML entities. Fixed. Big thanks to Christian Stocker.
+1.2.0.
+ * "id" and "name" attributes added to dangerous attributes list, because malefactor can broke legal javascript by spoofing ID or NAME of some element.
+ * New method parse() allows to do all parsing process in two lines of code. Examples also updated.
+ * New array, closeParagraph, contains list of block-level elements. When we open such elemet, we should close paragraph before. . It allows SafeHTML to produce more XHTML compliant code.
+ * Added "webcal" to white list of protocols for those who uses calendar programs (Mozilla/iCal/etc).
+ * Now SafeHTML strips down table elements when we are not inside table.
+ * Now SafeHTML correctly closes unclosed "li" tags: before opening "li" of the same nesting level.
+1.1.0.
+ * New "dangerous" protocols: hcp, ms-help, help, disk, vnd.ms.radio, opera, res, resource, chrome, mocha, livescript.
+ * <XML> tag was moved from "tags for deletion" to "tags for deletion with content".
+ * New "dangerous" CSS instruction "include-source" (NN4 specific).
+ * New array, Attributes, contains list of attributes for removal. If you need to remove "id" or "name" attribute, 
+ just add it to this array.
+ * Now it is possible to choose between white-list and black-list filtering of protocols. Defaults are "white-list".
+ This list is: "http", "https", "ftp", "telnet", "news", "nntp", "gopher", "mailto", "file".
+ * For speed purposes, we now filter protocols only from these attributes: src, href, action, lowsrc, dynsrc, 
+ background, codebase.
+ * Opera6 XSS bug ([\xC0][\xBC]script>alert(1)[\xC0][\xBC]/script> [UTF-8] workarounded.
+1.0.4.
+ New "dangerous" tag: plaintext.
+1.0.3.
+ Added array of elements that can have no closing tag.
+1.0.2.
+ Bug fix: <img src="&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;alert(1);"> attack.
+ Thanks to shmel.
+1.0.1.
+ Bug fix: safehtml hangs on <style></style></style> code.
+ Thanks to lj user=electrocat.
+1.0.0.
+ First public release

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/safehtml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/safehtml.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/safehtml.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -0,0 +1,93 @@
+<?php
+error_reporting(E_ALL);
+/*
+
+    Example for Safehtml
+
+*/
+
+define('XML_HTMLSAX3', dirname(__FILE__)."/classes/");
+?>
+<html>
+<head>
+  <style>
+  STRIKE, S { color:#999999 }
+  </style>
+</head>
+<body>
+<h2>SAFEHTML Testing interface</h2>
+This parser strip down all potentially dangerous content within HTML:
+<ul>
+<li> opening tag without its closing tag
+<li> closing tag without its opening tag
+<li> any of these tags: "base", "basefont", "head", "html", "body", "applet", "object", "iframe", "frame", "frameset", "script", "layer", "ilayer", "embed", "bgsound", "link", "meta", "style", "title", "blink", "xml" etc.
+<li> any of these attributes: on*, data*, dynsrc
+<li> javascript:/vbscript:/about: etc. protocols
+<li> expression/behavior etc. in styles
+<li> any other active content
+</ul>
+<p>If you found any bugs in this parser, please inform me &mdash; ICQ:551593 or <a href=mailto:thingol at mail.ru>thingol at mail.ru</a> - Roman Ivanov.
+
+<form method="post" action="<?php echo $_SERVER["PHP_SELF"];?>">
+<textarea name="html" rows="10" cols="100">
+<?
+if (isset($_POST["html"])) 
+{
+ $_POST["html"] = stripslashes($_POST["html"]);
+ echo htmlspecialchars($_POST["html"]);
+}
+?>
+</textarea>
+<input type="submit">
+</form>
+<?php
+require_once('classes/safehtml.php');
+
+function getmicrotime(){ 
+  list($usec, $sec) = explode(" ",microtime()); 
+  return ((float)$usec + (float)$sec); 
+}
+
+
+if (isset($_POST["html"])) 
+{
+ $doc=$_POST["html"];
+
+ // Instantiate the handler
+ $safehtml =& new safehtml();
+
+ echo ('<pre>');
+ // Time HTMLSax
+ $start = getmicrotime();
+ $result = $safehtml->parse($doc);
+ echo ( "Parsing took seconds:\t\t".(getmicrotime()-$start) );
+ echo ('</pre>');
+
+ echo ('<b>Source code after filtration:</b><br/>');
+ echo ( htmlspecialchars($result) );
+
+ echo ('<p><b>Code after filtration as is (HTML):</b><br/>');
+ echo ( $result );
+}
+?>
+<hr>
+<h3>Many thanks:</h3>
+<ul>
+<li> HTMLSax authors
+<li> lj user=BOLK
+<li> lj user=ati & lj user=curiousweasel
+<li> lj user=teplorod
+<li> Boris Bogdanov
+<li> Mash
+<li> lj user=electrocat
+<li> shmel
+<li> John "Gozzy" Godsland
+<li> Christian Stocker
+<li> Nick Cleaton
+</ul>
+<hr /> <a href="http://pixel-apes.com/safehtml">Download Safehtml</a>.
+<br /> Copyright &copy; 2004-2005, Roman Ivanov.
+<br /> All rights reserved.
+
+</body>
+</html>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -26,6 +26,11 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+    // Define the path to XML HTML SAX 3 (needed for safehtml)
+    if ( ! defined( 'XML_HTMLSAX3' ) ) {
+        define( 'XML_HTMLSAX3', YD_DIR_HOME . '/3rdparty/safehtml/classes/' );
+    }
+
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDRequest.php');
 
@@ -161,6 +166,7 @@
             $this->registerFilter( 'upper', 'strtoupper' );
             $this->registerFilter( 'utf8_decode', 'utf8_decode' );
             $this->registerFilter( 'strip_html', 'strip_tags' );
+            $this->registerFilter( 'safe_html', 'YDFormFilter_safe_html' );
 
             // Add the renderers
             $this->registerRenderer( 'array', 'YDFormRenderer_array', 'YDFormRenderer_array.php' );
@@ -1535,4 +1541,35 @@
 
     }
 
+    /**
+     *  This filter checks data for any possible XSS HTML code.
+     *
+     *  It basically does the following:
+     *  * opening tag without its closing tag
+     *  * closing tag without its opening tag
+     *  * any of these tags: "base", "basefont", "head", "html", "body", "applet", "object", 
+     *    "iframe", "frame", "frameset", "script", "layer", "ilayer", "embed", "bgsound", 
+     *    "link", "meta", "style", "title", "blink", "xml" etc.
+     *  * any of these attributes: on*, data*, dynsrc
+     *  * javascript:/vbscript:/about: etc. protocols
+     *  * expression/behavior etc. in styles
+     *  * any other active content
+     *
+     *  @param  $data   The data to filter.
+     *
+     *  @returns The filtered data as a string.
+     */
+    function YDFormFilter_safe_html( $data ) {
+
+        // Include the safe_html library
+        require_once( YD_DIR_HOME . '/3rdparty/safehtml/classes/safehtml.php' );
+
+        // Instantiate the handler
+        $safehtml = & new safehtml();
+
+        // Return the filtered data
+        return $safehtml->parse( $data );
+
+    }
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/form.php
===================================================================
--- YDFramework2.0/trunk/examples/form.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/examples/form.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -51,6 +51,7 @@
 
             // Apply a filter
             $form->addFilter( 'name', 'trim' );
+            $form->addFilter( 'desc1', 'safe_html' );
 
             // Add a rule
             $form->addRule( 'name', 'required', 'Please enter your name' );
@@ -58,6 +59,9 @@
             // Process the form
             if ( $form->validate() ) {
 
+                // Show the form values
+                YDDebugUtil::dump( $form->getValues() );
+
                 // Mark the form as valid
                 $this->template->assign( 'formValid', true );
 

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-02-20 13:04:47 UTC (rev 1704)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-02-20 14:04:08 UTC (rev 1705)
@@ -74,6 +74,7 @@
 
                 // Add the filters
                 $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
+                $form->addFilter( 'comment', 'safe_html' );
 
                 // Process the form
                 if ( $form->validate() === true ) {



From ydfpoi at gmail.com  Mon Feb 20 21:40:59 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Mon, 20 Feb 2006 21:40:59 +0100
Subject: [ydf-devel] Weblog: cookies and admin login
Message-ID: <306340e00602201240o32cd8739l@mail.gmail.com>

Hi Pieter,

I upgraded from build 1689 to 1705 and i can't log in as admin in Weblog now.

After browsing and testing the code i found that in build 1704 you
added a function called _getCookiePath to the YDWeblogAdminRequest
class.
Inside this function it may happens that "dirname( YD_SELF_SCRIPT )"
returns '/' (or '\' on windows).
As a '/' is always appended to the latter expression the weblog admin
login page sets my YD_USER_PASS and YD_USER_NAME cookies path to '\/'
(2 chars, not vee) and, as a result, i can't log in as an admin
because these cookies are not found :-(

Imho the _getCookiePath function should return '/' rather than '//' or
'\/' for cookie path to be correctly set.

Can you fix this please?

Kind regards
--
po?


From ydfpoi at gmail.com  Mon Feb 20 22:33:42 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Mon, 20 Feb 2006 22:33:42 +0100
Subject: [ydf-devel] typo in weblog/skins/default/__std_sidebar.tpl
Message-ID: <306340e00602201333u6f1a08b8i@mail.gmail.com>

In file weblog/skins/default/__std_sidebar.tpl, line 55:

</br> should be <br />

By the way, shouldn't there be two list items rather than a line break?

Kind regards (from the hair cutter ;-)
--
po?


From pclaerhout at berlios.de  Tue Feb 21 08:56:43 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 08:56:43 +0100
Subject: [ydf-devel] r1706 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602210756.k1L7uhhP031437@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 08:56:06 +0100 (Tue, 21 Feb 2006)
New Revision: 1706

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl
Log:
Fixed the HTML markup for the username/login buttons in the sidebar.

Bug #6526

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl	2006-02-20 14:04:08 UTC (rev 1705)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/__std_sidebar.tpl	2006-02-21 07:56:06 UTC (rev 1706)
@@ -49,15 +49,12 @@
         <li>
             <h2>{if $user.name}{$user.name}{else}{t w="admin"}{/if}</h2>
             <ul>
-                <li>
-                    {if $user.name}
-                        <a href="manage/index.php">{t w="a_admin_home"}</a>
-                        </br>
-                        <a href="manage/index.php?do=logout">{t w="a_logoff"}</a>
-                    {else}
-                        <a href="manage/index.php">{t w="login"}</a>
-                    {/if}
-                </li>
+                {if $user.name}
+                    <li><a href="manage/index.php">{t w="a_admin_home"}</a></li>
+                    <li><a href="manage/index.php?do=logout">{t w="a_logoff"}</a></li>
+                {else}
+                    <li><a href="manage/index.php">{t w="login"}</a></li>
+                {/if}
             </ul>
         </li>
 



From pieter at yellowduck.be  Tue Feb 21 08:57:36 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 21 Feb 2006 08:57:36 +0100
Subject: [ydf-devel] typo in weblog/skins/default/__std_sidebar.tpl
In-Reply-To: <306340e00602201333u6f1a08b8i@mail.gmail.com>
References: <306340e00602201333u6f1a08b8i@mail.gmail.com>
Message-ID: <4aef63030602202357y5b16996fl93f6d55f9094e9dc@mail.gmail.com>

Fixed in build 1706.

pieter

On 2/20/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> In file weblog/skins/default/__std_sidebar.tpl, line 55:
>
> </br> should be <br />
>
> By the way, shouldn't there be two list items rather than a line break?
>
> Kind regards (from the hair cutter ;-)
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060221/7bb74a6e/attachment.html>

From pclaerhout at berlios.de  Tue Feb 21 09:00:11 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 09:00:11 +0100
Subject: [ydf-devel] r1707 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602210800.k1L80BYo032102@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 09:00:03 +0100 (Tue, 21 Feb 2006)
New Revision: 1707

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items.php
Log:
The form defaults for new items are now set correctly. The defaults are now:
- Allow comments: on
- Auto close items: on
- Is draft: off

Bug #6525

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-21 07:56:06 UTC (rev 1706)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-21 08:00:03 UTC (rev 1707)
@@ -77,6 +77,11 @@
                 // Set the defaults
                 $form->setDefaults( $defaults );
 
+            } else {
+
+                // Set the form defaults
+                $form->setDefaults( array( 'allow_comments' => 1, 'auto_close' => 1, 'is_draft' => 0 ) );
+
             }
 
             // Process the form



From pclaerhout at berlios.de  Tue Feb 21 09:04:47 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 09:04:47 +0100
Subject: [ydf-devel] r1708 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602210804.k1L84lrN001591@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 09:04:45 +0100 (Tue, 21 Feb 2006)
New Revision: 1708

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
Log:
Fixed the YDWeblogAdminRequest::_getCookiePath function so that it returns a valid path in all cases. 
It now strips unneeded characters and makes sure the path ends with a forward slash.
If the path is empty, it now correctly return the root (single forward slash).

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-21 08:00:03 UTC (rev 1707)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-21 08:04:45 UTC (rev 1708)
@@ -335,11 +335,20 @@
 
         // Function to get the cookie path
         function _getCookiePath() {
+
+            // Get the path
             if ( YDStringUtil::endsWith( dirname( YD_SELF_SCRIPT ), '/manage' ) ) {
-                return dirname( dirname( YD_SELF_SCRIPT ) ) . '/';
+                $cookiePath = dirname( dirname( YD_SELF_SCRIPT ) );
             } else {
-                return dirname( YD_SELF_SCRIPT ) . '/';
+                $cookiePath =  dirname( YD_SELF_SCRIPT );
             }
+
+            // Trim the unneeded characters
+            $cookiePath = str_replace( '\\', '/', rtrim( $cookiePath, '/' ) );
+
+            // Return the cookie path
+            return $cookiePath . '/';
+
         }
 
         // The login action



From pieter at yellowduck.be  Tue Feb 21 09:05:35 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 21 Feb 2006 09:05:35 +0100
Subject: [ydf-devel] Weblog: cookies and admin login
In-Reply-To: <306340e00602201240o32cd8739l@mail.gmail.com>
References: <306340e00602201240o32cd8739l@mail.gmail.com>
Message-ID: <4aef63030602210005l5115fa0ax803d168253d07137@mail.gmail.com>

Fixed in build 1708.

pieter

On 2/20/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter,
>
> I upgraded from build 1689 to 1705 and i can't log in as admin in Weblog
> now.
>
> After browsing and testing the code i found that in build 1704 you
> added a function called _getCookiePath to the YDWeblogAdminRequest
> class.
> Inside this function it may happens that "dirname( YD_SELF_SCRIPT )"
> returns '/' (or '\' on windows).
> As a '/' is always appended to the latter expression the weblog admin
> login page sets my YD_USER_PASS and YD_USER_NAME cookies path to '\/'
> (2 chars, not vee) and, as a result, i can't log in as an admin
> because these cookies are not found :-(
>
> Imho the _getCookiePath function should return '/' rather than '//' or
> '\/' for cookie path to be correctly set.
>
> Can you fix this please?
>
> Kind regards
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060221/c8298e1f/attachment.html>

From pclaerhout at berlios.de  Tue Feb 21 10:43:17 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 10:43:17 +0100
Subject: [ydf-devel] r1709 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples
Message-ID: <200602210943.k1L9hHF1006802@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 10:42:48 +0100 (Tue, 21 Feb 2006)
New Revision: 1709

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
   YDFramework2.0/trunk/examples/db_metadata.db
   YDFramework2.0/trunk/examples/db_metadata.php
Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added the YDDatabaseMetaData class which you can use to:
- List tables in a database
- List fields in a database table
- List indexes in a database table.

I also added an example on how to use the class.

Feature Request #1772

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-21 08:04:45 UTC (rev 1708)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-21 09:42:48 UTC (rev 1709)
@@ -0,0 +1,232 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
+
+    /**
+     *  This class allows you to query the internal metadata from a database. It allows you to list tables, fields and
+     *  indexes for all supported database engines in the Yellow Duck Framework.
+     */
+    class YDDatabaseMetaData extends YDBase {
+
+        /**
+         *  Constructor. Set the database connection
+         *
+         *  @param $db             The YDDatabase object pointing to the database
+         */
+        function YDDatabaseMetaData( $db ) {
+            $this->db    = $db;
+        }
+
+        /**
+         *  This function lists the tables available for the current user in the database.
+         *
+         *  @returns The names of the tables as an array.
+         */
+        function getTables() {
+
+            // Start with an empty array
+            $tables = array();
+
+            // Check the database type
+            switch ( $this->db->getDriver() ) {
+
+                // MySQL
+                case 'mysql':
+                    $sql = 'show tables from ' . $this->db->getDatabase();
+                    $tables = $this->db->getValuesByName( $sql, 'tables_in_' . $this->db->getDatabase() );
+                    $tables = array_map( 'strtolower', $tables );
+                    break;
+
+                // PostgreSQL
+                case 'postgres':
+                    $sql = 'SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace '
+                         . 'WHERE c.relkind IN (\'r\',\'\') AND n.nspname NOT IN (\'pg_catalog\', \'pg_toast\') '
+                         . 'AND pg_catalog.pg_table_is_visible(c.oid)';
+                    $tables = $this->db->getValuesByName( $sql, 'relname' );
+                    break;
+
+                // Oracle
+                case 'oracle':
+                    $sql = 'select lower( table_name ) as table_name from user_tables';
+                    $tables = $this->db->getValuesByName( $sql, 'table_name' );
+                    break;
+
+                // SQLite
+                case 'sqlite':
+                    $sql = 'select lower( name ) as name from sqlite_master where type = \'table\'';
+                    $tables = $this->db->getValuesByName( $sql, 'name' );
+                    break;
+
+                // Default
+                default:
+                    trigger_error( $this->db->getDriver() . ' is not a supported database driver.', YD_ERROR );
+
+            }
+
+            // Return the list of tables
+            return $tables;
+
+        }
+
+        /**
+         *  This function lists the fields available in the specified table.
+         *
+         *  @param $table   The name of the table.
+         *
+         *  @returns The names of the fields in the table as an array.
+         */
+        function getFields( $table ) {
+
+            // Add the prefix to the table
+            $table = $this->_prefixTable( $table );
+
+            // Start with an empty array
+            $fields = array();
+
+            // Check the database type
+            switch ( $this->db->getDriver() ) {
+
+                // MySQL
+                case 'mysql':
+                    $sql = 'SHOW FIELDS FROM ' . $table;
+                    $fields = $this->db->getValuesByName( $sql, 'field' );
+                    $fields = array_map( 'strtolower', $fields );
+                    break;
+
+                // PostgreSQL
+                case 'postgres':
+                    $sql = 'SELECT a.attname FROM pg_catalog.pg_attribute a '
+                         . 'LEFT JOIN pg_catalog.pg_class c ON a.attrelid = c.oid '
+                         . 'WHERE c.relname = lower( \'' . $table . '\') AND a.attnum > 0 AND NOT a.attisdropped;';
+                    $fields = $this->db->getValuesByName( $sql, 'attname' );
+                    break;
+
+                // Oracle
+                case 'oracle':
+                    $sql = 'select lower( column_name ) as column_name from sys.dba_tab_columns where table_name = upper( \'' . $table . '\' )';
+                    $fields = $this->db->getValuesByName( $sql, 'column_name' );
+                    break;
+
+                // SQLite
+                case 'sqlite':
+                    $sql = 'PRAGMA table_info( \'' . $table . '\' )';
+                    $fields = $this->db->getValuesByName( $sql, 'name' );
+                    $fields = array_map( 'strtolower', $fields );
+                    break;
+
+                // Default
+                default:
+                    trigger_error( $this->db->getDriver() . ' is not a supported database driver.', YD_ERROR );
+
+            }
+
+            // Return the list of tables
+            return $fields;
+
+        }
+
+        /**
+         *  This function lists the indexes available in the specified table.
+         *
+         *  @param $table   The name of the table.
+         *
+         *  @returns The names of the indexes in the table as an array.
+         */
+        function getIndexes( $table ) {
+
+            // Add the prefix to the table
+            $table = $this->_prefixTable( $table );
+
+            // Start with an empty array
+            $indexes = array();
+
+            // Check the database type
+            switch ( $this->db->getDriver() ) {
+
+                // MySQL
+                case 'mysql':
+                    $sql = 'SHOW KEYS FROM ' . $table;
+                    $indexes = $this->db->getValuesByName( $sql, 'key_name' );
+                    $indexes = array_map( 'strtolower', $indexes );
+                    break;
+
+                // PostgreSQL
+                case 'postgres':
+                    $sql = 'select c.relname from pg_catalog.pg_class c '
+                         . 'LEFT JOIN pg_catalog.pg_roles r ON r.oid = c.relowner '
+                         . 'LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace '
+                         . 'LEFT JOIN pg_catalog.pg_index i ON i.indexrelid = c.oid '
+                         . 'LEFT JOIN pg_catalog.pg_class c2 ON i.indrelid = c2.oid '
+                         . 'WHERE c.relkind IN (\'i\',\'\') '
+                         . 'AND n.nspname NOT IN (\'pg_catalog\', \'pg_toast\') '
+                         . 'AND pg_catalog.pg_table_is_visible(c.oid) '
+                         . 'and c2.relname = lower( \'' . $table . '\' )';
+                    $indexes = $this->db->getValuesByName( $sql, 'relname' );
+                    break;
+
+                // Oracle
+                case 'oracle':
+                    $sql = 'select lower( index_name ) as index_name from user_indexes where table_name = upper( \'' . $table . '\' )';
+                    $indexes = $this->db->getValuesByName( $sql, 'index_name' );
+                    break;
+
+                // SQLite
+                case 'sqlite':
+                    $sql = 'select lower( name ) as name from sqlite_master where type = \'index\'';
+                    $indexes = $this->db->getValuesByName( $sql, 'name' );
+                    break;
+
+                // Default
+                default:
+                    trigger_error( $this->db->getDriver() . ' is not a supported database driver.', YD_ERROR );
+
+            }
+
+            // Return the list of tables
+            return $indexes;
+
+        }
+
+        /**
+         *  Internal function to update the table name with the prefix
+         *
+         *  @param $table   The name of the table
+         *
+         *  @returns The table name with the prefix.
+         *
+         *  @internal
+         */
+        function _prefixTable( $table ) {
+            return YDConfig::get( 'YD_DB_TABLEPREFIX', '' ) . $table;
+        }
+
+    }
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/db_metadata.db
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/db_metadata.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/db_metadata.php
===================================================================
--- YDFramework2.0/trunk/examples/db_metadata.php	2006-02-21 08:04:45 UTC (rev 1708)
+++ YDFramework2.0/trunk/examples/db_metadata.php	2006-02-21 09:42:48 UTC (rev 1709)
@@ -0,0 +1,59 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDDatabaseMetaData.php' );
+
+    // Class definition
+    class db_metadata extends YDRequest {
+
+        // Class constructor
+        function db_metadata() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Get the database connections
+            $db1 = YDDatabase::getInstance( 'mysql', 'ydweblog', 'root', '', 'localhost' );
+            $db2 = YDDatabase::getInstance( 'oracle', 'creodb_directeur', 'prinergy', 'araxi' );
+            $db3 = YDDatabase::getInstance( 'postgres', 'test_db', 'postgres', 'Ster4484', 'localhost' );
+            $db4 = YDDatabase::getInstance( 'sqlite', 'db_metadata.db' );
+
+            // Get the metadata
+            $db1_meta = new YDDatabaseMetaData( $db1 );
+            $db2_meta = new YDDatabaseMetaData( $db2 );
+            $db3_meta = new YDDatabaseMetaData( $db3 );
+            $db4_meta = new YDDatabaseMetaData( $db4 );
+
+            // Get the list of tables
+            YDDebugUtil::dump( $db1_meta->getTables(), 'mysql - getTables' );
+            YDDebugUtil::dump( $db2_meta->getTables(), 'oracle - getTables' );
+            YDDebugUtil::dump( $db3_meta->getTables(), 'postgres - getTables' );
+            YDDebugUtil::dump( $db4_meta->getTables(), 'sqlite - getTables' );
+
+            // Get the list of fields for a table
+            YDDebugUtil::dump( $db1_meta->getFields( 'ydw_items' ), 'mysql - getFields' );
+            YDDebugUtil::dump( $db2_meta->getFields( 'dbcs_jacket' ), 'oracle - getFields' );
+            YDDebugUtil::dump( $db3_meta->getFields(), 'postgres - getFields' );
+            YDDebugUtil::dump( $db4_meta->getFields( 'notes' ), 'sqlite - getFields' );
+
+            // Get the list of indexes for a table
+            YDDebugUtil::dump( $db1_meta->getIndexes( 'ydw_items' ), 'mysql - getIndexes' );
+            YDDebugUtil::dump( $db2_meta->getIndexes( 'dbcs_jacket' ), 'oracle - getIndexes' );
+            YDDebugUtil::dump( $db3_meta->getIndexes(), 'postgres - getIndexes' );
+            YDDebugUtil::dump( $db4_meta->getIndexes( 'notes' ), 'sqlite - getIndexes' );
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-02-21 08:04:45 UTC (rev 1708)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-02-21 09:42:48 UTC (rev 1709)
@@ -316,7 +316,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="10" valign="top">
+            <td rowspan="11" valign="top">
             <p>&nbsp;</p></td>
             <td valign="top"><a href="database.php">Database connectivity - Native functions</a> </td>
             <td valign="top">
@@ -393,6 +393,14 @@
             </td>
         </tr>
         <tr>
+            <td valign="top">
+                <a href="db_metadata.php">Querying database metadata</a><br/>
+            </td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=db_metadata.php">db_metadata.php</a>
+            </td>
+        </tr>
+        <tr>
             <td colspan="2"><b>&nbsp;<br/>Using files, images and directories</b></td>
             <td width="43%"><b>&nbsp;</b></td>
         </tr>



From pclaerhout at berlios.de  Tue Feb 21 14:55:50 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 14:55:50 +0100
Subject: [ydf-devel] r1710 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602211355.k1LDtoVa031545@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 14:55:46 +0100 (Tue, 21 Feb 2006)
New Revision: 1710

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
If the totalPages variables of a YDRecordSet object is 0, the setTotalRows function no longer returns an error.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-21 09:42:48 UTC (rev 1709)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-21 13:55:46 UTC (rev 1710)
@@ -183,18 +183,17 @@
          */
         function setTotalRows( $value, $offset=false ) {
 
-            //// Return if total is 0
-            //if ( strval( $value ) == '0' ) {
-            //    return;
-            //}
-
             // Set the number of records an integer
             $value = intval( $value );
-            
+
             // Get the number of pages
-            $this->totalPages = ceil( $value / ( float ) $this->pagesize );
+            if ( $this->pagesize == 0 ) {
+                $this->totalPages = 1;
+            } else {
+                $this->totalPages = ceil( $value / ( float ) $this->pagesize );
+            }
             $this->totalRows  = $value;
-            
+
             // Get the original page number
             $this->page = $this->pageorig;
             



From pclaerhout at berlios.de  Tue Feb 21 16:45:46 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Feb 2006 16:45:46 +0100
Subject: [ydf-devel] r1711 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602211545.k1LFjkLA025879@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-21 16:45:45 +0100 (Tue, 21 Feb 2006)
New Revision: 1711

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
   YDFramework2.0/trunk/examples/weblog/manage/images.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/manage/links.tpl
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
Log:
Updated the management interface to shown/hide the browser bars properly. This was changed since our last change in the YDRecordSet class.

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,7 +20,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $categories->pages}
+        {if $categories->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="3">
                     <p class="subline">

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -22,7 +22,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $comments->pages}
+        {if $comments->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="4">
                     <p class="subline">

Modified: YDFramework2.0/trunk/examples/weblog/manage/images.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/images.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/images.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,7 +20,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $images->pages}
+        {if $images->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="7">
                     <p class="subline">

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,7 +20,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $items->pages}
+        {if $items->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="4">
                     <p class="subline">

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,9 +20,9 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $images->pages}
+        {if $images->totalPages > 1}
             <tr>
-                <td class="adminRowR" colspan="5">
+                <td class="adminRowR" colspan="7">
                     <p class="subline">
                     {if ! $images->isFirstPage}
                         <a href="{$images->getPreviousUrl()}" class="subline">&laquo;</a>

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,7 +20,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $links->pages}
+        {if $links->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="4">
                     <p class="subline">

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-02-21 13:55:46 UTC (rev 1710)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-02-21 15:45:45 UTC (rev 1711)
@@ -20,7 +20,7 @@
 {if $YD_ACTION == 'default'}
 
     {capture assign="browsebar"}
-        {if $pages->pages}
+        {if $pages->totalPages > 1}
             <tr>
                 <td class="adminRowR" colspan="4">
                     <p class="subline">



From pclaerhout at berlios.de  Wed Feb 22 10:04:16 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 10:04:16 +0100
Subject: [ydf-devel] r1712 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200602220904.k1M94Gc7008360@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 10:04:06 +0100 (Wed, 22 Feb 2006)
New Revision: 1712

Modified:
   YDFramework2.0/trunk/examples/weblog/index.php
Log:
Added support for index.php?itemid=x type of URLs (useful if you used to be running Nucleus e.g.).

Modified: YDFramework2.0/trunk/examples/weblog/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/index.php	2006-02-21 15:45:45 UTC (rev 1711)
+++ YDFramework2.0/trunk/examples/weblog/index.php	2006-02-22 09:04:06 UTC (rev 1712)
@@ -20,6 +20,12 @@
                 $this->redirect( 'item.php?id=' . $id );
             }
 
+            // Add support for itemid query strings
+            $id = @is_numeric( $_GET['itemid'] ) ? intval( $_GET['itemid'] ) : -1;
+            if ( $id != -1 ) {
+                $this->redirect( 'item.php?id=' . $id );
+            }
+
             // Get the weblog items and 5 older items
             $items     = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
             $old_items = $this->weblog->getPublicItems( 5, sizeof( $items ) );



From pclaerhout at berlios.de  Wed Feb 22 13:29:22 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 13:29:22 +0100
Subject: [ydf-devel] r1713 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602221229.k1MCTM5A000614@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 13:29:19 +0100 (Wed, 22 Feb 2006)
New Revision: 1713

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
Log:
Fixed a bug in YDDatabaseMetaData where the table prefix would not correctly be added to the table name.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-22 09:04:06 UTC (rev 1712)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-22 12:29:19 UTC (rev 1713)
@@ -224,7 +224,7 @@
          *  @internal
          */
         function _prefixTable( $table ) {
-            return YDConfig::get( 'YD_DB_TABLEPREFIX', '' ) . $table;
+            return str_replace( '#_', YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $table );
         }
 
     }



From pclaerhout at berlios.de  Wed Feb 22 13:30:27 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 13:30:27 +0100
Subject: [ydf-devel] r1714 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602221230.k1MCUR8P001216@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 13:30:21 +0100 (Wed, 22 Feb 2006)
New Revision: 1714

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
Log:
The YDWeblogAPI class now uses the YDDatabaseMetaData class for checking fields and indexes.

Feature Request #1840

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-22 12:29:19 UTC (rev 1713)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-22 12:30:21 UTC (rev 1714)
@@ -82,53 +82,34 @@
                 YDConfig::get( 'db_pass', '' ), YDConfig::get( 'db_host', 'localhost' )
             );
 
+            // Get a link to the database metadata
+            $dbmeta = new YDDatabaseMetaData( $this->db );
+
             // Add any missing items field
-            $fields = $this->db->getValuesByName( 'show fields from #_items', 'field' );
-            if ( ! in_array( 'body_more', $fields ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
-            }
-            if ( ! in_array( 'allow_comments', $fields ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
-            }
-            if ( ! in_array( 'auto_close', $fields ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
-            }
-            if ( ! in_array( 'is_draft', $fields ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
-            }
+            $fields = $dbmeta->getFields( '#_items' );
+            $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
+            $this->executeIfMissing( 'allow_comments', $fields, 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
+            $this->executeIfMissing( 'auto_close', $fields, 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
+            $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
 
             // Add any missing pages field
-            $fields = $this->db->getValuesByName( 'show fields from #_pages', 'field' );
-            if ( ! in_array( 'is_draft', $fields ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
-            }
+            $fields = $dbmeta->getFields( '#_pages' );
+            $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
 
             // Get the list of indexes for the items table
-            $indexes = $this->db->getValuesByName( 'show keys from #_items', 'key_name' );
-            if ( ! in_array( 'allow_comments', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
-            }
-            if ( ! in_array( 'auto_close', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
-            }
-            if ( ! in_array( 'is_draft', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
-            }
+            $indexes = $dbmeta->getIndexes( '#_items' );
+            $this->executeIfMissing( 'allow_comments', $indexes, 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
+            $this->executeIfMissing( 'auto_close', $indexes, 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
+            $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
 
-            // Get the list of indexes for the items table
-            $indexes = $this->db->getValuesByName( 'show keys from #_pages', 'key_name' );
-            if ( ! in_array( 'is_draft', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_pages ADD INDEX is_draft (is_draft)' );
-            }
+            // Get the list of indexes for the pages table
+            $indexes = $dbmeta->getIndexes( '#_pages' );
+            $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_pages ADD INDEX is_draft (is_draft)' );
 
-            // Get the list of indexes
-            $indexes = $this->db->getValuesByName( 'show keys from #_users', 'key_name' );
-            if ( in_array( 'email', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_users DROP INDEX email' );
-            }
-            if ( ! in_array( 'name', $indexes ) ) {
-                $this->db->executeSql( 'ALTER TABLE #_users ADD UNIQUE name (name)' );
-            }
+            // Get the list of indexes for the users table
+            $indexes = $dbmeta->getIndexes( '#_users' );
+            $this->executeIfPresent( 'email', $indexes, 'ALTER TABLE #_users DROP INDEX email' );
+            $this->executeIfMissing( 'name',  $indexes, 'ALTER TABLE #_users ADD UNIQUE name (name)' );
 
             // Auto close the old items if needed
             $auto_close_items = YDConfig::get( 'auto_close_items', '' );
@@ -145,6 +126,20 @@
 
         }
 
+        // Function to execute SQL if the item is missing
+        function executeIfMissing( $needle, $haystack, $sql ) {
+            if ( ! in_array( $needle, $haystack ) ) {
+                $this->db->executeSql( $sql );
+            }
+        }
+
+        // Function to execute SQL if the item is not missing
+        function executeIfPresent( $needle, $haystack, $sql ) {
+            if ( in_array( $needle, $haystack ) ) {
+                $this->db->executeSql( $sql );
+            }
+        }
+
         // Function to log a request to the statistics
         function logRequestToStats( $values ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-22 12:29:19 UTC (rev 1713)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-22 12:30:21 UTC (rev 1714)
@@ -74,6 +74,7 @@
     YDInclude( 'YDBBCode.php' );
     YDInclude( 'YDTemplate.php' );
     YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDDatabaseMetaData.php' );
     YDInclude( 'YDFileSystem.php' );
     YDInclude( 'YDFormElements/YDFormElement_BBTextArea.php' );
 



From pclaerhout at berlios.de  Wed Feb 22 13:38:27 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 13:38:27 +0100
Subject: [ydf-devel] r1715 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602221238.k1MCcRXm005080@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 13:38:16 +0100 (Wed, 22 Feb 2006)
New Revision: 1715

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
When you save the config, a .htaccess file is now created if you enable friendly urls and the .htacess file is not there.

If there is a .htaccess file already, it will not get modified.

Bug #6537

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-22 12:30:21 UTC (rev 1714)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-22 12:38:16 UTC (rev 1715)
@@ -64,6 +64,29 @@
         // Set the right permissions
         @chmod( dirname( __FILE__ ) . '/config.php', 0700 );
 
+        // Create a .htaccess file if needed
+        $htaccessPath = dirname( dirname( __FILE__ ) ) . '/.htaccess';
+        if ( ! is_file( $htaccessPath ) ) {
+
+            // The htaccess data
+            $data = 'RewriteEngine on' . YD_CRLF;
+            $data .= 'Options +FollowSymlinks' . YD_CRLF;
+            $data .= 'RewriteRule ^item_([0-9]+).php?$ item.php?id=$1 [L]' . YD_CRLF;
+            $data .= 'RewriteRule ^page_([0-9]+).php?$ page.php?id=$1 [L]' . YD_CRLF;
+            $data .= 'RewriteRule ^category_([0-9]+).php?$ category.php?id=$1 [L]' . YD_CRLF;
+            $data .= 'RewriteRule ^link_([0-9]+).php?$ link.php?id=$1 [L]' . YD_CRLF;
+            $data .= 'RewriteRule ^image/(.*) item_gallery.php?id=$1 [L]' . YD_CRLF;
+
+            // Open the config file
+            $f = fopen( $htaccessPath, 'w' );
+            fwrite( $f, $data );
+            fclose( $f );
+
+            // Set the right permissions
+            @chmod( $htaccessPath, 0700 );
+
+        }
+
     }
 
     // Class defining our weblog API



From pclaerhout at berlios.de  Wed Feb 22 14:02:18 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 14:02:18 +0100
Subject: [ydf-devel] r1716 - in YDFramework2.0/trunk: YDFramework2/3rdparty YDFramework2/3rdparty/zip examples/weblog/manage
Message-ID: <200602221302.k1MD2IkC012174@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 14:01:53 +0100 (Wed, 22 Feb 2006)
New Revision: 1716

Added:
   YDFramework2.0/trunk/YDFramework2/3rdparty/zip/
   YDFramework2.0/trunk/YDFramework2/3rdparty/zip/unzip.lib.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/zip/zip.lib.php
Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
Log:
Added support for ZIP uploads in item galleries.

Feature Request #1747

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/zip/unzip.lib.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/zip/unzip.lib.php	2006-02-22 12:38:16 UTC (rev 1715)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/zip/unzip.lib.php	2006-02-22 13:01:53 UTC (rev 1716)
@@ -0,0 +1,492 @@
+<?PHP
+    /* $Id: unzip.lib.php,v 1.2 2006/01/17 17:02:31 cybot_tm Exp $ */
+
+    /**
+     *  ZIP file unpack classes. Contributed to the phpMyAdmin project.
+     *
+     *  @category   phpPublic
+     *  @package    File-Formats-ZIP
+     *  @subpackage Unzip
+     *  @filesource unzip.lib.php
+     *  @version    1.0.1
+     *
+     *  @author     Holger Boskugel <vbwebprofi at gmx.de>
+     *  @copyright  Copyright ? 2003, Holger Boskugel, Berlin, Germany
+     *  @license    http://opensource.org/licenses/gpl-license.php GNU Public License
+     *
+     *  @history
+     *  2003-12-02 - HB : Patched : naming bug : Time/Size of file
+     *                    Added   : ZIP file comment
+     *                    Added   : Check BZIP2 support of PHP
+     *  2003-11-29 - HB * Initial version
+     */
+
+    /**
+     *  Unzip class, which retrieves entries from ZIP files.
+     *
+     *  Supports only the compression modes
+     *  -  0 : Stored,
+     *  -  8 : Deflated and
+     *  - 12 : BZIP2
+     *
+     *  Based on :<BR>
+     *  <BR>
+     *  {@link http://www.pkware.com/products/enterprise/white_papers/appnote.html
+     *  * Official ZIP file format}<BR>
+     *  {@link http://msdn.microsoft.com/library/en-us/w98ddk/hh/w98ddk/storage_5l4m.asp
+     *  * Microsoft DOS date/time format}
+     *
+     *  @category   phpPublic
+     *  @package    File-Formats-ZIP
+     *  @subpackage Unzip
+     *  @version    1.0.1
+     *  @author     Holger Boskugel <vbwebprofi at gmx.de>
+     *  @uses       SimpleUnzipEntry
+     *  @example    example.unzip.php Two examples
+     */
+    class SimpleUnzip {
+// 2003-12-02 - HB >
+        /**
+         *  Array to store file entries
+         *
+         *  @var    string
+         *  @access public
+         *  @see    ReadFile()
+         *  @since  1.0.1
+         */
+        var $Comment = '';
+// 2003-12-02 - HB <
+
+        /**
+         *  Array to store file entries
+         *
+         *  @var    array
+         *  @access public
+         *  @see    ReadFile()
+         *  @since  1.0
+         */
+        var $Entries = array();
+
+        /**
+         *  Name of the ZIP file
+         *
+         *  @var    string
+         *  @access public
+         *  @see    ReadFile()
+         *  @since  1.0
+         */
+        var $Name = '';
+
+        /**
+         *  Size of the ZIP file
+         *
+         *  @var    integer
+         *  @access public
+         *  @see    ReadFile()
+         *  @since  1.0
+         */
+        var $Size = 0;
+
+        /**
+         *  Time of the ZIP file (unix timestamp)
+         *
+         *  @var    integer
+         *  @access public
+         *  @see    ReadFile()
+         *  @since  1.0
+         */
+        var $Time = 0;
+
+        /**
+         *  Contructor of the class
+         *
+         *  @param  string      File name
+         *  @return SimpleUnzip Instanced class
+         *  @access public
+         *  @uses   SimpleUnzip::ReadFile() Opens file on new if specified
+         *  @since  1.0
+         */
+        function SimpleUnzip($in_FileName = '')
+        {
+            if ($in_FileName !== '') {
+                SimpleUnzip::ReadFile($in_FileName);
+            }
+        } // end of the 'SimpleUnzip' constructor
+
+        /**
+         *  Counts the entries
+         *
+         *  @return integer Count of ZIP entries
+         *  @access public
+         *  @uses   $Entries
+         *  @since  1.0
+         */
+        function Count()
+        {
+            return count($this->Entries);
+        } // end of the 'Count()' method
+
+        /**
+         *  Gets data of the specified ZIP entry
+         *
+         *  @param  integer Index of the ZIP entry
+         *  @return mixed   Data for the ZIP entry
+         *  @uses   SimpleUnzipEntry::$Data
+         *  @access public
+         *  @since  1.0
+         */
+        function GetData($in_Index)
+        {
+            return $this->Entries[$in_Index]->Data;
+        } // end of the 'GetData()' method
+
+        /**
+         *  Gets an entry of the ZIP file
+         *
+         *  @param  integer             Index of the ZIP entry
+         *  @return SimpleUnzipEntry    Entry of the ZIP file
+         *  @uses   $Entries
+         *  @access public
+         *  @since  1.0
+         */
+        function GetEntry($in_Index)
+        {
+            return $this->Entries[$in_Index];
+        } // end of the 'GetEntry()' method
+
+        /**
+         *  Gets error code for the specified ZIP entry
+         *
+         *  @param  integer     Index of the ZIP entry
+         *  @return integer     Error code for the ZIP entry
+         *  @uses   SimpleUnzipEntry::$Error
+         *  @access public
+         *  @since   1.0
+         */
+        function GetError($in_Index)
+        {
+            return $this->Entries[$in_Index]->Error;
+        } // end of the 'GetError()' method
+
+        /**
+         *  Gets error message for the specified ZIP entry
+         *
+         *  @param  integer     Index of the ZIP entry
+         *  @return string      Error message for the ZIP entry
+         *  @uses   SimpleUnzipEntry::$ErrorMsg
+         *  @access public
+         *  @since  1.0
+         */
+        function GetErrorMsg($in_Index)
+        {
+            return $this->Entries[$in_Index]->ErrorMsg;
+        } // end of the 'GetErrorMsg()' method
+
+        /**
+         *  Gets file name for the specified ZIP entry
+         *
+         *  @param  integer     Index of the ZIP entry
+         *  @return string      File name for the ZIP entry
+         *  @uses   SimpleUnzipEntry::$Name
+         *  @access public
+         *  @since  1.0
+         */
+        function GetName($in_Index)
+        {
+            return $this->Entries[$in_Index]->Name;
+        } // end of the 'GetName()' method
+
+        /**
+         *  Gets path of the file for the specified ZIP entry
+         *
+         *  @param  integer     Index of the ZIP entry
+         *  @return string      Path of the file for the ZIP entry
+         *  @uses   SimpleUnzipEntry::$Path
+         *  @access public
+         *  @since  1.0
+         */
+        function GetPath($in_Index)
+        {
+            return $this->Entries[$in_Index]->Path;
+        } // end of the 'GetPath()' method
+
+        /**
+         *  Gets file time for the specified ZIP entry
+         *
+         *  @param  integer     Index of the ZIP entry
+         *  @return integer     File time for the ZIP entry (unix timestamp)
+         *  @uses   SimpleUnzipEntry::$Time
+         *  @access public
+         *  @since  1.0
+         */
+        function GetTime($in_Index)
+        {
+            return $this->Entries[$in_Index]->Time;
+        } // end of the 'GetTime()' method
+
+        /**
+         *  Reads ZIP file and extracts the entries
+         *
+         *  @param  string              File name of the ZIP archive
+         *  @return array               ZIP entry list (see also class variable {@link $Entries $Entries})
+         *  @uses   SimpleUnzipEntry    For the entries
+         *  @access public
+         *  @since  1.0
+         */
+        function ReadFile($in_FileName)
+        {
+            $this->Entries = array();
+
+            // Get file parameters
+            $this->Name = $in_FileName;
+            $this->Time = filemtime($in_FileName);
+            $this->Size = filesize($in_FileName);
+
+            // Read file
+            $oF = fopen($in_FileName, 'rb');
+            $vZ = fread($oF, $this->Size);
+            fclose($oF);
+
+// 2003-12-02 - HB >
+            // Cut end of central directory
+            $aE = explode("\x50\x4b\x05\x06", $vZ);
+
+            // Easiest way, but not sure if format changes
+            //$this->Comment = substr($aE[1], 18);
+
+            // Normal way
+            $aP = unpack('x16/v1CL', $aE[1]);
+            $this->Comment = substr($aE[1], 18, $aP['CL']);
+
+            // Translates end of line from other operating systems
+            $this->Comment = strtr($this->Comment, array("\r\n" => "\n",
+                                                         "\r"   => "\n"));
+// 2003-12-02 - HB <
+
+            // Cut the entries from the central directory
+            $aE = explode("\x50\x4b\x01\x02", $vZ);
+            // Explode to each part
+            $aE = explode("\x50\x4b\x03\x04", $aE[0]);
+            // Shift out spanning signature or empty entry
+            array_shift($aE);
+
+            // Loop through the entries
+            foreach ($aE as $vZ) {
+                $aI = array();
+                $aI['E']  = 0;
+                $aI['EM'] = '';
+                // Retrieving local file header information
+                $aP = unpack('v1VN/v1GPF/v1CM/v1FT/v1FD/V1CRC/V1CS/V1UCS/v1FNL', $vZ);
+                // Check if data is encrypted
+                $bE = ($aP['GPF'] && 0x0001) ? TRUE : FALSE;
+                $nF = $aP['FNL'];
+
+                // Special case : value block after the compressed data
+                if ($aP['GPF'] & 0x0008) {
+                    $aP1 = unpack('V1CRC/V1CS/V1UCS', substr($vZ, -12));
+
+                    $aP['CRC'] = $aP1['CRC'];
+                    $aP['CS']  = $aP1['CS'];
+                    $aP['UCS'] = $aP1['UCS'];
+
+                    $vZ = substr($vZ, 0, -12);
+                }
+
+                // Getting stored filename
+                $aI['N'] = substr($vZ, 26, $nF);
+
+                if (substr($aI['N'], -1) == '/') {
+                    // is a directory entry - will be skipped
+                    continue;
+                }
+
+                // Truncate full filename in path and filename
+                $aI['P'] = dirname($aI['N']);
+                $aI['P'] = $aI['P'] == '.' ? '' : $aI['P'];
+                $aI['N'] = basename($aI['N']);
+
+                $vZ = substr($vZ, 26 + $nF);
+
+                if (strlen($vZ) != $aP['CS']) {
+                  $aI['E']  = 1;
+                  $aI['EM'] = 'Compressed size is not equal with the value in header information.';
+                } else {
+                    if ($bE) {
+                        $aI['E']  = 5;
+                        $aI['EM'] = 'File is encrypted, which is not supported from this class.';
+                    } else {
+                        switch($aP['CM']) {
+                            case 0: // Stored
+                                // Here is nothing to do, the file ist flat.
+                                break;
+
+                            case 8: // Deflated
+                                $vZ = gzinflate($vZ);
+                                break;
+
+                            case 12: // BZIP2
+// 2003-12-02 - HB >
+                                if (! extension_loaded('bz2')) {
+                                    if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') {
+                                      @dl('php_bz2.dll');
+                                    } else {
+                                      @dl('bz2.so');
+                                    }
+                                }
+
+                                if (extension_loaded('bz2')) {
+// 2003-12-02 - HB <
+                                    $vZ = bzdecompress($vZ);
+// 2003-12-02 - HB >
+                                } else {
+                                    $aI['E']  = 7;
+                                    $aI['EM'] = "PHP BZIP2 extension not available.";
+                                }
+// 2003-12-02 - HB <
+
+                                break;
+
+                            default:
+                              $aI['E']  = 6;
+                              $aI['EM'] = "De-/Compression method {$aP['CM']} is not supported.";
+                        }
+
+// 2003-12-02 - HB >
+                        if (! $aI['E']) {
+// 2003-12-02 - HB <
+                            if ($vZ === FALSE) {
+                                $aI['E']  = 2;
+                                $aI['EM'] = 'Decompression of data failed.';
+                            } else {
+                                if (strlen($vZ) != $aP['UCS']) {
+                                    $aI['E']  = 3;
+                                    $aI['EM'] = 'Uncompressed size is not equal with the value in header information.';
+                                } else {
+                                    if (crc32($vZ) != $aP['CRC']) {
+                                        $aI['E']  = 4;
+                                        $aI['EM'] = 'CRC32 checksum is not equal with the value in header information.';
+                                    }
+                                }
+                            }
+// 2003-12-02 - HB >
+                        }
+// 2003-12-02 - HB <
+                    }
+                }
+
+                $aI['D'] = $vZ;
+
+                // DOS to UNIX timestamp
+                $aI['T'] = mktime(($aP['FT']  & 0xf800) >> 11,
+                                  ($aP['FT']  & 0x07e0) >>  5,
+                                  ($aP['FT']  & 0x001f) <<  1,
+                                  ($aP['FD']  & 0x01e0) >>  5,
+                                  ($aP['FD']  & 0x001f),
+                                  (($aP['FD'] & 0xfe00) >>  9) + 1980);
+
+                $this->Entries[] = &new SimpleUnzipEntry($aI);
+            } // end for each entries
+
+            return $this->Entries;
+        } // end of the 'ReadFile()' method
+    } // end of the 'SimpleUnzip' class
+
+    /**
+     *  Entry of the ZIP file.
+     *
+     *  @category   phpPublic
+     *  @package    File-Formats-ZIP
+     *  @subpackage Unzip
+     *  @version    1.0
+     *  @author     Holger Boskugel <vbwebprofi at gmx.de>
+     *  @example    example.unzip.php Two examples
+     */
+    class SimpleUnzipEntry {
+        /**
+         *  Data of the file entry
+         *
+         *  @var    mixed
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $Data = '';
+
+        /**
+         *  Error of the file entry
+         *
+         *  - 0 : No error raised.<BR>
+         *  - 1 : Compressed size is not equal with the value in header information.<BR>
+         *  - 2 : Decompression of data failed.<BR>
+         *  - 3 : Uncompressed size is not equal with the value in header information.<BR>
+         *  - 4 : CRC32 checksum is not equal with the value in header information.<BR>
+         *  - 5 : File is encrypted, which is not supported from this class.<BR>
+         *  - 6 : De-/Compression method ... is not supported.<BR>
+         *  - 7 : PHP BZIP2 extension not available.
+         *
+         *  @var    integer
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $Error = 0;
+
+        /**
+         *  Error message of the file entry
+         *
+         *  @var    string
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $ErrorMsg = '';
+
+        /**
+         *  File name of the file entry
+         *
+         *  @var    string
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $Name = '';
+
+        /**
+         *  File path of the file entry
+         *
+         *  @var    string
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $Path = '';
+
+        /**
+         *  File time of the file entry (unix timestamp)
+         *
+         *  @var    integer
+         *  @access public
+         *  @see    SimpleUnzipEntry()
+         *  @since  1.0
+         */
+        var $Time = 0;
+
+        /**
+         *  Contructor of the class
+         *
+         *  @param  array               Entry datas
+         *  @return SimpleUnzipEntry    Instanced class
+         *  @access public
+         *  @since  1.0
+         */
+        function SimpleUnzipEntry($in_Entry)
+        {
+            $this->Data     = $in_Entry['D'];
+            $this->Error    = $in_Entry['E'];
+            $this->ErrorMsg = $in_Entry['EM'];
+            $this->Name     = $in_Entry['N'];
+            $this->Path     = $in_Entry['P'];
+            $this->Time     = $in_Entry['T'];
+        } // end of the 'SimpleUnzipEntry' constructor
+    } // end of the 'SimpleUnzipEntry' class
+?>

Added: YDFramework2.0/trunk/YDFramework2/3rdparty/zip/zip.lib.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/zip/zip.lib.php	2006-02-22 12:38:16 UTC (rev 1715)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/zip/zip.lib.php	2006-02-22 13:01:53 UTC (rev 1716)
@@ -0,0 +1,188 @@
+<?php
+/* $Id: zip.lib.php,v 2.4 2004/11/03 13:56:52 garvinhicking Exp $ */
+// vim: expandtab sw=4 ts=4 sts=4:
+
+
+/**
+ * Zip file creation class.
+ * Makes zip files.
+ *
+ * Based on :
+ *
+ *  http://www.zend.com/codex.php?id=535&single=1
+ *  By Eric Mueller <eric at themepark.com>
+ *
+ *  http://www.zend.com/codex.php?id=470&single=1
+ *  by Denis125 <webmaster at atlant.ru>
+ *
+ *  a patch from Peter Listiak <mlady at users.sourceforge.net> for last modified
+ *  date and time of the compressed file
+ *
+ * Official ZIP file format: http://www.pkware.com/appnote.txt
+ *
+ * @access  public
+ */
+class zipfile
+{
+    /**
+     * Array to store compressed data
+     *
+     * @var  array    $datasec
+     */
+    var $datasec      = array();
+
+    /**
+     * Central directory
+     *
+     * @var  array    $ctrl_dir
+     */
+    var $ctrl_dir     = array();
+
+    /**
+     * End of central directory record
+     *
+     * @var  string   $eof_ctrl_dir
+     */
+    var $eof_ctrl_dir = "\x50\x4b\x05\x06\x00\x00\x00\x00";
+
+    /**
+     * Last offset position
+     *
+     * @var  integer  $old_offset
+     */
+    var $old_offset   = 0;
+
+
+    /**
+     * Converts an Unix timestamp to a four byte DOS date and time format (date
+     * in high two bytes, time in low two bytes allowing magnitude comparison).
+     *
+     * @param  integer  the current Unix timestamp
+     *
+     * @return integer  the current date in a four byte DOS format
+     *
+     * @access private
+     */
+    function unix2DosTime($unixtime = 0) {
+        $timearray = ($unixtime == 0) ? getdate() : getdate($unixtime);
+
+        if ($timearray['year'] < 1980) {
+            $timearray['year']    = 1980;
+            $timearray['mon']     = 1;
+            $timearray['mday']    = 1;
+            $timearray['hours']   = 0;
+            $timearray['minutes'] = 0;
+            $timearray['seconds'] = 0;
+        } // end if
+
+        return (($timearray['year'] - 1980) << 25) | ($timearray['mon'] << 21) | ($timearray['mday'] << 16) |
+                ($timearray['hours'] << 11) | ($timearray['minutes'] << 5) | ($timearray['seconds'] >> 1);
+    } // end of the 'unix2DosTime()' method
+
+
+    /**
+     * Adds "file" to archive
+     *
+     * @param  string   file contents
+     * @param  string   name of the file in the archive (may contains the path)
+     * @param  integer  the current timestamp
+     *
+     * @access public
+     */
+    function addFile($data, $name, $time = 0)
+    {
+        $name     = str_replace('\\', '/', $name);
+
+        $dtime    = dechex($this->unix2DosTime($time));
+        $hexdtime = '\x' . $dtime[6] . $dtime[7]
+                  . '\x' . $dtime[4] . $dtime[5]
+                  . '\x' . $dtime[2] . $dtime[3]
+                  . '\x' . $dtime[0] . $dtime[1];
+        eval('$hexdtime = "' . $hexdtime . '";');
+
+        $fr   = "\x50\x4b\x03\x04";
+        $fr   .= "\x14\x00";            // ver needed to extract
+        $fr   .= "\x00\x00";            // gen purpose bit flag
+        $fr   .= "\x08\x00";            // compression method
+        $fr   .= $hexdtime;             // last mod time and date
+
+        // "local file header" segment
+        $unc_len = strlen($data);
+        $crc     = crc32($data);
+        $zdata   = gzcompress($data);
+        $zdata   = substr(substr($zdata, 0, strlen($zdata) - 4), 2); // fix crc bug
+        $c_len   = strlen($zdata);
+        $fr      .= pack('V', $crc);             // crc32
+        $fr      .= pack('V', $c_len);           // compressed filesize
+        $fr      .= pack('V', $unc_len);         // uncompressed filesize
+        $fr      .= pack('v', strlen($name));    // length of filename
+        $fr      .= pack('v', 0);                // extra field length
+        $fr      .= $name;
+
+        // "file data" segment
+        $fr .= $zdata;
+
+        // "data descriptor" segment (optional but necessary if archive is not
+        // served as file)
+        // nijel(2004-10-19): this seems not to be needed at all and causes
+        // problems in some cases (bug #1037737)
+        //$fr .= pack('V', $crc);                 // crc32
+        //$fr .= pack('V', $c_len);               // compressed filesize
+        //$fr .= pack('V', $unc_len);             // uncompressed filesize
+
+        // add this entry to array
+        $this -> datasec[] = $fr;
+
+        // now add to central directory record
+        $cdrec = "\x50\x4b\x01\x02";
+        $cdrec .= "\x00\x00";                // version made by
+        $cdrec .= "\x14\x00";                // version needed to extract
+        $cdrec .= "\x00\x00";                // gen purpose bit flag
+        $cdrec .= "\x08\x00";                // compression method
+        $cdrec .= $hexdtime;                 // last mod time & date
+        $cdrec .= pack('V', $crc);           // crc32
+        $cdrec .= pack('V', $c_len);         // compressed filesize
+        $cdrec .= pack('V', $unc_len);       // uncompressed filesize
+        $cdrec .= pack('v', strlen($name) ); // length of filename
+        $cdrec .= pack('v', 0 );             // extra field length
+        $cdrec .= pack('v', 0 );             // file comment length
+        $cdrec .= pack('v', 0 );             // disk number start
+        $cdrec .= pack('v', 0 );             // internal file attributes
+        $cdrec .= pack('V', 32 );            // external file attributes - 'archive' bit set
+
+        $cdrec .= pack('V', $this -> old_offset ); // relative offset of local header
+        $this -> old_offset += strlen($fr);
+
+        $cdrec .= $name;
+
+        // optional extra field, file comment goes here
+        // save to central directory
+        $this -> ctrl_dir[] = $cdrec;
+    } // end of the 'addFile()' method
+
+
+    /**
+     * Dumps out file
+     *
+     * @return  string  the zipped file
+     *
+     * @access public
+     */
+    function file()
+    {
+        $data    = implode('', $this -> datasec);
+        $ctrldir = implode('', $this -> ctrl_dir);
+
+        return
+            $data .
+            $ctrldir .
+            $this -> eof_ctrl_dir .
+            pack('v', sizeof($this -> ctrl_dir)) .  // total # of entries "on this disk"
+            pack('v', sizeof($this -> ctrl_dir)) .  // total # of entries overall
+            pack('V', strlen($ctrldir)) .           // size of central dir
+            pack('V', strlen($data)) .              // offset to start of central dir
+            "\x00\x00";                             // .zip file comment length
+    } // end of the 'file()' method
+
+} // end of the 'zipfile' class
+?>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-02-22 12:38:16 UTC (rev 1715)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-02-22 13:01:53 UTC (rev 1716)
@@ -76,12 +76,42 @@
                     if ( ! is_dir( $this->dir_rel ) ) {
                         @mkdir( $this->dir_rel );
                     }
-                    $file->moveUpload( $this->dir_rel, $filename );
+                    @ $file->moveUpload( $this->dir_rel, $filename );
 
+                    // Convert it to an object
+                    $fileObj = new YDFSFile( $this->dir_rel . $file->getBaseName() );
+
+                    // Check if it's a ZIP file
+                    if ( strtolower( $fileObj->getExtension() == 'zip' ) ) {
+
+                        // Include the unzip library
+                        include( YD_DIR_HOME . '/3rdparty/zip/unzip.lib.php' );
+
+                        // Convert it to a ZIP object
+                        $zip = new SimpleUnzip( $fileObj->getAbsolutePath() );
+
+                        // Get the directory as a path
+                        $dir = new YDFSDirectory( $this->dir_rel );
+
+                        // Extract the images
+                        foreach( $zip->Entries as $entry ) {
+
+                            // Save it as a filee
+                            $entryFile = $dir->createFile( $entry->Name, $entry->Data );
+
+
+                            // Delete it if it's not an image
+                            if ( ! $entryFile->isImage() ) {
+                                @ unlink( $entryFile->getAbsolutePath() );
+                            }
+
+                        }
+
+                    }
+
                     // Check if it's an image
-                    $fileObj = new YDFSFile( $this->dir_rel . $file->getBaseName() );
                     if ( ! $fileObj->isImage() ) {
-                        @unlink( $this->dir_rel . $file->getBaseName() );
+                        @unlink( $fileObj->getAbsolutePath() );
                     }
 
                     // Delete the thumbnails



From pclaerhout at berlios.de  Wed Feb 22 14:07:33 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 14:07:33 +0100
Subject: [ydf-devel] r1717 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200602221307.k1MD7XLD014950@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 14:07:29 +0100 (Wed, 22 Feb 2006)
New Revision: 1717

Modified:
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
The item RSS/ATOM feed now contains the images for an item if there are any.

Bug #6535

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-02-22 13:01:53 UTC (rev 1716)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-02-22 13:07:29 UTC (rev 1717)
@@ -73,7 +73,22 @@
 
             // Add the items
             foreach ( $items as $item ) {
-                $this->feed->addItem( $item['title'], YDTplModLinkItem( $item ), YDTplModBBCode( $item['body'] ) );
+
+                // Make the body
+                $body = $item['body'];
+
+                // Add the images if any
+                if ( sizeof( $item['images'] ) > 0 ) {
+                    $body .= '<p>';
+                    foreach ( $item['images'] as $image ) {
+                        $body .= '<img src="' . YDTplModLinkThumb( $image ) . '"/> ';
+                    }
+                    $body .= '</p>';
+                }
+
+                // Add it to the feed
+                $this->feed->addItem( $item['title'], YDTplModLinkItem( $item ), YDTplModBBCode( $body ) );
+
             }
 
         }



From pclaerhout at berlios.de  Wed Feb 22 14:30:49 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 14:30:49 +0100
Subject: [ydf-devel] r1718 - in YDFramework2.0/trunk/YDFramework2: YDClasses addons/YDFeedCreator
Message-ID: <200602221330.k1MDUnRA027051@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 14:30:16 +0100 (Wed, 22 Feb 2006)
New Revision: 1718

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
Log:
Fixed some character encoding issues with YDFeedCreator.

Bug #6546

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-22 13:07:29 UTC (rev 1717)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-22 13:30:16 UTC (rev 1718)
@@ -576,6 +576,8 @@
          *	@static
          */
         function encodeString( $string, $htmlent=false ) {
+            $trans = array_flip( get_html_translation_table( HTML_ENTITIES ) );
+            $string = strtr( $string, $trans );
             $trans = get_html_translation_table( HTML_ENTITIES, ENT_NOQUOTES );
             foreach ( $trans as $key => $value ) {
                 if ( ord( $key ) == 60 || ord( $key ) == 62 ) {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-02-22 13:07:29 UTC (rev 1717)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-02-22 13:30:16 UTC (rev 1718)
@@ -80,7 +80,7 @@
          *	@param $title	The title of the feed.
          */
         function setTitle( $title ) {
-            $this->_title = $title;
+            $this->_title = YDStringUtil::encodeString( $title );
         }
 
         /**
@@ -90,7 +90,7 @@
          */
         function setDescription( $desc ) {
             $desc = YDUrl::makeLinksAbsolute( $desc, $this->_link );
-            $this->_description = $desc;
+            $this->_description = YDStringUtil::encodeString( $desc );
         }
 
         /**
@@ -134,8 +134,9 @@
             }
 
             $item = array(
-                'title' => $title, 'link' => $link,
-                'description' => $desc, 'guid' => $guid, 'enclosure' => $enclosure, 'enclosure_size' => $enclosure_size,
+                'title' => YDStringUtil::encodeString( $title ), 'link' => $link,
+                'description' => $desc, 'guid' => $guid,
+                'enclosure' => $enclosure, 'enclosure_size' => $enclosure_size,
                 'enclosure_type' => $enclosure_type
             );
 



From pclaerhout at berlios.de  Wed Feb 22 14:45:31 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Wed, 22 Feb 2006 14:45:31 +0100
Subject: [ydf-devel] r1719 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602221345.k1MDjVDA003799@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-22 14:45:04 +0100 (Wed, 22 Feb 2006)
New Revision: 1719

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Added the YDLdapUtil class.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-22 13:30:16 UTC (rev 1718)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-02-22 13:45:04 UTC (rev 1719)
@@ -987,7 +987,54 @@
             );
          }
 
+    }
 
+    /**
+     *  This class allows you to perform LDAP releated tasks.
+     */
+    class YDLdapUtil extends YDBase {
+
+        /**
+         *  Authenticate against a domain.
+         *
+         *  @param  $server     The name of the domain controller.
+         *  @param  $domain     The name of the domain.
+         *  @param  $user       The username.
+         *  @param  $password   The password.
+         *
+         *  @returns    A boolean indicating if the user was authenticated or not.
+         */
+        function authenticate( $server, $domain, $user, $password ) {
+
+            // Connect to the LDAP server
+            $conn = ldap_connect( $server );
+
+            // Setup the options
+            ldap_set_option( $conn, LDAP_OPT_PROTOCOL_VERSION, 3 );
+            ldap_set_option( $conn, LDAP_OPT_REFERRALS, 0 );
+
+            // Require a username
+            if ( empty( $user ) || empty( $pass ) ) {
+                return false;
+            }
+
+            // Fix the username
+            $user = strtolower( trim( $user ) );
+            if ( strpos( $user, '\\' ) ) {
+                $user = substr( $user, strpos( $user, '\\' ) + 1 );
+            }
+
+            // Authenticate
+            $result = @ldap_bind( $conn, $user . '@' . $server, $password );
+
+            // Close the connection
+            ldap_close( $conn );
+
+            // Return the result
+            return ( $result ) ? true : false;
+
+        }
+
     }
 
 ?>



From pclaerhout at berlios.de  Thu Feb 23 11:23:33 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Thu, 23 Feb 2006 11:23:33 +0100
Subject: [ydf-devel] r1720 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602231023.k1NANXuV004011@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-23 11:23:30 +0100 (Thu, 23 Feb 2006)
New Revision: 1720

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
Replaced readfile with fopen/fread/fclose as it readfile is not supported on all server configurations.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2006-02-22 13:45:04 UTC (rev 1719)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2006-02-23 10:23:30 UTC (rev 1720)
@@ -1017,8 +1017,10 @@
                     header( 'Content-type: ' . $img->getMimeType() );
 
                     // Output the image
-                    readfile( $cacheFName );
-                    die();
+                    $f = fopen( $cacheFName, 'rb' );
+                    $data = fread( $f, filesize( $cacheFName ) );
+                    fclose( $f );
+                    die( $data );
 
                 }
 



From ximian at berlios.de  Thu Feb 23 17:15:35 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 23 Feb 2006 17:15:35 +0100
Subject: [ydf-devel] r1721 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602231615.k1NGFZYV025231@sheep.berlios.de>

Author: ximian
Date: 2006-02-23 17:15:22 +0100 (Thu, 23 Feb 2006)
New Revision: 1721

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
added experimental method to assign custom Javascript

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-23 10:23:30 UTC (rev 1720)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-23 16:15:22 UTC (rev 1721)
@@ -80,6 +80,8 @@
                 $this->register_modifier( 'date_format', 'YDTemplate_modifier_date_format' );
                 $this->register_modifier( 'dump', 'YDTemplate_modifier_dump' );
 
+                // custom javascript code
+                $this->customJavascript = null;
             }
 
             /**
@@ -134,6 +136,9 @@
                 $this->assign( 'YD_FW_REVISION', YD_FW_REVISION );
                 $this->assign( 'YD_ACTION', YDRequest::getActionName() );
 
+                // Add custom javascript
+                $this->register_outputfilter( array( &$this, "__assignJavascript") );
+
                 // Get the template name
                 $tplName = $this->_getTemplateName( $file );
 
@@ -187,6 +192,36 @@
             }
 
             /**
+             *	This function will parse the template and will assign custom javascript.
+             *
+             *	@param $tpl_source		Template source
+             *	@param $smarty		    Smarty pointer
+             *
+             *	@returns	Template code parsed
+             */
+            function __assignJavascript( $tpl_source, &$smarty ){
+
+                // test if customJavascript is set
+                if ( is_null( $this->customJavascript ) ) return $tpl_source;
+
+                // add javascript tags
+                $this->customJavascript = "\n<script type=\"text/javascript\">\n" . $this->customJavascript . "</script>\n";
+
+                // replace head end tag
+                return eregi_replace( "</head>", $this->customJavascript . "</head>", $tpl_source );
+            }
+
+            /**
+             *	This function will add custom javascript to the template head
+             *
+             *	@param $jsCode	Javascript code to add
+             */
+            function addJavascript( $jsCode ) {
+
+                $this->customJavascript .= $jsCode . "\n";
+            }
+
+            /**
              *	This function will add a YDForm object to the template. It will automatically convert the form to an array
              *	using the template object so that you don't have to do it manually.
              *



From ximian at berlios.de  Thu Feb 23 17:41:30 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Thu, 23 Feb 2006 17:41:30 +0100
Subject: [ydf-devel] r1722 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602231641.k1NGfUeM028589@sheep.berlios.de>

Author: ximian
Date: 2006-02-23 17:41:11 +0100 (Thu, 23 Feb 2006)
New Revision: 1722

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
added optional argument to YDTemplate::addJavascript that defines js code position

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-23 16:15:22 UTC (rev 1721)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-23 16:41:11 UTC (rev 1722)
@@ -214,11 +214,13 @@
             /**
              *	This function will add custom javascript to the template head
              *
-             *	@param $jsCode	Javascript code to add
+             *	@param $jsCode	   Javascript code to add
+             *	@param $prepend    (Optional) Boolean that defines if code should be prepended
              */
-            function addJavascript( $jsCode ) {
+            function addJavascript( $jsCode, $prepend = false ) {
 
-                $this->customJavascript .= $jsCode . "\n";
+                if (!$prepend) $this->customJavascript  = $this->customJavascript . $jsCode . "\n";
+                else           $this->customJavascript  = $jsCode . $this->customJavascript . "\n";
             }
 
             /**



From pclaerhout at berlios.de  Fri Feb 24 12:07:17 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 24 Feb 2006 12:07:17 +0100
Subject: [ydf-devel] r1723 - in YDFramework2.0/trunk/examples/weblog: include manage skins/default
Message-ID: <200602241107.k1OB7Hdg029292@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-24 12:07:16 +0100 (Fri, 24 Feb 2006)
New Revision: 1723

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/manage/manage.css
   YDFramework2.0/trunk/examples/weblog/skins/default/default.css
Log:
Moved the markup for the required form elements to the CSS file instead of having it in the include files.

Bug #6565

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-23 16:41:11 UTC (rev 1722)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-24 11:07:16 UTC (rev 1723)
@@ -256,7 +256,7 @@
             $this->YDForm( $name, $method, $action, $target, $attributes );
 
             // Set the required
-            $this->setHtmlRequired( '', ' <font color="red">(' . t( 'required' ) . ')</font>' );
+            $this->setHtmlRequired( '', ' <span class="required">(' . t( 'required' ) . ')</span>' );
 
             // Register the form element
             $this->registerElement( 'wlbbtextarea', 'YDWeblogFormElement_BBTextArea' );

Modified: YDFramework2.0/trunk/examples/weblog/manage/manage.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-02-23 16:41:11 UTC (rev 1722)
+++ YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-02-24 11:07:16 UTC (rev 1723)
@@ -56,6 +56,10 @@
     border-bottom: 1px solid #ddd;
 }
 
+.required {
+    color: red;
+}
+
 input, textarea, select	{
 	margin:2px;
 	padding:2px;

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/default.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-02-23 16:41:11 UTC (rev 1722)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-02-24 11:07:16 UTC (rev 1723)
@@ -597,3 +597,7 @@
 /* "Daisy, Daisy, give me your answer do. I'm half crazy all for the love of you.
 	It won't be a stylish marriage, I can't afford a carriage.
 	But you'll look sweet upon the seat of a bicycle built for two." */
+
+.required {
+	color: red;
+}
\ No newline at end of file



From ydfpoi at gmail.com  Fri Feb 24 14:23:01 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Fri, 24 Feb 2006 14:23:01 +0100
Subject: [ydf-devel] r1708 - YDFramework2.0/trunk/examples/weblog/include
In-Reply-To: <200602210804.k1L84lrN001591@sheep.berlios.de>
References: <200602210804.k1L84lrN001591@sheep.berlios.de>
Message-ID: <306340e00602240523s59dcc66fo@mail.gmail.com>

Hi Pieter,

In order to work as intended, the YDWeblogAdminRequest::_getCookiePath
function has to be flipped as follows:

replace line 347:
$cookiePath = str_replace( '\\', '/', rtrim( $cookiePath, '/' ) );

with this new line:
$cookiePath = rtrim( str_replace( '\\', '/', $cookiePath ), '/' );

Kind regards

2006/2/21, pclaerhout at BerliOS <pclaerhout at berlios.de>:
> Author: pclaerhout
> Date: 2006-02-21 09:04:45 +0100 (Tue, 21 Feb 2006)
> New Revision: 1708
>
> Modified:
>    YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
> Log:
> Fixed the YDWeblogAdminRequest::_getCookiePath function so that it returns a valid path in all cases.
> It now strips unneeded characters and makes sure the path ends with a forward slash.
> If the path is empty, it now correctly return the root (single forward slash).
>
> [...]
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>


--
po?


From pclaerhout at berlios.de  Fri Feb 24 14:36:56 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Fri, 24 Feb 2006 14:36:56 +0100
Subject: [ydf-devel] r1724 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602241336.k1ODauKi028248@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-24 14:36:54 +0100 (Fri, 24 Feb 2006)
New Revision: 1724

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
Log:
Fixed a small bug in the _getCookiePath function.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-24 11:07:16 UTC (rev 1723)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-24 13:36:54 UTC (rev 1724)
@@ -344,7 +344,7 @@
             }
 
             // Trim the unneeded characters
-            $cookiePath = str_replace( '\\', '/', rtrim( $cookiePath, '/' ) );
+            $cookiePath = rtrim( str_replace( '\\', '/', $cookiePath ), '/' );
 
             // Return the cookie path
             return $cookiePath . '/';



From pieter at yellowduck.be  Fri Feb 24 14:37:04 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Fri, 24 Feb 2006 14:37:04 +0100
Subject: [ydf-devel] r1708 - YDFramework2.0/trunk/examples/weblog/include
In-Reply-To: <306340e00602240523s59dcc66fo@mail.gmail.com>
References: <200602210804.k1L84lrN001591@sheep.berlios.de>
	 <306340e00602240523s59dcc66fo@mail.gmail.com>
Message-ID: <4aef63030602240537r27e3f4f9h82ce4450db7b0017@mail.gmail.com>

Fixed in build 1724.

pieter

On 2/24/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter,
>
> In order to work as intended, the YDWeblogAdminRequest::_getCookiePath
> function has to be flipped as follows:
>
> replace line 347:
> $cookiePath = str_replace( '\\', '/', rtrim( $cookiePath, '/' ) );
>
> with this new line:
> $cookiePath = rtrim( str_replace( '\\', '/', $cookiePath ), '/' );
>
> Kind regards
>
> 2006/2/21, pclaerhout at BerliOS <pclaerhout at berlios.de>:
> > Author: pclaerhout
> > Date: 2006-02-21 09:04:45 +0100 (Tue, 21 Feb 2006)
> > New Revision: 1708
> >
> > Modified:
> >    YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
> > Log:
> > Fixed the YDWeblogAdminRequest::_getCookiePath function so that it
> returns a valid path in all cases.
> > It now strips unneeded characters and makes sure the path ends with a
> forward slash.
> > If the path is empty, it now correctly return the root (single forward
> slash).
> >
> > [...]
> >
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> > http://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060224/2f79980f/attachment.html>

From ximian at berlios.de  Fri Feb 24 15:58:42 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Fri, 24 Feb 2006 15:58:42 +0100
Subject: [ydf-devel] r1725 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602241458.k1OEwgNv026479@sheep.berlios.de>

Author: ximian
Date: 2006-02-24 15:58:16 +0100 (Fri, 24 Feb 2006)
New Revision: 1725

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
YDAjax use YDTemplate::addJavascript() instead

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-24 13:36:54 UTC (rev 1724)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-24 14:58:16 UTC (rev 1725)
@@ -42,20 +42,6 @@
 
 
     /**
-     *  This config defines the html tag to use
-     *  Default: </head>
-     */
-    YDConfig::set( 'YD_AJAX_TAG', "</head>", false );
-
-
-    /**
-     *  This config defines if ajax code must be placed after tag (true) or before tag (false).
-     *  Default: false.
-     */
-    YDConfig::set( 'YD_AJAX_AFTERTAG', false, false );
-
-
-    /**
      *  This config defines custom debug value
      *  Default: false
      */
@@ -116,15 +102,12 @@
 		}
 		
 
-		// internal method. replace "</head>" with "all ajax javascript (containing our custom javascript too) and string </head>"
-		function _assignJavascript($tpl_source, &$smarty){
+		// internal method to add js to the template
+		function _assignJavascript(){
 			
 			// load autocompleter css
 			$html  = $this->autocompleterCss;
 			
-			// start javascript code
-			$html .= "\n<script type=\"text/javascript\">\n";
-			
 			// use default url
 			$html .= "var xajaxRequestUri     = \"". YDRequest::getNormalizedUri() ."\";\n";
 
@@ -186,20 +169,13 @@
 			if (!empty($this->customjsBottom))
 				$html .= implode( "\n", $this->customjsBottom ) ."\n";
 
-			// end javascript code
-			$html .= "</script>\n";
-
-			// get html tag to use
-			$tag = YDConfig::get( 'YD_AJAX_TAG' );
-
-			// add js code to template
-			if ( YDConfig::get( 'YD_AJAX_AFTERTAG' )) return eregi_replace( $tag, $tag  ."\n". $html, $tpl_source );
-			else                                      return eregi_replace( $tag, $html ."\n". $tag,  $tpl_source );
+			// add all code to template html
+			$this->template->addJavascript( $html, true );
 		}
 
 
         /**
-         *	This function adds custom javascript to the template.
+         *	This function adds custom javascript to YDAjax specific js.
          *
          *	@param $js      Javascript code.
          *	@param $order   Zone to place code (top, bottom, topBefore, topAfter, bottomBefore, bottomAfer)
@@ -682,8 +658,8 @@
 			}
 
 			// change template object internals			
-			$this->template->register_outputfilter( array( &$this, "_assignJavascript") );
-
+//			$this->template->register_outputfilter( array( &$this, "_assignJavascript") );
+$this->_assignJavascript();
 			// process all requests and exit
 			return $this->processRequests();
 		}



From ximian at berlios.de  Sat Feb 25 16:23:31 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sat, 25 Feb 2006 16:23:31 +0100
Subject: [ydf-devel] r1726 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602251523.k1PFNVdd012023@sheep.berlios.de>

Author: ximian
Date: 2006-02-25 16:22:52 +0100 (Sat, 25 Feb 2006)
New Revision: 1726

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
new method YDTemplate::addCss() to add custom css code to templates

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-24 14:58:16 UTC (rev 1725)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-25 15:22:52 UTC (rev 1726)
@@ -82,6 +82,9 @@
 
                 // custom javascript code
                 $this->customJavascript = null;
+
+                // custom Css code
+                $this->customCss = null;
             }
 
             /**
@@ -137,7 +140,7 @@
                 $this->assign( 'YD_ACTION', YDRequest::getActionName() );
 
                 // Add custom javascript
-                $this->register_outputfilter( array( &$this, "__assignJavascript") );
+                $this->register_outputfilter( array( &$this, "__assignHeadCode") );
 
                 // Get the template name
                 $tplName = $this->_getTemplateName( $file );
@@ -192,23 +195,30 @@
             }
 
             /**
-             *	This function will parse the template and will assign custom javascript.
+             *	This function will parse the template and will assign custom code to head.
              *
              *	@param $tpl_source		Template source
              *	@param $smarty		    Smarty pointer
              *
              *	@returns	Template code parsed
              */
-            function __assignJavascript( $tpl_source, &$smarty ){
+            function __assignHeadCode( $tpl_source, &$smarty ){
 
+                // code to add
+                $code = '';
+
+                // test if customCss is set
+                if ( !is_null( $this->customCss ) )
+                    $code  = "\n<style type=\"text/css\">\n" . $this->customCss . "</style>";
+
                 // test if customJavascript is set
-                if ( is_null( $this->customJavascript ) ) return $tpl_source;
+                if ( !is_null( $this->customJavascript ) ) 
+                    $code .= "\n<script type=\"text/javascript\">\n" . $this->customJavascript . "</script>\n";
 
-                // add javascript tags
-                $this->customJavascript = "\n<script type=\"text/javascript\">\n" . $this->customJavascript . "</script>\n";
+                if ( $code == '' ) return $tpl_source;
 
                 // replace head end tag
-                return eregi_replace( "</head>", $this->customJavascript . "</head>", $tpl_source );
+                return eregi_replace( "</head>", $code . "</head>", $tpl_source );
             }
 
             /**
@@ -224,6 +234,18 @@
             }
 
             /**
+             *	This function will add custom css to the template head
+             *
+             *	@param $cssCode	   Css code to add
+             *	@param $prepend    (Optional) Boolean that defines if code should be prepended
+             */
+            function addCss( $cssCode, $prepend = false ) {
+
+                if (!$prepend) $this->customCss = $this->customCss . $cssCode . "\n";
+                else           $this->customCss = $cssCode . $this->customCss . "\n";
+            }
+
+            /**
              *	This function will add a YDForm object to the template. It will automatically convert the form to an array
              *	using the template object so that you don't have to do it manually.
              *



From ximian at berlios.de  Sat Feb 25 16:27:10 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sat, 25 Feb 2006 16:27:10 +0100
Subject: [ydf-devel] r1727 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602251527.k1PFRAGu012332@sheep.berlios.de>

Author: ximian
Date: 2006-02-25 16:26:51 +0100 (Sat, 25 Feb 2006)
New Revision: 1727

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
- ported YDAjax to use YDTemplate::addCss
- fixed previous broken autocompleter code

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-25 15:22:52 UTC (rev 1726)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-25 15:26:51 UTC (rev 1727)
@@ -103,13 +103,10 @@
 		
 
 		// internal method to add js to the template
-		function _assignJavascript(){
+		function __assignTemplateCode(){
 			
-			// load autocompleter css
-			$html  = $this->autocompleterCss;
-			
 			// use default url
-			$html .= "var xajaxRequestUri     = \"". YDRequest::getNormalizedUri() ."\";\n";
+			$html  = "var xajaxRequestUri     = \"". YDRequest::getNormalizedUri() ."\";\n";
 
 			// check debug option
 			$html .= "var xajaxDebug          = ". (YDConfig::get( 'YD_AJAX_DEBUG') ? "true" : "false") .";\n";
@@ -629,9 +626,12 @@
 				if ($formElement->getType() != 'autocompleter') continue;
 				
 				if (empty($this->autocompleterCodeFunctions)){
-					// load js code and css
+
+					// load js code
 					$this->autocompleterCode = file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.js');
-					$this->autocompleterCss  = "\n<style>\n". file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.css') ."\n</style>";
+
+					// add css to template
+					$this->template->addCss( file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.css') );
 				}
 		
 				// compute variable name for this autocompleter
@@ -657,9 +657,9 @@
 				$this->autocompleterCodeFunctions[] = $variable . ".ajax = function(){currentAjaxAutocompleter=this;".  $this->computeFunction( $textID, $serverFunctionName, $arguments, $effects ) . "}";
 			}
 
-			// change template object internals			
-//			$this->template->register_outputfilter( array( &$this, "_assignJavascript") );
-$this->_assignJavascript();
+			// add js code
+			$this->__assignTemplateCode();
+
 			// process all requests and exit
 			return $this->processRequests();
 		}



From ximian at berlios.de  Sun Feb 26 17:49:46 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sun, 26 Feb 2006 17:49:46 +0100
Subject: [ydf-devel] r1728 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602261649.k1QGnkn8032491@sheep.berlios.de>

Author: ximian
Date: 2006-02-26 17:49:31 +0100 (Sun, 26 Feb 2006)
New Revision: 1728

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
waiting message now hides before all result responses (and not after).
This prevents waiting message stuck when response is a alert message

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-25 15:26:51 UTC (rev 1727)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-26 16:49:31 UTC (rev 1728)
@@ -263,6 +263,9 @@
 
 			// create js function to show div
 			$this->waitingMessageCodeFunction ="\nfunction ". $this->wtFunction ."{". $effectShow->getJSHead($this->wtID ."id") . $effectShow->getJSBody($this->wtID ."id") ."}";
+
+			// add script to hide waiting message on response
+			$this->response->addScript( $this->effectHide->getJSHead($this->wtID ."id") . $this->effectHide->getJSBody($this->wtID ."id") );
 		}
 
 
@@ -692,10 +695,6 @@
          */	
 		function processResults(){
 
-			// add script to hide waiting message if it's used
-			if (isset($this->wtID))
-				$this->response->addScript( $this->effectHide->getJSHead($this->wtID ."id") . $this->effectHide->getJSBody($this->wtID ."id") );
-
 			// return XML to client browser
 			return $this->response->getXML();
 		}



From ximian at berlios.de  Sun Feb 26 19:09:01 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sun, 26 Feb 2006 19:09:01 +0100
Subject: [ydf-devel] r1729 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602261809.k1QI91aw020012@sheep.berlios.de>

Author: ximian
Date: 2006-02-26 19:08:48 +0100 (Sun, 26 Feb 2006)
New Revision: 1729

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
new static method YDAjax::message to send response as error report

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-26 16:49:31 UTC (rev 1728)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-26 18:08:48 UTC (rev 1729)
@@ -219,7 +219,7 @@
 			if (isset($this->wtID)) return;
 		
 			// create js variable name for html message element
-			$this->wtID = $this->prefix . "waitingmessage";
+			$this->wtID = "waitingmessage";
 
 			// check custom options
 			if (!isset($options['style.backgroundColor'])) $options['style.backgroundColor'] = '#cccccc';
@@ -250,31 +250,32 @@
 			// append start code
 			$this->waitingMessageCode .= $effectStart->getJSHead($this->wtID ."id") . $effectStart->getJSBody($this->wtID ."id");
 
-			// create function name to show div
-			$this->wtFunction = $this->wtID ."show()";
+			// create js function headers to show/hide waiting message div
+			$this->wtFunctionShow = $this->wtID ."show()";
+			$this->wtFunctionHide = $this->wtID ."hide()";
 
 			// create show effect
 			if (is_null( $effectShow ))
 				$effectShow = new YDAjaxEffect( '', 'show', '', 0 );
 
-			// save hide effect to be used on response
-			if (is_null( $effectHide )) $this->effectHide = new YDAjaxEffect( '', 'hide', '', 0 );
-			else                        $this->effectHide = $effectHide;
+			// create hide effect
+			if (is_null( $effectHide )) 
+				$effectHide = new YDAjaxEffect( '', 'hide', '', 0 );
 
-			// create js function to show div
-			$this->waitingMessageCodeFunction ="\nfunction ". $this->wtFunction ."{". $effectShow->getJSHead($this->wtID ."id") . $effectShow->getJSBody($this->wtID ."id") ."}";
+			// create js functions to show/hide div
+			$this->waitingMessageCodeFunction  = "\nfunction ". $this->wtFunctionShow ."{". $effectShow->getJSHead($this->wtID ."id") . $effectShow->getJSBody($this->wtID ."id") ."}";
+			$this->waitingMessageCodeFunction .= "\nfunction ". $this->wtFunctionHide ."{". $effectHide->getJSHead($this->wtID ."id") . $effectHide->getJSBody($this->wtID ."id") ."}";
 
 			// add script to hide waiting message on response
-			$this->response->addScript( $this->effectHide->getJSHead($this->wtID ."id") . $this->effectHide->getJSBody($this->wtID ."id") );
+			$this->response->addScript( $this->wtFunctionHide . ";" );
 		}
 
 
-		// internal method to get the js waiting message function declaration
-		function _getMessageFunction(){
+		// internal method to get the js show waiting message function declaration
+		function _getWMFunctionShow(){
 
-			if (isset($this->wtID)) return $this->wtFunction . ";" ;
-
-			return '';
+			if (isset($this->wtID)) return $this->wtFunctionShow . ";";
+			else                    return '';
 		}
 
 
@@ -357,7 +358,7 @@
 			if (!is_array( $options )) $options = array( $options );
 			
 			// get function name
-			$functionName = $this->_getMessageFunction() . $this->sWrapperPrefix . $serverFunctionName .'('. $this->_computeFunctionArguments( $arguments, $options ) .');';
+			$functionName = $this->_getWMFunctionShow() . $this->sWrapperPrefix . $serverFunctionName .'('. $this->_computeFunctionArguments( $arguments, $options ) .');';
 
 			// process effects
 			if (!is_null( $effects )){
@@ -881,6 +882,22 @@
 			$this->response->addAlert( $message );
 		}
 
+
+        /**
+         *	This method sends a ajax response message
+         *
+         *	@param $message			Message to display.
+         */		
+		function message( $message ){
+			
+			$response = new YDAjaxResponse( YDConfig::get( 'YD_AJAX_ENCODING' ) );
+			$response->addScript( 'try{ waitingmessagehide() }catch(e){}' );
+			$response->addAlert( $message );
+			
+			return $response;
+		}
+
+
 	}
 
 



From ximian at berlios.de  Sun Feb 26 19:16:33 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sun, 26 Feb 2006 19:16:33 +0100
Subject: [ydf-devel] r1730 - YDFramework2.0/trunk/examples/ajax
Message-ID: <200602261816.k1QIGXBM028249@sheep.berlios.de>

Author: ximian
Date: 2006-02-26 19:16:11 +0100 (Sun, 26 Feb 2006)
New Revision: 1730

Modified:
   YDFramework2.0/trunk/examples/ajax/form.php
Log:
YDAjax form example now uses new YDAjax::message method

Modified: YDFramework2.0/trunk/examples/ajax/form.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/form.php	2006-02-26 18:08:48 UTC (rev 1729)
+++ YDFramework2.0/trunk/examples/ajax/form.php	2006-02-26 18:16:11 UTC (rev 1730)
@@ -53,15 +53,13 @@
 		function processform( $formvalues ){
 
 			// if form is not valid, send errors to client side using an alert
-			if (!$this->form->validate( $formvalues )){
-				$this->ajax->addAlert( implode( "\n", $this->form->getErrors() ) );
-			
-			}else{
-				// assign span 'myspanresult' with form values and change 'mybutton' caption
-				$this->ajax->addResult( 'myspanresult',  $this->form->getValues() ) ;
-				$this->ajax->addResult( 'mybutton',     'Send form with YDAjax again :)' );
-			}
-			
+			if (!$this->form->validate( $formvalues ))
+				return YDAjax::message( implode( "\n", $this->form->getErrors() ) );
+
+			// assign span 'myspanresult' with form values and change 'mybutton' caption
+			$this->ajax->addResult( 'myspanresult',  $this->form->getValues() ) ;
+			$this->ajax->addResult( 'mybutton',     'Send form with YDAjax again :)' );
+
 			// return response to client browser
 			return $this->ajax->processResults();
 		}



From ximian at berlios.de  Sun Feb 26 20:09:04 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Sun, 26 Feb 2006 20:09:04 +0100
Subject: [ydf-devel] r1731 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602261909.k1QJ94kx021690@sheep.berlios.de>

Author: ximian
Date: 2006-02-26 20:08:42 +0100 (Sun, 26 Feb 2006)
New Revision: 1731

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
now YDAjax supports custom arguments on events functions.
It's possible to define an event like:
$ajax->addEvent( 'addFunc(x)', array( & $this, 'addF' ), 'var x' );

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-26 18:16:11 UTC (rev 1730)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-26 19:08:42 UTC (rev 1731)
@@ -386,7 +386,7 @@
 			}
 
 			// if formElementName is a js function we are not assigning an event to a form element but creating a js function
-			if (ereg ("^(.*)\(\)$", $formElementName, $function)){
+			if (ereg ("^(.*)\(.*\)$", $formElementName, $function)){
 				$this->customjs[ $function[0] ] = $functionName;
 				return;
 			}
@@ -472,14 +472,17 @@
 																							
 						default : die ('Element type "'. $elem->getType() .'" is not supported as dynamic argument');
 					}
-							
-				continue;
+					
+					$args[] = "'". htmlentities( $arg ) ."'";
+					continue;
 				}
-						
-				// if it's not a form element just parse the argument string (we don't want " and ' on code)
-				$args[] = "'". htmlentities( $arg ) ."'";
+
+				// if it's not a form element just parse the argument string
+				// if argument is in format 'var ?' where ? is a string, it's a js variable. otherwise is a simple string
+				if (ereg ("^var (.*)$", $arg, $res)) $args[] = $res[1];
+				else                                 $args[] = "'". htmlentities( $arg ) ."'";
 			}
-						
+
 			// convert arguments (we don't want " and ' on code)
 			return implode( ",", $args );
 		}
@@ -501,7 +504,7 @@
 			}
 
 			// check element
-			if (ereg ("^(.*)\(\)$", $formElementName, $function)){
+			if (ereg ("^(.*)\(.*\)$", $formElementName, $function)){
 			
 				if (!isset( $this->customjs[ $function[0] ] )) die( "Function ". $function[0] ." is not defined." );
 				
@@ -594,7 +597,7 @@
 		function addAlias( $formElementName, $functionName, $event = null ){
 
 			// check element
-			if (ereg ("^(.*)\(\)$", $formElementName, $function)){
+			if (ereg ("^(.*)\(.*\)$", $formElementName, $function)){
 			
 				if (!isset( $this->customjs[ $formElementName ] )) die( "Function ". $formElementName ." is not defined." );
 				



From pclaerhout at berlios.de  Mon Feb 27 12:05:15 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 12:05:15 +0100
Subject: [ydf-devel] r1732 - in YDFramework2.0/trunk: . scripts
Message-ID: <200602271105.k1RB5FBr011035@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 12:05:14 +0100 (Mon, 27 Feb 2006)
New Revision: 1732

Added:
   YDFramework2.0/trunk/scripts/
   YDFramework2.0/trunk/scripts/make_release.bat
Log:
Moved the make_release.bat file to the scripts subdirectory.

Copied: YDFramework2.0/trunk/scripts/make_release.bat (from rev 1731, YDFramework2.0/trunk/make_release.bat)



From pclaerhout at berlios.de  Mon Feb 27 12:07:28 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 12:07:28 +0100
Subject: [ydf-devel] r1733 - YDFramework2.0/trunk/scripts
Message-ID: <200602271107.k1RB7SKv011207@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 12:07:28 +0100 (Mon, 27 Feb 2006)
New Revision: 1733

Modified:
   YDFramework2.0/trunk/scripts/make_release.bat
Log:
Updated the make_release.bat script so that the scripts directory gets deleted properly with a build.

Modified: YDFramework2.0/trunk/scripts/make_release.bat
===================================================================
--- YDFramework2.0/trunk/scripts/make_release.bat	2006-02-27 11:05:14 UTC (rev 1732)
+++ YDFramework2.0/trunk/scripts/make_release.bat	2006-02-27 11:07:28 UTC (rev 1733)
@@ -88,7 +88,8 @@
 del /Q "doc\docs_api_footer.html" > NUL
 del /Q "doc\RequestProcessing.vsd" > NUL
 del /Q "YDFramework2\images\*.psd" > NUL
-del /Q "make_release.bat" > NUL
+del /Q "scripts\*.bat" > NUL
+rmdir /Q /S "scripts"
 
 :create_build_number_file
 echo [task] Creating build revision file...



From pclaerhout at berlios.de  Mon Feb 27 12:13:42 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 12:13:42 +0100
Subject: [ydf-devel] r1734 - YDFramework2.0/trunk/scripts
Message-ID: <200602271113.k1RBDg4q012113@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 12:13:42 +0100 (Mon, 27 Feb 2006)
New Revision: 1734

Added:
   YDFramework2.0/trunk/scripts/make_weblog_release.bat
Log:
Added script to zip up the weblog application.

Feature Request #1850

Added: YDFramework2.0/trunk/scripts/make_weblog_release.bat
===================================================================
--- YDFramework2.0/trunk/scripts/make_weblog_release.bat	2006-02-27 11:07:28 UTC (rev 1733)
+++ YDFramework2.0/trunk/scripts/make_weblog_release.bat	2006-02-27 11:13:42 UTC (rev 1734)
@@ -0,0 +1,124 @@
+ at echo off
+
+rem Needs the following software:
+rem   - Doxygen
+rem   - xsltproc
+rem   - fop
+rem   - cscript
+rem   - tar
+rem   - gzip
+rem   - sed
+
+:config_settings
+set SVN_HOME=svn://svn.berlios.de/ydframework/YDFramework2.0
+set BLDTYPE=
+set SVN_URL=
+set SVN_REV=
+set SVN_CMD=
+set ARC_NAME=YDFramework-
+
+:check_environment_svn_url
+if "%2" == "" goto error_missing_svn_url
+
+:check_environment_build_type
+if "%1" == "" goto error_missing_build_type
+if "%1" == "--release"  goto setup_buildtype_release
+if "%1" == "--snapshot" goto setup_buildtype_snapshot
+if "%BLDTYPE%" == "" goto error_wrong_build_type
+goto do_export
+
+:build_export
+if exist "%ARC_NAME%" ( rmdir /Q /S "%ARC_NAME%" )
+echo [task] Exporting SVN repository...
+%SVN_CMD%
+
+:build_docs
+pushd "%ARC_NAME%"
+
+:cleanup_build
+echo [task] Cleaning up the tree structure...
+del /Q "doc\build_api.bat" > NUL
+del /Q "doc\docs_api.dxy" > NUL
+del /Q "doc\docs_api_footer.html" > NUL
+del /Q "doc\RequestProcessing.vsd" > NUL
+del /Q "YDFramework2\images\*.psd" > NUL
+del /Q "scripts\*.bat" > NUL
+rmdir /Q /S "scripts"
+
+:create_build_number_file
+echo [task] Creating build revision file...
+sed "s/'YD_FW_REVISION', 'unknown'/'YD_FW_REVISION', '%SVN_REV%'/g" "YDFramework2\YDF2_init.php" > "YDFramework2\YDF2_init_fixed.php"
+del /Q "YDFramework2\YDF2_init.php" > NUL
+move /Y "YDFramework2\YDF2_init_fixed.php" "YDFramework2\YDF2_init.php"
+
+:create_weblog_archive
+echo [task] Creating archive of the weblog application...
+if exist "..\%WARC_NAME%" ( rmdir /Q /S "..\%WARC_NAME%" )
+mkdir "..\%WARC_NAME%"
+xcopy /E /Y /Q /S "examples\weblog" "..\%WARC_NAME%"
+mkdir "..\%WARC_NAME%\include\YDFramework2"
+xcopy /E /Y /Q /S "YDFramework2" "..\%WARC_NAME%\include\YDFramework2"
+cd "..\%WARC_NAME%"
+sed "s/\/\.\.\/\.\.\/\YDFramework2/\/include\/YDFramework2/g" install.php > install_fixed.php
+del /Q "install.php" > NUL
+move /Y "install_fixed.php" "install.php"
+cd "include"
+sed "s/\/\.\.\/\.\.\/\.\.\/YDFramework2/\/YDFramework2/g" "YDWeblog_init.php" > "YDWeblog_init_fixed.php"
+del /Q "YDWeblog_init.php" > NUL
+move /Y "YDWeblog_init_fixed.php" "YDWeblog_init.php"
+cd ..\..
+
+:create_archive_weblog
+echo [task] Creating .tar.gz archive of this weblog build...
+if exist "%WARC_NAME%.tar" ( del /Q "%WARC_NAME%.tar" > NUL )
+tar cf "%WARC_NAME%.tar" "%WARC_NAME%"
+if exist "%WARC_NAME%.tar.gz" ( del /Q "%WARC_NAME%.tar.gz" > NUL )
+gzip -9 "%WARC_NAME%.tar"
+
+:cleanup_build
+echo [task] Cleaning up the temporary build files...
+if exist "%ARC_NAME%" ( rmdir /Q /S "%ARC_NAME%" )
+if exist "%WARC_NAME%" ( rmdir /Q /S "%WARC_NAME%" )
+
+:finish_build
+echo [task] Finished the build!
+popd
+goto end
+
+:setup_buildtype_release
+echo [task] Setting up the build...
+set BLDTYPE=release
+set SVN_URL="%SVN_HOME%/tags/%2"
+set ARC_NAME=%ARC_NAME%%2
+set WARC_NAME=YDWeblog-%2
+echo Build type: %BLDTYPE%
+echo SVN URL: %SVN_URL%
+set SVN_REV=%2
+set SVN_CMD=svn export %SVN_URL% %ARC_NAME%
+goto build_export
+
+:setup_buildtype_snapshot
+echo [task] Setting up the build...
+set BLDTYPE=snapshot
+set SVN_URL="%SVN_HOME%/trunk"
+set SVN_REV=%2
+set ARC_NAME=%ARC_NAME%bld%2
+set WARC_NAME=YDWeblog-bld%2
+echo Build type: %BLDTYPE%
+echo SVN URL: %SVN_URL%
+set SVN_CMD=svn export -r "%2" %SVN_URL% "%ARC_NAME%"
+goto build_export
+
+:error_missing_build_type
+echo ERROR: The build type was not specified.
+goto end
+
+:error_wrong_build_type
+echo ERROR: The build type "%1" is not supported.
+goto end
+
+:error_missing_svn_url
+echo ERROR: The SVN path was not given as an argument.
+goto end
+
+:end



From pclaerhout at berlios.de  Mon Feb 27 12:22:09 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 12:22:09 +0100
Subject: [ydf-devel] r1735 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602271122.k1RBM9xH013570@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 12:22:08 +0100 (Mon, 27 Feb 2006)
New Revision: 1735

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/links.tpl
Log:
When you click on a link in the links section of the admin side, the visit count will now properly increase.

Bug #6576

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-02-27 11:13:42 UTC (rev 1734)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-02-27 11:22:08 UTC (rev 1735)
@@ -67,7 +67,7 @@
         {foreach from=$links->set item="link"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                 <td class="adminRowL">{$link.title}</td>
-                <td class="adminRowL"><a href="{$link.url}" target="_blank">{$link.url}</a></td>
+                <td class="adminRowL"><a href="../link.php?id={$link.id}" target="_blank">{$link.url}</a></td>
                 <td class="adminRowR">{$link.num_visits}</td>
                 <td class="adminRowR">
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$link.id}">{t w="edit"}</a> |



From pclaerhout at berlios.de  Mon Feb 27 13:33:29 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 13:33:29 +0100
Subject: [ydf-devel] r1736 - in YDFramework2.0/trunk/examples/weblog: include manage
Message-ID: <200602271233.k1RCXTgw018424@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 13:33:22 +0100 (Mon, 27 Feb 2006)
New Revision: 1736

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/manage/stats.php
Log:
Fixed the wrong statistics in the weblog statistics.

Bug #6574

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 11:22:08 UTC (rev 1735)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 12:33:22 UTC (rev 1736)
@@ -222,12 +222,15 @@
             if ( substr( $values['uri'], 0, 1 ) == '/' ) {
                 $values['uri'] = substr( $values['uri'], 1 );
             }
+            if ( substr( $values['uri'], 0, 4 ) == '.php' ) {
+                $values['uri'] = basename( YD_SELF_SCRIPT ) . substr( $values['uri'], 4 );
+            }
             $values['date'] = strftime( '%Y-%m-%d' );
             $values['browser'] = $this->browser->browser;
             $values['platform'] = $this->browser->platform;
 
             // Fix the short URLs so that they all look the same
-            if ( YDConfig::get( 'friendly_urls', true ) ) {
+            if ( YDConfig::get( 'friendly_urls', true ) && strpos( $values['uri'], '_' ) ) {
                 if ( YDStringUtil::startswith( $values['uri'], 'image/', false ) ) {
                     $values['uri'] = 'item_gallery.php?id=' . substr( $values['uri'], 6 );
                 } elseif ( YDStringUtil::startswith( $values['uri'], 'archive' ) ) {

Modified: YDFramework2.0/trunk/examples/weblog/manage/stats.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-02-27 11:22:08 UTC (rev 1735)
+++ YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-02-27 12:33:22 UTC (rev 1736)
@@ -15,6 +15,11 @@
             // Register the graph template function
             $this->tpl->register_function( 'graph', array( & $this, 'templateGraph' ) );
 
+            // Update the possible wrong statistics
+            $this->weblog->db->executeSql(
+                "update #_statistics set uri = concat( 'item', uri ) where uri like '.php?id=%'"
+            );
+
         }
 
         // Special template function to draw a graph



From pclaerhout at berlios.de  Mon Feb 27 13:33:54 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 13:33:54 +0100
Subject: [ydf-devel] r1737 - YDFramework2.0/trunk
Message-ID: <200602271233.k1RCXsVM018776@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 13:33:52 +0100 (Mon, 27 Feb 2006)
New Revision: 1737

Removed:
   YDFramework2.0/trunk/make_release.bat
Log:
Removed the old make_release.bat script.

Deleted: YDFramework2.0/trunk/make_release.bat
===================================================================
--- YDFramework2.0/trunk/make_release.bat	2006-02-27 12:33:22 UTC (rev 1736)
+++ YDFramework2.0/trunk/make_release.bat	2006-02-27 12:33:52 UTC (rev 1737)
@@ -1,176 +0,0 @@
- at echo off
-
-rem Needs the following software:
-rem   - Doxygen
-rem   - xsltproc
-rem   - fop
-rem   - cscript
-rem   - tar
-rem   - gzip
-rem   - sed
-
-:config_settings
-set SVN_HOME=svn://svn.berlios.de/ydframework/YDFramework2.0
-set BLDTYPE=
-set SVN_URL=
-set SVN_REV=
-set SVN_CMD=
-set ARC_NAME=YDFramework-
-
-:check_environment_svn_url
-if "%2" == "" goto error_missing_svn_url
-
-:check_environment_build_type
-if "%1" == "" goto error_missing_build_type
-if "%1" == "--release"  goto setup_buildtype_release
-if "%1" == "--snapshot" goto setup_buildtype_snapshot
-if "%BLDTYPE%" == "" goto error_wrong_build_type
-goto do_export
-
-:build_export
-if exist "%ARC_NAME%" ( rmdir /Q /S "%ARC_NAME%" )
-echo [task] Exporting SVN repository...
-%SVN_CMD%
-
-:build_docs
-pushd "%ARC_NAME%"
-
-:build_docs_api
-echo [task] Creating API documentation...
-cd "doc"
-if exist "api" ( rmdir /Q /S api )
-mkdir "api"
-doxygen "docs_api.dxy"
-
-:builds_docs_userguide
-cd "..\doc_src"
-
-:builds_docs_userguide_html
-echo [task] Creating HTML version of the user guide...
-if exist "html" ( rmdir /Q /S "html" )
-mkdir "html"
-copy "images\*.gif" "html" > NUL
-copy "docbook\images\note.gif" "html" > NUL
-copy "docbook\images\warning.gif" "html" > NUL
-copy "style.css" "html" > NUL
-xsltproc --xinclude --output "html\index.html" "xsl_html.xsl" "_ydframework.xml"
-
-:builds_docs_userguide_pdf
-echo [task] Creating PDF version of the user guide...
-if exist "pdf" ( rmdir /Q /S "pdf" )
-mkdir "pdf"
-copy "images\*.gif" "pdf" > NUL
-copy "docbook\images\note.gif" "pdf" > NUL
-copy "docbook\images\warning.gif" "pdf" > NUL
-echo Creating XSL-FO version of the user guide...
-xsltproc --xinclude --output "pdf\YDFramework2.fo" "xsl_fo.xsl" "_ydframework.xml"
-echo Fixing the font sizes in the XSL-FO file...
-cscript //nologo "fixfo.vbs" "pdf\YDFramework2.fo"
-echo Creating PDF version of the user guide...
-call fop -q -c "fop_config.xml" "pdf\YDFramework2.fo" "pdf\YDFramework2.pdf"
-if exist "pdf\YDFramework2.fo" ( "del pdf\YDFramework2.fo" )
-del "pdf\*.gif" > NUL
-
-:move_docs
-echo [task] Moving documentation to the right location...
-cd ..
-if exist "doc\userguide" ( rmdir /Q /S "doc\userguide" )
-if exist "..\YDFramework2.pdf" ( del /Q "..\YDFramework2.pdf" > NUL )
-mkdir "doc\userguide"
-move /Y "doc_src\html\*.*" "doc\userguide\"
-move /Y "doc_src\pdf\YDFramework2.pdf" "..\YDFramework2.pdf"
-rmdir /Q /S "doc_src"
-
-:cleanup_build
-echo [task] Cleaning up the tree structure...
-del /Q "doc\build_api.bat" > NUL
-del /Q "doc\docs_api.dxy" > NUL
-del /Q "doc\docs_api_footer.html" > NUL
-del /Q "doc\RequestProcessing.vsd" > NUL
-del /Q "YDFramework2\images\*.psd" > NUL
-del /Q "make_release.bat" > NUL
-
-:create_build_number_file
-echo [task] Creating build revision file...
-sed "s/'YD_FW_REVISION', 'unknown'/'YD_FW_REVISION', '%SVN_REV%'/g" "YDFramework2\YDF2_init.php" > "YDFramework2\YDF2_init_fixed.php"
-del /Q "YDFramework2\YDF2_init.php" > NUL
-move /Y "YDFramework2\YDF2_init_fixed.php" "YDFramework2\YDF2_init.php"
-
-:create_weblog_archive
-echo [task] Creating archive of the weblog application...
-if exist "..\%WARC_NAME%" ( rmdir /Q /S "..\%WARC_NAME%" )
-mkdir "..\%WARC_NAME%"
-xcopy /E /Y /Q /S "examples\weblog" "..\%WARC_NAME%"
-mkdir "..\%WARC_NAME%\include\YDFramework2"
-xcopy /E /Y /Q /S "YDFramework2" "..\%WARC_NAME%\include\YDFramework2"
-cd "..\%WARC_NAME%"
-sed "s/\/\.\.\/\.\.\/\YDFramework2/\/include\/YDFramework2/g" install.php > install_fixed.php
-del /Q "install.php" > NUL
-move /Y "install_fixed.php" "install.php"
-cd "include"
-sed "s/\/\.\.\/\.\.\/\.\.\/YDFramework2/\/YDFramework2/g" "YDWeblog_init.php" > "YDWeblog_init_fixed.php"
-del /Q "YDWeblog_init.php" > NUL
-move /Y "YDWeblog_init_fixed.php" "YDWeblog_init.php"
-
-:create_archive_framework
-echo [task] Creating .tar.gz archive of this build...
-cd "..\.."
-if exist "%ARC_NAME%.tar" ( del /Q "%ARC_NAME%.tar" > NUL )
-tar cf "%ARC_NAME%.tar" "%ARC_NAME%"
-if exist "%ARC_NAME%.tar.gz" ( del /Q "%ARC_NAME%.tar.gz" > NUL )
-gzip -9 "%ARC_NAME%.tar"
-
-:create_archive_weblog
-echo [task] Creating .tar.gz archive of this weblog build...
-if exist "%WARC_NAME%.tar" ( del /Q "%WARC_NAME%.tar" > NUL )
-tar cf "%WARC_NAME%.tar" "%WARC_NAME%"
-if exist "%WARC_NAME%.tar.gz" ( del /Q "%WARC_NAME%.tar.gz" > NUL )
-gzip -9 "%WARC_NAME%.tar"
-
-:cleanup_build
-echo [task] Cleaning up the temporary build files...
-if exist "%ARC_NAME%" ( rmdir /Q /S "%ARC_NAME%" )
-if exist "%WARC_NAME%" ( rmdir /Q /S "%WARC_NAME%" )
-
-:finish_build
-echo [task] Finished the build!
-popd
-goto end
-
-:setup_buildtype_release
-echo [task] Setting up the build...
-set BLDTYPE=release
-set SVN_URL="%SVN_HOME%/tags/%2"
-set ARC_NAME=%ARC_NAME%%2
-set WARC_NAME=YDWeblog-%2
-echo Build type: %BLDTYPE%
-echo SVN URL: %SVN_URL%
-set SVN_REV=%2
-set SVN_CMD=svn export %SVN_URL% %ARC_NAME%
-goto build_export
-
-:setup_buildtype_snapshot
-echo [task] Setting up the build...
-set BLDTYPE=snapshot
-set SVN_URL="%SVN_HOME%/trunk"
-set SVN_REV=%2
-set ARC_NAME=%ARC_NAME%bld%2
-set WARC_NAME=YDWeblog-bld%2
-echo Build type: %BLDTYPE%
-echo SVN URL: %SVN_URL%
-set SVN_CMD=svn export -r "%2" %SVN_URL% "%ARC_NAME%"
-goto build_export
-
-:error_missing_build_type
-echo ERROR: The build type was not specified.
-goto end
-
-:error_wrong_build_type
-echo ERROR: The build type "%1" is not supported.
-goto end
-
-:error_missing_svn_url
-echo ERROR: The SVN path was not given as an argument.
-goto end
-
-:end



From pclaerhout at berlios.de  Mon Feb 27 13:39:23 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 13:39:23 +0100
Subject: [ydf-devel] r1738 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602271239.k1RCdNwG021476@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 13:38:55 +0100 (Mon, 27 Feb 2006)
New Revision: 1738

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Added the YDForm::addElements function.

Feature Request #1874

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-27 12:33:52 UTC (rev 1737)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-27 12:38:55 UTC (rev 1738)
@@ -340,6 +340,8 @@
          *  @param $label       (optional) The label for the form element.
          *  @param $attributes  (optional) The attributes for the form element.
          *  @param $options     (optional) The options for the elment.
+         *
+         *  @returns    A reference to the element that was added.
          */
         function & addElement( $type, $name, $label='', $attributes=array(), $options=array() ) {
 
@@ -401,6 +403,21 @@
         }
 
         /**
+         *  This function will add multiple form elements at once.
+         *
+         *  @param $type        The type of element to add.
+         *  @param $names       Array with the names of the elements that should be added.
+         *  @param $label       (optional) The label for the form element.
+         *  @param $attributes  (optional) The attributes for the form element.
+         *  @param $options     (optional) The options for the elment.
+         */
+        function addElements( $type, $names, $label='', $attributes=array(), $options=array() ) {
+            foreach ( $names as $name ) {
+                $this->addElement( $type, $name, $label, $attributes, $options );
+            }
+        }
+
+        /**
          *  This function removes the specified form element.
          *
          *  @param $name    The name of the form element.



From pclaerhout at berlios.de  Mon Feb 27 14:16:41 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:16:41 +0100
Subject: [ydf-devel] r1739 - in YDFramework2.0/trunk/examples/weblog: include include/languages manage
Message-ID: <200602271316.k1RDGf9d004291@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:16:28 +0100 (Mon, 27 Feb 2006)
New Revision: 1739

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
Log:
Added configuration options to set the defaults for new items.

Feature Request #1839

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -27,6 +27,12 @@
         if ( ! isset( $values['include_debug_info'] ) ) {
             $values['include_debug_info'] = 0;
         }
+        if ( ! isset( $values['dflt_allow_comments'] ) ) {
+            $values['dflt_allow_comments'] = true;
+        }
+        if ( ! isset( $values['dflt_is_draft'] ) ) {
+            $values['dflt_is_draft'] = false;
+        }
 
         // Construct the new config text
         $cfg = '<?php' . "\n\n";

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -270,6 +270,7 @@
 $GLOBALS['t']['cfg_auto_close_items'] = 'Do not allow comment after x days';
 $GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Show debugging information';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Default values for new items';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -269,6 +269,7 @@
 $GLOBALS['t']['cfg_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours';
 $GLOBALS['t']['err_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours devrait &ecirc;tre num&eacute;rique';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Affiche des informations de d&eacute;bogage';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Valeurs par d&eacute;faut pour des nouveaux articles';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -270,6 +270,7 @@
 $GLOBALS['t']['cfg_auto_close_items'] = 'Laat geen commentaren toe na x dagen';
 $GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Toon debugging informatie';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Standaard waardes voor nieuwe posts';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -24,10 +24,13 @@
             $config = $this->getConfig();
 
             // Fix the boolean values
-            $config['email_new_comment']  = ( $config['email_new_comment'] ) ? t('yes') : t('no');
-            $config['use_cache']          = ( $config['use_cache'] ) ? t('yes') : t('no');
-            $config['friendly_urls']      = ( $config['friendly_urls'] ) ? t('yes') : t('no');
-            $config['include_debug_info'] = ( $config['include_debug_info'] ) ? t('yes') : t('no');
+            $config['email_new_comment']   = ( $config['email_new_comment'] ) ? t('yes') : t('no');
+            $config['use_cache']           = ( $config['use_cache'] ) ? t('yes') : t('no');
+            $config['friendly_urls']       = ( $config['friendly_urls'] ) ? t('yes') : t('no');
+            $config['include_debug_info']  = ( $config['include_debug_info'] ) ? t('yes') : t('no');
+            $config['dflt_allow_comments'] = ( $config['dflt_allow_comments'] ) ? t('yes') : t('no');
+            $config['dflt_is_draft']       = ( $config['dflt_is_draft'] ) ? t('yes') : t('no');
+            $config['auto_close_items']    = ( empty( $config['auto_close_items'] ) ) ? '-' : $config['auto_close_items'];
 
             // Assign it to the template
             $this->tpl->assign( 'config', $config );
@@ -84,7 +87,9 @@
 
             $form->addElement( 'checkbox', 'friendly_urls', t( 'cfg_friendly_urls' ), array( 'style' => 'border: none;' ) );
 
+            $form->addElement( 'checkbox', 'dflt_allow_comments', t( 'allow_comments' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'auto_close_items', t( 'cfg_auto_close_items' ), array( 'class' => 'tfM' ) );
+            $form->addElement( 'checkbox', 'dflt_is_draft', t( 'is_draft' ), array( 'style' => 'border: none;' ) );
 
             $form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 
@@ -153,6 +158,8 @@
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );
             $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     '' );
+            $config['dflt_allow_comments']  = YDConfig::get( 'dflt_allow_comments',  true );
+            $config['dflt_is_draft']        = YDConfig::get( 'dflt_is_draft',        false );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-27 13:16:28 UTC (rev 1739)
@@ -80,6 +80,24 @@
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>
         <tr>
+            <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_default_item_settings"}</th>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="allow_comments"}</td>
+            <td class="adminRowL" width="400">{$config.dflt_allow_comments}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="cfg_auto_close_items"}</td>
+            <td class="adminRowL" width="400">{$config.auto_close_items}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="is_draft"}</td>
+            <td class="adminRowL">{$config.dflt_is_draft}</td>
+        </tr>
+    </table>
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+        <tr><td colspan="3">&nbsp;</td></tr>
+        <tr>
             <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_cache"}</th>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
@@ -107,16 +125,14 @@
             <td class="adminRowL" width="400">{$config.max_syndicated_items}</td>
         </tr>
     </table>
+    {*
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>
         <tr>
             <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
         </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="300">{t w="cfg_auto_close_items"}</td>
-            <td class="adminRowL" width="400">{$config.auto_close_items}</td>
-        </tr>
     </table>
+    *}
     <p><input type="button" class="button" onClick="window.location='{$YD_SELF_SCRIPT}?do=edit';" value="{t w="change_config"}" />
 {/if}
 
@@ -186,6 +202,24 @@
         <table width="700" cellspacing="0" cellpadding="0" border="0">
             <tr><td colspan="3">&nbsp;</td></tr>
             <tr>
+                <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_default_item_settings"}</th>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{$form.dflt_allow_comments.label_html}</td>
+                <td class="adminRowL" width="400">{$form.dflt_allow_comments.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{$form.auto_close_items.label_html}</td>
+                <td class="adminRowL" width="400">{$form.auto_close_items.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{$form.dflt_is_draft.label_html}</td>
+                <td class="adminRowL" width="400">{$form.dflt_is_draft.html}</td>
+            </tr>
+        </table>
+        <table width="700" cellspacing="0" cellpadding="0" border="0">
+            <tr><td colspan="3">&nbsp;</td></tr>
+            <tr>
                 <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_cache"}</th>
             </tr>
             <tr>
@@ -213,16 +247,6 @@
                 <td class="adminRowL" width="400">{$form.max_syndicated_items.html}</td>
             </tr>
         </table>
-        <table width="700" cellspacing="0" cellpadding="0" border="0">
-            <tr><td colspan="3">&nbsp;</td></tr>
-            <tr>
-                <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
-            </tr>
-            <tr>
-                <td class="adminRowL" width="300">{$form.auto_close_items.label_html}</td>
-                <td class="adminRowL" width="400">{$form.auto_close_items.html}</td>
-            </tr>
-        </table>
         <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 12:38:55 UTC (rev 1738)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 13:16:28 UTC (rev 1739)
@@ -79,8 +79,19 @@
 
             } else {
 
+                // Get the defaults
+                $defaults = array();
+                $defaults['allow_comments'] = YDConfig::get( 'dflt_allow_comments', true );
+                $auto_close_items = YDConfig::get( 'auto_close_items', true );
+                if ( empty( $auto_close_items ) ) {
+                    $defaults['auto_close'] = false;
+                } else {
+                    $defaults['auto_close'] = true;
+                }
+                $defaults['is_draft'] = YDConfig::get( 'dflt_is_draft', false );
+
                 // Set the form defaults
-                $form->setDefaults( array( 'allow_comments' => 1, 'auto_close' => 1, 'is_draft' => 0 ) );
+                $form->setDefaults( $defaults );
 
             }
 



From pclaerhout at berlios.de  Mon Feb 27 14:23:05 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:23:05 +0100
Subject: [ydf-devel] r1740 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602271323.k1RDN5gE008058@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:23:03 +0100 (Mon, 27 Feb 2006)
New Revision: 1740

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
Log:
Disabling the cache now also deleted the compiled templates as they sometimes do get out of sync.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 13:16:28 UTC (rev 1739)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 13:23:03 UTC (rev 1740)
@@ -71,6 +71,9 @@
                             @unlink( YD_DIR_TEMP . '/' . $file );
                         }
                     }
+                    if ( substr( $file, -strlen( '.tpl.php' ) ) == '.tpl.php' ) {
+                        @unlink( YD_DIR_TEMP . '/' . $file );
+                    }
                 }
                 closedir( $handle );
             }



From pclaerhout at berlios.de  Mon Feb 27 14:27:41 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:27:41 +0100
Subject: [ydf-devel] r1741 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200602271327.k1RDRff9010976@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:27:39 +0100 (Mon, 27 Feb 2006)
New Revision: 1741

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
Log:
Every admin request now automatically optimizes the MySQL tables.

Feature Request #1856

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 13:23:03 UTC (rev 1740)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 13:27:39 UTC (rev 1741)
@@ -299,6 +299,14 @@
             // Change the template directory
             $this->tpl->template_dir = YD_SELF_DIR;
 
+            // Get a link to the database metadata
+            $dbmeta = new YDDatabaseMetaData( $this->weblog->db );
+
+            // Optimize the tables
+            foreach ( $dbmeta->getTables() as $table ) {
+                $this->weblog->db->executeSql( 'optimize table ' . $table );
+            }
+
         }
 
         // Init the template



From pclaerhout at berlios.de  Mon Feb 27 14:54:22 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:54:22 +0100
Subject: [ydf-devel] r1742 - in YDFramework2.0/trunk/examples/weblog: include include/languages manage skins/default
Message-ID: <200602271354.k1RDsMN3027731@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:54:16 +0100 (Mon, 27 Feb 2006)
New Revision: 1742

Added:
   YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/skins/default/comment_email.tpl
Log:
Added support for new item emails.

Feature Request #1857

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -327,7 +327,7 @@
 
         // Add an item
         function addItem( $values ) {
-            return $this->_executeInsert( '#_items', $values );
+            $result = $this->_executeInsert( '#_items', $values );
         }
 
         // Update an item

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -94,6 +94,9 @@
 $GLOBALS['t']['item_title'] = 'Item title';
 $GLOBALS['t']['wrote'] = 'wrote';
 
+// item_email.tpl
+$GLOBALS['t']['new_item'] = 'New item';
+
 // page.tpl
 $GLOBALS['t']['created_on'] = 'Created on';
 $GLOBALS['t']['last_modified_on'] = 'Last modified on';
@@ -251,6 +254,7 @@
 $GLOBALS['t']['cfg_weblog_date_format'] = 'Date format';
 $GLOBALS['t']['cfg_notification'] = 'Notification Settings';
 $GLOBALS['t']['cfg_notification_email_comment'] = 'Email new comments';
+$GLOBALS['t']['cfg_notification_email_item'] = 'Email new items to site authors';
 $GLOBALS['t']['cfg_rss'] = 'Syndication Settings';
 $GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Number of syndicated items';
 $GLOBALS['t']['err_db_host'] = 'Database Hostname is required';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -94,6 +94,9 @@
 $GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';
 $GLOBALS['t']['wrote'] = '&eacute;crit';
 
+// item_email.tpl
+$GLOBALS['t']['new_item'] = 'Nouveau entr&eacute;e';
+
 // page.tpl
 $GLOBALS['t']['created_on'] = 'Cr&eacute;&eacute; le';
 $GLOBALS['t']['last_modified_on'] = 'Derni&egrave;re modification le';
@@ -250,6 +253,7 @@
 $GLOBALS['t']['cfg_weblog_date_format'] = 'Format des dates';
 $GLOBALS['t']['cfg_notification'] = 'Options de notification';
 $GLOBALS['t']['cfg_notification_email_comment'] = 'Pr&eacute;venir par email des nouveaux commentaires';
+$GLOBALS['t']['cfg_notification_email_item'] = 'Pr&eacute;venir par email des nouveaux articles';
 $GLOBALS['t']['cfg_rss'] = 'Options de syndication';
 $GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Nombre d\'entr&eacute;es syndiqu&eacute;es';
 $GLOBALS['t']['err_db_host'] = 'Le serveur (hostname) de la base de donn&eacute;es est requis';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -94,6 +94,9 @@
 $GLOBALS['t']['item_title'] = 'Item titel';
 $GLOBALS['t']['wrote'] = 'schreef';
 
+// item_email.tpl
+$GLOBALS['t']['new_item'] = 'Nieuw item';
+
 // page.tpl
 $GLOBALS['t']['created_on'] = 'Aangemaakt op';
 $GLOBALS['t']['last_modified_on'] = 'Laatst aangepast op';
@@ -251,6 +254,7 @@
 $GLOBALS['t']['cfg_weblog_date_format'] = 'Datum formaat';
 $GLOBALS['t']['cfg_notification'] = 'Notificatie Instellingen';
 $GLOBALS['t']['cfg_notification_email_comment'] = 'Email nieuwe commentaren';
+$GLOBALS['t']['cfg_notification_email_item'] = 'Email niewe items naar de site auteurs';
 $GLOBALS['t']['cfg_rss'] = 'Syndicatie Instellingen';
 $GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Aantal gesyndiceerde items';
 $GLOBALS['t']['err_db_host'] = 'Database Hostnaam is vereist';

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -25,6 +25,7 @@
 
             // Fix the boolean values
             $config['email_new_comment']   = ( $config['email_new_comment'] ) ? t('yes') : t('no');
+            $config['email_new_item']      = ( $config['email_new_item'] ) ? t('yes') : t('no');
             $config['use_cache']           = ( $config['use_cache'] ) ? t('yes') : t('no');
             $config['friendly_urls']       = ( $config['friendly_urls'] ) ? t('yes') : t('no');
             $config['include_debug_info']  = ( $config['include_debug_info'] ) ? t('yes') : t('no');
@@ -81,6 +82,7 @@
             $form->addElement( 'checkbox', 'include_debug_info', t( 'cfg_include_debug_info' ), array( 'style' => 'border: none;' ) );
 
             $form->addElement( 'checkbox', 'email_new_comment', t( 'cfg_notification_email_comment' ),  array( 'style' => 'border: none;' ) );
+            $form->addElement( 'checkbox', 'email_new_item', t( 'cfg_notification_email_item' ),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'max_syndicated_items', t( 'cfg_rss_max_syndicated_items' ), array( 'class' => 'tfM' ) );
 
             $form->addElement( 'checkbox', 'use_cache', t( 'cfg_use_cache_comment' ), array( 'style' => 'border: none;' ) );
@@ -154,6 +156,7 @@
             $config['weblog_language']      = YDConfig::get( 'weblog_language',      'nl' );
             $config['include_debug_info']   = YDConfig::get( 'include_debug_info',   false );
             $config['email_new_comment']    = YDConfig::get( 'email_new_comment',    true );
+            $config['email_new_item']       = YDConfig::get( 'email_new_item',       true );
             $config['max_syndicated_items'] = YDConfig::get( 'max_syndicated_items', 20 );
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-02-27 13:54:16 UTC (rev 1742)
@@ -114,6 +114,10 @@
             <td class="adminRowL" width="300">{t w="cfg_notification_email_comment"}</td>
             <td class="adminRowL" width="400">{$config.email_new_comment}</td>
         </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="cfg_notification_email_item"}</td>
+            <td class="adminRowL" width="400">{$config.email_new_item}</td>
+        </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 13:54:16 UTC (rev 1742)
@@ -119,6 +119,35 @@
                     // Add it to the database
                     $this->weblog->addItem( $values );
 
+                    // Send an email if configured
+                    if ( YDConfig::get( 'email_new_item', true ) ) {
+
+                        // Include the YDEmail library
+                        YDInclude( 'YDEmail.php' );
+
+                        // Get the list of subscriptions
+                        $subscribers = $this->weblog->getUsers();
+
+                        // Add the comment to the email template
+                        $this->tpl->assign( 'item', $values );
+
+                        // Create the email and send it
+                        $eml = new YDEmail();
+                        if ( ! empty( $item['user_email'] ) ) {
+                            $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                        } else {
+                            $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                        }
+                        $eml->setReplyTo( 'no at reply.net' );
+                        foreach ( $subscribers as $subscriber ) {
+                            $eml->addBcc( $subscriber['email'], $subscriber['name'] );
+                        }
+                        $eml->setSubject( 'New item: ' . strip_tags( $values['title'] ) );
+                        $eml->setHtmlBody( $this->fetch( dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/item_email.tpl' ) );
+                        $eml->send();
+
+                    }
+
                 }
 
                 // Redirect to the default acton

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/comment_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/comment_email.tpl	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/comment_email.tpl	2006-02-27 13:54:16 UTC (rev 1742)
@@ -4,7 +4,6 @@
 
     <title>{$weblog.title}</title>
 
-    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
     <meta name="generator" content="{$YD_FW_NAMEVERS}" />
 
     <link rel="stylesheet" href="{$skin_dir}/default.css" type="text/css" media="screen" />

Added: YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-02-27 13:27:39 UTC (rev 1741)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-02-27 13:54:16 UTC (rev 1742)
@@ -0,0 +1,54 @@
+<html>
+
+<head>
+
+    <title>{$weblog.title}</title>
+
+    <meta name="generator" content="{$YD_FW_NAMEVERS}" />
+
+    <link rel="stylesheet" href="{$skin_dir}/default.css" type="text/css" media="screen" />
+
+    <style type="text/css" media="screen">
+        body        {literal}{{/literal} background: url("{$image_dir}/kubrickbgcolor.jpg");                                 {literal}}{/literal}
+        #page       {literal}{{/literal} background: url("{$image_dir}/kubrickbgwide.jpg") repeat-y top; border: none;       {literal}}{/literal}
+        #header     {literal}{{/literal} background: url("{$image_dir}/kubrickheader.jpg") no-repeat top center;             {literal}}{/literal}
+        #footer     {literal}{{/literal} background: url("{$image_dir}/kubrickfooter.jpg") no-repeat bottom; border: none;   {literal}}{/literal}
+        #header     {literal}{{/literal} margin: 0 !important; margin: 0; padding: 1px; height: 0px; width: 758px;           {literal}}{/literal}
+        #headerimg  {literal}{{/literal} margin: 0; height: 0px; width: 740px;                                               {literal}}{/literal}
+        .bbtextarea {literal}{{/literal} width: 650px; height: 160px;                                                        {literal}}{/literal}
+    </style>
+
+</head>
+
+<body>
+
+    <div id="page">
+
+        <div id="header"></div>
+
+        <div id="content" class="narrowcolumn">
+
+            <h3>{t w="new_item"}: {$item.title}</h3>
+
+            <p>
+                <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>
+                <b>{t w="item_title"}</b>: <a href="{$item|@link_item}">{$item.title}</a><br/>
+            </p>
+
+            <blockquote>
+                <p>{$item.body|bbcode}</p>
+                <p>{$item.body_more|bbcode}</p>
+            </blockquote>
+
+            &nbsp;
+
+        </div>
+
+        <div id="footer"></div>
+
+    </div>
+
+</body>
+
+</html>
+



From pclaerhout at berlios.de  Mon Feb 27 14:56:15 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:56:15 +0100
Subject: [ydf-devel] r1743 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200602271356.k1RDuFcR028294@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:56:07 +0100 (Mon, 27 Feb 2006)
New Revision: 1743

Modified:
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Subject of new comment email is now translated.

Bug #6601

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-02-27 13:54:16 UTC (rev 1742)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-02-27 13:56:07 UTC (rev 1743)
@@ -124,7 +124,7 @@
                         foreach ( $subscribers as $subscriber ) {
                             $eml->addBcc( $subscriber );
                         }
-                        $eml->setSubject( 'New comment: ' . strip_tags( $item['title'] ) );
+                        $eml->setSubject( t('new_comment') . ': ' . strip_tags( $item['title'] ) );
                         $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
                         $eml->send();
 



From pclaerhout at berlios.de  Mon Feb 27 14:57:45 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 14:57:45 +0100
Subject: [ydf-devel] r1744 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200602271357.k1RDvjm9028595@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 14:57:04 +0100 (Mon, 27 Feb 2006)
New Revision: 1744

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items.php
Log:
New item emails now have translated subjects.

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 13:56:07 UTC (rev 1743)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-02-27 13:57:04 UTC (rev 1744)
@@ -142,7 +142,7 @@
                         foreach ( $subscribers as $subscriber ) {
                             $eml->addBcc( $subscriber['email'], $subscriber['name'] );
                         }
-                        $eml->setSubject( 'New item: ' . strip_tags( $values['title'] ) );
+                        $eml->setSubject( t('new_item') . ': ' . strip_tags( $values['title'] ) );
                         $eml->setHtmlBody( $this->fetch( dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/item_email.tpl' ) );
                         $eml->send();
 



From ydfpoi at gmail.com  Mon Feb 27 16:22:28 2006
From: ydfpoi at gmail.com (ydf poi)
Date: Mon, 27 Feb 2006 16:22:28 +0100
Subject: [ydf-devel] Typos in french translations of YDF Weblog
Message-ID: <306340e00602270722hc028eafp@mail.gmail.com>

Hi Pieter,

I propose 3 little changes for Weblog's translation in language_fr.php:

$GLOBALS['t']['no_items_found'] = 'D&eacute;sol&eacute;, aucun
&eacute;l&eacute;ment correspondant.';
should be 'D&eacute;sol&eacute;, aucune entr&eacute;e correspondante.'

$GLOBALS['t']['new_item'] = 'Nouveau entr&eacute;e';
should be 'Nouvelle entr&eacute;e'

$GLOBALS['t']['cfg_default_item_settings'] = 'Valeurs par
d&eacute;faut pour des nouveaux articles'
should be 'Valeurs par d&eacute;faut pour les nouvelles entr&eacute;es'

Kind regards
--
po?


From pclaerhout at berlios.de  Mon Feb 27 16:42:44 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 16:42:44 +0100
Subject: [ydf-devel] r1745 - in YDFramework2.0/trunk: YDFramework2 YDFramework2/YDClasses examples/weblog/include
Message-ID: <200602271542.k1RFgiPg027870@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 16:42:43 +0100 (Mon, 27 Feb 2006)
New Revision: 1745

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/YDF2_core.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
Log:
Made the t template modifier available in the complete framework.

I also moved the template modifier definitions to the root so that they are always available.

Feature Request #1752

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-27 13:57:04 UTC (rev 1744)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-02-27 15:42:43 UTC (rev 1745)
@@ -79,7 +79,11 @@
                 $this->register_modifier( 'fmtfilesize', 'YDTemplate_modifier_fmtfileize' );
                 $this->register_modifier( 'date_format', 'YDTemplate_modifier_date_format' );
                 $this->register_modifier( 'dump', 'YDTemplate_modifier_dump' );
+                $this->register_modifier( 'bbcode', 'YDTemplate_modifier_bbcode' );
 
+                // Register the custom functions
+                $this->register_function( 't', 'YDTemplate_function_t' );
+
                 // custom javascript code
                 $this->customJavascript = null;
 
@@ -301,67 +305,6 @@
 
         }
 
-        /**
-         *	@internal
-         */
-        function YDTemplate_modifier_fmtfileize( $size ) {
-            return YDStringUtil::formatFileSize( $size );
-        }
-
-        /**
-         *	@internal
-         */
-        function YDTemplate_modifier_implode( $array, $separator=', ' ) {
-            return implode( $separator, $array );
-        }
-
-        /**
-         *	@internal
-         */
-        function YDTemplate_make_timestamp( $string ) {
-            if ( empty( $string ) ) {
-                $string = "now";
-            }
-            $time = strtotime( $string );
-            if ( is_numeric( $time ) && $time != -1 ) {
-                return $time;
-            }
-            if ( preg_match( '/^\d{14}$/', $string ) ) {
-                $time = mktime(
-                    substr( $string, 8, 2 ), substr( $string, 10, 2 ), substr( $string, 12, 2 ),
-                    substr( $string, 4, 2 ), substr( $string, 6, 2 ), substr( $string,0 ,4 )
-                );
-                return $time;
-            }
-            $time = ( int ) $string;
-            if ( $time > 0 ) {
-                return $time;
-            } else {
-                return time();
-            }
-        }
-
-        /**
-         *	@internal
-         */
-        function YDTemplate_modifier_date_format( $string, $format='%b %d, %Y', $default_date=null ) {
-            if( $string != '' ) {
-                return strftime( $format, YDTemplate_make_timestamp( $string ) );
-            } elseif ( isset( $default_date ) && $default_date != '' ) {
-                return strftime( $format, YDTemplate_make_timestamp( $default_date ) );
-            } else {
-                return;
-            }
-        }
-
-        /**
-         *	@internal
-         */
-        function YDTemplate_modifier_dump( $obj ) {
-            var_dump( $obj );
-            return;
-        }
-
     // Use PHP templates
     } else {
 
@@ -537,4 +480,115 @@
 
     }
 
+    /**
+     *	This template function loads a translation from a global variables $_GLOBALS['t'] with specified name.
+     *
+     *  @param  $params   The parameters for the modifier. The parameter "w" gives the name of the translation. The
+     *                    parameter lower indicates if the translation needs to be returned as lowercase or not.
+     *
+     *  @returns    The named translation.
+     */
+    function YDTemplate_function_t( $params ) {
+        if ( @ $params['lower'] == 'yes' ) {
+            return isset( $params['w'] ) ? strtolower( t( $params['w'] ) ) : '';
+        } else {
+            return isset( $params['w'] ) ? t( $params['w'] ) : '';
+        }
+    }
+
+    /**
+     *	This template modifier converts a piece of text to BBCode.
+     *
+     *  @param  $text   The text to convert
+     *
+     *  @returns    The text formatted as HTML.
+     */
+    function YDTemplate_modifier_bbcode( $text ) {
+        YDInclude( 'YDBBCode.php' );
+        $cls = new YDBBCode();
+        return $cls->toHtml( $text, true, false, false, YDRequest::getCurrentUrl() );
+    }
+
+    /**
+     *	This template modifier formats a numeric value to a human readable file size.
+     *
+     *  @param  $size   The numeric value to format.
+     *
+     *  @returns    The filesize in a human readable format.
+     */
+    function YDTemplate_modifier_fmtfileize( $size ) {
+        return YDStringUtil::formatFileSize( $size );
+    }
+
+    /**
+     *	This template modifier converst an array to a string using the specified separator.
+     *
+     *  @param  $array      The array to convert.
+     *  @param  $separator  (optional) The separator to use. Default is ", ".
+     *
+     *  @returns    The array as a string.
+     */
+    function YDTemplate_modifier_implode( $array, $separator=', ' ) {
+        return implode( $separator, $array );
+    }
+
+    /**
+     *	This template modifier generates a timestamp.
+     *
+     *  @param  $string     The string to convert to a timestamp.
+     *
+     *  @returns    The timestamp as a numeric value.
+     */
+    function YDTemplate_make_timestamp( $string ) {
+        if ( empty( $string ) ) {
+            $string = "now";
+        }
+        $time = strtotime( $string );
+        if ( is_numeric( $time ) && $time != -1 ) {
+            return $time;
+        }
+        if ( preg_match( '/^\d{14}$/', $string ) ) {
+            $time = mktime(
+                substr( $string, 8, 2 ), substr( $string, 10, 2 ), substr( $string, 12, 2 ),
+                substr( $string, 4, 2 ), substr( $string, 6, 2 ), substr( $string,0 ,4 )
+            );
+            return $time;
+        }
+        $time = ( int ) $string;
+        if ( $time > 0 ) {
+            return $time;
+        } else {
+            return time();
+        }
+    }
+
+    /**
+     *	This template modifier formats a timestamp as a string using the strftime function.
+     *
+     *  @param  $string     The timestamp to format.
+     *  @param  $format     (optional) The format to use. Default is '%b %d, %Y'.
+     *  @param  $default_date   (optional) If null and no string is given, the current time will be used.
+     *
+     *  @returns    The formatted date.
+     */
+    function YDTemplate_modifier_date_format( $string, $format='%b %d, %Y', $default_date=null ) {
+        if( $string != '' ) {
+            return strftime( $format, YDTemplate_make_timestamp( $string ) );
+        } elseif ( isset( $default_date ) && $default_date != '' ) {
+            return strftime( $format, YDTemplate_make_timestamp( $default_date ) );
+        } else {
+            return;
+        }
+    }
+
+    /*
+     *	This template modifier will dump the contents of the variable using var_dump.
+     *
+     *  @param  $obj    The object to dump.
+     */
+    function YDTemplate_modifier_dump( $obj ) {
+        var_dump( $obj );
+        return;
+    }
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_core.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_core.php	2006-02-27 13:57:04 UTC (rev 1744)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_core.php	2006-02-27 15:42:43 UTC (rev 1745)
@@ -147,6 +147,35 @@
     }
 
     /**
+     *	This function loads a translation from a global variables $_GLOBALS['t'] with specified name.
+     *
+     *  @param  $params   The parameters for the modifier. The parameter "w" gives the name of the translation. The
+     *                    parameter lower indicates if the translation needs to be returned as lowercase or not.
+     *
+     *  @returns    The named translation.
+     */
+    function t( $t ) {
+
+        // Return empty string when param is missing
+        if ( empty( $t ) ) {
+            return '';
+        }
+
+        // Load the language file
+        @include_once( dirname( __FILE__ ) . '/languages/language_' . strtolower( YDLocale::get() ) . '.php' );
+
+        // Initialize the language array
+        if ( ! isset( $GLOBALS['t'] ) ) {
+            $GLOBALS['t'] = array();
+        }
+
+        // Return the right translation
+        $t = strtolower( $t );
+        return ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
+
+    }
+
+    /**
      *  This is the base class for all other YD classes.
      */
     class YDBase {

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 13:57:04 UTC (rev 1744)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-02-27 15:42:43 UTC (rev 1745)
@@ -41,8 +41,6 @@
             $this->tpl->template_dir = dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/';
 
             // Register the modifiers
-            $this->tpl->register_function( 't', 'YDTplModT' );
-            $this->tpl->register_modifier( 'bbcode', 'YDTplModBBCode' );
             $this->tpl->register_modifier( 'date', 'YDTplModDate' );
             $this->tpl->register_modifier( 'link_item', 'YDTplModLinkItem' );
             $this->tpl->register_modifier( 'link_item_gallery', 'YDTplModLinkItemGallery' );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-27 13:57:04 UTC (rev 1744)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-27 15:42:43 UTC (rev 1745)
@@ -71,7 +71,6 @@
     YDInclude( 'YDUrl.php' );
     YDInclude( 'YDUtil.php' );
     YDInclude( 'YDForm.php' );
-    YDInclude( 'YDBBCode.php' );
     YDInclude( 'YDTemplate.php' );
     YDInclude( 'YDDatabase.php' );
     YDInclude( 'YDDatabaseMetaData.php' );
@@ -101,43 +100,6 @@
     $language = empty( $language ) ? 'en' : $language;
     YDLocale::set( $language );
 
-    // The t function used for translations
-    function t( $t ) {
-
-        // Return empty string when param is missing
-        if ( empty( $t ) ) {
-            return '';
-        }
-
-        // Load the language file
-        @include_once( dirname( __FILE__ ) . '/languages/language_' . strtolower( YDLocale::get() ) . '.php' );
-
-        // Initialize the language array
-        if ( ! isset( $GLOBALS['t'] ) ) {
-            $GLOBALS['t'] = array();
-        }
-
-        // Return the right translation
-        $t = strtolower( $t );
-        return ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
-
-    }
-
-    // Template BBCode modifier
-    function YDTplModBBCode( $text ) {
-        $cls = new YDBBCode();
-        return $cls->toHtml( $text, true, false, false, YDRequest::getCurrentUrl() );
-    }
-
-    // Template t modifier
-    function YDTplModT( $params ) {
-        if ( @ $params['lower'] == 'yes' ) {
-            return isset( $params['w'] ) ? strtolower( t( $params['w'] ) ) : '';
-        } else {
-            return isset( $params['w'] ) ? t( $params['w'] ) : '';
-        }
-    }
-
     // Template Date modifier
     function YDTplModDate( $text, $format=null ) {
         if ( is_null( $format ) ) {



From pclaerhout at berlios.de  Mon Feb 27 17:14:32 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 17:14:32 +0100
Subject: [ydf-devel] r1746 - in YDFramework2.0/trunk: YDFramework2/YDClasses examples
Message-ID: <200602271614.k1RGEWHq001159@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 17:14:25 +0100 (Mon, 27 Feb 2006)
New Revision: 1746

Added:
   YDFramework2.0/trunk/examples/database_named_instances.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added support for named database instances.

Feature Request #1756

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-27 15:42:43 UTC (rev 1745)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-02-27 16:14:25 UTC (rev 1746)
@@ -445,6 +445,69 @@
     class YDDatabase extends YDBase {
 
         /**
+         *  This function registers a named database instance.
+         *
+         *  @param $name    The name of the database instance.
+         *  @param $driver  Name of the database driver or array containing drivername, file name and class name.
+         *  @param $db      Database name to use for the connection.
+         *  @param $user    (optional) User name to use for the connection.
+         *  @param $pass    (optional) Password to use for the connection.
+         *  @param $host    (optional) Host name to use for the connection.
+         *
+         *  @static
+         */
+        function registerInstance( $name, $driver, $db, $user='', $pass='', $host='' ) {
+
+            // Check if the global array exists
+            YDDatabase::_initNamedInstances();
+
+            // Register the instance
+            $GLOBALS['YD_DB_INSTANCES'][ strtolower( $name ) ] = array( $driver, $db, $user, $pass, $host );
+
+        }
+
+        /**
+         *  This function will return a YDDatabaseDriver instance for the named database instance. If no instance is
+         *  given, the one with the name "default" will be used.
+         *
+         *  @param $name    (optional) The name of the database instance. Defaults to "default".
+         *
+         *  @returns    An instance of YDDatabaseDriver
+         *
+         *  @static
+         */
+        function getNamedInstance( $name='default' ) {
+
+            // Check if the global array exists
+            YDDatabase::_initNamedInstances();
+
+            // Trigger an error if the named instance doesn't exist.
+            if ( ! array_key_exists( strtolower( $name ), $GLOBALS['YD_DB_INSTANCES'] ) ) {
+                trigger_error( 'The named database instance "' . $name . '" is not defined.', YD_ERROR );
+            }
+
+            // Get the parameters
+            $params = $GLOBALS['YD_DB_INSTANCES'][ strtolower( $name ) ];
+
+            // Return the right named instance
+            return YDDatabase::getInstance( $params[0], $params[1], $params[2], $params[3], $params[4] );
+
+        }
+
+        /**
+         *  Function to setup the array for the named instances.
+         *
+         *  @internal
+         *
+         *  @static
+         */
+        function _initNamedInstances() {
+            if ( ! isset( $GLOBALS['YD_DB_INSTANCES'] ) ) {
+                $GLOBALS['YD_DB_INSTANCES'] = array();
+            }
+        }
+
+        /**
          *  Using this static function, you can get an instance of a YDDatabaseDriver class.
          *
          *  @param $driver  Name of the database driver or array containing drivername, file name and class name.
@@ -452,6 +515,10 @@
          *  @param $user    (optional) User name to use for the connection.
          *  @param $pass    (optional) Password to use for the connection.
          *  @param $host    (optional) Host name to use for the connection.
+         *
+         *  @returns    An instance of YDDatabaseDriver
+         *
+         *  @static
          */
         function getInstance( $driver, $db, $user='', $pass='', $host='' ) {
 

Added: YDFramework2.0/trunk/examples/database_named_instances.php
===================================================================
--- YDFramework2.0/trunk/examples/database_named_instances.php	2006-02-27 15:42:43 UTC (rev 1745)
+++ YDFramework2.0/trunk/examples/database_named_instances.php	2006-02-27 16:14:25 UTC (rev 1746)
@@ -0,0 +1,49 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDDatabase.php' );
+
+    // Class definition
+    class database_named_instances extends YDRequest {
+
+        // Class constructor
+        function database_named_instances() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Register the named instances
+            YDDatabase::registerInstance( 'default',  'mysql', 'ydweblog', 'root', '', 'localhost' );
+            YDDatabase::registerInstance( 'db_mysql', 'mysql', 'mysql',    'root', '', 'localhost' );
+            YDDatabase::registerInstance( 'db_test',  'mysql', 'test',     'root', '', 'localhost' );
+
+            // Get the default instance
+            $db1 = YDDatabase::getNamedInstance();
+            YDDebugUtil::dump( $db1, 'default instance, no name given' );
+
+            // Get the default instance using it's name
+            $db1 = YDDatabase::getNamedInstance( 'DEFAULT' );
+            YDDebugUtil::dump( $db1, 'default instance, using name' );
+
+            // Get the db_mysql instance using it's name
+            $db1 = YDDatabase::getNamedInstance( 'db_mysql' );
+            YDDebugUtil::dump( $db1, 'db_mysql instance' );
+
+            // Get the db_bba_v2 instance using it's name
+            $db1 = YDDatabase::getNamedInstance( 'db_test' );
+            YDDebugUtil::dump( $db1, 'db_test instance' );
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-02-27 15:42:43 UTC (rev 1745)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-02-27 16:14:25 UTC (rev 1746)
@@ -316,7 +316,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="11" valign="top">
+            <td rowspan="12" valign="top">
             <p>&nbsp;</p></td>
             <td valign="top"><a href="database.php">Database connectivity - Native functions</a> </td>
             <td valign="top">
@@ -401,6 +401,14 @@
             </td>
         </tr>
         <tr>
+            <td valign="top">
+                <a href="database_named_instances.php">Using named database instances/a><br/>
+            </td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=database_named_instances.php">database_named_instances.php</a>
+            </td>
+        </tr>
+        <tr>
             <td colspan="2"><b>&nbsp;<br/>Using files, images and directories</b></td>
             <td width="43%"><b>&nbsp;</b></td>
         </tr>



From pclaerhout at berlios.de  Mon Feb 27 17:17:51 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 17:17:51 +0100
Subject: [ydf-devel] r1747 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200602271617.k1RGHpsN001777@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 17:17:48 +0100 (Mon, 27 Feb 2006)
New Revision: 1747

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
Added support for named database instances to YDDatabaseMetaData and YDDatabaseTree.

Feature Request #1797

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-27 16:14:25 UTC (rev 1746)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-02-27 16:17:48 UTC (rev 1747)
@@ -40,8 +40,12 @@
          *
          *  @param $db             The YDDatabase object pointing to the database
          */
-        function YDDatabaseMetaData( $db ) {
-            $this->db    = $db;
+        function YDDatabaseMetaData( $db=null ) {
+            if ( is_null( $db ) ) {
+                $this->db = YDDatabase::getNamedInstance();
+            } else {
+                $this->db = $db;
+            }
         }
 
         /**

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-02-27 16:14:25 UTC (rev 1746)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-02-27 16:17:48 UTC (rev 1747)
@@ -44,8 +44,12 @@
          *  @param $parentField    (optional) Name of the parent ID field. Default is parent_id.
          *  @param $sortField      (optional) Name of the field to sort data. Default is title.
          */
-        function YDDatabaseTree( $db, $table, $idField='id', $parentField='parent_id', $sortField='title' ) {
-            $this->db    = $db;
+        function YDDatabaseTree( $db=null, $table, $idField='id', $parentField='parent_id', $sortField='title' ) {
+            if ( is_null( $db ) ) {
+                $this->db = YDDatabase::getNamedInstance();
+            } else {
+                $this->db = $db;
+            }
             $this->table = $table;
             $this->fields = array(
                 'id' => $idField, 'parent' => $parentField, 'sort' => $sortField,



From pclaerhout at berlios.de  Mon Feb 27 17:26:26 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 17:26:26 +0100
Subject: [ydf-devel] r1748 - in YDFramework2.0/trunk: YDFramework2 examples/weblog/include
Message-ID: <200602271626.k1RGQQdC003376@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 17:26:26 +0100 (Mon, 27 Feb 2006)
New Revision: 1748

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_core.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
Log:
Fixed a bug in the weblog application where the language files would not be loaded properly.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_core.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_core.php	2006-02-27 16:17:48 UTC (rev 1747)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_core.php	2006-02-27 16:26:26 UTC (rev 1748)
@@ -147,35 +147,6 @@
     }
 
     /**
-     *	This function loads a translation from a global variables $_GLOBALS['t'] with specified name.
-     *
-     *  @param  $params   The parameters for the modifier. The parameter "w" gives the name of the translation. The
-     *                    parameter lower indicates if the translation needs to be returned as lowercase or not.
-     *
-     *  @returns    The named translation.
-     */
-    function t( $t ) {
-
-        // Return empty string when param is missing
-        if ( empty( $t ) ) {
-            return '';
-        }
-
-        // Load the language file
-        @include_once( dirname( __FILE__ ) . '/languages/language_' . strtolower( YDLocale::get() ) . '.php' );
-
-        // Initialize the language array
-        if ( ! isset( $GLOBALS['t'] ) ) {
-            $GLOBALS['t'] = array();
-        }
-
-        // Return the right translation
-        $t = strtolower( $t );
-        return ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
-
-    }
-
-    /**
      *  This is the base class for all other YD classes.
      */
     class YDBase {

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-27 16:17:48 UTC (rev 1747)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-02-27 16:26:26 UTC (rev 1748)
@@ -100,6 +100,28 @@
     $language = empty( $language ) ? 'en' : $language;
     YDLocale::set( $language );
 
+    // The t function used for translations
+    function t( $t ) {
+
+        // Return empty string when param is missing
+        if ( empty( $t ) ) {
+            return '';
+        }
+
+        // Load the language file
+        @include_once( dirname( __FILE__ ) . '/languages/language_' . strtolower( YDLocale::get() ) . '.php' );
+
+        // Initialize the language array
+        if ( ! isset( $GLOBALS['t'] ) ) {
+            $GLOBALS['t'] = array();
+        }
+
+        // Return the right translation
+        $t = strtolower( $t );
+        return ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
+
+    }
+
     // Template Date modifier
     function YDTplModDate( $text, $format=null ) {
         if ( is_null( $format ) ) {



From pclaerhout at berlios.de  Mon Feb 27 18:25:43 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 18:25:43 +0100
Subject: [ydf-devel] r1749 - YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200602271725.k1RHPhFJ014811@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 18:25:43 +0100 (Mon, 27 Feb 2006)
New Revision: 1749

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
Log:
Fixed some typos in the French translation file.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 16:26:26 UTC (rev 1748)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-02-27 17:25:43 UTC (rev 1749)
@@ -4,7 +4,7 @@
 $GLOBALS['t']['not_found'] = 'Non trouv&eacute;';
 $GLOBALS['t']['sorry_not_there'] = 'D&eacute;sol&eacute;, mais vous cherchez quelque chose qui n\'est pas l&agrave;.';
 $GLOBALS['t']['sorry_not_found'] = 'D&eacute;sol&eacute;, mais vous cherchez quelque chose qui n\'a pas &eacute;t&eacute; trouv&eacute;.';
-$GLOBALS['t']['no_items_found'] = 'D&eacute;sol&eacute;, aucun &eacute;l&eacute;ment correspondant.';
+$GLOBALS['t']['no_items_found'] = 'D&eacute;sol&eacute;, aucune entr&eacute;e correspondante.';
 $GLOBALS['t']['by'] = 'par';
 $GLOBALS['t']['required'] = 'requis';
 $GLOBALS['t']['login'] = 'Login';
@@ -95,7 +95,7 @@
 $GLOBALS['t']['wrote'] = '&eacute;crit';
 
 // item_email.tpl
-$GLOBALS['t']['new_item'] = 'Nouveau entr&eacute;e';
+$GLOBALS['t']['new_item'] = 'Nouvelle entr&eacute;e';
 
 // page.tpl
 $GLOBALS['t']['created_on'] = 'Cr&eacute;&eacute; le';
@@ -273,7 +273,7 @@
 $GLOBALS['t']['cfg_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours';
 $GLOBALS['t']['err_auto_close_items'] = 'Interdire les commentaires apr&egrave;s x jours devrait &ecirc;tre num&eacute;rique';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Affiche des informations de d&eacute;bogage';
-$GLOBALS['t']['cfg_default_item_settings'] = 'Valeurs par d&eacute;faut pour des nouveaux articles';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Valeurs par d&eacute;faut pour les nouvelles entr&eacute;es';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';



From pieter at yellowduck.be  Mon Feb 27 18:25:48 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Mon, 27 Feb 2006 18:25:48 +0100
Subject: [ydf-devel] Typos in french translations of YDF Weblog
In-Reply-To: <306340e00602270722hc028eafp@mail.gmail.com>
References: <306340e00602270722hc028eafp@mail.gmail.com>
Message-ID: <4aef63030602270925s6d382507i2444e4f578b76776@mail.gmail.com>

Fixed in build 1749.

pieter

On 2/27/06, ydf poi <ydfpoi at gmail.com> wrote:
>
> Hi Pieter,
>
> I propose 3 little changes for Weblog's translation in language_fr.php:
>
> $GLOBALS['t']['no_items_found'] = 'D&eacute;sol&eacute;, aucun
> &eacute;l&eacute;ment correspondant.';
> should be 'D&eacute;sol&eacute;, aucune entr&eacute;e correspondante.'
>
> $GLOBALS['t']['new_item'] = 'Nouveau entr&eacute;e';
> should be 'Nouvelle entr&eacute;e'
>
> $GLOBALS['t']['cfg_default_item_settings'] = 'Valeurs par
> d&eacute;faut pour des nouveaux articles'
> should be 'Valeurs par d&eacute;faut pour les nouvelles entr&eacute;es'
>
> Kind regards
> --
> po?
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/ydframework-devel
>



--
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060227/f14cf3fd/attachment.html>

From pclaerhout at berlios.de  Mon Feb 27 21:12:05 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 21:12:05 +0100
Subject: [ydf-devel] r1750 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602272012.k1RKC5dP002116@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 21:11:58 +0100 (Mon, 27 Feb 2006)
New Revision: 1750

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/default.css
Log:
Fixed the default font-size for the text area in the comments form.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/default.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-02-27 17:25:43 UTC (rev 1749)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-02-27 20:11:58 UTC (rev 1750)
@@ -1,6 +1,7 @@
 /* Begin Typography & Colors */
 body {
 	font-size: 62.5%; /* Resets 1em to 10px */
+	font-size: 10px; /* Resets 1em to 10px */
 	font-family: 'Lucida Grande', Verdana, Arial, Sans-Serif;
 	background-color: #d5d6d7;
 	color: #333;
@@ -108,9 +109,13 @@
 	}
 
 .commentlist li, #commentform input, #commentform textarea {
-	font: 0.9em 'Lucida Grande', Verdana, Arial, Sans-Serif;
+	font: 1em 'Lucida Grande', Verdana, Arial, Sans-Serif;
 	}
-	
+
+#commentform textarea {
+	font-size: 1.3em;
+	}
+
 .commentlist li {
 	font-weight: bold;
 	}
@@ -600,4 +605,4 @@
 
 .required {
 	color: red;
-}
\ No newline at end of file
+}



From pclaerhout at berlios.de  Mon Feb 27 21:15:45 2006
From: pclaerhout at berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Feb 2006 21:15:45 +0100
Subject: [ydf-devel] r1751 - YDFramework2.0/trunk/examples/weblog/skins/default
Message-ID: <200602272015.k1RKFjgZ003833@sheep.berlios.de>

Author: pclaerhout
Date: 2006-02-27 21:15:29 +0100 (Mon, 27 Feb 2006)
New Revision: 1751

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/__std_footer.tpl
Log:
Removed the notice about the design by since the website seems to be offline.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/__std_footer.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/__std_footer.tpl	2006-02-27 20:11:58 UTC (rev 1750)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/__std_footer.tpl	2006-02-27 20:15:29 UTC (rev 1751)
@@ -9,8 +9,6 @@
                 <br />
                 {t w="syndicate_comments_as"} <a href="{$weblog_link_comments_rss}">RSS</a> {t w="or"} <a href="{$weblog_link_comments_atom}">ATOM</a>.
                 {t w="syndicate_gallery_as"} <a href="{$weblog_link_gallery_rss}">RSS</a> {t w="or"} <a href="{$weblog_link_gallery_atom}">ATOM</a>.
-                <br />
-                <a href="http://binarybonsai.com/kubrick/" target="_blank">{t w="design_by"}</a>
             </p>
         </div>
     </div>



From ximian at berlios.de  Tue Feb 28 15:28:45 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 28 Feb 2006 15:28:45 +0100
Subject: [ydf-devel] r1752 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200602281428.k1SESj7I020981@sheep.berlios.de>

Author: ximian
Date: 2006-02-28 15:27:11 +0100 (Tue, 28 Feb 2006)
New Revision: 1752

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
- YDAjax can be defined without a form object. This is particular useful when all YDAjax events are applied to js functions.

- Lots of clean ups on js identation

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-27 20:15:29 UTC (rev 1751)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-02-28 14:27:11 UTC (rev 1752)
@@ -65,7 +65,7 @@
          *	@param $template		Template object.
          *	@param $form			Form object.
          */
-        function YDAjax( & $template, & $form){
+        function YDAjax( & $template, & $form = null){
 
 			// prefix string used in js function names
 			$this->prefix = YDConfig::get( 'YD_AJAX_PREFIX' );
@@ -118,33 +118,34 @@
 			$html .= "var xajaxDefinedPost    = 1;\n";
 
 			// get standard xajax code
-			$html .= file_get_contents( dirname( __FILE__ ) . '/js/xajax.js');
+			$html .= file_get_contents( dirname( __FILE__ ) . '/js/xajax.js') . "\n";
 
 			// include generic effects lib .. yes, it must be ALWAYS included
-			$html .= "\n". file_get_contents( dirname( __FILE__ ) . '/js/prototype.lite.js_moo.fx.js_moo.fx.pack.js');
+			$html .= file_get_contents( dirname( __FILE__ ) . '/js/prototype.lite.js_moo.fx.js_moo.fx.pack.js') . "\n";
 
 			// send autocompleter code
-			$html .= "\n" . $this->autocompleterCode;
+			$html .= $this->autocompleterCode;
 
 			// compute ONLOAD code
 			$onload = '';
 
 				// export effects js
 				foreach( $this->effects as $eff_name => $eff_code )
-					$onload  .= $eff_code . "\n\t";
+					$onload  .= "\t" . $eff_code . "\n";
 
 				// send js waiting message creation code
 				if ($this->waitingMessageCode != '')
-					$onload  .= $this->waitingMessageCode . "\n\t";
+					$onload  .= "\t" . $this->waitingMessageCode . "\n";
 
 				// send autocompleter functions code
-				$onload  .= implode( "\n\t", $this->autocompleterCodeFunctions );
+				if (!empty( $this->autocompleterCodeFunctions ))
+					$onload  .= "\t" . implode( "\n\t", $this->autocompleterCodeFunctions ) . "\n";
 
 			// if there are on load js just export it
-			if ($onload != '') $html .= "\nwindow.onload = function() {\n\t". $onload . "\n}";
+			if ($onload != '') $html .= "window.onload = function() {". $onload . "}\n";
 
 			// send js function to hide waiting message
-			$html .= $this->waitingMessageCodeFunction . "\n";
+			$html .= $this->waitingMessageCodeFunction;
 
 			// loop xajax functions created on-the-fly
 			foreach($this->aFunctions as $sFunction => $bExists)
@@ -152,22 +153,22 @@
 
 			// add custom js TOP code
 			if (!empty($this->customjsTop))
-				$html .= implode( "\n", $this->customjsTop ) ."\n";
+				$html .= implode( "\n", $this->customjsTop ) . "\n";
 
 			// add YDAjax js variables
 			foreach( $this->customjsVariables as $variable => $declaration )
-				$html .= "var ". $variable ." = ". $declaration .";\n";
+				$html .= "var ". $variable ." = ". $declaration . ";\n";
 
 			// add YDAjax js functions
 			foreach( $this->customjs as $function => $declaration )
-				$html .= "function ". $function ."{". $declaration ."}\n";
+				$html .= "function ". $function ."{". $declaration . "}\n";
 
 			// add js custom BOTTOM code
 			if (!empty($this->customjsBottom))
-				$html .= implode( "\n", $this->customjsBottom ) ."\n";
+				$html .= implode( "\n", $this->customjsBottom ) . "\n";
 
 			// add all code to template html
-			$this->template->addJavascript( $html, true );
+			$this->template->addJavascript( trim( $html ), true );
 		}
 
 
@@ -263,8 +264,8 @@
 				$effectHide = new YDAjaxEffect( '', 'hide', '', 0 );
 
 			// create js functions to show/hide div
-			$this->waitingMessageCodeFunction  = "\nfunction ". $this->wtFunctionShow ."{". $effectShow->getJSHead($this->wtID ."id") . $effectShow->getJSBody($this->wtID ."id") ."}";
-			$this->waitingMessageCodeFunction .= "\nfunction ". $this->wtFunctionHide ."{". $effectHide->getJSHead($this->wtID ."id") . $effectHide->getJSBody($this->wtID ."id") ."}";
+			$this->waitingMessageCodeFunction  = "function ". $this->wtFunctionShow ."{". $effectShow->getJSHead($this->wtID ."id") . $effectShow->getJSBody($this->wtID ."id") ."}\n";
+			$this->waitingMessageCodeFunction .= "function ". $this->wtFunctionHide ."{". $effectHide->getJSHead($this->wtID ."id") . $effectHide->getJSBody($this->wtID ."id") ."}\n";
 
 			// add script to hide waiting message on response
 			$this->response->addScript( $this->wtFunctionHide . ";" );
@@ -320,7 +321,8 @@
 			// serverFunction must be an array with a class and the method (get function name)
 			$functionName = $this->computeFunction( $formElementName, $serverFunction, $arguments, $options, $effects );
 
-			if (!$this->form->isElement( $formElementName )) return;
+			// if form is not defined or element is not a form element we must return
+			if ( is_null( $this->form ) || !$this->form->isElement( $formElementName ) ) return;
 
 			// get element object
 			$formElement = & $this->form->getElement( $formElementName );
@@ -435,7 +437,7 @@
 			if (is_null($arguments)) return "";
 
 			// if is one argument and it's the form name, we want the form values
-			if (is_string( $arguments ) && $this->form->_name == $arguments) return "xajax.getFormValues('". $arguments . "')";
+			if (is_string( $arguments ) && !is_null( $this->form ) && $this->form->getName() == $arguments) return "xajax.getFormValues('". $arguments . "')";
 
 			// if there's only one argument or option, create arrays
 			if (!is_array( $arguments )) $arguments = array( $arguments );
@@ -628,41 +630,42 @@
 		function processEvents(){
 
 			// find autocompleters
-			foreach( $this->form->_elements as $formElement){
+			if ( !is_null( $this->form ))
+				foreach( $this->form->_elements as $formElement){
 			
-				if ($formElement->getType() != 'autocompleter') continue;
+					if ($formElement->getType() != 'autocompleter') continue;
 				
-				if (empty($this->autocompleterCodeFunctions)){
+					if (empty($this->autocompleterCodeFunctions)){
 
-					// load js code
-					$this->autocompleterCode = file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.js');
+						// load js code
+						$this->autocompleterCode = "\n" . file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.js');
 
-					// add css to template
-					$this->template->addCss( file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.css') );
-				}
+						// add css to template
+						$this->template->addCss( file_get_contents( dirname( __FILE__ ) . '/js/autocompleter.css') );
+					}
 		
-				// compute variable name for this autocompleter
-				$variable = $this->prefix ."at".  $formElement->getName();
+					// compute variable name for this autocompleter
+					$variable = $this->prefix ."at".  $formElement->getName();
 
-				// compute html text id
-				$textID = $formElement->getAttribute( 'id' );
+					// compute html text id
+					$textID = $formElement->getAttribute( 'id' );
 			
-				// compute div id
-				$divID = $textID .'_div';
+					// compute div id
+					$divID = $textID .'_div';
 
-				// get function call
-				$serverFunctionName = $formElement->getAjaxCall();
+					// get function call
+					$serverFunctionName = $formElement->getAjaxCall();
 
-				// get ajax arguments
-				$arguments = $formElement->getAjaxArguments();
+					// get ajax arguments
+					$arguments = $formElement->getAjaxArguments();
 
-				// get ajax effects
-				$effects = $formElement->getAjaxEffects();
+					// get ajax effects
+					$effects = $formElement->getAjaxEffects();
 
-				// add js code for autocompleter
-				$this->autocompleterCodeFunctions[] = $variable . " = new AutoSuggest('" . $textID . "','" . $divID . "', null);";
-				$this->autocompleterCodeFunctions[] = $variable . ".ajax = function(){currentAjaxAutocompleter=this;".  $this->computeFunction( $textID, $serverFunctionName, $arguments, $effects ) . "}";
-			}
+					// add js code for autocompleter
+					$this->autocompleterCodeFunctions[] = $variable . " = new AutoSuggest('" . $textID . "','" . $divID . "', null);";
+					$this->autocompleterCodeFunctions[] = $variable . ".ajax = function(){currentAjaxAutocompleter=this;".  $this->computeFunction( $textID, $serverFunctionName, $arguments, $effects ) . "}";
+				}
 
 			// add js code
 			$this->__assignTemplateCode();
@@ -727,12 +730,12 @@
 			// if we want all values and not only the select one
 			if (in_array( 'all', $options )){
 
-				$this->customjs[$jsfunction]  = 'var __ydtmparr = new Array();' . "\n";
-				$this->customjs[$jsfunction] .= 'var __ydtmpsel = document.getElementById("'. $element->getAttribute('id') .'");' . "\n";
-				$this->customjs[$jsfunction] .= 'for (i = 0; i < __ydtmpsel.length; i++){' . "\n";
-				$this->customjs[$jsfunction] .= '    __ydtmparr[ __ydtmpsel.options[i].value ] = __ydtmpsel.options[i].text;' . "\n";
-				$this->customjs[$jsfunction] .= '}' . "\n";
-				$this->customjs[$jsfunction] .= 'return __ydtmparr;';
+				$this->customjs[$jsfunction]  = "\n\t" . 'var __ydtmparr = new Array();';
+				$this->customjs[$jsfunction] .= "\n\t" . 'var __ydtmpsel = document.getElementById("'. $element->getAttribute('id') .'");';
+				$this->customjs[$jsfunction] .= "\n\t" . 'for (i = 0; i < __ydtmpsel.length; i++){';
+				$this->customjs[$jsfunction] .= "\n\t" . '    __ydtmparr[ __ydtmpsel.options[i].value ] = __ydtmpsel.options[i].text;';
+				$this->customjs[$jsfunction] .= "\n\t" . '}';
+				$this->customjs[$jsfunction] .= "\n\t" . 'return __ydtmparr;' . "\n";
 		
 				return $jsfunction;
 			}
@@ -794,11 +797,11 @@
 			$jsfunction = $this->prefix .'get'. $element->getName() .'()';
 		
 			// add our custom js function
-			$this->customjs[$jsfunction]  = 'var day   = document.getElementById("'. $element->getAttribute('id') .'[day]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var month = document.getElementById("'. $element->getAttribute('id') .'[month]").value - 1;' . "\n";
-			$this->customjs[$jsfunction] .= 'var year  = document.getElementById("'. $element->getAttribute('id') .'[year]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var mydate = new Date( year, month, day ); ' . "\n";
-			$this->customjs[$jsfunction] .= 'return mydate.getTime() / 1000;';
+			$this->customjs[$jsfunction]  = "\n\t" . 'var day   = document.getElementById("'. $element->getAttribute('id') .'[day]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var month = document.getElementById("'. $element->getAttribute('id') .'[month]").value - 1;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var year  = document.getElementById("'. $element->getAttribute('id') .'[year]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var mydate = new Date( year, month, day ); ';
+			$this->customjs[$jsfunction] .= "\n\t" . 'return mydate.getTime() / 1000;' . "\n";
 
 			// return function invocation
 			return $jsfunction;
@@ -812,10 +815,10 @@
 			$jsfunction = $this->prefix .'get'. $element->getName() .'()';
 		
 			// add our custom js function
-			$this->customjs[$jsfunction]  = 'var hours    = document.getElementById("'. $element->getAttribute('id') .'[hours]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var minutes  = document.getElementById("'. $element->getAttribute('id') .'[minutes]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var mydate = new Date( 1970, 1, 1, hours, minutes ); ' . "\n";
-			$this->customjs[$jsfunction] .= 'return mydate.getTime() / 1000;';
+			$this->customjs[$jsfunction]  = "\n\t" . 'var hours    = document.getElementById("'. $element->getAttribute('id') .'[hours]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var minutes  = document.getElementById("'. $element->getAttribute('id') .'[minutes]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var mydate = new Date( 1970, 1, 1, hours, minutes ); ';
+			$this->customjs[$jsfunction] .= "\n\t" . 'return mydate.getTime() / 1000;' . "\n";
 
 			// return function invocation
 			return $jsfunction;
@@ -829,13 +832,13 @@
 			$jsfunction = $this->prefix .'get'. $element->getName() .'()';
 		
 			// add our custom js function
-			$this->customjs[$jsfunction]  = 'var day      = document.getElementById("'. $element->getAttribute('id') .'[day]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var month    = document.getElementById("'. $element->getAttribute('id') .'[month]").value - 1;' . "\n";
-			$this->customjs[$jsfunction] .= 'var year     = document.getElementById("'. $element->getAttribute('id') .'[year]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var hours    = document.getElementById("'. $element->getAttribute('id') .'[hours]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var minutes  = document.getElementById("'. $element->getAttribute('id') .'[minutes]").value;' . "\n";
-			$this->customjs[$jsfunction] .= 'var mydate = new Date( year, month, day, hours, minutes ); ' . "\n";
-			$this->customjs[$jsfunction] .= 'return mydate.getTime() / 1000;';
+			$this->customjs[$jsfunction]  = "\n\t" . 'var day      = document.getElementById("'. $element->getAttribute('id') .'[day]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var month    = document.getElementById("'. $element->getAttribute('id') .'[month]").value - 1;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var year     = document.getElementById("'. $element->getAttribute('id') .'[year]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var hours    = document.getElementById("'. $element->getAttribute('id') .'[hours]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var minutes  = document.getElementById("'. $element->getAttribute('id') .'[minutes]").value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'var mydate = new Date( year, month, day, hours, minutes ); ';
+			$this->customjs[$jsfunction] .= "\n\t" . 'return mydate.getTime() / 1000;' . "\n";
 
 			// return function invocation
 			return $jsfunction;
@@ -849,9 +852,9 @@
 			$jsfunction = $this->prefix .'get'. $element->getName() .'()';
 		
 			// add our custom js function
-			$this->customjs[$jsfunction]  =	'if (document.getElementById("'. $element->getAttribute('id') .'").checked)' . "\n";
-			$this->customjs[$jsfunction] .=	'	return 1;' . "\n";
-			$this->customjs[$jsfunction] .=	'return 0;';
+			$this->customjs[$jsfunction]  =	"\n\t" . 'if (document.getElementById("'. $element->getAttribute('id') .'").checked)';
+			$this->customjs[$jsfunction] .=	"\n\t" . '	return 1;';
+			$this->customjs[$jsfunction] .=	"\n\t" . 'return 0;' . "\n";
 
 			// return function invocation
 			return $jsfunction;
@@ -865,10 +868,10 @@
 			$jsfunction = $this->prefix .'get'. $element->getName() .'()';
 			
 			// add custom js function
-			$this->customjs[$jsfunction]  = 'var __ydftmp = document.getElementById("'. $element->getAttribute('id') .'");' . "\n";
-			$this->customjs[$jsfunction] .= 'for (counter = 0; counter < __ydftmp.length; counter++)' . "\n";
-			$this->customjs[$jsfunction] .= '	if (__ydftmp[counter].checked) return __ydftmp[counter].value;' . "\n";
-			$this->customjs[$jsfunction] .= 'return false;';
+			$this->customjs[$jsfunction]  = "\n\t" . 'var __ydftmp = document.getElementById("'. $element->getAttribute('id') .'");';
+			$this->customjs[$jsfunction] .= "\n\t" . 'for (counter = 0; counter < __ydftmp.length; counter++)';
+			$this->customjs[$jsfunction] .= "\n\t" . '	if (__ydftmp[counter].checked) return __ydftmp[counter].value;';
+			$this->customjs[$jsfunction] .= "\n\t" . 'return false;' . "\n";
 
 			// return function invocation
 			return $jsfunction;
@@ -892,11 +895,11 @@
          *	@param $message			Message to display.
          */		
 		function message( $message ){
-			
+
 			$response = new YDAjaxResponse( YDConfig::get( 'YD_AJAX_ENCODING' ) );
 			$response->addScript( 'try{ waitingmessagehide() }catch(e){}' );
 			$response->addAlert( $message );
-			
+
 			return $response;
 		}
 



From ximian at berlios.de  Tue Feb 28 20:13:46 2006
From: ximian at berlios.de (ximian at berlios.de)
Date: Tue, 28 Feb 2006 20:13:46 +0100
Subject: [ydf-devel] r1754 - in YDFramework2.0/trunk/YDFramework2/YDClasses: . YDFormElements
Message-ID: <200602281913.k1SJDkvJ012998@sheep.berlios.de>

Author: ximian
Date: 2006-02-28 20:13:14 +0100 (Tue, 28 Feb 2006)
New Revision: 1754

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
new form element: Switch Menu

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-28 15:19:04 UTC (rev 1753)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-02-28 19:13:14 UTC (rev 1754)
@@ -122,6 +122,7 @@
             $this->registerElement( 'link', 'YDFormElement_Link', 'YDFormElement_Link.php' );
             $this->registerElement( 'div', 'YDFormElement_Div', 'YDFormElement_Div.php' );
             $this->registerElement( 'autocompleter', 'YDFormElement_Autocompleter', 'YDFormElement_Autocompleter.php' );
+            $this->registerElement( 'switchmenu', 'YDFormElement_SwitchMenu', 'YDFormElement_SwitchMenu.php' );
 
             // Add the rules
             $this->registerRule( 'required', array( 'YDValidateRules', 'required' ), 'YDValidateRules.php' );

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2006-02-28 15:19:04 UTC (rev 1753)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2006-02-28 19:13:14 UTC (rev 1754)
@@ -0,0 +1,157 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php');
+
+    /**
+     *	This is the class that define a switch menu form element
+     */
+    class YDFormElement_SwitchMenu extends YDFormElement {
+
+        /**
+         *	This is the class constructor for the YDFormElement_SwitchMenu class.
+         *
+         *	@param $form		The name of the form to which this element is connected.
+         *	@param $name		The name of the form element.
+         *	@param $label		(optional) The label for the form element.
+         *	@param $attributes	(optional) The attributes for the form element.
+         *	@param $options		(optional) The menu elements.
+         */
+        function YDFormElement_SwitchMenu( $form, $name, $label='', $attributes=array(), $options=array() ) {
+
+            // Initialize the parent
+            $this->YDFormElement( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'switchmenu';
+			
+			// Get elements
+			$this->_elements = $options;
+        }
+
+
+        /**
+         *	This function will return the element as HTML.
+         *
+         *	@returns	The form element as HTML text.
+         */
+        function toHtml() {
+
+            // Create the list of attributes
+            $attribs = array(
+                'name' => $this->_form . '_' . $this->_name
+            );
+
+            $attribs = array_merge( $this->_attributes, $attribs );
+            
+            // Get the HTML
+            $out = '';
+
+			// if js code was not loaded we must load
+            if ( ! defined( 'YD_SWMENU_MAINSCRIPT' ) ) {
+            	$out .= trim( '<script type="text/javascript">' );
+            	$out .= trim( 'function hideSMenu( menudiv, obj ){' );
+            	$out .= trim( '	var ar = document.getElementById( menudiv ).getElementsByTagName( "span" );' );
+            	$out .= trim( '		if( document.getElementById( obj ).style.display != "block" ){' );
+            	$out .= trim( '			for ( var i = 0; i < ar.length; i++ ){' );
+            	$out .= trim( '				if ( ar[i].className == "submenu" )' );
+            	$out .= trim( '					ar[i].style.display = "none";' );
+            	$out .= trim( '			}' );
+            	$out .= trim( '			document.getElementById( obj ).style.display = "block";' );
+            	$out .= trim( '		}else{' );
+            	$out .= trim( '			document.getElementById( obj ).style.display = "none";' );
+            	$out .= trim( '		}' );
+            	$out .= trim( '}' );
+            	$out .= trim( '</script>' );
+                define( 'YD_SWMENU_MAINSCRIPT', 1 );
+            }
+
+			// create menu div
+			$out .= '<div'. YDForm::_convertToHtmlAttrib( $attribs ) . '>';
+			
+			// create menu id
+			$IDmenu = $this->getAttribute('id');
+			$i = 1;
+			
+			// cycle menus
+			foreach ( $this->_elements as $_title => $_elements ){
+
+				// create submenu id
+				$IDsubmenu = $IDmenu . '_' . $i++;
+							
+				// create menu div
+				$out .= "<div class=\"menutitle\" onclick=\"hideSMenu('" . $IDmenu . "', '" . $IDsubmenu . "')\">" . $_title . "</div>";
+
+				// create span that includes all menu subitems
+				$out .= '<span class="submenu" id="' . $IDsubmenu . '" style="display:none">';
+				$out .= implode( '<br>', $_elements );
+				$out .= '</span>';
+        	}
+			
+			// add final menu div tag
+			$out .= '</div>';
+
+			return $out;
+		}
+
+
+        /**
+         *	This function adds a new menu item
+         *
+         *	@param $menu		The name of the menu
+         */
+		function addMenu( $name ){
+
+			// add menu to elements
+			$this->_elements[ $name ] = array();
+		}
+
+
+        /**
+         *	This function adds a new element to a menu item
+         *
+         *	@param $menu		The name of the menu to assign the element
+         *	@param $obj			The element form element object (or a simple string)
+         */
+		function addElement( $menu, $obj ){
+		
+			// if menu don't exist we should create one
+			if ( !isset( $this->_elements[ $menu ] ) ) $this->_elements[ $menu ] = array();
+
+			// if element is a form object we must get its html code
+			if ( !is_string( $obj )) $obj = $obj->toHtml();
+
+			// add this element to menu
+			array_push( $this->_elements[ $menu ], $obj );		
+		}
+
+
+    }
+
+?>
\ No newline at end of file



