From ximian at mail.berlios.de  Tue Aug  1 17:21:24 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 1 Aug 2006 17:21:24 +0200
Subject: [ydf-devel] r1980 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608011521.k71FLOv3027953@sheep.berlios.de>

Author: ximian
Date: 2006-08-01 17:21:09 +0200 (Tue, 01 Aug 2006)
New Revision: 1980

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Form validation now checks if element exists. Otherwise if we had submitted more elements that the registered ones we get errors.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-07-31 09:57:12 UTC (rev 1979)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-01 15:21:09 UTC (rev 1980)
@@ -849,12 +849,15 @@
                     // Remove the form name from the element name
                     $key = preg_replace( '/^' . $this->_name . '_/', '', $key );
 
-                    // Set the value
-                    $this->_elements[ $key ]->setValue( $value );
+                    // Check if the element exists
+                    if ( array_key_exists( $key, $this->_elements ) ) {
+
+                        // Set the value
+                        $this->_elements[ $key ]->setValue( $value );
                     
-                    // Set the default value
-                    $this->setDefault( $key, $value );
-                    
+                        // Set the default value
+                        $this->setDefault( $key, $value );
+                    }
                 }
             }
 



From francisco at fusemail.com  Wed Aug  2 18:43:17 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 02 Aug 2006 17:43:17 +0100
Subject: [ydf-devel] .htaccess directory access
Message-ID: <44D0D625.20207@fusemail.com>

Hi

I know the best way to protect YDF is installing outside the root dir in 
a server.
Anyway we have a .htaccess file to deny access to some important 
directories (eg: 3rdparty). The problem is that, afaik, this is not 
recursive. So, we still can access files like  .. 
WWW/YDFramework2/3rdparty/smarty/demo/index.php even with '3rdparty' 
with access denied.

Is there any way to deny access that all YDF directories (addons, 
3rdparty...) _and_ they _subdirectories_ ?


regards
Francisco A


From maximus_meridius79 at yahoo.com  Thu Aug  3 16:28:10 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 3 Aug 2006 07:28:10 -0700 (PDT)
Subject: [ydf-devel] Forcing response state in YDAjax
Message-ID: <20060803142810.74236.qmail@web54010.mail.yahoo.com>

    Hi,

I found that for one quite complex form in the application I amwriting, it was necessary to forcibly clear the YDajax onResponsedatamember to false.

For my app, I have a tabbed menu where each tab link invokes an ajaxresponse to load a form and submenu.

The problem I was getting was that the javascript to call theserver-side event handlers were not being generated correctly
resulting in the javascript trying to call a non-existant function__ydfArray. These generally happens when ajax server-side responsehandlers are adding events.

The cleanest way around this was to add the following method to YDAjax:

        function clearResponse() {
            $this->onResponse = false;
        }

I can then call this method in the server-side ajax handlers that arecreating new event handlers.

Regards,

Graeme


 		
---------------------------------
How low will we go? Check out Yahoo! Messenger?s low  PC-to-Phone call rates.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060803/dc9a9fb7/attachment.html>

From maximus_meridius79 at yahoo.com  Thu Aug  3 17:22:05 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 3 Aug 2006 08:22:05 -0700 (PDT)
Subject: [ydf-devel] .htaccess directory access
Message-ID: <20060803152206.5069.qmail@web54001.mail.yahoo.com>

    Hi Francisco,

I don't think this is possible in apache .htaccess files. You wouldneed to edit the main httpd.conf file or the underlying mini-configfile for the particular site. That would look something like:

<VirtualHost 192.168.0.150>
DocumentRoot "/var/www/virtual/mysite.test/public_html"
ServerName mysite.test
ErrorLog /var/log/httpd/mysite.test_error_log
CustomLog /var/log/httpd/mysite.test_access_log combined
<FilesMatch "(.tpl|config*.php)$">
    Order allow,deny
    Deny from all
</FilesMatch>
<IfModule mod_rewrite.c>
    RewriteEngine On
  
    RewriteRule /modules/(.*) - [F]
    RewriteRule /system/(.*) - [F]
    RewriteRule /YDFramework/(.*) - [F]
</IfModule>
</VirtualHost>

Carefully test and you'll need to restart apache for them to takeaffect. 

I also have zero byte index.html files in every directory belowdocument root since this prevents viewing of directory contents. Thisis an extra precaution in the event that directory indexing is notdisable in the main httpd configuration files.

It's not a major change to your scripts to put YDFramework above thedocument root. This is definitely the safest way. This is one way toset this up rather than using /../ in the first line of your phpscripts in document root:

    include_once(dirname ( dirname( __FILE__ ) ) . '/YDFramework2/YDF2_init.php');

Regards,

Graeme

Francisco Azevedo wrote:  
HiI know the best way to protect YDF is installing outside the root dir in a server.Anyway we have a .htaccess file to deny access to some important directories (eg: 3rdparty). The problem is that, afaik, this is not recursive. So, we still can access files like  .. WWW/YDFramework2/3rdparty/smarty/demo/index.php even with '3rdparty' with access denied.Is there any way to deny access that all YDF directories (addons, 3rdparty...) _and_ they _subdirectories_ ?regardsFrancisco A_______________________________________________YDFramework-devel mailing listYDFramework-devel at lists.berlios.dehttp://bat.berlios.de/mailman/listinfo/ydframework-devel  


 		
---------------------------------
Talk is cheap. Use Yahoo! Messenger to make PC-to-Phone calls.  Great rates starting at 1?/min.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060803/5fee578e/attachment.html>

From francisco at fusemail.com  Fri Aug  4 15:07:27 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 04 Aug 2006 14:07:27 +0100
Subject: [ydf-devel] Forcing response state in YDAjax
In-Reply-To: <20060803142810.74236.qmail@web54010.mail.yahoo.com>
References: <20060803142810.74236.qmail@web54010.mail.yahoo.com>
Message-ID: <44D3468F.2090207@fusemail.com>

Hi Graeme

I don't know why you need to clear that flag as it is used internaly by 
YDAjax to know if the processing is before the YDAjax::processEvents() 
or not.

Anyway i will add it.


regards
Francisco A


> I found that for one quite complex form in the application I am writing, 
> it was necessary to forcibly clear the YDajax onResponse datamember to 
> false.
> 
> For my app, I have a tabbed menu where each tab link invokes an ajax 
> response to load a form and submenu.
> 
> The problem I was getting was that the javascript to call the 
> server-side event handlers were not being generated correctly
> resulting in the javascript trying to call a non-existant function 
> __ydfArray. These generally happens when ajax server-side response 
> handlers are adding events.
> 
> The cleanest way around this was to add the following method to YDAjax:
> 
>         function clearResponse() {
>             $this->onResponse = false;
>         }
> 
> I can then call this method in the server-side ajax handlers that are 
> creating new event handlers.



From ximian at mail.berlios.de  Fri Aug  4 15:23:48 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 4 Aug 2006 15:23:48 +0200
Subject: [ydf-devel] r1981 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200608041323.k74DNmDX030720@sheep.berlios.de>

Author: ximian
Date: 2006-08-04 15:23:24 +0200 (Fri, 04 Aug 2006)
New Revision: 1981

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
added YDAjax::clearResponse() method to reset the internal flag that defines if ydajax is processing events or results

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-01 15:21:09 UTC (rev 1980)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-04 13:23:24 UTC (rev 1981)
@@ -193,6 +193,14 @@
 
 
         /**
+         *	This function resets the internal flag that defines if we are processing events or results (responses)
+         */
+		function clearResponse() {
+			$this->onResponse = false;
+		}
+
+
+        /**
          *	This function sets YDAjax to automagically handle a waiting message
          *
          *	@param $html        (Optional) Html to use in the message.



From maximus_meridius79 at yahoo.com  Sun Aug  6 16:45:21 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Sun, 6 Aug 2006 07:45:21 -0700 (PDT)
Subject: [ydf-devel] child elements of non-block elements need to be wrapped
	by div if modified using YDAjax::addResult()
Message-ID: <20060806144521.71102.qmail@web54009.mail.yahoo.com>

  Hi,

I was having a great deal of trouble with YDajax powered formscontaining "span" elements that need to modified usingYDAjax::addResult. The top two elements of my YDAjax-based forms werespans with ids "section_title" and "section_errors". The formprocessing of each form updates the span "section_errors" with yes-noconfirmation buttons, status or error messages using YDAjax::addResult.

The problem was that the "section_errors" element was not beingmodified in IE. Once I worked out how to activate the xajax debuggervia YellowDuck config variable, I found that IE was generating theerror "Unknown Runtime Error". After some fiddly debugging and researchI found this hint at the cause of the problem: http://integralpath.blogs.com/thinkingoutloud/2006/03/innerhtml_and_n.html

The eventual solution was to convert the span form elements to div(i.e. block) elements since they are contained within a form which is anon-block element. The current build of YellowDuck does not support"div" elements. This is fixed by copying the following methods from"YDFormElement_Span" to "YDFormElement_Div".

        /**
         *    This function returns the default javascript event ofthis element
         */
        function getJSEvent(){ 

            return 'onclick';
        }


        /**
         *    This function gets an element value using javascript
         *
         *    @param $options        (optional) The options for theelment.
         */
        function getJS( $options = null ){ 

            // return js code
            return 'return document.getElementById("' .$this->getAttribute('id') . '").innerHTML;';
        }


        /**
         *    This function sets an element value using javascript
         *
         *    @param $result        The result value
         *    @param $attribute    (optional) Element attribute
         *    @param $options        (optional) The options for theelment.
         */
        function setJS( $result, $attribute = null, $options = null ){ 

            // if atribute event is not defined we must create adefault one
            if (is_null( $attribute )) $attribute = 'innerHTML';

            // if result is an array we should export to a valid jsstring
            if (is_array( $result )) $result = str_replace( "\n","<br>", var_export( $result, true ) ) ;

            // assign result to form element using the id
            return 'document.getElementById("' .$this->getAttribute( 'id' ) . '").' . $attribute . ' = "' . $result. '";';
        }

Now that I have made the change in YDFormElement_Div, my ajax-poweredforms are working. Ihave checked this in Firefox 1.5.0.2, IE 6.0, IE 7.0 (Beta 3), Safari2.0.2 and Opera 9.01. It works in all of these browsers, however I amhaving a problem with Opera duplicating some content generated viaYDajax (a problem for another day).

Regards,

Graeme


 		
---------------------------------
Do you Yahoo!?
 Get on board. You're invited to try the new Yahoo! Mail Beta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060806/c1246ef0/attachment.html>

From francisco at fusemail.com  Mon Aug  7 10:49:30 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 07 Aug 2006 09:49:30 +0100
Subject: [ydf-devel] child elements of non-block elements need to be
 wrapped by div if modified using YDAjax::addResult()
In-Reply-To: <20060806144521.71102.qmail@web54009.mail.yahoo.com>
References: <20060806144521.71102.qmail@web54009.mail.yahoo.com>
Message-ID: <44D6FE9A.1000409@fusemail.com>

Hi Graeme

Thanks for that debugging!


regards
Francisco A

> 
> I was having a great deal of trouble with YDajax powered forms 
> containing "span" elements that need to modified using 
> YDAjax::addResult. The top two elements of my YDAjax-based forms were 
> spans with ids "section_title" and "section_errors". The form processing 
> of each form updates the span "section_errors" with yes-no confirmation 
> buttons, status or error messages using YDAjax::addResult.
> 
> The problem was that the "section_errors" element was not being modified 
> in IE. Once I worked out how to activate the xajax debugger via 
> YellowDuck config variable, I found that IE was generating the error 
> "Unknown Runtime Error". After some fiddly debugging and research I 
> found this hint at the cause of the problem: 
> http://integralpath.blogs.com/thinkingoutloud/2006/03/innerhtml_and_n.html
> 
> The eventual solution was to convert the span form elements to div (i.e. 
> block) elements since they are contained within a form which is a 
> non-block element. The current build of YellowDuck does not support 
> "div" elements. This is fixed by copying the following methods from 
> "YDFormElement_Span" to "YDFormElement_Div".
> 
>         /**
>          *    This function returns the default javascript event of this 
> element
>          */
>         function getJSEvent(){
> 
>             return 'onclick';
>         }
> 
> 
>         /**
>          *    This function gets an element value using javascript
>          *
>          *    @param $options        (optional) The options for the elment.
>          */
>         function getJS( $options = null ){
> 
>             // return js code
>             return 'return document.getElementById("' . 
> $this->getAttribute('id') . '").innerHTML;';
>         }
> 
> 
>         /**
>          *    This function sets an element value using javascript
>          *
>          *    @param $result        The result value
>          *    @param $attribute    (optional) Element attribute
>          *    @param $options        (optional) The options for the elment.
>          */
>         function setJS( $result, $attribute = null, $options = null ){
> 
>             // if atribute event is not defined we must create a default one
>             if (is_null( $attribute )) $attribute = 'innerHTML';
> 
>             // if result is an array we should export to a valid js string
>             if (is_array( $result )) $result = str_replace( "\n", 
> "<br>", var_export( $result, true ) ) ;
> 
>             // assign result to form element using the id
>             return 'document.getElementById("' . $this->getAttribute( 
> 'id' ) . '").' . $attribute . ' = "' . $result . '";';
>         }
> 
> Now that I have made the change in YDFormElement_Div, my ajax-powered 
> forms are working. I have checked this in Firefox 1.5.0.2, IE 6.0, IE 
> 7.0 (Beta 3), Safari 2.0.2 and Opera 9.01. It works in all of these 
> browsers, however I am having a problem with Opera duplicating some 
> content generated via YDajax (a problem for another day).
> 
> Regards,
> 
> Graeme
> 
> ------------------------------------------------------------------------
> Do you Yahoo!?
> Get on board. You're invited 
> <http://us.rd.yahoo.com/evt=40791/*http://advision.webevents.yahoo.com/handraisers> 
> to try the new Yahoo! Mail Beta.
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> http://bat.berlios.de/mailman/listinfo/ydframework-devel



From ximian at mail.berlios.de  Mon Aug  7 10:51:21 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 7 Aug 2006 10:51:21 +0200
Subject: [ydf-devel] r1982 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200608070851.k778pLB2024304@sheep.berlios.de>

Author: ximian
Date: 2006-08-07 10:51:10 +0200 (Mon, 07 Aug 2006)
New Revision: 1982

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
Log:
added YDAjax support to div YDForm element

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2006-08-04 13:23:24 UTC (rev 1981)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2006-08-07 08:51:10 UTC (rev 1982)
@@ -86,6 +86,48 @@
 
         }
 
+
+       /**
+         *    This function returns the default javascript event of this element
+         */
+        function getJSEvent(){
+
+            return 'onclick';
+        }
+
+
+        /**
+         *    This function gets an element value using javascript
+         *
+         *    @param $options        (optional) The options for the elment.
+         */
+        function getJS( $options = null ){
+
+            // return js code
+            return 'return document.getElementById("' . $this->getAttribute('id') . '").innerHTML;';
+        }
+
+
+        /**
+         *    This function sets an element value using javascript
+         *
+         *    @param $result       The result value
+         *    @param $attribute    (optional) Element attribute
+         *    @param $options      (optional) The options for the elment.
+         */
+        function setJS( $result, $attribute = null, $options = null ){
+
+            // if atribute event is not defined we must create a default one
+            if ( is_null( $attribute ) ) $attribute = 'innerHTML';
+
+            // if result is an array we should export to a valid js string
+            if ( is_array( $result ) ) $result = str_replace( "\n", "<br>", var_export( $result, true ) ) ;
+
+            // assign result to form element using the id
+            return 'document.getElementById("' . $this->getAttribute( 'id' ) . '").' . $attribute . ' = "' . $result . '";';
+        }
+
+
     }
 
 ?>
\ No newline at end of file



From maximus_meridius79 at yahoo.com  Mon Aug  7 13:05:14 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 7 Aug 2006 04:05:14 -0700 (PDT)
Subject: [ydf-devel] child elements of non-block elements need to be
	wrapped by div if modified using YDAjax::addResult()
Message-ID: <20060807110514.77511.qmail@web54008.mail.yahoo.com>

    Hi Francisco,

I got lost amongst all the javascript at first. The Firefox Firebugextension, Web Developer toolbars for IE & Firefox and MS Scriptdebugger came in handy.

I also found the following useful utilities:
      
   http://jcay.com/javascript-code-improver.html(this is a windows utility that will apply source formatting toJavaScript)    
   http://www.jslint.com/lint.html( lint for JavaScript )
      
The HTTP protocol debugger is useful in Firebug. Is anyone aware of anyopen-source utilities that will do the same for Internet Explorer?

Other than activating the xajax debugger, do you have any otherdebugging tips for YDajax?

Regards,

Graeme

Francisco Azevedo wrote:  
Hi GraemeThanks for that debugging!regardsFrancisco A  
      
I was having a great deal of trouble with YDajax powered forms containing "span" elements that need to modified using YDAjax::addResult. The top two elements of my YDAjax-based forms were spans with ids "section_title" and "section_errors". The form processing of each form updates the span "section_errors" with yes-no confirmation buttons, status or error messages using YDAjax::addResult.The problem was that the "section_errors" element was not being modified in IE. Once I worked out how to activate the xajax debugger via YellowDuck config variable, I found that IE was generating the error "Unknown Runtime Error". After some fiddly debugging and research I found this hint at the cause of the problem: http://integralpath.blogs.com/thinkingoutloud/2006/03/innerhtml_and_n.htmlThe eventual solution was to convert the span form elements to div (i.e. block) elements since they are contained within a form which is a non-block element. The current build of YellowDuck does not
 support "div" elements. This is fixed by copying the following methods from "YDFormElement_Span" to "YDFormElement_Div".        /**         *    This function returns the default javascript event of this element         */        function getJSEvent(){            return 'onclick';        }        /**         *    This function gets an element value using javascript         *         *    @param $options        (optional) The options for the elment.         */        function getJS( $options = null ){            // return js code            return 'return document.getElementById("' . $this->getAttribute('id') . '").innerHTML;';        }        /**         *    This function sets an element value using javascript         *         *    @param $result        The result value         *    @param $attribute    (optional) Element attribute         *    @param $options        (optional) The options for the elment.         */        function setJS( $result, $attribute = null,
 $options = null ){            // if atribute event is not defined we must create a default one            if (is_null( $attribute )) $attribute = 'innerHTML';            // if result is an array we should export to a valid js string            if (is_array( $result )) $result = str_replace( "\n", "<br>", var_export( $result, true ) ) ;            // assign result to form element using the id            return 'document.getElementById("' . $this->getAttribute( 'id' ) . '").' . $attribute . ' = "' . $result . '";';        }Now that I have made the change in YDFormElement_Div, my ajax-powered forms are working. I have checked this in Firefox 1.5.0.2, IE 6.0, IE 7.0 (Beta 3), Safari 2.0.2 and Opera 9.01. It works in all of these browsers, however I am having a problem with Opera duplicating some content generated via YDajax (a problem for another day).Regards,Graeme------------------------------------------------------------------------Do you Yahoo!?Get on board. You're
 invited <http://us.rd.yahoo.com/evt=40791/*http://advision.webevents.yahoo.com/handraisers> to try the new Yahoo! Mail Beta.------------------------------------------------------------------------_______________________________________________YDFramework-devel mailing listYDFramework-devel at lists.berlios.dehttp://bat.berlios.de/mailman/listinfo/ydframework-devel    
    
_______________________________________________YDFramework-devel mailing listYDFramework-devel at lists.berlios.dehttp://bat.berlios.de/mailman/listinfo/ydframework-devel  


 		
---------------------------------
Do you Yahoo!?
 Everyone is raving about the  all-new Yahoo! Mail Beta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060807/eee2e03f/attachment.html>

From francisco at fusemail.com  Mon Aug  7 13:24:29 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 07 Aug 2006 12:24:29 +0100
Subject: [ydf-devel] child elements of non-block elements need to
 be	wrapped by div if modified using YDAjax::addResult()
In-Reply-To: <20060807110514.77511.qmail@web54008.mail.yahoo.com>
References: <20060807110514.77511.qmail@web54008.mail.yahoo.com>
Message-ID: <44D722ED.3030909@fusemail.com>

Hi Graeme

> I got lost amongst all the javascript at first. The Firefox Firebug 
> extension, Web Developer toolbars for IE & Firefox and MS Script 
> debugger came in handy.
> 
> I also found the following useful utilities:
> 
>         * http://jcay.com/javascript-code-improver.html (this is a
>           windows utility that will apply source formatting to JavaScript)
>         * http://www.jslint.com/lint.html ( lint for JavaScript )

That sounds good..

> The HTTP protocol debugger is useful in Firebug. Is anyone aware of any 
> open-source utilities that will do the same for Internet Explorer?
> 
> Other than activating the xajax debugger, do you have any other 
> debugging tips for YDajax?

Apart from YDConfig::set( 'YD_AJAX_DEBUG', true ) and the webDeveloper 
FF extension i don't have nothing. Ajax debugging is not the easiest 
thing on earth :(


regards
Francisco A


From pclaerhout at mail.berlios.de  Mon Aug  7 15:56:52 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 7 Aug 2006 15:56:52 +0200
Subject: [ydf-devel] r1983 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200608071356.k77DuqNZ021191@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-07 15:56:51 +0200 (Mon, 07 Aug 2006)
New Revision: 1983

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
Log:
Updated the french translations.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-07 08:51:10 UTC (rev 1982)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-07 13:56:51 UTC (rev 1983)
@@ -194,7 +194,7 @@
 $GLOBALS['t']['top_10_commenters'] = 'Les 10 commentateurs les plus actifs';
 $GLOBALS['t']['all_commenters'] = 'Tous les commentateurs';
 $GLOBALS['t']['reset_stats'] = 'R&eacute;initialiser toutes les statistiques';
-$GLOBALS['t']['total_average_stats'] = 'Totals et moyens';
+$GLOBALS['t']['total_average_stats'] = 'Totaux et moyennes';
 
 // manage/users.tpl
 $GLOBALS['t']['useremail'] = 'Adresse email';



From ximian at mail.berlios.de  Mon Aug  7 18:26:53 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 7 Aug 2006 18:26:53 +0200
Subject: [ydf-devel] r1984 - in YDFramework2.0/trunk/YDFramework2:
	YDClasses/YDCMComponent YDClasses/YDCMComponent/languages
	YDClasses/YDCMComponent/languages/YDCMUsers
	addons/YDCMPage/languages
Message-ID: <200608071626.k77GQrFd002142@sheep.berlios.de>

Author: ximian
Date: 2006-08-07 18:25:58 +0200 (Mon, 07 Aug 2006)
New Revision: 1984

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php
Log:
mostly YDCM user management changes

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-07 16:25:58 UTC (rev 1984)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="466" YPos="71" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="89" YPos="71" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -258,13 +258,13 @@
 </SETTINGS>
 <METADATA>
 <REGIONS>
+<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
 <REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
-<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
-<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
-<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
-<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
 </REGIONS>
 <TABLES>
 <TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
@@ -1030,13 +1030,13 @@
 </TABLE>
 <TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
-<COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1773" ColName="user_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="1" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1773" ColName="user_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -0,0 +1,128 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMPermissions extends YDDatabaseObject {
+    
+        function YDCMPermissions() {
+
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMPermissions' );
+
+            // register custom key
+            $this->registerKey( 'permission_id', true );
+
+			// register fields	
+			$this->registerField( 'object' );
+			$this->registerField( 'object_action' );
+			$this->registerField( 'object_id' );
+			$this->registerField( 'schedule' );
+			$this->registerField( 'date_start' );
+			$this->registerField( 'date_end' );
+
+			// add static relations
+			$this->registerField( 'user_id' );
+       		$rel = & $this->registerRelation( 'YDCMPermissions', false, 'YDCMPermissions' );
+			$rel->setLocalKey( 'user_id' );
+			$rel->setForeignKey( 'user_id' );
+		}
+
+
+        /**
+         *  This function return an array of permissions
+         *
+         *  @param     $user_id   User id to get permissions
+		 *
+         *  @returns    An array with all permission groupby object
+         */
+		function getPermissions( $user_id ){
+		
+			$this->resetValues();
+			$this->user_id = intval( $user_id );
+
+			$this->find();
+
+			return $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );
+		}
+
+
+        /**
+         *  This function assigns an array of permissions to a user
+         *
+         *  @param     $user_id              User id to get permissions
+         *  @param     $permissions_to_add   Array with permissions to add
+         *  @param     $permissions_to_del   Array with permissions to delete
+         */
+		function setPermissions( $user_id, $permissions_to_add, $permissions_to_del ){
+
+			$p_add = 0;
+			$t_add = 0;
+
+			$p_del = 0;
+			$t_del = 0;
+
+			// cycle permissions to add and insert them in db
+			foreach ( $permissions_to_add as $obj => $perms )
+				foreach ( array_values( $perms ) as $p ){
+
+					$this->resetAll();
+					$this->user_id        = $user_id;
+					$this->object         = $obj;
+					$this->object_action  = $p;
+
+					if ($this->insert()) $p_add++;
+					$t_add++;
+				}
+
+			// cycle permissions to delete and delete them from db
+			foreach ( $permissions_to_del as $obj => $perms )
+				foreach ( array_values( $perms ) as $p ){
+
+					$this->resetAll();
+					$this->user_id        = $user_id;
+					$this->object         = $obj;
+					$this->object_action  = $p;
+
+					if ($this->delete()) $p_del++;
+					$t_del++;
+				}
+
+			if ($p_add == $t_add && $p_del == $t_del ) return true;
+			
+			return false;
+		}
+
+}
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -26,6 +26,10 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+
+	// add permissions lib
+	require_once( dirname( __FILE__ ) . '/YDCMPermissions.php' );
+
 	// add local translation directory
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
 
@@ -88,6 +92,11 @@
 
 			// init user form
 			$this->form = new YDForm( 'YDCMUsers' );
+
+			// init permissions
+			$this->perm = new YDCMPermissions();
+			
+			$this->id = null;
 		}
 
 
@@ -103,6 +112,25 @@
 
 
         /**
+         *  This function returns all user permissions
+         *
+         *  @param  $user_id (Optional) Custom user id to get permissions
+         *
+         *  @retuns  Associative array of permissions
+         */
+		function getPermissions( $user_id = null ){
+		
+//			require_once( dirname( __FILE__ ) . '/YDCMPermissions.php' );
+
+//			$permissions = new YDCMPermissions();
+		
+			if ( is_null( $user_id ) ) $user_id = $this->id;
+		
+			return $this->perm->getPermissions( $user_id );
+		}
+
+
+        /**
          *  This function returns the id of the current user
          */
 		function currentID(){
@@ -133,6 +161,20 @@
 
 
         /**
+         *  This function returns all sub users
+         *
+         *  @param      $id          User id to test if id descendant
+         *  @param      $parent_id   Parent id
+         *
+         *  @returns    boolean flag
+         */
+		function isDescendantOf( $id, $parent_id ){
+
+			return $this->tree->isDescendantOf( intval( $id ), intval( $parent_id ) );
+		}
+
+
+        /**
          *  This function checks if a username and password are valid
          *
          *  @param $username  User username
@@ -170,46 +212,93 @@
 
 			return false;
 		}
-		
-		
+
+
         /**
-         *  This function updates the current user attributes (ignoring passwords and statistics)
+         *  This function updates the current user attributes (ignoring passwords and statistics) using form values
          *
-         *  @param $values  User attributes as array
+         *  @param $id          Static user id
+         *  @param $formvalues  Array with user attributes
          *
-         *  @returns    true if updated, false if current user is not valid
+         *  @returns    true if updated, array with form errors otherwise
          */
-		function changeCurrentUser( $values ){
-		
-			$this->resetValues();
+		function changeUserForm( $id, $formvalues = array() ){
 
-			// check if user is valid
-			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
 
-			if ( $valid === false ) return false;
+			// get values
+			$values = $this->form->getValues();
 
-			// reset values added from valid method
-			$this->resetValues();
+			// change user details and permissions based on general values
+			// BEGIN :)
+			$res1 = $this->changeUserPermissions( $id, $values );
+			$res2 = $this->changeUserDetails( $id, $values );
+			return $res1 + $res2;
+			// COMMIT :)
+		}
 
+
+        /**
+         *  This function updates the current user attributes
+         *
+         *  @param $id          Static user id
+         *  @param $formvalues  Array with user attributes
+         *
+         *  @returns    true if updated, false otherwise
+         */
+		function changeUserDetails( $id, $values ){
+
+			$this->resetAll();
+
 			// set new values
-			$this->name        = $values['name'];
-			$this->email       = $values['email'];
-			$this->other       = $values['other'];
-			$this->language_id = $values['language_id'];
-			$this->template    = $values['template'];
+			$this->setValues( $values );
 
-			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
-			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+			// overwrite id
+			$this->user_id = intval( $id );
 
+			// parse dates
+			$this->login_start = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
+			$this->login_end   = YDStringUtil::formatDate( $values[ 'login_end' ],   'datetimesql' );
+
 			// return update result
-			if ( $this->update() == 1 ) return true;
-			
-			return false;
+			return $this->update();
 		}
 
 
+		function changeUserPermissions( $id, $values ){
+
+			// init temp array permissions
+			$permissions_valid  = array();
+			$permissions_to_add = array();
+			$permissions_to_del = array();
+
+			// check $values if contains permissions that belong to its parent
+			foreach( $this->permissions_parent as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 'on' )
+						$permissions_valid[ $obj ][] = $p;
+
+			// cycle current permissions to see the ones we need to delete
+			foreach( $this->permissions as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 
+						$permissions_to_del[ $obj ][] = $p;
+
+			// cycle current permissions to see the ones we need to add
+			foreach( $permissions_valid as $obj => $perms )
+				foreach( $perms as $p )
+					if ( !isset( $this->permissions[ $obj ][$p] ) )
+						$permissions_to_add[ $obj ][] = $p;
+
+			// pass permissions to add and to delete
+			return $this->perm->setPermissions( intval( $id ), $permissions_to_add, $permissions_to_del );
+		}
+
+
         /**
-         *  This function updates the current user attributes (ignoring passwords and statistics) using form values
+         *  This function updates the user attributes using form values
          *
          *  @param $formvalues  Array with user attributes
          *
@@ -221,8 +310,26 @@
 			if ( !$this->form->validate( $formvalues ) )
 				return $this->form->getErrors();
 
-			return $this->changeCurrentUser( $this->form->getValues() );
+			// check if user is valid
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			if ( $valid === false ) return false;
+
+			// reset values added from valid method
+			$this->resetValues();
+
+			// set new values
+			$this->setValues( $this->form->getValues() );
+
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
 		}
+
 		
 
         /**
@@ -230,8 +337,9 @@
 		 *
 		 * @param $username   1: Username is a span, 2: Username is a text box
 		 * @param $password   0: Password is not showed, 1: Password is showed
+		 * @param $login      0: Login is span, 1: Login is editable
          */
-		function addFormDetails( $username = 1, $password = 0 ){
+		function addFormDetails( $username = 1, $password = 0, $login = 0 ){
 
 			// add username
 			if ( $username == 1 ) $this->form->addElement( 'span',     'username', t('user_username') );
@@ -263,9 +371,17 @@
 			$this->form->addRule(    'template',  'in_array',     t('template not valid'), array_keys( $templates->admin_templates() ) );
 
 			// add user details
-            $this->form->addElement( 'span', 'login_start',  t('login_start') );
-            $this->form->addElement( 'span', 'login_end',    t('login_end') );
-            $this->form->addElement( 'span', 'login_counter',t('login_counter') );
+			if ($login == 1){
+				$this->form->addElement( 'select',         'state',       t('login_state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
+				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
+			}else{
+				$this->form->addElement( 'span',           'state',       t('login_state') );
+				$this->form->addElement( 'span',           'login_start', t('login_start') );
+				$this->form->addElement( 'span',           'login_end',   t('login_end') );
+			}
+
+			$this->form->addElement( 'span', 'login_counter',t('login_counter') );
             $this->form->addElement( 'span', 'login_last',   t('login_last') );
             $this->form->addElement( 'span', 'login_current',t('login_current') );
             $this->form->addElement( 'span', 'created_user', t('created_user') );
@@ -274,34 +390,98 @@
 
 
         /**
+         *  This function adds checkbox groups about permissions and gets all translations.
+         *  It generates 2 private variables 
+         *    - $this->permissions as db permissions 
+         *    - $this->permissions_html as associative array with checkboxgroup html code
+         *
+         *  @returns  Associative array of objects and correspondent chechboxgoup
+         */
+		function addFormPermissions(){
+
+			// get permissions from parent;
+			$node = $this->getUser( $this->id );
+
+			// init user permissions and permissions html 
+			$this->permissions      = $this->getPermissions();
+			$this->permissions_html = array();
+
+			// init parent permissions
+			$this->permissions_parent = $this->getPermissions( $node['parent_id'] );
+
+			// cycle parent permissions to create form checkboxgroup of this user
+			foreach( $this->permissions_parent as $obj => $perm ){
+
+				// get permission translations of this component
+				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
+
+				// init checkboxgroup options
+				$options  = array();
+				$selected = array();
+
+				// cycle all permissions of this object to create checkboxgroup options array
+				foreach( $perm as $p ){
+					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
+
+					// check if this parent action belongs to the child too ( to select it )
+					if ( isset( $this->permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $this->permissions[ $obj ] ) )){
+						$selected[ $p['object_action' ] ] = 1;
+					}
+				}
+
+				// add object checkbox
+				$this->form->addElement( 'checkboxgroup', $obj, $obj, array(), $options );
+				
+				// add default for this checkboxgroup
+				$this->form->setDefault( $obj, $selected );
+
+				// get element html
+				$el = & $this->form->getElement( $obj );
+				
+				// store html permissions
+				$this->permissions_html[ $obj . ' s' ][] = $el->toHtml();
+			}
+
+		}
+
+
+        /**
          *  This function creates an user form for password changing
          *
          * @param $oldpassword  0: don't include old password box; 1: include old password box
          */
 		function addFormPassword( $oldpassword = 1 ){
 
-			// add old password box
-			if ( $oldpassword == 1 )
-            	$this->form->addElement( 'password', 'old',         t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+			// add new password box
+            $this->form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
+			$this->form->addRule(    'new',         'required',     t('passwords are required') );
+			$this->form->addRule(    'new',         'maxlength',    t('passwords too big'), 31 );
+			$this->form->addRule(    'new',         'alphanumeric', t('passwords not alphanumeric') );
 
-			// add new password box and confirmation box
-            $this->form->addElement( 'password', 'new',         t('password_new'),         array('size' => 30, 'maxlength' => 31) );
-            $this->form->addElement( 'password', 'new_confirm', t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+			// add new_confirm password box
+            $this->form->addElement( 'password',    'new_confirm',  t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+			$this->form->addRule(    'new_confirm', 'required',     t('passwords are required') );
+			$this->form->addRule(    'new_confirm', 'maxlength',    t('passwords too big'), 31 );
+			$this->form->addRule(    'new_confirm', 'alphanumeric', t('passwords not alphanumeric') );
 
-			// add rules to all passwords
-			$this->form->addRule( array( 'old', 'new', 'new_confirm' ), 'required',     t('passwords are required') );
-			$this->form->addRule( array( 'old', 'new', 'new_confirm' ), 'maxlength',    t('passwords too big'), 31 );
-			$this->form->addRule( array( 'old', 'new', 'new_confirm' ), 'alphanumeric', t('passwords not alphanumeric') );
-
 			// add compare rule to new password and confirmation password
 			$this->form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			// add old password box
+			if ( $oldpassword == 1 ){
+            	$this->form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+				$this->form->addRule(    'old',      'required',     t('passwords are required') );
+				$this->form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
+				$this->form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
+			}
+
 		}
 
 
         /**
          *  This returns the user form
          *
-         *  @param $defaults  (Optional) default values to apply in form
+         *  @param $defaults  (Optional) default values array to apply in form
          *
          *  @returns    YDForm object
          */
@@ -363,22 +543,76 @@
 
 
         /**
+         *  This function updates a user password
+         *
+         *  @param $newpassword  New password
+         *
+         *  @returns    true if updated, false when user is invalid
+         */
+		function changeUserPassword( $user_id, $newpassword ){
+		
+			// check if user is valid
+			if ( !$this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] ) ) return false;
+
+			// reset values added from valid method
+			$this->resetAll();
+
+			// set new password
+			$this->user_id  = intval( $user_id );
+			$this->password = md5( $newpassword );
+
+			// update user and get result
+			if ( $this->update() == 1 ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This function updates a user password
+         *
+         *  @param $formvalues  Array 2 passwords (new and new_confirm)
+         *
+         *  @returns    true if updated, array with form errors
+         */
+		function changeUserPasswordForm( $id = null, $formvalues = array() ){
+
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
+			return $this->changeUserPassword( $id, $this->form->getValue( 'new' ) );
+		}
+
+
+        /**
          *  This function return the current user attributes
          *
-         *  @returns    current user id
+         *  @param      $translate   (Optional) Boolean that defines if result must be translated
+         *
+         *  @returns    User details
          */
 		function getCurrentUser( $translate = false ){
 		
 			// get current user id
-			return $this->getUser( $this->currentID(), $translate );
-
+			return $this->getUser( $translate, $this->currentID() );
 		}
 
 
-		function getUser( $id, $translate = false ){
+        /**
+         *  This function returns user attributes
+         *
+         *  @param      $translate   (Optional) Boolean that defines if result must be translated
+         *  @param      $id          (Optional) Custom user id to use (instead of internal)
+         *
+         *  @returns    User details
+         */
+		function getUser( $translate = false, $id = null ){
 
 			$this->resetValues();
 
+			if ( is_null( $id ) ) $id = $this->id;
+
 			// set user id
 			$this->user_id = intval( $id );
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -8,6 +8,7 @@
 $GLOBALS['t']['user_other'] = 'Other';
 $GLOBALS['t']['user_language'] = 'Language';
 $GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_state'] = 'Login';
 $GLOBALS['t']['login_start'] = 'Login start date';
 $GLOBALS['t']['login_end'] = 'Login end date';
 $GLOBALS['t']['login_counter'] = 'Total of logins';

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -8,6 +8,7 @@
 $GLOBALS['t']['user_other'] = 'Outras informa&ccedil;oes';
 $GLOBALS['t']['user_language'] = 'Idioma';
 $GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_state'] = 'Login';
 $GLOBALS['t']['login_start'] = 'Data para inicio de login';
 $GLOBALS['t']['login_end'] = 'Data em que o login expira';
 $GLOBALS['t']['login_counter'] = 'Total de logins';

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -1,6 +1,10 @@
 <?php
 
+// components
 $GLOBALS['t']['ydcmpage'] = 'Page';
+$GLOBALS['t']['ydcmpage s'] = 'Pages';
+$GLOBALS['t']['ydcmrootmenu'] = 'Menu';
+$GLOBALS['t']['ydcmrootmenu s'] = 'Menus';
 
 $GLOBALS['t']['save'] = 'Save';
 $GLOBALS['t']['close'] = 'Close';

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -1,6 +1,10 @@
 <?php
 
-$GLOBALS['t']['YDCMPage'] = 'P&aacute;gina';
+// components
+$GLOBALS['t']['ydcmpage'] = 'P&aacute;gina';
+$GLOBALS['t']['ydcmpage s'] = 'P&aacute;ginas';
+$GLOBALS['t']['ydcmrootmenu'] = 'Menu';
+$GLOBALS['t']['ydcmrootmenu s'] = 'Menus';
 
 $GLOBALS['t']['save'] = 'Guardar';
 $GLOBALS['t']['close'] = 'Fechar';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/en.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -1,5 +1,9 @@
 <?php
+// PERMISSIONS
+$GLOBALS['t']['ydcmpage_create'] = 'Create';
+$GLOBALS['t']['ydcmpage_delete'] = 'Delete';
 
+
 // PAGE FORM
 $GLOBALS['t']['page_reference'] = 'Reference';
 $GLOBALS['t']['page_title'] = 'Title';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php	2006-08-07 13:56:51 UTC (rev 1983)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/languages/pt.php	2006-08-07 16:25:58 UTC (rev 1984)
@@ -1,5 +1,9 @@
 <?php
+// PERMISSIONS
+$GLOBALS['t']['ydcmpage_create'] = 'Criar';
+$GLOBALS['t']['ydcmpage_delete'] = 'Eliminar';
 
+
 // PAGE FORM
 $GLOBALS['t']['page_reference'] = 'Refer&ecirc;ncia';
 $GLOBALS['t']['page_title'] = 'Titulo';



From david_db at mail.berlios.de  Tue Aug  8 02:31:29 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Tue, 8 Aug 2006 02:31:29 +0200
Subject: [ydf-devel] r1985 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200608080031.k780VTIt001846@sheep.berlios.de>

Author: david_db
Date: 2006-08-08 02:30:57 +0200 (Tue, 08 Aug 2006)
New Revision: 1985

Added:
   YDFramework2.0/trunk/examples/weblog/include/languages/check.php
Log:
Added script to check for missing translations in language files in YDWeblog.

Added: YDFramework2.0/trunk/examples/weblog/include/languages/check.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/check.php	2006-08-07 16:25:58 UTC (rev 1984)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/check.php	2006-08-08 00:30:57 UTC (rev 1985)
@@ -0,0 +1,49 @@
+<?php
+
+include_once dirname( __FILE__ ) . '/../YDWeblog_init.php';
+
+if ( ! isset( $_GET['lang'] ) ) {
+    trigger_error( 'Missing language to check. Add "lang" var to the query string.', E_USER_ERROR );
+}
+
+$file = 'language_' . $_GET['lang'] . '.php';
+
+if ( ! file_exists( dirname( __FILE__ ) . '/' . $file ) ) {
+    trigger_error( 'Language file "' . $file . '" doesn\'t exist.', E_USER_ERROR );
+}
+
+include 'language_en.php';
+
+$en = $GLOBALS['t'];
+unset( $GLOBALS['t'] );
+
+include $file;
+
+echo '<html>';
+echo '<body>';
+echo '<h2>MISSING TRANSLATIONS</h2>';
+echo '<dl>';
+
+foreach ( $en as $key => $str ) {
+    if ( ! isset( $GLOBALS['t'][ $key ] ) ) {
+        echo '<dt style="font-face: Verdana, Arial; font-size: 11pt"><b>' . $key . '</b></dt>';
+        echo '<dd style="font-face: Verdana, Arial; font-size: 11pt; padding-bottom: 8px">' . $str . '</dd>';
+    }
+}
+
+echo '</dl>';
+echo '<h2>DEPRECATED TRANSLATIONS</h2>';
+echo '<dl>';
+
+foreach ( $GLOBALS['t'] as $key => $str ) {
+    if ( ! isset( $en[ $key ] ) ) {
+        echo '<dt style="font-face: Verdana, Arial; font-size: 11pt"><b>' . $key . '</b></dt>';
+        echo '<dd style="font-face: Verdana, Arial; font-size: 11pt; padding-bottom: 8px">' . $str . '</dd>';
+    }
+}
+
+echo '</dl>';
+echo '</body>';
+echo '</html>';
+
+?>



From david_db at mail.berlios.de  Tue Aug  8 02:33:44 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Tue, 8 Aug 2006 02:33:44 +0200
Subject: [ydf-devel] r1986 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200608080033.k780Xin1002418@sheep.berlios.de>

Author: david_db
Date: 2006-08-08 02:33:36 +0200 (Tue, 08 Aug 2006)
New Revision: 1986

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Added YDDatabaseObject::getModified.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-08-08 00:30:57 UTC (rev 1985)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-08-08 00:33:36 UTC (rev 1986)
@@ -104,7 +104,7 @@
 
             // Setup the module
             $this->_author = 'David Bittencourt';
-            $this->_version = '4.27';
+            $this->_version = '4.28';
             $this->_copyright = '(c) 2005 David Bittencourt, muitocomplicado at hotmail.com';
             $this->_description = 'This class defines a YDDatabaseObject object.';
 
@@ -120,7 +120,7 @@
             $this->_callbacks->set( 'reset',  array( 'before' => array(), 'after' => array() ) );
 
         }
-
+        
         /**
          *  This function returns an instance of a YDDatabaseObject class.
          *
@@ -1009,7 +1009,7 @@
             if ( ! sizeof( $values ) && ! sizeof( $values_noquote ) ) {
                 return;
             }
-
+            
             $this->_query->insert();
             $this->_query->into( $this->getTable() );
             $this->_query->values( $values );
@@ -1492,6 +1492,63 @@
             return $this->_count;
 
         }
+        
+        /**
+         *  This function returns an associative array with the
+         *  modified fields and it's old and new values.
+         *
+         *  @param $exclude  (optional) Array with fields to exclude from the comparison.
+         *
+         *  @returns  An array with the modified fields and the old and new values.
+         */
+        function getModified( $exclude=array() ) {
+        
+            $all = get_object_vars( $this->_fields );
+            
+            $fields = array();
+            $keys = array();
+			foreach ( $all as $field ) {
+            
+                $name = $field->getName();
+                
+				if ( $field->isKey() ) {
+                    if ( ! array_key_exists( $name, $this ) || ! strlen( $this->$name ) ) {
+    					return false;
+    				}
+                    $keys[] = $name;
+                    continue;
+                }
+                
+                if ( ! in_array( $name, $exclude ) ) {
+                    $fields[] = $name;
+                }
+                
+			}
+            
+            $obj = $this->getInstance();
+            foreach ( $keys as $key ) {
+    			$obj->$key = $this->$key;
+            }
+    		$obj->find();
+    			
+			if ( $obj->count() != 1 ) {
+				return false;
+			}
+			
+			$old = $obj->getValuesAsAssocArray( $fields );
+			$new = $this->getValuesAsAssocArray( $fields );
+            
+            $modified = array();
+			foreach ( $new as $field => $value ) {
+				if ( array_key_exists( $field, $old ) && $old[ $field ] == $value ) {
+					continue;
+				} 
+				$modified[ $field ] = array( 'old' => $old[ $field ], 'new' => $new[ $field ] );
+			}
+			
+			return $modified;
+        
+        }
 
         /**
          *  This function executes any SQL query.



From david_db at mail.berlios.de  Tue Aug  8 02:35:16 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Tue, 8 Aug 2006 02:35:16 +0200
Subject: [ydf-devel] r1987 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery
Message-ID: <200608080035.k780ZGeZ002760@sheep.berlios.de>

Author: david_db
Date: 2006-08-08 02:34:59 +0200 (Tue, 08 Aug 2006)
New Revision: 1987

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
Log:
Fixed YDDatabaseQuery::getFrom for INSERT queries.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-08-08 00:33:36 UTC (rev 1986)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-08-08 00:34:59 UTC (rev 1987)
@@ -527,7 +527,7 @@
          *
          *  @returns  The tables references expression.
          */
-        function getFrom( $title=true ) {
+        function getFrom( $title=true, $single=false ) {
 
             $from = array();
 
@@ -542,13 +542,13 @@
                     
                     $sql  = sizeof( $from ) ? ', ' : '';
                     $sql .= $this->reserved( $table );
-                    if ( strlen( $alias ) ) {
+                    if ( strlen( $alias ) && ! $single ) {
                         $sql .= ' AS ' . $this->reserved( $alias );
                     }
                     
                 }
 
-                if ( array_key_exists( $index, $this->join ) ) {
+                if ( ! $single && array_key_exists( $index, $this->join ) ) {
 
                     $join = $this->join[ $index ];
                     $sql .= ' ' . $join['type'] . ' JOIN ';
@@ -564,6 +564,10 @@
                 }
 
                 $from[] = $sql;
+                
+                if ( $single ) {
+                    break;
+                }
             }
 
             return ( $title ? ' FROM ' : '' ) . trim( implode( '', $from ) );
@@ -854,7 +858,7 @@
         function getInsertQuery() {
             
             return 'INSERT ' . $this->getOptions() .
-                   'INTO '   . $this->getFrom( false ) . $this->getInsert();
+                   'INTO '   . $this->getFrom( false, true ) . $this->getInsert();
             
         }
         



From david_db at mail.berlios.de  Tue Aug  8 07:39:40 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Tue, 8 Aug 2006 07:39:40 +0200
Subject: [ydf-devel] r1988 - YDFramework2.0/trunk/examples/database_object
Message-ID: <200608080539.k785devp016519@sheep.berlios.de>

Author: david_db
Date: 2006-08-08 07:39:34 +0200 (Tue, 08 Aug 2006)
New Revision: 1988

Modified:
   YDFramework2.0/trunk/examples/database_object/index.php
Log:
Fixed YDDatabaseObject examples.

Modified: YDFramework2.0/trunk/examples/database_object/index.php
===================================================================
--- YDFramework2.0/trunk/examples/database_object/index.php	2006-08-08 00:34:59 UTC (rev 1987)
+++ YDFramework2.0/trunk/examples/database_object/index.php	2006-08-08 05:39:34 UTC (rev 1988)
@@ -1,13 +1,21 @@
 <?php
 
     include_once( dirname( __FILE__ ) . '/includes/config.php' );
-
+    
     class index extends YDDatabaseObjectRequest {
         
         function index() {
             $this->YDDatabaseObjectRequest();
         }
         
+        function getLastYDSqlQuery() {
+            $arr = explode( "\r\n", end( $GLOBALS['YD_SQL_QUERY'] ) );
+            foreach ( $arr as $k => $str ) {
+                $arr[$k] = preg_replace( "/^(\[.*\])/", "", trim( $str ) );
+            }
+            return implode( '', $arr );
+        }
+        
         function actionGroups() {
             
             $group = YDDatabaseObject::getInstance( 'group' );
@@ -19,7 +27,7 @@
             $group->insert();
             
             $this->template->assign( 'group1', $group );
-            $this->template->assign( 'group1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group1_sql', $this->getLastYDSqlQuery() );
             
             $group->reset();
             $group->name = 'Group B';
@@ -27,7 +35,7 @@
             $group->insert();
             
             $this->template->assign( 'group2', $group );
-            $this->template->assign( 'group2_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group2_sql', $this->getLastYDSqlQuery() );
             
             $group->reset();
             $group->name = 'Group C';
@@ -35,7 +43,7 @@
             $group->insert();
             
             $this->template->assign( 'group3', $group );
-            $this->template->assign( 'group3_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group3_sql', $this->getLastYDSqlQuery() );
             
             $group->reset();
             $group->name = 'Group D';
@@ -43,7 +51,7 @@
             $group->insert();
             
             $this->template->assign( 'group4', $group );
-            $this->template->assign( 'group4_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group4_sql', $this->getLastYDSqlQuery() );
             
             $group->reset(); // resets all data
             $group->find();
@@ -54,7 +62,7 @@
             }
             
             $this->template->assign( 'find1_results', implode( '', $results ) );
-            $this->template->assign( 'find1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'find1_sql', $this->getLastYDSqlQuery() );
             
             $group->reset(); // resets all data
             $group->active = 0;
@@ -66,14 +74,14 @@
             }
             
             $this->template->assign( 'find2_results', implode( '', $results ) );
-            $this->template->assign( 'find2_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'find2_sql', $this->getLastYDSqlQuery() );
             
             $group->active = 1;
             $group->update();
-            $this->template->assign( 'group4_update_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group4_update_sql', $this->getLastYDSqlQuery() );
             
             $group->delete();
-            $this->template->assign( 'group4_delete_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'group4_delete_sql', $this->getLastYDSqlQuery() );
             
             $group->reset(); // resets all data
             $group->find();
@@ -106,7 +114,7 @@
             $user->is_admin = 1;
             $user->birthday = 19700516;
             $user->insert(); // {$insert1_sql}
-            $this->template->assign( 'insert1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert1_sql', $this->getLastYDSqlQuery() );
             
             $user->reset();
             $user->name = 'User B';
@@ -115,7 +123,7 @@
             $user->is_admin = 0;
             $user->birthday = 19500516;
             $user->insert(); // {$insert2_sql}
-            $this->template->assign( 'insert2_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert2_sql', $this->getLastYDSqlQuery() );
             
             $user->reset();
             $user->name = 'User C';
@@ -123,7 +131,7 @@
             $user->country = 'Colombia';
             $user->birthday = 19811120;
             $user->insert(); // {$insert3_sql}
-            $this->template->assign( 'insert3_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert3_sql', $this->getLastYDSqlQuery() );
             
             $user->reset();
             $user->name = 'User A';
@@ -141,7 +149,7 @@
             $this->template->assign( 'age_value', 'age = ' . $user->get( 'age' ) );
             
             $user->update();
-            $this->template->assign( 'update1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'update1_sql', $this->getLastYDSqlQuery() );
             
             $this->template->display( 'users' );
             
@@ -176,49 +184,49 @@
             $phone->number = '1111-1111';
             $phone->ord = 1;
             $phone->insert(); // {$insert1_sql}
-            $this->template->assign( 'insert1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert1_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '1222-2222';
             $phone->ord = 2; 
             $phone->insert(); // {$insert2_sql}
-            $this->template->assign( 'insert2_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert2_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '1333-3333';
             $phone->ord = 3;
             $phone->insert(); // {$insert3_sql}
-            $this->template->assign( 'insert3_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert3_sql', $this->getLastYDSqlQuery() );
             
             $phone->user_id = 2;
             $phone->number = '2444-4444';
             $phone->ord = 1;
             $phone->insert(); // {$insert4_sql}
-            $this->template->assign( 'insert4_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert4_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '2555-5555';
             $phone->ord = 2; 
             $phone->insert(); // {$insert5_sql}
-            $this->template->assign( 'insert5_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert5_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '2666-6666';
             $phone->ord = 3;
             $phone->insert(); // {$insert6_sql}
-            $this->template->assign( 'insert6_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert6_sql', $this->getLastYDSqlQuery() );
             
             $phone->user_id = 3;
             $phone->number = '3777-7777';
             $phone->ord = 1;
             $phone->insert(); // {$insert7_sql}
-            $this->template->assign( 'insert7_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert7_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '3888-8888';
             $phone->ord = 2; 
             $phone->insert(); // {$insert8_sql}
-            $this->template->assign( 'insert8_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert8_sql', $this->getLastYDSqlQuery() );
             
             $phone->number = '3999-9999';
             $phone->ord = 3;
             $phone->insert(); // {$insert9_sql}
-            $this->template->assign( 'insert9_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert9_sql', $this->getLastYDSqlQuery() );
             
             $user->id = 1;
             $user->find( 'phone' );
@@ -261,45 +269,45 @@
             $user_group->joined = 20050515;
             $user_group->active = 1;
             $user_group->insert(); // {$insert1_sql}
-            $this->template->assign( 'insert1_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert1_sql', $this->getLastYDSqlQuery() );
             
             $user_group->group_id = 2;
             $user_group->joined = 20050513;
             $user_group->active = 1;
             $user_group->insert(); // {$insert2_sql}
-            $this->template->assign( 'insert2_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert2_sql', $this->getLastYDSqlQuery() );
             
             $user_group->group_id = 3;
             $user_group->joined = 20050514;
             $user_group->active = 0;
             $user_group->insert(); // {$insert3_sql}
-            $this->template->assign( 'insert3_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert3_sql', $this->getLastYDSqlQuery() );
             
             $user_group->user_id = 2;
             $user_group->group_id = 1;
             $user_group->joined = 20050412;
             $user_group->active = 0;
             $user_group->insert(); // {$insert4_sql}
-            $this->template->assign( 'insert4_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert4_sql', $this->getLastYDSqlQuery() );
             
             $user_group->group_id = 3;
             $user_group->joined = 20050830;
             $user_group->active = 1;
             $user_group->insert(); // {$insert5_sql}
-            $this->template->assign( 'insert5_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert5_sql', $this->getLastYDSqlQuery() );
             
             $user_group->user_id = 3;
             $user_group->group_id = 2;
             $user_group->joined = 20040101;
             $user_group->active = 1;
             $user_group->insert(); // {$insert6_sql}
-            $this->template->assign( 'insert6_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert6_sql', $this->getLastYDSqlQuery() );
             
             $user_group->group_id = 3;
             $user_group->joined = 20051225;
             $user_group->active = 1;
             $user_group->insert(); // {$insert7_sql}
-            $this->template->assign( 'insert7_sql', end( $GLOBALS['YD_SQL_QUERY'] ) );
+            $this->template->assign( 'insert7_sql', $this->getLastYDSqlQuery() );
             
             $user->id = 1;
             $user->find( 'group' );



From ximian at mail.berlios.de  Tue Aug  8 15:59:22 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 8 Aug 2006 15:59:22 +0200
Subject: [ydf-devel] r1989 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200608081359.k78DxMjI024861@sheep.berlios.de>

Author: ximian
Date: 2006-08-08 15:59:05 +0200 (Tue, 08 Aug 2006)
New Revision: 1989

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
new YDAjax feature: on addEvent it's possible to hardcode a form name.

Until now, to define a form argument we needed to add the form name ($ydajax->addForm) and then ydajax would compare the argument name with the form name.
Now, if we already know that a string is a form name we can explicitly add the form, eg, if a form name is YDFORMNAME:
     $ydajax->addEvent( 'jsfunc()', 'phpfunc', 'form YDFORMNAME' );

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-08 05:39:34 UTC (rev 1988)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-08 13:59:05 UTC (rev 1989)
@@ -520,6 +520,9 @@
 
 				// if is a string and it's a form name, we want the form values
 				if ( is_string( $arg ) && $this->__isForm( $arg ) ) { $args[] = "xajax.getFormValues('" . $arg . "')"; continue; }
+				
+				// if is a string and it's a harcoded form name (eg: 'form xpto', where 'xpto' is a form name)
+				if ( is_string( $arg ) && ereg ( "^form (.*)$", $arg, $res ) ) { $args[] = "xajax.getFormValues('" . $res[1] . "')"; continue; }
 
 				// if argument is numeric just add it and continue
 				if ( is_numeric( $arg ) ) { $args[] = $arg; continue; }



From ximian at mail.berlios.de  Tue Aug  8 16:05:34 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 8 Aug 2006 16:05:34 +0200
Subject: [ydf-devel] r1990 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200608081405.k78E5Y8T026089@sheep.berlios.de>

Author: ximian
Date: 2006-08-08 16:05:23 +0200 (Tue, 08 Aug 2006)
New Revision: 1990

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
small updates (about previous commit) in YDAjax

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-08 13:59:05 UTC (rev 1989)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-08 14:05:23 UTC (rev 1990)
@@ -68,7 +68,7 @@
 
             // Setup the module
             $this->_author = 'Francisco Azevedo';
-            $this->_version = '2.82b';
+            $this->_version = '2.83';
             $this->_copyright = '(c) Copyright 2002-2006 Francisco Azevedo';
             $this->_description = 'This class makes ajax easy for YDF developers';
 
@@ -458,7 +458,6 @@
 				return $this->prefix . $serverFunction . 'get()';
 			}
 
-
 			return $functionName;
 		}
 		
@@ -518,12 +517,12 @@
 			// cycle arguments to create js function to get values
 			foreach ( $arguments as $arg ){
 
-				// if is a string and it's a form name, we want the form values
-				if ( is_string( $arg ) && $this->__isForm( $arg ) ) { $args[] = "xajax.getFormValues('" . $arg . "')"; continue; }
-				
 				// if is a string and it's a harcoded form name (eg: 'form xpto', where 'xpto' is a form name)
 				if ( is_string( $arg ) && ereg ( "^form (.*)$", $arg, $res ) ) { $args[] = "xajax.getFormValues('" . $res[1] . "')"; continue; }
 
+				// if is a string and it's a form name, we want the form values
+				if ( is_string( $arg ) && $this->__isForm( $arg ) ) { $args[] = "xajax.getFormValues('" . $arg . "')"; continue; }
+
 				// if argument is numeric just add it and continue
 				if ( is_numeric( $arg ) ) { $args[] = $arg; continue; }
 					



From ximian at mail.berlios.de  Tue Aug  8 16:07:23 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 8 Aug 2006 16:07:23 +0200
Subject: [ydf-devel] r1991 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608081407.k78E7NJM026523@sheep.berlios.de>

Author: ximian
Date: 2006-08-08 16:07:10 +0200 (Tue, 08 Aug 2006)
New Revision: 1991

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
small changes in YDCM user management permission system

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-08 14:05:23 UTC (rev 1990)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-08 14:07:10 UTC (rev 1991)
@@ -70,7 +70,7 @@
 		
 			$this->resetValues();
 			$this->user_id = intval( $user_id );
-
+			$this->orderby( 'object DESC, object_action DESC' );
 			$this->find();
 
 			return $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-08 14:05:23 UTC (rev 1990)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-08 14:07:10 UTC (rev 1991)
@@ -120,10 +120,6 @@
          */
 		function getPermissions( $user_id = null ){
 		
-//			require_once( dirname( __FILE__ ) . '/YDCMPermissions.php' );
-
-//			$permissions = new YDCMPermissions();
-		
 			if ( is_null( $user_id ) ) $user_id = $this->id;
 		
 			return $this->perm->getPermissions( $user_id );
@@ -161,7 +157,7 @@
 
 
         /**
-         *  This function returns all sub users
+         *  This function checks if a user is descendant of another user
          *
          *  @param      $id          User id to test if id descendant
          *  @param      $parent_id   Parent id
@@ -391,13 +387,17 @@
 
         /**
          *  This function adds checkbox groups about permissions and gets all translations.
-         *  It generates 2 private variables 
-         *    - $this->permissions as db permissions 
-         *    - $this->permissions_html as associative array with checkboxgroup html code
+         *  It generates 3 private variables 
+         *    - $this->permissions         user permissions 
+         *    - $this->permissions_panret  parent permissions 
+         *    - $this->permissions_html    associative array with checkboxgroup html code
          *
-         *  @returns  Associative array of objects and correspondent chechboxgoup
+         *  @param    $userParentPermissions   (Optional) Boolean to compute avaiable parent permissions or user permissions
+         *                                      This will be used to create permissions for editing or when creating a subuser
+         *  
+         *  @returns  Associative array of objects and correspondent chechboxgoup html
          */
-		function addFormPermissions(){
+		function addFormPermissions( $useParentPermissions = true ){
 
 			// get permissions from parent;
 			$node = $this->getUser( $this->id );
@@ -406,11 +406,16 @@
 			$this->permissions      = $this->getPermissions();
 			$this->permissions_html = array();
 
-			// init parent permissions
-			$this->permissions_parent = $this->getPermissions( $node['parent_id'] );
+			// check if we are editing or creating
+			if ( $useParentPermissions ){
+				$permissions_avaiable = $this->getPermissions( $node['parent_id'] );
+				$this->permissions_parent = $permissions_avaiable;
+			}else{
+				$permissions_avaiable = $this->permissions;
+			}
 
 			// cycle parent permissions to create form checkboxgroup of this user
-			foreach( $this->permissions_parent as $obj => $perm ){
+			foreach( $permissions_avaiable as $obj => $perm ){
 
 				// get permission translations of this component
 				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
@@ -424,7 +429,7 @@
 					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
 
 					// check if this parent action belongs to the child too ( to select it )
-					if ( isset( $this->permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $this->permissions[ $obj ] ) )){
+					if ( $useParentPermissions && isset( $this->permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $this->permissions[ $obj ] ) )){
 						$selected[ $p['object_action' ] ] = 1;
 					}
 				}
@@ -433,7 +438,7 @@
 				$this->form->addElement( 'checkboxgroup', $obj, $obj, array(), $options );
 				
 				// add default for this checkboxgroup
-				$this->form->setDefault( $obj, $selected );
+				if ( $useParentPermissions ) $this->form->setDefault( $obj, $selected );
 
 				// get element html
 				$el = & $this->form->getElement( $obj );



From ximian at mail.berlios.de  Tue Aug  8 17:54:54 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 8 Aug 2006 17:54:54 +0200
Subject: [ydf-devel] r1992 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608081554.k78Fssj4005525@sheep.berlios.de>

Author: ximian
Date: 2006-08-08 17:54:33 +0200 (Tue, 08 Aug 2006)
New Revision: 1992

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
- added new alpha version of YDCMUsers::addUserForm method to add new users based on form values

- db scheme cannot have foreign key in YDCMUsers table because of null incompatibilities with YDDatabaseTree

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-08 14:07:10 UTC (rev 1991)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-08 15:54:33 UTC (rev 1992)
@@ -583,15 +583,15 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1758" ColName="type " PrevColName="type_2" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMVisitor\a" Comments="\aYDCMAdministrator\a or \aYDCMVisitor\a">
+<COLUMN ID="1793" ColName="parent_id" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1239" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="optional parent of this user">
+<COLUMN ID="1758" ColName="type " PrevColName="type_2" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMVisitor\a" Comments="\aYDCMAdministrator\a or \aYDCMVisitor\a">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
 <COLUMN ID="1240" ColName="nleft" PrevColName="path" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
@@ -689,14 +689,12 @@
 <RELATIONS_START>
 <RELATION_START ID="1383" />
 <RELATION_START ID="1436" />
-<RELATION_START ID="1648" />
 <RELATION_START ID="1410" />
 <RELATION_START ID="1741" />
 <RELATION_START ID="1784" />
 </RELATIONS_START>
 <RELATIONS_END>
 <RELATION_END ID="1366" />
-<RELATION_END ID="1648" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -1095,7 +1093,6 @@
 <RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="31" CaptionOffsetY="-6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
 <RELATION ID="1646" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<RELATION ID="1648" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="user_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="52" />
 <RELATION ID="1692" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1678" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="-3" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-44" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
 <RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="31" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
 <RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-08 14:07:10 UTC (rev 1991)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-08 15:54:33 UTC (rev 1992)
@@ -211,6 +211,41 @@
 
 
         /**
+         *  This function adds a new user based on form values
+         *
+         *  @param $id          Static parent id
+         *  @param $formvalues  Array with user attributes
+         *
+         *  @returns    true if updated, array with form errors otherwise
+         */
+		function addUserForm( $id, $formvalues = array() ){
+
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
+			// parse values
+			$values = array();
+			$values['name']         = $this->form->getValue( 'name' );
+			$values['email']        = $this->form->getValue( 'email' );
+			$values['username']     = $this->form->getValue( 'username' );
+			$values['other']        = $this->form->getValue( 'other' );
+			$values['state']        = $this->form->getValue( 'state' );
+			$values['type']         = 'YDCMUseradministrator';
+			$values['nlevel']       = 1;
+			$values['created_user'] = $this->currentID();
+			$values['created_date'] = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$values['language_id']  = $this->form->getValue( 'language_id' );
+			$values['login_start']  = YDStringUtil::formatDate( $this->form->getValue( 'login_start' ), 'datetimesql' );
+			$values['login_end']    = YDStringUtil::formatDate( $this->form->getValue( 'login_end' ),   'datetimesql' );
+
+			// add user to YDUsers table
+			return $this->tree->addNode( $values, $id );
+		}
+
+
+
+        /**
          *  This function updates the current user attributes (ignoring passwords and statistics) using form values
          *
          *  @param $id          Static user id



From ximian at mail.berlios.de  Wed Aug  9 17:33:06 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 9 Aug 2006 17:33:06 +0200
Subject: [ydf-devel] r1993 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608091533.k79FX6AT019653@sheep.berlios.de>

Author: ximian
Date: 2006-08-09 17:32:52 +0200 (Wed, 09 Aug 2006)
New Revision: 1993

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
lots of clean ups in YDCM user management

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-08 15:54:33 UTC (rev 1992)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-09 15:32:52 UTC (rev 1993)
@@ -80,20 +80,50 @@
         /**
          *  This function assigns an array of permissions to a user
          *
-         *  @param     $user_id              User id to get permissions
-         *  @param     $permissions_to_add   Array with permissions to add
-         *  @param     $permissions_to_del   Array with permissions to delete
+         *  @param     $user_id     User id to get permissions
+         *  @param     $parend_id   Parent id form permission comparation
+         *  @param     $values      Array with permissions
          */
-		function setPermissions( $user_id, $permissions_to_add, $permissions_to_del ){
+		function setPermissions( $user_id, $parent_id, $values ){
 
+			// init temp array permissions
+			$permissions_valid  = array();
+			$permissions_to_add = array();
+			$permissions_to_del = array();
+
+			// get parent permissions
+			$permissions_parent = $this->getPermissions( $parent_id );
+
+			// check $values if contains permissions that belong to its parent
+			foreach( $permissions_parent as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 'on' )
+						$permissions_valid[ $obj ][] = $p;
+
+			// get user permissions
+			$permissions_user = $this->getPermissions( $user_id );
+
+			// cycle current permissions to see the ones we need to delete
+			foreach( $permissions_user as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 
+						$permissions_to_del[ $obj ][] = $p;
+
+			// cycle current permissions to see the ones we need to add
+			foreach( $permissions_valid as $obj => $perms )
+				foreach( $perms as $p )
+					if ( !isset( $permissions[ $obj ][$p] ) )
+						$permissions_to_add[ $obj ][] = $p;
+
+
 			$p_add = 0;
 			$t_add = 0;
 
 			$p_del = 0;
 			$t_del = 0;
 
-			// cycle permissions to add and insert them in db
-			foreach ( $permissions_to_add as $obj => $perms )
+			// cycle permissions to delete and delete them from db
+			foreach ( $permissions_to_del as $obj => $perms )
 				foreach ( array_values( $perms ) as $p ){
 
 					$this->resetAll();
@@ -101,12 +131,12 @@
 					$this->object         = $obj;
 					$this->object_action  = $p;
 
-					if ($this->insert()) $p_add++;
-					$t_add++;
+					if ($this->delete()) $p_del++;
+					$t_del++;
 				}
 
-			// cycle permissions to delete and delete them from db
-			foreach ( $permissions_to_del as $obj => $perms )
+			// cycle permissions to add and insert them in db
+			foreach ( $permissions_to_add as $obj => $perms )
 				foreach ( array_values( $perms ) as $p ){
 
 					$this->resetAll();
@@ -114,8 +144,8 @@
 					$this->object         = $obj;
 					$this->object_action  = $p;
 
-					if ($this->delete()) $p_del++;
-					$t_del++;
+					if ($this->insert()) $p_add++;
+					$t_add++;
 				}
 
 			if ($p_add == $t_add && $p_del == $t_del ) return true;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-08 15:54:33 UTC (rev 1992)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-09 15:32:52 UTC (rev 1993)
@@ -95,33 +95,18 @@
 
 			// init permissions
 			$this->perm = new YDCMPermissions();
-			
-			$this->id = null;
 		}
 
 
         /**
-         *  This function sets the user id of this user object
-         *
-         *  @param $id  User id
-         */
-		function setId( $id ){
-		
-			$this->id = $id;
-		}
-
-
-        /**
          *  This function returns all user permissions
          *
-         *  @param  $user_id (Optional) Custom user id to get permissions
+         *  @param  $user_id   User id to get permissions
          *
          *  @retuns  Associative array of permissions
          */
-		function getPermissions( $user_id = null ){
+		function getPermissions( $user_id ){
 		
-			if ( is_null( $user_id ) ) $user_id = $this->id;
-		
 			return $this->perm->getPermissions( $user_id );
 		}
 
@@ -140,7 +125,7 @@
 			// if user is not valid we should return false
 			if ( $valid === false ) return false;
 
-			// return user id found
+			// return user id found by $this->valid
 			return $this->user_id;
 		}
 
@@ -148,11 +133,13 @@
         /**
          *  This function returns all sub users
          *
+         *  @param  $user_id   User id to get permissions
+         *
          *  @returns    all tree elements 
          */
-		function getTreeElements(){
+		function getTreeElements( $user_id ){
 
-			return $this->tree->getDescendants( $this->id, true );
+			return $this->tree->getDescendants( $user_id, true );
 		}
 
 
@@ -164,9 +151,9 @@
          *
          *  @returns    boolean flag
          */
-		function isDescendantOf( $id, $parent_id ){
+		function isDescendantOf( $user_id, $parent_id ){
 
-			return $this->tree->isDescendantOf( intval( $id ), intval( $parent_id ) );
+			return $this->tree->isDescendantOf( intval( $user_id ), intval( $parent_id ) );
 		}
 
 
@@ -174,7 +161,7 @@
          *  This function checks if a username and password are valid
          *
          *  @param $username  User username
-         *  @param $password  User password (if password length is smaller than 32 we must md5 it)
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it, pwd form elements must have max 31)
          *
          *  @returns    true if valid, false otherwise
          */
@@ -213,12 +200,12 @@
         /**
          *  This function adds a new user based on form values
          *
-         *  @param $id          Static parent id
+         *  @param $parent_id   Parent id of this new node
          *  @param $formvalues  Array with user attributes
          *
          *  @returns    true if updated, array with form errors otherwise
          */
-		function addUserForm( $id, $formvalues = array() ){
+		function addUserForm( $parent_id, $formvalues = array() ){
 
 			// check form validation
 			if ( !$this->form->validate( $formvalues ) )
@@ -240,11 +227,13 @@
 			$values['login_end']    = YDStringUtil::formatDate( $this->form->getValue( 'login_end' ),   'datetimesql' );
 
 			// add user to YDUsers table
-			return $this->tree->addNode( $values, $id );
+			$newID = $this->tree->addNode( $values, $parent_id );
+
+			// change user permissions
+			return $this->perm->setPermissions( $newID, $parent_id, $this->form->getValues() );
 		}
 
 
-
         /**
          *  This function updates the current user attributes (ignoring passwords and statistics) using form values
          *
@@ -259,28 +248,16 @@
 			if ( !$this->form->validate( $formvalues ) )
 				return $this->form->getErrors();
 
-			// get values
+			// get form values
 			$values = $this->form->getValues();
 
-			// change user details and permissions based on general values
-			// BEGIN :)
-			$res1 = $this->changeUserPermissions( $id, $values );
-			$res2 = $this->changeUserDetails( $id, $values );
-			return $res1 + $res2;
-			// COMMIT :)
-		}
+			// we need parent fot setting user permissions
+			$details = $this->getUser( $id );
 
+			// change user permissions
+			$res1 = $this->perm->setPermissions( $id, $details[ 'parent_id' ], $values );
 
-        /**
-         *  This function updates the current user attributes
-         *
-         *  @param $id          Static user id
-         *  @param $formvalues  Array with user attributes
-         *
-         *  @returns    true if updated, false otherwise
-         */
-		function changeUserDetails( $id, $values ){
-
+			// change user details
 			$this->resetAll();
 
 			// set new values
@@ -298,36 +275,6 @@
 		}
 
 
-		function changeUserPermissions( $id, $values ){
-
-			// init temp array permissions
-			$permissions_valid  = array();
-			$permissions_to_add = array();
-			$permissions_to_del = array();
-
-			// check $values if contains permissions that belong to its parent
-			foreach( $this->permissions_parent as $obj => $perms )
-				foreach( $perms as $p => $arr )
-					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 'on' )
-						$permissions_valid[ $obj ][] = $p;
-
-			// cycle current permissions to see the ones we need to delete
-			foreach( $this->permissions as $obj => $perms )
-				foreach( $perms as $p => $arr )
-					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 
-						$permissions_to_del[ $obj ][] = $p;
-
-			// cycle current permissions to see the ones we need to add
-			foreach( $permissions_valid as $obj => $perms )
-				foreach( $perms as $p )
-					if ( !isset( $this->permissions[ $obj ][$p] ) )
-						$permissions_to_add[ $obj ][] = $p;
-
-			// pass permissions to add and to delete
-			return $this->perm->setPermissions( intval( $id ), $permissions_to_add, $permissions_to_del );
-		}
-
-
         /**
          *  This function updates the user attributes using form values
          *
@@ -364,20 +311,25 @@
 		
 
         /**
-         *  This function creates an user details form
+         *  This function adds form elements for user detail management
 		 *
-		 * @param $username   1: Username is a span, 2: Username is a text box
-		 * @param $password   0: Password is not showed, 1: Password is showed
-		 * @param $login      0: Login is span, 1: Login is editable
+		 * @param $username     (Optional) Flag that defines if the username is a box (editable) or a span for information only
+		 *                                 TRUE: is a box (editable); FALSE: is a span
+		 * 
+		 * @param $password     (Optional) Flag that defines if we want to include the password box
+		 *                                 TRUE: include password box; FALSE: don't include
+		 * 
+		 * @param $logindetails (Optional) Flag that defines if we login details are editable (eg: login schedule dates)
+		 *                                 TRUE: user details are editable; FALSE: user details are just information
          */
-		function addFormDetails( $username = 1, $password = 0, $login = 0 ){
+		function addFormDetails( $username = false, $password = false, $logindetails = false ){
 
 			// add username
-			if ( $username == 1 ) $this->form->addElement( 'span',     'username', t('user_username') );
-			else                  $this->form->addElement( 'text',     'username', t('user_username') );
+			if ( $username ) $this->form->addElement( 'text', 'username', t('user_username') );
+			else             $this->form->addElement( 'span', 'username', t('user_username') );
 
 			// add password
-			if ( $password == 1 ) $this->form->addElement( 'password', 'password', t('user_password') );
+			if ( $password ) $this->form->addElement( 'password', 'password', t('user_password') );
 
 			// add name
             $this->form->addElement( 'text',      'name',         t('user_name'),     array('size' => 50, 'maxlength' => 255) );
@@ -402,8 +354,8 @@
 			$this->form->addRule(    'template',  'in_array',     t('template not valid'), array_keys( $templates->admin_templates() ) );
 
 			// add user details
-			if ($login == 1){
-				$this->form->addElement( 'select',         'state',       t('login_state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+			if ( $logindetails ){
+				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
 				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
 				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
 			}else{
@@ -412,11 +364,11 @@
 				$this->form->addElement( 'span',           'login_end',   t('login_end') );
 			}
 
-			$this->form->addElement( 'span', 'login_counter',t('login_counter') );
-            $this->form->addElement( 'span', 'login_last',   t('login_last') );
-            $this->form->addElement( 'span', 'login_current',t('login_current') );
-            $this->form->addElement( 'span', 'created_user', t('created_user') );
-            $this->form->addElement( 'span', 'created_date', t('created_date') );
+			$this->form->addElement( 'span', 'login_counter', t('login_counter') );
+            $this->form->addElement( 'span', 'login_last',    t('login_last') );
+            $this->form->addElement( 'span', 'login_current', t('login_current') );
+            $this->form->addElement( 'span', 'created_user',  t('created_user') );
+            $this->form->addElement( 'span', 'created_date',  t('created_date') );
 		}
 
 
@@ -427,27 +379,27 @@
          *    - $this->permissions_panret  parent permissions 
          *    - $this->permissions_html    associative array with checkboxgroup html code
          *
+         *  @param    $user_id                 User id to get defaults
+         *
          *  @param    $userParentPermissions   (Optional) Boolean to compute avaiable parent permissions or user permissions
          *                                      This will be used to create permissions for editing or when creating a subuser
          *  
          *  @returns  Associative array of objects and correspondent chechboxgoup html
          */
-		function addFormPermissions( $useParentPermissions = true ){
+		function addFormPermissions( $user_id, $useParentPermissions = true ){
 
-			// get permissions from parent;
-			$node = $this->getUser( $this->id );
-
-			// init user permissions and permissions html 
-			$this->permissions      = $this->getPermissions();
+			// init permission html (checkboxgroups of actions groupby permission objects)
 			$this->permissions_html = array();
 
+			// get user details
+			$node = $this->getUser( $user_id );
+
+			// get user permissions
+			$permissions = $this->getPermissions( $user_id );
+
 			// check if we are editing or creating
-			if ( $useParentPermissions ){
-				$permissions_avaiable = $this->getPermissions( $node['parent_id'] );
-				$this->permissions_parent = $permissions_avaiable;
-			}else{
-				$permissions_avaiable = $this->permissions;
-			}
+			if ( $useParentPermissions ) $permissions_avaiable = $this->getPermissions( $node['parent_id'] );
+			else                         $permissions_avaiable = $this->getPermissions( $user_id );
 
 			// cycle parent permissions to create form checkboxgroup of this user
 			foreach( $permissions_avaiable as $obj => $perm ){
@@ -464,7 +416,7 @@
 					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
 
 					// check if this parent action belongs to the child too ( to select it )
-					if ( $useParentPermissions && isset( $this->permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $this->permissions[ $obj ] ) )){
+					if ( $useParentPermissions && isset( $permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $permissions[ $obj ] ) )){
 						$selected[ $p['object_action' ] ] = 1;
 					}
 				}
@@ -486,11 +438,13 @@
 
 
         /**
-         *  This function creates an user form for password changing
+         *  This function adds form elements for password changing
          *
-         * @param $oldpassword  0: don't include old password box; 1: include old password box
+         * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
+         *                                 This box is used when the user wants to change its pass and not when we want to change another user pass
+         *                                 TRUE: include box; FALSE: don't include
          */
-		function addFormPassword( $oldpassword = 1 ){
+		function addFormPassword( $oldpassword = true ){
 
 			// add new password box
             $this->form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
@@ -508,13 +462,12 @@
 			$this->form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
 
 			// add old password box
-			if ( $oldpassword == 1 ){
+			if ( $oldpassword ){
             	$this->form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
 				$this->form->addRule(    'old',      'required',     t('passwords are required') );
 				$this->form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
 				$this->form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
 			}
-
 		}
 
 
@@ -527,6 +480,7 @@
          */
 		function getForm( $defaults = false ){
 
+			// check if we have form defaults and apply them
 			if ( is_array( $defaults ) ) $this->form->setDefaults( $defaults );
 
 			return $this->form;
@@ -534,29 +488,29 @@
 
 
         /**
-         *  This function updates the current user password
+         *  This function updates the current user password using form values
          *
-         *  @param $oldpassword  Old user password
-         *  @param $newpassword  New password
+         *  @param $formvalues  Array with 3 passwords (old, new and new_confirm)
          *
-         *  @returns    true if updated, false when old password is incorrect or user is invalid
+         *  @returns    true if updated, array with form errors, 0 if old password is incorrect
          */
-		function changeCurrentUserPassword( $oldpassword = '', $newpassword = '' ){
-		
-			// check if user is valid
-			if ( !$this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] ) ) return false;
+		function changeCurrentUserPasswordForm( $formvalues = array() ){
 
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
 			// reset values added from valid method
-			$this->resetAll();
+			$this->resetValues();
 
 			// set new password
-			$this->password = md5( $newpassword );
+			$this->password = md5( $this->form->getValue( 'new' ) );
 
 			// change only current user
 			// TODO: escape 'username'
-			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
-			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
-			$this->where( 'password = "' . md5( $oldpassword )            . '"' );
+			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER']        . '"' );
+			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] )        . '"' );
+			$this->where( 'password = "' . md5( $this->form->getValue( 'old' ) ) . '"' );
 
 			// update user and get result
 			if ( $this->update() == 1 ) return true;
@@ -566,40 +520,25 @@
 
 
         /**
-         *  This function updates the current user password using form values
+         *  This function updates a user password
          *
-         *  @param $formvalues  Array with 3 passwords (old, new and new_confirm)
+         *  @param $user_id     User id to update password
+         *  @param $formvalues  Array 2 passwords (new and new_confirm)
          *
-         *  @returns    true if updated, array with form errors, 0 if old password is incorrect
+         *  @returns    true if updated or array with form errors otherwise
          */
-		function changeCurrentUserPasswordForm( $formvalues = array() ){
+		function changeUserPasswordForm( $user_id, $formvalues ){
 
 			// check form validation
 			if ( !$this->form->validate( $formvalues ) )
 				return $this->form->getErrors();
 
-			return $this->changeCurrentUserPassword( $this->form->getValue( 'old' ), $this->form->getValue( 'new' ) );
-		}
-
-
-        /**
-         *  This function updates a user password
-         *
-         *  @param $newpassword  New password
-         *
-         *  @returns    true if updated, false when user is invalid
-         */
-		function changeUserPassword( $user_id, $newpassword ){
-		
-			// check if user is valid
-			if ( !$this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] ) ) return false;
-
-			// reset values added from valid method
+			// reset values
 			$this->resetAll();
 
 			// set new password
 			$this->user_id  = intval( $user_id );
-			$this->password = md5( $newpassword );
+			$this->password = md5( $this->form->getValue( 'new' ) );
 
 			// update user and get result
 			if ( $this->update() == 1 ) return true;
@@ -609,23 +548,6 @@
 
 
         /**
-         *  This function updates a user password
-         *
-         *  @param $formvalues  Array 2 passwords (new and new_confirm)
-         *
-         *  @returns    true if updated, array with form errors
-         */
-		function changeUserPasswordForm( $id = null, $formvalues = array() ){
-
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			return $this->changeUserPassword( $id, $this->form->getValue( 'new' ) );
-		}
-
-
-        /**
          *  This function return the current user attributes
          *
          *  @param      $translate   (Optional) Boolean that defines if result must be translated
@@ -635,24 +557,22 @@
 		function getCurrentUser( $translate = false ){
 		
 			// get current user id
-			return $this->getUser( $translate, $this->currentID() );
+			return $this->getUser( $this->currentID(), $translate );
 		}
 
 
         /**
          *  This function returns user attributes
          *
+         *  @param      $id          User id to use (instead of internal)
          *  @param      $translate   (Optional) Boolean that defines if result must be translated
-         *  @param      $id          (Optional) Custom user id to use (instead of internal)
          *
          *  @returns    User details
          */
-		function getUser( $translate = false, $id = null ){
+		function getUser( $id, $translate = false ){
 
 			$this->resetValues();
 
-			if ( is_null( $id ) ) $id = $this->id;
-
 			// set user id
 			$this->user_id = intval( $id );
 
@@ -684,9 +604,9 @@
 
 
         /**
-         *  This function updates user login details
+         *  This function updates current user login details
          *
-         *  @returns    true if user login details updated, false user is not valid or details not updated
+         *  @returns    true if user login details updated, false if user is not valid or details not updated
          */
 		function updateLogin(){
 
@@ -696,7 +616,8 @@
 			
 			// get current user id
 			$res = $this->currentID();
-			
+
+			// check if user exists
 			if ( $res == false ) return false;
 			
 			// get all attributes
@@ -716,7 +637,6 @@
 			
 			return false;
 		}
-
 		
     }
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Fri Aug 11 10:31:07 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 10:31:07 +0200
Subject: [ydf-devel] r1994 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormElements
Message-ID: <200608110831.k7B8V7K4024159@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 10:30:47 +0200 (Fri, 11 Aug 2006)
New Revision: 1994

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
Log:
added:
 - YDForm filter custom options
 - new filter 'dateformat' specific for date, dateselect and datetimeselect elements

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-09 15:32:52 UTC (rev 1993)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-11 08:30:47 UTC (rev 1994)
@@ -176,6 +176,7 @@
             $this->registerFilter( 'utf8_decode', 'utf8_decode' );
             $this->registerFilter( 'strip_html', 'strip_tags' );
             $this->registerFilter( 'safe_html', 'YDFormFilter_safe_html' );
+            $this->registerFilter( 'dateformat', 'YDFormFilter_dateformat' );
 
             // Add the renderers
             $this->registerRenderer( 'array', 'YDFormRenderer_array', 'YDFormRenderer_array.php' );
@@ -489,18 +490,19 @@
         /**
          *  Add a filter to the form for the specified field.
          *
-         *  @param  $element    The element to apply the filter on. If you specify an array, it will add the filter for
-         *                      each element in the array.
-         *  @param  $filter     The name of the filter to apply.
+         *  @param  $element       The element to apply the filter on. If you specify an array, it will add the filter for
+         *                         each element in the array.
+         *  @param  $filter        The name of the filter to apply.
+         *  @param  $options       (Optional) Custom filter options.
          */
-        function addFilter( $element, $filter ) {
+        function addFilter( $element, $filter, $options = null ) {
 
             // Check if the element is an array or not
             if ( is_array( $element ) ) {
 
                 // Add the rule for each element
                 foreach ( $element as $e ) {
-                    $this->addFilter( $e, $filter );
+                    $this->addFilter( $e, $filter, $options );
                 }
 
                 // Return
@@ -522,8 +524,7 @@
             if ( ! @ is_array( $this->_filters[ $element ] ) ) { $this->_filters[ $element ] = array(); }
 
             // Add the filter
-            array_push( $this->_filters[ $element ], $filter );
-
+            array_push( $this->_filters[ $element ], array( $filter, $options ) );
         }
 
         /**
@@ -662,15 +663,6 @@
                 }
             }
 
-            // Add the timestamp if needed
-            if ( $element->hasMethod( 'getTimeStamp' ) ) {
-                if ( ! is_array( $value ) ) {
-                    $element->setValue( $value );
-                    $value = $element->getValue();
-                }
-                @ $value['timestamp'] = $element->getTimeStamp();
-            }
-
             // Unset the element
             unset( $element );
 
@@ -1206,17 +1198,31 @@
             if ( array_key_exists( $name, $this->_filters ) ) {
                 if ( is_array( $this->_filters[ $name ] ) ) {
                     foreach ( $this->_filters[ $name ] as $filter ) {
-                        if ( ! is_callable( $this->_regFilters[ $filter ]['callback'] ) ) {
+                        if ( ! is_callable( $this->_regFilters[ $filter[0] ]['callback'] ) ) {
                             trigger_error(
                                 'The callback specified for the filter "' . $name . '" is not valid', YD_ERROR
                             );
                         }
                         if ( is_array( $value ) ) {
-                            foreach ( $value as $key=>$x ) {
-                                $value[$key] = call_user_func( $this->_regFilters[ $filter ]['callback'], $value[$key] );
+
+                            // check if element is special: 'date', 'dateselect' or 'datetimeselect'
+                            $element = & $this->getElement( $name );
+
+                            // if array is special we should pass all array to the function (instead of map the function to each element)
+                            if ( in_array( $element->getType(), array( 'date', 'dateselect', 'datetimeselect' ) ) ){
+                                if ( is_null( $filter[1] ) ) $value = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value );
+                                else                         $value = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value, $filter[1] );
+
+                            // otherwise we map the function to all array elements
+                            }else{
+                                foreach ( $value as $key=>$x ) {
+                                    if ( is_null( $filter[1] ) ) $value[$key] = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value[$key], $filter[1] );
+                                    else                         $value[$key] = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value[$key] );
+                                }
                             }
                         } else {
-                            $value = call_user_func( $this->_regFilters[ $filter ]['callback'], $value );
+                            if ( is_null( $filter[1] ) ) $value = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value );
+                            else                         $value = call_user_func( $this->_regFilters[ $filter[0] ]['callback'], $value, $filter[1] );
                         }
                     }
                 }
@@ -1707,4 +1713,25 @@
 
     }
 
+
+    /**
+     *  This filter reads a date form element result and returns a custom result
+     *
+     *  @param  $data     The data to filter.
+     *  @param  $option   (Optional) Filter option. By default, is returned the timestamp
+     *
+     *  @returns The filtered data as a string.
+     */
+    function YDFormFilter_dateformat( $data, $option = "timestamp" ) {
+
+        // check if option is a array member
+        if ( isset( $data[ $option ] ) ) return $data[ $option ];
+
+        // if not a member we want a custom date format eg: "datetimesql", "%b"
+        YDInclude( 'YDUtil.php' );
+
+        return YDStringUtil::formatDate( $data, $option );
+    }
+
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2006-08-09 15:32:52 UTC (rev 1993)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2006-08-11 08:30:47 UTC (rev 1994)
@@ -122,6 +122,18 @@
             }
             return $default;
         }
+
+        /**
+         *      This function returns the value of the element.
+         *
+         *      @returns        Value of this object.
+         */
+        function getValue() {
+
+            // add timestamp to values array
+            $this->_value['timestamp'] = $this->getTimeStamp();
+            return $this->_value;
+        }
         
         /**
          *      This function returns an array of values from $start to $end and



From ximian at mail.berlios.de  Fri Aug 11 10:33:32 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 10:33:32 +0200
Subject: [ydf-devel] r1995 - YDFramework2.0/trunk/examples
Message-ID: <200608110833.k7B8XWTb024446@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 10:33:13 +0200 (Fri, 11 Aug 2006)
New Revision: 1995

Added:
   YDFramework2.0/trunk/examples/form_filters.php
Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
added form filters example

Added: YDFramework2.0/trunk/examples/form_filters.php
===================================================================
--- YDFramework2.0/trunk/examples/form_filters.php	2006-08-11 08:30:47 UTC (rev 1994)
+++ YDFramework2.0/trunk/examples/form_filters.php	2006-08-11 08:33:13 UTC (rev 1995)
@@ -0,0 +1,65 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDForm.php' );
+    YDInclude( 'YDRequest.php' );
+
+    // Class definition
+    class form_filters extends YDRequest {
+
+        // Class constructor
+        function form_filters() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Create the form
+            $form = new YDForm( 'form1' );
+            
+            // Add elements
+            $form->addElement( 'text',           'username', 'Fill a username that starts with spaces' );
+            $form->addElement( 'text',           'name',     'Fill a small caps name' );
+            $form->addElement( 'datetimeselect', 'date1',    'Date1' );
+            $form->addElement( 'date',           'date2',    'Date2' );
+            $form->addElement( 'datetimeselect', 'date3',    'Date3' );
+            $form->addElement( 'datetimeselect', 'date4',    'Date4' );
+            $form->addElement( 'submit', '_cmdSubmit', 'Submit' );
+
+            // Some defaults
+			$form->setDefault( 'username', '    myuser' );
+			$form->setDefault( 'name',     'igor' );
+			
+            // Add filters
+            $form->addFilter( 'username', 'trim' );                       // must return eg 'myuser'
+            $form->addFilter( 'name',     'upper' );                      // must return eg 'IGOR'
+
+            if ( $form->validate() ) {
+	
+	            // IMPORTANT NOTE: 'dateformat' filters must be always added AFTER form validation !
+	            // On form validation checking (by $form->validate()), 'dateformat' filter is applyed and
+	            // element is not populated again because date result array is lost.
+	            // This is why form is not displayed correctly after validation 
+				// (if some rule is broken you would not get the date element with correct values)
+            	$form->addFilter( 'date2', 'dateformat', 'day' );          // must return eg '20'
+	        	$form->addFilter( 'date3', 'dateformat', 'datetimesql' );  // must return eg '2005-02-01 10:00:00'
+	        	$form->addFilter( 'date4', 'dateformat', "%b" );           // must return eg 'Aug'
+
+		        YDDebugUtil::dump( $form->getValues(), '$form->getValues()' );
+
+			}else{
+  	            // Display form
+	            $form->display();
+			}
+		}
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-11 08:30:47 UTC (rev 1994)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-11 08:33:13 UTC (rev 1995)
@@ -191,7 +191,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="11" valign="top">&nbsp;</td>
+            <td rowspan="12" valign="top">&nbsp;</td>
             <td valign="top"><a href="form.php">Form handling and validation</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=form.php">form.php</a>
@@ -252,6 +252,10 @@
             </td>
         </tr>
         <tr>
+          <td valign="top"><a href="form_filters.php">Form filters</a> </td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=form_filters.php">form_filters.php</a> </td>
+          </tr>
+        <tr>
             <td valign="top"><a href="form_xml2.php">Rendering and importing using XML</a></td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=form_xml2.php">form_xml2.php</a>



From ximian at mail.berlios.de  Fri Aug 11 10:45:23 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 10:45:23 +0200
Subject: [ydf-devel] r1996 - YDFramework2.0/trunk/examples
Message-ID: <200608110845.k7B8jNCY029741@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 10:44:41 +0200 (Fri, 11 Aug 2006)
New Revision: 1996

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
Modified the simple ajax example title in examples index (added a note that example is not using YDAjax)

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-11 08:33:13 UTC (rev 1995)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-11 08:44:41 UTC (rev 1996)
@@ -760,7 +760,7 @@
             <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=stringutil.php">stringutil.php</a> </td>
         </tr>
         <tr>
-            <td valign="top"><a href="ajax.php">Using AJAX with the {$YD_FW_NAME}</a></td>
+            <td valign="top"><a href="ajax.php">Using AJAX (without YDAjax) </a></td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=ajax.php">ajax.php</a>
                 <br/>



From ximian at mail.berlios.de  Fri Aug 11 15:31:14 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 15:31:14 +0200
Subject: [ydf-devel] r1997 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608111331.k7BDVEGN001231@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 15:30:46 +0200 (Fri, 11 Aug 2006)
New Revision: 1997

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
setdefaults on customValues argument of YDForm::validate seems to reset values (and it should not)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-11 08:44:41 UTC (rev 1996)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-11 13:30:46 UTC (rev 1997)
@@ -846,9 +846,6 @@
 
                         // Set the value
                         $this->_elements[ $key ]->setValue( $value );
-                    
-                        // Set the default value
-                        $this->setDefault( $key, $value );
                     }
                 }
             }



From ximian at mail.berlios.de  Fri Aug 11 15:39:11 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 15:39:11 +0200
Subject: [ydf-devel] r1998 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608111339.k7BDdBRn003822@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 15:38:51 +0200 (Fri, 11 Aug 2006)
New Revision: 1998

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
new feature: on YDDatabaseTree::getDescendants it's possible to return a non-associative array with a specific field

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-08-11 13:30:46 UTC (rev 1997)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-08-11 13:38:51 UTC (rev 1998)
@@ -233,10 +233,11 @@
          *                          data.
          *  @param $max_level       (optional) Maximum level to retrieve. Default is all.
          *  @param $order           (optional) The order of the records to return.
+         *  @param $specificPart    (optional) Return array should be not-associative (using a specific key to filter)
          *
          *  @returns The descendants of the passed now
          */
-        function getDescendants( $id=0, $includeSelf=false, $childrenOnly=false, $max_level=null, $order=null ) {
+        function getDescendants( $id=0, $includeSelf=false, $childrenOnly=false, $max_level=null, $order=null, $specificPart=null ) {
 
             // Get the ID field
             $idField = $this->fields['id'];
@@ -313,6 +314,17 @@
                 $arr[ $record[$idField] ] = $this->_fromNodeArray( $record );
             }
 
+            // check if we want a specific column
+            if ( !is_null( $specificPart ) ){
+
+                // init temporary array
+                $nodes = array();
+                foreach ( $arr as $node )
+                    array_push( $nodes, $node[ $specificPart ] );
+
+                return $nodes;
+            }
+
             // Return the result
             return $arr;
 
@@ -758,9 +770,10 @@
         /**
          *  Delete the node and it's children.
          *
-         *  @param $id  The ID of the node to delete.
+         *  @param $id             The ID of the node to delete.
+         *  @param $includeParent  (Optional) Delete id and all children (true by default. if false, deletes children only)
          */
-        function deleteNode( $id ) {
+        function deleteNode( $id, $includeParent = true ) {
 
             // Clear the cache
             $this->_clearCache();
@@ -773,18 +786,9 @@
                 return;
             }
 
-            // Get the children of the node
-            $children = $this->getDescendants( $id );
-
             // Get the list of IDs to delete
-            $nodes_to_delete = array();
-            foreach ( $children as $child ) {
-                array_push( $nodes_to_delete, $child[ $this->fields['id'] ] );
-            }
+			$nodes_to_delete = $this->getDescendants( $id, $includeParent, false, null, null, $this->fields['id'] );
 
-            // Add the current node
-            array_push( $nodes_to_delete, $id  );
-
             // Check if there is something to delete
             if ( sizeof( $nodes_to_delete ) > 0 ) {
 



From ximian at mail.berlios.de  Fri Aug 11 15:41:21 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 15:41:21 +0200
Subject: [ydf-devel] r1999 - in
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent: .
	languages/YDCMUsers
Message-ID: <200608111341.k7BDfLwU004364@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 15:40:56 +0200 (Fri, 11 Aug 2006)
New Revision: 1999

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
Log:
on YDCM user management it's possible to delete a user and all permissions associated with

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-11 13:38:51 UTC (rev 1998)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-11 13:40:56 UTC (rev 1999)
@@ -78,6 +78,22 @@
 
 
         /**
+         *  This function return an array of permissions
+         *
+         *  @param     $user_id   User id (or Array of ids ) to delete
+         */
+		function deletePermissions( $user_id ){
+
+			if ( !is_array( $user_id ) ) $user_id = array( $user_id );
+
+			$this->resetValues();
+			$this->where( 'user_id IN ("' . implode( '","', $user_id ) . '")' );
+
+			return $this->delete();
+		}
+
+
+        /**
          *  This function assigns an array of permissions to a user
          *
          *  @param     $user_id     User id to get permissions

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-11 13:38:51 UTC (rev 1998)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-11 13:40:56 UTC (rev 1999)
@@ -308,8 +308,28 @@
 			return false;
 		}
 
+
+        /**
+         *  This function deletes a user (and all children) or just the children
+         *
+         *  @param $user_id        User id
+         *  @param $includeParent  (Optional) Delete user id and children (false means delete children only)
+         *
+         *  @returns    true if updated, array with form errors otherwise
+         */
+		function deleteUser( $user_id, $includeParent = true ){
 		
+			// get ids to delete
+			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
 
+			// delete all permissions of this users
+			$this->perm->deletePermissions( $ids );
+
+			// delete node from users table
+			$this->tree->deleteNode( $user_id, $includeParent );
+		}
+
+
         /**
          *  This function adds form elements for user detail management
 		 *

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-11 13:38:51 UTC (rev 1998)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-11 13:40:56 UTC (rev 1999)
@@ -46,5 +46,7 @@
 $GLOBALS['t']['user details updated'] = 'User details updated';
 $GLOBALS['t']['password not updated'] = 'Password was not updated';
 $GLOBALS['t']['user not updated'] = 'User was not updated';
+$GLOBALS['t']['administrator and children'] = 'Administrator and children';
+$GLOBALS['t']['children only'] = 'Children only';
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-11 13:38:51 UTC (rev 1998)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-11 13:40:56 UTC (rev 1999)
@@ -46,5 +46,8 @@
 $GLOBALS['t']['user details updated'] = 'Informa&ccedil;&otilde;es do utilizador actualizadas';
 $GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
 $GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
+$GLOBALS['t']['administrator and children'] = 'Administrador e sub-administratores';
+$GLOBALS['t']['children only'] = 'Apenas sub-administratores';
 
+
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Fri Aug 11 18:21:17 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 18:21:17 +0200
Subject: [ydf-devel] r2000 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608111621.k7BGLHTf031373@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 18:21:05 +0200 (Fri, 11 Aug 2006)
New Revision: 2000

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
added setdefault again on validation with custom values 
(but with a timestamp test in YDStringUtil::formatDate to test date elements)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-11 13:40:56 UTC (rev 1999)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-11 16:21:05 UTC (rev 2000)
@@ -846,6 +846,7 @@
 
                         // Set the value
                         $this->_elements[ $key ]->setValue( $value );
+						$this->setDefault( $key, $value );
                     }
                 }
             }

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-11 13:40:56 UTC (rev 1999)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-11 16:21:05 UTC (rev 2000)
@@ -549,6 +549,9 @@
 
             // If array, is a date YDForm element value
             if ( is_array( $timestamp ) ) {
+			
+				// check if timestamp exists. otherwise create it
+				if ( !isset( $timestamp[ 'timestamp' ] ) ) $timestamp[ 'timestamp' ] = mktime( $timestamp['hours'], $timestamp['minutes'], $timestamp['seconds'], $timestamp['month'], $timestamp['day'], $timestamp['year'] );
                 $timestamp = $timestamp[ 'timestamp' ];
             }
 



From ximian at mail.berlios.de  Fri Aug 11 18:22:30 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 11 Aug 2006 18:22:30 +0200
Subject: [ydf-devel] r2001 - in
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent: .
	languages
Message-ID: <200608111622.k7BGMUGB031443@sheep.berlios.de>

Author: ximian
Date: 2006-08-11 18:22:15 +0200 (Fri, 11 Aug 2006)
New Revision: 2001

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
Log:
- YDCMUser management has a mode modular form construction
- new generic translation strings added

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-11 16:21:05 UTC (rev 2000)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-11 16:22:15 UTC (rev 2001)
@@ -62,18 +62,37 @@
         /**
          *  This function return an array of permissions
          *
-         *  @param     $user_id   User id to get permissions
+         *  @param     $user_id    User id to get permissions
+         *  @param     $translate  (Optional) Translate permissions
 		 *
          *  @returns    An array with all permission groupby object
          */
-		function getPermissions( $user_id ){
+		function getPermissions( $user_id, $translate = false ){
 		
 			$this->resetValues();
 			$this->user_id = intval( $user_id );
 			$this->orderby( 'object DESC, object_action DESC' );
 			$this->find();
 
-			return $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );
+			$permissions = $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );
+			
+			if ( !$translate ) return $permissions;
+
+			$arr_translated = array();
+
+			// cycle objects and compute translated actions
+			foreach( $permissions as $obj => $perms ){
+
+				// get permission translations of this component
+				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
+
+				if (!isset( $arr_translated[ $obj ] ) ) $arr_translated[] = $obj;
+
+				foreach( $perms as $p )
+					$arr_translated[ $obj ][] = t( $p );
+			}
+			
+			return $arr_translated;
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-11 16:21:05 UTC (rev 2000)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-11 16:22:15 UTC (rev 2001)
@@ -250,7 +250,7 @@
 
 			// get form values
 			$values = $this->form->getValues();
-
+//return array_reverse( $values );
 			// we need parent fot setting user permissions
 			$details = $this->getUser( $id );
 
@@ -339,10 +339,13 @@
 		 * @param $password     (Optional) Flag that defines if we want to include the password box
 		 *                                 TRUE: include password box; FALSE: don't include
 		 * 
-		 * @param $logindetails (Optional) Flag that defines if we login details are editable (eg: login schedule dates)
+		 * @param $logindetails (Optional) Flag that defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are just information
+		 * 
+		 * @param $userdetails  (Optional) Flag that defines if user details are editable (eg: name, email, other info, template, language)
 		 *                                 TRUE: user details are editable; FALSE: user details are just information
          */
-		function addFormDetails( $username = false, $password = false, $logindetails = false ){
+		function addFormDetails( $username = false, $password = false, $logindetails = false, $userdetails = true ){
 
 			// add username
 			if ( $username ) $this->form->addElement( 'text', 'username', t('user_username') );
@@ -351,29 +354,7 @@
 			// add password
 			if ( $password ) $this->form->addElement( 'password', 'password', t('user_password') );
 
-			// add name
-            $this->form->addElement( 'text',      'name',         t('user_name'),     array('size' => 50, 'maxlength' => 255) );
-			$this->form->addRule(    'name',      'maxlength',    t('name too big'),  255 );
-
-			// add email
-            $this->form->addElement( 'text',      'email',        t('user_email') );
-			$this->form->addRule(    'email',     'email',        t('email not valid') );
-
-			// add other info textare
-            $this->form->addElement( 'textarea',  'other',        t('user_other'),    array('rows' => 4, 'cols' => 30) );
-			$this->form->addRule(    'other',     'maxlength',    t('other too big'), 5000 );
-
-			// add languages select box
-			$languages = YDCMComponent::module( 'YDCMLanguages' );
-			$this->form->addElement( 'select',      'language_id',  t('user_language'),      array(), $languages->active() );
-			$this->form->addRule(    'language_id', 'in_array',     t('language not valid'), array_keys( $languages->active() ) );
-
-			// add template select box
-			$templates = YDCMComponent::module( 'YDCMTemplates' );
-            $this->form->addElement( 'select',    'template',     t('user_template'),      array(), $templates->admin_templates() );
-			$this->form->addRule(    'template',  'in_array',     t('template not valid'), array_keys( $templates->admin_templates() ) );
-
-			// add user details
+			// add login details
 			if ( $logindetails ){
 				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
 				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
@@ -384,6 +365,32 @@
 				$this->form->addElement( 'span',           'login_end',   t('login_end') );
 			}
 
+			// add common user details
+            if ( $userdetails ){
+				$this->form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
+				$this->form->addElement( 'text',      'email',         t('user_email') );
+				$this->form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
+
+				$languages = YDCMComponent::module( 'YDCMLanguages' );
+				$this->form->addElement( 'select',      'language_id', t('user_language'),      array(), $languages->active() );
+
+				$templates = YDCMComponent::module( 'YDCMTemplates' );
+    	        $this->form->addElement( 'select',    'template',      t('user_template'),      array(), $templates->admin_templates() );
+
+				$this->form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
+				$this->form->addRule( 'email',       'email',          t('email not valid') );
+				$this->form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
+				$this->form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages->active() ) );
+				$this->form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
+
+			}else{
+				$this->form->addElement( 'span',      'name',          t('user_name') );
+				$this->form->addElement( 'span',      'email',         t('user_email') );
+				$this->form->addElement( 'span',      'other',         t('user_other') );
+				$this->form->addElement( 'span',      'language_id',   t('user_language') );
+				$this->form->addElement( 'span',      'template',      t('user_template') );
+			}
+
 			$this->form->addElement( 'span', 'login_counter', t('login_counter') );
             $this->form->addElement( 'span', 'login_last',    t('login_last') );
             $this->form->addElement( 'span', 'login_current', t('login_current') );
@@ -584,17 +591,17 @@
         /**
          *  This function returns user attributes
          *
-         *  @param      $id          User id to use (instead of internal)
+         *  @param      $user_id     User id to use (instead of internal)
          *  @param      $translate   (Optional) Boolean that defines if result must be translated
          *
          *  @returns    User details
          */
-		function getUser( $id, $translate = false ){
+		function getUser( $user_id, $translate = false ){
 
 			$this->resetValues();
 
 			// set user id
-			$this->user_id = intval( $id );
+			$this->user_id = intval( $user_id );
 
 			// get all attributes
 			if ( $this->find() != 1 ) return false;
@@ -611,6 +618,10 @@
 					$this->login_end   = t('not applicable');
 				}
 
+				if ( $this->state == 0 )      $this->state = t('blocked');
+				else if ( $this->state == 1 ) $this->state = t('active');
+				else                          $this->state = t('schedule');
+
 				// check if user is root
 				if ( $this->created_user == 0 ){
 					$this->created_user = t('not applicable');
@@ -618,8 +629,11 @@
 				}
 			}
 
-			// return values
-			return $this->getValues();
+			// add permissions
+			$values = $this->getValues();
+			$values[ 'permissions' ] = $this->getPermissions( intval( $user_id ) );
+			
+			return $values;
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-08-11 16:21:05 UTC (rev 2000)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/en.php	2006-08-11 16:22:15 UTC (rev 2001)
@@ -14,7 +14,10 @@
 $GLOBALS['t']['not applicable'] = 'Not applicable';
 $GLOBALS['t']['yes'] = 'Yes';
 $GLOBALS['t']['no'] = 'No';
+$GLOBALS['t']['active'] = 'Active';
+$GLOBALS['t']['blocked'] = 'Blocked';
 $GLOBALS['t']['schedule'] = 'Schedule';
+$GLOBALS['t']['permissions'] = 'Permissions';
 $GLOBALS['t']['delete'] = 'Delete';
 $GLOBALS['t']['toggle state'] = 'Toggle state';
 $GLOBALS['t']['public'] = 'Public';

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-08-11 16:21:05 UTC (rev 2000)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/pt.php	2006-08-11 16:22:15 UTC (rev 2001)
@@ -14,7 +14,10 @@
 $GLOBALS['t']['not applicable'] = 'N&atilde;o aplic&aacute;vel';
 $GLOBALS['t']['yes'] = 'Sim';
 $GLOBALS['t']['no'] = 'N&atilde;o';
+$GLOBALS['t']['active'] = 'Activo';
+$GLOBALS['t']['blocked'] = 'Bloqueado';
 $GLOBALS['t']['schedule'] = 'Calend&aacute;rio';
+$GLOBALS['t']['permissions'] = 'Permiss&otilde;es';
 $GLOBALS['t']['delete'] = 'Eliminar';
 $GLOBALS['t']['toggle state'] = 'Inverter estado';
 $GLOBALS['t']['public'] = 'P&uacute;blico';



From pclaerhout at mail.berlios.de  Sun Aug 13 12:23:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 13 Aug 2006 12:23:23 +0200
Subject: [ydf-devel] r2002 - in YDFramework2.0/trunk/examples/weblog: .
	include include/languages manage skins/default
	skins/default_with_lightbox
Message-ID: <200608131023.k7DANN6d014635@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-13 12:23:21 +0200 (Sun, 13 Aug 2006)
New Revision: 2002

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/install.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
   YDFramework2.0/trunk/examples/weblog/manage/users.php
   YDFramework2.0/trunk/examples/weblog/manage/users.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Made a lot of changes to the weblog application:
- Drafts are no longer visible in te RSS feeds
- Cleaned up the admin interface a bit
- The email address for a user account is now a required field
- The new item email now indicates if we are talking about a draft or not.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -406,13 +406,16 @@
         }
 
         // Get the comments for an item
-        function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1 ) {
+        function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1, $public_only=false ) {
             if ( $item_id ) {
-                $sql = $this->_prepareQuery( 'SELECT * FROM #_comments WHERE item_id = ' . $this->str( $item_id ), $order );
+                $query = 'SELECT * FROM #_comments WHERE item_id = ' . $this->str( $item_id );
             } else {
-                $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id', $order );
+                $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
+                if ( $public_only == true ) {
+                    $query .= ' and i.is_draft = 0';
+                }
             }
-            $records = $this->db->getRecords( $sql, $limit, $offset );
+            $records = $this->db->getRecords( $this->_prepareQuery( $query, $order ), $limit, $offset );
             foreach ( $records as $key=>$record ) {
                 $records[$key]['comment'] = trim( strip_tags( $record['comment'] ) );
             }

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -306,6 +306,8 @@
     $GLOBALS['t']['auto_close_item'] .= 'after ' . YDConfig::get( 'auto_close_items', '' ) . ' days';
 }
 $GLOBALS['t']['is_draft'] = 'Draft (do not publish)';
+$GLOBALS['t']['draft'] = 'draft';
+$GLOBALS['t']['closed'] = 'closed';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'No images yet';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -307,6 +307,8 @@
     $GLOBALS['t']['auto_close_item'] .= 'apr&egrave;s ' . YDConfig::get( 'auto_close_items', '' ) . ' jours';
 }
 $GLOBALS['t']['is_draft'] = 'Brouillon (ne pas publier)';
+$GLOBALS['t']['draft'] = 'brouillon';
+$GLOBALS['t']['closed'] = 'ferm&eacte;';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Aucune image actuellement';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -306,6 +306,8 @@
     $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
 }
 $GLOBALS['t']['is_draft'] = 'Concept (niet publiceren)';
+$GLOBALS['t']['draft'] = 'concept';
+$GLOBALS['t']['closed'] = 'gesloten';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';

Modified: YDFramework2.0/trunk/examples/weblog/install.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/install.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/install.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -94,6 +94,7 @@
             $form->addRule( 'db_user', 'required', 'Database user is required' );
             $form->addRule( 'weblog_title', 'required', 'Weblog title is required' );
             $form->addRule( 'name', 'required', 'User name is required' );
+            $form->addRule( 'email', 'required', 'User email is required' );
             $form->addRule( 'email', 'email', 'User email is required' );
             $form->addRule( 'password', 'required', 'Password is required' );
             $form->addFormRule( array( & $this, 'checkInstallParams' ) );
@@ -105,6 +106,7 @@
             $form->setDefault( 'db_prefix', 'ydw_' );
             $form->setDefault( 'weblog_title', 'My Weblog' );
             $form->setDefault( 'weblog_description', 'Description of my Weblog' );
+            $form->setDefault( 'weblog_language', 'en' );
 
             // Process the form
             if ( $form->validate() === true ) {

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -73,15 +73,29 @@
         <tr>
             <th class="adminRowL" width="17%">{t w="date"}</th>
             <th class="adminRowL" width="15%">{t w="author"}</th>
-            <th class="adminRowL" width="30%">{t w="parent"}</th>
+            <th class="adminRowL" width="30%">{t w="comment"}</th>
             <th class="adminRowR" width="18%">{t w="actions"}</th>
         </tr>
         {$browsebar}
         {foreach from=$comments->set item="comment"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$comment.created|date:'%Y/%m/%d %H:%M'}</td>
-                <td class="adminRowL">{$comment.username}</td>
-                <td class="adminRowL">{$comment.comment|bbcode|strip_tags|truncate}</td>
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
+                <td class="adminRowL">
+                    {if $comment.item_is_draft eq '1'}<i>{/if}
+                    {$comment.created|date:'%Y/%m/%d %H:%M'}
+                    {if $comment.item_is_draft eq '1'}</i>{/if}
+                </td>
+                <td class="adminRowL">
+                    {if $comment.item_is_draft eq '1'}<i>{/if}
+                    {$comment.username}
+                    {if $comment.item_is_draft eq '1'}</i>{/if}
+                </td>
+                <td class="adminRowL">
+                    {if $comment.item_is_draft eq '1'}<i>{/if}
+                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
+                    <br/>
+                    {t w="item"}: {$comment.item_title}
+                    {if $comment.item_is_draft eq '1'}</i>{/if}
+                </td>
                 <td class="adminRowR">
                     <a href="../item.php?id={$comment.item_id}#comment-{$comment.id}" target="_blank">{t w="view"}</a>
                     |

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -13,67 +13,82 @@
     </tr>
     <tr>
         <th class="adminRowL" width="17%">{t w="date"}</th>
-        <th class="adminRowL" width="15%">{t w="name"}</th>
+        <th class="adminRowL" width="15%">{t w="author"}</th>
         <th class="adminRowL" width="26%">{t w="title"}</th>
         <th class="adminRowR" width="22%">{t w="actions"}</th>
     </tr>
-    {$browsebar}
     {foreach from=$items item="item"}
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $item.is_draft eq '1'}style="color: gray"{/if}>
             <td class="adminRowL">
-                {if $item.is_draft eq '1'}<i>{/if}{$item.created|date:'%Y/%m/%d %H:%M'}{if $item.is_draft eq '1'}</i>{/if}
+                {if $item.is_draft eq '1'}<i>{/if}
+                {$item.created|date:'%Y/%m/%d %H:%M'}
+                {if $item.is_draft eq '1'}</i>{/if}
             </td>
             <td class="adminRowL">
-                {if $item.is_draft eq '1'}<i>{/if}{$item.user_name}{if $item.is_draft eq '1'}</i>{/if}
+                {if $item.is_draft eq '1'}<i>{/if}
+                {$item.user_name}
+                {if $item.is_draft eq '1'}</i>{/if}
             </td>
             <td class="adminRowL">
-                {if $item.is_draft eq '1'}<i>{/if}{if $item.allow_comments eq '0'}[x] {/if}{$item.title}{if $item.is_draft eq '1'}</i>{/if}
+                {if $item.is_draft eq '1'}<i>{/if}
+                <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{$item.title}</a>
+                <br/>
+                {if $item.allow_comments eq '0'}
+                    {t w="closed"}{if $item.is_draft eq '1'}, {/if}
+                {/if}
+                {if $item.is_draft eq '1'}{t w="draft"}{/if}
+                {if $item.is_draft eq '1'}</i>{/if}
             </td>
             <td class="adminRowR">
                 <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                 |
-                <a href="items.php?do=edit&id={$item.id}">{t w="edit"}</a>
+                <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{t w="edit"}</a>
                 |
+                <a href="{$YD_SELF_SCRIPT}?do=delete&id={$item.id}"
+                 onClick="return YDConfirmDelete( '{$item.title|addslashes}' );">{t w="delete"}</a>
+                <br/>
+                <a href="comments.php?id={$item.id}">{if $item.num_comments > 0}{$item|@text_num_comments:false}{else}<span class="disabled">0 {t w="comments" lower=true}</span>{/if}</a> |
                 <a href="items_gallery.php?id={$item.id}">{if $item.num_images > 0}{$item|@text_num_images:false}{else}<span class="disabled">0 {t w="images" lower=true}</span>{/if}</a>
             </td>
         </tr>
     {/foreach}
-    {$browsebar}
     </table>
 {/if}
 
 <p class="title">&nbsp;<br/>{t w="a_admin_home"} &raquo; {t w="overview"}</p>
 
 <table width="700" cellspacing="0" cellpadding="0" border="0">
-    <tr>
-        <th class="adminRowLG">&raquo; <a href="serverinfo.php"><b>{t w="a_server_info"}</b></a></th>
-        <th class="adminRowLGR" colspan="2"><a href="serverinfo.php"><img src="images/more_details.gif" border="0" /></a></th>
-    </tr>
-    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-        <td class="adminRowL" width="300">{t w="username"}</td>
-        <td class="adminRowL" width="400" colspan="2">{$user.name|lower}</td>
-    </tr>
-    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-        <td class="adminRowL">{t w="server"}</td>
-        <td class="adminRowL" colspan="2">{$smarty.server.SERVER_NAME}{if $smarty.server.SERVER_PORT != '80'}:{$smarty.server.SERVER_PORT}{/if}</td>
-    </tr>
-    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-        <td class="adminRowL">{t w="installed_version"}</td>
-        <td class="adminRowL">{$YD_FW_REVISION}</td>
-        <td class="adminRowR" style="padding-right: 2px;"><a href="versioninfo.php"><img src="images/more_details.gif" border="0" /></a></td>
-    </tr>
-</table>
+<tr><td width="350" align="left" valign="top">
 
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr><td colspan="3">&nbsp;</td></tr>
+    <table width="340" cellspacing="0" cellpadding="0" border="0">
         <tr>
-            <th class="adminRowLG">&raquo; <a href="stats.php"><b>{t w="a_statistics"}</b></a></th>
-            <th class="adminRowLGR"><a href="stats.php"><img src="images/more_details.gif" border="0" /></a></th>
+            <th class="adminRowLG">&raquo; <a href="serverinfo.php"><b>{t w="a_server_info"}</b></a></th>
+            <th class="adminRowLGR" colspan="2"><a href="serverinfo.php"><img src="images/more_details.gif" border="0" /></a></th>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="username"}</td>
+            <td class="adminRowL" width="400" colspan="2">{$user.name|lower}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="server"}</td>
+            <td class="adminRowL" colspan="2">{$smarty.server.SERVER_NAME}{if $smarty.server.SERVER_PORT != '80'}:{$smarty.server.SERVER_PORT}{/if}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="installed_version"}</td>
+            <td class="adminRowL" colspan="2">{$YD_FW_REVISION}</td>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL" width="300">{t w="installed_since"}</td>
             <td class="adminRowL" width="400" colspan="2">{$installDate|date:"%d %B %Y"|lower}</td>
         </tr>
+    </table>
+</td>
+<td width="350" align="right" valign="top">
+    <table width="340" cellspacing="0" cellpadding="0" border="0">
+        <tr>
+            <th class="adminRowLG">&raquo; <a href="stats.php"><b>{t w="a_statistics"}</b></a></th>
+            <th class="adminRowLGR"><a href="stats.php"><img src="images/more_details.gif" border="0" /></a></th>
+        </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="num_days_online"}</td>
             <td class="adminRowL" colspan="2">{$daysOnline} {t w="days"}</td>
@@ -97,5 +112,7 @@
             </tr>
         {/if}
     </table>
+</td></tr>
+</table>
 
 {include file="__mng_footer.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -149,7 +149,11 @@
                         foreach ( $subscribers as $subscriber ) {
                             $eml->addBcc( $subscriber['email'], $subscriber['name'] );
                         }
-                        $eml->setSubject( t('new_item') . ': ' . strip_tags( $values['title'] ) );
+                        if ( $values['is_draft'] ) {
+                            $eml->setSubject( t('new_item') . ' (' . t('draft') . '): ' . strip_tags( $values['title'] ) );
+                        } else {
+                            $eml->setSubject( t('new_item') . ': ' . strip_tags( $values['title'] ) );
+                        }
                         $eml->setHtmlBody( $this->fetch( dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/item_email.tpl' ) );
                         $eml->send();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -66,15 +66,26 @@
         </tr>
         {$browsebar}
         {foreach from=$items->set item="item"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $item.is_draft eq '1'}style="color: gray"{/if}>
                 <td class="adminRowL">
-                    {if $item.is_draft eq '1'}<i>{/if}{$item.created|date:'%Y/%m/%d %H:%M'}{if $item.is_draft eq '1'}</i>{/if}
+                    {if $item.is_draft eq '1'}<i>{/if}
+                    {$item.created|date:'%Y/%m/%d %H:%M'}
+                    {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowL">
-                    {if $item.is_draft eq '1'}<i>{/if}{$item.user_name}{if $item.is_draft eq '1'}</i>{/if}
+                    {if $item.is_draft eq '1'}<i>{/if}
+                    {$item.user_name}
+                    {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowL">
-                    {if $item.is_draft eq '1'}<i>{/if}{if $item.allow_comments eq '0'}[x] {/if}{$item.title}{if $item.is_draft eq '1'}</i>{/if}
+                    {if $item.is_draft eq '1'}<i>{/if}
+                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{$item.title}</a>
+                    <br/>
+                    {if $item.allow_comments eq '0'}
+                        {t w="closed"}{if $item.is_draft eq '1'}, {/if}
+                    {/if}
+                    {if $item.is_draft eq '1'}{t w="draft"}{/if}
+                    {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">
                     <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -65,15 +65,22 @@
             <th class="adminRowR" width="18%">{t w="actions"}</th>
         </tr>
         {foreach from=$pages->set item="page"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $page.is_draft eq '1'}style="color: gray"{/if}>
                 <td class="adminRowL">
-                    {if $page.is_draft eq '1'}<i>{/if}{$page.created|date:'%Y/%m/%d %H:%M'}{if $page.is_draft eq '1'}</i>{/if}
+                    {if $page.is_draft eq '1'}<i>{/if}
+                    {$page.created|date:'%Y/%m/%d %H:%M'}
+                    {if $page.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowL">
-                    {if $page.is_draft eq '1'}<i>{/if}{$page.user_name}{if $page.is_draft eq '1'}</i>{/if}
+                    {if $page.is_draft eq '1'}<i>{/if}
+                    {$page.user_name}
+                    {if $page.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowL">
-                    {if $page.is_draft eq '1'}<i>{/if}{$page.title}{if $page.is_draft eq '1'}</i>{/if}
+                    {if $page.is_draft eq '1'}<i>{/if}
+                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$page.id}">{$page.title}</a>
+                    {if $page.is_draft eq '1'}<br/>{t w="draft"}{/if}
+                    {if $page.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">
                     <a href="../page.php?id={$page.id}" target="_blank">{t w="view"}</a>

Modified: YDFramework2.0/trunk/examples/weblog/manage/users.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/users.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/users.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -53,6 +53,7 @@
             $form->addFilters( array( 'name', 'email' ), 'strip_html' );
 
             // Add the rules
+            $form->addRule( 'email', 'required', t('req_useremail') );
             $form->addRule( 'email', 'email', t('req_useremail') );
             if ( $id == '-1' ) {
                 $form->addRule( 'name', 'required', t('err_username') );

Modified: YDFramework2.0/trunk/examples/weblog/manage/users.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/users.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/manage/users.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -71,7 +71,7 @@
             </tr>
             <tr>
                 <td class="adminRowL" width="300">{$form.name.label_html}</td>
-                <td class="adminRowC" width="400">
+                <td class="adminRowL" width="400">
                     {if $user_data}
                         <b>{$user_data.name}</b>
                     {else}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -28,7 +28,7 @@
 
         <div id="content" class="narrowcolumn">
 
-            <h3>{t w="new_item"}: {$item.title}</h3>
+            <h3>{t w="new_item"}{if $item.is_draft} ({t w="draft"}){/if}: {$item.title}</h3>
 
             <p>
                 <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl	2006-08-13 10:23:21 UTC (rev 2002)
@@ -28,7 +28,7 @@
 
         <div id="content" class="narrowcolumn">
 
-            <h3>{t w="new_item"}: {$item.title}</h3>
+            <h3>{t w="new_item"}{if $item.is_draft} ({t w="draft"}){/if}: {$item.title}</h3>
 
             <p>
                 <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-11 16:22:15 UTC (rev 2001)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-13 10:23:21 UTC (rev 2002)
@@ -68,7 +68,7 @@
         function initMainFeed() {
 
             // Get the weblog items
-            $items = $this->weblog->getItems( YDConfig::get( 'max_syndicated_items', 15 ) );
+            $items = $this->weblog->getPublicItems( YDConfig::get( 'max_syndicated_items', 15 ) );
             $items = array_reverse( $items );
 
             // Initialize the feed
@@ -93,7 +93,10 @@
                 }
 
                 // Add it to the feed
-                $this->feed->addItem( $item['title'], YDTplModLinkItem( $item ), YDTemplate_modifier_bbcode( $body ) );
+                $this->feed->addItem(
+                    $item['title'], YDTplModLinkItem( $item ),
+                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $item )
+                );
 
             }
 
@@ -103,7 +106,7 @@
         function initCommentsFeed() {
 
             // Get the weblog items
-            $comments = $this->weblog->getComments( null, 'CREATED DESC', YDConfig::get( 'max_syndicated_items', 15 ) );
+            $comments = $this->weblog->getComments( null, 'CREATED DESC', YDConfig::get( 'max_syndicated_items', 15 ), -1, true );
 
             // Initialize the feed
             $this->feed = new YDFeedCreator();
@@ -115,7 +118,8 @@
             foreach ( $comments as $comment ) {
                 $body = $comment['comment'] . "\n\n" . t('by') . ' ' . $comment['username'];
                 $this->feed->addItem(
-                    $comment['item_title'], YDTplModLinkItem( $comment['item_id'], '#comment' ), YDTemplate_modifier_bbcode( $body )
+                    $comment['item_title'], YDTplModLinkItem( $comment['item_id'], '#comment' ),
+                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $comment['item_id'], '#comment' )
                 );
             }
 
@@ -125,7 +129,7 @@
         function initGalleryFeed() {
 
             // Get the weblog items
-            $items = $this->weblog->getItems();
+            $items = $this->weblog->getPublicItems();
 
             // Initialize the feed
             $this->feed = new YDFeedCreator();
@@ -140,7 +144,10 @@
                     foreach ( $item['images'] as $image ) {
                         $body .= '<img src="' . YDTplModLinkThumb( $image ) . '"/> ';
                     }
-                    $this->feed->addItem( $item['title'], YDTplModLinkItemGallery( $item ), YDTemplate_modifier_bbcode( $body ) );
+                    $this->feed->addItem(
+                        $item['title'], YDTplModLinkItemGallery( $item ),
+                        YDTemplate_modifier_bbcode( $body ), YDTplModLinkItemGallery( $item )
+                    );
                 }
             }
 



From pclaerhout at mail.berlios.de  Sun Aug 13 12:52:48 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 13 Aug 2006 12:52:48 +0200
Subject: [ydf-devel] r2003 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDFeedCreator examples/weblog
Message-ID: <200608131052.k7DAqmPB023262@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-13 12:52:46 +0200 (Sun, 13 Aug 2006)
New Revision: 2003

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Added support for the RSS comments tags.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-08-13 10:23:21 UTC (rev 2002)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-08-13 10:52:46 UTC (rev 2003)
@@ -103,6 +103,15 @@
         }
 
         /**
+         *  Function to set the generator of the feed
+         *
+         *  @param $generator   The name of the application that generates the feed.
+         */
+        function setGenerator( $generator ) {
+            $this->_generator = $generator;
+        }
+
+        /**
          *	This function will add a new item to the feed. You need to at least give in a title, link. A description is
          *	advised but optional. Also a GUID is optional. If no GUID is given, an automatic one will be created which
          *	is the md5 checksum of the different elememts.
@@ -118,7 +127,7 @@
          *  @remark
          *      Enclosures are only supported for ATOM and RSS 2.0 feeds.
          */
-        function addItem( $title, $link, $desc=null, $guid=null, $enclosure=null, $enclosure_size=null, $enclosure_type=null ) {
+        function addItem( $title, $link, $desc=null, $guid=null, $enclosure=null, $enclosure_size=null, $enclosure_type=null, $commentlink=null ) {
 
             $link = YDUrl::makeLinkAbsolute( $link, $this->_link );
             $desc = YDUrl::makeLinksAbsolute( $desc, $this->_link );
@@ -137,7 +146,7 @@
                 'title' => YDStringUtil::encodeString( $title ), 'link' => $link,
                 'description' => $desc, 'guid' => $guid,
                 'enclosure' => $enclosure, 'enclosure_size' => $enclosure_size,
-                'enclosure_type' => $enclosure_type
+                'enclosure_type' => $enclosure_type, 'comments' => $commentlink
             );
 
             $this->_items[ $guid ] = $item;
@@ -209,7 +218,11 @@
                     $item['link'][0]['#'] = $arr['link'];
                     $item['guid'][0]['#'] = $arr['guid'];
                     $item['guid'][0]['@']['isPermanlink'] = 'false';
-                    
+
+                    if ( ! is_null( $arr['comments'] ) ) {
+                        $item['comments'] = $arr['comments'];
+                    }
+
                     if ( ! empty( $arr['description'] ) ) {
                         $item['description'] = $arr['description'];
                     }
@@ -222,7 +235,7 @@
                         
                     }
                     $i++;
-                    
+
                 }
                 
             }

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-13 10:23:21 UTC (rev 2002)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-13 10:52:46 UTC (rev 2003)
@@ -76,6 +76,7 @@
             $this->feed->setTitle( YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
             $this->feed->setDescription( YDConfig::get( 'weblog_description', 'Untitled Weblog Description' ) );
             $this->feed->setLink( YDUrl::makeLinkAbsolute( 'index.php' ) );
+            $this->feed->setGenerator( YD_FW_NAMEVERS );
 
             // Add the items
             foreach ( $items as $item ) {
@@ -95,7 +96,8 @@
                 // Add it to the feed
                 $this->feed->addItem(
                     $item['title'], YDTplModLinkItem( $item ),
-                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $item )
+                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $item ),
+                    null, null, null, YDTplModLinkItem( $item ) . '#comments'
                 );
 
             }



From pclaerhout at mail.berlios.de  Sun Aug 13 13:34:10 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 13 Aug 2006 13:34:10 +0200
Subject: [ydf-devel] r2004 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608131134.k7DBYA1T027419@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-13 13:33:58 +0200 (Sun, 13 Aug 2006)
New Revision: 2004

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
Log:
Fixed the links in the admin index screen.

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-13 10:52:46 UTC (rev 2003)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-13 11:33:58 UTC (rev 2004)
@@ -31,7 +31,7 @@
             </td>
             <td class="adminRowL">
                 {if $item.is_draft eq '1'}<i>{/if}
-                <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{$item.title}</a>
+                <a href="items.php?do=edit&id={$item.id}">{$item.title}</a>
                 <br/>
                 {if $item.allow_comments eq '0'}
                     {t w="closed"}{if $item.is_draft eq '1'}, {/if}
@@ -42,9 +42,9 @@
             <td class="adminRowR">
                 <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
                 |
-                <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{t w="edit"}</a>
+                <a href="items.php?do=edit&id={$item.id}">{t w="edit"}</a>
                 |
-                <a href="{$YD_SELF_SCRIPT}?do=delete&id={$item.id}"
+                <a href="items.php?do=delete&id={$item.id}"
                  onClick="return YDConfirmDelete( '{$item.title|addslashes}' );">{t w="delete"}</a>
                 <br/>
                 <a href="comments.php?id={$item.id}">{if $item.num_comments > 0}{$item|@text_num_comments:false}{else}<span class="disabled">0 {t w="comments" lower=true}</span>{/if}</a> |



From pclaerhout at mail.berlios.de  Mon Aug 14 08:01:44 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 08:01:44 +0200
Subject: [ydf-devel] r2005 - YDFramework2.0/trunk/examples
Message-ID: <200608140601.k7E61iqh014340@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 08:01:28 +0200 (Mon, 14 Aug 2006)
New Revision: 2005

Modified:
   YDFramework2.0/trunk/examples/ajax.php
Log:
Cleaned up some code.

Modified: YDFramework2.0/trunk/examples/ajax.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax.php	2006-08-13 11:33:58 UTC (rev 2004)
+++ YDFramework2.0/trunk/examples/ajax.php	2006-08-14 06:01:28 UTC (rev 2005)
@@ -10,7 +10,6 @@
     // Class definition
     class ajax extends YDRequest {
 
-
         // Class constructor
         function ajax() {
 



From pclaerhout at mail.berlios.de  Mon Aug 14 08:06:49 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 08:06:49 +0200
Subject: [ydf-devel] r2006 - YDFramework2.0/trunk/examples
Message-ID: <200608140606.k7E66naw016260@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 08:06:47 +0200 (Mon, 14 Aug 2006)
New Revision: 2006

Added:
   YDFramework2.0/trunk/examples/xul.php
   YDFramework2.0/trunk/examples/xul.tpl
Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added an example on using  XUL with the Yellow Duck Framework.

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-14 06:01:28 UTC (rev 2005)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-14 06:06:47 UTC (rev 2006)
@@ -721,7 +721,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="15" valign="top">&nbsp;</td>
+            <td rowspan="16" valign="top">&nbsp;</td>
             <td valign="top"><a href="constants.php">YDFramework2 constants</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=constants.php">constants.php</a>
@@ -797,6 +797,14 @@
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=guidutil.php">guidutil.php</a>
             </td>
         </tr>
+        <tr>
+            <td valign="top"><a href="xul.php">Using XUL</a> (FireFox and Mozilla only)</td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=xul.php">xul.php</a>
+                <br/>
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=xul.tpl">xul.tpl</a>
+            </td>
+        </tr>
         </table>
 
     {/if}

Added: YDFramework2.0/trunk/examples/xul.php
===================================================================
--- YDFramework2.0/trunk/examples/xul.php	2006-08-14 06:01:28 UTC (rev 2005)
+++ YDFramework2.0/trunk/examples/xul.php	2006-08-14 06:06:47 UTC (rev 2006)
@@ -0,0 +1,44 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDTemplate.php' );
+
+    // Class definition
+    class xul extends YDRequest {
+
+        // Class constructor
+        function xul(){
+
+            // Initialize the parent
+            $this->YDRequest();
+
+            // Create a template object
+            $this->tpl = new YDTemplate();
+
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Set the content type
+            header( "Content-type: application/vnd.mozilla.xul+xml" );
+
+            // Assign some variables
+            $this->tpl->assign( 'test', true );
+            $this->tpl->assign( 'otherbutton', '<button id="cancel-button" label="Cancel"/>' );
+
+            // Display the template
+            $this->tpl->display();
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/xul.tpl
===================================================================
--- YDFramework2.0/trunk/examples/xul.tpl	2006-08-14 06:01:28 UTC (rev 2005)
+++ YDFramework2.0/trunk/examples/xul.tpl	2006-08-14 06:06:47 UTC (rev 2006)
@@ -0,0 +1,13 @@
+<?xml version="1.0"?>
+<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>
+<window
+    id="findfile-window"
+    title="Find Files"
+    orient="horizontal"
+    xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
+    {if $test}
+        <button id="find-button" label="Find"/>
+    {/if}
+    <button id="cancel-button" label="Cancel"/>
+    {$otherbutton}
+</window>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Mon Aug 14 08:27:21 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 08:27:21 +0200
Subject: [ydf-devel] r2007 - in YDFramework2.0/trunk/examples/weblog: .
	include
Message-ID: <200608140627.k7E6RLx6023074@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 08:27:17 +0200 (Mon, 14 Aug 2006)
New Revision: 2007

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/item_gallery.php
Log:
Made some performance improvements by moving the exif parsing part out of the weblog API. On yellowduck.be, this was taking 10 seconds to show admin/items. Now, it only takes 1/2 second.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-14 06:06:47 UTC (rev 2006)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-14 06:27:17 UTC (rev 2007)
@@ -267,24 +267,6 @@
                     $image->relative_path_s_obj = new YDFSImage( $dir_uploads->getAbsolutePath() . '/' . $image->relative_path_s );
                     $image->relative_path_m_obj = new YDFSImage( $dir_uploads->getAbsolutePath() . '/' . $image->relative_path_m );
 
-                    // Get the EXIF info for the image
-                    $result = read_exif_data_raw( $image->getAbsolutePath(), false );
-                    $image->exif = array();
-                    if ( isset( $result['IFD0'] ) ) {
-                        $image->exif = array_merge( $image->exif, $result['IFD0'] );
-                    }
-                    if ( isset( $result['SubIFD'] ) ) {
-                        $image->exif = array_merge( $image->exif, $result['SubIFD'] );
-                    }
-                    if ( $image->exif ) {
-                        @ $image->exif['full'] = $image->exif['Model'] . ' ' . str_replace( ' sec', 's', $image->exif['ExposureTime'] )
-                                             . ' ' . str_replace( ' ', '/', $image->exif['ApertureValue'] ) . ' ' .  t('at')
-                                             . ' ' . str_replace( ' ', '', $image->exif['FocalLength'] ) . ' ISO'
-                                             . $image->exif['ISOSpeedRatings'];
-                    } else {
-                        $image->exif = null;
-                    }
-
                     // Update the original image
                     $images[$key] = $image;
 

Modified: YDFramework2.0/trunk/examples/weblog/item_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-08-14 06:06:47 UTC (rev 2006)
+++ YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-08-14 06:27:17 UTC (rev 2007)
@@ -46,6 +46,24 @@
                 }
             }
 
+            // Get the EXIF info for the image
+            $result = read_exif_data_raw( $image->getAbsolutePath(), false );
+            $image->exif = array();
+            if ( isset( $result['IFD0'] ) ) {
+                $image->exif = array_merge( $image->exif, $result['IFD0'] );
+            }
+            if ( isset( $result['SubIFD'] ) ) {
+                $image->exif = array_merge( $image->exif, $result['SubIFD'] );
+            }
+            if ( $image->exif ) {
+                @ $image->exif['full'] = $image->exif['Model'] . ' ' . str_replace( ' sec', 's', $image->exif['ExposureTime'] )
+                                     . ' ' . str_replace( ' ', '/', $image->exif['ApertureValue'] ) . ' ' .  t('at')
+                                     . ' ' . str_replace( ' ', '', $image->exif['FocalLength'] ) . ' ISO'
+                                     . $image->exif['ISOSpeedRatings'];
+            } else {
+                $image->exif = null;
+            }
+
             // Add them to the template
             $this->tpl->assign( 'item',  $item );
             $this->tpl->assign( 'image', $image );



From pclaerhout at mail.berlios.de  Mon Aug 14 08:43:53 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 08:43:53 +0200
Subject: [ydf-devel] r2008 - in YDFramework2.0/trunk/examples/weblog: .
	include/languages manage
Message-ID: <200608140643.k7E6hrfL029219@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 08:43:48 +0200 (Mon, 14 Aug 2006)
New Revision: 2008

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
Log:
Added another check to the email form to prevent comment spam.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-14 06:27:17 UTC (rev 2007)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-14 06:43:48 UTC (rev 2008)
@@ -109,6 +109,7 @@
 $GLOBALS['t']['no_comments_yet'] = 'No comments yet';
 $GLOBALS['t']['comment'] = 'Comment';
 $GLOBALS['t']['comments'] = 'Comments';
+$GLOBALS['t']['err_name_length'] = 'Name cannot be longer than 35 characters';
 
 // manage/__mng_header.tpl
 $GLOBALS['t']['confirm_delete'] = 'Are you sure you want to delete:';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-14 06:27:17 UTC (rev 2007)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-14 06:43:48 UTC (rev 2008)
@@ -109,6 +109,7 @@
 $GLOBALS['t']['no_comments_yet'] = 'Nog geen commentaren';
 $GLOBALS['t']['comment'] = 'Commentaar';
 $GLOBALS['t']['comments'] = 'Commentaren';
+$GLOBALS['t']['err_name_length'] = 'Naam kan niet langer zijn dan 35 karakters';
 
 // manage/__mng_header.tpl
 $GLOBALS['t']['confirm_delete'] = 'Bent u zeker dat u het volgende wil verwijderen:';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-08-14 06:27:17 UTC (rev 2007)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-08-14 06:43:48 UTC (rev 2008)
@@ -74,6 +74,7 @@
                 // Set the rules
                 $form->addRule( 'username',    'required',  t( 'err_name' ) );
                 $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
+                $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), array( 35 ) );
                 $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
                 $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
                 $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-14 06:27:17 UTC (rev 2007)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-14 06:43:48 UTC (rev 2008)
@@ -65,9 +65,13 @@
             $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),      array( 'class' => 'button' ) );
 
             // Add the form rules
-            $form->addRule( 'username',  'required', t( 'err_name' ) );
-            $form->addRule( 'useremail', 'email',    t( 'err_email' ) );
-            $form->addRule( 'comment',   'required', t( 'err_comment' ) );
+            $form->addRule( 'username',    'required',  t( 'err_name' ) );
+            $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
+            $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), array( 35 ) );
+            $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
+            $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
+            $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
+            $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
             // Add the filters
             $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );



From pclaerhout at mail.berlios.de  Mon Aug 14 13:33:24 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 13:33:24 +0200
Subject: [ydf-devel] r2009 - in YDFramework2.0/trunk/examples/weblog: manage
	skins/default skins/default_with_lightbox
Message-ID: <200608141133.k7EBXOpE013721@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 13:33:10 +0200 (Mon, 14 Aug 2006)
New Revision: 2009

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl
Log:
Changed the way the new item emails are working. An email is now only send if the item is also published on the weblog. When the item is published, the creation date is now changed to make sure it's listed at the top of the weblog.

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 06:43:48 UTC (rev 2008)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 11:33:10 UTC (rev 2009)
@@ -110,17 +110,54 @@
                 // Set the user
                 $values['user_id'] = $this->user['id'];
 
+                // Check if we need to publish or not
+                $needs_publish_email = false;
+
                 // If there is an ID, we do an edit
                 if ( $values['id'] ) {
 
+                    // Get the item by ID
+                    $item = $this->weblog->getItemByID( $values['id'] );
+
+                    // Check if the item changes from draft to published
+                    if ( $item['is_draft'] && ! $values['is_draft'] ) {
+
+                        // Remember this
+                        $needs_publish_email = true;
+
+                        // Update the created timestamp
+                        $values['created'] =  time();
+                        $values['modified'] = time();
+
+                    }
+
                     // Update the database
                     $this->weblog->updateItem( $values );
 
                 } else {
 
+                    // Check if the item is draft or not
+                    if ( ! $values['is_draft'] ) {
+
+                        // Remember this
+                        $needs_publish_email = true;
+
+                        // Update the created timestamp
+                        $values['created'] =  time();
+                        $values['modified'] = time();
+
+                    }
+
                     // Add it to the database
                     $this->weblog->addItem( $values );
 
+                }
+
+                // Check if we need to send an email
+                if ( $needs_publish_email ) {
+
+                    die( 'send email' );
+
                     // Send an email if configured
                     if ( YDConfig::get( 'email_new_item', true ) ) {
 
@@ -149,11 +186,7 @@
                         foreach ( $subscribers as $subscriber ) {
                             $eml->addBcc( $subscriber['email'], $subscriber['name'] );
                         }
-                        if ( $values['is_draft'] ) {
-                            $eml->setSubject( t('new_item') . ' (' . t('draft') . '): ' . strip_tags( $values['title'] ) );
-                        } else {
-                            $eml->setSubject( t('new_item') . ': ' . strip_tags( $values['title'] ) );
-                        }
+                        $eml->setSubject( t('new_item') . ': ' . strip_tags( $values['title'] ) );
                         $eml->setHtmlBody( $this->fetch( dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/item_email.tpl' ) );
                         $eml->send();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-14 06:43:48 UTC (rev 2008)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-14 11:33:10 UTC (rev 2009)
@@ -88,8 +88,10 @@
                     {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">
-                    <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
-                    |
+                    {if $item.is_draft neq '1'}
+                        <a href="../item.php?id={$item.id}" target="_blank">{t w="view"}</a>
+                        |
+                    {/if}
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{t w="edit"}</a>
                     |
                     <a href="{$YD_SELF_SCRIPT}?do=delete&id={$item.id}"

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-08-14 06:43:48 UTC (rev 2008)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_email.tpl	2006-08-14 11:33:10 UTC (rev 2009)
@@ -28,7 +28,7 @@
 
         <div id="content" class="narrowcolumn">
 
-            <h3>{t w="new_item"}{if $item.is_draft} ({t w="draft"}){/if}: {$item.title}</h3>
+            <h3>{t w="new_item"}: {$item.title}</h3>
 
             <p>
                 <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl	2006-08-14 06:43:48 UTC (rev 2008)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_email.tpl	2006-08-14 11:33:10 UTC (rev 2009)
@@ -28,7 +28,7 @@
 
         <div id="content" class="narrowcolumn">
 
-            <h3>{t w="new_item"}{if $item.is_draft} ({t w="draft"}){/if}: {$item.title}</h3>
+            <h3>{t w="new_item"}: {$item.title}</h3>
 
             <p>
                 <b>{t w="weblog"}</b>: <a href="{$weblog_link}">{$weblog_title}</a><br/>



From pclaerhout at mail.berlios.de  Mon Aug 14 13:35:02 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 13:35:02 +0200
Subject: [ydf-devel] r2010 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608141135.k7EBZ2t7014224@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 13:34:50 +0200 (Mon, 14 Aug 2006)
New Revision: 2010

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
Log:
Removed the concept flag from the pages list.

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-14 11:33:10 UTC (rev 2009)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-14 11:34:50 UTC (rev 2010)
@@ -79,7 +79,6 @@
                 <td class="adminRowL">
                     {if $page.is_draft eq '1'}<i>{/if}
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$page.id}">{$page.title}</a>
-                    {if $page.is_draft eq '1'}<br/>{t w="draft"}{/if}
                     {if $page.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">



From pclaerhout at mail.berlios.de  Mon Aug 14 13:42:36 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 13:42:36 +0200
Subject: [ydf-devel] r2011 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608141142.k7EBgax0016988@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 13:42:30 +0200 (Mon, 14 Aug 2006)
New Revision: 2011

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
Log:
Enabling the "allow comments" field for an item now automatically disables the "auto close" checkbox, as they might override each other.

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-14 11:34:50 UTC (rev 2010)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-14 11:42:30 UTC (rev 2011)
@@ -42,6 +42,12 @@
             content_css : 'manage_editor.css'
         });{/literal}
 
+        {literal}function YDDisableAutoClose( obj ) {
+            if ( obj.checked ) {
+                document.getElementById("itemForm_auto_close").checked = false;
+            }
+        }{/literal}
+
     //-->
     </script>
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 11:34:50 UTC (rev 2010)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 11:42:30 UTC (rev 2011)
@@ -48,7 +48,7 @@
             $form->addElement( 'select',          'category_id',    t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
             $form->addElement( 'datetimeselect',  'created',        t('created_on'),       array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );
-            $form->addElement( 'checkbox',        'allow_comments', t('allow_comments'),   array( 'style' => 'border: none;' ) );
+            $form->addElement( 'checkbox',        'allow_comments', t('allow_comments'),   array( 'style' => 'border: none;', 'onClick' => 'YDDisableAutoClose(this)') );
             $form->addElement( 'checkbox',        'auto_close',     t('auto_close_item'),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'checkbox',        'is_draft',       t('is_draft'),         array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );



From pclaerhout at mail.berlios.de  Mon Aug 14 14:18:11 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 14 Aug 2006 14:18:11 +0200
Subject: [ydf-devel] r2012 - in YDFramework2.0/trunk/examples/weblog:
	include/languages manage
Message-ID: <200608141218.k7ECIBkx030003@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-14 14:18:09 +0200 (Mon, 14 Aug 2006)
New Revision: 2012

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/index.php
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
Log:
Made it easier to filter out draft and closed items in the admin interface.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-14 12:18:09 UTC (rev 2012)
@@ -309,6 +309,9 @@
 $GLOBALS['t']['is_draft'] = 'Draft (do not publish)';
 $GLOBALS['t']['draft'] = 'draft';
 $GLOBALS['t']['closed'] = 'closed';
+$GLOBALS['t']['active_items'] = 'active items';
+$GLOBALS['t']['drafts_items'] = 'drafts';
+$GLOBALS['t']['closed_items'] = 'closed items';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'No images yet';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-14 12:18:09 UTC (rev 2012)
@@ -309,6 +309,9 @@
 $GLOBALS['t']['is_draft'] = 'Concept (niet publiceren)';
 $GLOBALS['t']['draft'] = 'concept';
 $GLOBALS['t']['closed'] = 'gesloten';
+$GLOBALS['t']['active_items'] = 'actieve items';
+$GLOBALS['t']['drafts_items'] = 'concepten';
+$GLOBALS['t']['closed_items'] = 'gesloten items';
 
 // item_gallery.tpl
 $GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-08-14 12:18:09 UTC (rev 2012)
@@ -18,7 +18,7 @@
         function actionDefault() {
 
             // Get the 5 newest items
-            $items = $this->weblog->getItems( 5 );
+            $items = $this->weblog->getItems( 5, -1, 'created desc', 'AND is_draft = 0 AND allow_comments = 1' );
 
             // Assign it to the template
             $this->tpl->assign( 'items', $items );

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-14 12:18:09 UTC (rev 2012)
@@ -5,7 +5,11 @@
 {if $items}
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
-        <th colspan="3" class="adminRowLG">&raquo; <a href="items.php"><b>{t w="a_items"}</b></a></th>
+        <th colspan="3" class="adminRowLG">
+            &raquo; <a href="items.php"><b>{t w="active_items"}</b></a>
+            | <a href="items.php?filter=drafts">{t w="drafts_items"}</a>
+            | <a href="items.php?filter=closed">{t w="closed_items"}</a>
+        </th>
         <th class="adminRowLGR">
             <a href="items.php?do=edit"><img src="images/icon_add.gif" border="0" /></a>
             <a href="items.php?do=edit"><b>{t w="add_item"}</b></a>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-14 12:18:09 UTC (rev 2012)
@@ -17,8 +17,24 @@
         // Default action
         function actionDefault() {
 
+            // Get the filter
+            $filter = 'active';
+            if ( isset( $_GET['filter'] ) ) {
+                if ( strtolower( $_GET['filter'] ) == 'drafts' ) {
+                    $filter = 'drafts';
+                } elseif( strtolower( $_GET['filter'] ) == 'closed' ) {
+                    $filter = 'closed';
+                }
+            }
+
             // Get the list of items
-            $items = $this->weblog->getItems();
+            if ( $filter == 'active' ) {
+                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 0 AND allow_comments = 1' );
+            } elseif ( $filter == 'drafts' ) {
+                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 1' );
+            } else {
+                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND allow_comments = 0' );
+            }
 
             // Get the pagesize and current page from the URL
             $page = @ $_GET['page'];
@@ -27,7 +43,8 @@
             $items = new YDRecordSet( $items, $page, intval( YDConfig::get( 'YD_DB_DEFAULTPAGESIZE', 20 ) / 2 ) );
 
             // Assign it to the template
-            $this->tpl->assign( 'items', $items );
+            $this->tpl->assign( 'items',  $items );
+            $this->tpl->assign( 'filter', $filter );
 
             // Display the template
             $this->display();
@@ -156,8 +173,6 @@
                 // Check if we need to send an email
                 if ( $needs_publish_email ) {
 
-                    die( 'send email' );
-
                     // Send an email if configured
                     if ( YDConfig::get( 'email_new_item', true ) ) {
 
@@ -194,8 +209,14 @@
 
                 }
 
-                // Redirect to the default acton
-                $this->redirectToAction();
+                // Redirect to the default action
+                if ( $values['is_draft'] ) {
+                    $this->redirect( YD_SELF_SCRIPT . '?filter=drafts' );
+                } elseif ( ! $values['allow_comments'] ) {
+                    $this->redirect( YD_SELF_SCRIPT . '?filter=closed' );
+                } else {
+                    $this->redirectToAction();
+                }
 
             }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-14 11:42:30 UTC (rev 2011)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-14 12:18:09 UTC (rev 2012)
@@ -51,7 +51,14 @@
 
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
-        <th colspan="3" class="adminRowLG">&raquo; {t w="a_items"}</th>
+        <th colspan="3" class="adminRowLG">
+            &raquo; <a href="{$YD_SELF_SCRIPT}">
+                {if $filter == 'active'}<b>{/if}{t w="active_items"}{if $filter == 'active'}</b>{/if}</a>
+            | <a href="{$YD_SELF_SCRIPT}?filter=drafts">
+                {if $filter == 'drafts'}<b>{/if}{t w="drafts_items"}{if $filter == 'drafts'}</b>{/if}</a>
+            | <a href="{$YD_SELF_SCRIPT}?filter=closed">
+                {if $filter == 'closed'}<b>{/if}{t w="closed_items"}{if $filter == 'drafts'}</b>{/if}</a>
+        </th>
         <th class="adminRowLGR">
             <a href="{$YD_SELF_SCRIPT}?do=edit"><img src="images/icon_add.gif" border="0" /></a>
             <a href="{$YD_SELF_SCRIPT}?do=edit"><b>{t w="add_item"}</b></a>
@@ -82,9 +89,8 @@
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{$item.title}</a>
                     <br/>
                     {if $item.allow_comments eq '0'}
-                        {t w="closed"}{if $item.is_draft eq '1'}, {/if}
+                        {t w="closed"}
                     {/if}
-                    {if $item.is_draft eq '1'}{t w="draft"}{/if}
                     {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">



From ximian at mail.berlios.de  Tue Aug 15 19:03:02 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 15 Aug 2006 19:03:02 +0200
Subject: [ydf-devel] r2013 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608151703.k7FH32jX011677@sheep.berlios.de>

Author: ximian
Date: 2006-08-15 19:02:01 +0200 (Tue, 15 Aug 2006)
New Revision: 2013

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
small cleanups and YDCM scheme update

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-14 12:18:09 UTC (rev 2012)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-15 17:02:01 UTC (rev 2013)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="89" YPos="71" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="119" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -258,13 +258,13 @@
 </SETTINGS>
 <METADATA>
 <REGIONS>
+<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
+<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
 <REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
-<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
-<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
-<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 </REGIONS>
 <TABLES>
 <TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
@@ -387,10 +387,10 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1192" ColName="parent_id" PrevColName="parent" Pos="2" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="0" Comments="Parent node id">
+<COLUMN ID="1799" ColName="parent_id" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
 <COLUMN ID="1418" ColName="nleft" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
@@ -468,12 +468,8 @@
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1437" />
-<RELATION_START ID="1646" />
 <RELATION_START ID="1692" />
 </RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1646" />
-</RELATIONS_END>
 <INDICES>
 <INDEX ID="1210" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
 <INDEXCOLUMNS>
@@ -506,7 +502,7 @@
 <RELATION_END ID="1706" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
 <COLUMNS>
 <COLUMN ID="1219" ColName="language_id" PrevColName="lang" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
 <OPTIONSELECTED>
@@ -575,7 +571,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="800" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`position`,`type`) VALUES (1,NULL,1,10,1,\a\a,\a\a,NULL,NULL,NULL,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,1,\aYDCMRoot\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`position`,`type`) VALUES (2,1,4,9,1,\a\a,\a\a,NULL,NULL,NULL,NULL,1,\a0000-00-00 00:00:00\a,\a0000-00-00 !
 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,1,\aYDCMUseradministrators\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`position`,`type`) VALUES (3,1,2,3,1,\a\a,\a\a,NULL,NULL,NULL,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,1,\aYDCMUservisitors\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`position`,`type`) VALUES (100,2,5,9,1,\aadmin\a,\a21232f297a57a5a743894a0e4a801fc3\a,\aFrancisco JN Azevedo\a,\aemail at host.com\a,\aother info\a,\aen\a,1,\a!
 0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,523,\a2006-07-26!
  13:57:1
3\a,\a2006-07-26 16:48:15\a,0,\a0000-00-00 00:00:00\a,1,\aYDCMUseradministrator\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`position`,`type`) VALUES (101,100,6,7,1,\afatima\a,\ab5d5f67b30809413156655abdda382a3\a,\aFatima\a,NULL,NULL,\apt\a,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,14,\a2006-07-19 16:02:35\a,\a2006-07-19 17:13:54\a,2,\a0000-00-00 00:00:00\a,1,\aYDCMUseradministrator\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
+<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="800" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMRoot\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,1,\!
 a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUseradministrators\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUservisitors\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,\aadmin\a,\a21232f297a57a5a743!
 894a0e4a801fc3\a,\aAdmin\a,\aemail at host.com\a,\aother info\a,\!
 aen\a,1,
\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,40,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a,0,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,\afrancisco\a,\ab5d5f67b30809413156655abdda382a3\a,\aFrancisco Azevedo\a,\a\a,\a\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2004-05-08 05:05:06\a,19,\a2006-08-08 16:26:39\a,\a2006-08-08 17:18:19\a,2,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`templat!
 e`) VALUES (102,101,5,6,5,\apieter\a,\a\a,\aPieter\a,\a\a,\aaasdasdasd\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2001-01-01 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,\adavid\a,\a\a,\aDavid\a,\a\a,\a\a,\aen\a,1,\a2006-08-08 16:27:35\a,\a2006-08-08 16:27:35\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101,\a2006-08-08 16:28:01\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`!
 ,`created_date`,`type`,`position`,`template`) VALUES (104,100,!
 12,17,4,
\apedro\a,\a\a,\aPedro Cerqueira\a,\a\a,\axpto\a,\aen\a,1,\a2006-08-08 16:29:51\a,\a2006-08-08 16:29:51\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:30:06\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,\alimpeza\a,\a\a,\aLimpeza\a,\a\a,\aasfdasdasdasd\a,\aen\a,1,\a2006-08-08 16:32:11\a,\a2006-08-08 16:32:11\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:32:26\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`crea!
 ted_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,\ameireles\a,\a\a,\aMeireles\a,\a\a,\ameireles\a,\aen\a,1,\a2006-08-08 17:14:44\a,\a2006-08-08 17:14:44\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 17:15:09\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,\amarc\a,\a\a,\aMarc\a,\a\a,\aVassoutinha\a,\aen\a,1,\a2006-08-09 15:57:27\a,\a2006-12-09 15:57:27\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 15:57:49\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_co!
 unter`,`login_last`,`login_current`,`created_user`,`created_da!
 te`,`typ
e`,`position`,`template`) VALUES (113,100,18,19,4,\aextra\a,\a\a,\aExtra user\a,\a\a,\auser OKuser OKuser OK\a,\aen\a,1,\a2006-08-09 16:13:57\a,\a2006-08-09 16:13:57\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 16:14:20\a,\aYDCMUseradministrator\a,1,\adefault\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
 <COLUMNS>
 <COLUMN ID="1238" ColName="user_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
 <OPTIONSELECTED>
@@ -647,6 +643,11 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1795" ColName="template" PrevColName="" Pos="21" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\adefault\a" Comments="Administration template name ">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 <COLUMN ID="1250" ColName="state" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="user state">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
@@ -704,7 +705,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
+<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,1,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\aa!
 ss local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat!
 =0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinke!
 dObject=
"0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
 <COLUMNS>
 <COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -966,7 +967,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`!
 ,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`co!
 ntent_id`,`language_id`,`title`,`version_default`,`version_dat!
 e`,`vers
ion_user_id`) VALUES (10,11,\aen\a,\aPortals\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a,1);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`version_user_id`) VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a,1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedO!
 bject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
+<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_!
 id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`ver!
 sion_date`,`user_id`) VALUES (10,11,\aen\a,\aPortals\a,1,\a000!
 0-00-00 
00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a,100);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
 <COLUMNS>
 <COLUMN ID="1680" ColName="component_id" PrevColName="title_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1026,7 +1027,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (39,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (42,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (46,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`!
 ,`date_end`,`user_id`) VALUES (51,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (57,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (64,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (70,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (75,\aYDCMRootmenu\a,\adelete\a,NU!
 LL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nIN!
 SERT INT
O `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (80,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (85,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (90,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (95,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`ob!
 ject_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (100,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (105,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (111,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (115,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUE!
 S (116,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a!
 ,\a0000-
00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (120,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,111);\n" TableOptions="DelayKeyTblUpdates=0\nPackKe!
 ys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1092,7 +1093,6 @@
 <RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
 <RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="31" CaptionOffsetY="-6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
-<RELATION ID="1646" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="1" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
 <RELATION ID="1692" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1678" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="-3" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-44" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
 <RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="31" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
 <RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php	2006-08-14 12:18:09 UTC (rev 2012)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMTemplates.php	2006-08-15 17:02:01 UTC (rev 2013)
@@ -26,6 +26,8 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+	YDInclude( 'YDFileSystem.php' );
+
 	// set admin template directory (without template name directory)
 	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', YD_SELF_DIR, false );
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-14 12:18:09 UTC (rev 2012)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-15 17:02:01 UTC (rev 2013)
@@ -30,6 +30,8 @@
 	// add permissions lib
 	require_once( dirname( __FILE__ ) . '/YDCMPermissions.php' );
 
+	YDInclude( 'YDForm.php' );
+
 	// add local translation directory
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
 
@@ -242,7 +244,7 @@
          *
          *  @returns    true if updated, array with form errors otherwise
          */
-		function changeUserForm( $id, $formvalues = array() ){
+		function changeUserForm( $id, $formvalues = null ){
 
 			// check form validation
 			if ( !$this->form->validate( $formvalues ) )
@@ -250,7 +252,7 @@
 
 			// get form values
 			$values = $this->form->getValues();
-//return array_reverse( $values );
+
 			// we need parent fot setting user permissions
 			$details = $this->getUser( $id );
 
@@ -267,8 +269,8 @@
 			$this->user_id = intval( $id );
 
 			// parse dates
-			$this->login_start = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
-			$this->login_end   = YDStringUtil::formatDate( $values[ 'login_end' ],   'datetimesql' );
+			if ( isset( $this->login_start ) ) $this->login_start = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
+			if ( isset( $this->login_end ) )   $this->login_end   = YDStringUtil::formatDate( $values[ 'login_end' ],   'datetimesql' );
 
 			// return update result
 			return $this->update();



From ximian at mail.berlios.de  Tue Aug 15 19:05:32 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 15 Aug 2006 19:05:32 +0200
Subject: [ydf-devel] r2014 - in YDFramework2.0/trunk/examples: . cm
	cm/backend cm/backend/templates
Message-ID: <200608151705.k7FH5WvC012017@sheep.berlios.de>

Author: ximian
Date: 2006-08-15 19:04:22 +0200 (Tue, 15 Aug 2006)
New Revision: 2014

Added:
   YDFramework2.0/trunk/examples/cm/
   YDFramework2.0/trunk/examples/cm/backend/
   YDFramework2.0/trunk/examples/cm/backend/templates/
   YDFramework2.0/trunk/examples/cm/backend/templates/default/
   YDFramework2.0/trunk/examples/cm/backend/templates/green/
   YDFramework2.0/trunk/examples/cm/backend/templates/orange/
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
   YDFramework2.0/trunk/examples/cm/cm.php
   YDFramework2.0/trunk/examples/cm/frontend/
   YDFramework2.0/trunk/examples/cm/instructions.txt
Log:
added first YDCM example about user details changing

Added: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-15 17:02:01 UTC (rev 2013)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-15 17:04:22 UTC (rev 2014)
@@ -0,0 +1,76 @@
+<?php
+
+    include_once( dirname( __FILE__ ) . '/../cm.php' );
+
+    // Class definition
+    class userdetails extends cm {
+
+        // Class constructor
+        function userdetails() {
+
+			// init parent class
+            $this->cm();
+
+			// create a user object
+			$this->users = YDCMComponent::module( 'YDCMUsers' );
+        }
+
+
+        // Default action (that shows user details form with some editable fields)
+		// User should only update his details eg name, email
+        function actionDefault() {
+
+			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
+			$this->users->addFormDetails( false, false, false, true );
+
+			// get info of user id 100
+			$defaults = $this->users->getUser( 100 );
+
+			// get user form (filled with previous defaults)
+			$form = $this->users->getForm( $defaults );
+
+			// show form :)
+			$form->display();
+        }
+
+
+        // Change details example
+        function actionChangeDetails() {
+
+			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
+			$this->users->addFormDetails( false, false, false, true );
+
+			// get form filled with details from user id 100
+			$defaults = $this->users->getUser( 100 );
+
+			// get user details form with a submit button
+			$form = $this->users->getForm( $defaults );
+			$form->addElement( 'submit', '_cmdSubmit', 'Submit' );
+
+			// if we have submitted the form, update user
+			if ( $form->isSubmitted() ){
+
+				// update user 100 with submitted information, magic isn't it ;)
+				$result = $this->users->changeUserForm( 100 );
+
+				// check if result is a array (form error messages)
+				if( is_array( $result ) ) return print( implode( '<br>', $result ) );
+
+				// if update was sucessfull, show ok message in current language
+				if ( $result == 1 ) return print( t( 'user details updated' ) );
+
+				// if form is valid but details are not changed (because are same as the db ones)
+				if ( $result == 0 ) return print( t( 'user not updated' ) );
+			}
+
+			// show form :)
+			$form->display();
+        }
+
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Added: YDFramework2.0/trunk/examples/cm/cm.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.php	2006-08-15 17:02:01 UTC (rev 2013)
+++ YDFramework2.0/trunk/examples/cm/cm.php	2006-08-15 17:04:22 UTC (rev 2014)
@@ -0,0 +1,32 @@
+<?php
+
+    // Initialize the Yellow Duck Framework
+    include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDCMComponent.php' );
+
+    // set YDDatabase instance connection
+    YDDatabase::registerInstance( 'default', 'mysql', 'tppp', 'root', '', 'localhost' );
+
+	// set portal language. Currently you can user 'en' and 'pt'.
+	YDLocale::set( 'en' );
+
+	// set admin template path
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', dirname( __FILE__ ) . '/backend/templates' );
+
+    // Class definition for the index request
+    class cm extends YDRequest {
+
+        // Class constructor
+        function cm() {
+
+            $this->YDRequest();
+            $this->template = new YDTemplate();
+        }
+
+    }
+?>

Added: YDFramework2.0/trunk/examples/cm/instructions.txt
===================================================================
--- YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-15 17:02:01 UTC (rev 2013)
+++ YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-15 17:04:22 UTC (rev 2014)
@@ -0,0 +1,13 @@
+1 - Get DBDesigner4 (opensource db scheme editor): http://fabforce.net/dbdesigner4/
+
+	1.1 - open YDFramework2\YDClasses\YDCMComponent\DBDesigner4.xml in DBDesigner4
+
+	1.2 - in DBDesigner4 select FILE -> EXPORT -> SQL CREATE SCRIPT
+
+	1.3 - in "General Settings" select 'Order tables by foreign keys'
+
+	1.4 - in "SQL Creates Settings" select all options
+
+	1.5 - copy script to clipboard/file and insert it in your database
+
+2 - in examples\cm directory, open cm.php and edit your database settings



From ximian at mail.berlios.de  Tue Aug 15 23:31:28 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 15 Aug 2006 23:31:28 +0200
Subject: [ydf-devel] r2015 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608152131.k7FLVS8K018714@sheep.berlios.de>

Author: ximian
Date: 2006-08-15 23:31:18 +0200 (Tue, 15 Aug 2006)
New Revision: 2015

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
YDStringUtil::formatDate was working just for datetimeselect form elements (because of a previous patch). now is ok for all date elements.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-15 17:04:22 UTC (rev 2014)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-15 21:31:18 UTC (rev 2015)
@@ -549,10 +549,15 @@
 
             // If array, is a date YDForm element value
             if ( is_array( $timestamp ) ) {
-			
-				// check if timestamp exists. otherwise create it
-				if ( !isset( $timestamp[ 'timestamp' ] ) ) $timestamp[ 'timestamp' ] = mktime( $timestamp['hours'], $timestamp['minutes'], $timestamp['seconds'], $timestamp['month'], $timestamp['day'], $timestamp['year'] );
-                $timestamp = $timestamp[ 'timestamp' ];
+
+                // check if timestamp exists. otherwise create it
+                $hours   = isset( $timestamp[ 'hours' ] ) ?   $timestamp[ 'hours' ] : 0;
+                $minutes = isset( $timestamp[ 'minutes' ] ) ? $timestamp[ 'minutes' ] : 0;
+                $seconds = isset( $timestamp[ 'seconds' ] ) ? $timestamp[ 'seconds' ] : 0;
+                $month   = isset( $timestamp[ 'month' ] ) ?   $timestamp[ 'month' ] : 1;
+                $day     = isset( $timestamp[ 'day' ] ) ?     $timestamp[ 'day' ] : 1;
+                $year    = isset( $timestamp[ 'year' ] ) ?    $timestamp[ 'year' ] : 1970;
+                $timestamp = mktime( $hours, $minutes, $seconds, $month, $day, $year );
             }
 
             // Check the standard formats



From ximian at mail.berlios.de  Tue Aug 15 23:33:40 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 15 Aug 2006 23:33:40 +0200
Subject: [ydf-devel] r2016 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608152133.k7FLXefs019010@sheep.berlios.de>

Author: ximian
Date: 2006-08-15 23:33:29 +0200 (Tue, 15 Aug 2006)
New Revision: 2016

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
when adding users on YDCMUsers password is checked and added if element was created

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-15 21:31:18 UTC (rev 2015)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-15 21:33:29 UTC (rev 2016)
@@ -215,19 +215,24 @@
 
 			// parse values
 			$values = array();
-			$values['name']         = $this->form->getValue( 'name' );
-			$values['email']        = $this->form->getValue( 'email' );
-			$values['username']     = $this->form->getValue( 'username' );
-			$values['other']        = $this->form->getValue( 'other' );
-			$values['state']        = $this->form->getValue( 'state' );
-			$values['type']         = 'YDCMUseradministrator';
-			$values['nlevel']       = 1;
-			$values['created_user'] = $this->currentID();
-			$values['created_date'] = YDStringUtil::formatDate( time(), 'datetimesql' );
-			$values['language_id']  = $this->form->getValue( 'language_id' );
-			$values['login_start']  = YDStringUtil::formatDate( $this->form->getValue( 'login_start' ), 'datetimesql' );
-			$values['login_end']    = YDStringUtil::formatDate( $this->form->getValue( 'login_end' ),   'datetimesql' );
+			$values['name']          = $this->form->getValue( 'name' );
+			$values['email']         = $this->form->getValue( 'email' );
+			$values['username']      = $this->form->getValue( 'username' );
+			$values['other']         = $this->form->getValue( 'other' );
+			$values['state']         = $this->form->getValue( 'state' );
+			$values['type']          = 'YDCMUseradministrator';
+			$values['nlevel']        = 1;
+			$values['created_user']  = $this->currentID();
+			$values['created_date']  = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$values['language_id']   = $this->form->getValue( 'language_id' );
+			$values['login_start']   = YDStringUtil::formatDate( $this->form->getValue( 'login_start' ), 'datetimesql' );
+			$values['login_end']     = YDStringUtil::formatDate( $this->form->getValue( 'login_end' ),   'datetimesql' );
+			$values['login_counter'] = 0;
 
+			// check password
+			if ( $this->form->isElement( 'password' ) )
+				$values['password'] = md5( $this->form->getValue( 'password' ) );
+
 			// add user to YDUsers table
 			$newID = $this->tree->addNode( $values, $parent_id );
 
@@ -359,7 +364,7 @@
 			// add login details
 			if ( $logindetails ){
 				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
+				$this->form->addElement( 'dateselect', 'login_start', t('login_start') );
 				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
 			}else{
 				$this->form->addElement( 'span',           'state',       t('login_state') );



From ximian at mail.berlios.de  Tue Aug 15 23:34:46 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 15 Aug 2006 23:34:46 +0200
Subject: [ydf-devel] r2017 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608152134.k7FLYkAe019117@sheep.berlios.de>

Author: ximian
Date: 2006-08-15 23:34:38 +0200 (Tue, 15 Aug 2006)
New Revision: 2017

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php
Log:
user_id is a foreign key in YDCMComp, not version_user_id

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php	2006-08-15 21:33:29 UTC (rev 2016)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php	2006-08-15 21:34:38 UTC (rev 2017)
@@ -49,7 +49,6 @@
 			$this->registerField( 'title' );
 			$this->registerField( 'version_default' );
 			$this->registerField( 'version_date' );
-//			$this->registerField( 'user_id' );
 
 			// add static relations to tree and language
 			$this->registerField( 'content_id' );
@@ -62,9 +61,9 @@
 			$rel->setLocalKey( 'language_id' );
 			$rel->setForeignKey( 'language_id' );
 
-			$this->registerField( 'version_user_id' );
+			$this->registerField( 'user_id' );
        		$rel = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
-			$rel->setLocalKey( 'version_user_id' );
+			$rel->setLocalKey( 'user_id' );
 			$rel->setForeignKey( 'user_id' );
 
 			// add dynamic relation



From pclaerhout at mail.berlios.de  Wed Aug 16 08:07:46 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 08:07:46 +0200
Subject: [ydf-devel] r2018 - in YDFramework2.0/trunk/examples/weblog: .
	manage
Message-ID: <200608160607.k7G67kDD028527@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 08:07:43 +0200 (Wed, 16 Aug 2006)
New Revision: 2018

Modified:
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
Log:
Fixed the comments adding in item.php and manage/comments.php.

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-08-15 21:34:38 UTC (rev 2017)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-08-16 06:07:43 UTC (rev 2018)
@@ -74,7 +74,7 @@
                 // Set the rules
                 $form->addRule( 'username',    'required',  t( 'err_name' ) );
                 $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
-                $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), array( 35 ) );
+                $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), 35 );
                 $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
                 $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
                 $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-15 21:34:38 UTC (rev 2017)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-16 06:07:43 UTC (rev 2018)
@@ -67,7 +67,7 @@
             // Add the form rules
             $form->addRule( 'username',    'required',  t( 'err_name' ) );
             $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
-            $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), array( 35 ) );
+            $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), 35 );
             $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
             $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
             $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );



From pclaerhout at mail.berlios.de  Wed Aug 16 09:20:55 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 09:20:55 +0200
Subject: [ydf-devel] r2019 - in YDFramework2.0/trunk/examples/weblog: .
	skins/default_with_lightbox/js
Message-ID: <200608160720.k7G7Kt5R031373@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 09:20:53 +0200 (Wed, 16 Aug 2006)
New Revision: 2019

Modified:
   YDFramework2.0/trunk/examples/weblog/install.php
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/js/lightbox.js
Log:
Changed the database installer script to make items.body_more a nullable field.

Modified: YDFramework2.0/trunk/examples/weblog/install.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/install.php	2006-08-16 06:07:43 UTC (rev 2018)
+++ YDFramework2.0/trunk/examples/weblog/install.php	2006-08-16 07:20:53 UTC (rev 2019)
@@ -148,7 +148,7 @@
                       user_id int(11) NOT NULL default \'1\',
                       title varchar(255) NOT NULL default \'\',
                       body longtext NOT NULL,
-                      body_more longtext NOT NULL,
+                      body_more longtext default NULL,
                       num_comments int(11) NOT NULL default \'0\',
                       allow_comments tinyint(1) NOT NULL default \'1\',
                       created int(11) default NULL,

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/js/lightbox.js
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/js/lightbox.js	2006-08-16 06:07:43 UTC (rev 2018)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/js/lightbox.js	2006-08-16 07:20:53 UTC (rev 2019)
@@ -62,7 +62,7 @@
 var fileLoadingImage = "skins/default_with_lightbox/images/loading.gif";		
 var fileBottomNavCloseImage = "skins/default_with_lightbox/images/closelabel.gif";
 
-var resizeSpeed = 7;	// controls the speed of the image resizing (1=slowest and 10=fastest)
+var resizeSpeed = 9;	// controls the speed of the image resizing (1=slowest and 10=fastest)
 
 var borderSize = 10;	//if you adjust the padding in the CSS, you will need to update this variable
 



From pclaerhout at mail.berlios.de  Wed Aug 16 11:42:33 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 11:42:33 +0200
Subject: [ydf-devel] r2020 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200608160942.k7G9gXLA022067@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 11:42:33 +0200 (Wed, 16 Aug 2006)
New Revision: 2020

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
When adding a comment, the redirect now works properly (as it's now pointing to the right comment id).

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-16 07:20:53 UTC (rev 2019)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-16 09:42:33 UTC (rev 2020)
@@ -416,9 +416,10 @@
         function addComment( $values ) {
             $values['userip'] = $_SERVER['REMOTE_ADDR'];
             $result = $this->_executeInsert( '#_comments', $values );
+            $comment_id = $this->db->getLastInsertID();
             $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $values['item_id'] );
             $this->db->executeSql( $sql );
-            return $result;
+            return $comment_id;
         }
 
         // Update a comment



From pclaerhout at mail.berlios.de  Wed Aug 16 11:52:57 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 11:52:57 +0200
Subject: [ydf-devel] r2021 - in YDFramework2.0/trunk/YDFramework2: YDClasses
	YDClasses/YDCMComponent addons/YDCMLink addons/YDCMPage
Message-ID: <200608160952.k7G9qv2k022962@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 11:52:56 +0200 (Wed, 16 Aug 2006)
New Revision: 2021

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
Log:
Fixed some warning messages with YDCMComponent.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php	2006-08-16 09:42:33 UTC (rev 2020)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMComp.php	2006-08-16 09:52:56 UTC (rev 2021)
@@ -176,7 +176,7 @@
 			foreach( $this->getMenu() as $element ){
 
 				$el = new $element[ 'type' ];
-				$menu[] = $el->render( $element, &$url );
+				$menu[] = $el->render( $element, $url );
 			}
 
 			return $menu;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-16 09:42:33 UTC (rev 2020)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-16 09:52:56 UTC (rev 2021)
@@ -118,7 +118,7 @@
          *
          *  @returns    An html string
          */
-		function render( $id, $url ){
+		function render( $id, & $url ){
 		
 			return '';
 		}

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php	2006-08-16 09:42:33 UTC (rev 2020)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/YDCMLink.php	2006-08-16 09:52:56 UTC (rev 2021)
@@ -54,7 +54,7 @@
          *
          *  @returns    Html link
          */
-		function render( $component, $url ){
+		function render( $component, & $url ){
 
 			$url->setQueryVar( 'component', $component[ 'type' ] );
 			$url->setQueryVar( 'id',        $component[ 'content_id' ] );

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-08-16 09:42:33 UTC (rev 2020)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/YDCMPage.php	2006-08-16 09:52:56 UTC (rev 2021)
@@ -66,7 +66,7 @@
          *
          *  @returns    Html link
          */
-		function render( $component, $url ){
+		function render( $component, & $url ){
 
 			$url->setQueryVar( 'component', $component[ 'type' ] );
 			$url->setQueryVar( 'id',        $component[ 'content_id' ] );



From pclaerhout at mail.berlios.de  Wed Aug 16 17:11:22 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 17:11:22 +0200
Subject: [ydf-devel] r2022 -
	YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump
Message-ID: <200608161511.k7GFBMln000410@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 17:11:22 +0200 (Wed, 16 Aug 2006)
New Revision: 2022

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
Log:
The default characterset is now no longer included in the mysql database exports as it fails the import on some systems.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2006-08-16 09:52:56 UTC (rev 2021)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2006-08-16 15:11:22 UTC (rev 2022)
@@ -199,15 +199,39 @@
             // get creation statement of a specific table
             $record = $this->dbinstance->getRecord( "SHOW CREATE TABLE `". $table . "`" );
 
-            $content = $record['create table'] . $separator;
+            // Get the statement
+            $content = $record['create table'];
+
+            // Strip out the default character set (as it fails the import on some systems).
+            $pos = strpos( $content, ' DEFAULT CHARSET=' );
+            if ( $pos !== false ) {
+                $content = substr( $content, 0, $pos );
+            }
+
+            // Add the separator
+            $content = $content . $separator;
             
             // return only the statement
             if (!$this->useComments) return $content;
 
             return "\n\n--\n-- Table struture of '". $table ."'\n--\n\n". $content;
         } 
-      
+
         /**
+         *  Helper function to strip a piece of text from the end of a table
+         *
+         *  @param  $text   The text to strip from
+         *  @param  $strip  The text to strip
+         */
+        function _stripFromEnd( $text, $strip ) {
+            $pos = strpos( $text, strip );
+            if ( $pos !== false ) {
+                $text = substr( $text, 0, $pos );
+            }
+            return $text;
+        }
+
+        /**
          *  This function returns all insert statements as a string for each row of a table
          *
          *  @param $table       Table name



From pclaerhout at mail.berlios.de  Wed Aug 16 17:17:46 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 16 Aug 2006 17:17:46 +0200
Subject: [ydf-devel] r2023 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608161517.k7GFHkX7002341@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-16 17:17:45 +0200 (Wed, 16 Aug 2006)
New Revision: 2023

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
Removed the item part in the list view if there is no item title.

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-16 15:11:22 UTC (rev 2022)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-16 15:17:45 UTC (rev 2023)
@@ -92,8 +92,10 @@
                 <td class="adminRowL">
                     {if $comment.item_is_draft eq '1'}<i>{/if}
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
-                    <br/>
-                    {t w="item"}: {$comment.item_title}
+                    {if $comment.item_title}
+                        <br/>
+                        {t w="item"}: {$comment.item_title}
+                    {/if}
                     {if $comment.item_is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">



From ximian at mail.berlios.de  Wed Aug 16 17:35:00 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 16 Aug 2006 17:35:00 +0200
Subject: [ydf-devel] r2024 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608161535.k7GFZ0lD005492@sheep.berlios.de>

Author: ximian
Date: 2006-08-16 17:34:48 +0200 (Wed, 16 Aug 2006)
New Revision: 2024

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
removed permissions method in YDCMUsers as we should use YDCMPermissions module for that

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-16 15:17:45 UTC (rev 2023)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-16 15:34:48 UTC (rev 2024)
@@ -83,7 +83,7 @@
 			$rel->setLocalKey( 'language_id' );
             $rel->setForeignKey( 'language_id' );
 
-			// TODO: tree position is required
+			// create tree object
 			$this->tree = new YDDatabaseTree( 'default', 'YDCMUsers', 'user_id', 'parent_id', 'parent_id' );
 
 			// add tree fields
@@ -101,19 +101,6 @@
 
 
         /**
-         *  This function returns all user permissions
-         *
-         *  @param  $user_id   User id to get permissions
-         *
-         *  @retuns  Associative array of permissions
-         */
-		function getPermissions( $user_id ){
-		
-			return $this->perm->getPermissions( $user_id );
-		}
-
-
-        /**
          *  This function returns the id of the current user
          */
 		function currentID(){
@@ -207,7 +194,7 @@
          *
          *  @returns    true if updated, array with form errors otherwise
          */
-		function addUserForm( $parent_id, $formvalues = array() ){
+		function addUserForm( $parent_id, $formvalues = null ){
 
 			// check form validation
 			if ( !$this->form->validate( $formvalues ) )
@@ -364,7 +351,7 @@
 			// add login details
 			if ( $logindetails ){
 				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-				$this->form->addElement( 'dateselect', 'login_start', t('login_start') );
+				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
 				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
 			}else{
 				$this->form->addElement( 'span',           'state',       t('login_state') );
@@ -429,11 +416,11 @@
 			$node = $this->getUser( $user_id );
 
 			// get user permissions
-			$permissions = $this->getPermissions( $user_id );
+			$permissions = $this->perm->getPermissions( $user_id );
 
 			// check if we are editing or creating
-			if ( $useParentPermissions ) $permissions_avaiable = $this->getPermissions( $node['parent_id'] );
-			else                         $permissions_avaiable = $this->getPermissions( $user_id );
+			if ( $useParentPermissions ) $permissions_avaiable = $this->perm->getPermissions( $node['parent_id'] );
+			else                         $permissions_avaiable = $this->perm->getPermissions( $user_id );
 
 			// cycle parent permissions to create form checkboxgroup of this user
 			foreach( $permissions_avaiable as $obj => $perm ){
@@ -638,7 +625,7 @@
 
 			// add permissions
 			$values = $this->getValues();
-			$values[ 'permissions' ] = $this->getPermissions( intval( $user_id ) );
+			$values[ 'permissions' ] = $this->perm->getPermissions( intval( $user_id ) );
 			
 			return $values;
 		}



From ximian at mail.berlios.de  Wed Aug 16 17:44:36 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 16 Aug 2006 17:44:36 +0200
Subject: [ydf-devel] r2025 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608161544.k7GFiat5006354@sheep.berlios.de>

Author: ximian
Date: 2006-08-16 17:44:24 +0200 (Wed, 16 Aug 2006)
New Revision: 2025

Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
Log:
removed the DBDesigner4.xml scheme to example directory (this not a core file)

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-16 15:34:48 UTC (rev 2024)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/DBDesigner4.xml	2006-08-16 15:44:24 UTC (rev 2025)
@@ -1,1122 +0,0 @@
-<?xml version="1.0" standalone="yes" ?>
-<DBMODEL Version="4.0">
-<SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="119" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
-<DATATYPEGROUPS>
-<DATATYPEGROUP Name="Numeric Types" Icon="1" />
-<DATATYPEGROUP Name="Date and Time Types" Icon="2" />
-<DATATYPEGROUP Name="String Types" Icon="3" />
-<DATATYPEGROUP Name="Blob and Text Types" Icon="4" />
-<DATATYPEGROUP Name="User defined Types" Icon="5" />
-<DATATYPEGROUP Name="Geographic Types" Icon="6" />
-</DATATYPEGROUPS>
-<DATATYPES>
-<DATATYPE ID="1" IDGroup="0" TypeName="TINYINT" Description="A very small integer. The signed range is -128 to 127. The unsigned range is 0 to 255." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="1" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="2" IDGroup="0" TypeName="SMALLINT" Description="A small integer. The signed range is -32768 to 32767. The unsigned range is 0 to 65535." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="1" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="3" IDGroup="0" TypeName="MEDIUMINT" Description="A medium-size integer. The signed range is -8388608 to 8388607. The unsigned range is 0 to 16777215." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="1" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="4" IDGroup="0" TypeName="INT" Description="A normal-size integer. The signed range is -2147483648 to 2147483647. The unsigned range is 0 to 4294967295." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="1" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="0" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="5" IDGroup="0" TypeName="INTEGER" Description="A normal-size integer. The signed range is -2147483648 to 2147483647. The unsigned range is 0 to 4294967295." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="1" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="1" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="6" IDGroup="0" TypeName="BIGINT" Description="A large integer. The signed range is -9223372036854775808 to 9223372036854775807. The unsigned range is 0 to 18446744073709551615." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="UNSIGNED" Default="0" />
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="7" IDGroup="0" TypeName="FLOAT" Description="A small (single-precision) floating-point number. Cannot be unsigned. Allowable values are -3.402823466E+38 to -1.175494351E-38, 0, and 1.175494351E-38 to 3.402823466E+38." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="precision" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="8" IDGroup="0" TypeName="FLOAT" Description="A small (single-precision) floating-point number. Cannot be unsigned. Allowable values are -3.402823466E+38 to -1.175494351E-38, 0, and 1.175494351E-38 to 3.402823466E+38." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="9" IDGroup="0" TypeName="DOUBLE" Description="A normal-size (double-precision) floating-point number. Cannot be unsigned. Allowable values are -1.7976931348623157E+308 to -2.2250738585072014E-308, 0, and 2.2250738585072014E-308 to 1.7976931348623157E+308." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="10" IDGroup="0" TypeName="DOUBLE PRECISION" Description="This is a synonym for DOUBLE." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="11" IDGroup="0" TypeName="REAL" Description="This is a synonym for DOUBLE." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="12" IDGroup="0" TypeName="DECIMAL" Description="An unpacked floating-point number. Cannot be unsigned. Behaves like a CHAR column." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="3" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="13" IDGroup="0" TypeName="NUMERIC" Description="This is a synonym for DECIMAL." ParamCount="2" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="3" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-<PARAM Name="decimals" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="ZEROFILL" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="14" IDGroup="1" TypeName="DATE" Description="A date. The supported range is \a1000-01-01\a to \a9999-12-31\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="15" IDGroup="1" TypeName="DATETIME" Description="A date and time combination. The supported range is \a1000-01-01 00:00:00\a to \a9999-12-31 23:59:59\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="16" IDGroup="1" TypeName="TIMESTAMP" Description="A timestamp. The range is \a1970-01-01 00:00:00\a to sometime in the year 2037. The length can be 14 (or missing), 12, 10, 8, 6, 4, or 2 representing YYYYMMDDHHMMSS, ... , YYYYMMDD, ... , YY formats." ParamCount="1" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-</DATATYPE>
-<DATATYPE ID="17" IDGroup="1" TypeName="TIME" Description="A time. The range is \a-838:59:59\a to \a838:59:59\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="18" IDGroup="1" TypeName="YEAR" Description="A year in 2- or 4-digit format (default is 4-digit)." ParamCount="1" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-</DATATYPE>
-<DATATYPE ID="19" IDGroup="2" TypeName="CHAR" Description="A fixed-length string (1 to 255 characters) that is always right-padded with spaces to the specified length when stored. values are sorted and compared in case-insensitive fashion according to the default character set unless the BINARY keyword is given." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="BINARY" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="20" IDGroup="2" TypeName="VARCHAR" Description="A variable-length string (1 to 255 characters). Values are sorted and compared in case-sensitive fashion unless the BINARY keyword is given." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="length" />
-</PARAMS>
-<OPTIONS>
-<OPTION Name="BINARY" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="21" IDGroup="2" TypeName="BIT" Description="This is a synonym for CHAR(1)." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="22" IDGroup="2" TypeName="BOOL" Description="This is a synonym for CHAR(1)." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="23" IDGroup="3" TypeName="TINYBLOB" Description="A column maximum length of 255 (2^8 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="24" IDGroup="3" TypeName="BLOB" Description="A column maximum length of 65535 (2^16 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="25" IDGroup="3" TypeName="MEDIUMBLOB" Description="A column maximum length of 16777215 (2^24 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="26" IDGroup="3" TypeName="LONGBLOB" Description="A column maximum length of 4294967295 (2^32 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="27" IDGroup="3" TypeName="TINYTEXT" Description="A column maximum length of 255 (2^8 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="28" IDGroup="3" TypeName="TEXT" Description="A column maximum length of 65535 (2^16 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="29" IDGroup="3" TypeName="MEDIUMTEXT" Description="A column maximum length of 16777215 (2^24 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="30" IDGroup="3" TypeName="LONGTEXT" Description="A column maximum length of 4294967295 (2^32 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="31" IDGroup="3" TypeName="ENUM" Description="An enumeration. A string object that can have only one value, chosen from the list of values." ParamCount="1" OptionCount="0" ParamRequired="1" EditParamsAsString="1" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="values" />
-</PARAMS>
-</DATATYPE>
-<DATATYPE ID="32" IDGroup="3" TypeName="SET" Description="A set. A string object that can have zero or more values, each of which must be chosen from the list of values." ParamCount="1" OptionCount="0" ParamRequired="1" EditParamsAsString="1" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<PARAMS>
-<PARAM Name="values" />
-</PARAMS>
-</DATATYPE>
-<DATATYPE ID="33" IDGroup="4" TypeName="Varchar(20)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<OPTIONS>
-<OPTION Name="BINARY" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="34" IDGroup="4" TypeName="Varchar(45)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<OPTIONS>
-<OPTION Name="BINARY" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="35" IDGroup="4" TypeName="Varchar(255)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-<OPTIONS>
-<OPTION Name="BINARY" Default="0" />
-</OPTIONS>
-</DATATYPE>
-<DATATYPE ID="36" IDGroup="5" TypeName="GEOMETRY" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="38" IDGroup="5" TypeName="LINESTRING" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="39" IDGroup="5" TypeName="POLYGON" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="40" IDGroup="5" TypeName="MULTIPOINT" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="41" IDGroup="5" TypeName="MULTILINESTRING" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="42" IDGroup="5" TypeName="MULTIPOLYGON" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-<DATATYPE ID="43" IDGroup="5" TypeName="GEOMETRYCOLLECTION" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
-</DATATYPE>
-</DATATYPES>
-<COMMON_DATATYPES>
-<COMMON_DATATYPE ID="5" />
-<COMMON_DATATYPE ID="8" />
-<COMMON_DATATYPE ID="20" />
-<COMMON_DATATYPE ID="15" />
-<COMMON_DATATYPE ID="22" />
-<COMMON_DATATYPE ID="28" />
-<COMMON_DATATYPE ID="26" />
-<COMMON_DATATYPE ID="33" />
-<COMMON_DATATYPE ID="34" />
-<COMMON_DATATYPE ID="35" />
-</COMMON_DATATYPES>
-<TABLEPREFIXES>
-<TABLEPREFIX Name="Default (no prefix)" />
-</TABLEPREFIXES>
-<REGIONCOLORS>
-<REGIONCOLOR Color="Red=#FFEEEC" />
-<REGIONCOLOR Color="Yellow=#FEFDED" />
-<REGIONCOLOR Color="Green=#EAFFE5" />
-<REGIONCOLOR Color="Cyan=#ECFDFF" />
-<REGIONCOLOR Color="Blue=#F0F1FE" />
-<REGIONCOLOR Color="Magenta=#FFEBFA" />
-</REGIONCOLORS>
-<POSITIONMARKERS>
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
-</POSITIONMARKERS>
-</SETTINGS>
-<METADATA>
-<REGIONS>
-<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
-<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
-<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
-<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
-<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-</REGIONS>
-<TABLES>
-<TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
-<COLUMNS>
-<COLUMN ID="1169" ColName="YDCMAudit_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement action">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1172" ColName="permission_id" PrevColName="action" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="action object">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1173" ColName="permission_result" PrevColName="itemid" Pos="5" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional action result">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1170" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="14" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of this action">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1754" ColName="date_time" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date and time of this action">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1749" ColName="browser" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="browser codename">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1750" ColName="platform" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="operative system">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1751" ColName="url" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="url for visitors only">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1752" ColName="hits" PrevColName="" Pos="9" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Hits are used for visitors only (flood protection)">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1785" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1176" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1169" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
-<COLUMNS>
-<COLUMN ID="1732" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1297" ColName="current_version" PrevColName="version" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="this is the current version of this page">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1181" ColName="html" PrevColName="content" Pos="2" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="page html">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1440" ColName="xhtml" PrevColName="" Pos="11" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional page xhtml">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1182" ColName="template_pack" PrevColName="" Pos="3" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="template pack used">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1183" ColName="template" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="template name">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1184" ColName="metatags" PrevColName="" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="metatags are used. 1 true, 0 false">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1185" ColName="description" PrevColName="" Pos="6" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="metatag description">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1186" ColName="keywords" PrevColName="" Pos="7" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\a\a," Comments="metatag keywords">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1704" />
-</RELATIONS_END>
-</TABLE>
-<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,NULL,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`cand!
 rag`,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPa!
 ge\a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-0!
 0 00:00:
00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`!
 ,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
-<COLUMNS>
-<COLUMN ID="1191" ColName="content_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1799" ColName="parent_id" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1418" ColName="nleft" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1419" ColName="nright" PrevColName="" Pos="19" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1420" ColName="nlevel" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1195" ColName="position" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="position related to brothers">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1196" ColName="type" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component type name. eg YDCMPage">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1198" ColName="reference" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="internal name">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1199" ColName="state" PrevColName="" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="state code">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1203" ColName="access" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(2)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="access code. 0 private, 1 public">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1204" ColName="searcheable" PrevColName="search" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component will be afected by visitors searches">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1206" ColName="published_date_start" PrevColName="date_start" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1207" ColName="published_date_end" PrevColName="date_end" Pos="17" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1588" ColName="candrag" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be dragged">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1589" ColName="candrop" PrevColName="" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be droppable">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1437" />
-<RELATION_START ID="1692" />
-</RELATIONS_START>
-<INDICES>
-<INDEX ID="1210" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1191" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="460" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
-<COLUMNS>
-<COLUMN ID="1733" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1295" ColName="url" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="link url">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1661" ColName="num_visits" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0," Comments="total of visits">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1706" />
-</RELATIONS_END>
-</TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
-<COLUMNS>
-<COLUMN ID="1219" ColName="language_id" PrevColName="lang" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1218" ColName="name" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(50)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language name">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1220" ColName="active" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="is active. 1 true, 0 false">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1221" ColName="visitors_default" PrevColName="default_lang" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="this is the default language for visitors side. 1 true, 0 false">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1586" ColName="admin_default" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="default language for content creation. 1 true, 0 false">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1366" />
-<RELATION_START ID="1693" />
-</RELATIONS_START>
-<INDICES>
-<INDEX ID="1290" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1219" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="680" YPos="920" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
-<COLUMNS>
-<COLUMN ID="1231" ColName="search_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1232" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="search date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1236" ColName="word" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="word used on search">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<INDICES>
-<INDEX ID="1237" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1231" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="800" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMRoot\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,1,\!
 a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUseradministrators\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUservisitors\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,\aadmin\a,\a21232f297a57a5a743!
 894a0e4a801fc3\a,\aAdmin\a,\aemail at host.com\a,\aother info\a,\!
 aen\a,1,
\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,40,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a,0,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,\afrancisco\a,\ab5d5f67b30809413156655abdda382a3\a,\aFrancisco Azevedo\a,\a\a,\a\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2004-05-08 05:05:06\a,19,\a2006-08-08 16:26:39\a,\a2006-08-08 17:18:19\a,2,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`templat!
 e`) VALUES (102,101,5,6,5,\apieter\a,\a\a,\aPieter\a,\a\a,\aaasdasdasd\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2001-01-01 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,\adavid\a,\a\a,\aDavid\a,\a\a,\a\a,\aen\a,1,\a2006-08-08 16:27:35\a,\a2006-08-08 16:27:35\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101,\a2006-08-08 16:28:01\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`!
 ,`created_date`,`type`,`position`,`template`) VALUES (104,100,!
 12,17,4,
\apedro\a,\a\a,\aPedro Cerqueira\a,\a\a,\axpto\a,\aen\a,1,\a2006-08-08 16:29:51\a,\a2006-08-08 16:29:51\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:30:06\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,\alimpeza\a,\a\a,\aLimpeza\a,\a\a,\aasfdasdasdasd\a,\aen\a,1,\a2006-08-08 16:32:11\a,\a2006-08-08 16:32:11\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:32:26\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`crea!
 ted_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,\ameireles\a,\a\a,\aMeireles\a,\a\a,\ameireles\a,\aen\a,1,\a2006-08-08 17:14:44\a,\a2006-08-08 17:14:44\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 17:15:09\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,\amarc\a,\a\a,\aMarc\a,\a\a,\aVassoutinha\a,\aen\a,1,\a2006-08-09 15:57:27\a,\a2006-12-09 15:57:27\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 15:57:49\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_co!
 unter`,`login_last`,`login_current`,`created_user`,`created_da!
 te`,`typ
e`,`position`,`template`) VALUES (113,100,18,19,4,\aextra\a,\a\a,\aExtra user\a,\a\a,\auser OKuser OKuser OK\a,\aen\a,1,\a2006-08-09 16:13:57\a,\a2006-08-09 16:13:57\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 16:14:20\a,\aYDCMUseradministrator\a,1,\adefault\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
-<COLUMNS>
-<COLUMN ID="1238" ColName="user_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1793" ColName="parent_id" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1758" ColName="type " PrevColName="type_2" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMVisitor\a" Comments="\aYDCMAdministrator\a or \aYDCMVisitor\a">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1240" ColName="nleft" PrevColName="path" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1241" ColName="nright" PrevColName="position" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nright">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1242" ColName="nlevel" PrevColName="children" Pos="5" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nlevel">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1769" ColName="position" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="need for YDDatabaseTree but not used here">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1244" ColName="username" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1245" ColName="password" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1246" ColName="name" PrevColName="" Pos="9" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1247" ColName="email" PrevColName="" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1248" ColName="other" PrevColName="" Pos="11" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="other user informations">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1249" ColName="language_id" PrevColName="language" Pos="12" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="language code for administration">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1795" ColName="template" PrevColName="" Pos="21" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\adefault\a" Comments="Administration template name ">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1250" ColName="state" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="user state">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1251" ColName="login_start" PrevColName="" Pos="14" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the start date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1252" ColName="login_end" PrevColName="" Pos="15" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the end date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1255" ColName="login_counter" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="(11)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="login counter">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1256" ColName="login_last" PrevColName="" Pos="19" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="last login date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1257" ColName="login_current" PrevColName="" Pos="20" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of current session">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1254" ColName="created_user" PrevColName="" Pos="17" idDatatype="5" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="id  of user that created this user">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1253" ColName="created_date" PrevColName="created" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="creation date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1383" />
-<RELATION_START ID="1436" />
-<RELATION_START ID="1410" />
-<RELATION_START ID="1741" />
-<RELATION_START ID="1784" />
-</RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1366" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1238" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,1,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\aa!
 ss local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat!
 =0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinke!
 dObject=
"0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
-<COLUMNS>
-<COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1734" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1671" ColName="state_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1673" ColName="urgency_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1371" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1372" ColName="subject" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1376" ColName="text" PrevColName="" Pos="6" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1600" ColName="creation_date" PrevColName="" Pos="13" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1379" ColName="reportedby_user" PrevColName="reported_by" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1380" ColName="reportedby_local" PrevColName="reported_to_in" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1381" ColName="reportedby_date" PrevColName="reported_to" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1676" ColName="reportedby_type" PrevColName="reported_by_type" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1601" ColName="assignedto_user" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1603" ColName="assignedto_local" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1604" ColName="assignedto_date" PrevColName="" Pos="16" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1675" ColName="assignedto_type" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1409" />
-</RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1383" />
-<RELATION_END ID="1712" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1582" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1581" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1780" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
-<COLUMNS>
-<COLUMN ID="1403" ColName="response_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1701" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1584" ColName="post_id" PrevColName="" Pos="4" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1407" ColName="date" PrevColName="" Pos="3" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1408" ColName="description" PrevColName="" Pos="4" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1409" />
-<RELATION_END ID="1410" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1404" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1403" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="500" YPos="320" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
-<COLUMNS>
-<COLUMN ID="1578" ColName="lock_id" PrevColName="" Pos="2" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="lock ID">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1432" ColName="content_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="component code">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1434" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="user id that lock component">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1787" ColName="datetime " PrevColName="" Pos="3" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="lock date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1436" />
-<RELATION_END ID="1437" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1579" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1578" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="660" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
-<COLUMNS>
-<COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1735" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1542" ColName="date" PrevColName="" Pos="2" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="post date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1543" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster username">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1544" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster email">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1545" ColName="message" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1546" ColName="active" PrevColName="" Pos="6" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="post is active and can be seen after creation. 1 yes, 0 no">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1663" ColName="website" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1664" ColName="ip" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(15)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1709" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1540" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1539" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="680" YPos="1020" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
-<COLUMNS>
-<COLUMN ID="1631" ColName="download_is" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1633" ColName="date" PrevColName="" Pos="1" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1634" ColName="filename" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<INDICES>
-<INDEX ID="1632" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1631" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_!
 id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`ver!
 sion_date`,`user_id`) VALUES (10,11,\aen\a,\aPortals\a,1,\a000!
 0-00-00 
00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a,100);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
-<COLUMNS>
-<COLUMN ID="1680" ColName="component_id" PrevColName="title_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1745" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="User that created this element">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1684" ColName="content_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1686" ColName="language_id" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="Language code of this title translation">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1682" ColName="title" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1683" ColName="version_default" PrevColName="rendered" Pos="2" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="This is the default version">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1737" ColName="version_date" PrevColName="default_date" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Version created in this date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1704" />
-<RELATION_START ID="1706" />
-<RELATION_START ID="1709" />
-<RELATION_START ID="1712" />
-</RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1692" />
-<RELATION_END ID="1693" />
-<RELATION_END ID="1741" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1681" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1680" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (39,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (42,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (46,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`!
 ,`date_end`,`user_id`) VALUES (51,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (57,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (64,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (70,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (75,\aYDCMRootmenu\a,\adelete\a,NU!
 LL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nIN!
 SERT INT
O `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (80,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (85,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (90,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (95,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`ob!
 ject_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (100,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (105,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (111,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (115,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUE!
 S (116,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a!
 ,\a0000-
00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (120,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,111);\n" TableOptions="DelayKeyTblUpdates=0\nPackKe!
 ys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
-<COLUMNS>
-<COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1773" ColName="user_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1775" ColName="object" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1776" ColName="object_action" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1777" ColName="object_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1778" ColName="schedule" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="This permission has start and date time">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1779" ColName="date_start" PrevColName="" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1780" ColName="date_end" PrevColName="" Pos="6" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1785" />
-</RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1784" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1782" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1781" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
-</TABLES>
-<RELATIONS>
-<RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="38" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="52" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
-<RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="5" EndIntervalOffsetY="-4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
-<RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
-<RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="31" CaptionOffsetY="-6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
-<RELATION ID="1692" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1678" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="-3" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-44" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
-<RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="31" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
-<RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1704" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1160" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
-<RELATION ID="1706" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1163" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
-<RELATION ID="1709" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="-4" StartIntervalOffsetX="-2" StartIntervalOffsetY="-53" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
-<RELATION ID="1712" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="1" CaptionOffsetY="1" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
-<RELATION ID="1741" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1678" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
-<RELATION ID="1784" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-35" CaptionOffsetY="-26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
-<RELATION ID="1785" RelationName="permission_id" Kind="2" SrcTable="1771" DestTable="1158" FKFields="permission_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
-</RELATIONS>
-<NOTES>
-</NOTES>
-<IMAGES>
-</IMAGES>
-</METADATA>
-<PLUGINDATA>
-<PLUGINDATARECORDS>
-</PLUGINDATARECORDS>
-</PLUGINDATA>
-<QUERYDATA>
-<QUERYRECORDS>
-</QUERYRECORDS>
-</QUERYDATA>
-<LINKEDMODELS>
-</LINKEDMODELS>
-</DBMODEL>



From ximian at mail.berlios.de  Wed Aug 16 17:46:00 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 16 Aug 2006 17:46:00 +0200
Subject: [ydf-devel] r2026 - YDFramework2.0/trunk/examples/cm
Message-ID: <200608161546.k7GFk0xm006510@sheep.berlios.de>

Author: ximian
Date: 2006-08-16 17:45:46 +0200 (Wed, 16 Aug 2006)
New Revision: 2026

Added:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
Modified:
   YDFramework2.0/trunk/examples/cm/instructions.txt
Log:
- added the DBDesigner4.xml scheme to example directory
- instructions.txt now point to the right file

Added: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-16 15:44:24 UTC (rev 2025)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-16 15:45:46 UTC (rev 2026)
@@ -0,0 +1,1122 @@
+<?xml version="1.0" standalone="yes" ?>
+<DBMODEL Version="4.0">
+<SETTINGS>
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="119" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<DATATYPEGROUPS>
+<DATATYPEGROUP Name="Numeric Types" Icon="1" />
+<DATATYPEGROUP Name="Date and Time Types" Icon="2" />
+<DATATYPEGROUP Name="String Types" Icon="3" />
+<DATATYPEGROUP Name="Blob and Text Types" Icon="4" />
+<DATATYPEGROUP Name="User defined Types" Icon="5" />
+<DATATYPEGROUP Name="Geographic Types" Icon="6" />
+</DATATYPEGROUPS>
+<DATATYPES>
+<DATATYPE ID="1" IDGroup="0" TypeName="TINYINT" Description="A very small integer. The signed range is -128 to 127. The unsigned range is 0 to 255." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="1" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="2" IDGroup="0" TypeName="SMALLINT" Description="A small integer. The signed range is -32768 to 32767. The unsigned range is 0 to 65535." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="1" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="3" IDGroup="0" TypeName="MEDIUMINT" Description="A medium-size integer. The signed range is -8388608 to 8388607. The unsigned range is 0 to 16777215." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="1" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="4" IDGroup="0" TypeName="INT" Description="A normal-size integer. The signed range is -2147483648 to 2147483647. The unsigned range is 0 to 4294967295." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="1" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="0" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="5" IDGroup="0" TypeName="INTEGER" Description="A normal-size integer. The signed range is -2147483648 to 2147483647. The unsigned range is 0 to 4294967295." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="1" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="1" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="6" IDGroup="0" TypeName="BIGINT" Description="A large integer. The signed range is -9223372036854775808 to 9223372036854775807. The unsigned range is 0 to 18446744073709551615." ParamCount="1" OptionCount="2" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="UNSIGNED" Default="0" />
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="7" IDGroup="0" TypeName="FLOAT" Description="A small (single-precision) floating-point number. Cannot be unsigned. Allowable values are -3.402823466E+38 to -1.175494351E-38, 0, and 1.175494351E-38 to 3.402823466E+38." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="precision" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="8" IDGroup="0" TypeName="FLOAT" Description="A small (single-precision) floating-point number. Cannot be unsigned. Allowable values are -3.402823466E+38 to -1.175494351E-38, 0, and 1.175494351E-38 to 3.402823466E+38." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="9" IDGroup="0" TypeName="DOUBLE" Description="A normal-size (double-precision) floating-point number. Cannot be unsigned. Allowable values are -1.7976931348623157E+308 to -2.2250738585072014E-308, 0, and 2.2250738585072014E-308 to 1.7976931348623157E+308." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="10" IDGroup="0" TypeName="DOUBLE PRECISION" Description="This is a synonym for DOUBLE." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="11" IDGroup="0" TypeName="REAL" Description="This is a synonym for DOUBLE." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="2" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="12" IDGroup="0" TypeName="DECIMAL" Description="An unpacked floating-point number. Cannot be unsigned. Behaves like a CHAR column." ParamCount="2" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="3" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="13" IDGroup="0" TypeName="NUMERIC" Description="This is a synonym for DECIMAL." ParamCount="2" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="3" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+<PARAM Name="decimals" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="ZEROFILL" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="14" IDGroup="1" TypeName="DATE" Description="A date. The supported range is \a1000-01-01\a to \a9999-12-31\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="15" IDGroup="1" TypeName="DATETIME" Description="A date and time combination. The supported range is \a1000-01-01 00:00:00\a to \a9999-12-31 23:59:59\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="16" IDGroup="1" TypeName="TIMESTAMP" Description="A timestamp. The range is \a1970-01-01 00:00:00\a to sometime in the year 2037. The length can be 14 (or missing), 12, 10, 8, 6, 4, or 2 representing YYYYMMDDHHMMSS, ... , YYYYMMDD, ... , YY formats." ParamCount="1" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+</DATATYPE>
+<DATATYPE ID="17" IDGroup="1" TypeName="TIME" Description="A time. The range is \a-838:59:59\a to \a838:59:59\a." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="18" IDGroup="1" TypeName="YEAR" Description="A year in 2- or 4-digit format (default is 4-digit)." ParamCount="1" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+</DATATYPE>
+<DATATYPE ID="19" IDGroup="2" TypeName="CHAR" Description="A fixed-length string (1 to 255 characters) that is always right-padded with spaces to the specified length when stored. values are sorted and compared in case-insensitive fashion according to the default character set unless the BINARY keyword is given." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="BINARY" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="20" IDGroup="2" TypeName="VARCHAR" Description="A variable-length string (1 to 255 characters). Values are sorted and compared in case-sensitive fashion unless the BINARY keyword is given." ParamCount="1" OptionCount="1" ParamRequired="1" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="length" />
+</PARAMS>
+<OPTIONS>
+<OPTION Name="BINARY" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="21" IDGroup="2" TypeName="BIT" Description="This is a synonym for CHAR(1)." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="22" IDGroup="2" TypeName="BOOL" Description="This is a synonym for CHAR(1)." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="23" IDGroup="3" TypeName="TINYBLOB" Description="A column maximum length of 255 (2^8 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="24" IDGroup="3" TypeName="BLOB" Description="A column maximum length of 65535 (2^16 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="25" IDGroup="3" TypeName="MEDIUMBLOB" Description="A column maximum length of 16777215 (2^24 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="26" IDGroup="3" TypeName="LONGBLOB" Description="A column maximum length of 4294967295 (2^32 - 1) characters. Values are sorted and compared in case-sensitive fashion." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="27" IDGroup="3" TypeName="TINYTEXT" Description="A column maximum length of 255 (2^8 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="28" IDGroup="3" TypeName="TEXT" Description="A column maximum length of 65535 (2^16 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="29" IDGroup="3" TypeName="MEDIUMTEXT" Description="A column maximum length of 16777215 (2^24 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="30" IDGroup="3" TypeName="LONGTEXT" Description="A column maximum length of 4294967295 (2^32 - 1) characters." ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="31" IDGroup="3" TypeName="ENUM" Description="An enumeration. A string object that can have only one value, chosen from the list of values." ParamCount="1" OptionCount="0" ParamRequired="1" EditParamsAsString="1" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="values" />
+</PARAMS>
+</DATATYPE>
+<DATATYPE ID="32" IDGroup="3" TypeName="SET" Description="A set. A string object that can have zero or more values, each of which must be chosen from the list of values." ParamCount="1" OptionCount="0" ParamRequired="1" EditParamsAsString="1" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<PARAMS>
+<PARAM Name="values" />
+</PARAMS>
+</DATATYPE>
+<DATATYPE ID="33" IDGroup="4" TypeName="Varchar(20)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<OPTIONS>
+<OPTION Name="BINARY" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="34" IDGroup="4" TypeName="Varchar(45)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<OPTIONS>
+<OPTION Name="BINARY" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="35" IDGroup="4" TypeName="Varchar(255)" Description="" ParamCount="0" OptionCount="1" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+<OPTIONS>
+<OPTION Name="BINARY" Default="0" />
+</OPTIONS>
+</DATATYPE>
+<DATATYPE ID="36" IDGroup="5" TypeName="GEOMETRY" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="38" IDGroup="5" TypeName="LINESTRING" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="39" IDGroup="5" TypeName="POLYGON" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="40" IDGroup="5" TypeName="MULTIPOINT" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="41" IDGroup="5" TypeName="MULTILINESTRING" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="42" IDGroup="5" TypeName="MULTIPOLYGON" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+<DATATYPE ID="43" IDGroup="5" TypeName="GEOMETRYCOLLECTION" Description="Geographic Datatype" ParamCount="0" OptionCount="0" ParamRequired="0" EditParamsAsString="0" SynonymGroup="0" PhysicalMapping="0" PhysicalTypeName="" >
+</DATATYPE>
+</DATATYPES>
+<COMMON_DATATYPES>
+<COMMON_DATATYPE ID="5" />
+<COMMON_DATATYPE ID="8" />
+<COMMON_DATATYPE ID="20" />
+<COMMON_DATATYPE ID="15" />
+<COMMON_DATATYPE ID="22" />
+<COMMON_DATATYPE ID="28" />
+<COMMON_DATATYPE ID="26" />
+<COMMON_DATATYPE ID="33" />
+<COMMON_DATATYPE ID="34" />
+<COMMON_DATATYPE ID="35" />
+</COMMON_DATATYPES>
+<TABLEPREFIXES>
+<TABLEPREFIX Name="Default (no prefix)" />
+</TABLEPREFIXES>
+<REGIONCOLORS>
+<REGIONCOLOR Color="Red=#FFEEEC" />
+<REGIONCOLOR Color="Yellow=#FEFDED" />
+<REGIONCOLOR Color="Green=#EAFFE5" />
+<REGIONCOLOR Color="Cyan=#ECFDFF" />
+<REGIONCOLOR Color="Blue=#F0F1FE" />
+<REGIONCOLOR Color="Magenta=#FFEBFA" />
+</REGIONCOLORS>
+<POSITIONMARKERS>
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+<POSITIONMARKER ZoomFac="-1.0" X="0" Y="0" />
+</POSITIONMARKERS>
+</SETTINGS>
+<METADATA>
+<REGIONS>
+<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
+<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+</REGIONS>
+<TABLES>
+<TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
+<COLUMNS>
+<COLUMN ID="1169" ColName="YDCMAudit_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement action">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1172" ColName="permission_id" PrevColName="action" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="action object">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1173" ColName="permission_result" PrevColName="itemid" Pos="5" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional action result">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1170" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="14" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of this action">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1754" ColName="date_time" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date and time of this action">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1749" ColName="browser" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="browser codename">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1750" ColName="platform" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="operative system">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1751" ColName="url" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="url for visitors only">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1752" ColName="hits" PrevColName="" Pos="9" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Hits are used for visitors only (flood protection)">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1785" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1176" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1169" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
+<COLUMNS>
+<COLUMN ID="1732" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1297" ColName="current_version" PrevColName="version" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="this is the current version of this page">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1181" ColName="html" PrevColName="content" Pos="2" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="page html">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1440" ColName="xhtml" PrevColName="" Pos="11" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional page xhtml">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1182" ColName="template_pack" PrevColName="" Pos="3" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="template pack used">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1183" ColName="template" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="template name">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1184" ColName="metatags" PrevColName="" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="metatags are used. 1 true, 0 false">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1185" ColName="description" PrevColName="" Pos="6" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="metatag description">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1186" ColName="keywords" PrevColName="" Pos="7" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\a\a," Comments="metatag keywords">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1704" />
+</RELATIONS_END>
+</TABLE>
+<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,NULL,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`cand!
 rag`,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPa!
 ge\a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-0!
 0 00:00:
00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`!
 ,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
+<COLUMNS>
+<COLUMN ID="1191" ColName="content_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1799" ColName="parent_id" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1418" ColName="nleft" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1419" ColName="nright" PrevColName="" Pos="19" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1420" ColName="nlevel" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1195" ColName="position" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="position related to brothers">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1196" ColName="type" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component type name. eg YDCMPage">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1198" ColName="reference" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="internal name">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1199" ColName="state" PrevColName="" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="state code">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1203" ColName="access" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(2)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="access code. 0 private, 1 public">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1204" ColName="searcheable" PrevColName="search" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component will be afected by visitors searches">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1206" ColName="published_date_start" PrevColName="date_start" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1207" ColName="published_date_end" PrevColName="date_end" Pos="17" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1588" ColName="candrag" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be dragged">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1589" ColName="candrop" PrevColName="" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="node can be droppable">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1437" />
+<RELATION_START ID="1692" />
+</RELATIONS_START>
+<INDICES>
+<INDEX ID="1210" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1191" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="460" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
+<COLUMNS>
+<COLUMN ID="1733" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1295" ColName="url" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="link url">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1661" ColName="num_visits" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0," Comments="total of visits">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1706" />
+</RELATIONS_END>
+</TABLE>
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
+<COLUMNS>
+<COLUMN ID="1219" ColName="language_id" PrevColName="lang" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1218" ColName="name" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(50)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language name">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1220" ColName="active" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="is active. 1 true, 0 false">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1221" ColName="visitors_default" PrevColName="default_lang" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="this is the default language for visitors side. 1 true, 0 false">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1586" ColName="admin_default" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="default language for content creation. 1 true, 0 false">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1366" />
+<RELATION_START ID="1693" />
+</RELATIONS_START>
+<INDICES>
+<INDEX ID="1290" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1219" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="680" YPos="920" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
+<COLUMNS>
+<COLUMN ID="1231" ColName="search_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1232" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="search date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1236" ColName="word" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="word used on search">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<INDICES>
+<INDEX ID="1237" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1231" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="800" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMRoot\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,1,\!
 a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUseradministrators\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUservisitors\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,\aadmin\a,\a21232f297a57a5a743!
 894a0e4a801fc3\a,\aAdmin\a,\aemail at host.com\a,\aother info\a,\!
 aen\a,1,
\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,40,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a,0,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,\afrancisco\a,\ab5d5f67b30809413156655abdda382a3\a,\aFrancisco Azevedo\a,\a\a,\a\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2004-05-08 05:05:06\a,19,\a2006-08-08 16:26:39\a,\a2006-08-08 17:18:19\a,2,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`templat!
 e`) VALUES (102,101,5,6,5,\apieter\a,\a\a,\aPieter\a,\a\a,\aaasdasdasd\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2001-01-01 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,\adavid\a,\a\a,\aDavid\a,\a\a,\a\a,\aen\a,1,\a2006-08-08 16:27:35\a,\a2006-08-08 16:27:35\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101,\a2006-08-08 16:28:01\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`!
 ,`created_date`,`type`,`position`,`template`) VALUES (104,100,!
 12,17,4,
\apedro\a,\a\a,\aPedro Cerqueira\a,\a\a,\axpto\a,\aen\a,1,\a2006-08-08 16:29:51\a,\a2006-08-08 16:29:51\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:30:06\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,\alimpeza\a,\a\a,\aLimpeza\a,\a\a,\aasfdasdasdasd\a,\aen\a,1,\a2006-08-08 16:32:11\a,\a2006-08-08 16:32:11\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:32:26\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`crea!
 ted_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,\ameireles\a,\a\a,\aMeireles\a,\a\a,\ameireles\a,\aen\a,1,\a2006-08-08 17:14:44\a,\a2006-08-08 17:14:44\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 17:15:09\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,\amarc\a,\a\a,\aMarc\a,\a\a,\aVassoutinha\a,\aen\a,1,\a2006-08-09 15:57:27\a,\a2006-12-09 15:57:27\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 15:57:49\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_co!
 unter`,`login_last`,`login_current`,`created_user`,`created_da!
 te`,`typ
e`,`position`,`template`) VALUES (113,100,18,19,4,\aextra\a,\a\a,\aExtra user\a,\a\a,\auser OKuser OKuser OK\a,\aen\a,1,\a2006-08-09 16:13:57\a,\a2006-08-09 16:13:57\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 16:14:20\a,\aYDCMUseradministrator\a,1,\adefault\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
+<COLUMNS>
+<COLUMN ID="1238" ColName="user_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1793" ColName="parent_id" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1758" ColName="type " PrevColName="type_2" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMVisitor\a" Comments="\aYDCMAdministrator\a or \aYDCMVisitor\a">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1240" ColName="nleft" PrevColName="path" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1241" ColName="nright" PrevColName="position" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nright">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1242" ColName="nlevel" PrevColName="children" Pos="5" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nlevel">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1769" ColName="position" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="need for YDDatabaseTree but not used here">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1244" ColName="username" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1245" ColName="password" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1246" ColName="name" PrevColName="" Pos="9" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1247" ColName="email" PrevColName="" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1248" ColName="other" PrevColName="" Pos="11" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="other user informations">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1249" ColName="language_id" PrevColName="language" Pos="12" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="language code for administration">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1795" ColName="template" PrevColName="" Pos="21" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\adefault\a" Comments="Administration template name ">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1250" ColName="state" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="user state">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1251" ColName="login_start" PrevColName="" Pos="14" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the start date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1252" ColName="login_end" PrevColName="" Pos="15" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the end date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1255" ColName="login_counter" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="(11)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="login counter">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1256" ColName="login_last" PrevColName="" Pos="19" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="last login date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1257" ColName="login_current" PrevColName="" Pos="20" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of current session">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1254" ColName="created_user" PrevColName="" Pos="17" idDatatype="5" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="id  of user that created this user">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1253" ColName="created_date" PrevColName="created" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="creation date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1383" />
+<RELATION_START ID="1436" />
+<RELATION_START ID="1410" />
+<RELATION_START ID="1741" />
+<RELATION_START ID="1784" />
+</RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="1366" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1238" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,1,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\aa!
 ss local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat!
 =0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinke!
 dObject=
"0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
+<COLUMNS>
+<COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1734" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1671" ColName="state_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1673" ColName="urgency_id" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1371" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1372" ColName="subject" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1376" ColName="text" PrevColName="" Pos="6" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1600" ColName="creation_date" PrevColName="" Pos="13" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1379" ColName="reportedby_user" PrevColName="reported_by" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1380" ColName="reportedby_local" PrevColName="reported_to_in" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1381" ColName="reportedby_date" PrevColName="reported_to" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1676" ColName="reportedby_type" PrevColName="reported_by_type" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1601" ColName="assignedto_user" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1603" ColName="assignedto_local" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1604" ColName="assignedto_date" PrevColName="" Pos="16" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1675" ColName="assignedto_type" PrevColName="" Pos="15" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1409" />
+</RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="1383" />
+<RELATION_END ID="1712" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1582" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1581" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1780" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
+<COLUMNS>
+<COLUMN ID="1403" ColName="response_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1701" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1584" ColName="post_id" PrevColName="" Pos="4" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1407" ColName="date" PrevColName="" Pos="3" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1408" ColName="description" PrevColName="" Pos="4" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1409" />
+<RELATION_END ID="1410" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1404" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1403" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="500" YPos="320" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
+<COLUMNS>
+<COLUMN ID="1578" ColName="lock_id" PrevColName="" Pos="2" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="lock ID">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1432" ColName="content_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="component code">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1434" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="user id that lock component">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1787" ColName="datetime " PrevColName="" Pos="3" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="lock date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1436" />
+<RELATION_END ID="1437" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1579" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1578" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="660" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<COLUMNS>
+<COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1735" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1542" ColName="date" PrevColName="" Pos="2" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="post date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1543" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster username">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1544" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster email">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1545" ColName="message" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1546" ColName="active" PrevColName="" Pos="6" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="post is active and can be seen after creation. 1 yes, 0 no">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1663" ColName="website" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1664" ColName="ip" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(15)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1709" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1540" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1539" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="680" YPos="1020" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
+<COLUMNS>
+<COLUMN ID="1631" ColName="download_is" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1633" ColName="date" PrevColName="" Pos="1" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1634" ColName="filename" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<INDICES>
+<INDEX ID="1632" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1631" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_!
 id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`ver!
 sion_date`,`user_id`) VALUES (10,11,\aen\a,\aPortals\a,1,\a000!
 0-00-00 
00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a,100);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
+<COLUMNS>
+<COLUMN ID="1680" ColName="component_id" PrevColName="title_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1745" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="User that created this element">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1684" ColName="content_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1686" ColName="language_id" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="Language code of this title translation">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1682" ColName="title" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1683" ColName="version_default" PrevColName="rendered" Pos="2" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="This is the default version">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1737" ColName="version_date" PrevColName="default_date" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Version created in this date">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1704" />
+<RELATION_START ID="1706" />
+<RELATION_START ID="1709" />
+<RELATION_START ID="1712" />
+</RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="1692" />
+<RELATION_END ID="1693" />
+<RELATION_END ID="1741" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1681" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1680" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (39,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (42,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (46,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`!
 ,`date_end`,`user_id`) VALUES (51,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (57,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (64,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (70,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (75,\aYDCMRootmenu\a,\adelete\a,NU!
 LL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nIN!
 SERT INT
O `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (80,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (85,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (90,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (95,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`ob!
 ject_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (100,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (105,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (111,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (115,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUE!
 S (116,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a!
 ,\a0000-
00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (120,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,111);\n" TableOptions="DelayKeyTblUpdates=0\nPackKe!
 ys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<COLUMNS>
+<COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1773" ColName="user_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1775" ColName="object" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1776" ColName="object_action" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1777" ColName="object_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1778" ColName="schedule" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="This permission has start and date time">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1779" ColName="date_start" PrevColName="" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1780" ColName="date_end" PrevColName="" Pos="6" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="1785" />
+</RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="1784" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="1782" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="1781" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
+</TABLES>
+<RELATIONS>
+<RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="38" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="52" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
+<RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="5" EndIntervalOffsetY="-4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
+<RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
+<RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="31" CaptionOffsetY="-6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
+<RELATION ID="1692" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1678" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="-3" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-44" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
+<RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="31" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
+<RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1704" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1160" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
+<RELATION ID="1706" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1163" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
+<RELATION ID="1709" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="-4" StartIntervalOffsetX="-2" StartIntervalOffsetY="-53" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
+<RELATION ID="1712" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="1" CaptionOffsetY="1" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
+<RELATION ID="1741" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1678" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
+<RELATION ID="1784" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-35" CaptionOffsetY="-26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
+<RELATION ID="1785" RelationName="permission_id" Kind="2" SrcTable="1771" DestTable="1158" FKFields="permission_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+</RELATIONS>
+<NOTES>
+</NOTES>
+<IMAGES>
+</IMAGES>
+</METADATA>
+<PLUGINDATA>
+<PLUGINDATARECORDS>
+</PLUGINDATARECORDS>
+</PLUGINDATA>
+<QUERYDATA>
+<QUERYRECORDS>
+</QUERYRECORDS>
+</QUERYDATA>
+<LINKEDMODELS>
+</LINKEDMODELS>
+</DBMODEL>

Modified: YDFramework2.0/trunk/examples/cm/instructions.txt
===================================================================
--- YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-16 15:44:24 UTC (rev 2025)
+++ YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-16 15:45:46 UTC (rev 2026)
@@ -1,6 +1,6 @@
 1 - Get DBDesigner4 (opensource db scheme editor): http://fabforce.net/dbdesigner4/
 
-	1.1 - open YDFramework2\YDClasses\YDCMComponent\DBDesigner4.xml in DBDesigner4
+	1.1 - open DBDesigner4.xml in DBDesigner4
 
 	1.2 - in DBDesigner4 select FILE -> EXPORT -> SQL CREATE SCRIPT
 



From ximian at mail.berlios.de  Wed Aug 16 17:56:04 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 16 Aug 2006 17:56:04 +0200
Subject: [ydf-devel] r2027 - YDFramework2.0/trunk/examples/cm
Message-ID: <200608161556.k7GFu4Yl007324@sheep.berlios.de>

Author: ximian
Date: 2006-08-16 17:55:54 +0200 (Wed, 16 Aug 2006)
New Revision: 2027

Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
Log:
DBDesigner4.xml has now correct permissions as example

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-16 15:45:46 UTC (rev 2026)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-16 15:55:54 UTC (rev 2027)
@@ -258,13 +258,13 @@
 </SETTINGS>
 <METADATA>
 <REGIONS>
+<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
 <REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
-<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
-<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
-<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
-<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
 </REGIONS>
 <TABLES>
 <TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
@@ -1027,7 +1027,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (39,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (42,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (46,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`!
 ,`date_end`,`user_id`) VALUES (51,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (57,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (64,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (70,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (75,\aYDCMRootmenu\a,\adelete\a,NU!
 LL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nIN!
 SERT INT
O `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (80,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (85,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (90,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (95,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`ob!
 ject_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (100,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (105,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (111,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (115,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUE!
 S (116,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a!
 ,\a0000-
00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (120,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,111);\n" TableOptions="DelayKeyTblUpdates=0\nPackKe!
 ys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`da!
 te_end`,`user_id`) VALUES (120,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>



From ximian at mail.berlios.de  Wed Aug 16 18:27:26 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 16 Aug 2006 18:27:26 +0200
Subject: [ydf-devel] r2028 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers
Message-ID: <200608161627.k7GGRQmP009738@sheep.berlios.de>

Author: ximian
Date: 2006-08-16 18:27:15 +0200 (Wed, 16 Aug 2006)
New Revision: 2028

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
Log:
added translation about users

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-16 15:55:54 UTC (rev 2027)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/en.php	2006-08-16 16:27:15 UTC (rev 2028)
@@ -46,6 +46,7 @@
 $GLOBALS['t']['user details updated'] = 'User details updated';
 $GLOBALS['t']['password not updated'] = 'Password was not updated';
 $GLOBALS['t']['user not updated'] = 'User was not updated';
+$GLOBALS['t']['user added'] = 'New user added';
 $GLOBALS['t']['administrator and children'] = 'Administrator and children';
 $GLOBALS['t']['children only'] = 'Children only';
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-16 15:55:54 UTC (rev 2027)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-16 16:27:15 UTC (rev 2028)
@@ -46,6 +46,7 @@
 $GLOBALS['t']['user details updated'] = 'Informa&ccedil;&otilde;es do utilizador actualizadas';
 $GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
 $GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
+$GLOBALS['t']['user added'] = 'Utilizador adicionado';
 $GLOBALS['t']['administrator and children'] = 'Administrador e sub-administratores';
 $GLOBALS['t']['children only'] = 'Apenas sub-administratores';
 



From pclaerhout at mail.berlios.de  Mon Aug 21 17:43:39 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 21 Aug 2006 17:43:39 +0200
Subject: [ydf-devel] r2029 - in YDFramework2.0/trunk/examples/weblog:
	include manage
Message-ID: <200608211543.k7LFhd9t019021@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-21 17:43:38 +0200 (Mon, 21 Aug 2006)
New Revision: 2029

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
Cleaned up the way the comments view is looking.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-16 16:27:15 UTC (rev 2028)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-21 15:43:38 UTC (rev 2029)
@@ -389,6 +389,7 @@
 
         // Get the comments for an item
         function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1, $public_only=false ) {
+            /*
             if ( $item_id ) {
                 $query = 'SELECT * FROM #_comments WHERE item_id = ' . $this->str( $item_id );
             } else {
@@ -397,6 +398,14 @@
                     $query .= ' and i.is_draft = 0';
                 }
             }
+            */
+            $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
+            if ( $item_id ) {
+                $query .= ' and item_id = ' . $this->str( $item_id );
+            }
+            if ( $public_only == true ) {
+                $query .= ' and i.is_draft = 0';
+            }
             $records = $this->db->getRecords( $this->_prepareQuery( $query, $order ), $limit, $offset );
             foreach ( $records as $key=>$record ) {
                 $records[$key]['comment'] = trim( strip_tags( $record['comment'] ) );

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-16 16:27:15 UTC (rev 2028)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-21 15:43:38 UTC (rev 2029)
@@ -90,12 +90,17 @@
                     {if $comment.item_is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowL">
-                    {if $comment.item_is_draft eq '1'}<i>{/if}
+                    {*{if $comment.item_is_draft eq '1'}<i>{/if}
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
                     {if $comment.item_title}
                         <br/>
                         {t w="item"}: {$comment.item_title}
                     {/if}
+                    {if $comment.item_is_draft eq '1'}</i>{/if}*}
+                    {if $comment.item_is_draft eq '1'}<i>{/if}
+                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
+                    <br/>
+                    {$comment.comment|bbcode|strip_tags|truncate}
                     {if $comment.item_is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">



From ximian at mail.berlios.de  Tue Aug 22 02:34:33 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 02:34:33 +0200
Subject: [ydf-devel] r2030 - YDFramework2.0/trunk/examples/ajax
Message-ID: <200608220034.k7M0YX4n032666@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 02:32:54 +0200 (Tue, 22 Aug 2006)
New Revision: 2030

Added:
   YDFramework2.0/trunk/examples/ajax/two_forms.php
Log:
added a YDAjax example that demonstrates how to use more than one YDForm (with ajax calls) in same template

Added: YDFramework2.0/trunk/examples/ajax/two_forms.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/two_forms.php	2006-08-21 15:43:38 UTC (rev 2029)
+++ YDFramework2.0/trunk/examples/ajax/two_forms.php	2006-08-22 00:32:54 UTC (rev 2030)
@@ -0,0 +1,84 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDForm.php' );
+    YDInclude( 'YDAjax.php' );
+	
+
+    // Class definition
+    class two_forms extends YDRequest {
+
+        function two_forms() {
+
+			$this->YDRequest();
+			$this->tpl = new YDTemplate();
+
+			$this->form1 = new YDForm( 'myform1' );
+			$this->form2 = new YDForm( 'myform2' );
+        }
+
+
+        // Default action
+        function actionDefault() {
+
+			// create elements of form1
+			$this->form1->addElement( 'text',   'myname_1',       'Name' );
+			$this->form1->addElement( 'text',   'myemail_1',      'Email' );
+			$this->form1->addElement( 'button', 'mybutton_1',     'Send form with YDAjax' );
+
+			// create elements of form2
+			$this->form2->addElement( 'text',   'myname_2',       'Name (2nd)' );
+			$this->form2->addElement( 'text',   'myemail_2',      'Email (2nd)' );
+			$this->form2->addElement( 'button', 'mybutton_2',     'Send it !' );
+
+			// create form 1 rules
+			$this->form1->addRule( 'myname_1',  'required', 'Name is required' );
+			$this->form1->addRule( 'myemail_1', 'required', 'Email is required' );
+			$this->form1->addRule( 'myemail_1', 'email',    'Email is not valid' );
+
+			// create ajax object and add forms to the ajax object
+			$this->ajax = new YDAjax( $this->tpl );
+			$this->ajax->addForm( $this->form1 );
+			$this->ajax->addForm( $this->form2 );
+
+			// assign element mybutton_1 (of form1) with method 'processform' and mybutton_2 with method 'msg'
+			$this->ajax->addEvent( 'mybutton_1', array( & $this, 'processform' ), $this->form1->getName() );
+			$this->ajax->addEvent( 'mybutton_2', array( & $this, 'msg' ), array( 'myname_2', 'myemail_2' ) );
+			$this->ajax->processEvents();
+
+			// assign title, form and display template
+			$this->tpl->assign( 'title', 'YDAjax form submition' );
+			$this->tpl->assign( 'form',  $this->form1->render('html') . $this->form2->render('html') );
+			$this->tpl->display( 'general' );
+        }
+
+
+		// process form call invoked by mybutton_1
+		function processform( $formvalues = null ){
+
+			// if form is not valid, send errors to client side using an alert
+			if ( !$this->form1->validate( $formvalues ) )
+				return YDAjax::message( $this->form1->getErrors( true, "\n* ", "* " ) );
+
+			// return a simple result
+			return YDAjax::message( $this->form1->getValues() );
+		}
+
+
+		// process form call invoked by mybutton_2
+		function msg( $name = '', $email = '' ){
+
+			return YDAjax::message( "Values of 2nd form\n*Name: $name\n*Email: $email" );
+		}
+
+   }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Tue Aug 22 02:36:51 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 02:36:51 +0200
Subject: [ydf-devel] r2031 - YDFramework2.0/trunk/examples
Message-ID: <200608220036.k7M0apG5000584@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 02:36:09 +0200 (Tue, 22 Aug 2006)
New Revision: 2031

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
updated examples index.tpl with new YDAjax example

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-22 00:32:54 UTC (rev 2030)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-22 00:36:09 UTC (rev 2031)
@@ -626,7 +626,7 @@
           <td><b>&nbsp;</b></td>
         </tr>
         <tr>
-          <td valign="top" rowspan="17">&nbsp;</td>
+          <td valign="top" rowspan="18">&nbsp;</td>
           <td valign="top"><a href="ajax/version.php">Simple ajax example</a><br/>
           </td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/version.php">ajax/version.php</a> </td>
@@ -662,6 +662,11 @@
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/form.php">ajax/form.php</a> </td>
         </tr>
         <tr>
+          <td valign="top"><a href="ajax/two_forms.php">Two forms in same template</a><br/>
+          </td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/two_forms.php">ajax/two_forms.php</a> </td>
+          </tr>
+        <tr>
           <td valign="top"><a href="ajax/persistent_store.php">Persistent server store</a><br/></td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/persistent_store.php">ajax/persistent_store.php</a> </td>
         </tr>



From ximian at mail.berlios.de  Tue Aug 22 17:31:30 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 17:31:30 +0200
Subject: [ydf-devel] r2032 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608221531.k7MFVU4Y000816@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 17:31:10 +0200 (Tue, 22 Aug 2006)
New Revision: 2032

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
new feature on YDDatabaseTree: updates and inserts check if fields are valid fields (and not only on selects).
This means that an update/insert will only update/insert fields that are added with YDDatabaseTree::addField.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-08-22 00:36:09 UTC (rev 2031)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-08-22 15:31:10 UTC (rev 2032)
@@ -104,7 +104,12 @@
          *  @return The node as a node array.
          */
         function _toNodeArray( $node ) {
-            return $node;
+            $arr = array();
+
+            foreach ( $this->fields as $f )
+                if ( isset( $node[ $f ] ) ) $arr[ $f ] = $node[ $f ];
+
+            return $arr;
         }
 
         /*



From ximian at mail.berlios.de  Tue Aug 22 17:34:20 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 17:34:20 +0200
Subject: [ydf-devel] r2033 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
Message-ID: <200608221534.k7MFYKFd001022@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 17:33:32 +0200 (Tue, 22 Aug 2006)
New Revision: 2033

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
Log:
another big update in YDCMUsers with new methods for adding forms


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-22 15:31:10 UTC (rev 2032)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMPermissions.php	2006-08-22 15:33:32 UTC (rev 2033)
@@ -44,18 +44,9 @@
             $this->registerKey( 'permission_id', true );
 
 			// register fields	
+			$this->registerField( 'user_id' );
 			$this->registerField( 'object' );
 			$this->registerField( 'object_action' );
-			$this->registerField( 'object_id' );
-			$this->registerField( 'schedule' );
-			$this->registerField( 'date_start' );
-			$this->registerField( 'date_end' );
-
-			// add static relations
-			$this->registerField( 'user_id' );
-       		$rel = & $this->registerRelation( 'YDCMPermissions', false, 'YDCMPermissions' );
-			$rel->setLocalKey( 'user_id' );
-			$rel->setForeignKey( 'user_id' );
 		}
 
 
@@ -117,7 +108,7 @@
          *
          *  @param     $user_id     User id to get permissions
          *  @param     $parend_id   Parent id form permission comparation
-         *  @param     $values      Array with permissions
+         *  @param     $permissions Array with permissions
          */
 		function setPermissions( $user_id, $parent_id, $values ){
 
@@ -129,16 +120,16 @@
 			// get parent permissions
 			$permissions_parent = $this->getPermissions( $parent_id );
 
-			// check $values if contains permissions that belong to its parent
+			// filter $values and get permissions that are in parent
 			foreach( $permissions_parent as $obj => $perms )
 				foreach( $perms as $p => $arr )
-					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 'on' )
+					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 1 )
 						$permissions_valid[ $obj ][] = $p;
 
 			// get user permissions
 			$permissions_user = $this->getPermissions( $user_id );
 
-			// cycle current permissions to see the ones we need to delete
+			// cycle user permissions to see the ones we need to delete
 			foreach( $permissions_user as $obj => $perms )
 				foreach( $perms as $p => $arr )
 					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-22 15:31:10 UTC (rev 2032)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/YDCMUsers.php	2006-08-22 15:33:32 UTC (rev 2033)
@@ -63,7 +63,7 @@
 			$this->registerField( 'email' );			
 			$this->registerField( 'other' );			
 			$this->registerField( 'language_id' );
-			$this->registerField( 'state' );			
+			$this->registerField( 'state' );
 			$this->registerField( 'login_start' );
 			$this->registerField( 'login_end' );
 			$this->registerField( 'login_counter' );			
@@ -71,13 +71,8 @@
 			$this->registerField( 'login_current' );
 			$this->registerField( 'created_user' );
 			$this->registerField( 'created_date' );
+			$this->registerField( 'template' );
 
-			// relation with lock table
-            $rel = & $this->registerRelation( 'YDCMLocks', false, 'YDCMLocks' );
-			$rel->setLocalKey( 'user_id' );
-            $rel->setForeignKey( 'user_id' );
-			$rel->setForeignJoin( 'LEFT' );
-
 			// relation with languages table
             $rel = & $this->registerRelation( 'YDCMLanguages', false, 'YDCMLanguages' );
 			$rel->setLocalKey( 'language_id' );
@@ -88,57 +83,53 @@
 
 			// add tree fields
 			$this->tree->addField( 'parent_id' );
+			$this->tree->addField( 'username' );
+			$this->tree->addField( 'password' );
+			$this->tree->addField( 'name' );
+			$this->tree->addField( 'email' );			
+			$this->tree->addField( 'other' );			
+			$this->tree->addField( 'language_id' );
+			$this->tree->addField( 'state' );			
+			$this->tree->addField( 'login_start' );
+			$this->tree->addField( 'login_end' );
+			$this->tree->addField( 'login_counter' );			
+			$this->tree->addField( 'login_last' );
+			$this->tree->addField( 'login_current' );
 			$this->tree->addField( 'type' );
-			$this->tree->addField( 'state' );
-			$this->tree->addField( 'name' );
+			$this->tree->addField( 'created_user' );
+			$this->tree->addField( 'created_date' );
+			$this->tree->addField( 'template' );
 
-			// init user form
-			$this->form = new YDForm( 'YDCMUsers' );
-
 			// init permissions
 			$this->perm = new YDCMPermissions();
+			
+			// action_name: 'editing', 'adding';
+//			$this->_action_name      = null;
+//			$this->_action_id        = null;
+//			$this->_action_parent_id = null;
 		}
 
 
         /**
-         *  This function returns the id of the current user
-         */
-		function currentID(){
-		
-			// reset user values
-			$this->resetValues();
-		
-			// check if user is valid and get user id ( YDCMUsers::valid does it )
-			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
-
-			// if user is not valid we should return false
-			if ( $valid === false ) return false;
-
-			// return user id found by $this->valid
-			return $this->user_id;
-		}
-
-
-        /**
-         *  This function returns all sub users
+         *  This method returns all sub users of a user
          *
-         *  @param  $user_id   User id to get permissions
+         *  @param  $parent_id   Parent id
          *
-         *  @returns    all tree elements 
+         *  @returns    Array with user and children nodes
          */
-		function getTreeElements( $user_id ){
+		function getTreeElements( $parent_id ){
 
-			return $this->tree->getDescendants( $user_id, true );
+			return $this->tree->getDescendants( $parent_id, true );
 		}
 
 
         /**
-         *  This function checks if a user is descendant of another user
+         *  This method checks if a user is descendant of another user
          *
          *  @param      $id          User id to test if id descendant
          *  @param      $parent_id   Parent id
          *
-         *  @returns    boolean flag
+         *  @returns    boolean. TRUE if is descendant, FALSE if not descendant
          */
 		function isDescendantOf( $user_id, $parent_id ){
 
@@ -147,10 +138,10 @@
 
 
         /**
-         *  This function checks if a username and password are valid
+         *  This method checks if a username and password are valid
          *
          *  @param $username  User username
-         *  @param $password  User password (if password length is smaller than 32 we must md5 it, pwd form elements must have max 31)
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it, password form elements must have max 31)
          *
          *  @returns    true if valid, false otherwise
          */
@@ -187,186 +178,143 @@
 
 
         /**
-         *  This function adds a new user based on form values
+         *  This method deletes a user (and all children) or just the children
          *
-         *  @param $parent_id   Parent id of this new node
-         *  @param $formvalues  Array with user attributes
+         *  @param $user_id        User id
+         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes user id and children, FALSE deletes children only
          *
-         *  @returns    true if updated, array with form errors otherwise
+         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
          */
-		function addUserForm( $parent_id, $formvalues = null ){
+		function deleteUser( $user_id, $includeParent = true ){
+		
+			// get ids to delete
+			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
 
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
+			// delete all permissions of this users
+			$this->perm->deletePermissions( $ids );
 
-			// parse values
-			$values = array();
-			$values['name']          = $this->form->getValue( 'name' );
-			$values['email']         = $this->form->getValue( 'email' );
-			$values['username']      = $this->form->getValue( 'username' );
-			$values['other']         = $this->form->getValue( 'other' );
-			$values['state']         = $this->form->getValue( 'state' );
-			$values['type']          = 'YDCMUseradministrator';
-			$values['nlevel']        = 1;
-			$values['created_user']  = $this->currentID();
-			$values['created_date']  = YDStringUtil::formatDate( time(), 'datetimesql' );
-			$values['language_id']   = $this->form->getValue( 'language_id' );
-			$values['login_start']   = YDStringUtil::formatDate( $this->form->getValue( 'login_start' ), 'datetimesql' );
-			$values['login_end']     = YDStringUtil::formatDate( $this->form->getValue( 'login_end' ),   'datetimesql' );
-			$values['login_counter'] = 0;
-
-			// check password
-			if ( $this->form->isElement( 'password' ) )
-				$values['password'] = md5( $this->form->getValue( 'password' ) );
-
-			// add user to YDUsers table
-			$newID = $this->tree->addNode( $values, $parent_id );
-
-			// change user permissions
-			return $this->perm->setPermissions( $newID, $parent_id, $this->form->getValues() );
+			// delete node from users table
+			$this->tree->deleteNode( $user_id, $includeParent );
 		}
 
 
         /**
-         *  This function updates the current user attributes (ignoring passwords and statistics) using form values
-         *
-         *  @param $id          Static user id
-         *  @param $formvalues  Array with user attributes
-         *
-         *  @returns    true if updated, array with form errors otherwise
+         *  This method adds form elements for user editing
+		 *
+		 * @param $user_id      User id to edit
+		 *
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
+		 * 
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
+		 * 
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
+		 * 
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
          */
-		function changeUserForm( $id, $formvalues = null ){
+		function addFormEdit( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
 
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			// get form values
-			$values = $this->form->getValues();
-
-			// we need parent fot setting user permissions
-			$details = $this->getUser( $id );
-
-			// change user permissions
-			$res1 = $this->perm->setPermissions( $id, $details[ 'parent_id' ], $values );
-
-			// change user details
-			$this->resetAll();
-
-			// set new values
-			$this->setValues( $values );
-
-			// overwrite id
-			$this->user_id = intval( $id );
-
-			// parse dates
-			if ( isset( $this->login_start ) ) $this->login_start = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
-			if ( isset( $this->login_end ) )   $this->login_end   = YDStringUtil::formatDate( $values[ 'login_end' ],   'datetimesql' );
-
-			// return update result
-			return $this->update();
+		 	return $this->_addFormDetails( $id, true, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
 		}
 
 
         /**
-         *  This function updates the user attributes using form values
+         *  This method adds form elements for addind a new user
+		 *
+		 * @param $parent_id    Parent id of this new user
          *
-         *  @param $formvalues  Array with user attributes
-         *
-         *  @returns    true if updated, array with form errors otherwise
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
+		 * 
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
+		 * 
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
+		 * 
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
          */
-		function changeCurrentUserForm( $formvalues = array() ){
+		function addFormNew( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
 
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			// check if user is valid
-			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
-
-			if ( $valid === false ) return false;
-
-			// reset values added from valid method
-			$this->resetValues();
-
-			// set new values
-			$this->setValues( $this->form->getValues() );
-
-			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER'] . '"' );
-			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] ) . '"' );
-
-			// return update result
-			if ( $this->update() == 1 ) return true;
-			
-			return false;
+		 	return $this->_addFormDetails( $id, false, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
 		}
-
-
-        /**
-         *  This function deletes a user (and all children) or just the children
-         *
-         *  @param $user_id        User id
-         *  @param $includeParent  (Optional) Delete user id and children (false means delete children only)
-         *
-         *  @returns    true if updated, array with form errors otherwise
-         */
-		function deleteUser( $user_id, $includeParent = true ){
+		 
 		
-			// get ids to delete
-			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
-
-			// delete all permissions of this users
-			$this->perm->deletePermissions( $ids );
-
-			// delete node from users table
-			$this->tree->deleteNode( $user_id, $includeParent );
-		}
-
-
         /**
-         *  This function adds form elements for user detail management
+         *  Helper method for user management
 		 *
-		 * @param $username     (Optional) Flag that defines if the username is a box (editable) or a span for information only
-		 *                                 TRUE: is a box (editable); FALSE: is a span
+		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
+         *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
+         *
+		 * @param $edit         If you are editing a user set TRUE. If you are adding a new user set FALSE
+		 *
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
 		 * 
-		 * @param $password     (Optional) Flag that defines if we want to include the password box
-		 *                                 TRUE: include password box; FALSE: don't include
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
 		 * 
-		 * @param $logindetails (Optional) Flag that defines if login details are editable (eg: login schedule dates)
-		 *                                 TRUE: login details are editable; FALSE: login details are just information
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
 		 * 
-		 * @param $userdetails  (Optional) Flag that defines if user details are editable (eg: name, email, other info, template, language)
-		 *                                 TRUE: user details are editable; FALSE: user details are just information
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
          */
-		function addFormDetails( $username = false, $password = false, $logindetails = false, $userdetails = true ){
+		function _addFormDetails( $id, $edit, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
 
+			// init form
+			$this->form = new YDForm( 'YDCMUsers' );
+
 			// add username
-			if ( $username ) $this->form->addElement( 'text', 'username', t('user_username') );
-			else             $this->form->addElement( 'span', 'username', t('user_username') );
+			if ( $username === true )       $this->form->addElement( 'text', 'username', t('user_username') );
+			else if ( $username === false ) $this->form->addElement( 'span', 'username', t('user_username') );
 
 			// add password
-			if ( $password ) $this->form->addElement( 'password', 'password', t('user_password') );
+			if ( $password === true ) $this->form->addElement( 'password', 'password', t('user_password') );
 
 			// add login details
-			if ( $logindetails ){
+			if ( $logindetails === true ){
 				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
 				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
 				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
-			}else{
+
+			}else if ( $logindetails === false ){
 				$this->form->addElement( 'span',           'state',       t('login_state') );
 				$this->form->addElement( 'span',           'login_start', t('login_start') );
 				$this->form->addElement( 'span',           'login_end',   t('login_end') );
 			}
 
 			// add common user details
-            if ( $userdetails ){
+            if ( $userdetails === true ){
 				$this->form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
 				$this->form->addElement( 'text',      'email',         t('user_email') );
 				$this->form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
 
 				$languages = YDCMComponent::module( 'YDCMLanguages' );
-				$this->form->addElement( 'select',      'language_id', t('user_language'),      array(), $languages->active() );
+				$languages = $languages->active();
+				$this->form->addElement( 'select',    'language_id',   t('user_language'),      array(), $languages );
 
 				$templates = YDCMComponent::module( 'YDCMTemplates' );
     	        $this->form->addElement( 'select',    'template',      t('user_template'),      array(), $templates->admin_templates() );
@@ -374,10 +322,10 @@
 				$this->form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
 				$this->form->addRule( 'email',       'email',          t('email not valid') );
 				$this->form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
-				$this->form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages->active() ) );
+				$this->form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages ) );
 				$this->form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
 
-			}else{
+			}else if ( $userdetails === false ){
 				$this->form->addElement( 'span',      'name',          t('user_name') );
 				$this->form->addElement( 'span',      'email',         t('user_email') );
 				$this->form->addElement( 'span',      'other',         t('user_other') );
@@ -385,44 +333,48 @@
 				$this->form->addElement( 'span',      'template',      t('user_template') );
 			}
 
-			$this->form->addElement( 'span', 'login_counter', t('login_counter') );
-            $this->form->addElement( 'span', 'login_last',    t('login_last') );
-            $this->form->addElement( 'span', 'login_current', t('login_current') );
-            $this->form->addElement( 'span', 'created_user',  t('created_user') );
-            $this->form->addElement( 'span', 'created_date',  t('created_date') );
-		}
+			// add access information
+			if ( $accessinfo === true ){
+				$this->form->addElement( 'span', 'login_counter', t('login_counter') );
+    	        $this->form->addElement( 'span', 'login_last',    t('login_last') );
+    	        $this->form->addElement( 'span', 'login_current', t('login_current') );
+    	        $this->form->addElement( 'span', 'created_user',  t('created_user') );
+    	        $this->form->addElement( 'span', 'created_date',  t('created_date') );
+			}
 
+			// add submit button
+			if ( $edit ) $this->form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+			else         $this->form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
 
-        /**
-         *  This function adds checkbox groups about permissions and gets all translations.
-         *  It generates 3 private variables 
-         *    - $this->permissions         user permissions 
-         *    - $this->permissions_panret  parent permissions 
-         *    - $this->permissions_html    associative array with checkboxgroup html code
-         *
-         *  @param    $user_id                 User id to get defaults
-         *
-         *  @param    $userParentPermissions   (Optional) Boolean to compute avaiable parent permissions or user permissions
-         *                                      This will be used to create permissions for editing or when creating a subuser
-         *  
-         *  @returns  Associative array of objects and correspondent chechboxgoup html
-         */
-		function addFormPermissions( $user_id, $useParentPermissions = true ){
+			// if we are editing a user it's a good idea to set form defaults with user node attributes
+			if ( $edit ){
 
-			// init permission html (checkboxgroups of actions groupby permission objects)
-			$this->permissions_html = array();
+				// get user attributes
+				$node = $this->getUser( $id );
 
-			// get user details
-			$node = $this->getUser( $user_id );
+				// set form defaults based on user attributes
+				$this->form->setDefaults( $node );
+			}
 
-			// get user permissions
-			$permissions = $this->perm->getPermissions( $user_id );
 
+			// PERMISSION CHECKBOXGROUPS
+			if ( $permissionediting !== true ) return;
+
 			// check if we are editing or creating
-			if ( $useParentPermissions ) $permissions_avaiable = $this->perm->getPermissions( $node['parent_id'] );
-			else                         $permissions_avaiable = $this->perm->getPermissions( $user_id );
+			if ( $edit ){
 
-			// cycle parent permissions to create form checkboxgroup of this user
+				// on editing, permissions avaiable are the parent permissions ( parent of $id )
+				$permissions_avaiable = $this->perm->getPermissions( $node['parent_id'] );
+
+				// get current user permissions. We will need them to compare with parent permissions
+				$permissions = $node[ 'permissions' ];
+
+			// on adding, permissions avaiable are the parent permissions ( $id permissions )
+			}else{
+				$permissions_avaiable = $this->perm->getPermissions( $id );
+			}
+
+			// cycle parent permissions to create form checkboxgroup for this user
 			foreach( $permissions_avaiable as $obj => $perm ){
 
 				// get permission translations of this component
@@ -434,31 +386,113 @@
 
 				// cycle all permissions of this object to create checkboxgroup options array
 				foreach( $perm as $p ){
+				
+					// add option with translated string
+					// eg, if we are in 'YDCMPage' object and action is 'delete' we will add ( YDCMPage => array( 'delete' => t('YDCMPage_delete') ) )
 					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
 
-					// check if this parent action belongs to the child too ( to select it )
-					if ( $useParentPermissions && isset( $permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $permissions[ $obj ] ) )){
+					// on editing we must check if this action is select of not ( checking if this action is in parent actions)
+					if ( $edit && isset( $permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $permissions[ $obj ] ) )){
 						$selected[ $p['object_action' ] ] = 1;
 					}
 				}
 
-				// add object checkbox
+				// add object checkbox or spans
 				$this->form->addElement( 'checkboxgroup', $obj, $obj, array(), $options );
 				
-				// add default for this checkboxgroup
-				if ( $useParentPermissions ) $this->form->setDefault( $obj, $selected );
+				// add default for this checkboxgroup if we are editing
+				if ( $edit ) $this->form->setDefault( $obj, $selected );
 
-				// get element html
+				// this will store the checkboxgroups in a variable for better templating placement
 				$el = & $this->form->getElement( $obj );
-				
-				// store html permissions
-				$this->permissions_html[ $obj . ' s' ][] = $el->toHtml();
+				$this->permissions_html[ $obj ][] = $el->toHtml();
 			}
 
 		}
 
 
         /**
+         *  This method updates user attributes
+         *
+         *  @param $id           User id to save attributes
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if updated, ARRAY with form errors otherwise
+         */
+		function saveFormEdit( $id, $created_user, $formvalues = null ){
+
+			return $this->_saveFormDetails( $id, true, $created_user, $formvalues );
+		}
+
+
+        /**
+         *  This method adds a new user
+         *
+         *  @param $parent_id    Parent id of this new user
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if added, ARRAY with form errors otherwise
+         */
+		function saveFormNew( $parent_id, $created_user, $formvalues = null ){
+
+			return $this->_saveFormDetails( $parent_id, false, $created_user, $formvalues );
+		}
+
+
+        /**
+         *  This method adds/saves a user
+         *
+         *  @param $id           If we are editing $id is the user id. If we are adding, $id is the parent_id
+         *  @param $edit         Boolean flag that defines we we are editing $id or adding to $id
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if updated, ARRAY with form errors otherwise
+         */
+		function _saveFormDetails( $id, $edit, $created_user, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
+			// get form values avaiable
+			$values = $this->form->getValues();
+		
+			// parse fixed values
+			$values['type']          = 'YDCMUseradministrator';
+			$values['nlevel']        = 1;
+			$values['created_user']  = intval( $created_user );
+			$values['created_date']  = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$values['login_counter'] = 0;
+
+			// parse special elements
+			if ( $this->form->isElement( 'login_start' ) ) $values['login_start'] = YDStringUtil::formatDate( $values['login_start'], 'datetimesql' );
+			if ( $this->form->isElement( 'login_start' ) ) $values['login_end']   = YDStringUtil::formatDate( $values['login_end'],   'datetimesql' );
+			if ( $this->form->isElement( 'password' ) )    $values['password']    = md5( $values['password'] );
+
+			// check if we are editing or adding an element
+			if ( $edit ){
+
+				// update node to YDUsers table
+				$res = $this->tree->updateNode( $values, $id );
+	
+				// change user permissions in YDCMPermissions
+				return $this->perm->setPermissions( $id, $this->getUserAttribute( $id, 'parent_id' ), $values );
+			}else{
+			
+				// add node to YDUsers table
+				$newID = $this->tree->addNode( $values, $id );
+
+				// change user permissions in YDCMPermissions
+				return $this->perm->setPermissions( $newID, $id, $values );
+			}
+
+		}
+
+
+        /**
          *  This function adds form elements for password changing
          *
          * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
@@ -467,6 +501,9 @@
          */
 		function addFormPassword( $oldpassword = true ){
 
+			// init form
+			$this->form = new YDForm( 'YDCMUsers' );
+
 			// add new password box
             $this->form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
 			$this->form->addRule(    'new',         'required',     t('passwords are required') );
@@ -493,62 +530,14 @@
 
 
         /**
-         *  This returns the user form
-         *
-         *  @param $defaults  (Optional) default values array to apply in form
-         *
-         *  @returns    YDForm object
-         */
-		function getForm( $defaults = false ){
-
-			// check if we have form defaults and apply them
-			if ( is_array( $defaults ) ) $this->form->setDefaults( $defaults );
-
-			return $this->form;
-		}
-
-
-        /**
-         *  This function updates the current user password using form values
-         *
-         *  @param $formvalues  Array with 3 passwords (old, new and new_confirm)
-         *
-         *  @returns    true if updated, array with form errors, 0 if old password is incorrect
-         */
-		function changeCurrentUserPasswordForm( $formvalues = array() ){
-
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			// reset values added from valid method
-			$this->resetValues();
-
-			// set new password
-			$this->password = md5( $this->form->getValue( 'new' ) );
-
-			// change only current user
-			// TODO: escape 'username'
-			$this->where( 'username = "' .      $_SERVER['PHP_AUTH_USER']        . '"' );
-			$this->where( 'password = "' . md5( $_SERVER['PHP_AUTH_PW'] )        . '"' );
-			$this->where( 'password = "' . md5( $this->form->getValue( 'old' ) ) . '"' );
-
-			// update user and get result
-			if ( $this->update() == 1 ) return true;
-
-			return false;
-		}
-
-
-        /**
          *  This function updates a user password
          *
          *  @param $user_id     User id to update password
-         *  @param $formvalues  Array 2 passwords (new and new_confirm)
+         *  @param $formvalues  (Otional) Custom array with 2 passwords (new and new_confirm)
          *
          *  @returns    true if updated or array with form errors otherwise
          */
-		function changeUserPasswordForm( $user_id, $formvalues ){
+		function saveFormPassword( $user_id, $formvalues = null ){
 
 			// check form validation
 			if ( !$this->form->validate( $formvalues ) )
@@ -569,21 +558,23 @@
 
 
         /**
-         *  This function return the current user attributes
+         *  This returns the user form
          *
-         *  @param      $translate   (Optional) Boolean that defines if result must be translated
+         *  @param $defaults  (Optional) default values array to apply in form
          *
-         *  @returns    User details
+         *  @returns    YDForm object
          */
-		function getCurrentUser( $translate = false ){
-		
-			// get current user id
-			return $this->getUser( $this->currentID(), $translate );
+		function & getForm( $defaults = false ){
+
+			// check if we have form defaults and apply them
+			if ( is_array( $defaults ) ) $this->form->setDefaults( $defaults );
+
+			return $this->form;
 		}
 
 
         /**
-         *  This function returns user attributes
+         *  This method returns user attributes
          *
          *  @param      $user_id     User id to use (instead of internal)
          *  @param      $translate   (Optional) Boolean that defines if result must be translated
@@ -632,6 +623,28 @@
 
 
         /**
+         *  This method returns a specific user attribute
+         *
+         *  @param      $user_id     User id to use (instead of internal)
+         *  @param      $attribute   Attribute string
+         *
+         *  @returns    User details
+         */
+		function getUserAttribute( $user_id, $attribute ){
+
+			$this->resetValues();
+
+			// set user id
+			$this->user_id = intval( $user_id );
+
+			// get all attributes
+			if ( $this->find() != 1 ) return false;
+
+			return $this->get( $attribute );
+		}
+
+
+        /**
          *  This function updates current user login details
          *
          *  @returns    true if user login details updated, false if user is not valid or details not updated
@@ -666,5 +679,25 @@
 			return false;
 		}
 		
+		
+        /**
+         *  This method returns the id of the current user if you use PHP_AUTH_USER and PHP_AUTH_PW for authentication
+         */
+		function currentID(){
+		
+			// reset user values
+			$this->resetValues();
+		
+			// check if user is valid and get user id ( YDCMUsers::valid does it )
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			// if user is not valid we should return false
+			if ( $valid === false ) return false;
+
+			// return user id found by $this->valid
+			return $this->user_id;
+		}
+
+
     }
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Tue Aug 22 17:39:42 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 17:39:42 +0200
Subject: [ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: . backend
Message-ID: <200608221539.k7MFdgRR001834@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 17:38:40 +0200 (Tue, 22 Aug 2006)
New Revision: 2034

Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
   YDFramework2.0/trunk/examples/cm/cm.php
Log:
updated userdetails cm example and db scheme for new YDCMUsers version

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-22 15:38:40 UTC (rev 2034)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="119" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="102" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -1027,7 +1027,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`da!
 te_end`,`user_id`) VALUES (120,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (118,\aYDCMPage\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (120,\aYDCMPage\a,\adelete\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,101);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1"!
  Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1051,26 +1051,6 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1777" ColName="object_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1778" ColName="schedule" PrevColName="" Pos="4" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="This permission has start and date time">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1779" ColName="date_start" PrevColName="" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1780" ColName="date_end" PrevColName="" Pos="6" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1785" />

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-22 15:38:40 UTC (rev 2034)
@@ -17,57 +17,62 @@
 
 
         // Default action (that shows user details form with some editable fields)
-		// User should only update his details eg name, email
         function actionDefault() {
 
-			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
-			$this->users->addFormDetails( false, false, false, true );
+			// get user id 101 details and display them
+			YDDebugUtil::dump( $this->users->getUser( 101, true ) );
+        }
 
-			// get info of user id 100
-			$defaults = $this->users->getUser( 100 );
 
-			// get user form (filled with previous defaults)
-			$form = $this->users->getForm( $defaults );
+        // Edit user example
+        function actionEdit() {
 
-			// show form :)
-			$form->display();
-        }
+			// add form of user 101. User cannot edit username, cannot see password, cannot see login details, can edit user details, cannot see access info, cannot see permissions
+			$this->users->addFormEdit( 101, false, null, null, true, null, true );
 
+			// get user form and add a custom submit button
+			$form = & $this->users->getForm();
 
-        // Change details example
-        function actionChangeDetails() {
+			// if form is not submitted just show it
+			if ( ! $form->isSubmitted() ) return $form->display();
 
-			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
-			$this->users->addFormDetails( false, false, false, true );
+			// update user 101 with submitted information, magic isn't it ;) 100 is our id (created user, for loggin)
+			$result = $this->users->saveFormEdit( 101, 100 );
 
-			// get form filled with details from user id 100
-			$defaults = $this->users->getUser( 100 );
+			// check if result is a array (form error messages)
+			if( is_array( $result ) ) return $form->display();
 
-			// get user details form with a submit button
-			$form = $this->users->getForm( $defaults );
-			$form->addElement( 'submit', '_cmdSubmit', 'Submit' );
+			// if update was sucessfull, show ok message in current language
+			if ( $result == 1 ) return print( t( 'user details updated' ) );
 
-			// if we have submitted the form, update user
-			if ( $form->isSubmitted() ){
+			// if form is valid but details are not changed (because are same as the db ones)
+			if ( $result == 0 ) return print( t( 'user not updated' ) );
+        }
 
-				// update user 100 with submitted information, magic isn't it ;)
-				$result = $this->users->changeUserForm( 100 );
 
-				// check if result is a array (form error messages)
-				if( is_array( $result ) ) return print( implode( '<br>', $result ) );
+		// this action will add a new sub-user of the root (super-administrator: id 100)
+		function actionNew(){
 
-				// if update was sucessfull, show ok message in current language
-				if ( $result == 1 ) return print( t( 'user details updated' ) );
+			// add element as child of user 100. User can edit username, can edit password, can edit login details, can edit user details, cannot see access info, can edit permissions
+			$this->users->addFormNew( 100, true, true, true, true, null, true );
 
-				// if form is valid but details are not changed (because are same as the db ones)
-				if ( $result == 0 ) return print( t( 'user not updated' ) );
-			}
+			// get form and add a custom submition button
+			$form = & $this->users->getForm();
 
-			// show form :)
-			$form->display();
-        }
+			// if form is not submitted just show it
+			if ( ! $form->isSubmitted() ) return $form->display();
 
+			// add user ( 1st argument 100: parent of new user is 100; 2nd arg 100: we (user id that is creating this element) have id 100
+			$result = $this->users->saveFormNew( 100, 100 );
+			
+			// check if result has form errors
+			if ( is_array( $result ) ) return $form->display();
 
+			// if creation is sucessfull, show ok message in current language
+			print( t( 'user added' ) );
+		}
+
+
     }
 
     // Process the request

Modified: YDFramework2.0/trunk/examples/cm/cm.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.php	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/cm.php	2006-08-22 15:38:40 UTC (rev 2034)
@@ -10,7 +10,7 @@
     YDInclude( 'YDCMComponent.php' );
 
     // set YDDatabase instance connection
-    YDDatabase::registerInstance( 'default', 'mysql', 'tppp', 'root', '', 'localhost' );
+    YDDatabase::registerInstance( 'default', 'mysql', 'ph', 'root', '', 'localhost' );
 
 	// set portal language. Currently you can user 'en' and 'pt'.
 	YDLocale::set( 'en' );



From pieter at yellowduck.be  Tue Aug 22 17:43:59 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 22 Aug 2006 17:43:59 +0200
Subject: [ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: .
	backend
In-Reply-To: <200608221539.k7MFdgRR001834@sheep.berlios.de>
References: <200608221539.k7MFdgRR001834@sheep.berlios.de>
Message-ID: <4aef63030608220843u77b8e1c3jb68a4d1e8daa7de2@mail.gmail.com>

Ximian,

I think it would be very handy if you could also include the SQL script to
create the database in the commits. It might scare people off having to
install DBDesigner just to get the database export...

cheers,


pieter

On 8/22/06, ximian at mail.berlios.de <ximian at mail.berlios.de> wrote:
>
> Author: ximian
> Date: 2006-08-22 17:38:40 +0200 (Tue, 22 Aug 2006)
> New Revision: 2034
>
> Modified:
>   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
>   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
>   YDFramework2.0/trunk/examples/cm/cm.php
> Log:
> updated userdetails cm example and db scheme for new YDCMUsers version
>
> Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
> ===================================================================
> --- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml    2006-08-22
> 15:33:32 UTC (rev 2033)
> +++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml    2006-08-22
> 15:38:40 UTC (rev 2034)
> @@ -1,7 +1,7 @@
> <?xml version="1.0" standalone="yes" ?>
> <DBMODEL Version="4.0">
> <SETTINGS>
> -<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0"
> VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1"
> DatabaseType="MySQL" ZoomFac="74.00" XPos="119" YPos="31"
> DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn=""
> DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="
> 1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm,
> 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20"
> PositionGridY="20" TableNameInRefs="0" DefaultTableType="0"
> ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix=""
> CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0"
> DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
> +<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0"
> VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1"
> DatabaseType="MySQL" ZoomFac="74.00" XPos="102" YPos="31"
> DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn=""
> DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="
> 1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm,
> 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20"
> PositionGridY="20" TableNameInRefs="0" DefaultTableType="0"
> ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix=""
> CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0"
> DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
> <DATATYPEGROUPS>
> <DATATYPEGROUP Name="Numeric Types" Icon="1" />
> <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
> @@ -1027,7 +1027,7 @@
> </INDEX>
> </INDICES>
> </TABLE>
> -<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14"
> XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0"
> Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO
> `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`)
> VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00
> 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`)
> VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00
> 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`)
> VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00
> 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`da!
> te_end`,`user_id`) VALUES
> (120,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00
> 00:00:00\a,101);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`)
> VALUES (121,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00
> 00:00:00\a,\a0000-00-00 00:00:00\a,101);\n"
> TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n"
> Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1"
> Obj_id_Linked="-1" OrderPos="37" >
> +<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14"
> XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0"
> Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO
> `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`)
> VALUES (117,\aYDCMRootmenu\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`user_id`) VALUES
> (118,\aYDCMPage\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`user_id`) VALUES
> (119,\aYDCMPage\a,\acreate\a,100);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`user_id`) VALUES
> (120,\aYDCMPage\a,\adelete\a,101);\nINSERT INTO `ydcmpermissions`
> (`permission_id`,`object`,`object_action`,`user_id`) VALUES
> (121,\aYDCMPage\a,\acreate\a,101);\n"
> TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n"
> Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1"!
> Obj_id_Linked="-1" OrderPos="37" >
> <COLUMNS>
> <COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7"
> idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1"
> NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
> <OPTIONSELECTED>
> @@ -1051,26 +1051,6 @@
> <OPTIONSELECT Value="0" />
> </OPTIONSELECTED>
> </COLUMN>
> -<COLUMN ID="1777" ColName="object_id" PrevColName="" Pos="3"
> idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0"
> NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
> -<OPTIONSELECTED>
> -<OPTIONSELECT Value="1" />
> -<OPTIONSELECT Value="0" />
> -</OPTIONSELECTED>
> -</COLUMN>
> -<COLUMN ID="1778" ColName="schedule" PrevColName="" Pos="4"
> idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0"
> NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="This
> permission has start and date time">
> -<OPTIONSELECTED>
> -<OPTIONSELECT Value="1" />
> -<OPTIONSELECT Value="0" />
> -</OPTIONSELECTED>
> -</COLUMN>
> -<COLUMN ID="1779" ColName="date_start" PrevColName="" Pos="5"
> idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0"
> NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
> -<OPTIONSELECTED>
> -</OPTIONSELECTED>
> -</COLUMN>
> -<COLUMN ID="1780" ColName="date_end" PrevColName="" Pos="6"
> idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0"
> NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
> -<OPTIONSELECTED>
> -</OPTIONSELECTED>
> -</COLUMN>
> </COLUMNS>
> <RELATIONS_START>
> <RELATION_START ID="1785" />
>
> Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
> ===================================================================
> --- YDFramework2.0/trunk/examples/cm/backend/userdetails.php    2006-08-22
> 15:33:32 UTC (rev 2033)
> +++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php    2006-08-22
> 15:38:40 UTC (rev 2034)
> @@ -17,57 +17,62 @@
>
>
>         // Default action (that shows user details form with some editable
> fields)
> -               // User should only update his details eg name, email
>         function actionDefault() {
>
> -                       // add form. User cannot edit username, cannot see
> password, cannot edit login details, can edit user details
> -                       $this->users->addFormDetails( false, false, false,
> true );
> +                       // get user id 101 details and display them
> +                       YDDebugUtil::dump( $this->users->getUser( 101,
> true ) );
> +        }
>
> -                       // get info of user id 100
> -                       $defaults = $this->users->getUser( 100 );
>
> -                       // get user form (filled with previous defaults)
> -                       $form = $this->users->getForm( $defaults );
> +        // Edit user example
> +        function actionEdit() {
>
> -                       // show form :)
> -                       $form->display();
> -        }
> +                       // add form of user 101. User cannot edit
> username, cannot see password, cannot see login details, can edit user
> details, cannot see access info, cannot see permissions
> +                       $this->users->addFormEdit( 101, false, null, null,
> true, null, true );
>
> +                       // get user form and add a custom submit button
> +                       $form = & $this->users->getForm();
>
> -        // Change details example
> -        function actionChangeDetails() {
> +                       // if form is not submitted just show it
> +                       if ( ! $form->isSubmitted() ) return
> $form->display();
>
> -                       // add form. User cannot edit username, cannot see
> password, cannot edit login details, can edit user details
> -                       $this->users->addFormDetails( false, false, false,
> true );
> +                       // update user 101 with submitted information,
> magic isn't it ;) 100 is our id (created user, for loggin)
> +                       $result = $this->users->saveFormEdit( 101, 100 );
>
> -                       // get form filled with details from user id 100
> -                       $defaults = $this->users->getUser( 100 );
> +                       // check if result is a array (form error
> messages)
> +                       if( is_array( $result ) ) return $form->display();
>
> -                       // get user details form with a submit button
> -                       $form = $this->users->getForm( $defaults );
> -                       $form->addElement( 'submit', '_cmdSubmit',
> 'Submit' );
> +                       // if update was sucessfull, show ok message in
> current language
> +                       if ( $result == 1 ) return print( t( 'user details
> updated' ) );
>
> -                       // if we have submitted the form, update user
> -                       if ( $form->isSubmitted() ){
> +                       // if form is valid but details are not changed
> (because are same as the db ones)
> +                       if ( $result == 0 ) return print( t( 'user not
> updated' ) );
> +        }
>
> -                               // update user 100 with submitted
> information, magic isn't it ;)
> -                               $result = $this->users->changeUserForm(
> 100 );
>
> -                               // check if result is a array (form error
> messages)
> -                               if( is_array( $result ) ) return print(
> implode( '<br>', $result ) );
> +               // this action will add a new sub-user of the root
> (super-administrator: id 100)
> +               function actionNew(){
>
> -                               // if update was sucessfull, show ok
> message in current language
> -                               if ( $result == 1 ) return print( t( 'user
> details updated' ) );
> +                       // add element as child of user 100. User can edit
> username, can edit password, can edit login details, can edit user details,
> cannot see access info, can edit permissions
> +                       $this->users->addFormNew( 100, true, true, true,
> true, null, true );
>
> -                               // if form is valid but details are not
> changed (because are same as the db ones)
> -                               if ( $result == 0 ) return print( t( 'user
> not updated' ) );
> -                       }
> +                       // get form and add a custom submition button
> +                       $form = & $this->users->getForm();
>
> -                       // show form :)
> -                       $form->display();
> -        }
> +                       // if form is not submitted just show it
> +                       if ( ! $form->isSubmitted() ) return
> $form->display();
>
> +                       // add user ( 1st argument 100: parent of new user
> is 100; 2nd arg 100: we (user id that is creating this element) have id 100
> +                       $result = $this->users->saveFormNew( 100, 100 );
> +
> +                       // check if result has form errors
> +                       if ( is_array( $result ) ) return
> $form->display();
>
> +                       // if creation is sucessfull, show ok message in
> current language
> +                       print( t( 'user added' ) );
> +               }
> +
> +
>     }
>
>     // Process the request
>
> Modified: YDFramework2.0/trunk/examples/cm/cm.php
> ===================================================================
> --- YDFramework2.0/trunk/examples/cm/cm.php     2006-08-22 15:33:32 UTC
> (rev 2033)
> +++ YDFramework2.0/trunk/examples/cm/cm.php     2006-08-22 15:38:40 UTC
> (rev 2034)
> @@ -10,7 +10,7 @@
>     YDInclude( 'YDCMComponent.php' );
>
>     // set YDDatabase instance connection
> -    YDDatabase::registerInstance( 'default', 'mysql', 'tppp', 'root', '',
> 'localhost' );
> +    YDDatabase::registerInstance( 'default', 'mysql', 'ph', 'root', '',
> 'localhost' );
>
>        // set portal language. Currently you can user 'en' and 'pt'.
>        YDLocale::set( 'en' );
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060822/cd394b1d/attachment.html>

From ximian at mail.berlios.de  Tue Aug 22 22:12:17 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 22 Aug 2006 22:12:17 +0200
Subject: [ydf-devel] r2035 - YDFramework2.0/trunk/examples/cm
Message-ID: <200608222012.k7MKCHZt024280@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 22:11:51 +0200 (Tue, 22 Aug 2006)
New Revision: 2035

Added:
   YDFramework2.0/trunk/examples/cm/cm.sql
Modified:
   YDFramework2.0/trunk/examples/cm/instructions.txt
Log:
- added sql structure file of YDCM
- updated instructions

Added: YDFramework2.0/trunk/examples/cm/cm.sql
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.sql	2006-08-22 15:38:40 UTC (rev 2034)
+++ YDFramework2.0/trunk/examples/cm/cm.sql	2006-08-22 20:11:51 UTC (rev 2035)
@@ -0,0 +1,302 @@
+CREATE TABLE YDCMStatistics_downloads (
+  download_is INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  date DATETIME NULL,
+  filename VARCHAR(255) NULL,
+  PRIMARY KEY(download_is)
+);
+
+CREATE TABLE YDCMLanguages (
+  language_id VARCHAR(255) NOT NULL,
+  name VARCHAR(50) NOT NULL,
+  active TINYINT(1) NOT NULL DEFAULT 0,
+  visitors_default TINYINT(1) NOT NULL DEFAULT 0,
+  admin_default TINYINT(1) NOT NULL DEFAULT 0,
+  PRIMARY KEY(language_id)
+);
+
+INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('en','English',1,1,1);
+INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('pt','Portugu?s',1,0,0);
+
+
+CREATE TABLE YDCMStatistics_searches (
+  search_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+  date DATETIME NOT NULL,
+  word VARCHAR(255) NOT NULL,
+  PRIMARY KEY(search_id)
+);
+
+CREATE TABLE YDCMTree (
+  content_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+  parent_id INTEGER UNSIGNED NULL,
+  nleft INTEGER NOT NULL DEFAULT 0,
+  nright INTEGER NOT NULL DEFAULT 0,
+  nlevel INTEGER NOT NULL DEFAULT 0,
+  position INTEGER(10) NULL DEFAULT 1,
+  type VARCHAR(20) NOT NULL,
+  reference VARCHAR(100) NOT NULL,
+  state TINYINT(1) NOT NULL,
+  access TINYINT(2) NOT NULL DEFAULT 1,
+  searcheable TINYINT(1) NOT NULL,
+  published_date_start DATETIME NOT NULL,
+  published_date_end DATETIME NOT NULL,
+  candrag TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
+  candrop TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
+  PRIMARY KEY(content_id)
+);
+
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,NULL,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,'YDCMPage','Apache',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,'YDCMPage','PostegreSQL',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,'YDCMPage','mysql',0,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,'YDCMRootmenu','links',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,'YDCMPage','databases',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,'YDCMPage','generators',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+
+
+CREATE TABLE YDCMUsers (
+  user_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+  parent_id INTEGER UNSIGNED NOT NULL,
+  type  VARCHAR(100) NOT NULL DEFAULT 'YDCMVisitor',
+  nleft INTEGER NOT NULL,
+  nright INTEGER NOT NULL,
+  nlevel INTEGER NOT NULL,
+  position INTEGER UNSIGNED NULL DEFAULT 1,
+  username VARCHAR(100) NOT NULL,
+  password VARCHAR(100) NOT NULL,
+  name VARCHAR(255) NULL,
+  email VARCHAR(255) NULL,
+  other TEXT NULL,
+  language_id VARCHAR(255) NOT NULL,
+  template VARCHAR(255) NULL DEFAULT 'default',
+  state TINYINT(1) NOT NULL,
+  login_start DATETIME NOT NULL,
+  login_end DATETIME NOT NULL,
+  login_counter INTEGER(11) NULL,
+  login_last DATETIME NOT NULL,
+  login_current DATETIME NOT NULL,
+  created_user INTEGER(20) NULL,
+  created_date DATETIME NOT NULL,
+  PRIMARY KEY(user_id),
+  FOREIGN KEY(language_id)
+    REFERENCES YDCMLanguages(language_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,'','',NULL,NULL,NULL,'en',0,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMRoot',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,'','',NULL,NULL,NULL,'en',1,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMUseradministrators',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,'','',NULL,NULL,NULL,'en',0,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMUservisitors',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,'admin','21232f297a57a5a743894a0e4a801fc3','Admin','email at host.com','other info','en',1,'1970-01-01 00:00:00','1970-01-01 00:00:00',40,'2006-08-15 16:34:08','2006-08-15 16:35:51',0,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,'francisco','b5d5f67b30809413156655abdda382a3','Francisco Azevedo','','','en',1,'2001-01-01 00:00:00','2004-05-08 05:05:06',19,'2006-08-08 16:26:39','2006-08-08 17:18:19',2,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (102,101,5,6,5,'pieter','','Pieter','','aasdasdasd','en',1,'2001-01-01 00:00:00','2001-01-01 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,'david','','David','','','en',1,'2006-08-08 16:27:35','2006-08-08 16:27:35',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',101,'2006-08-08 16:28:01','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (104,100,12,17,4,'pedro','','Pedro Cerqueira','','xpto','en',1,'2006-08-08 16:29:51','2006-08-08 16:29:51',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 16:30:06','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,'limpeza','','Limpeza','','asfdasdasdasd','en',1,'2006-08-08 16:32:11','2006-08-08 16:32:11',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 16:32:26','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,'meireles','','Meireles','','meireles','en',1,'2006-08-08 17:14:44','2006-08-08 17:14:44',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 17:15:09','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,'marc','','Marc','','Vassoutinha','en',1,'2006-08-09 15:57:27','2006-12-09 15:57:27',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-09 15:57:49','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (113,100,18,19,4,'extra','','Extra user','','user OKuser OKuser OK','en',1,'2006-08-09 16:13:57','2006-08-09 16:13:57',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-09 16:14:20','YDCMUseradministrator',1,'default');
+
+
+CREATE TABLE YDCMPermissions (
+  permission_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  user_id INTEGER(10) NOT NULL,
+  object VARCHAR(255) NOT NULL,
+  object_action VARCHAR(255) NOT NULL,
+  PRIMARY KEY(permission_id),
+  FOREIGN KEY(user_id)
+    REFERENCES YDCMUsers(user_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (117,'YDCMRootmenu','delete',100);
+INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (118,'YDCMPage','delete',100);
+INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (119,'YDCMPage','create',100);
+INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (120,'YDCMPage','delete',101);
+INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (121,'YDCMPage','create',101);
+
+
+CREATE TABLE YDCMAudit (
+  YDCMAudit_id INTEGER NOT NULL AUTO_INCREMENT,
+  permission_id INTEGER UNSIGNED NOT NULL,
+  permission_result VARCHAR(255) NULL,
+  date DATE NOT NULL,
+  date_time DATETIME NOT NULL,
+  browser VARCHAR(20) NULL,
+  platform VARCHAR(20) NULL,
+  url VARCHAR(255) NULL,
+  hits INTEGER UNSIGNED NULL,
+  PRIMARY KEY(YDCMAudit_id),
+  FOREIGN KEY(permission_id)
+    REFERENCES YDCMPermissions(permission_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+CREATE TABLE YDCMLocks (
+  lock_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  content_id INTEGER(10) NOT NULL,
+  user_id INTEGER(10) NOT NULL,
+  datetime  DATETIME NOT NULL,
+  PRIMARY KEY(lock_id),
+  FOREIGN KEY(user_id)
+    REFERENCES YDCMUsers(user_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(content_id)
+    REFERENCES YDCMTree(content_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+CREATE TABLE YDCMComp (
+  component_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  user_id INTEGER(10) NOT NULL,
+  content_id INTEGER(10) NOT NULL,
+  language_id VARCHAR(255) NULL,
+  title VARCHAR(255) NULL,
+  version_default TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
+  version_date DATETIME NOT NULL,
+  PRIMARY KEY(component_id),
+  FOREIGN KEY(content_id)
+    REFERENCES YDCMTree(content_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(language_id)
+    REFERENCES YDCMLanguages(language_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(user_id)
+    REFERENCES YDCMUsers(user_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,'en','Apache friends',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,'en','PostGre en',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,'pt','PostGre pt',1,'0000-00-00 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,'en','mySql howto',1,'2000-01-01 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,'pt','ajuda mySql',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,'en','Databases we use',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,'pt','Bases de dados',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,'en','Generators help',1,'2000-01-01 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,'pt','Ajuda sobre geradores',1,'2002-02-02 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (10,11,'en','Portals',1,'0000-00-00 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,'pt','Portais',1,'0000-00-00 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,'en','Menu Links',1,'0000-00-00 00:00:00',101);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,'pt','O meu menu de atalhos',1,'0000-00-00 00:00:00',100);
+INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,'en','Gener',0,'3002-02-02 00:00:00',100);
+
+
+CREATE TABLE YDCMPage (
+  component_id INTEGER UNSIGNED NOT NULL,
+  current_version TINYINT(1) NULL,
+  html TEXT NULL,
+  xhtml TEXT NULL,
+  template_pack TINYINT(1) UNSIGNED NOT NULL,
+  template VARCHAR(255) NULL,
+  metatags TINYINT(1) NOT NULL,
+  description TEXT NULL,
+  keywords TEXT NULL DEFAULT '',
+  FOREIGN KEY(component_id)
+    REFERENCES YDCMComp(component_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,'Apache html all lang','Apache xhtml all lang',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,'PostgreSQL en html','PostgreSQL en xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,'PostgreSQL pt html','PostgreSQL pt xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4,1,'mySQL en html','mySQL en xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,'mySQL pt html','mySQL pt xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,'Databases html','Databases xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,'Bases de dados html','Bases de dados xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,'Generators html','Generators xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (9,1,'Geradores html','Geradores xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,'Portals html','Portals xhtml',0,'',0,'','');
+INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,'Portais html','Portais xhtml',0,'',0,'','');
+
+
+CREATE TABLE YDCMGuestbook_posts (
+  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  component_id INTEGER UNSIGNED NOT NULL,
+  date DATETIME NOT NULL,
+  name VARCHAR(255) NOT NULL,
+  email VARCHAR(255) NULL,
+  message TEXT NOT NULL,
+  active TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
+  website VARCHAR(255) NULL,
+  ip VARCHAR(15) NULL,
+  PRIMARY KEY(post_id),
+  FOREIGN KEY(component_id)
+    REFERENCES YDCMComp(component_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+CREATE TABLE YDCMLink (
+  component_id INTEGER UNSIGNED NOT NULL,
+  url VARCHAR(255) NOT NULL,
+  num_visits INTEGER UNSIGNED NOT NULL DEFAULT 0,
+  FOREIGN KEY(component_id)
+    REFERENCES YDCMComp(component_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+CREATE TABLE YDCMHelpdesk_posts (
+  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  component_id INTEGER UNSIGNED NOT NULL,
+  state_id VARCHAR(255) NULL,
+  urgency_id VARCHAR(255) NULL,
+  user_id INTEGER(10) NOT NULL,
+  subject TEXT NULL,
+  text TEXT NULL,
+  creation_date DATETIME NOT NULL,
+  reportedby_user TINYINT(1) UNSIGNED NULL,
+  reportedby_local VARCHAR(255) NULL,
+  reportedby_date DATETIME NOT NULL,
+  reportedby_type VARCHAR(255) NULL,
+  assignedto_user TINYINT(1) UNSIGNED NULL,
+  assignedto_local VARCHAR(255) NULL,
+  assignedto_date DATETIME NOT NULL,
+  assignedto_type VARCHAR(255) NULL,
+  PRIMARY KEY(post_id),
+  FOREIGN KEY(user_id)
+    REFERENCES YDCMUsers(user_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(component_id)
+    REFERENCES YDCMComp(component_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',1,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',1,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,'1','1',1,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,'1','1',1,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+
+
+CREATE TABLE YDCMHelpdesk_response (
+  response_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  user_id INTEGER(10) NOT NULL,
+  post_id INTEGER UNSIGNED NOT NULL,
+  date DATETIME NULL,
+  description TEXT NULL,
+  PRIMARY KEY(response_id),
+  FOREIGN KEY(post_id)
+    REFERENCES YDCMHelpdesk_posts(post_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(user_id)
+    REFERENCES YDCMUsers(user_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+

Modified: YDFramework2.0/trunk/examples/cm/instructions.txt
===================================================================
--- YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-22 15:38:40 UTC (rev 2034)
+++ YDFramework2.0/trunk/examples/cm/instructions.txt	2006-08-22 20:11:51 UTC (rev 2035)
@@ -1,13 +1,19 @@
-1 - Get DBDesigner4 (opensource db scheme editor): http://fabforce.net/dbdesigner4/
+1 - Create your db structure:
 
-	1.1 - open DBDesigner4.xml in DBDesigner4
+	1.1 - using cm.sql
 
-	1.2 - in DBDesigner4 select FILE -> EXPORT -> SQL CREATE SCRIPT
+	or
 
-	1.3 - in "General Settings" select 'Order tables by foreign keys'
+	1.2 - using DBDesigner4 (opensource db scheme editor): http://fabforce.net/dbdesigner4/
 
-	1.4 - in "SQL Creates Settings" select all options
+		1.2.1 - open DBDesigner4.xml in DBDesigner4
 
-	1.5 - copy script to clipboard/file and insert it in your database
+		1.2.2 - in DBDesigner4 select FILE -> EXPORT -> SQL CREATE SCRIPT
+	
+		1.2.3 - in "General Settings" select 'Order tables by foreign keys'
+	
+		1.2.4 - in "SQL Creates Settings" select all options
+	
+		1.2.5 - copy script to clipboard/file and insert it in your database
 
 2 - in examples\cm directory, open cm.php and edit your database settings



From francisco at fusemail.com  Tue Aug 22 22:33:43 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 22 Aug 2006 21:33:43 +0100
Subject: [ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm:
	.	backend
In-Reply-To: <4aef63030608220843u77b8e1c3jb68a4d1e8daa7de2@mail.gmail.com>
References: <200608221539.k7MFdgRR001834@sheep.berlios.de>
	<4aef63030608220843u77b8e1c3jb68a4d1e8daa7de2@mail.gmail.com>
Message-ID: <44EB6A27.2080209@fusemail.com>

Hi Pieter

> I think it would be very handy if you could also include the SQL script 
> to create the database in the commits. It might scare people off having 
> to install DBDesigner just to get the database export...


Done in build 2035.


regards
Francisco A


From ximian at mail.berlios.de  Wed Aug 23 00:00:09 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 00:00:09 +0200
Subject: [ydf-devel] r2036 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608222200.k7MM091I007180@sheep.berlios.de>

Author: ximian
Date: 2006-08-22 23:59:43 +0200 (Tue, 22 Aug 2006)
New Revision: 2036

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
Log:
added experimental class YDResult to handle results

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-22 20:11:51 UTC (rev 2035)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-22 21:59:43 UTC (rev 2036)
@@ -30,6 +30,7 @@
     YDInclude( 'YDDatabaseObject.php' );
 	YDInclude( 'YDDatabaseTree.php' );
 	YDInclude( 'YDUrl.php' );
+	YDInclude( 'YDError.php' );
 
 	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMComp.php' );
 
@@ -387,4 +388,34 @@
 
     }
 
+
+	@define ( YD_ERROR_OK, 1000 );
+	
+    YDConfig::set( 'YD_ERROR_LEVELS', array(
+            YD_ERROR_NOTICE  => 'Notice',
+            YD_ERROR_WARNING => 'Warning',
+            YD_ERROR_FATAL   => 'Fatal',
+            YD_ERROR_OK      => 'Ok'
+        ));
+
+	// experimental class to handle all YDCM method results
+	class YDResult extends YDError{
+	
+        /**
+         *  This method creates a OK type
+         *
+         *  @param  $message  The message.
+         *  @param  $value    (optional) A custom value
+         *
+         *  @returns     An YDCMResult object.
+         *
+         *  @static
+         */
+        function ok( $message, $value = null ) {
+            return YDError::_error( YD_ERROR_OK, $message, $value );
+        }
+
+
+	}
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2006-08-22 20:11:51 UTC (rev 2035)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2006-08-22 21:59:43 UTC (rev 2036)
@@ -89,7 +89,8 @@
             $this->run_line     = null;
             $this->md5          = md5( $level . $message . $file . $line . $function . $stacktrace . mt_rand() );
             $this->stacktrace   = $stacktrace;
-            
+            $this->ok           = ( $level === 1000 );
+            $this->value        = $custom;
         }
         
 



From ximian at mail.berlios.de  Wed Aug 23 00:02:02 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 00:02:02 +0200
Subject: [ydf-devel] r2037 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200608222202.k7MM22uC007327@sheep.berlios.de>

Author: ximian
Date: 2006-08-23 00:01:35 +0200 (Wed, 23 Aug 2006)
New Revision: 2037

Added:
   YDFramework2.0/trunk/examples/cm/backend/returns.php
Log:
added an YDCM example on how to use experimental YDResult class

Added: YDFramework2.0/trunk/examples/cm/backend/returns.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/returns.php	2006-08-22 21:59:43 UTC (rev 2036)
+++ YDFramework2.0/trunk/examples/cm/backend/returns.php	2006-08-22 22:01:35 UTC (rev 2037)
@@ -0,0 +1,93 @@
+<?php
+
+    include_once( dirname( __FILE__ ) . '/../cm.php' );
+
+    // Class definition
+    class returns extends cm {
+
+        // Class constructor
+        function returns() {
+
+			// init parent class and test class
+            $this->cm();
+			$this->test = new mytest();
+        }
+
+
+        // Default action, demonstrates the simplest way of handle results
+        function actionDefault() {
+
+			// try to div by 0
+			$res = $this->test->div( 10 );
+			
+			// check if div processing was ok or we get errors
+			if ( $res->ok ) print $res->message;
+			else            print 'ERROR: ' . $res->message;
+        }
+
+
+        // Check error types
+        function actionErrors() {
+
+			// set internal test 5 ;) (we will get an error)
+			$this->test->set( 5 );
+
+			// try to div by 10
+			$res = $this->test->div( 10 );
+			
+			// check if div processing was ok
+			if ( $res->ok ) return print $res->message . ' ' . $res->value;
+
+			// get error
+			if ( $res->custom == 0 ){
+
+				// do something about 'x' argument being 0
+				print $res->message;
+			}
+
+			if ( $res->custom == 1 ){
+
+				// do something about internal 'a' variable being 5
+				print $res->message;
+			}
+
+			// in any case of error, show all information
+			$res->dump();
+        }
+
+
+    }
+
+
+	class mytest{
+	
+		function mytest(){
+			$this->a = 10;
+		}
+
+
+		function set( $a ){
+			$this->a = $a;
+		}
+
+
+		function div( $x ){
+		
+			// test if internal x is valid and test if $x is valid
+			if ( $x == 0 )       return YDResult::fatal( 'Argument cannot be zero', 0 );
+			if ( $this->a == 5 ) return YDResult::fatal( 'Internal value cannot be five :D', 1);
+			
+			// compute result value
+			$result = ( $this->a / 10 );
+			
+			// return a ok result
+			return YDResult::ok( 'Div made with sucess!', $result );
+		}
+
+	}
+	
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>



From pclaerhout at mail.berlios.de  Wed Aug 23 08:44:01 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 23 Aug 2006 08:44:01 +0200
Subject: [ydf-devel] r2038 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200608230644.k7N6i1Sc020165@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-23 08:43:55 +0200 (Wed, 23 Aug 2006)
New Revision: 2038

Modified:
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Fixed the RSS/ATOM feed links for comments and galleries.

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-22 22:01:35 UTC (rev 2037)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-08-23 06:43:55 UTC (rev 2038)
@@ -121,7 +121,7 @@
                 $body = $comment['comment'] . "\n\n" . t('by') . ' ' . $comment['username'];
                 $this->feed->addItem(
                     $comment['item_title'], YDTplModLinkItem( $comment['item_id'], '#comment' ),
-                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $comment['item_id'], '#comment' )
+                    YDTemplate_modifier_bbcode( $body ), YDTplModLinkItem( $comment['item_id'], '#comment_' . $comment['id'] )
                 );
             }
 
@@ -147,8 +147,8 @@
                         $body .= '<img src="' . YDTplModLinkThumb( $image ) . '"/> ';
                     }
                     $this->feed->addItem(
-                        $item['title'], YDTplModLinkItemGallery( $item ),
-                        YDTemplate_modifier_bbcode( $body ), YDTplModLinkItemGallery( $item )
+                        $item['title'], YDTplModLinkItemImages( $item ),
+                        YDTemplate_modifier_bbcode( $body ), YDTplModLinkItemImages( $item )
                     );
                 }
             }



From maximus_meridius79 at yahoo.com  Wed Aug 23 16:00:20 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Wed, 23 Aug 2006 07:00:20 -0700 (PDT)
Subject: [ydf-devel] Callbacks in YDRequest based on YDDatabaseObject
Message-ID: <20060823140020.7061.qmail@web54002.mail.yahoo.com>

    Hi,

I decided it would be nice to have 'before' and 'after' actioncallbacks in the YDRequest class after seeing the functionality inYDDatabaseObject. The original intention was to provide a way to havecommon processing before and after actions are processed (e.g.automatically set a smarty variable or call $this->tpl->display()before or after every action). I then decided to extend it so thatcallbacks could be specified for specific actions. There is potentialfor duplicate processing when the forward method is used and so Idisabled callbacks for this type of processing. See also the commentsbelow.

I have added methods to YDRequest.php and provided example usage inexamples/callbacks.php. The code is attached as a tarball.

The methods have been adapted for YDRequest and there is a modificationto process(). There is a new internal method _processAction.

This is the comment for registerCallback:

       /**
         *  This function registers an action callback method.
         *
         *  'before' and 'after' callbacks can be registered for
         *  'action' (all actions) or for a specific YDRequest action.
         *
         *  By default no YDRequest action callbacks are defined.
         *
         *  Callbacks are disabled when an action forwards to another
         *  action. This is to prevent duplicated processing ofcallbacks.
         *  "redirectToAction" is a more compatible with callbacks.
         *
         *  Processing of callbacks and actions in the context of arequest
         *  is executed in this order:
         * 
         *    1. (optional) before 'action' callbacks - apply to allactions
         *    2. (optional) before callback for the current action
         *      3. Current action
         *    4. (optional) after callback for the current action
         *    5. (optional) after 'action' callbacks - apply to allactions
         *
         *    example 1: will execute my_before_callback() before eachaction
         *        $this->registerCallback( 'my_before_callback','action', true );
         *
         *    example 2: will execute my_after_callback() after eachaction
         *        $this->registerCallback( 'my_after_callback','action', false );
         *
         *    example 3: will execute my_deafult_after_callback() afteractionDefault
         *        $this->registerCallback('my_deafult_after_callback', 'actionDefault', false );         
         *
         *  @param $method  The method name.
         *  @param $action  The action or array of actions that triggerthe call.
         *  @param $before  (optional) Execute callback before theaction. Default: false.
         */

I have changed YDRequest->process() so that it returns results fromprocessing of actions and any associated callbacks. There is potentialfor adding error/results processing to YDProcess::execute()

Let me know what you think about the changes I made.

Regards,

Graeme



 		
---------------------------------
Stay in the know. Pulse on the new Yahoo.com.  Check it out. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060823/0e253b2e/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: callbacks.tar.gz
Type: application/gzip
Size: 10683 bytes
Desc: 3767147240-callbacks.tar.gz
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060823/0e253b2e/attachment.bin>

From ximian at mail.berlios.de  Wed Aug 23 17:10:06 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 17:10:06 +0200
Subject: [ydf-devel] r2039 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608231510.k7NFA6nS012953@sheep.berlios.de>

Author: ximian
Date: 2006-08-23 17:09:37 +0200 (Wed, 23 Aug 2006)
New Revision: 2039

Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent/
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php
Log:
- deleted all YDCM files from YDF core

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-23 06:43:55 UTC (rev 2038)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent.php	2006-08-23 15:09:37 UTC (rev 2039)
@@ -1,421 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-	// include YDF libs
-    YDInclude( 'YDDatabaseObject.php' );
-	YDInclude( 'YDDatabaseTree.php' );
-	YDInclude( 'YDUrl.php' );
-	YDInclude( 'YDError.php' );
-
-	require_once( dirname( __FILE__ ) . '/YDCMComponent/YDCMComp.php' );
-
-	// add generic translation directory
-	YDLocale::addDirectory( dirname( __FILE__ ) . '/YDCMComponent/languages/' );
-
-    class YDCMComponent extends YDDatabaseObject {
-
-        function YDCMComponent( $type, $id ) {
-
-			// init DB object
-            $this->YDDatabaseObject();
-
-            $this->_author = 'unknown author';
-            $this->_version = 'unknown version';
-            $this->_copyright = 'no copyright';
-            $this->_description = 'no description';
-
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( $type );
-
-			// add standard relation
-			$this->registerField( 'component_id' );
-       		$rel = & $this->registerRelation( 'YDCMComp', false, 'YDCMComp' );
-			$rel->setLocalKey( 'component_id' );
-			$rel->setForeignKey( 'component_id' );
-
-			// add comp object
-			$this->comp = new YDCMComp( $type, $id );
-			
-			$this->_id = intval( $id );
-		}
-
-
-        /**
-         *  This function sets a new id for this component
-         *
-         *  @param $id           Component id
-         */
-		function setId( $id ){
-
-			// set id for all operations in this class
-			$this->_id       = intval( $id );
-
-			// set id for internal YDComp object
-			$this->comp->_id = intval( $id );
-		}
-
-
-        /**
-         *  This function renders this element for menu
-         *
-         *  @returns    The YDDatabaseTree object for YDComponent static methods
-         */
-		function __getYDDatabaseTree(){
-		
-			// TODO: position is required and we must change order from 'parent_id' to 'parent_id ASC, position ASC'
-			$tree = new YDDatabaseTree( 'default', 'YDCMTree', 'content_id', 'parent_id', 'parent_id' );
-
-			// TODO: set sort by parent & position
-			// $tree->setSortField( 'parent_id ASC, position ASC' );
-
-			// add tree fields
-			$tree->addField( 'type' );
-			$tree->addField( 'state' );
-			$tree->addField( 'reference' );
-			$tree->addField( 'access' );
-			$tree->addField( 'searcheable' );
-			$tree->addField( 'published_date_start' );
-			$tree->addField( 'published_date_end' );
-			$tree->addField( 'candrag' );
-			$tree->addField( 'candrop' );
-			
-			return $tree;		
-		}
-
-
-        /**
-         *  This function renders this element for menu
-         *
-         *  @param $id           Component id
-         *  @param $urlObj       Url object
-         *
-         *  @returns    An html string
-         */
-		function render( $id, & $url ){
-		
-			return '';
-		}
-
-
-        /**
-         *  This function will render a menu
-         *
-         *  @returns    An array with all direct children
-         */
-		function renderMenu(){
-		
-			return $this->comp->renderMenu();
-		}
-
-
-        /**
-         *  This function returns all node attributes
-         *
-         *  @returns    An array with node attributes
-         */
-		function getNode(){
-
-			// check if we have already node attributes (some sort of caching)
-			if ( !isset( $this->__nodeProperties ) ) 
-				$this->__nodeProperties = $this->comp->getNode();
-		
-			return $this->__nodeProperties;
-		}
-
-
-		function getInfo(){
-		
-			return $this->comp->getInfo();
-		}
-
-        /**
-         *  This function returns a node attribute
-         *
-         *  @param $attribute           Attribute name
-         *
-         *  @returns    The node attribute
-         */
-		function get( $attribute ){
-
-			$node = $this->getNode();
-
-			// return attribute if exists 
-			if ( isset( $node[ $attribute ] ) ) return $node[ $attribute ];
-
-			return false;
-		}
-
-
-        /**
-         *  This static function returns an YDCMComponent module
-         *
-         *  @returns    an module object
-         */
-		function module( $name ){
-
-			// include lib
-			// TODO: check if name is a valid lib name
-			require_once( dirname( __FILE__ ) . '/YDCMComponent/' . $name . '.php' );
-
-			// return class
-			return new $name();
-		}
-
-
-        /**
-         *  This function returns all elements (except root)
-         *
-         *  @returns    all tree elements 
-         *  @static
-         */
-		function getTreeElements( $id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// check if we have a custom id
-			if( is_null( $id ) ) $id = $this->_id;
-
-			return $tree->getDescendants( $id );
-		}
-
-
-        /**
-         *  This function checks if elements are valid drag&dropable
-         *
-         *  @param $x  Id of dragable node
-         *  @param $y  Id of dropable node
-         *
-         *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x => 'PHCMPage', $y => 'PHCMRootmenu ))'
-         *  @static
-         */
-		function getDragDropElements( $x = null, $y = null ){
-		
-			// get tree module
-			$treeObj = YDCMComponent::module( 'YDCMTree' );
-
-			// check drop validation
-			return $treeObj->getDragDropElements( $x, $y );
-		}
-
-
-        /**
-         *  This function returns the path to current node
-         *
-         *  @returns    An array with all parents
-         */
-		function getPath(){
-
-			return $this->comp->getPath();
-		}
-
-
-        /**
-         *  This function returns all direct elements of a menu
-         *
-         *  @returns    An array with all direct children
-         */
-		function getMenu(){
-
-			return $this->comp->getMenu();
-		}
-
-
-        /**
-         *  This function returns the path string to current node
-         *
-         *  @param $separator    (Optional) Html separator string
-         *  @param $classParents (Optional) Html class for html links of parents
-         *  @param $classCurrent (Optional) Url object for element links
-         *
-         *  @returns    An html string
-         */
-		function getBreadcrum( $separator = ' &gt; ', $classParents = 'breadParents', $classCurrent = 'breadCurrent' ){
-
-			// get breadcrum from component
-			return $this->comp->getBreadcrum( $separator, $classParents, $classCurrent );
-		}
-
-
-        /**
-         *  This function returns the component author
-         *
-         *  @returns    component author
-         */
-		function getAuthor(){
-
-			return $this->_author;
-		}
-
-
-        /**
-         *  This function returns the component version
-         *
-         *  @returns    component version
-         */
-		function getVersion(){
-
-			return $this->_version;
-		}
-
-
-        /**
-         *  This function returns the component copyright
-         *
-         *  @returns    component copyright
-         */
-		function getCopyright(){
-
-			return $this->_copyright;
-		}
-
-
-        /**
-         *  This function returns the component description
-         *
-         *  @returns    component description
-         */
-		function getDescription(){
-
-			return $this->_description;
-		}
-
-
-        /**
-         *  This function sets a node state
-         *
-         *  @param $state      The state code
-         *
-         *  @returns    1 if state changed, 0 otherwise
-         */
-		function setState( $state, $id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// check if static
-			if( is_null( $id ) ) $id = $this->_id;
-
-			return $tree->updateNode( array( 'state' => $state ), $id );
-		}
-
-
-        /**
-         *  This function deletes the tree part of a component only
-         *
-         */
-		function deleteNode(){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			return $tree->deleteNode( $this->_id );
-		}
-
-
-        /**
-         *  This function adds a standard node in the tree. Experimental
-         *
-         *  @param $values  Node values
-         */
-		function addNode( $values, $parent_id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->addNode( $values, $parent_id );
-		}
-
-
-        /**
-         *  This function updates a node
-         *
-         *  @param $values  Node values
-         */
-		function updateNode( $values, $node_id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->updateNode( $values, $node_id );
-		}
-
-
-        /**
-         *  This function moves a node
-         *
-         *  @param $values  Node values
-         */
-		function moveNode( $x, $y ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->moveNode( $x, $y );
-		}
-
-
-    }
-
-
-	@define ( YD_ERROR_OK, 1000 );
-	
-    YDConfig::set( 'YD_ERROR_LEVELS', array(
-            YD_ERROR_NOTICE  => 'Notice',
-            YD_ERROR_WARNING => 'Warning',
-            YD_ERROR_FATAL   => 'Fatal',
-            YD_ERROR_OK      => 'Ok'
-        ));
-
-	// experimental class to handle all YDCM method results
-	class YDResult extends YDError{
-	
-        /**
-         *  This method creates a OK type
-         *
-         *  @param  $message  The message.
-         *  @param  $value    (optional) A custom value
-         *
-         *  @returns     An YDCMResult object.
-         *
-         *  @static
-         */
-        function ok( $message, $value = null ) {
-            return YDError::_error( YD_ERROR_OK, $message, $value );
-        }
-
-
-	}
-
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php	2006-08-23 06:43:55 UTC (rev 2038)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMStatistics.php	2006-08-23 15:09:37 UTC (rev 2039)
@@ -1,111 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-
-    class YDCMStatistics {
-
-        function YDCMStatistics() {
-		}
-		
-
-        /**
-         *  This static function returns php informations
-         *
-         *  @returns    an array with php info
-         */
-		function php(){
-		
-            // Get the general PHP info
-            ob_start();
-            phpinfo( INFO_GENERAL );
-            $phpInfo .= ob_get_contents();
-            ob_end_clean();
-
-            // Get the right part
-            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
-            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
-
-            // Strip unneeded things
-            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
-            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
-            $phpInfo = trim( $phpInfo );
-
-            // Get the settings
-            $settings = array();
-            foreach ( explode( "\n", $phpInfo ) as $line ) {
-                $line = explode( ' </td><td class="v">', $line );
-                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
-                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
-            }
-
-			// export other values
-			$settings[ 'version' ]     = phpversion();
-			$settings[ 'modules' ]     = implode( get_loaded_extensions(), ', ' );
-			$settings[ 'os' ]          = PHP_OS;
-			$settings[ 'includePath' ] = $GLOBALS['YD_INCLUDE_PATH'];
-
-			return $settings;
-		}
-
-
-        /**
-         *  This static function returns the mail info
-         *
-         *  @returns    an array with mail info
-         */
-		function mailer(){
-
-		    // Includes
-		    require_once( dirname( __FILE__ ) . '/../3rdparty/phpmailer/class.phpmailer.php' );
-
-            // Get the version of phpMailer
-            $PHPMailer = new PHPMailer();
-
-			return array( 'version' => $PHPMailer->Version, 'complete' => 'PHPMailer [version ' . $PHPMailer->Version . ']' );
-		}
-
-
-        /**
-         *  This static function returns an YDCMStatistics module
-         *
-         *  @returns    an module object
-         */
-		function module( $name ){
-
-			// include lib
-			// TODO: check if name is a valid lib name
-			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
-
-			// return class
-			return new $name();
-		}
-
-
-    }
-
-?>
\ No newline at end of file



From ximian at mail.berlios.de  Wed Aug 23 17:13:02 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 17:13:02 +0200
Subject: [ydf-devel] r2040 - in YDFramework2.0/trunk/YDFramework2/addons: .
	YDCMComponent YDCMComponent/languages
	YDCMComponent/languages/YDCMPage YDCMComponent/languages/YDCMUsers
Message-ID: <200608231513.k7NFD25W013169@sheep.berlios.de>

Author: ximian
Date: 2006-08-23 17:11:13 +0200 (Wed, 23 Aug 2006)
New Revision: 2040

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMHelpdesk/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMLink/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMPage/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMRootmenu/
Log:
- all YDCM files are now in same addon

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,114 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMAudit extends YDDatabaseObject {
+    
+        function YDCMAudit() {
+        
+			// init database object
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMAudit' );
+
+            // register custom key
+            $this->registerKey( 'audit_id', true );
+
+            // register custom fields
+			$this->registerField( 'user_id' );
+			$this->registerField( 'date' );
+			$this->registerField( 'object' );
+			$this->registerField( 'object_action' );
+			$this->registerField( 'object_id' );
+			$this->registerField( 'browser' );
+			$this->registerField( 'platform' );
+			$this->registerField( 'url' );
+
+			// register custom relation
+            $rel = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$rel->setLocalKey( 'user_id' );
+            $rel->setForeignKey( 'user_id' );
+			$rel->setForeignJoin( 'LEFT' );
+		}
+
+
+        /**
+         *  This function counts visits of a object
+         *
+         *  @param $id       Object id (content_id)
+         *  @param $user_id  (Optional) User id (0 means visitors)
+         *  @param $period   (Optional) Period for count. Valid values: 'week', 'month', year'
+         *
+         *  @returns    an array of labels => values
+         */
+		function getObjectVisits( $id, $user_id = 0, $period = 'week' ){
+		
+			YDInclude( 'YDDate.php' );
+		
+			// compute start date
+			$date = new YDDate();
+
+			$labels = array();
+			
+			if ( $period == 'week' )
+				for( $i = 0; $i < 7; $i++ ){
+					$labels[] = $date->getDayName();
+					$date->addDay( -1 );
+				}
+
+			if ( $period == 'month' )
+				for( $i = 0; $i < 4; $i++ ){
+					$labels[] = $date->getMonthName();
+					$date->addMonth( -1 );
+				}
+
+			if ( $period == 'year' )
+				for( $i = 0; $i < 3; $i++ ){
+					$labels[] = $date->getYear();
+					$date->addYear( -1 );
+				}
+
+			
+			$labels = array_reverse( $labels );
+
+		
+			$this->resetAll();
+			
+			$this->user_id = intval( $user_id );
+			
+		
+		}
+		
+		
+		
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,276 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	require_once( dirname( __FILE__ ) . '/YDCMTree.php' );
+	require_once( dirname( __FILE__ ) . '/YDCMLanguages.php' );
+
+    class YDCMComp extends YDDatabaseObject {
+    
+        function YDCMComp( $type, $id ) {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMComp' );
+
+            // register custom key
+            $this->registerKey( 'component_id', true );
+
+			// register fields	
+			$this->registerField( 'title' );
+			$this->registerField( 'version_default' );
+			$this->registerField( 'version_date' );
+
+			// add static relations to tree and language
+			$this->registerField( 'content_id' );
+       		$rel = & $this->registerRelation( 'YDCMTree', false, 'YDCMTree' );
+			$rel->setLocalKey( 'content_id' );
+			$rel->setForeignKey( 'content_id' );
+
+			$this->registerField( 'language_id' );
+       		$rel = & $this->registerRelation( 'YDCMLanguages', false, 'YDCMLanguages' );
+			$rel->setLocalKey( 'language_id' );
+			$rel->setForeignKey( 'language_id' );
+
+			$this->registerField( 'user_id' );
+       		$rel = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$rel->setLocalKey( 'user_id' );
+			$rel->setForeignKey( 'user_id' );
+
+			// add dynamic relation
+       		$rel = & $this->registerRelation( $type, false, $type );
+			$rel->setLocalKey( 'component_id' );
+			$rel->setForeignKey( 'component_id' );
+			$rel->setForeignJoin( 'LEFT' );
+
+			// store component id
+			$this->_id = intval( $id );
+			
+			// store type for future use
+			$this->_type = $type;
+		}
+
+
+        /**
+         *  This function return an array of parent nodes giving an node id
+         *
+         *  @returns    An array with all parent nodes
+         */
+		function getPath(){
+		
+			// 1st step: GET nleft and nright of this node. yes, it's ugly.. 
+			// TODO: change it with a better tree implementation
+			$this->resetAll();
+			$this->content_id  = $this->_id;
+			$this->language_id = YDLocale::get();
+
+			if ( $this->find( 'ydcmtree' ) != 1 ) return array();
+
+			$node = $this->getValues( false, false, false, false );
+		
+			// 2nd step: GET parents (based on previous nleft and nright)
+			$this->resetAll();
+
+			$this->language_id = YDLocale::get();
+			$this->where( 'YDCMTree.nleft  <= ' . intval( $node[ 'nleft' ] ) );
+			$this->where( 'YDCMTree.nright >= ' . intval( $node[ 'nright' ] ) );
+			$this->orderBy( 'YDCMTree.nlevel' );
+			$this->find( 'ydcmtree' );
+
+			return $this->getResults( false, false, false,false );
+		}
+
+
+        /**
+         *  This function returns the path string to a node
+         *
+         *  @param $separator    Html separator string
+         *  @param $classParents Html class for html links of parents
+         *  @param $classCurrent Html class for span ( current element )
+         *
+         *  @returns    An html string
+         */
+		function getBreadcrum( $separator, $classParents, $classCurrent ){
+
+			// init array for results
+			$res = array();
+
+			// init url object
+			$url = new YDUrl( YD_SELF_SCRIPT );
+
+			// cycle elements to get titles
+			foreach( $this->getPath() as $elements ){
+			
+				// set url var ID to this element
+				$url->setQueryVar( 'id',        $elements[ 'component_id' ] );
+				$url->setQueryVar( 'component', $elements[ 'type' ] );
+
+				// compute class name
+				if ( $this->_id != $elements[ 'content_id' ] ) $res[] = '<a class="' . $classParents . '" href="' . $url->getUrl() . '">' . $elements[ 'title' ] . '</a>';
+				else                                           $res[] = '<span class="' . $classCurrent . '">' . $elements[ 'title' ] . '</span>';
+			}
+
+			// return html string
+			return implode( $separator, $res );
+		}
+		
+		
+        /**
+         *  This function returns an array with all direct children
+         *
+         *  @returns    An array with all direct children
+         */
+		function getMenu(){
+		
+			$this->resetAll();
+
+			$this->language_id = YDLocale::get();
+			$this->where( 'YDCMTree.parent_id  = ' . $this->_id );
+			$this->find( 'ydcmtree' );
+			
+			return $this->getResults( false, false, false, false );
+		}
+
+
+        /**
+         *  This function will render all menu elements
+         *
+         *  @returns    An array with all direct children
+         */
+		function renderMenu(){
+
+			$menu = array();
+
+			$url = new YDUrl( YD_SELF_SCRIPT );
+
+			// render each element
+			foreach( $this->getMenu() as $element ){
+
+				$el = new $element[ 'type' ];
+				$menu[] = $el->render( $element, $url );
+			}
+
+			return $menu;
+		}
+
+
+        /**
+         *  This function return node attributes
+         *
+         *  @returns    An array with all attributes
+         */
+		function getNode(){
+		
+			// delete previous stored values
+			$this->resetAll();
+
+			// define our id to find		
+			$this->content_id  = $this->_id;
+			$this->language_id = YDLocale::get();
+			
+			$this->limit( 1 );
+			
+			// find node
+			$this->findAll();
+			
+			// parse html
+			if ( isset( $this->html ) )  $this->html  = htmlentities( $this->html );
+			if ( isset( $this->xhtml ) ) $this->xhtml = htmlentities( $this->xhtml );
+
+			// return node attributes without relation prefixs
+			return $this->getValues( false, false, false, false );
+		}
+
+
+        /**
+         *  This function return node infomation
+         *
+         *  @returns    An array with all information: array( 'description' => .., 'versions' => .., 'versions_total' => .. )
+         */
+		function getInfo(){
+		
+			// delete previous stored values
+			$this->resetAll();
+
+			// define our id to find		
+			$this->content_id  = $this->_id;
+
+			// order versions by version date
+			$this->orderBy( 'version_date', 'desc' );
+			
+			// find node
+			$this->find( 'ydcmtree', 'ydcmusers', strtolower( $this->_type ) );
+
+			$versions = $this->getResultsAsAssocArray( array( 'language_id', 'version_date' ) );
+			
+			// init description and total of versions
+			$description    = array();
+			$versions_total = 0;
+
+			// cycle versions, count and get first description (they must be all the same)
+			foreach( $versions as $v => $arr ){
+			
+				$versions_total += count( $arr );
+			
+				if ( empty( $description ) ) $description = array_values( $arr );
+			}
+
+			// parse publish dates
+			if ( $description[0][ 'YDCMTree_state' ] != 2 ){
+				$description[0][ 'YDCMTree_published_date_start_trans' ] = t('not applicable');
+				$description[0][ 'YDCMTree_published_date_end_trans' ]   = t('not applicable');
+			}
+
+			// parse access
+			if ( $description[0][ 'YDCMTree_access' ] == 1 ) $description[0][ 'YDCMTree_access_trans' ] = t('public');
+			else                                             $description[0][ 'YDCMTree_access_trans' ] = t('private');
+
+			// parse state
+			switch ($description[0][ 'YDCMTree_state' ]){
+				case 0 : $description[0][ 'YDCMTree_state_trans' ] = t('not published'); break;
+				case 1 : $description[0][ 'YDCMTree_state_trans' ] = t('published');     break;
+				case 2 : $description[0][ 'YDCMTree_state_trans' ] = t('schedule');      break;
+			}
+
+			// parse searcheable
+			if ( $description[0][ 'YDCMTree_searcheable' ] == 1 ) $description[0][ 'YDCMTree_searcheable_trans' ] = t('yes');
+			else                                                  $description[0][ 'YDCMTree_searcheable_trans' ] = t('no');
+
+			// return the information array
+			return array(	'description'    => $description[0],
+							'versions'       => $versions,
+							'versions_total' => $versions_total );
+		}
+
+}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,406 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// include YDF libs
+    YDInclude( 'YDDatabaseObject.php' );
+	YDInclude( 'YDDatabaseTree.php' );
+	YDInclude( 'YDUrl.php' );
+	YDInclude( 'YDError.php' );
+
+	// include YDCM libs
+	YDInclude( 'YDCMComp.php' );
+
+	// add generic translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+    class YDCMComponent extends YDDatabaseObject {
+
+        function YDCMComponent( $type, $id ) {
+
+			// init DB object
+            $this->YDDatabaseObject();
+
+            $this->_author = 'unknown author';
+            $this->_version = 'unknown version';
+            $this->_copyright = 'no copyright';
+            $this->_description = 'no description';
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( $type );
+
+			// add standard relation
+			$this->registerField( 'component_id' );
+       		$rel = & $this->registerRelation( 'YDCMComp', false, 'YDCMComp' );
+			$rel->setLocalKey( 'component_id' );
+			$rel->setForeignKey( 'component_id' );
+
+			// add comp object
+			$this->comp = new YDCMComp( $type, $id );
+			
+			$this->_id = intval( $id );
+		}
+
+
+        /**
+         *  This function sets a new id for this component
+         *
+         *  @param $id           Component id
+         */
+		function setId( $id ){
+
+			// set id for all operations in this class
+			$this->_id       = intval( $id );
+
+			// set id for internal YDComp object
+			$this->comp->_id = intval( $id );
+		}
+
+
+        /**
+         *  This function renders this element for menu
+         *
+         *  @returns    The YDDatabaseTree object for YDComponent static methods
+         */
+		function __getYDDatabaseTree(){
+		
+			// TODO: position is required and we must change order from 'parent_id' to 'parent_id ASC, position ASC'
+			$tree = new YDDatabaseTree( 'default', 'YDCMTree', 'content_id', 'parent_id', 'parent_id' );
+
+			// TODO: set sort by parent & position
+			// $tree->setSortField( 'parent_id ASC, position ASC' );
+
+			// add tree fields
+			$tree->addField( 'type' );
+			$tree->addField( 'state' );
+			$tree->addField( 'reference' );
+			$tree->addField( 'access' );
+			$tree->addField( 'searcheable' );
+			$tree->addField( 'published_date_start' );
+			$tree->addField( 'published_date_end' );
+			$tree->addField( 'candrag' );
+			$tree->addField( 'candrop' );
+			
+			return $tree;		
+		}
+
+
+        /**
+         *  This function renders this element for menu
+         *
+         *  @param $id           Component id
+         *  @param $urlObj       Url object
+         *
+         *  @returns    An html string
+         */
+		function render( $id, & $url ){
+		
+			return '';
+		}
+
+
+        /**
+         *  This function will render a menu
+         *
+         *  @returns    An array with all direct children
+         */
+		function renderMenu(){
+		
+			return $this->comp->renderMenu();
+		}
+
+
+        /**
+         *  This function returns all node attributes
+         *
+         *  @returns    An array with node attributes
+         */
+		function getNode(){
+
+			// check if we have already node attributes (some sort of caching)
+			if ( !isset( $this->__nodeProperties ) ) 
+				$this->__nodeProperties = $this->comp->getNode();
+		
+			return $this->__nodeProperties;
+		}
+
+
+		function getInfo(){
+		
+			return $this->comp->getInfo();
+		}
+
+        /**
+         *  This function returns a node attribute
+         *
+         *  @param $attribute           Attribute name
+         *
+         *  @returns    The node attribute
+         */
+		function get( $attribute ){
+
+			$node = $this->getNode();
+
+			// return attribute if exists 
+			if ( isset( $node[ $attribute ] ) ) return $node[ $attribute ];
+
+			return false;
+		}
+
+
+        /**
+         *  This function returns all elements (except root)
+         *
+         *  @returns    all tree elements 
+         *  @static
+         */
+		function getTreeElements( $id = null ){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			// check if we have a custom id
+			if( is_null( $id ) ) $id = $this->_id;
+
+			return $tree->getDescendants( $id );
+		}
+
+
+        /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *  @param $y  Id of dropable node
+         *
+         *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x => 'PHCMPage', $y => 'PHCMRootmenu ))'
+         *  @static
+         */
+		function getDragDropElements( $x = null, $y = null ){
+		
+			// get tree module
+			$treeObj = YDCMComponent::module( 'YDCMTree' );
+
+			// check drop validation
+			return $treeObj->getDragDropElements( $x, $y );
+		}
+
+
+        /**
+         *  This function returns the path to current node
+         *
+         *  @returns    An array with all parents
+         */
+		function getPath(){
+
+			return $this->comp->getPath();
+		}
+
+
+        /**
+         *  This function returns all direct elements of a menu
+         *
+         *  @returns    An array with all direct children
+         */
+		function getMenu(){
+
+			return $this->comp->getMenu();
+		}
+
+
+        /**
+         *  This function returns the path string to current node
+         *
+         *  @param $separator    (Optional) Html separator string
+         *  @param $classParents (Optional) Html class for html links of parents
+         *  @param $classCurrent (Optional) Url object for element links
+         *
+         *  @returns    An html string
+         */
+		function getBreadcrum( $separator = ' &gt; ', $classParents = 'breadParents', $classCurrent = 'breadCurrent' ){
+
+			// get breadcrum from component
+			return $this->comp->getBreadcrum( $separator, $classParents, $classCurrent );
+		}
+
+
+        /**
+         *  This function returns the component author
+         *
+         *  @returns    component author
+         */
+		function getAuthor(){
+
+			return $this->_author;
+		}
+
+
+        /**
+         *  This function returns the component version
+         *
+         *  @returns    component version
+         */
+		function getVersion(){
+
+			return $this->_version;
+		}
+
+
+        /**
+         *  This function returns the component copyright
+         *
+         *  @returns    component copyright
+         */
+		function getCopyright(){
+
+			return $this->_copyright;
+		}
+
+
+        /**
+         *  This function returns the component description
+         *
+         *  @returns    component description
+         */
+		function getDescription(){
+
+			return $this->_description;
+		}
+
+
+        /**
+         *  This function sets a node state
+         *
+         *  @param $state      The state code
+         *
+         *  @returns    1 if state changed, 0 otherwise
+         */
+		function setState( $state, $id = null ){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			// check if static
+			if( is_null( $id ) ) $id = $this->_id;
+
+			return $tree->updateNode( array( 'state' => $state ), $id );
+		}
+
+
+        /**
+         *  This function deletes the tree part of a component only
+         *
+         */
+		function deleteNode(){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			return $tree->deleteNode( $this->_id );
+		}
+
+
+        /**
+         *  This function adds a standard node in the tree. Experimental
+         *
+         *  @param $values  Node values
+         */
+		function addNode( $values, $parent_id = null ){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			// use YDDatabasetree method
+			return $tree->addNode( $values, $parent_id );
+		}
+
+
+        /**
+         *  This function updates a node
+         *
+         *  @param $values  Node values
+         */
+		function updateNode( $values, $node_id = null ){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			// use YDDatabasetree method
+			return $tree->updateNode( $values, $node_id );
+		}
+
+
+        /**
+         *  This function moves a node
+         *
+         *  @param $values  Node values
+         */
+		function moveNode( $x, $y ){
+
+			// init db tree object
+			$tree = YDCMComponent::__getYDDatabaseTree();
+
+			// use YDDatabasetree method
+			return $tree->moveNode( $x, $y );
+		}
+
+
+    }
+
+
+	@define ( YD_ERROR_OK, 1000 );
+	
+    YDConfig::set( 'YD_ERROR_LEVELS', array(
+            YD_ERROR_NOTICE  => 'Notice',
+            YD_ERROR_WARNING => 'Warning',
+            YD_ERROR_FATAL   => 'Fatal',
+            YD_ERROR_OK      => 'Ok'
+        ));
+
+	// experimental class to handle all YDCM method results
+	class YDResult extends YDError{
+	
+        /**
+         *  This method creates a OK type
+         *
+         *  @param  $message  The message.
+         *  @param  $value    (optional) A custom value
+         *
+         *  @returns     An YDCMResult object.
+         *
+         *  @static
+         */
+        function ok( $message, $value = null ) {
+            return YDError::_error( YD_ERROR_OK, $message, $value );
+        }
+
+
+	}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,476 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+	YDInclude( 'YDForm.php' );
+	YDInclude( 'YDCMComponent.php' );
+
+	// load users module of YDCMComponent
+	YDCMComponent::module( 'YDCMUsers' );
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+	// set posts form name
+	YDConfig::set( 'YDCMHELPDESK_FORMPOST', 'YDCMHelpdeskFormPost', false );
+
+	// set default states
+	YDConfig::set( 'YDCMHELPDESK_STATES', array( 'allstates', 'closed', 'open', 'pendent' ), false );
+
+	// set default types
+	YDConfig::set( 'YDCMHELPDESK_TYPES', array( 'email', 'telephone', 'personal' ), false );
+
+    // set default urgencies (TODO: maybe 'priorities')
+    YDConfig::set( 'YDCMHELPDESK_URGENCIES', array( 'allurgencies' => array(),
+	                                                'low'          => array( 'color' => '#00FF00' ), 
+                                                    'medium'       => array( 'color' => '#FF9900' ), 
+													'high'         => array( 'color' => '#FF9900' ) ), false );
+
+
+    class YDCMHelpdesk extends YDCMComponent {
+    
+        function YDCMHelpdesk() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMHelpdesk' );
+
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '0.1';
+            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
+            $this->_description = 'This is a simple helpdesk component';
+
+			// register custom fields
+			$this->registerField( 'title' );
+						
+			// custom relation
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'component_id' );
+            $rel->setForeignKey( 'component_id' );
+			$rel->setForeignJoin( 'LEFT' );
+		}
+
+
+        /**
+         *  This function creates a new helpdesk
+         *
+         *  @param $title  Helpdesk title
+         *  @param $language_id  (Optional) Language code of the heldesk
+         *  @param $reference  (Optional) Node reference
+         *  @param $parent_id  (Optional) Id of the parent help desk
+         */
+		function addHelpdesk( $title, $language_id = 'all', $reference = '', $parent_id = 0 ){
+		
+			// add node to content tree
+			$node = array();
+			$node[ 'type' ]        = 'YDCMHelpdesk';
+			$node[ 'reference' ]   = $reference;
+			$node[ 'state' ]       = 1;
+			$node[ 'access' ]      = 1;
+			$node[ 'searcheable' ] = 0;
+
+			// add tree node
+			// TODO: check if parent_id exist
+			$id = $this->addNode( $node, intval( $parent_id ) );
+		
+			// add a standard title
+			return $this->addTitle( $id, $title, $language_id );
+		}
+
+		
+		function addTitle( $id, $title, $language_id ){
+		
+			// reset values
+			$this->resetValues();
+
+			// add a default helpdesk title
+			// TODO: check if language code exist
+			$this->content_id  = $id;
+			$this->title       = $title;
+			$this->language_id = $language_id;
+
+			// insert values
+			return $this->insert();
+		}
+
+
+        /**
+         *  This static function returns an array of possible states
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getStates( $translated = false ){
+		
+			return YDCMHelpdesk::getInfo( $translated, YDConfig::get( 'YDCMHELPDESK_STATES' ) );
+		}
+
+
+        /**
+         *  This static function returns an array of possible urgencies
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getUrgencies( $translated = false ){
+		
+			return YDCMHelpdesk::getInfo( $translated, array_keys( YDConfig::get( 'YDCMHELPDESK_URGENCIES' ) ) );
+		}
+		
+		
+        /**
+         *  This private static function returns an array/associative array based on states/urgencies
+         *
+         *  @param $translated  (Optional) boolean that defines if result uses translation strings
+         */
+		function getInfo( $translated, $arr ){
+			
+			// if we don't want translation, just return
+			if ( $translated != false ) return $arr;
+			
+			// compute associative array
+			$tmp = array();
+			foreach( $states as $s )
+				$tmp[ $s ] = t( $s );
+
+			return $tmp;
+		}
+
+    }
+
+
+
+    class YDCMHelpdesk_posts extends YDDatabaseObject {
+    
+        function YDCMHelpdesk_posts() {
+        
+			// init component
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_posts' );
+
+			// register Key
+			$this->registerKey( 'post_id', true );
+
+			// register custom fields
+			$this->registerField( 'component_id' );
+			$this->registerField( 'user_id' );
+			$this->registerField( 'subject' );
+			$this->registerField( 'urgency_id' );
+			$this->registerField( 'state_id' );
+			$this->registerField( 'text' );
+			$this->registerField( 'creation_date' );
+			$this->registerField( 'reportedby_user' );
+			$this->registerField( 'reportedby_type' );
+			$this->registerField( 'reportedby_local' );
+			$this->registerField( 'reportedby_date' );
+			$this->registerField( 'assignedto_user' );
+			$this->registerField( 'assignedto_type' );
+			$this->registerField( 'assignedto_local' );
+			$this->registerField( 'assignedto_date' );
+
+			// custom relation
+            $rel = & $this->registerRelation( 'YDCMHelpdesk', false, 'YDCMHelpdesk' );
+			$rel->setLocalKey( 'component_id' );
+            $rel->setForeignKey( 'component_id' );
+
+            $relUsers = & $this->registerRelation( 'users', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+
+            $relResponse = & $this->registerRelation( 'YDCMHelpdesk_response', false, 'YDCMHelpdesk_response' );
+			$relResponse->setLocalKey( 'post_id' );
+            $relResponse->setForeignKey( 'post_id' );
+			$relResponse->setForeignJoin( 'LEFT' );
+
+			// set default columns information
+			$this->columns = array(	'post_id'       => array('sortable' => true), 
+									'subject'       => array('sortable' => true),
+									'name'          => array('sortable' => true), 
+									'creation_date' => array('sortable' => true) );
+		}
+
+
+        /**
+         *  This function defines columns to use in recordsets/ajaxgrids
+         *
+         *  @param $columns  Helpdesk post columns for recorsets/ajaxgrids
+         */
+		function setColumns( $columns ){
+		
+			$this->columns = $columns;
+		}
+
+
+        /**
+         *  This function returns a form for posts
+         */
+		function getFormPost(){
+		
+			// create a form for new posts
+            $form = new YDForm( YDConfig::get( 'YDCMHELPDESK_FORMPOST' ) );
+
+			// get urgencies, states and types
+			$urgencies = array_keys( YDConfig::get( 'YDCMHELPDESK_URGENCIES' ) );
+			$states    = YDConfig::get( 'YDCMHELPDESK_STATES' );
+			$types     = YDConfig::get( 'YDCMHELPDESK_TYPES' );
+
+			// delete 'allstates' and 'allurgencies' from states and types
+			array_shift( $urgencies );
+			array_shift( $states );
+
+			// add new form elements
+            $form->addElement( 'text',			'subject',			 t('ticket_subject'),           array('size' => 50) );
+            $form->addElement( 'select', 		'urgency_id',		 t('ticket_urgency_id'),        array(), $urgencies );
+            $form->addElement( 'select',		'state_id',			 t('ticket_state_id'),          array(), $states );
+            $form->addElement( 'textarea',		'text',              t('ticket_text'),              array('cols' => 80, 'rows' => 15) );
+
+            $form->addElement( 'span',			'creation_user',	 t('ticket_creation_user') );
+            $form->addElement( 'datetimeselect','creation_date',     t('ticket_creation_date') );
+
+            $form->addElement( 'text',			'reportedby_user',	 t('ticket_reportedby_user'),  array('size' => 50) );
+            $form->addElement( 'select', 		'reportedby_type',	 t('ticket_reportedby_type'),  array(), $types );
+            $form->addElement( 'text',			'reportedby_local',  t('ticket_reportedby_local') );
+            $form->addElement( 'datetimeselect','reportedby_date',	 t('ticket_reportedby_date') );
+  
+            $form->addElement( 'text',          'assignedto_user',	 t('ticket_assignedto_user'),  array('size' => 50) );
+            $form->addElement( 'select',		'assignedto_type',	 t('ticket_assignedto_type'),  array(), $types  );
+            $form->addElement( 'text', 		    'assignedto_local',	 t('ticket_assignedto_local') );
+            $form->addElement( 'datetimeselect','assignedto_date',   t('ticket_assignedto_date') );
+
+			$form->setDefault( 'urgency_id', 1 );
+			$form->setDefault( 'state_id',   1 );
+
+			return $form;
+		}
+
+
+        /**
+         *  This function adds a new post
+         *
+         *  @param $helpdesk_id  helpdesk id of this post
+         *  @param $user_id  User id
+         *  @param $values  Array of values
+         */
+		function addPost( $helpdesk_id, $user_id, $values ){
+
+			// get YDForm object
+			$form = $this->getFormPost();
+
+			// check form validation
+			if ( !$form->validate( $values ) )
+				return $form->getErrors();
+
+			$this->resetValues();
+		
+			// add required fields
+			// TODO: check if user, urgency and state exist
+			$this->setValues( $form->getValues() );
+
+			$this->component_id = $helpdesk_id;
+			$this->user_id      = $user_id;
+
+			// parse dates (convert ugly array in a date time sqlformat )
+			$this->creation_date   = YDStringUtil::formatDate( $this->creation_date,   'datetimesql' );
+			$this->reportedby_date = YDStringUtil::formatDate( $this->reportedby_date, 'datetimesql' );
+			$this->assignedto_date = YDStringUtil::formatDate( $this->assignedto_date, 'datetimesql' );
+
+			return $this->insert();
+		}
+		
+
+        /**
+         *  This function just deletes a post given its id
+         *
+         *  @param $post_id  Post id to delete
+         */
+		function deletePost( $post_id ){
+		
+			$this->resetValues();
+			
+			$this->post_id = intval( $post_id );
+			
+			return $this->delete();
+		}
+
+
+        /**
+         *  This function deletes all posts of a helpdesk
+         *
+         *  @param $helpdesk_id  Helpdesk id
+         */
+		function deleteAll( $helpdesk_id ){
+		
+			$this->resetValues();
+			
+			$this->component_id = intval( $helpdesk_id );
+			
+			return $this->delete();
+		}
+
+
+        /**
+         *  This function deletes all posts using a parent id
+         *
+         *  @param $parent_id  parent id
+         */
+		function deleteParent( $parent_id ){
+		
+			$this->resetValues();
+			
+			$this->parent_id = intval( $parent_id );
+			
+			return $this->delete();
+		}
+
+
+        /**
+         *  This function returns a recordset with posts
+         *
+         *  @param $fields  Array of fields
+         */
+		function getRecordSet( $fields ){
+
+			// delete previous values
+			$this->resetValues();
+
+			// check column name. TODO: check if column is a valid helpdesk or user column
+			if ( isset( $fields[ 'grid_column' ] ) ) $column = $fields[ 'grid_column' ];
+			else                                     $column = 'creation_date';
+
+			// check direction
+			if ( isset( $fields[ 'grid_direction' ] ) && $fields[ 'grid_direction' ] == 'asc' ) $desc = false;
+			else                                                                                $desc = true;
+
+			// apply column order
+            $this->order( $column . ' ' . $fields['g'] );
+
+			// apply state
+			if ( isset( $fields[ 'grid_state' ] ) && in_array( $fields[ 'grid_state' ], array_keys( YDConfig::get( 'YDCMHELPDESK_STATES' ) ) ) )
+				$this->state_id = $fields[ 'grid_state' ];
+
+			// apply urgency
+			if ( isset( $fields[ 'grid_urgency' ] ) && in_array( $fields[ 'grid_urgency' ], YDConfig::get( 'YDCMHELPDESK_URGENCIES' ) ) )
+				$this->urgency_id = $fields[ 'grid_urgency' ];
+
+			// get information of users too
+			$this->find( 'users' );
+
+			// check page to show
+			if ( isset( $fields[ 'grid_page' ] ) && is_numeric( $fields[ 'grid_page' ] ) ) $page = intval( $fields[ 'grid_page' ] );
+			else                                                                           $page = 1;
+
+			// create a recordset
+			return new YDRecordSet( $this->getResultsAsAssocArray( 'post_id', array_keys( $this->columns ), false, false, false, false ), $page, 3 );
+		}
+
+
+        /**
+         *  This function returns a ajax grid
+         *
+         *  @param $fields  Array of fields
+         */
+		function getAjaxGrid( $fields = array() ){
+		
+			// include grid lib
+			YDInclude( 'YDFormElement_Grid.php' );
+
+			// init grid
+			$grid = new YDFormElement_Grid();
+
+			// add recordset to grid
+			$grid->setValue( $this->getRecordSet( $fields ) );
+			
+			// add columns information to grid
+			$grid->setColumns( $this->columns );
+
+			return $grid;
+		}
+		
+		
+
+	}
+
+
+
+    class YDCMHelpdesk_response extends YDDatabaseObject {
+    
+        function YDCMHelpdesk_response() {
+        
+			// init component
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMHelpdesk_response' );
+
+			// register Key
+			$this->registerKey( 'response_id', true );
+
+			// register custom fields
+			$this->registerField( 'post_id' );
+			$this->registerField( 'user_id' );
+			$this->registerField( 'date' );
+			$this->registerField( 'description' );
+
+			// custom relations
+            $rel = & $this->registerRelation( 'YDCMHelpdesk_posts', false, 'YDCMHelpdesk_posts' );
+			$rel->setLocalKey( 'post_id' );
+            $rel->setForeignKey( 'post_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+
+		function addResponse( $post_id, $user_id, $message ){
+		
+			YDInclude( 'YDUtil.php' );
+
+			$this->resetValues();
+		
+			// create response
+			// TODO: check if post_id and user_id are valid
+			$this->post_id     = intval( $post_id );
+			$this->user_id     = intval( $user_id );
+			$this->date        = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$this->description = $message;
+
+			return $this->insert();
+		}
+		
+		
+	}	
+
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,99 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMLanguages extends YDDatabaseObject {
+
+        function YDCMLanguages() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLanguages' );
+
+            // define custom key
+            $this->registerKey( 'language_id', true );
+
+			// Fields
+			$this->registerField( 'name' );
+			$this->registerField( 'active' );
+			$this->registerField( 'visitors_default' );
+			$this->registerField( 'admin_default' );
+
+			// we don't have relations from here (just TO here, and we don't need to define that)
+		}
+
+
+        /**
+         *  This function returns all active languages
+         *
+         *  @returns    Array of languages, eg: array( 'en' => 'English', 'pt' => ... )
+         */
+		function active(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want only results where active is 1
+			$this->active = 1;
+
+			// find all languages
+			$this->find();
+
+			// return results as array
+			return $this->getResultsAsAssocArray( 'language_id', 'name' );
+		}
+
+
+        /**
+         *  This function returns the default language for content creation
+         *
+         *  @returns    Language code, eg: 'en'. or false
+         */
+		function adminDefault(){
+		
+			// reset values
+			$this->resetValues();
+
+			// we want the result where admin default is 1
+			$this->admin_default = 1;
+			$this->limit( 1 );
+			
+			// find language
+			if ( $this->find() == 1 ) return $this->language_id;
+			
+			return false;
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,70 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	YDInclude( 'YDCMComponent.php' );
+
+
+    class YDCMLink extends YDCMComponent {
+    
+        function YDCMLink() {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMLink' );
+
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '0.1';
+            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
+            $this->_description = 'This is a link component';
+
+			// register custom fields
+			$this->registerField( 'url' );
+			$this->registerField( 'num_visits' );
+
+			// we don't have custom relations
+		}
+
+
+        /**
+         *  This function will render this element (to be used in a menu)
+         *
+         *  @returns    Html link
+         */
+		function render( $component, & $url ){
+
+			$url->setQueryVar( 'component', $component[ 'type' ] );
+			$url->setQueryVar( 'id',        $component[ 'content_id' ] );
+
+			// get url properties from DB
+			$this->getNode( $component[ 'content_id' ] );
+
+			return '<a href="' . $this->url . '">' . $component[ 'title' ] . '</a>';
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,58 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMLocks extends YDDatabaseObject {
+    
+        function YDCMLocks() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMLocks' );
+
+            // register custom fields
+			$this->registerField( 'content_id' );
+			$this->registerField( 'user_id' );
+
+			// register custom relations
+            $relTree = & $this->registerRelation( 'YDCMTree', false, 'YDCMTree' );
+			$relTree->setLocalKey( 'content_id' );
+            $relTree->setForeignKey( 'content_id' );
+
+            $relUsers = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
+			$relUsers->setLocalKey( 'user_id' );
+            $relUsers->setForeignKey( 'user_id' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,229 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	YDInclude( 'YDCMComponent.php' );
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+
+	// set page form name
+	YDConfig::set( 'YDCMPAGE_FORMPAGE', 'YDCMPageForm', false );
+
+
+    class YDCMPage extends YDCMComponent {
+    
+        function YDCMPage( $id = null ) {
+
+			// init component
+            $this->YDCMComponent( 'YDCMPage', $id );
+
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '0.1';
+            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
+            $this->_description = 'This is a page component';
+
+            // define custom fields
+			$this->registerField( 'current_version' );
+			$this->registerField( 'html' );
+			$this->registerField( 'xhtml' );
+			$this->registerField( 'template_pack' );
+			$this->registerField( 'template' );
+			$this->registerField( 'metatags' );			
+			$this->registerField( 'description' );
+			$this->registerField( 'keywords' );			
+
+			// we don't have custom relations
+		}
+
+		
+        /**
+         *  This function will render this element (to be used in a menu)
+         *
+         *  @returns    Html link
+         */
+		function render( $component, & $url ){
+
+			$url->setQueryVar( 'component', $component[ 'type' ] );
+			$url->setQueryVar( 'id',        $component[ 'content_id' ] );
+
+			return '<a href="' . $url->getUrl() . '">' . $component[ 'title' ] . '</a>';
+		}
+
+
+        /**
+         *  This function returns the page form (form admin edition)
+         *
+         *  @returns    YDForm object
+         */
+		function getFormPage(){
+
+			YDInclude( 'YDForm.php' );
+
+			// get template and language object
+			$templates = YDCMComponent::module( 'YDCMTemplates' );
+			$languages = YDCMComponent::module( 'YDCMLanguages' );
+
+			// create access options
+			$access = array( 0 => t('public'), 1 => t('private') );
+
+			// create 'template pack' options
+			$template_pack = array(	1	=> t('use templatepack') . ' (' . $templates->template_pack() . ')',
+									0	=> t('use custom template') );
+	
+			// create form object
+			$form = new YDForm( YDConfig::get( 'YDCMPAGE_FORMPAGE' ) );
+
+	        $form->addElement( 'text',           'reference',            t('page_reference'),      array('size' => 25, 'maxlength' => 35) );
+	        $form->addElement( 'text',           'title',                t('page_title'),          array('size' => 70, 'maxlength' => 70) );
+	        $form->addElement( 'textarea',       'html',                 t('page_html') );
+	        $form->addElement( 'textarea',       'xhtml',                t('page_xhtml') );
+	        $form->addElement( 'select',         'access',               t('page_access'),         array(), $access);
+	        $form->addElement( 'select',         'state',                t('page_state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+	        $form->addElement( 'datetimeselect', 'published_date_start', t('page_startdate') );
+	        $form->addElement( 'datetimeselect', 'published_date_end',   t('page_enddate'));
+	        $form->addElement( 'select',         'template_pack',        '',                       array(), $template_pack );
+	        $form->addElement( 'select',         'template',             t('page_template'),       array(), $templates->visitors_templates());
+	        $form->addElement( 'select',         'metatags',             t('page_metatags'),       array(), array( 0 => t('no'), 1 => t('yes') ) );
+	        $form->addElement( 'textarea',       'description',          t('page_description'),    array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'textarea',       'keywords',             t('page_keywords'),       array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'select',         'searcheable',          t('page_search'),         array(), array( 0 => t('no'), 1 => t('yes') ) );
+	        $form->addElement( 'hidden',         'content_id' );
+	        $form->addElement( 'hidden',         'parent_id' );
+	        $form->addElement( 'hidden',         'language_id' );
+
+			// parent of new page is 0 by default
+			$form->setDefault( 'content_id',  0 );
+			$form->setDefault( 'parent_id',   0 );
+			$form->setDefault( 'language_id', $languages->adminDefault() );
+
+			// add form rules
+			$form->addRule( 'reference',      'required',       t('reference_required') );
+			$form->addRule( 'reference',      'alphanumeric',   t('reference_alphanumeric') );
+			$form->addRule( 'reference',      'maxwords',       t('reference_maxwords'),  1 );
+			$form->addRule( 'reference',      'maxlength',      t('reference_maxlength'), 100 );
+			$form->addRule( 'title',          'required',       t('title_required') );
+			$form->addRule( 'title',          'maxlength',      t('title_maxlength'), 255 );
+			$form->addRule( 'content_id',     'required',       t('content_id_required') );
+			$form->addRule( 'content_id',     'numeric',        t('content_id_numeric') );
+			$form->addRule( 'parent_id',      'required',       t('parent_id_required') );
+			$form->addRule( 'parent_id',      'numeric',        t('parent_id_numeric') );
+			$form->addRule( 'html',           'maxlength',      t('html_maxlength'),  50000 );
+			$form->addRule( 'xhtml',          'maxlength',      t('xhtml_maxlength'), 50000 );
+			$form->addRule( 'template_pack',  'in_array',       t('template_pack_invalid'), array( 0, 1 ) );
+			$form->addRule( 'template',       'in_array',       t('template_invalid'),      array_keys( $templates->visitors_templates() ) );
+			$form->addRule( 'metatags',       'in_array',       t('metatags_invalid'),      array( 0, 1 ) );
+			$form->addRule( 'description',    'maxlength',      t('description_maxlength'), 2000 );
+			$form->addRule( 'keywords',       'maxlength',      t('keywords_maxlength'),    2000 );
+
+			return $form;
+		}
+
+
+
+        /**
+         *  This function adds/updates a page (if content_id is 0 will add a page, otherwise will update)
+         *
+         *  @param $formvalues  Array with page attributes from the standard form
+         *
+         *  @returns    content_id updated or new content_id
+         */
+		function savePageForm( $formvalues = array() ){
+
+			// get page YDForm object
+			$form = $this->getFormPage();
+
+			// check form validation
+			if ( !$form->validate( $formvalues ) )
+				return $form->getErrors();
+
+			// init node values
+			$node = array();			
+			$node[ 'type' ]        = 'YDCMPage';
+			$node[ 'reference' ]   = $form->getValue( 'reference' );
+			$node[ 'state' ]       = $form->getValue( 'state' );
+			$node[ 'access' ]      = $form->getValue( 'access' );
+			$node[ 'searcheable' ] = $form->getValue( 'searcheable' );
+
+			// convert published date start/end timestamp to a db datetime format
+			$node[ 'published_date_start' ] = YDStringUtil::formatDate( $form->getValue( 'published_date_start' ), 'datetimesql' );
+			$node[ 'published_date_end' ]   = YDStringUtil::formatDate( $form->getValue( 'published_date_end' ),   'datetimesql' );
+
+			// get id of this node
+			$id = $form->getValue( 'content_id' );
+
+			// if content_id is 0 we are trying to add a new node, otherwise we only need to update it
+			if ( $id == 0 ) $id = $this->addNode(    $node, intval( $form->getValue( 'parent_id' ) ) );
+			else                  $this->updateNode( $node, intval( $form->getValue( 'content_id' ) ) );
+			
+			// create page
+			$page = array();
+
+			$page[ 'content_id' ]    = $id;
+			$page[ 'language_id' ]   = $form->getValue( 'language_id' );
+			$page[ 'title' ]         = $form->getValue( 'title' );
+			$page[ 'html' ]          = $form->getValue( 'html' );
+			$page[ 'xhtml' ]         = $form->getValue( 'xhtml' );
+			$page[ 'template_pack' ] = $form->getValue( 'template_pack' );
+			$page[ 'template' ]      = $form->getValue( 'template' );
+			$page[ 'metatags' ]      = $form->getValue( 'metatags' );
+			$page[ 'description' ]   = $form->getValue( 'description' );
+			$page[ 'keywords' ]      = $form->getValue( 'keywords' );
+
+			// TODO: care about version control
+			$page[ 'current_version' ] = 1;
+						
+			// add page
+			$this->resetValues();
+			
+			$this->setValues( $page );
+
+			$this->insert();
+			
+			return $id;
+		}
+
+
+        /**
+         *  This function will delete a page node (and not its children)
+         *
+         *  @param $id  Node id
+         */
+		function deleteElement( $id ){
+
+			// delete all element from this node
+			$this->resetValues();
+
+			$this->content_id = intval( $id );
+			$this->delete();
+			
+			// delete node from tree
+			$this->deleteNode( $id );
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,184 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMPermissions extends YDDatabaseObject {
+    
+        function YDCMPermissions() {
+
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMPermissions' );
+
+            // register custom key
+            $this->registerKey( 'permission_id', true );
+
+			// register fields	
+			$this->registerField( 'user_id' );
+			$this->registerField( 'object' );
+			$this->registerField( 'object_action' );
+		}
+
+
+        /**
+         *  This function return an array of permissions
+         *
+         *  @param     $user_id    User id to get permissions
+         *  @param     $translate  (Optional) Translate permissions
+		 *
+         *  @returns    An array with all permission groupby object
+         */
+		function getPermissions( $user_id, $translate = false ){
+		
+			$this->resetValues();
+			$this->user_id = intval( $user_id );
+			$this->orderby( 'object DESC, object_action DESC' );
+			$this->find();
+
+			$permissions = $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );
+			
+			if ( !$translate ) return $permissions;
+
+			$arr_translated = array();
+
+			// cycle objects and compute translated actions
+			foreach( $permissions as $obj => $perms ){
+
+				// get permission translations of this component
+				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
+
+				if (!isset( $arr_translated[ $obj ] ) ) $arr_translated[] = $obj;
+
+				foreach( $perms as $p )
+					$arr_translated[ $obj ][] = t( $p );
+			}
+			
+			return $arr_translated;
+		}
+
+
+        /**
+         *  This function return an array of permissions
+         *
+         *  @param     $user_id   User id (or Array of ids ) to delete
+         */
+		function deletePermissions( $user_id ){
+
+			if ( !is_array( $user_id ) ) $user_id = array( $user_id );
+
+			$this->resetValues();
+			$this->where( 'user_id IN ("' . implode( '","', $user_id ) . '")' );
+
+			return $this->delete();
+		}
+
+
+        /**
+         *  This function assigns an array of permissions to a user
+         *
+         *  @param     $user_id     User id to get permissions
+         *  @param     $parend_id   Parent id form permission comparation
+         *  @param     $permissions Array with permissions
+         */
+		function setPermissions( $user_id, $parent_id, $values ){
+
+			// init temp array permissions
+			$permissions_valid  = array();
+			$permissions_to_add = array();
+			$permissions_to_del = array();
+
+			// get parent permissions
+			$permissions_parent = $this->getPermissions( $parent_id );
+
+			// filter $values and get permissions that are in parent
+			foreach( $permissions_parent as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 1 )
+						$permissions_valid[ $obj ][] = $p;
+
+			// get user permissions
+			$permissions_user = $this->getPermissions( $user_id );
+
+			// cycle user permissions to see the ones we need to delete
+			foreach( $permissions_user as $obj => $perms )
+				foreach( $perms as $p => $arr )
+					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 
+						$permissions_to_del[ $obj ][] = $p;
+
+			// cycle current permissions to see the ones we need to add
+			foreach( $permissions_valid as $obj => $perms )
+				foreach( $perms as $p )
+					if ( !isset( $permissions[ $obj ][$p] ) )
+						$permissions_to_add[ $obj ][] = $p;
+
+
+			$p_add = 0;
+			$t_add = 0;
+
+			$p_del = 0;
+			$t_del = 0;
+
+			// cycle permissions to delete and delete them from db
+			foreach ( $permissions_to_del as $obj => $perms )
+				foreach ( array_values( $perms ) as $p ){
+
+					$this->resetAll();
+					$this->user_id        = $user_id;
+					$this->object         = $obj;
+					$this->object_action  = $p;
+
+					if ($this->delete()) $p_del++;
+					$t_del++;
+				}
+
+			// cycle permissions to add and insert them in db
+			foreach ( $permissions_to_add as $obj => $perms )
+				foreach ( array_values( $perms ) as $p ){
+
+					$this->resetAll();
+					$this->user_id        = $user_id;
+					$this->object         = $obj;
+					$this->object_action  = $p;
+
+					if ($this->insert()) $p_add++;
+					$t_add++;
+				}
+
+			if ($p_add == $t_add && $p_del == $t_del ) return true;
+			
+			return false;
+		}
+
+}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,51 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	YDInclude( 'YDCMComponent.php' );
+
+
+    class YDCMRootmenu extends YDCMComponent {
+    
+        function YDCMRootmenu( $id = null ) {
+        
+			// init component
+            $this->YDCMComponent( 'YDCMRootmenu', $id );
+
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '0.1';
+            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
+            $this->_description = 'This is a menu component';
+
+			// register custom fields
+			$this->registerField( 'title' );
+
+			// we don't have custom relations
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,111 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMStatistics {
+
+        function YDCMStatistics() {
+		}
+		
+
+        /**
+         *  This static function returns php informations
+         *
+         *  @returns    an array with php info
+         */
+		function php(){
+		
+            // Get the general PHP info
+            ob_start();
+            phpinfo( INFO_GENERAL );
+            $phpInfo .= ob_get_contents();
+            ob_end_clean();
+
+            // Get the right part
+            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
+            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
+
+            // Strip unneeded things
+            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
+            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
+            $phpInfo = trim( $phpInfo );
+
+            // Get the settings
+            $settings = array();
+            foreach ( explode( "\n", $phpInfo ) as $line ) {
+                $line = explode( ' </td><td class="v">', $line );
+                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
+                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
+            }
+
+			// export other values
+			$settings[ 'version' ]     = phpversion();
+			$settings[ 'modules' ]     = implode( get_loaded_extensions(), ', ' );
+			$settings[ 'os' ]          = PHP_OS;
+			$settings[ 'includePath' ] = $GLOBALS['YD_INCLUDE_PATH'];
+
+			return $settings;
+		}
+
+
+        /**
+         *  This static function returns the mail info
+         *
+         *  @returns    an array with mail info
+         */
+		function mailer(){
+
+		    // Includes
+		    require_once( dirname( __FILE__ ) . '/../3rdparty/phpmailer/class.phpmailer.php' );
+
+            // Get the version of phpMailer
+            $PHPMailer = new PHPMailer();
+
+			return array( 'version' => $PHPMailer->Version, 'complete' => 'PHPMailer [version ' . $PHPMailer->Version . ']' );
+		}
+
+
+        /**
+         *  This static function returns an YDCMStatistics module
+         *
+         *  @returns    an module object
+         */
+		function module( $name ){
+
+			// include lib
+			// TODO: check if name is a valid lib name
+			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
+
+			// return class
+			return new $name();
+		}
+
+
+    }
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,87 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMStatistics_system {
+    
+        function YDCMStatistics_system() {
+		}
+
+
+		function getPHPInfo(){
+
+            // Get the general PHP info
+            ob_start();
+            phpinfo( INFO_GENERAL );
+            $phpInfo .= ob_get_contents();
+            ob_end_clean();
+
+            // Get the right part
+            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
+            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
+
+            // Strip unneeded things
+            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
+            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
+            $phpInfo = trim( $phpInfo );
+
+            // Get the settings
+            $settings = array();
+            foreach ( explode( "\n", $phpInfo ) as $line ) {
+                $line = explode( ' </td><td class="v">', $line );
+
+                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
+                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
+			}
+			
+			$settings[ 'version']  = phpversion();
+			$settings[ 'modules' ] = implode( get_loaded_extensions(), ', ' );
+			
+			ksort( $settings );
+			
+			return $settings;
+		}
+
+
+
+		function getMailInfo(){
+
+			// Includes
+			YDInclude( 'phpmailer/class.phpmailer.php' );
+		
+			$p = new PHPMailer();
+			
+			$settings = array( 'system' => 'PHPMailer',
+							   'version' => $p->Version );
+
+			ksort( $settings );
+			
+			return $settings;
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,55 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    class YDCMStatistics_visits extends YDDatabaseObject {
+    
+        function YDCMStatistics_visits() {
+        
+			// init database object
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMStatistics_visits' );
+
+            // register custom key
+            $this->registerKey( 'visit_id', true );
+
+            // register custom fields
+			$this->registerField( 'date' );
+			$this->registerField( 'browser' );
+			$this->registerField( 'platform' );
+			$this->registerField( 'url' );
+			$this->registerField( 'hits' );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,162 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	YDInclude( 'YDFileSystem.php' );
+
+	// set admin template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', YD_SELF_DIR, false );
+
+	// set admin template name
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_TEMPLATE', '', false );
+
+	// set visitors template directory (without template name directory)
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_PATH', YD_SELF_DIR, false );
+
+	// set visitors template name
+	YDConfig::set( 'YDCMTEMPLATES_VISITORS_TEMPLATE', '', false );
+
+	// set template pack ( a pH technology )
+	YDConfig::set( 'YDCMTEMPLATES_PACK', false, false );
+
+
+	// this is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
+    class YDCMTemplates {
+
+        function YDCMTemplates() {
+        
+			$this->admin_path        = YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' );
+			$this->admin_template    = YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' );
+			$this->visitors_path     = YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' );
+			$this->visitors_template = YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' );
+			$this->template_pack     = YDConfig::get( 'YDCMTEMPLATES_PACK' );
+		}
+
+
+        /**
+         *  This function returns all possible templates for administration side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function admin_templates(){
+		
+			return $this->__getFiles( $this->admin_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function admin_template(){
+		
+			return $this->admin_template;
+		}
+
+
+        /**
+         *  This function return the full template path of administration side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function admin_complete( $subdir = '' ){
+		
+			return $this->admin_path . '/' . $this->admin_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This function return the template pack
+         *
+         *  @returns    full path
+         */
+		function template_pack(){
+		
+			return $this->template_pack;
+		}
+
+
+        /**
+         *  This function returns all possible templates for visitors side
+         *
+         *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
+         */
+		function visitors_templates(){
+		
+			return $this->__getFiles( $this->visitors_path );
+		}
+
+
+        /**
+         *  This function return the template name of administration side
+         *
+         *  @returns    Template name
+         */
+		function visitors_template(){
+		
+			return $this->visitors_template;
+		}
+
+
+        /**
+         *  This function return the full template path of visitors side
+         *
+         *  @param $subdir  (Optional) template subdirectory
+         *
+         *  @returns    full path
+         */
+		function visitors_complete( $subdir = '' ){
+		
+			return $this->visitors_path . '/' . $this->visitors_template . '/' . $subdir;
+		}
+
+
+        /**
+         *  This private function returns all filenames of a directory
+         *
+         *  @returns    Array of filenames, eg: array( 'default' => 'Default', 'orange' => ... )
+         */
+		function __getFiles( $dir ){
+		
+			// init directories
+			$directories = array();
+
+			// init template directory
+			$dir = new YDFSDirectory( $dir );
+			
+			// compute directories array
+			foreach( $dir->getContents( '!.*', '', 'YDFSDirectory' ) as $d )
+				$directories[ $d ] = $d;
+
+			return $directories;
+		}
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,94 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    class YDCMTree extends YDDatabaseObject {
+    
+        function YDCMTree() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMTree' );
+
+            // register custom key
+            $this->registerKey( 'content_id', true );
+
+			// register fields	
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'type' );
+			$this->registerField( 'state' );
+			$this->registerField( 'reference' );
+			$this->registerField( 'access' );			
+			$this->registerField( 'searcheable' );			
+			$this->registerField( 'published_date_start' );
+			$this->registerField( 'published_date_end' );			
+			$this->registerField( 'candrag' );
+			$this->registerField( 'candrop' );
+			$this->registerField( 'nleft' );
+			$this->registerField( 'nright' );
+
+		}
+
+
+        /**
+         *  This function checks if elements are valid drag&dropable
+         *
+         *  @param $x  Id of dragable node
+         *
+         *  @param $y  Id of dropable node
+
+         *  @returns    false if elements are invalid, an associative array with node information
+         */
+		function getDragDropElements( $x = null, $y = null){
+		
+			// check if elements are numeric
+			if ( !is_numeric( $x ) || !is_numeric( $y ) ) return false;
+		
+			// reset old values and get current table	
+			$this->resetValues();
+
+			// set custom where to get those 2 elements
+			$this->where( '((content_id = ' . intval( $x ) . ' AND candrag = 1) OR (content_id = ' . intval( $y ) . ' AND candrop = 1))' );
+
+			// we must get always 2 elements otherwise they were not valid
+			if ( $this->find() != 2 ) return false;
+
+			// return associative array
+			return $this->getResultsAsAssocArray( 'content_id' );
+		}
+
+
+
+	}
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,705 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+	// add YD libs
+	YDInclude( 'YDForm.php' );
+
+	// add YDCM libs
+	YDInclude( 'YDCMPermissions.php' );
+
+	// add local translation directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
+
+
+    class YDCMUsers extends YDDatabaseObject {
+    
+        function YDCMUsers() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUsers' );
+
+            // register custom key
+            $this->registerKey( 'user_id', true );
+
+			// register custom fields
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'nleft' );
+			$this->registerField( 'nright' );
+			$this->registerField( 'nlevel' );
+			$this->registerField( 'username' );
+			$this->registerField( 'password' );
+			$this->registerField( 'name' );
+			$this->registerField( 'email' );			
+			$this->registerField( 'other' );			
+			$this->registerField( 'language_id' );
+			$this->registerField( 'state' );
+			$this->registerField( 'login_start' );
+			$this->registerField( 'login_end' );
+			$this->registerField( 'login_counter' );			
+			$this->registerField( 'login_last' );
+			$this->registerField( 'login_current' );
+			$this->registerField( 'created_user' );
+			$this->registerField( 'created_date' );
+			$this->registerField( 'template' );
+
+			// relation with languages table
+            $rel = & $this->registerRelation( 'ydcmlanguages', false, 'ydcmlanguages' );
+			$rel->setLocalKey( 'language_id' );
+            $rel->setForeignKey( 'language_id' );
+
+			// create tree object
+			$this->tree = new YDDatabaseTree( 'default', 'YDCMUsers', 'user_id', 'parent_id', 'parent_id' );
+
+			// add tree fields
+			$this->tree->addField( 'parent_id' );
+			$this->tree->addField( 'username' );
+			$this->tree->addField( 'password' );
+			$this->tree->addField( 'name' );
+			$this->tree->addField( 'email' );			
+			$this->tree->addField( 'other' );			
+			$this->tree->addField( 'language_id' );
+			$this->tree->addField( 'state' );			
+			$this->tree->addField( 'login_start' );
+			$this->tree->addField( 'login_end' );
+			$this->tree->addField( 'login_counter' );			
+			$this->tree->addField( 'login_last' );
+			$this->tree->addField( 'login_current' );
+			$this->tree->addField( 'type' );
+			$this->tree->addField( 'created_user' );
+			$this->tree->addField( 'created_date' );
+			$this->tree->addField( 'template' );
+
+			// init permissions
+			$this->perm = new YDCMPermissions();
+		}
+
+
+        /**
+         *  This method returns all sub users of a user
+         *
+         *  @param  $parent_id   Parent id
+         *
+         *  @returns    Array with user and children nodes
+         */
+		function getTreeElements( $parent_id ){
+
+			return $this->tree->getDescendants( $parent_id, true );
+		}
+
+
+        /**
+         *  This method checks if a user is descendant of another user
+         *
+         *  @param      $id          User id to test if id descendant
+         *  @param      $parent_id   Parent id
+         *
+         *  @returns    boolean. TRUE if is descendant, FALSE if not descendant
+         */
+		function isDescendantOf( $user_id, $parent_id ){
+
+			return $this->tree->isDescendantOf( intval( $user_id ), intval( $parent_id ) );
+		}
+
+
+        /**
+         *  This method checks if a username and password are valid
+         *
+         *  @param $username  User username
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it, password form elements must have max 31)
+         *
+         *  @returns    true if valid, false otherwise
+         */
+		function valid( $username = '', $password = '' ){
+
+			// teste username and password rules
+			if (!YDValidateRules::alphanumeric(	$username))			return false;
+			if (!YDValidateRules::maxlength(	$username, 100))	return false;
+			if (!YDValidateRules::alphanumeric(	$password))			return false;
+			if (!YDValidateRules::maxlength(	$password, 32))		return false;
+
+			// reset values
+			$this->resetValues();
+
+			// set username
+			$this->username = $username;
+
+			// if password is not in md5 format we must set it
+			if ( strlen( $password ) != 32 ) $password = md5( $password );
+
+			// set password
+			$this->password = $password;
+			
+			// check user state based on state and/or user login schedule
+			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
+
+			// test if we get just one user
+			if ( $this->find() == 1 ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This method deletes a user (and all children) or just the children
+         *
+         *  @param $user_id        User id
+         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes user id and children, FALSE deletes children only
+         *
+         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
+         */
+		function deleteUser( $user_id, $includeParent = true ){
+		
+			// get ids to delete
+			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
+
+			// delete all permissions of this users
+			$this->perm->deletePermissions( $ids );
+
+			// delete node from users table
+			$this->tree->deleteNode( $user_id, $includeParent );
+		}
+
+
+        /**
+         *  This method adds form elements for user editing
+		 *
+		 * @param $user_id      User id to edit
+		 *
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
+		 * 
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
+		 * 
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
+		 * 
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
+         */
+		function addFormEdit( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
+
+		 	return $this->_addFormDetails( $id, true, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
+		}
+
+
+        /**
+         *  This method adds form elements for addind a new user
+		 *
+		 * @param $parent_id    Parent id of this new user
+         *
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
+		 * 
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
+		 * 
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
+		 * 
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
+         */
+		function addFormNew( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
+
+		 	return $this->_addFormDetails( $id, false, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
+		}
+		 
+		
+        /**
+         *  Helper method for user management
+		 *
+		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
+         *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
+         *
+		 * @param $edit         If you are editing a user set TRUE. If you are adding a new user set FALSE
+		 *
+		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
+		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
+		 * 
+		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
+		 *                                 TRUE: is a box (editable); NULL: inexistent
+		 * 
+		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
+		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
+		 * 
+		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
+		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
+		 *
+		 * @param $accessinfo   (Optional) Defines if we want to include access information
+		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
+		 *
+		 * @param $permissionediting  (Optional) Defines if permissions are editable
+		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
+         */
+		function _addFormDetails( $id, $edit, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
+
+			// init form
+			$this->form = new YDForm( 'YDCMUsers' );
+
+			// add username
+			if ( $username === true )       $this->form->addElement( 'text', 'username', t('user_username') );
+			else if ( $username === false ) $this->form->addElement( 'span', 'username', t('user_username') );
+
+			// add password
+			if ( $password === true ) $this->form->addElement( 'password', 'password', t('user_password') );
+
+			// add login details
+			if ( $logindetails === true ){
+				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
+				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
+
+			}else if ( $logindetails === false ){
+				$this->form->addElement( 'span',           'state',       t('login_state') );
+				$this->form->addElement( 'span',           'login_start', t('login_start') );
+				$this->form->addElement( 'span',           'login_end',   t('login_end') );
+			}
+
+			// add common user details
+            if ( $userdetails === true ){
+				$this->form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
+				$this->form->addElement( 'text',      'email',         t('user_email') );
+				$this->form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
+
+				$languages = YDCMComponent::module( 'YDCMLanguages' );
+				$languages = $languages->active();
+				$this->form->addElement( 'select',    'language_id',   t('user_language'),      array(), $languages );
+
+				$templates = YDCMComponent::module( 'YDCMTemplates' );
+    	        $this->form->addElement( 'select',    'template',      t('user_template'),      array(), $templates->admin_templates() );
+
+				$this->form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
+				$this->form->addRule( 'email',       'email',          t('email not valid') );
+				$this->form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
+				$this->form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages ) );
+				$this->form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
+
+			}else if ( $userdetails === false ){
+				$this->form->addElement( 'span',      'name',          t('user_name') );
+				$this->form->addElement( 'span',      'email',         t('user_email') );
+				$this->form->addElement( 'span',      'other',         t('user_other') );
+				$this->form->addElement( 'span',      'language_id',   t('user_language') );
+				$this->form->addElement( 'span',      'template',      t('user_template') );
+			}
+
+			// add access information
+			if ( $accessinfo === true ){
+				$this->form->addElement( 'span', 'login_counter', t('login_counter') );
+    	        $this->form->addElement( 'span', 'login_last',    t('login_last') );
+    	        $this->form->addElement( 'span', 'login_current', t('login_current') );
+    	        $this->form->addElement( 'span', 'created_user',  t('created_user') );
+    	        $this->form->addElement( 'span', 'created_date',  t('created_date') );
+			}
+
+			// add submit button
+			if ( $edit ) $this->form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+			else         $this->form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
+
+			// if we are editing a user it's a good idea to set form defaults with user node attributes
+			if ( $edit ){
+
+				// get user attributes
+				$node = $this->getUser( $id );
+
+				// set form defaults based on user attributes
+				$this->form->setDefaults( $node );
+			}
+
+
+			// PERMISSION CHECKBOXGROUPS
+//			if ( $permissionediting !== true ) return;
+
+			// check if we are editing or creating
+			if ( $edit ){
+
+				// on editing, permissions avaiable are the parent permissions ( parent of $id )
+				$permissions_avaiable = $this->perm->getPermissions( $node['parent_id'] );
+
+				// get current user permissions. We will need them to compare with parent permissions
+				$permissions = $node[ 'permissions' ];
+
+			// on adding, permissions avaiable are the parent permissions ( $id permissions )
+			}else{
+				$permissions_avaiable = $this->perm->getPermissions( $id );
+			}
+
+			// custom form variable that has the dynamic permissions checkboxgroups html
+			$this->form->permissions_html = array();
+
+			// cycle parent permissions to create form checkboxgroup for this user
+			foreach( $permissions_avaiable as $obj => $perm ){
+
+				// get permission translations of this component
+				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
+
+				// init checkboxgroup options
+				$options  = array();
+				$selected = array();
+
+				// cycle all permissions of this object to create checkboxgroup options array
+				foreach( $perm as $p ){
+				
+					// add option with translated string
+					// eg, if we are in 'YDCMPage' object and action is 'delete' we will add ( YDCMPage => array( 'delete' => t('YDCMPage_delete') ) )
+					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
+
+					// on editing we must check if this action is select of not ( checking if this action is in parent actions)
+					if ( $edit && isset( $permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $permissions[ $obj ] ) )){
+						$selected[ $p['object_action' ] ] = 1;
+					}
+				}
+
+				// add object checkbox or spans
+				if ( $permissionediting === true )       $el = & $this->form->addElement( 'checkboxgroup', $obj, $obj, array(), $options );
+				else if ( $permissionediting === false ) $el = & $this->form->addElement( 'span', $obj, $obj );
+
+				// add default for this checkboxgroup if we are editing
+				if ( $edit ){
+					if ( $permissionediting === true )       $this->form->setDefault( $obj, $selected );
+					else if ( $permissionediting === false ) $this->form->setDefault( $obj, implode( '<br>', array_keys( $selected ) ) );
+				}
+
+				// this will store the checkboxgroups html in a variable for better templating placement
+				$this->form->permissions_html[ $obj ] = $el->toHtml();
+			}
+
+		}
+
+
+        /**
+         *  This method updates user attributes
+         *
+         *  @param $id           User id to save attributes
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if updated, ARRAY with form errors otherwise
+         */
+		function saveFormEdit( $id, $created_user, $formvalues = null ){
+
+			return $this->_saveFormDetails( $id, true, $created_user, $formvalues );
+		}
+
+
+        /**
+         *  This method adds a new user
+         *
+         *  @param $parent_id    Parent id of this new user
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if added, ARRAY with form errors otherwise
+         */
+		function saveFormNew( $parent_id, $created_user, $formvalues = null ){
+
+			return $this->_saveFormDetails( $parent_id, false, $created_user, $formvalues );
+		}
+
+
+        /**
+         *  This method adds/saves a user
+         *
+         *  @param $id           If we are editing $id is the user id. If we are adding, $id is the parent_id
+         *  @param $edit         Boolean flag that defines we we are editing $id or adding to $id
+         *  @param $created_user User id that wants to create this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    TRUE if updated, ARRAY with form errors otherwise
+         */
+		function _saveFormDetails( $id, $edit, $created_user, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
+			// get form values avaiable
+			$values = $this->form->getValues();
+		
+			// parse fixed values
+			$values['type']          = 'YDCMUseradministrator';
+			$values['nlevel']        = 1;
+			$values['created_user']  = intval( $created_user );
+			$values['created_date']  = YDStringUtil::formatDate( time(), 'datetimesql' );
+			$values['login_counter'] = 0;
+
+			// parse special elements
+			if ( $this->form->isElement( 'login_start' ) ) $values['login_start'] = YDStringUtil::formatDate( $values['login_start'], 'datetimesql' );
+			if ( $this->form->isElement( 'login_start' ) ) $values['login_end']   = YDStringUtil::formatDate( $values['login_end'],   'datetimesql' );
+			if ( $this->form->isElement( 'password' ) )    $values['password']    = md5( $values['password'] );
+
+			// check if we are editing or adding an element
+			if ( $edit ){
+
+				// update node to YDUsers table
+				$res = $this->tree->updateNode( $values, $id );
+	
+				// change user permissions in YDCMPermissions
+				return $this->perm->setPermissions( $id, $this->getUserAttribute( $id, 'parent_id' ), $values );
+			}else{
+			
+				// add node to YDUsers table
+				$newID = $this->tree->addNode( $values, $id );
+
+				// change user permissions in YDCMPermissions
+				return $this->perm->setPermissions( $newID, $id, $values );
+			}
+
+		}
+
+
+        /**
+         *  This function adds form elements for password changing
+         *
+         * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
+         *                                 This box is used when the user wants to change its pass and not when we want to change another user pass
+         *                                 TRUE: include box; FALSE: don't include
+         */
+		function addFormPassword( $oldpassword = true ){
+
+			// init form
+			$this->form = new YDForm( 'YDCMUsers' );
+
+			// add new password box
+            $this->form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
+			$this->form->addRule(    'new',         'required',     t('passwords are required') );
+			$this->form->addRule(    'new',         'maxlength',    t('passwords too big'), 31 );
+			$this->form->addRule(    'new',         'alphanumeric', t('passwords not alphanumeric') );
+
+			// add new_confirm password box
+            $this->form->addElement( 'password',    'new_confirm',  t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+			$this->form->addRule(    'new_confirm', 'required',     t('passwords are required') );
+			$this->form->addRule(    'new_confirm', 'maxlength',    t('passwords too big'), 31 );
+			$this->form->addRule(    'new_confirm', 'alphanumeric', t('passwords not alphanumeric') );
+
+			// add compare rule to new password and confirmation password
+			$this->form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			// add old password box
+			if ( $oldpassword ){
+            	$this->form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+				$this->form->addRule(    'old',      'required',     t('passwords are required') );
+				$this->form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
+				$this->form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
+			}
+		}
+
+
+        /**
+         *  This function updates a user password
+         *
+         *  @param $user_id     User id to update password
+         *  @param $formvalues  (Otional) Custom array with 2 passwords (new and new_confirm)
+         *
+         *  @returns    true if updated or array with form errors otherwise
+         */
+		function saveFormPassword( $user_id, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->form->validate( $formvalues ) )
+				return $this->form->getErrors();
+
+			// reset values
+			$this->resetAll();
+
+			// set new password
+			$this->user_id  = intval( $user_id );
+			$this->password = md5( $this->form->getValue( 'new' ) );
+
+			// update user and get result
+			if ( $this->update() == 1 ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This returns the user form
+         *
+         *  @param $defaults  (Optional) default values array to apply in form
+         *
+         *  @returns    YDForm object
+         */
+		function & getForm( $defaults = false ){
+
+			// check if we have form defaults and apply them
+			if ( is_array( $defaults ) ) $this->form->setDefaults( $defaults );
+
+			return $this->form;
+		}
+
+
+        /**
+         *  This method returns user attributes
+         *
+         *  @param      $user_id     User id to use (instead of internal)
+         *  @param      $translate   (Optional) Boolean that defines if result must be translated
+         *
+         *  @returns    User details
+         */
+		function getUser( $user_id, $translate = false ){
+
+			$this->resetValues();
+
+			// set user id
+			$this->user_id = intval( $user_id );
+
+			// get all attributes
+			if ( $this->findAll() != 1 ) return false;
+
+			// password should always empty
+			$this->password = '';
+
+			// check if we want human readable elements
+			if ( $translate ){
+
+				// check if state not schedule
+				if ( $this->state != 2 ){
+					$this->login_start = t('not applicable');
+					$this->login_end   = t('not applicable');
+				}
+
+				if ( $this->state == 0 )      $this->state = t('blocked');
+				else if ( $this->state == 1 ) $this->state = t('active');
+				else                          $this->state = t('schedule');
+
+				// check if user is root
+				if ( $this->created_user == 0 ){
+					$this->created_user = t('not applicable');
+					$this->created_date = t('not applicable');
+				}
+			}
+
+			// add permissions
+			$values = $this->getValues();
+			$values[ 'permissions' ] = $this->perm->getPermissions( intval( $user_id ) );
+			
+			return $values;
+		}
+
+
+        /**
+         *  This method returns a specific user attribute
+         *
+         *  @param      $user_id     User id to use (instead of internal)
+         *  @param      $attribute   Attribute string
+         *
+         *  @returns    User details
+         */
+		function getUserAttribute( $user_id, $attribute ){
+
+			$this->resetValues();
+
+			// set user id
+			$this->user_id = intval( $user_id );
+
+			// get all attributes
+			if ( $this->find() != 1 ) return false;
+
+			return $this->get( $attribute );
+		}
+
+
+        /**
+         *  This function updates current user login details
+         *
+         *  @returns    true if user login details updated, false if user is not valid or details not updated
+         */
+		function updateLogin(){
+
+			YDInclude( 'YDUtil.php' );
+
+			$this->resetValues();
+			
+			// get current user id
+			$res = $this->currentID();
+
+			// check if user exists
+			if ( $res == false ) return false;
+			
+			// get all attributes
+			$this->find();
+
+			// increase login value
+			$this->login_counter ++;
+
+			// set last login date
+			$this->login_last = $this->login_current;
+
+			// set current login
+			$this->login_current = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+		
+		
+        /**
+         *  This method returns the id of the current user if you use PHP_AUTH_USER and PHP_AUTH_PW for authentication
+         */
+		function currentID(){
+		
+			// reset user values
+			$this->resetValues();
+		
+			// check if user is valid and get user id ( YDCMUsers::valid does it )
+			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+
+			// if user is not valid we should return false
+			if ( $valid === false ) return false;
+
+			// return user id found by $this->valid
+			return $this->user_id;
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,34 @@
+<?php
+// PERMISSIONS
+$GLOBALS['t']['ydcmpage_create'] = 'Create';
+$GLOBALS['t']['ydcmpage_delete'] = 'Delete';
+
+
+// PAGE FORM
+$GLOBALS['t']['page_reference'] = 'Reference';
+$GLOBALS['t']['page_title'] = 'Title';
+$GLOBALS['t']['page_content'] = 'Content';
+$GLOBALS['t']['page_access'] = 'Access';
+$GLOBALS['t']['page_state'] = 'Published';
+$GLOBALS['t']['page_startdate'] = 'Start date';
+$GLOBALS['t']['page_enddate'] = 'End date';
+$GLOBALS['t']['page_templates'] = 'Templates';
+$GLOBALS['t']['page_template'] = 'Template';
+$GLOBALS['t']['page_metatags'] = 'Metatags';
+$GLOBALS['t']['page_description'] = 'Description';
+$GLOBALS['t']['page_keywords'] = 'Keywords';
+$GLOBALS['t']['page_search'] = 'Searcheable';
+
+// PAGE FORM RULES
+
+// OTHER
+$GLOBALS['t']['page'] = 'Page';
+$GLOBALS['t']['page content'] = 'Content';
+$GLOBALS['t']['page template'] = 'Template';
+$GLOBALS['t']['page access'] = 'Access';
+$GLOBALS['t']['new page'] = 'New page';
+$GLOBALS['t']['edit page'] = 'Edit page';
+$GLOBALS['t']['use custom template'] = 'Use custom template';
+$GLOBALS['t']['use templatepack'] = 'Use template pack';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,34 @@
+<?php
+// PERMISSIONS
+$GLOBALS['t']['ydcmpage_create'] = 'Criar';
+$GLOBALS['t']['ydcmpage_delete'] = 'Eliminar';
+
+
+// PAGE FORM
+$GLOBALS['t']['page_reference'] = 'Refer&ecirc;ncia';
+$GLOBALS['t']['page_title'] = 'Titulo';
+$GLOBALS['t']['page_content'] = 'Conte&uacute;do';
+$GLOBALS['t']['page_access'] = 'Acesso';
+$GLOBALS['t']['page_state'] = 'Publicado';
+$GLOBALS['t']['page_startdate'] = 'Data inicial';
+$GLOBALS['t']['page_enddate'] = 'Data final';
+$GLOBALS['t']['page_templates'] = 'Templates';
+$GLOBALS['t']['page_template'] = 'Template';
+$GLOBALS['t']['page_metatags'] = 'Metatags';
+$GLOBALS['t']['page_description'] = 'Descri&ccedil;&atilde;o';
+$GLOBALS['t']['page_keywords'] = 'Keywords';
+$GLOBALS['t']['page_search'] = 'Pesquis&aacute;vel';
+
+// PAGE FORM RULES
+
+// OTHER
+$GLOBALS['t']['page'] = 'P&aacute;gina';
+$GLOBALS['t']['page content'] = 'Conte&uacute;do';
+$GLOBALS['t']['page template'] = 'Template';
+$GLOBALS['t']['page access'] = 'Acesso';
+$GLOBALS['t']['new page'] = 'Nova p&aacute;gina';
+$GLOBALS['t']['edit page'] = 'Editar p&aacute;gina';
+$GLOBALS['t']['use custom template'] = 'Usar template especial';
+$GLOBALS['t']['use templatepack'] = 'Usar template pack';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,53 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_password'] = 'Password';
+$GLOBALS['t']['user_name'] = 'Name';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Other';
+$GLOBALS['t']['user_language'] = 'Language';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_state'] = 'Login';
+$GLOBALS['t']['login_start'] = 'Login start date';
+$GLOBALS['t']['login_end'] = 'Login end date';
+$GLOBALS['t']['login_counter'] = 'Total of logins';
+$GLOBALS['t']['login_last'] = 'Last login date';
+$GLOBALS['t']['login_current'] = 'Current login date';
+$GLOBALS['t']['created_user'] = 'Created by';
+$GLOBALS['t']['created_date'] = 'Created in';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'Name is too big';
+$GLOBALS['t']['email not valid'] = 'Email is not valid';
+$GLOBALS['t']['other too big'] = 'Other informations about the user are to big';
+$GLOBALS['t']['language not valid'] = 'Language is not valid';
+$GLOBALS['t']['template not valid'] = 'Template is not valid';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Current password';
+$GLOBALS['t']['password_new'] = 'New password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirm new password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'All passwords are required';
+$GLOBALS['t']['passwords dont match'] = 'Passwords do not match';
+$GLOBALS['t']['passwords too big'] = 'There is at least one password too big';
+$GLOBALS['t']['passwords not alphanumeric'] = 'All passwords must be alphanumeric';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Change password';
+$GLOBALS['t']['personal info'] = 'Personal informations';
+$GLOBALS['t']['access'] = 'Access';
+$GLOBALS['t']['old password is incorrect'] = 'Current password is incorrect';
+$GLOBALS['t']['user password updated'] = 'Password is updated';
+$GLOBALS['t']['user is incorrect'] = 'Current user is not valid';
+$GLOBALS['t']['user details updated'] = 'User details updated';
+$GLOBALS['t']['password not updated'] = 'Password was not updated';
+$GLOBALS['t']['user not updated'] = 'User was not updated';
+$GLOBALS['t']['user added'] = 'New user added';
+$GLOBALS['t']['administrator and children'] = 'Administrator and children';
+$GLOBALS['t']['children only'] = 'Children only';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,54 @@
+<?php
+
+// USER FORM
+$GLOBALS['t']['user_username'] = 'Username';
+$GLOBALS['t']['user_password'] = 'Password';
+$GLOBALS['t']['user_name'] = 'Nome';
+$GLOBALS['t']['user_email'] = 'Email';
+$GLOBALS['t']['user_other'] = 'Outras informa&ccedil;oes';
+$GLOBALS['t']['user_language'] = 'Idioma';
+$GLOBALS['t']['user_template'] = 'Template';
+$GLOBALS['t']['login_state'] = 'Login';
+$GLOBALS['t']['login_start'] = 'Data para inicio de login';
+$GLOBALS['t']['login_end'] = 'Data em que o login expira';
+$GLOBALS['t']['login_counter'] = 'Total de logins';
+$GLOBALS['t']['login_last'] = 'Data do &uacute;ltimo login';
+$GLOBALS['t']['login_current'] = 'Data do login actual';
+$GLOBALS['t']['created_user'] = 'Criado por';
+$GLOBALS['t']['created_date'] = 'Criado em';
+
+// USER FORM RULES
+$GLOBALS['t']['name too big'] = 'O nome &eacute; demasiado grande';
+$GLOBALS['t']['email not valid'] = 'O email n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['other too big'] = 'As informa&ccedil;&otilde;es adicionais s&atilde;o demasiado grandes';
+$GLOBALS['t']['language not valid'] = 'O idioma n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['template not valid'] = 'O template n&atilde;o &eacute; v&aacute;lido';
+
+// PASSWORD FORM
+$GLOBALS['t']['password_old'] = 'Password actual';
+$GLOBALS['t']['password_new'] = 'Nova password';
+$GLOBALS['t']['password_new_confirm'] = 'Confirme a nova password';
+
+// PASSWORD FORM RULES
+$GLOBALS['t']['passwords are required'] = 'Todas as passwords s&atilde;o obrigat&oacute;rias';
+$GLOBALS['t']['passwords dont match'] = 'As passwords n&atilde;o s&atilde;o iguais';
+$GLOBALS['t']['passwords too big'] = 'Existe pelo menos uma password demasiado grande';
+$GLOBALS['t']['passwords not alphanumeric'] = 'As password t&ecirc;em de ser alfanum&eacute;ricas';
+
+// OTHER
+$GLOBALS['t']['passwords'] = 'Passwords';
+$GLOBALS['t']['change password'] = 'Modificar a password';
+$GLOBALS['t']['personal info'] = 'Configura&ccedil;&otilde;es pessoais';
+$GLOBALS['t']['access'] = 'Acesso';
+$GLOBALS['t']['old password is incorrect'] = 'A password actual &eacute; incorrecta';
+$GLOBALS['t']['user password updated'] = 'A password foi actualizada';
+$GLOBALS['t']['user is incorrect'] = 'O utilizador actual &eacute; incorrecto';
+$GLOBALS['t']['user details updated'] = 'Informa&ccedil;&otilde;es do utilizador actualizadas';
+$GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
+$GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
+$GLOBALS['t']['user added'] = 'Utilizador adicionado';
+$GLOBALS['t']['administrator and children'] = 'Administrador e sub-administratores';
+$GLOBALS['t']['children only'] = 'Apenas sub-administratores';
+
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,64 @@
+<?php
+
+// components
+$GLOBALS['t']['ydcmpage'] = 'Page';
+$GLOBALS['t']['ydcmpage s'] = 'Pages';
+$GLOBALS['t']['ydcmrootmenu'] = 'Menu';
+$GLOBALS['t']['ydcmrootmenu s'] = 'Menus';
+
+$GLOBALS['t']['save'] = 'Save';
+$GLOBALS['t']['close'] = 'Close';
+$GLOBALS['t']['open'] = 'Open';
+$GLOBALS['t']['help'] = 'Help';
+$GLOBALS['t']['back'] = 'Back';
+$GLOBALS['t']['not applicable'] = 'Not applicable';
+$GLOBALS['t']['yes'] = 'Yes';
+$GLOBALS['t']['no'] = 'No';
+$GLOBALS['t']['active'] = 'Active';
+$GLOBALS['t']['blocked'] = 'Blocked';
+$GLOBALS['t']['schedule'] = 'Schedule';
+$GLOBALS['t']['permissions'] = 'Permissions';
+$GLOBALS['t']['delete'] = 'Delete';
+$GLOBALS['t']['toggle state'] = 'Toggle state';
+$GLOBALS['t']['public'] = 'Public';
+$GLOBALS['t']['private'] = 'Private';
+$GLOBALS['t']['not allowed'] = 'Not allowed';
+$GLOBALS['t']['total'] = 'Total';
+$GLOBALS['t']['previous'] = 'Previous';
+$GLOBALS['t']['next'] = 'Next';
+$GLOBALS['t']['state'] = 'State';
+$GLOBALS['t']['add'] = 'Add';
+$GLOBALS['t']['add component'] = 'Add component';
+$GLOBALS['t']['move'] = 'Move';
+$GLOBALS['t']['move up'] = 'Move up';
+$GLOBALS['t']['move down'] = 'Move down';
+$GLOBALS['t']['edit'] = 'Edit';
+$GLOBALS['t']['properties'] = 'Properties';
+$GLOBALS['t']['please wait'] = 'Please wait';
+
+$GLOBALS['t']['visitor'] = 'Visitor';
+$GLOBALS['t']['visitors'] = 'Visitors';
+$GLOBALS['t']['administrator'] = 'Administrator';
+$GLOBALS['t']['administrators'] = 'Administrators';
+
+$GLOBALS['t']['published'] = 'Published';
+$GLOBALS['t']['not published'] = 'Not published';
+$GLOBALS['t']['schedule'] = 'Schedule';
+
+$GLOBALS['t']['translate'] = 'Translate';
+$GLOBALS['t']['translate to'] = 'Translate to';
+
+$GLOBALS['t']['total versions'] = 'Total of versions';
+$GLOBALS['t']['general config'] = 'General configuration';
+$GLOBALS['t']['content versions'] = 'Versions';
+
+$GLOBALS['t']['content'] = 'Content';
+$GLOBALS['t']['general view'] = 'General view';
+$GLOBALS['t']['statistics'] = 'Statistics';
+$GLOBALS['t']['administration'] = 'Administration';
+$GLOBALS['t']['system information'] = 'System information';
+$GLOBALS['t']['backup'] = 'Backup';
+$GLOBALS['t']['audit'] = 'Audit';
+$GLOBALS['t']['user management'] = 'User management';
+$GLOBALS['t']['general configuration'] = 'General configuration';
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-08-23 15:09:37 UTC (rev 2039)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-08-23 15:11:13 UTC (rev 2040)
@@ -0,0 +1,62 @@
+<?php
+
+// components
+$GLOBALS['t']['ydcmpage'] = 'P&aacute;gina';
+$GLOBALS['t']['ydcmpage s'] = 'P&aacute;ginas';
+$GLOBALS['t']['ydcmrootmenu'] = 'Menu';
+$GLOBALS['t']['ydcmrootmenu s'] = 'Menus';
+
+$GLOBALS['t']['save'] = 'Guardar';
+$GLOBALS['t']['close'] = 'Fechar';
+$GLOBALS['t']['open'] = 'Abrir';
+$GLOBALS['t']['help'] = 'Ajuda';
+$GLOBALS['t']['back'] = 'Voltar';
+$GLOBALS['t']['not applicable'] = 'N&atilde;o aplic&aacute;vel';
+$GLOBALS['t']['yes'] = 'Sim';
+$GLOBALS['t']['no'] = 'N&atilde;o';
+$GLOBALS['t']['active'] = 'Activo';
+$GLOBALS['t']['blocked'] = 'Bloqueado';
+$GLOBALS['t']['schedule'] = 'Calend&aacute;rio';
+$GLOBALS['t']['permissions'] = 'Permiss&otilde;es';
+$GLOBALS['t']['delete'] = 'Eliminar';
+$GLOBALS['t']['toggle state'] = 'Inverter estado';
+$GLOBALS['t']['public'] = 'P&uacute;blico';
+$GLOBALS['t']['private'] = 'Privado';
+$GLOBALS['t']['not allowed'] = 'N&atilde;o permitido';
+$GLOBALS['t']['total'] = 'Total';
+$GLOBALS['t']['previous'] = 'Anterior';
+$GLOBALS['t']['next'] = 'Seguinte';
+$GLOBALS['t']['state'] = 'Estado';
+$GLOBALS['t']['add'] = 'Adicionar';
+$GLOBALS['t']['add component'] = 'Adicionar component';
+$GLOBALS['t']['move'] = 'Mover';
+$GLOBALS['t']['move up'] = 'Mover para cima';
+$GLOBALS['t']['move down'] = 'Mover para baixo';
+$GLOBALS['t']['edit'] = 'Editar';
+$GLOBALS['t']['properties'] = 'Propriedades';
+$GLOBALS['t']['please wait'] = 'Por favor aguarde';
+
+$GLOBALS['t']['visitor'] = 'Visitante';
+$GLOBALS['t']['visitors'] = 'Visitantes';
+$GLOBALS['t']['administrator'] = 'Administrador';
+$GLOBALS['t']['administrators'] = 'Administradores';
+
+$GLOBALS['t']['translate'] = 'Traduzir';
+$GLOBALS['t']['translate to'] = 'Traduzir para';
+
+$GLOBALS['t']['total versions'] = 'Total de vers?es';
+$GLOBALS['t']['general config'] = 'Configura??o geral';
+$GLOBALS['t']['content versions'] = 'Vers?es';
+
+$GLOBALS['t']['content'] = 'Conte&uacute;do';
+$GLOBALS['t']['general view'] = 'Vista geral';
+$GLOBALS['t']['statistics'] = 'Estat&iacute;sticas';
+$GLOBALS['t']['administration'] = 'Administra&ccedil;&atilde;o';
+$GLOBALS['t']['system information'] = 'Informa&ccedil;&otilde;es do sistema';
+$GLOBALS['t']['backup'] = 'C&oacute;pias de seguran&ccedil;a';
+$GLOBALS['t']['audit'] = 'Auditoria';
+$GLOBALS['t']['user management'] = 'Gest&atilde;o de utilizadores';
+$GLOBALS['t']['general configuration'] = 'Configura&ccedil;&atilde;o geral';
+
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Wed Aug 23 17:23:05 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 17:23:05 +0200
Subject: [ydf-devel] r2041 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200608231523.k7NFN5aj013842@sheep.berlios.de>

Author: ximian
Date: 2006-08-23 17:22:34 +0200 (Wed, 23 Aug 2006)
New Revision: 2041

Modified:
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
Log:
userdetails YDCM example updated for new YDCM dir structure

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-23 15:11:13 UTC (rev 2040)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-23 15:22:34 UTC (rev 2041)
@@ -2,6 +2,8 @@
 
     include_once( dirname( __FILE__ ) . '/../cm.php' );
 
+	YDInclude( 'YDCMUsers.php' );
+
     // Class definition
     class userdetails extends cm {
 
@@ -12,7 +14,7 @@
             $this->cm();
 
 			// create a user object
-			$this->users = YDCMComponent::module( 'YDCMUsers' );
+			$this->users = new YDCMUsers();
         }
 
 
@@ -20,17 +22,18 @@
         function actionDefault() {
 
 			// get user id 101 details and display them
-			YDDebugUtil::dump( $this->users->getUser( 101, true ) );
+			YDDebugUtil::dump( $this->users->getUser( 101, true ), '$this->users->getUser( 101, true )' );
         }
 
 
         // Edit user example
         function actionEdit() {
 
-			// add form of user 101. User cannot edit username, cannot see password, cannot see login details, can edit user details, cannot see access info, cannot see permissions
+			// add editing form of user 101.
+			// user cannot edit username, cannot see password, cannot see login details, can edit user details, cannot see access info, cann edit permissions
 			$this->users->addFormEdit( 101, false, null, null, true, null, true );
 
-			// get user form and add a custom submit button
+			// get form
 			$form = & $this->users->getForm();
 
 			// if form is not submitted just show it
@@ -40,7 +43,7 @@
 			$result = $this->users->saveFormEdit( 101, 100 );
 
 			// check if result is a array (form error messages)
-			if( is_array( $result ) ) return $form->display();
+			if ( is_array( $result ) ) return $form->display();
 
 			// if update was sucessfull, show ok message in current language
 			if ( $result == 1 ) return print( t( 'user details updated' ) );
@@ -53,10 +56,11 @@
 		// this action will add a new sub-user of the root (super-administrator: id 100)
 		function actionNew(){
 
-			// add element as child of user 100. User can edit username, can edit password, can edit login details, can edit user details, cannot see access info, can edit permissions
+			// add form for adding a new user as child of user 100. 
+			// user can edit username, can edit password, can edit login details, can edit user details, cannot see access info, can edit permissions
 			$this->users->addFormNew( 100, true, true, true, true, null, true );
 
-			// get form and add a custom submition button
+			// get form
 			$form = & $this->users->getForm();
 
 			// if form is not submitted just show it



From ximian at mail.berlios.de  Wed Aug 23 17:46:57 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 23 Aug 2006 17:46:57 +0200
Subject: [ydf-devel] r2042 - YDFramework2.0/trunk/examples
Message-ID: <200608231546.k7NFkvoG015995@sheep.berlios.de>

Author: ximian
Date: 2006-08-23 17:46:37 +0200 (Wed, 23 Aug 2006)
New Revision: 2042

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
- added YDCM examples to examples index.tpl

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-23 15:22:34 UTC (rev 2041)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-23 15:46:37 UTC (rev 2042)
@@ -707,6 +707,27 @@
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/functions.php">ajax/functions.php</a> </td>
         </tr>
         <tr>
+          <td colspan="2"><b>&nbsp;<br/>
+            YDCMComponent: Content Management</b></td>
+          <td><b>&nbsp;</b></td>
+        </tr>
+        <tr>
+          <td valign="top" rowspan="4">&nbsp;</td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/instructions.txt">Instructions (database and configuration) </a></td>
+          <td valign="top">&nbsp;</td>
+        </tr>
+        <tr>
+          <td colspan="2" valign="top">&nbsp;</td>
+        </tr>
+        <tr>
+          <td colspan="2" valign="top"><strong>Backend examples</strong></td>
+        </tr>
+        <tr>
+          <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php">User management ( details, add )</a><br/>
+          </td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/userdetails.php">cm/backend/userdetails.php</a> </td>
+          </tr>
+        <tr>
             <td colspan="2"><b>&nbsp;<br/>YDXml</b></td>
             <td width="43%"><b>&nbsp;</b></td>
         </tr>



From pclaerhout at mail.berlios.de  Fri Aug 25 11:43:25 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 25 Aug 2006 11:43:25 +0200
Subject: [ydf-devel] r2043 - in YDFramework2.0/trunk/examples/weblog:
	include manage
Message-ID: <200608250943.k7P9hPek025050@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-25 11:43:24 +0200 (Fri, 25 Aug 2006)
New Revision: 2043

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/categories.php
   YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/manage/links.php
   YDFramework2.0/trunk/examples/weblog/manage/links.tpl
   YDFramework2.0/trunk/examples/weblog/manage/pages.php
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
Log:
Added delete buttons to the different edit screens.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -51,6 +51,7 @@
     YDInclude( dirname( __FILE__ ) . '/YDWeblogAPI.php' );
     YDInclude( dirname( __FILE__ ) . '/YDWeblogRequest.php' );
     YDInclude( dirname( __FILE__ ) . '/exifer/exif.php' );
+    YDInclude( YD_DIR_HOME . '/3rdparty/smarty/libs/plugins/modifier.truncate.php' );
 
     // Check if the user wanted to use caching
     if ( YDConfig::get( 'use_cache', false ) ) {

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -15,6 +15,15 @@
             return confirm( '{t w="confirm_delete"}\n\n"' + name + '"?');
         {literal}}{/literal}
 
+        {literal}function YDConfirmDeleteAndRedirect( name, url ) {{/literal}
+            if ( confirm( '{t w="confirm_delete"}\n\n"' + name + '"?') ) {literal}{{/literal}
+                window.navigate( url );
+                return true;
+            {literal}}{/literal} else {literal}{{/literal}
+                return false;
+            {literal}}{/literal}
+        {literal}}{/literal}
+
         {literal}function YDConfirmAction( name ) {{/literal}
             return confirm( '{t w="confirm_action"}\n\n"' + name + '"' );
         {literal}}{/literal}

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -61,6 +61,15 @@
                 // Get the category by ID
                 $defaults = $this->weblog->getCategoryById( $id );
 
+                // Add delete button with existing items
+                $this->form->addElement(
+                    'button', '_cmdDelete', t('delete'),
+                    array(
+                        'class' => 'button',
+                        'onClick' => 'return YDConfirmDeleteAndRedirect( \'' . addslashes( $defaults['title'] ) . '\', \'' . YD_SELF_SCRIPT . '?do=delete&id=' . $defaults['id'] . '\' );'
+                    )
+                );
+
                 // Set the defaults
                 $this->form->setDefaults( $defaults );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -112,9 +112,14 @@
                 <td class="adminRowL" width="300">{$form.title.label_html}</td>
                 <td class="adminRowC" width="400">{$form.title.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
+            </tr>
         </table>
         {$form.id.html}
-        <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -86,6 +86,15 @@
                 $defaults = $this->weblog->getCommentById( $id );
                 $defaults['comment'] = YDTemplate_modifier_bbcode( $defaults['comment'] );
 
+                // Add delete button with existing items
+                $form->addElement(
+                    'button', '_cmdDelete', t('delete'),
+                    array(
+                        'class' => 'button',
+                        'onClick' => 'return YDConfirmDeleteAndRedirect( \'' . addslashes( smarty_modifier_truncate( trim( strip_tags( $defaults['comment'] ) ) ) ) . '\', \'' . YD_SELF_SCRIPT . '?do=delete&id=' . $defaults['id'] . '\' );'
+                    )
+                );
+
                 // Set the defaults
                 $form->setDefaults( $defaults );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -176,9 +176,14 @@
                 <td class="adminRowL">{$form.created.label_html}</td>
                 <td class="adminRowL">{$form.created.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
+            </tr>
         </table>
         {$form.id.html}
-        <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -90,6 +90,15 @@
                 $defaults['body_more'] = YDTemplate_modifier_bbcode( $defaults['body_more'] );
                 $defaults['modified'] = gmmktime();
 
+                // Add delete button with existing items
+                $form->addElement(
+                    'button', '_cmdDelete', t('delete'),
+                    array(
+                        'class' => 'button',
+                        'onClick' => 'return YDConfirmDeleteAndRedirect( \'' . addslashes( $defaults['title'] ) . '\', \'' . YD_SELF_SCRIPT . '?do=delete&id=' . $defaults['id'] . '\' );'
+                    )
+                );
+
                 // Assign the values to the template
                 $this->tpl->assign( 'item', $defaults );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -189,7 +189,10 @@
                 <td class="adminRowL">{$form.is_draft.html}</td> 
             </tr>
             <tr>
-                <td class="adminRowL" colspan="2" style="border: 0px;">{$form._cmdSubmit.html}</td>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
             </tr>
             {if $form.title.value != ''}
                 <tr><td colspan="7">&nbsp;</td></tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -60,6 +60,15 @@
                 // Get the link by ID
                 $defaults = $this->weblog->getLinkById( $id );
 
+                // Add delete button with existing items
+                $this->form->addElement(
+                    'button', '_cmdDelete', t('delete'),
+                    array(
+                        'class' => 'button',
+                        'onClick' => 'return YDConfirmDeleteAndRedirect( \'' . addslashes( $defaults['title'] ) . '\', \'' . YD_SELF_SCRIPT . '?do=delete&id=' . $defaults['id'] . '\' );'
+                    )
+                );
+
                 // Set the defaults
                 $this->form->setDefaults( $defaults );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -111,9 +111,14 @@
                 <td class="adminRowL">{$form.url.label_html}</td>
                 <td class="adminRowC">{$form.url.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
+            </tr>
         </table>
         {$form.id.html}
-        <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-08-25 09:43:24 UTC (rev 2043)
@@ -69,6 +69,15 @@
                 // Get the current date/time
                 $defaults['modified'] = gmmktime();
 
+                // Add delete button with existing items
+                $this->form->addElement(
+                    'button', '_cmdDelete', t('delete'),
+                    array(
+                        'class' => 'button',
+                        'onClick' => 'return YDConfirmDeleteAndRedirect( \'' . addslashes( $defaults['title'] ) . '\', \'' . YD_SELF_SCRIPT . '?do=delete&id=' . $defaults['id'] . '\' );'
+                    )
+                );
+
                 // Assign the values to the template
                 $this->tpl->assign( 'page', $defaults );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-23 15:46:37 UTC (rev 2042)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-08-25 09:43:24 UTC (rev 2043)
@@ -143,9 +143,14 @@
                 <td class="adminRowL">{$form.modified.label_html}</td>
                 <td class="adminRowL">{$form.modified.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
+            </tr>
         </table>
         {$form.id.html}
-        <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}
 



From pclaerhout at mail.berlios.de  Mon Aug 28 15:02:14 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 28 Aug 2006 15:02:14 +0200
Subject: [ydf-devel] r2044 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples/weblog examples/weblog/include/languages
	examples/weblog/skins/default
	examples/weblog/skins/default_with_lightbox
Message-ID: <200608281302.k7SD2E84031525@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-28 15:01:50 +0200 (Mon, 28 Aug 2006)
New Revision: 2044

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/skins/default/default.css
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/default.css
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Added a simple "no spam" check to the comment form.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-08-28 13:01:50 UTC (rev 2044)
@@ -133,6 +133,7 @@
 
 
             // Add the rules
+            $this->registerRule( 'value', array( 'YDValidateRules', 'value' ), 'YDValidateRules.php' );
             $this->registerRule( 'required', array( 'YDValidateRules', 'required' ), 'YDValidateRules.php' );
             $this->registerRule( 'maxlength', array( 'YDValidateRules', 'maxlength' ), 'YDValidateRules.php' );
             $this->registerRule( 'minlength', array( 'YDValidateRules', 'minlength' ), 'YDValidateRules.php' );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-08-28 13:01:50 UTC (rev 2044)
@@ -50,6 +50,16 @@
         }
 
         /**
+         *	This function returns true if the variable is equal to the specified value, otherwise, it returns false.
+         *
+         *	@param $val		The value to test.
+         *	@param $opts	The required value.
+         */
+        function value( $val, $opts ) {
+            return $val === $opts;
+        }
+
+        /**
          *	This function returns true if the variable is smaller than the specified length, otherwise, it returns
          *	false.
          *

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-28 13:01:50 UTC (rev 2044)
@@ -92,6 +92,10 @@
 $GLOBALS['t']['err_comment'] = 'Comment is required';
 $GLOBALS['t']['with'] = 'for';
 $GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
+$GLOBALS['t']['spam'] = 'Spam';
+$GLOBALS['t']['no_spam'] = 'No spam';
+$GLOBALS['t']['choose_no_spam'] = 'Choose "no spam" here';
+$GLOBALS['t']['err_userspam'] = 'You didn\'t select "no spam"';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'New comment';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-28 13:01:50 UTC (rev 2044)
@@ -92,6 +92,10 @@
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
 $GLOBALS['t']['with'] = 'bij';
 $GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
+$GLOBALS['t']['spam'] = 'Spam';
+$GLOBALS['t']['no_spam'] = 'Geen spam';
+$GLOBALS['t']['choose_no_spam'] = 'Kies hier "geen spam"';
+$GLOBALS['t']['err_userspam'] = 'Je selecteerde niet "geen spam"';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'Nieuw commentaar';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-08-28 13:01:50 UTC (rev 2044)
@@ -55,10 +55,14 @@
                     'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
                 );
 
+                // The SPAM options
+                $spam_options = array( 1 => t('spam'), 2 => t('spam'), 3 => t('no_spam'), 4 => t('spam') );
+
                 // Add the fields
                 $form->addElement( 'text', 'username', t( 'name' ) );
                 $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
                 $form->addElement( 'text', 'userwebsite', t( 'website' ) );
+                $form->addElement( 'select', '_userspam', t('choose_no_spam'), array(), $spam_options );
                 $form->addElement( 'textarea', 'comment', '' );
                 $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ), array( 'id' => 'submit' ) );
                 $form->addElement( 'hidden', 'item_id' );
@@ -78,6 +82,7 @@
                 $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
                 $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
                 $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
+                $form->addRule( '_userspam',   'value',     t( 'err_userspam' ), '3' );
                 $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
                 // Add the filters

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/default.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/default.css	2006-08-28 13:01:50 UTC (rev 2044)
@@ -107,7 +107,7 @@
 	color: #b85b5a;
 	}
 
-.commentlist li, #commentform input, #commentform textarea {
+.commentlist li, #commentform input, #commentform textarea, #commentform select {
 	font: 1em 'Lucida Grande', Verdana, Arial, Sans-Serif;
 	}
 
@@ -406,12 +406,16 @@
 	width: 130px;
 	}
 
-#commentform input {
+#commentform input, #commentform select {
 	width: 170px;
 	padding: 2px;
 	margin: 5px 5px 1px 0;
 	}
 
+#commentform select {
+	width: 178px;
+}
+
 #commentform textarea {
 	width: 100%;
 	height: 160px;

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-28 13:01:50 UTC (rev 2044)
@@ -143,6 +143,7 @@
             <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
             <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
             <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
+            <p>{$comments_form._userspam.html} <small>{$comments_form._userspam.label_html}</small></p>
 
             <p>{$comments_form.comment.html}</p>
 

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/default.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/default.css	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/default.css	2006-08-28 13:01:50 UTC (rev 2044)
@@ -107,7 +107,7 @@
 	color: #b85b5a;
 	}
 
-.commentlist li, #commentform input, #commentform textarea {
+.commentlist li, #commentform input, #commentform textarea, #commentform select {
 	font: 1em 'Lucida Grande', Verdana, Arial, Sans-Serif;
 	}
 
@@ -406,12 +406,16 @@
 	width: 130px;
 	}
 
-#commentform input {
+#commentform input, #commentform select {
 	width: 170px;
 	padding: 2px;
 	margin: 5px 5px 1px 0;
 	}
 
+#commentform select {
+	width: 178px;
+}
+
 #commentform textarea {
 	width: 100%;
 	height: 160px;

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-25 09:43:24 UTC (rev 2043)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-28 13:01:50 UTC (rev 2044)
@@ -147,6 +147,7 @@
             <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
             <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
             <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
+            <p>{$comments_form._userspam.html} <small>{$comments_form._userspam.label_html}</small></p>
 
             <p>{$comments_form.comment.html}</p>
 



From ximian at mail.berlios.de  Mon Aug 28 16:57:53 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 28 Aug 2006 16:57:53 +0200
Subject: [ydf-devel] r2045 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200608281457.k7SEvrcG016693@sheep.berlios.de>

Author: ximian
Date: 2006-08-28 16:57:34 +0200 (Mon, 28 Aug 2006)
New Revision: 2045

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
added YDAjax::getTemplate that returns the template object used

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-28 13:01:50 UTC (rev 2044)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-08-28 14:57:34 UTC (rev 2045)
@@ -68,7 +68,7 @@
 
             // Setup the module
             $this->_author = 'Francisco Azevedo';
-            $this->_version = '2.83';
+            $this->_version = '2.84';
             $this->_copyright = '(c) Copyright 2002-2006 Francisco Azevedo';
             $this->_description = 'This class makes ajax easy for YDF developers';
 
@@ -110,7 +110,9 @@
 			$this->onResponse = false;
 		}
 
+	
 
+
 		// internal method to add js to the template
 		function __assignTemplateCode(){
 			
@@ -201,6 +203,14 @@
 
 
         /**
+         *	This method returns the template object
+         */
+		function & getTemplate(){
+			return $this->template;
+		}
+
+
+        /**
          *	This function sets YDAjax to automagically handle a waiting message
          *
          *	@param $html        (Optional) Html to use in the message.



From pclaerhout at mail.berlios.de  Mon Aug 28 20:50:29 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 28 Aug 2006 20:50:29 +0200
Subject: [ydf-devel] r2046 - in YDFramework2.0/trunk/examples/weblog: .
	include/languages skins/default skins/default_with_lightbox
Message-ID: <200608281850.k7SIoTOM013107@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-28 20:50:23 +0200 (Mon, 28 Aug 2006)
New Revision: 2046

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Changed the spam trick to a javascript version which works in the background.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-28 14:57:34 UTC (rev 2045)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-28 18:50:23 UTC (rev 2046)
@@ -95,7 +95,7 @@
 $GLOBALS['t']['spam'] = 'Spam';
 $GLOBALS['t']['no_spam'] = 'No spam';
 $GLOBALS['t']['choose_no_spam'] = 'Choose "no spam" here';
-$GLOBALS['t']['err_userspam'] = 'You didn\'t select "no spam"';
+$GLOBALS['t']['err_userspam'] = 'Detected a spam attack';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'New comment';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-28 14:57:34 UTC (rev 2045)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-28 18:50:23 UTC (rev 2046)
@@ -95,7 +95,7 @@
 $GLOBALS['t']['spam'] = 'Spam';
 $GLOBALS['t']['no_spam'] = 'Geen spam';
 $GLOBALS['t']['choose_no_spam'] = 'Kies hier "geen spam"';
-$GLOBALS['t']['err_userspam'] = 'Je selecteerde niet "geen spam"';
+$GLOBALS['t']['err_userspam'] = 'Detecteerde een spam aanval';
 
 // comment_email.tpl
 $GLOBALS['t']['new_comment'] = 'Nieuw commentaar';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-08-28 14:57:34 UTC (rev 2045)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-08-28 18:50:23 UTC (rev 2046)
@@ -55,16 +55,19 @@
                     'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
                 );
 
-                // The SPAM options
-                $spam_options = array( 1 => t('spam'), 2 => t('spam'), 3 => t('no_spam'), 4 => t('spam') );
-
                 // Add the fields
                 $form->addElement( 'text', 'username', t( 'name' ) );
                 $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
                 $form->addElement( 'text', 'userwebsite', t( 'website' ) );
-                $form->addElement( 'select', '_userspam', t('choose_no_spam'), array(), $spam_options );
+                $form->addElement( 'hidden', '_userspam', t('choose_no_spam'), array() );
                 $form->addElement( 'textarea', 'comment', '' );
-                $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ), array( 'id' => 'submit' ) );
+                $form->addElement(
+                    'submit', 'cmdSubmit', t( 'submit_comment' ),
+                    array(
+                        'id' => 'submit',
+                        'onClick' => 'this.document.getElementById(\'comments__userspam\').value = 3; return true;'
+                    )
+                );
                 $form->addElement( 'hidden', 'item_id' );
 
                 // Set the defaults
@@ -73,6 +76,7 @@
                 $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
                 $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
                 $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
+                $defaults['_userspam']   = 1;
                 $form->setDefaults( $defaults );
 
                 // Set the rules

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-28 14:57:34 UTC (rev 2045)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-28 18:50:23 UTC (rev 2046)
@@ -129,6 +129,8 @@
 
         {$comments_form.tag}
 
+            {$comments_form._userspam.html}
+
             {if $comments_form.errors_unique_messages}
                 <p class="postmetadata alt" style="color: red; text-align: left;">
                     <b>{t w="error_comment"}<br/></b>
@@ -143,7 +145,6 @@
             <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
             <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
             <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
-            <p>{$comments_form._userspam.html} <small>{$comments_form._userspam.label_html}</small></p>
 
             <p>{$comments_form.comment.html}</p>
 

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-28 14:57:34 UTC (rev 2045)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-28 18:50:23 UTC (rev 2046)
@@ -133,6 +133,8 @@
 
         {$comments_form.tag}
 
+            {$comments_form._userspam.html}
+
             {if $comments_form.errors_unique_messages}
                 <p class="postmetadata alt" style="color: red; text-align: left;">
                     <b>{t w="error_comment"}<br/></b>
@@ -147,7 +149,6 @@
             <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
             <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
             <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
-            <p>{$comments_form._userspam.html} <small>{$comments_form._userspam.label_html}</small></p>
 
             <p>{$comments_form.comment.html}</p>
 



From pclaerhout at mail.berlios.de  Mon Aug 28 21:42:18 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 28 Aug 2006 21:42:18 +0200
Subject: [ydf-devel] r2047 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples
Message-ID: <200608281942.k7SJgIlr011758@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-28 21:42:16 +0200 (Mon, 28 Aug 2006)
New Revision: 2047

Added:
   YDFramework2.0/trunk/examples/callbacks.php
   YDFramework2.0/trunk/examples/callbacks.tpl
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added the callback system provided by maximus meridius.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-08-28 18:50:23 UTC (rev 2046)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-08-28 19:42:16 UTC (rev 2047)
@@ -32,6 +32,8 @@
      *	framework is implemented in this class.
      */
     class YDRequest extends YDBase {
+	
+        var $_callbacks = null;	
 
         /**
          *	This is the class constructor for the YDRequest class. This sets the default action to 'actionDefault' (but
@@ -46,6 +48,11 @@
             $this->__isInitialized = true;
             $this->__requiresAuthentication = false;
 
+            // setup the callbacks object
+            $this->_callbacks = new YDBase();
+
+            // this is for callbacks applicable to all actions
+            $this->_callbacks->set( 'action',   array( 'before' => array(), 'after' => array() ) );
         }
 
         /**
@@ -57,21 +64,11 @@
          *	@returns	The name of the current action.
          */
         function getActionName() {
-
-            // Get the name of the action
             $action = strtolower( empty( $_GET[ 'do' ] ) ? 'actionDefault' : 'action' . $_GET[ 'do' ] );
-
-            // We convert to lowercase
-            //$action = strtolower( $action );
-
-            // Remove the action prefix
             if ( strpos( $action, 'action' ) === 0 ) {
                 $action = substr( $action, strlen( 'action' ) );
             }
-
-            // Return the action name
             return strtolower( $action );
-
         }
 
         /**
@@ -169,6 +166,14 @@
          *	the action names and so on are also update to reflect this.
          *
          *	@param $action	Name of the action to forward to.
+         *
+         *  @returns 	Returns an array containing results returned from action and callback processing.
+         *				Elements of this array are keyed by strings:
+         *					action:before
+         *					<actionname>:before
+         *					<actionname>
+         *					<actionname>:after
+         *					action:after		 
          */
         function forward( $action ) {
             if ( strpos( $action, 'action' ) === 0 ) {
@@ -178,7 +183,8 @@
             if ( ! $this->isActionAllowed() ) {
                 $this->errorActionNotAllowed();
             } else {
-                call_user_func( array( $this, 'action' . $action ) );
+                // process the requested action (second parameter disables callback processing)
+                return $this->_processAction( $action, false );
             }
         }
 
@@ -230,13 +236,54 @@
         }
 
         /**
+         *  This function processes the specified action.
+         *
+         *  @param  $action  			The action name.
+         *  @param  $enable_callbacks	Default is true. Use this to disable callback processing.
+         *
+         *  @returns 	Returns an array containing results returned from action and callback processing.
+         *				Elements of this array are keyed by strings:
+         *					action:before
+         *					<actionname>:before
+         *					<actionname>
+         *					<actionname>:after
+         *					action:after
+         *
+         *  @internal
+         */
+        function _processAction( $action, $enable_callbacks = true ) {
+            if ( ! YDStringUtil::startsWith( $action, 'action' ) ) {
+                $action = 'action' . $action;
+            }
+            $results = array();
+            if ( $enable_callbacks == true ) {
+                $results['action:before'] = $this->_executeCallbacks( 'action' , true );
+                $results[$action . ':before'] = $this->_executeCallbacks( $action, true );
+            }
+            $results[$action] = call_user_func( array( $this, $action ) );
+            if ( $enable_callbacks == true ) {
+                $results[$action . ':after'] = $this->_executeCallbacks( $action, false );
+                $results['action:after'] = $this->_executeCallbacks( 'action', false );
+            }
+            return $results;
+        }
+
+        /**
          *	This function is the intelligent part of the YDRequest class. Based on the action specified in the URL, it
          *	will execute the right function of this class. It performs quite a lot of error checking to see whether the
          *	action function is specified or not.
+         *
+         *  @returns 	Returns an array containing results returned from action and callback processing.
+         *				Elements of this array are keyed by strings:
+         *					action:before
+         *					<actionname>:before
+         *					<actionname>
+         *					<actionname>:after
+         *					action:after
          */
         function process() {
             $action = 'action' . $this->getActionName();
-            call_user_func( array( $this, $action ) );
+            return $this->_processAction( $action, true );
         }
 
         /**
@@ -336,6 +383,120 @@
             trigger_error( 'You are not allow to access the action "' . $this->getActionName() . '"', YD_ERROR );
         }
 
+        /**
+         *  This function registers an action callback method.
+         *
+         *  'before' and 'after' callbacks can be registered for
+         *  'action' (all actions) or for a specific YDRequest action.
+         *
+         *  By default no YDRequest action callbacks are defined.
+         *
+         *  Callbacks are disabled when an action forwards to another
+         *  action. This is to prevent duplicated processing of callbacks.
+         *  "redirectToAction" is a more compatible with callbacks.
+         *
+         *  Processing of callbacks and actions in the context of a request
+         *  is executed in this order:
+         * 
+         *    1. (optional) before 'action' callbacks - apply to all actions
+         *    2. (optional) before callback for the current action
+         *	  3. Current action
+         *    4. (optional) after callback for the current action
+         *    5. (optional) after 'action' callbacks - apply to all actions
+         *
+         *	example 1: will execute my_before_callback() before each action
+         *		$this->registerCallback( 'my_before_callback', 'action', true );
+         *
+         *	example 2: will execute my_after_callback() after each action
+         *		$this->registerCallback( 'my_after_callback', 'action', false );
+         *
+         *	example 3: will execute my_deafult_after_callback() after actionDefault
+         *		$this->registerCallback( 'my_deafult_after_callback', 'actionDefault', false );		 
+         *
+         *  @param $method  The method name.
+         *  @param $action  The action or array of actions that trigger the call.
+         *  @param $before  (optional) Execute callback before the action. Default: false.
+         */
+        function registerCallback( $method, $action, $before=false ) {
+            if ( strtolower( $action ) != 'action' && ! $this->_callbacks->exists( strtolower( $action ) ) ) {
+                $this->_callbacks->set( strtolower( $action ),   array( 'before' => array(), 'after' => array() ) );				
+            }
+            if ( strtolower( $action ) != 'action' && ! $this->hasMethod( $action ) ) {
+                trigger_error(  $this->getClassName() . ' - ' .
+                                    ' action "' . $action . '" for callback "' . $method . '" does not exist.', YD_ERROR );					
+            }
+            $sub = $before ? 'before' : 'after';
+            if ( ! is_array( $action ) ) {
+                $action = array( $action );
+            }
+            foreach ( $action as $ac ) {
+                if ( ! $this->_callbacks->exists( strtolower( $ac ) ) ) {
+                    trigger_error(  $this->getClassName() . ' - ' . $ac .
+                                    ' Incorrect action for callback "' . $method . '".', YD_ERROR );
+                }
+                $aclower = strtolower( $ac );
+                $act = & $this->_callbacks->$aclower;
+                $act[ $sub ][ $method ] = '';
+            }
+        }
+
+        /**
+         *  This function unregisters a callback method.
+         *
+         *  @param $method  The method name.
+         *  @param $action  (optional) The action that triggers the call. If null, from all actions. Default: null.
+         */
+        function unregisterCallback( $method, $action=null ) {
+            if ( ! is_null( $action ) && ! $this->_callbacks->exists( strtolower( $action ) ) ) {
+                trigger_error(  $this->getClassName() . ' -
+                                Incorrect action for unregistering callback method "' . $method . '".', YD_ERROR );
+            }
+            $actions = array( $action );
+            if ( is_null( $action ) ) {
+                $actions = array_keys( get_object_vars( $this->_callbacks ) );
+            }
+            foreach ( $actions as $action ) {
+                $ac = strtolower ( $action );
+                $act = & $this->_callbacks->$ac;
+                unset( $act[ 'before' ][ $method ] );
+                unset( $act[ 'after' ][ $method ] );
+            }
+        }
+
+        /**
+         *  This function executes all callbacks defined for the action.
+         *
+         *  @param  $action  The action name.
+         *  @param  $before  (optional) Execute the before actions. Default: false.
+         *  @param  $success (optional) Boolean indicating if the action was successful. Default: null - no result.
+         *
+         *  @internal
+         */
+        function _executeCallbacks( $action, $before=false, $success=null ) {
+            $sub = $before ? 'before' : 'after';
+            $actions = & $this->_callbacks->$action;
+            if ( $actions[$sub] != null ) {
+                foreach ( $actions[ $sub ] as $callback => $n ) {
+                    if ( ! $this->hasMethod( $callback ) ) {
+                        trigger_error(  $this->getClassName() . ' - The ' . 
+                                        $action . ' callback method "' . $callback . '" is not defined.', YD_ERROR );
+                    }
+                    $res = call_user_func( array( & $this, $callback ), $action, $before, $success );
+                    if ( $res !== true && $res !== null ) {
+                        return array( 
+                            'class'    => $this->getClassName(),
+                            'callback' => $callback,
+                            'action'   => $action,
+                            'before'   => $before,
+                            'success'  => $success,
+                            'return'   => $res
+                        );
+                    }
+                }
+            }
+            return true;
+        }
+
     }
 
 ?>

Added: YDFramework2.0/trunk/examples/callbacks.php
===================================================================
--- YDFramework2.0/trunk/examples/callbacks.php	2006-08-28 18:50:23 UTC (rev 2046)
+++ YDFramework2.0/trunk/examples/callbacks.php	2006-08-28 19:42:16 UTC (rev 2047)
@@ -0,0 +1,83 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDUtil.php' );
+
+    // Class definition
+    class callbacks extends YDRequest {
+
+        // Class constructor
+        function callbacks() {
+            $this->YDRequest();
+            $this->template = new YDTemplate();
+
+            // these are callbacks that will be executed for all actions
+            $this->registerCallback( 'before_action_callback', 'action', true );
+            $this->registerCallback( 'after_action_callback',  'action', false );
+
+            // this is an example of an action-specific callback
+            $this->registerCallback( 'before_actionEdit_callback',  'actionEdit', false );
+
+            // uncomment this to test unregisterCallback
+            //$this->unregisterCallback( 'before_action_callback' );
+            //$this->unregisterCallback( 'after_action_callback' );
+            //$this->unregisterCallback( 'before_actionEdit_callback', 'actionEdit' );
+
+        }
+
+        // Default action - note: display is handled by the 'after_action_callback' callback
+        function actionDefault() {
+            $this->template->assign( 'title', 'callbacks::actionDefault' );
+        }
+
+        // Edit action
+        function actionEdit() {
+            $this->template->assign( 'title', 'callbacks::actionEdit' );
+        }
+
+        // Browser information
+        function actionBrowserInfo() {
+            $this->template->assign( 'title', 'callbacks::actionBrowserInfo' );
+        }
+
+        // Forward to BrowserInfo
+        function actionForward() {
+            $this->forward( 'BrowserInfo' );
+        }
+
+        // Redirect to BrowserInfo
+        function actionRedirect() {
+            $this->redirectToAction( 'BrowserInfo' );
+        }
+
+        // this method will be executed before all actions
+        function before_action_callback() {
+            $browser = new YDBrowserInfo(); 
+            $agent = YDDebugUtil::r_dump( $browser->agent, 'Agent' );
+            $this->template->assign( 'browserinfo', '<pre>' . $agent . '</pre>' );
+        }
+
+        // this method will be executed AFTER all actions
+        function after_action_callback() {
+            $this->template->display();
+        }
+
+        // this method will be executed BEFORE the actionEdit action
+        function before_actionEdit_callback() {
+            $browser = new YDBrowserInfo(); 
+            $agent = YDDebugUtil::r_dump( $browser->agent, 'Agent' );
+            $additional_information = "<p>Additional Information added by the before_actionEdit_callback() callback</p>";
+            $this->template->assign( 'browserinfo', '<pre>' . $agent . '</pre>' . $additional_information );
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?> 
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/callbacks.tpl
===================================================================
--- YDFramework2.0/trunk/examples/callbacks.tpl	2006-08-28 18:50:23 UTC (rev 2046)
+++ YDFramework2.0/trunk/examples/callbacks.tpl	2006-08-28 19:42:16 UTC (rev 2047)
@@ -0,0 +1,28 @@
+<html>
+
+<head>
+
+    <title>{$YD_FW_NAMEVERS}</title>
+
+</head>
+
+<body>
+
+    <h3>{$title}</h3>
+
+    <p>
+        <a href="{$YD_SELF_SCRIPT}">default action</a> |
+        <a href="{$YD_SELF_SCRIPT}?do=edit">edit action</a> |
+        <a href="{$YD_SELF_SCRIPT}?do=forward">forward action</a> |
+        <a href="{$YD_SELF_SCRIPT}?do=redirect">redirect action</a> |
+        <a href="index.php">other samples</a>
+    </p>
+	
+	<h3>Browser Info (added by callbacks)</h3>
+	<p>
+		{$browserinfo}
+	</p>
+
+</body>
+
+</html>

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-08-28 18:50:23 UTC (rev 2046)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-08-28 19:42:16 UTC (rev 2047)
@@ -108,7 +108,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="4" valign="top">&nbsp;</td>
+            <td rowspan="5" valign="top">&nbsp;</td>
             <td valign="top"><a href="sample.php">Defining and using action requests</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=sample.php">sample.php</a>
@@ -151,6 +151,14 @@
             </td>
         </tr>
         <tr>
+            <td valign="top"><a href="callbacks.php">Using callbacks</a> </td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=sample.php">callbacks.php</a>
+                <br/>
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=sample.tpl">callbacks.tpl</a>
+            </td>
+        </tr>
+        <tr>
             <td colspan="2"><b>&nbsp;<br/>Using templates</b></td>
             <td width="43%"><b>&nbsp;</b></td>
         </tr>



From pieter at yellowduck.be  Mon Aug 28 21:42:31 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Mon, 28 Aug 2006 21:42:31 +0200
Subject: [ydf-devel] Callbacks in YDRequest based on YDDatabaseObject
In-Reply-To: <20060823140020.7061.qmail@web54002.mail.yahoo.com>
References: <20060823140020.7061.qmail@web54002.mail.yahoo.com>
Message-ID: <4aef63030608281242r6eaee6a5q50f96f43d1a79f84@mail.gmail.com>

Added it in build 2047 and cleaned it up a little.

pieter

On 8/23/06, maximus meridius <maximus_meridius79 at yahoo.com> wrote:
>
>  Hi,
>
> I decided it would be nice to have 'before' and 'after' action callbacks
> in the YDRequest class after seeing the functionality in YDDatabaseObject.
> The original intention was to provide a way to have common processing before
> and after actions are processed (e.g. automatically set a smarty variable
> or call $this->tpl->display() before or after every action). I then decided
> to extend it so that callbacks could be specified for specific actions.
> There is potential for duplicate processing when the forward method is used
> and so I disabled callbacks for this type of processing. See also the
> comments below.
>
> I have added methods to YDRequest.php and provided example usage in
> examples/callbacks.php. The code is attached as a tarball.
>
> The methods have been adapted for YDRequest and there is a modification to
> process(). There is a new internal method _processAction.
>
> This is the comment for registerCallback:
>
>        /**
>          *  This function registers an action callback method.
>          *
>          *  'before' and 'after' callbacks can be registered for
>          *  'action' (all actions) or for a specific YDRequest action.
>          *
>          *  By default no YDRequest action callbacks are defined.
>          *
>          *  Callbacks are disabled when an action forwards to another
>          *  action. This is to prevent duplicated processing of callbacks.
>          *  "redirectToAction" is a more compatible with callbacks.
>          *
>          *  Processing of callbacks and actions in the context of a
> request
>          *  is executed in this order:
>          *
>          *    1. (optional) before 'action' callbacks - apply to all
> actions
>          *    2. (optional) before callback for the current action
>          *      3. Current action
>          *    4. (optional) after callback for the current action
>          *    5. (optional) after 'action' callbacks - apply to all
> actions
>          *
>          *    example 1: will execute my_before_callback() before each
> action
>          *        $this->registerCallback( 'my_before_callback', 'action',
> true );
>          *
>          *    example 2: will execute my_after_callback() after each
> action
>          *        $this->registerCallback( 'my_after_callback', 'action',
> false );
>          *
>          *    example 3: will execute my_deafult_after_callback() after
> actionDefault
>          *        $this->registerCallback( 'my_deafult_after_callback',
> 'actionDefault', false );
>          *
>          *  @param $method  The method name.
>          *  @param $action  The action or array of actions that trigger
> the call.
>          *  @param $before  (optional) Execute callback before the action.
> Default: false.
>          */
>
> I have changed YDRequest->process() so that it returns results from
> processing of actions and any associated callbacks. There is potential for
> adding error/results processing to YDProcess::execute()
>
> Let me know what you think about the changes I made.
>
> Regards,
>
> Graeme
>
>
>
>    ------------------------------
> Stay in the know. Pulse on the new Yahoo.com <http://yahoo.com/>. Check it
> out. <http://us.rd.yahoo.com/evt=42974/*http://www.yahoo.com/preview>
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>
>


-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060828/79e8eace/attachment.html>

From ximian at mail.berlios.de  Tue Aug 29 19:14:59 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 29 Aug 2006 19:14:59 +0200
Subject: [ydf-devel] r2048 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608291714.k7THExP9020982@sheep.berlios.de>

Author: ximian
Date: 2006-08-29 19:14:37 +0200 (Tue, 29 Aug 2006)
New Revision: 2048

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
Log:
- added YDResult ( a YDError clone with a new OK type )

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2006-08-28 19:42:16 UTC (rev 2047)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2006-08-29 17:14:37 UTC (rev 2048)
@@ -0,0 +1,408 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // The different error levels
+    @define( 'YD_RESULT_FATAL',   40 );
+    @define( 'YD_RESULT_WARNING', 30 );
+    @define( 'YD_RESULT_NOTICE',  20 );
+    @define( 'YD_RESULT_OK',      10 );
+    @define( 'YD_RESULT_NONE',    0 );
+    
+    // The config variable name for storing the errors
+    YDConfig::set( 'YD_RESULT_STORE_NAME',
+        strtoupper( str_replace( ' ', '_', YD_FW_NAME ) ) . '_ERROR_STORE', false
+    );
+    
+    // The error reporting level
+    YDConfig::set( 'YD_RESULT_REPORTING', YD_RESULT_NONE, false );
+    
+    // The error catch number
+    YDConfig::set( 'YD_RESULT_CATCH', array(), true );
+    YDConfig::set( 'YD_RESULT_CATCH_TEMP', array(), true );
+    
+    // The stored errors
+    YDConfig::set( YDConfig::get( 'YD_RESULT_STORE_NAME' ), array(), true );
+
+    // Global names for the errors
+    YDConfig::set( 'YD_RESULT_LEVELS', array(
+            YD_RESULT_NOTICE  => 'Notice',
+            YD_RESULT_WARNING => 'Warning',
+            YD_RESULT_FATAL   => 'Fatal',
+            YD_RESULT_OK      => 'Ok'
+        ), false
+    );
+
+    /**
+     *  This class defines an YDResult object.
+     */
+    class YDResult extends YDBase {
+
+        /**
+         *  The class constructor.
+         *  Should not be used directly.
+         *
+         *  @param  $level          The error level.
+         *  @param  $message        The error message.
+         *  @param  $file           The file where the error was triggered.
+         *  @param  $line           The line of the file.
+         *  @param  $function       (optional) The function where it happened.
+         *  @param  $stacktrace     (optional) The complete stack trace for this error
+         *  @param  $custom         (optional) A custom value
+         */
+        function YDResult( $level, $message, $file, $line, $function='', $stacktrace='', $custom=null ) {
+            
+            $this->YDBase();
+            
+            $levels = YDConfig::get( 'YD_RESULT_LEVELS' );
+            
+            $this->level        = $level;
+            $this->name         = $levels[ $level ];
+            $this->message      = $message;
+            $this->file         = $file;
+            $this->line         = $line;
+            $this->func         = $function;
+            $this->custom       = $custom;
+            $this->run_file     = null;
+            $this->run_line     = null;
+            $this->md5          = md5( $level . $message . $file . $line . $function . $stacktrace . mt_rand() );
+            $this->stacktrace   = $stacktrace;
+            $this->ok           = ( $level === YD_RESULT_OK );
+            $this->warning      = ( $level === YD_RESULT_WARNING );
+            $this->notice       = ( $level === YD_RESULT_NOTICE );
+            $this->fatal        = ( $level === YD_RESULT_FATAL );
+            $this->value        = $custom;
+        }
+        
+
+        /**
+         *  This function catch the last stored error.
+         *
+         *  @param  $error  (optional) Variable or array of variables to check if they are errors. If null, all triggered errors.
+         *  @param  $level  (optional) All errors bellow this $level will be catched. Default: YD_RESULT_FATAL.
+         *
+         *  @returns     A YDResult object or false.
+         *
+         *  @static
+         */
+        function catchError( $error=null, $level=YD_RESULT_FATAL ) {
+            
+            $catch = YDConfig::get( 'YD_RESULT_CATCH' );
+            $catch_temp = YDConfig::get( 'YD_RESULT_CATCH_TEMP' );
+            
+            if ( is_null( $error ) ) {
+                $c = & $catch;
+                $errors = YDResult::getAll();
+            } else { 
+                $c = & $catch_temp;
+                if ( is_array( $error ) ) {
+                    $errors = $error;
+                } else {
+                    $errors = array( $error );
+                }
+            }
+            
+            foreach ( $errors as $e ) {
+                
+                if ( is_object( $e ) && is_a( $e, 'YDResult' ) && $e->level <= $level && ! in_array( $e->md5, $c ) ) {
+                    
+                    if ( ! is_null( $error ) ) {
+                        YDConfig::set( 'YD_RESULT_CATCH_TEMP', array_merge( $catch_temp, array( $e->md5 ) ) );
+                    } 
+                    YDConfig::set( 'YD_RESULT_CATCH', array_merge( $catch, array( $e->md5 ) ) );
+                    
+                    $stack = debug_backtrace();
+                    $e->run_file = $stack[ 0 ]['file'];
+                    $e->run_line = $stack[ 0 ]['line'];
+                    
+                    return $e;
+                }
+            }
+            if ( ! is_null( $error ) ) {
+                YDConfig::set( 'YD_RESULT_CATCH_TEMP', array(), true );
+            }
+            return false;
+        }
+        
+        /**
+         *  This function sets the reporting level.
+         *
+         *  @param  $level  (Optional) The error level. Should be one of the
+         *                  following constants: YD_RESULT_NONE, YD_RESULT_NOTICE,
+         *                  YD_RESULT_WARNING or YD_RESULT_FATAL.
+         *
+         *  @static
+         */
+        function reporting( $level=YD_RESULT_NONE ) {
+            YDConfig::set( 'YD_RESULT_REPORTING', $level, true );
+        }
+
+        /**
+         *  This method creates a OK type
+         *
+         *  @param  $message  The message.
+         *  @param  $value    (optional) A custom value
+         *
+         *  @returns     An YDCMResult object.
+         *
+         *  @static
+         */
+        function ok( $message, $value = null ) {
+            return YDResult::_result( YD_RESULT_OK, $message, $value );
+        }
+
+
+        /**
+         *  This function creates a notice error.
+         *
+         *  @param  $message  The error message.
+         *  @param  $custom   (optional) A custom value
+         *
+         *  @returns     An YDResult object.
+         *
+         *  @static
+         */
+        function notice( $message, $custom=null ) {
+            return YDResult::_result( YD_RESULT_NOTICE, $message, $custom );
+        }
+
+        /**
+         *  This function creates a warning error.
+         *
+         *  @param  $message  The error message.
+         *  @param  $custom   (optional) A custom value
+         *
+         *  @returns     An YDResult object.
+         *
+         *  @static
+         */
+        function warning( $message, $custom=null ) {
+            return YDResult::_result( YD_RESULT_WARNING, $message, $custom );
+        }
+
+        /**
+         *  This function creates a fatal error.
+         *
+         *  @param  $message  The error message.
+         *  @param  $custom   (optional) A custom value
+         *
+         *  @returns     An YDResult object.
+         *
+         *  @static
+         */
+        function fatal( $message, $custom=null ) {
+            return YDResult::_result( YD_RESULT_FATAL, $message, $custom );
+        }
+
+        /**
+         *  This function clears all stored errors.
+         *
+         *  @static
+         */
+        function clear() {
+            YDConfig::set( YDConfig::get( 'YD_RESULT_STORE_NAME' ), array(), true );
+            YDConfig::set( 'YD_RESULT_CATCH', array(), true );
+            YDConfig::set( 'YD_RESULT_CATCH_TEMP', array(), true );
+        }
+        
+        /**
+         *  This function returns all stored errors.
+         *
+         *  @returns     All stored errors.
+         *
+         *  @static
+         */
+        function getAll() {
+            return YDConfig::get( YDConfig::get( 'YD_RESULT_STORE_NAME' ) );
+        }
+        
+        /**
+         *  This function dumps the error.
+         *
+         *  @param  $html  (optional) Dump an HTML error. Default: true.
+         */
+        function dump( $html=true ) {
+            echo $this->_dump( $html );
+        }
+        
+        /**
+         *  This function returns the dump string of the error.
+         *
+         *  @param  $html  (optional) Dump an HTML error. Default: true.
+         *
+         *  @returns  The dump information.
+         */
+        function r_dump( $html=true ) {
+            return $this->_dump( $html );
+        }
+        
+        /**
+         *  This function returns the dump information of the error.
+         *
+         *  @param  $html  (optional) Dump an HTML error. Default: true.
+         *  @param  $back  (optional) The backtrace level.
+         *
+         *  @returns   The dump information.
+         *
+         *  @internal
+         */
+        function _dump( $html=true, $back=1 ) {
+        
+            // Get the file and line of the dump
+            $stack = debug_backtrace();
+            $file = $stack[ $back ]['file'];
+            $line = $stack[ $back ]['line'];
+            
+            $this->run_file = $this->run_file ? $this->run_file : $file;
+            $this->run_line = $this->run_line ? $this->run_line : $line;
+            
+            // Get the error levels
+            $levels = YDConfig::get( 'YD_RESULT_LEVELS' );
+            
+            // Creates the message
+            $msg = '';
+            if ( $html ) $msg .= '<br /><b>';
+            $msg .= strtoupper( $levels[ $this->level ] ) . ': ';
+            if ( $html ) $msg .= '</b>';
+            $msg .= $this->message . YD_CRLF;
+            
+            // File
+            if ( $html ) $msg .= '<br />';
+            if ( $html ) $msg .= '<b>';
+            $msg .= 'File: ';
+            if ( $html ) $msg .= '</b>';
+            $msg .= $this->file . YD_CRLF;
+            
+            // File line
+            if ( $html ) $msg .= '<br />';
+            if ( $html ) $msg .= '<b>';
+            $msg .= 'Line: ';
+            if ( $html ) $msg .= '</b>';
+            $msg .= $this->line . YD_CRLF;
+            
+            // Dump
+            if ( $html ) $msg .= '<br />';
+            if ( $html ) $msg .= '<b>';
+            $msg .= 'Dump: ';
+            if ( $html ) $msg .= '</b>';
+            $msg .= $file . YD_CRLF;
+            
+            // Dump line
+            if ( $html ) $msg .= '<br />';
+            if ( $html ) $msg .= '<b>';
+            $msg .= 'Line: ';
+            if ( $html ) $msg .= '</b>';
+            $msg .= $line . YD_CRLF;
+            if ( $html ) $msg .= '<br />';
+            
+            // Stack trace
+            if ( $html ) $msg .= '<b>';
+            $msg .= 'Stack Trace: ';
+            if ( $html ) $msg .= '</b>';
+            if ( $html ) {
+                $msg .= nl2br( str_replace( ' ', '&nbsp;', $this->stacktrace ) );
+            } else {
+                $msg .= $this->stacktrace;
+            }
+            if ( $html ) $msg .= '<br />';
+            $msg .= YD_CRLF;
+            
+            return $msg;
+        
+        }
+        
+        /**
+         *  This function creates an YDResult object and store it.
+         *
+         *  @param  $level    The error level.
+         *  @param  $message  The error message.
+         *  @param  $custom   (optional)
+         *
+         *  @returns     An YDResult object.
+         *  
+         *  @internal
+         *  @static
+         */
+        function _result( $level, $message, $custom=null ) {
+
+            // Get the current stack
+            $stack = debug_backtrace();
+            
+            // Get level names
+            $levels = YDConfig::get( 'YD_RESULT_LEVELS' );
+            
+            // Get the complete stack trace
+            $stacktrace = YD_CRLF;
+            foreach( array_slice( $stack, 1 ) as $t ) {
+                $stacktrace .= '    @ ';
+                if ( isset( $t['file'] ) ) {
+                    $stacktrace .= basename( $t['file'] ) . ':' . $t['line'];
+                } else {
+                    $stacktrace .= basename( YD_SELF_FILE );
+                }
+                $stacktrace .= ' -- ';
+                if ( isset( $t['class'] ) ) {
+                    $stacktrace .= $t['class'] . $t['type'];
+                }
+                $stacktrace .= $t['function'];
+                if ( isset( $t['args'] ) && sizeof( $t['args'] ) > 0 ) {
+                    $stacktrace .= '(...)';
+                } else {
+                    $stacktrace .= '()';
+                }
+                $stacktrace .= YD_CRLF;
+            }
+
+            // Create the error object
+            $error = new YDResult(
+                $level, $message, $stack[1]['file'], $stack[1]['line'],
+                $stack[2]['class'] . $stack[2]['type'] . $stack[2]['function'],
+                $stacktrace, $custom
+            );
+            
+            // Store the error object on the global errors array
+            YDConfig::set(
+                YDConfig::get( 'YD_RESULT_STORE_NAME' ),
+                array_merge( YDResult::getAll(), array( $error ) )
+            );
+            
+            // If reporting for this level is on, dump the error
+            if ( $level <= YDConfig::get( 'YD_RESULT_REPORTING' ) ) {
+                echo $error->_dump( true, 2 );
+                if ( $level == YD_RESULT_FATAL ) {
+                    die();
+                }
+            }
+            
+            // Return the error object
+            return $error;
+
+        }
+
+    }
+    
+?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Wed Aug 30 14:56:22 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 14:56:22 +0200
Subject: [ydf-devel] r2049 - in YDFramework2.0/trunk/examples/weblog: .
	include include/dbupdates manage
Message-ID: <200608301256.k7UCuMtC022627@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 14:56:04 +0200 (Wed, 30 Aug 2006)
New Revision: 2049

Added:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_004_CommentsUriAgent.php
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/install.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
The user agent and request url are now saved for new comments.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-29 17:14:37 UTC (rev 2048)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-30 12:56:04 UTC (rev 2049)
@@ -114,7 +114,12 @@
             // Get a link to the database metadata
             $dbmeta = new YDDatabaseMetaData( $this->db );
 
-            // Add any missing items field
+            // Add any missing comments fields
+            $fields = $dbmeta->getFields( '#_comments' );
+            $this->executeIfMissing( 'useragent', $fields, 'ALTER TABLE #_comments ADD useragent varchar(255) AFTER userip' );
+            $this->executeIfMissing( 'userrequrl', $fields, 'ALTER TABLE #_comments ADD userrequrl varchar(255) AFTER useragent' );
+
+            // Add any missing items fields
             $fields = $dbmeta->getFields( '#_items' );
             $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
             $this->executeIfMissing( 'allow_comments', $fields, 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
@@ -389,18 +394,8 @@
 
         // Get the comments for an item
         function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1, $public_only=false ) {
-            /*
+            $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
             if ( $item_id ) {
-                $query = 'SELECT * FROM #_comments WHERE item_id = ' . $this->str( $item_id );
-            } else {
-                $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
-                if ( $public_only == true ) {
-                    $query .= ' and i.is_draft = 0';
-                }
-            }
-            */
-            $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
-            if ( $item_id ) {
                 $query .= ' and item_id = ' . $this->str( $item_id );
             }
             if ( $public_only == true ) {
@@ -415,7 +410,7 @@
 
         // Get a comment by it's ID
         function getCommentById( $comment_id ) {
-            $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id and c.id = ' . $this->str( $comment_id ) );
+            $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id and c.id = ' . $this->str( $comment_id ) );
             $record  = $this->db->getRecord( $sql );
             $record['comment'] = trim( strip_tags( $record['comment'] ) );
             return $record;
@@ -424,6 +419,8 @@
         // Add a comment
         function addComment( $values ) {
             $values['userip'] = $_SERVER['REMOTE_ADDR'];
+            $values['useragent'] = $_SERVER['HTTP_USER_AGENT'];
+            $values['userrequrl'] = $_SERVER['REQUEST_URI'];
             $result = $this->_executeInsert( '#_comments', $values );
             $comment_id = $this->db->getLastInsertID();
             $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $values['item_id'] );

Added: YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_004_CommentsUriAgent.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_004_CommentsUriAgent.php	2006-08-29 17:14:37 UTC (rev 2048)
+++ YDFramework2.0/trunk/examples/weblog/include/dbupdates/UPD_004_CommentsUriAgent.php	2006-08-30 12:56:04 UTC (rev 2049)
@@ -0,0 +1,29 @@
+<?php
+
+    // Class definition
+    class UPD_004_CommentsUriAgent {
+
+        // Class constructor
+        function UPD_004_CommentsUriAgent( $db ) {
+
+            // Publish the database
+            $this->db = $db;
+
+        }
+
+        // Install the update
+        function update() {
+
+            // The SQL to add the useragent field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'comments ADD useragent varchar(255) AFTER userip';
+            $this->db->executeSql( $sql );
+
+            // The SQL to add the userrequrl field to the database
+            $sql = 'ALTER TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'comments ADD userrequrl varchar(255) AFTER useragent';
+            $this->db->executeSql( $sql );
+
+        }
+
+    }
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/install.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/install.php	2006-08-29 17:14:37 UTC (rev 2048)
+++ YDFramework2.0/trunk/examples/weblog/install.php	2006-08-30 12:56:04 UTC (rev 2049)
@@ -133,6 +133,8 @@
                       useremail varchar(255) NOT NULL default \'\',
                       userwebsite varchar(255) default NULL,
                       userip varchar(20) default NULL,
+                      useragent varchar(255) default NULL,
+                      userrequrl varchar(255) default NULL,
                       comment longtext NOT NULL,
                       created int(11) default NULL,
                       modified int(11) default NULL,

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-29 17:14:37 UTC (rev 2048)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-08-30 12:56:04 UTC (rev 2049)
@@ -150,10 +150,18 @@
                 <td class="adminRowL" width="400"><a href="items.php?do=edit&id={$comment.item_id}"><b>{$comment.item_title}</b></a></td>
             </tr>
             <tr>
-                <td class="adminRowL" width="300">{t w="posted_from"}</td>
-                <td class="adminRowL" width="400">{$comment.userip}</td>
+                <td class="adminRowL">{t w="posted_from"}</td>
+                <td class="adminRowL">{$comment.userip}</td>
             </tr>
             <tr>
+                <td class="adminRowL" width="300">User Agent</td>
+                <td class="adminRowL" width="400">{$comment.useragent|default:'-'}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">Request URI</td>
+                <td class="adminRowL">{$comment.userrequrl|default:'-'}</td>
+            </tr>
+            <tr>
                 <td class="adminRowL">{$form.username.label_html}</td>
                 <td class="adminRowC">{$form.username.html}</td>
             </tr>



From pclaerhout at mail.berlios.de  Wed Aug 30 15:03:31 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 15:03:31 +0200
Subject: [ydf-devel] r2050 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608301303.k7UD3VZ9024556@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 15:03:27 +0200 (Wed, 30 Aug 2006)
New Revision: 2050

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
Log:
The PHP modules in server info are now listed in alphabetical order.

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-08-30 12:56:04 UTC (rev 2049)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-08-30 13:03:27 UTC (rev 2050)
@@ -49,10 +49,15 @@
             // Get the version of phpMailer
             $PHPMailer = new PHPMailer();
 
+            // Get the list of PHP modules
+            $php_modules = get_loaded_extensions();
+            sort( $php_modules );
+            $php_modules = implode( $php_modules, ', ' );
+
             // Get the other variables
             $this->tpl->assign( 'php_version',       phpversion() );
             $this->tpl->assign( 'mysql_version',     mysql_get_server_info() );
-            $this->tpl->assign( 'php_modules',       implode( get_loaded_extensions(), ', ' ) );
+            $this->tpl->assign( 'php_modules',       $php_modules );
             $this->tpl->assign( 'includePath',       $GLOBALS['YD_INCLUDE_PATH'] );
             $this->tpl->assign( 'phpmailer_version', $PHPMailer->Version );
             $this->tpl->assign( 'PHP_OS', PHP_OS );



From pclaerhout at mail.berlios.de  Wed Aug 30 15:21:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 15:21:23 +0200
Subject: [ydf-devel] r2051 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608301321.k7UDLN4p031868@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 15:20:45 +0200 (Wed, 30 Aug 2006)
New Revision: 2051

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
Log:
The comment properties are now properly shown, even in an edit cycle.

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-30 13:03:27 UTC (rev 2050)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-08-30 13:20:45 UTC (rev 2051)
@@ -78,6 +78,12 @@
 
             // Get the ID from the query string
             $id = $this->getIdFromQS();
+            if ( $id == -1 ) {
+                $id = $form->getValue( 'id' );
+                if ( $id == '' ) {
+                    $id = -1;
+                }
+            }
 
             // If there is something, set the defaults
             if ( $id != -1 ) {



From pclaerhout at mail.berlios.de  Wed Aug 30 16:39:58 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 16:39:58 +0200
Subject: [ydf-devel] r2052 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples/weblog/include examples/weblog/include/languages
	examples/weblog/manage
Message-ID: <200608301439.k7UEdwr9002513@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 16:39:46 +0200 (Wed, 30 Aug 2006)
New Revision: 2052

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/manage.css
Log:
Added support for blocking IP addresses.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -813,6 +813,58 @@
             return ( substr( $string, -strlen( $substring ) ) == $substring );
         }
 
+        /**
+         *  This function is an fnmatch replacement.
+         *
+         *  $param $string      The string to test
+         *  $param $pattern     The pattern to match
+         *
+         *  @returns    Boolean indicating if the string matches the pattern or not.
+         */
+        function match( $string, $pattern ) {
+            for ( $op = 0, $npattern = '', $n = 0, $l = strlen( $pattern ); $n < $l; $n++ ) {
+            switch ($c = $pattern[$n]) {
+                case '\\':
+                    $npattern .= '\\' . @$pattern[++$n];
+                    break;
+                case '.':
+                case '+':
+                case '^':
+                case '$':
+                case '(':
+                case ')':
+                case '{':
+                case '}':
+                case '=':
+                case '!':
+                case '<':
+                case '>':
+                case '|':
+                    $npattern .= '\\' . $c;
+                    break;
+                case '?': case '*':
+                    $npattern .= '.' . $c;
+                    break;
+                case '[':
+                case ']':
+                default:
+                    $npattern .= $c;
+                    if ($c == '[') {
+                        $op++;
+                    } else if ($c == ']') {
+                        if ($op == 0) return false;
+                            $op--;
+                        }
+                        break;
+                    }
+            }
+            if ( $op != 0 ) {
+                return false;
+            } else {
+                return preg_match( '/' . $npattern . '/i', $string );
+            }
+        }
+
     }
 
     /**

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -95,6 +95,16 @@
 
     }
 
+    // Function to format a string with list values
+    function YDFormatStringWithListValues( $string ) {
+        $string = str_replace( ';', ',', $string );
+        $string = explode( ',', $string );
+        foreach ( $string as $k=>$v ) {
+            $string[$k] = trim( $v );
+        }
+        return implode( ', ', $string );
+    }
+
     // Class defining our weblog API
     class YDWeblogAPI extends YDBase {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -53,6 +53,17 @@
     YDInclude( dirname( __FILE__ ) . '/exifer/exif.php' );
     YDInclude( YD_DIR_HOME . '/3rdparty/smarty/libs/plugins/modifier.truncate.php' );
 
+    // Check for blocked IP addresses
+    $blocked_ips = YDConfig::get( 'blocked_ips', '' );
+    $blocked_ips = explode( ', ', YDFormatStringWithListValues( $blocked_ips ) );
+
+    // Check if the current IP address is blocked or not
+    foreach ( $blocked_ips as $ip ) {
+        if ( YDStringUtil::match( $_SERVER['REMOTE_ADDR'], $ip ) ) {
+            die( 'IP address ' . $_SERVER['REMOTE_ADDR'] . ' is blocked.' );
+        }
+    }
+
     // Check if the user wanted to use caching
     if ( YDConfig::get( 'use_cache', false ) ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -293,6 +293,7 @@
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
 $GLOBALS['t']['cfg_use_auto_update'] = 'Enable Auto Update';
+$GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -293,6 +293,7 @@
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
 $GLOBALS['t']['cfg_use_auto_update'] = 'Activeer Auto Update';
+$GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-30 14:39:46 UTC (rev 2052)
@@ -38,6 +38,7 @@
 
         {literal}tinyMCE.init({
             mode : "textareas",
+            editor_deselector : "tfMNoMCE",
             theme : "advanced",
             language: "{/literal}{$weblog_language}{literal}",
             plugins : "imgselector,fullscreen",

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-30 14:39:46 UTC (rev 2052)
@@ -98,6 +98,8 @@
             $form->addElement( 'text', 'auto_close_items', t( 'cfg_auto_close_items' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'checkbox', 'dflt_is_draft', t( 'is_draft' ), array( 'style' => 'border: none;' ) );
 
+            $form->addElement( 'textarea', 'blocked_ips', t( 'cfg_blocked_ips' ), array( 'class' => 'tfMNoMCE' ) );
+
             $form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 
             // Set the defaults
@@ -126,6 +128,9 @@
                 // Get the form values
                 $values = $form->getValues();
 
+                // Format the list of blocked IP numbers
+                $values['blocked_ips'] = YDFormatStringWithListValues( $values['blocked_ips'] );
+
                 // Save the config
                 YDWeblogSaveConfig( $values );
 
@@ -171,6 +176,7 @@
             $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     '' );
             $config['dflt_allow_comments']  = YDConfig::get( 'dflt_allow_comments',  true );
             $config['dflt_is_draft']        = YDConfig::get( 'dflt_is_draft',        false );
+            $config['blocked_ips']          = YDConfig::get( 'blocked_ips',          YDFormatStringWithListValues( '' ) );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-30 14:39:46 UTC (rev 2052)
@@ -141,6 +141,16 @@
             <td class="adminRowL" width="400">{$config.max_syndicated_items}</td>
         </tr>
     </table>
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+        <tr><td colspan="3">&nbsp;</td></tr>
+        <tr>
+            <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
+        </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL" width="300">{t w="cfg_blocked_ips"}</td>
+            <td class="adminRowL" width="400">{$config.blocked_ips|default:'-'|replace:', ':'<br/>'}</td>
+        </tr>
+    </table>
     <p><input type="button" class="button" onClick="window.location='{$YD_SELF_SCRIPT}?do=edit';" value="{t w="change_config"}" />
 {/if}
 
@@ -271,6 +281,16 @@
                 <td class="adminRowL" width="400">{$form.max_syndicated_items.html}</td>
             </tr>
         </table>
+        <table width="700" cellspacing="0" cellpadding="0" border="0">
+            <tr><td colspan="3">&nbsp;</td></tr>
+            <tr>
+                <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_spam_protection"}</th>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{$form.blocked_ips.label_html}</td>
+                <td class="adminRowL" width="400">{$form.blocked_ips.html}</td>
+            </tr>
+        </table>
         <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}
 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/manage/manage.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-08-30 13:20:45 UTC (rev 2051)
+++ YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-08-30 14:39:46 UTC (rev 2052)
@@ -90,6 +90,11 @@
     line-height: 14pt;
 }
 
+textarea.tfMNoMce {
+    width: 400px;
+    height: 100px;
+}
+
 td.bbtoolbar {
 	background: url(images/nav-bg-editor.gif);
 }



From pclaerhout at mail.berlios.de  Wed Aug 30 16:42:14 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 16:42:14 +0200
Subject: [ydf-devel] r2053 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200608301442.k7UEgEaP003212@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 16:42:14 +0200 (Wed, 30 Aug 2006)
New Revision: 2053

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
Log:
Fixed a silly bug that would prevent the website from showing up if no blocked IP addresses are specified.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-30 14:39:46 UTC (rev 2052)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-08-30 14:42:14 UTC (rev 2053)
@@ -54,13 +54,15 @@
     YDInclude( YD_DIR_HOME . '/3rdparty/smarty/libs/plugins/modifier.truncate.php' );
 
     // Check for blocked IP addresses
-    $blocked_ips = YDConfig::get( 'blocked_ips', '' );
-    $blocked_ips = explode( ', ', YDFormatStringWithListValues( $blocked_ips ) );
+    $blocked_ips = YDFormatStringWithListValues( YDConfig::get( 'blocked_ips', '' ) );
 
     // Check if the current IP address is blocked or not
-    foreach ( $blocked_ips as $ip ) {
-        if ( YDStringUtil::match( $_SERVER['REMOTE_ADDR'], $ip ) ) {
-            die( 'IP address ' . $_SERVER['REMOTE_ADDR'] . ' is blocked.' );
+    if ( $blocked_ips != '' ) {
+        $blocked_ips = explode( ', ', $blocked_ips );
+        foreach ( $blocked_ips as $ip ) {
+            if ( YDStringUtil::match( $_SERVER['REMOTE_ADDR'], $ip ) ) {
+                die( 'IP address ' . $_SERVER['REMOTE_ADDR'] . ' is blocked.' );
+            }
         }
     }
 



From pclaerhout at mail.berlios.de  Wed Aug 30 16:44:36 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 30 Aug 2006 16:44:36 +0200
Subject: [ydf-devel] r2054 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200608301444.k7UEia6b003401@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-30 16:44:36 +0200 (Wed, 30 Aug 2006)
New Revision: 2054

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Fixed another bug in the function that formatted the list of blocked IP addresses.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-30 14:42:14 UTC (rev 2053)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-30 14:44:36 UTC (rev 2054)
@@ -100,7 +100,11 @@
         $string = str_replace( ';', ',', $string );
         $string = explode( ',', $string );
         foreach ( $string as $k=>$v ) {
-            $string[$k] = trim( $v );
+            if ( trim( $v ) == '' ) {
+                unset( $string[$k] );
+            } else {
+                $string[$k] = trim( $v );
+            }
         }
         return implode( ', ', $string );
     }



From pclaerhout at mail.berlios.de  Thu Aug 31 11:18:01 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 11:18:01 +0200
Subject: [ydf-devel] r2055 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200608310918.k7V9I1hC012415@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 11:17:44 +0200 (Thu, 31 Aug 2006)
New Revision: 2055

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Added a fix where if you are running PHP as CGI, it would sometimes fail to determine the class name of the class that is currently executed.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-08-30 14:44:36 UTC (rev 2054)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-08-31 09:17:44 UTC (rev 2055)
@@ -59,6 +59,9 @@
     @define( 'YD_FW_HOMEPAGE', 'http://ydframework.berlios.de/' );
     @define( 'YD_FW_COPYRIGHT', '(c) 2002-2006 Pieter Claerhout, pieter at yellowduck.be' );
 
+    // Server constants
+    @define( 'YD_SERVER_API', php_sapi_name() );
+
     // Directory paths
     @define( 'YD_DIR_HOME', dirname( __FILE__ ) );
     @define( 'YD_DIR_HOME_CLS', YD_DIR_HOME . '/YDClasses' );
@@ -67,7 +70,7 @@
 
     // File and URL constants
     @define( 'YD_SELF_SCRIPT', $_SERVER['PHP_SELF'] );
-    if ( ! isset( $_SERVER['SCRIPT_FILENAME'] ) ) {
+    if ( ! isset( $_SERVER['SCRIPT_FILENAME'] ) || substr( YD_SERVER_API, 0, 3 ) == 'cgi' ) {
         $_SERVER['SCRIPT_FILENAME'] = $_SERVER['PATH_TRANSLATED'];
     }
     @define( 'YD_SELF_FILE', $_SERVER['SCRIPT_FILENAME'] );



From pclaerhout at mail.berlios.de  Thu Aug 31 16:11:55 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 16:11:55 +0200
Subject: [ydf-devel] r2056 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200608311411.k7VEBtEJ003782@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 16:11:55 +0200 (Thu, 31 Aug 2006)
New Revision: 2056

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
Log:
Added some more features and fixes to YDDatabaseMetaData:
- All return values are now in lowercase
- There is a new function YDDatabaseMetaData::tableExists

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-08-31 09:17:44 UTC (rev 2055)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2006-08-31 14:11:55 UTC (rev 2056)
@@ -65,7 +65,6 @@
                 case 'mysql':
                     $sql = 'show tables from ' . $this->db->getDatabase();
                     $tables = $this->db->getValuesByName( $sql, 'tables_in_' . $this->db->getDatabase() );
-                    $tables = array_map( 'strtolower', $tables );
                     break;
 
                 // PostgreSQL
@@ -94,6 +93,9 @@
 
             }
 
+            // Convert the table names to lowercase
+            $tables = array_map( 'strtolower', $tables );
+
             // Return the list of tables
             return $tables;
 
@@ -121,7 +123,6 @@
                 case 'mysql':
                     $sql = 'SHOW FIELDS FROM ' . $table;
                     $fields = $this->db->getValuesByName( $sql, 'field' );
-                    $fields = array_map( 'strtolower', $fields );
                     break;
 
                 // PostgreSQL
@@ -151,6 +152,9 @@
 
             }
 
+            // Convert the fields to lowercase
+            $fields = array_map( 'strtolower', $fields );
+
             // Return the list of tables
             return $fields;
 
@@ -178,7 +182,6 @@
                 case 'mysql':
                     $sql = 'SHOW KEYS FROM ' . $table;
                     $indexes = $this->db->getValuesByName( $sql, 'key_name' );
-                    $indexes = array_map( 'strtolower', $indexes );
                     break;
 
                 // PostgreSQL
@@ -213,12 +216,28 @@
 
             }
 
+            // Convert the list of indexes to lowercase
+            $indexes = array_map( 'strtolower', $indexes );
+
             // Return the list of tables
             return $indexes;
 
         }
 
         /**
+         *  Checks if the specified table exists or not.
+         *
+         *  @param  $table  Name of the table
+         *
+         *  @return Boolean indicating if the table exists or not.
+         */
+        function tableExists( $table ) {
+            $table = strtolower( $this->_prefixTable( $table ) );
+            $tables = $this->getTables();
+            return in_array( $table, $tables );
+        }
+
+        /**
          *  Internal function to update the table name with the prefix
          *
          *  @param $table   The name of the table



From pclaerhout at mail.berlios.de  Thu Aug 31 16:21:24 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 16:21:24 +0200
Subject: [ydf-devel] r2057 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200608311421.k7VELOju004523@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 16:21:24 +0200 (Thu, 31 Aug 2006)
New Revision: 2057

Removed:
   YDFramework2.0/trunk/examples/weblog/include/dbupdates/
   YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
   YDFramework2.0/trunk/examples/weblog/manage/autoupdate.tpl
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
Log:
Removed the auto update functionality and replaced it by a smarter way of updating. The only thing that now needs to happen to update the software is to update the files and access the site.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -126,50 +126,90 @@
             );
 
             // Get a link to the database metadata
-            $dbmeta = new YDDatabaseMetaData( $this->db );
+            $this->dbmeta = new YDDatabaseMetaData( $this->db );
 
-            // Add any missing comments fields
-            $fields = $dbmeta->getFields( '#_comments' );
-            $this->executeIfMissing( 'useragent', $fields, 'ALTER TABLE #_comments ADD useragent varchar(255) AFTER userip' );
-            $this->executeIfMissing( 'userrequrl', $fields, 'ALTER TABLE #_comments ADD userrequrl varchar(255) AFTER useragent' );
+            // Upgrade the schema if needed
+            $this->upgradeSchemaIfNeeded();
 
-            // Add any missing items fields
-            $fields = $dbmeta->getFields( '#_items' );
-            $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
-            $this->executeIfMissing( 'allow_comments', $fields, 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
-            $this->executeIfMissing( 'auto_close', $fields, 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
-            $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
+            // Auto close the old items
+            $this->autoCloseOldItems();
 
-            // Add any missing pages field
-            $fields = $dbmeta->getFields( '#_pages' );
-            $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
+        }
 
-            // Get the list of indexes for the items table
-            $indexes = $dbmeta->getIndexes( '#_items' );
-            $this->executeIfMissing( 'allow_comments', $indexes, 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
-            $this->executeIfMissing( 'auto_close', $indexes, 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
-            $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
+        // Get the schema version
+        function getSchemaVersion() {
 
-            // Get the list of indexes for the pages table
-            $indexes = $dbmeta->getIndexes( '#_pages' );
-            $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_pages ADD INDEX is_draft (is_draft)' );
+            // Check if the schema version table exists
+            $tables = $this->dbmeta->getTables();
 
-            // Get the list of indexes for the users table
-            $indexes = $dbmeta->getIndexes( '#_users' );
-            $this->executeIfPresent( 'email', $indexes, 'ALTER TABLE #_users DROP INDEX email' );
-            $this->executeIfMissing( 'name',  $indexes, 'ALTER TABLE #_users ADD UNIQUE name (name)' );
+            // Create the schemaversion table if it doesn't exists
+            if ( ! $this->dbmeta->tableExists( '#_schemaversion' ) ) {
+                $sql = 'CREATE TABLE #_schemaversion (installed TIMESTAMP, version INT (11))';
+                $this->db->executeSql( $sql );
+            }
 
-            // Auto close the old items if needed
-            $auto_close_items = YDConfig::get( 'auto_close_items', '' );
-            if ( $auto_close_items != '' && is_numeric( $auto_close_items ) ) {
+            // Check the schema version
+            $schema_version = $this->db->getRecord( 'select version from #_schemaversion order by installed desc' );
 
-                // Calculate the treshold
-                $treshold = time() - ( $auto_close_items * 86400 );
+            // Return the schema version
+            return ( $schema_version === false  ) ? 0 : intval( $schema_version );
 
-                // Close the items
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1 WHERE auto_close = 1' );
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE auto_close = 1 AND created < ' . $treshold );
+        }
 
+        // Function to set the schema version
+        function setSchemaVersion( $version ) {
+            $values = array();
+            $values['installed'] = time();
+            $values['version'] = $version;
+            $this->db->executeInsert( '#_schemaversion', $values );
+        }
+
+        // Upgrade the schema if needed
+        function upgradeSchemaIfNeeded() {
+
+            // The current weblog schema version
+            $current_schema = 1;
+
+            // Get the schema version
+            $installed_schema = $this->getSchemaVersion();
+
+            // Check if we have the required schema version
+            if ( $installed_schema < $current_schema ) {
+
+                // Add any missing comments fields
+                $fields = $this->dbmeta->getFields( '#_comments' );
+                $this->executeIfMissing( 'useragent', $fields, 'ALTER TABLE #_comments ADD useragent varchar(255) AFTER userip' );
+                $this->executeIfMissing( 'userrequrl', $fields, 'ALTER TABLE #_comments ADD userrequrl varchar(255) AFTER useragent' );
+
+                // Add any missing items fields
+                $fields = $this->dbmeta->getFields( '#_items' );
+                $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
+                $this->executeIfMissing( 'allow_comments', $fields, 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
+                $this->executeIfMissing( 'auto_close', $fields, 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
+                $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
+
+                // Add any missing pages field
+                $fields = $this->dbmeta->getFields( '#_pages' );
+                $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
+
+                // Get the list of indexes for the items table
+                $indexes = $this->dbmeta->getIndexes( '#_items' );
+                $this->executeIfMissing( 'allow_comments', $indexes, 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
+                $this->executeIfMissing( 'auto_close', $indexes, 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
+                $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
+
+                // Get the list of indexes for the pages table
+                $indexes = $this->dbmeta->getIndexes( '#_pages' );
+                $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_pages ADD INDEX is_draft (is_draft)' );
+
+                // Get the list of indexes for the users table
+                $indexes = $this->dbmeta->getIndexes( '#_users' );
+                $this->executeIfPresent( 'email', $indexes, 'ALTER TABLE #_users DROP INDEX email' );
+                $this->executeIfMissing( 'name',  $indexes, 'ALTER TABLE #_users ADD UNIQUE name (name)' );
+
+                // Update the schema information
+                $this->setSchemaVersion( $current_schema );
+
             }
 
         }
@@ -188,6 +228,24 @@
             }
         }
 
+        // Function to auto close old items
+        function autoCloseOldItems() {
+
+            // Auto close the old items if needed
+            $auto_close_items = YDConfig::get( 'auto_close_items', '' );
+            if ( $auto_close_items != '' && is_numeric( $auto_close_items ) ) {
+
+                // Calculate the treshold
+                $treshold = time() - ( $auto_close_items * 86400 );
+
+                // Close the items
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1 WHERE auto_close = 1' );
+                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE auto_close = 1 AND created < ' . $treshold );
+
+            }
+
+        }
+
         // Function to log a request to the statistics
         function logRequestToStats( $values ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -357,7 +357,6 @@
             $this->tpl->assign( 'weblog_language',    YDConfig::get( 'weblog_language', 'en' ) );
             $this->tpl->assign( 'google_analytics',   YDConfig::get( 'google_analytics', '' ) != '' );
             $this->tpl->assign( 'keep_stats',         YDConfig::get( 'keep_stats', true ) );
-            $this->tpl->assign( 'use_auto_update',    YDConfig::get( 'use_auto_update',  true ) );
 
             // Get the link to the different directories
             $uploads_dir = YDUrl::makeLinkAbsolute( '../' . $this->dir_uploads );

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -292,7 +292,6 @@
 $GLOBALS['t']['cfg_weblog_google_analytics'] = 'Google Analytics Account';
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
-$GLOBALS['t']['cfg_use_auto_update'] = 'Enable Auto Update';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
 
 // manage/item.tpl

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -288,7 +288,6 @@
 $GLOBALS['t']['cfg_weblog_google_analytics'] = 'Compte Google Analytics';
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Statistiques de tra&ccedil;age';
-$GLOBALS['t']['cfg_use_auto_update'] = 'Activer Auto Update';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Titre de l\'entr&eacute;e';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -292,7 +292,6 @@
 $GLOBALS['t']['cfg_weblog_google_analytics'] = 'Google Analytics Account';
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
-$GLOBALS['t']['cfg_use_auto_update'] = 'Activeer Auto Update';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
 
 // manage/item.tpl

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-31 14:21:24 UTC (rev 2057)
@@ -135,9 +135,6 @@
                 <tr>
                     <td class="adminRowL">
                         <b>{t w="h_diagtools"}</b><br/>
-                        {if $use_auto_update}
-                            &raquo; <a href="autoupdate.php">{t w="a_version_info"}</a><br/>
-                        {/if}
                         &raquo; <a href="serverinfo.php">{t w="a_server_info"}</a><br/>
                     </td>
                 </tr>

Deleted: YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/manage/autoupdate.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -1,387 +0,0 @@
-<?php
-
-    // Standard include
-    include_once( dirname( __FILE__ ) . '/../include/YDWeblog_init.php' );
-
-    // We don't limit the execution time
-    set_time_limit( 0 );
-
-    // Includes
-    YDInclude( 'YDRequest.php' );
-    YDInclude( 'YDFileSystem.php' );
-    YDInclude( 'YDUrl.php' );
-
-    // Config setting
-    YDConfig::set( 'updateDbUrl',   'http://ydframework.berlios.de/weblog_updater.php' );
-    YDConfig::set( 'currentBranch', '/YDFramework2.0/trunk/' );
-    YDConfig::set( 'chkoutUrl',     'http://svn.berlios.de/viewcvs/*checkout*/ydframework' );
-
-    // Logger class
-    class YDUpdateLog {
-
-        // Flush a message to the browser
-        function flushMsg( $msg, $fatal ) {
-            echo( $msg . '<br/>' . YD_CRLF );
-            @ob_flush();
-            @flush();
-            if ( $fatal ) {
-                die();
-            }
-        }
-
-        // Log an info message
-        function info( $msg, $fatal=false ) {
-            YDUpdateLog::flushMsg( '<font color="#009900">[ INFO    ] ' . $msg . '</font>', $fatal );
-        }
-
-        // Log an warning message
-        function warning( $msg, $fatal=false ) {
-            YDUpdateLog::flushMsg( '<font color="#FF9900">[ WARNING ] ' . $msg . '</font>', $fatal );
-        }
-
-        // Log an error message
-        function error( $msg, $fatal=true ) {
-            if ( $fatal ) {
-                die( '</p><p class="title">' . $msg . '</p>' );
-            } else {
-                YDUpdateLog::flushMsg( '<font color="#CC0000">[ ERROR   ] ' . $msg . '</font>', $fatal );
-            }
-        }
-
-    }
-
-    // Update database class
-    class YDUpdateDB {
-
-        // Class constructor
-        function YDUpdateDB() {
-            $url = new YDUrl( YDConfig::get( 'updateDbUrl' ) . '?revision=' . YD_FW_REVISION );
-            $this->changes = @ $url->getContents( false, false );
-            if ( ! $this->changes ) {
-                YDUpdateLog::error( 'Failed to connect to the update server.' );
-            }
-            if ( @ unserialize( base64_decode( $this->changes ) ) === false ) {
-                YDUpdateLog::error( 'Invalid contents retrieved from the update server' );
-            }
-            $this->changes = unserialize( base64_decode( $this->changes ) );
-        }
-
-        // Function to check if there are updates
-        function hasUpdates() {
-            return ( sizeof( $this->changes ) == 0 ) ? false : true;
-        }
-
-        // Function to check if a file is updated
-        function isUpdated( $file ) {
-            $changes = $this->getChangedFiles();
-            return array_key_exists( YDUpdateTools::fullPath( $file ), $changes );
-        }
-
-        // Get the last revision
-        function getLastRevision() {
-            $revisions = array_keys( $this->changes );
-            return array_shift( $revisions );
-        }
-
-        // Get the list of changed files
-        function getChangedFiles() {
-            $changes_reversed = array_reverse( $this->changes );
-            $changed_files = array();
-            foreach ( $changes_reversed as $change ) {
-                foreach ( $change['files'] as $file ) {
-                    if ( $file[1] != YDConfig::get( 'currentBranch' ) . 'examples/weblog/install.php' ) {
-                        $changed_files[ $file[1] ] = $file[0];
-                    }
-                }
-            }
-            ksort( $changed_files );
-            return $changed_files;
-        }
-
-        // Download an update file
-        function downloadFile( $file ) {
-            YDUpdateLog::info( 'Downloading: ' . YDUpdateTools::shortPath( $file ) );
-            $url = new YDUrl( YDConfig::get( 'chkoutUrl' ) . $file );
-            $data = $url->getContents( false );
-            if ( strpos( $data, 'Index of' ) === false ) {
-                $f = new YDFSFile( YDUpdateTools::tempPath( $file ), true );
-                $f->setContents( $data );
-            }
-        }
-
-        // Save the new version number
-        function saveVersionNumber() {
-            YDUpdateLog::info( 'Recording the new version number...' );
-            YDUpdateTools::replaceInFile(
-                '%YD_FW_HOME%/YDF2_init.php',
-                '@define( \'YD_FW_REVISION\', \'' . YD_FW_REVISION . '\' );',
-                '@define( \'YD_FW_REVISION\', \'' . $this->getLastRevision() . '\' );'
-            );
-            YDUpdateTools::replaceInFile(
-                '%YD_FW_HOME%/YDF2_init.php',
-                '@define( \'YD_FW_REVISION\', \'unknown\' );',
-                '@define( \'YD_FW_REVISION\', \'' . $this->getLastRevision() . '\' );'
-            );
-        }
-
-    }
-
-    // Update tools
-    class YDUpdateTools {
-
-        // Function to fix the path of the file
-        function shortPath( $path ) {
-            $path = str_replace( YDConfig::get( 'currentBranch' ), '', $path );
-            $path = str_replace( 'YDFramework2', '%YD_FW_HOME%', $path );
-            $path = str_replace( 'examples/weblog', '%YD_WEBLOG_HOME%', $path );
-            return $path;
-        }
-
-        // Function to get the full path of a file
-        function fullPath( $path ) {
-            $path = str_replace( '%YD_FW_HOME%', 'YDFramework2', $path );
-            $path = str_replace( '%YD_WEBLOG_HOME%', 'examples/weblog', $path );
-            return YDConfig::get( 'currentBranch' ) . $path;
-        }
-
-        // Convert to a real path
-        function realPath( $path ) {
-            $path = YDUpdateTools::shortPath( $path );
-            $path = str_replace( '%YD_FW_HOME%', YD_DIR_HOME, $path );
-            $path = str_replace( '%YD_WEBLOG_HOME%', dirname( dirname( __FILE__ ) ), $path );
-            if ( realpath( $path ) !== false ) {
-                $path = realpath( $path );
-            }
-            return $path;
-        }
-        
-        // Convert to a temporary path
-        function tempPath( $path ) {
-            return YDPath::join( YD_DIR_TEMP, 'YDF_U_' . md5( $path ) . '.upd' );
-        }
-
-        // Install a file
-        function installFile( $file, $action ) {
-            YDUpdateLog::info( 'Installing [' . $action . ']: ' . YDUpdateTools::shortPath( $file ) );
-            if ( $action == 'D' ) {
-                @unlink( YDUpdateTools::realPath( $file ) );
-            } elseif ( $action == 'A' ) {
-                @copy( YDUpdateTools::tempPath( $file ), YDUpdateTools::realPath( $file ) );
-            } else {
-                if ( file_exists( YDUpdateTools::realPath( $file ) ) ) {
-                    @copy( YDUpdateTools::tempPath( $file ), YDUpdateTools::realPath( $file ) );
-                } else {
-                    YDUpdateLog::warning( 'Skipped: ' . YDUpdateTools::shortPath( $file ) . ' (not installed)' );
-                }
-            }
-        }
-
-        // Function to search and replace in a file
-        function replaceInFile( $file, $search, $replace ) {
-            YDUpdateLog::info( 'Updating file: ' . YDUpdateTools::shortPath( $file ) );
-            $file = new YDFSFile( YDUpdateTools::realPath( $file ) );
-            $data = $file->getContents();
-            $data = str_replace( $search, $replace, $data );
-            $file->setContents( $data );
-        }
-
-    }
-
-    // Class with database tools
-    class YDDatabaseTools {
-
-        // Function to get a connection
-        function getConnection() {
-            $weblog = new YDWeblogAPI();
-            return $weblog->db;
-        }
-
-        // Check if a database table exists
-        function tableExists( $table ) {
-            $db = YDDatabaseTools::getConnection();
-            $tables = $db->getValuesByName( 'show tables', 'tables_in_' . $db->_db );
-            return in_array( YDConfig::get( 'db_prefix', '' ) . 'locked', $tables );
-        }
-
-
-        // Check the locking of the database
-        function checkLockDb() {
-            $db = YDDatabaseTools::getConnection();
-            if ( YDDatabaseTools::tableExists( $db, 'locked' ) ) {
-                YDUpdateLog::error( 'Another update is already in progress!' );
-            }
-        }
-
-        // Lock the database
-        function lockDb() {
-            YDUpdateLog::warning( 'Locking the weblog application...' );
-            $db = YDDatabaseTools::getConnection();
-            $db->executeSql( 'CREATE TABLE ' . YDConfig::get( 'db_prefix', '' ) . 'locked ( id int(3) )' );
-        }
-
-        // Lock the database
-        function unlockDb() {
-            YDUpdateLog::warning( 'Unlocking the weblog application...' );
-            $db = YDDatabaseTools::getConnection();
-            $db->executeSql( 'DROP TABLE IF EXISTS ' . YDConfig::get( 'db_prefix', '' ) . 'locked' );
-        }
-
-        // Install database update
-        function installDbUpdate( $file ) {
-            $update_name = YDPath::getFileNameWithoutExtension( $file );
-            YDUpdateLog::info( 'Performing database update: ' . $update_name );
-            YDInclude( YDUpdateTools::realPath( $file ) );
-            $db = YDDatabaseTools::getConnection();
-            $update_inst = new $update_name( $db );
-            $update_inst->update();
-        }
-
-    }
-
-    // Class definition
-    class autoupdate extends YDWeblogAdminRequest {
-
-        // Class constructor
-        function autoupdate() {
-
-            // Initialize the parent
-            $this->YDWeblogAdminRequest();
-
-            // Check if we log statistics or not
-            if ( ! YDConfig::get( 'use_auto_update', true ) ) {
-                $this->redirect();
-            }
-
-            // The default action
-            if ( $this->getActionName() != 'default' ) {
-
-                // Show as plain text
-                echo( '<html><head><title>YDWeblog Automatic Updater</title></head>' );
-                echo( '<link rel="stylesheet" type="text/css" href="manage.css" />' );
-                echo( '<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0"><p>' );
-
-                // Check if we can determine the installed version
-                if ( ! is_numeric( YD_FW_REVISION ) ) {
-                    YDUpdateLog::error( 'Failed to determine installed version number' );
-                }
-
-                // Instantiate the update database
-                YDUpdateLog::info( 'Getting the list of updates...' );
-                $this->updateDb = new YDUpdateDB();
-
-                // Stop if the software is up to date
-                if ( ! $this->updateDb->hasUpdates() ) {
-                    YDUpdateLog::error( 'There are no new updates available', true );
-                }
-
-                // Get the latest revision
-                YDUpdateLog::info( 'Installed version: ' . YD_FW_REVISION );
-                YDUpdateLog::info( 'Latest released version: ' . $this->updateDb->getLastRevision() );
-
-                // Get the list of changed files
-                $this->changed_files = $this->updateDb->getChangedFiles();
-
-                // Show how many files needs changing
-                YDUpdateLog::info( 'Found ' . sizeof( $this->changed_files ) . ' changed file(s)' );
-
-            }
-
-        }
-
-        // Default action
-        function actionDefault() {
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // Check for updates action
-        function actionCheck() {
-
-            // Show the changed files
-            foreach ( $this->changed_files as $file=>$action ) {
-                YDUpdateLog::info( '[' . $action . '] ' . YDUpdateTools::shortPath( $file ) );
-            }
-
-            // Show a message
-            YDUpdateLog::warning( '<b>Your software needs to be updated</b>' );
-
-            // Confirm the update
-            echo( '</pre><p class="title"><a href="' . YD_SELF_SCRIPT . '?do=update">Click here to update the software</a></p>' );
-
-        }
-
-        // Perform the actual update
-        function actionUpdate() {
-
-            // Check if a software update is going on
-            YDDatabaseTools::checkLockDb();
-
-            // Download the needed files
-            foreach ( $this->changed_files as $file=>$action ) {
-                if ( $action != 'D' ) {
-                    $this->updateDb->downloadFile( $file );
-                }
-            }
-
-            // Lock the weblog application
-            YDDatabaseTools::lockDb();
-
-            // Install the new files
-            foreach ( $this->changed_files as $file=>$action ) {
-                YDUpdateTools::installFile( $file, $action );
-            }
-
-            // Update the init file
-            if ( $this->updateDb->isUpdated( '%YD_WEBLOG_HOME%/include/YDWeblog_init.php' ) ) {
-                YDUpdateTools::replaceInFile(
-                    '%YD_WEBLOG_HOME%/include/YDWeblog_init.php',
-                    '\'/../../../YDFramework2/YDF2_init.php\' );',
-                    '\'/YDFramework2/YDF2_init.php\' );'
-                );
-            }
-
-            // Update the database if needed
-            foreach ( $this->changed_files as $file=>$action ) {
-                if ( YDStringUtil::startsWith( YDUpdateTools::shortPath( $file ), '%YD_WEBLOG_HOME%/include/dbupdates/' ) ) {
-                    YDDatabaseTools::installDbUpdate( $file );
-                }
-            }
-
-            // Save the new version number
-            $this->updateDb->saveVersionNumber();
-
-            // Unlock the weblog application
-            YDDatabaseTools::unlockDb();
-
-            // Delete the downloaded files
-            YDUpdateLog::info( 'Cleaning up the file downloads...' );
-            foreach ( $this->changed_files as $file=>$action ) {
-                @unlink( YDUpdateTools::tempPath( $file ) );
-            }
-
-            // Clear the weblog cache
-            YDUpdateLog::info( 'Clearing the weblog cache...' );
-            $cachePatterns = array(
-                YD_WEBLOG_CACHE_PREFIX . '*.' . YD_WEBLOG_CACHE_SUFFIX, YD_TMP_PRE . 'N_*.*', '*.wch', '*.tpl.php', YD_TMP_PRE . 'U_*.upd'
-            );
-            $dir = new YDFSDirectory( YD_DIR_TEMP );
-            foreach ( $cachePatterns as $pattern ) {
-                $filesToDelete = $dir->getContents( $pattern, null );
-                foreach ( $filesToDelete as $file ) {
-                    @unlink( $file->getAbsolutePath() );
-                }
-            }
-
-            // Show a message
-            echo( '</p><p class="title">Software is now updated to version ' . $this->updateDb->getLastRevision() . '</p>' );
-
-        }
-
-    }
-
-    // Process the request
-    YDInclude( 'YDF2_process.php' );
-
-?>

Deleted: YDFramework2.0/trunk/examples/weblog/manage/autoupdate.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/autoupdate.tpl	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/manage/autoupdate.tpl	2006-08-31 14:21:24 UTC (rev 2057)
@@ -1,14 +0,0 @@
-{include file="__mng_header.tpl"}
-
-<p class="title">{t w="a_admin_home"} &raquo; {t w="a_version_info"}</p>
-
-<table width="700" cellspacing="0" cellpadding="0" border="0">
-    <tr>
-        <th class="adminRowLG" colspan="2">&raquo; {t w="version_check"}</th>
-    </tr>
-    <tr>
-        <td class="adminRowL"><iframe src="{$YD_SELF_SCRIPT}?do=check" width="100%" height="1600" scrolling="auto" frameborder="0" /></td>
-    </tr>
-</table>
-
-{include file="__mng_footer.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-31 14:21:24 UTC (rev 2057)
@@ -26,7 +26,6 @@
             // Fix the boolean values
             $config['email_new_comment']   = ( $config['email_new_comment'] ) ? t('yes') : t('no');
             $config['email_new_item']      = ( $config['email_new_item'] ) ? t('yes') : t('no');
-            $config['use_auto_update']     = ( $config['use_auto_update'] ) ? t('yes') : t('no');
             $config['keep_stats']          = ( $config['keep_stats'] ) ? t('yes') : t('no');
             $config['use_cache']           = ( $config['use_cache'] ) ? t('yes') : t('no');
             $config['friendly_urls']       = ( $config['friendly_urls'] ) ? t('yes') : t('no');
@@ -82,7 +81,6 @@
             $form->addElement( 'select', 'weblog_skin', t( 'cfg_weblog_skin' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $skins );
             $form->addElement( 'select', 'weblog_language', t( 'cfg_weblog_language' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $languages );
             $form->addElement( 'checkbox', 'include_debug_info', t( 'cfg_include_debug_info' ), array( 'style' => 'border: none;' ) );
-            $form->addElement( 'checkbox', 'use_auto_update', t( 'cfg_use_auto_update' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'checkbox', 'keep_stats', t( 'cfg_keep_stats' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'google_analytics', t( 'cfg_weblog_google_analytics' ), array( 'class' => 'tfM' ) );
 
@@ -164,7 +162,6 @@
             $config['weblog_entries_fp']    = YDConfig::get( 'weblog_entries_fp',    1 );
             $config['weblog_skin']          = YDConfig::get( 'weblog_skin',          'default' );
             $config['weblog_language']      = YDConfig::get( 'weblog_language',      'nl' );
-            $config['use_auto_update']      = YDConfig::get( 'use_auto_update',      true );
             $config['keep_stats']           = YDConfig::get( 'keep_stats',           true );
             $config['google_analytics']     = YDConfig::get( 'google_analytics',     '' );
             $config['include_debug_info']   = YDConfig::get( 'include_debug_info',   false );

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 14:11:55 UTC (rev 2056)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 14:21:24 UTC (rev 2057)
@@ -77,10 +77,6 @@
             <td class="adminRowL">{$config.include_debug_info}</td>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="cfg_use_auto_update"}</td>
-            <td class="adminRowL">{$config.use_auto_update}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_keep_stats"}</td>
             <td class="adminRowL">{$config.keep_stats}</td>
         </tr>
@@ -217,10 +213,6 @@
                 <td class="adminRowL">{$form.include_debug_info.html}</td>
             </tr>
             <tr>
-                <td class="adminRowL">{$form.use_auto_update.label_html}</td>
-                <td class="adminRowL">{$form.use_auto_update.html}</td>
-            </tr>
-            <tr>
                 <td class="adminRowL">{$form.keep_stats.label_html}</td>
                 <td class="adminRowL">{$form.keep_stats.html}</td>
             </tr>



From pclaerhout at mail.berlios.de  Thu Aug 31 16:26:10 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 16:26:10 +0200
Subject: [ydf-devel] r2058 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608311426.k7VEQAQA005122@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 16:26:10 +0200 (Thu, 31 Aug 2006)
New Revision: 2058

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
Log:
Fixed the way the defaults are shown in the config screen.

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 14:21:24 UTC (rev 2057)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 14:26:10 UTC (rev 2058)
@@ -36,11 +36,11 @@
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_db_pass"}</td>
-            <td class="adminRowL">{$config.db_pass|default:'&nbsp;'}</td>
+            <td class="adminRowL">{$config.db_pass|default:'-'}</td>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_db_prefix"}</td>
-            <td class="adminRowL">{$config.db_prefix|default:'&nbsp;'}</td>
+            <td class="adminRowL">{$config.db_prefix|default:'-'}</td>
         </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">
@@ -54,7 +54,7 @@
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_weblog_description"}</td>
-            <td class="adminRowL">{$config.weblog_description}</td>
+            <td class="adminRowL">{$config.weblog_description|default:'-'}</td>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_weblog_entries_fp"}</td>
@@ -82,7 +82,7 @@
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_weblog_google_analytics"}</td>
-            <td class="adminRowL">{$config.google_analytics|default:'&nbsp;'}</td>
+            <td class="adminRowL">{$config.google_analytics|default:'-'}</td>
         </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">



From pclaerhout at mail.berlios.de  Thu Aug 31 17:19:08 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 17:19:08 +0200
Subject: [ydf-devel] r2059 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200608311519.k7VFJ8qN011863@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 17:19:03 +0200 (Thu, 31 Aug 2006)
New Revision: 2059

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
Log:
The server info screen now lists the schema version.

The schema version now also has the int column type for the installed field.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 14:26:10 UTC (rev 2058)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 15:19:03 UTC (rev 2059)
@@ -144,18 +144,24 @@
 
             // Create the schemaversion table if it doesn't exists
             if ( ! $this->dbmeta->tableExists( '#_schemaversion' ) ) {
-                $sql = 'CREATE TABLE #_schemaversion (installed TIMESTAMP, version INT (11))';
+                $sql = 'CREATE TABLE #_schemaversion (installed INT(11), version INT (11))';
                 $this->db->executeSql( $sql );
             }
 
             // Check the schema version
-            $schema_version = $this->db->getRecord( 'select version from #_schemaversion order by installed desc' );
+            $schema_version = $this->db->getValue( 'select version from #_schemaversion order by installed desc' );
 
             // Return the schema version
             return ( $schema_version === false  ) ? 0 : intval( $schema_version );
 
         }
 
+        // Get the full schema information
+        function getFullSchemaVersion() {
+            $this->getSchemaVersion();
+            return $this->db->getRecord( 'select installed, version from #_schemaversion order by installed desc' );
+        }
+
         // Function to set the schema version
         function setSchemaVersion( $version ) {
             $values = array();
@@ -168,7 +174,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 1;
+            $current_schema = 2;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -207,6 +213,10 @@
                 $this->executeIfPresent( 'email', $indexes, 'ALTER TABLE #_users DROP INDEX email' );
                 $this->executeIfMissing( 'name',  $indexes, 'ALTER TABLE #_users ADD UNIQUE name (name)' );
 
+                // Fix the shemaversion table if needed
+                $this->db->executeSql( 'ALTER TABLE #_schemaversion CHANGE installed installed INT(11)' );
+                $this->db->executeSql( 'UPDATE #_schemaversion SET installed = unix_timestamp() WHERE installed = 0' );
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-31 14:26:10 UTC (rev 2058)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-08-31 15:19:03 UTC (rev 2059)
@@ -348,5 +348,7 @@
 $GLOBALS['t']['msg_correct_version'] = 'There are no newer versions available';
 $GLOBALS['t']['msg_install_update'] = 'Newer versions are available';
 $GLOBALS['t']['development_changelog'] = 'Development Changelog';
+$GLOBALS['t']['schema_version'] = 'Database schema version';
+$GLOBALS['t']['installed_on'] = 'installed on';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-31 14:26:10 UTC (rev 2058)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-08-31 15:19:03 UTC (rev 2059)
@@ -348,5 +348,7 @@
 $GLOBALS['t']['msg_correct_version'] = 'Er zijn geen nieuwere versies beschikbaar';
 $GLOBALS['t']['msg_install_update'] = 'Er zijn nieuwe versies beschikbaar';
 $GLOBALS['t']['development_changelog'] = 'Ontwikkel Logboek';
+$GLOBALS['t']['schema_version'] = 'Database schema versie';
+$GLOBALS['t']['installed_on'] = 'ge&iuml;nstalleerd op';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-08-31 14:26:10 UTC (rev 2058)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2006-08-31 15:19:03 UTC (rev 2059)
@@ -55,6 +55,7 @@
             $php_modules = implode( $php_modules, ', ' );
 
             // Get the other variables
+            $this->tpl->assign( 'schema_info',       $this->weblog->getFullSchemaVersion() );
             $this->tpl->assign( 'php_version',       phpversion() );
             $this->tpl->assign( 'mysql_version',     mysql_get_server_info() );
             $this->tpl->assign( 'php_modules',       $php_modules );

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-08-31 14:26:10 UTC (rev 2058)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-08-31 15:19:03 UTC (rev 2059)
@@ -45,6 +45,10 @@
         <td class="adminRowL" width="400">{$YD_FW_NAMEVERS}</td>
     </tr>
     <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+        <td class="adminRowL" width="300">{t w="schema_version"}</td>
+        <td class="adminRowL" width="400">{$schema_info.version} ({t w="installed_on"} {$schema_info.installed|date:"%d %B %Y"|lower})</td>
+    </tr>
+    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
         <td class="adminRowL">Smarty</td>
         <td class="adminRowL">Smarty {$smarty.version}</td>
     </tr>



From pclaerhout at mail.berlios.de  Thu Aug 31 17:31:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 17:31:37 +0200
Subject: [ydf-devel] r2060 - in YDFramework2.0/trunk/examples/weblog: .
	include manage skins/default skins/default_with_lightbox
Message-ID: <200608311531.k7VFVbn1012869@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 17:31:35 +0200 (Thu, 31 Aug 2006)
New Revision: 2060

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Removed the auto comment closer and allow comments from the items as they were not really useful.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-08-31 15:31:35 UTC (rev 2060)
@@ -21,15 +21,9 @@
         if ( ! isset( $values['max_syndicated_items'] ) ) {
             $values['max_syndicated_items'] = 20;
         }
-        if ( ! isset( $values['auto_close_items'] ) ) {
-            $values['auto_close_items'] = 45;
-        }
         if ( ! isset( $values['include_debug_info'] ) ) {
             $values['include_debug_info'] = 0;
         }
-        if ( ! isset( $values['dflt_allow_comments'] ) ) {
-            $values['dflt_allow_comments'] = true;
-        }
         if ( ! isset( $values['dflt_is_draft'] ) ) {
             $values['dflt_is_draft'] = false;
         }
@@ -131,9 +125,6 @@
             // Upgrade the schema if needed
             $this->upgradeSchemaIfNeeded();
 
-            // Auto close the old items
-            $this->autoCloseOldItems();
-
         }
 
         // Get the schema version
@@ -149,7 +140,7 @@
             }
 
             // Check the schema version
-            $schema_version = $this->db->getValue( 'select version from #_schemaversion order by installed desc' );
+            $schema_version = $this->db->getValue( 'select version from #_schemaversion order by installed desc, version desc' );
 
             // Return the schema version
             return ( $schema_version === false  ) ? 0 : intval( $schema_version );
@@ -159,7 +150,7 @@
         // Get the full schema information
         function getFullSchemaVersion() {
             $this->getSchemaVersion();
-            return $this->db->getRecord( 'select installed, version from #_schemaversion order by installed desc' );
+            return $this->db->getRecord( 'select installed, version from #_schemaversion order by installed desc, version desc' );
         }
 
         // Function to set the schema version
@@ -174,7 +165,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 2;
+            $current_schema = 3;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -190,9 +181,9 @@
                 // Add any missing items fields
                 $fields = $this->dbmeta->getFields( '#_items' );
                 $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
-                $this->executeIfMissing( 'allow_comments', $fields, 'ALTER TABLE #_items ADD allow_comments TINYINT(1) DEFAULT "1" NOT NULL AFTER num_comments' );
-                $this->executeIfMissing( 'auto_close', $fields, 'ALTER TABLE #_items ADD auto_close TINYINT(1) DEFAULT "1" NOT NULL AFTER allow_comments' );
                 $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
+                $this->executeIfPresent( 'allow_comments', $fields, 'ALTER TABLE #_items DROP allow_comments' );
+                $this->executeIfPresent( 'auto_close', $fields, 'ALTER TABLE #_items DROP auto_close' );
 
                 // Add any missing pages field
                 $fields = $this->dbmeta->getFields( '#_pages' );
@@ -200,8 +191,6 @@
 
                 // Get the list of indexes for the items table
                 $indexes = $this->dbmeta->getIndexes( '#_items' );
-                $this->executeIfMissing( 'allow_comments', $indexes, 'ALTER TABLE #_items ADD INDEX allow_comments (allow_comments)' );
-                $this->executeIfMissing( 'auto_close', $indexes, 'ALTER TABLE #_items ADD INDEX auto_close (auto_close)' );
                 $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
 
                 // Get the list of indexes for the pages table
@@ -217,6 +206,9 @@
                 $this->db->executeSql( 'ALTER TABLE #_schemaversion CHANGE installed installed INT(11)' );
                 $this->db->executeSql( 'UPDATE #_schemaversion SET installed = unix_timestamp() WHERE installed = 0' );
 
+                // Remove the auto close fields from the items
+
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 
@@ -238,24 +230,6 @@
             }
         }
 
-        // Function to auto close old items
-        function autoCloseOldItems() {
-
-            // Auto close the old items if needed
-            $auto_close_items = YDConfig::get( 'auto_close_items', '' );
-            if ( $auto_close_items != '' && is_numeric( $auto_close_items ) ) {
-
-                // Calculate the treshold
-                $treshold = time() - ( $auto_close_items * 86400 );
-
-                // Close the items
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=1 WHERE auto_close = 1' );
-                $this->db->executeSql( 'UPDATE #_items SET allow_comments=0 WHERE auto_close = 1 AND created < ' . $treshold );
-
-            }
-
-        }
-
         // Function to log a request to the statistics
         function logRequestToStats( $values ) {
 
@@ -406,7 +380,7 @@
         // Function to get the items of the weblog
         function getItems( $limit=-1, $offset=-1, $order='created desc, title', $where='' ) {
             $sql = 'SELECT i.id, i.category_id, i.title, i.body, i.body_more, i.num_comments, i.created, i.modified, '
-                 . 'i.allow_comments, i.auto_close, i.is_draft, '
+                 . 'i.is_draft, '
                  . 'c.title as category, u.email as user_email, u.name as user_name FROM #_items i, #_categories c, '
                  . '#_users u WHERE i.category_id = c.id AND i.user_id = u.id ';
             $sql = $this->_prepareQuery( $sql . $where, $order );

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-08-31 15:31:35 UTC (rev 2060)
@@ -47,125 +47,120 @@
             $this->tpl->assign( 'related_items', $related_items );
             $this->tpl->assign( 'comments', $comments );
 
-            // Only if comments are allowed
-            if ( $item['allow_comments'] == '1' ) {
+            // Create the comments form
+            $form = new YDWeblogForm(
+                'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
+            );
 
-                // Create the comments form
-                $form = new YDWeblogForm(
-                    'comments', 'POST', YDTplModLinkItemRespond( $item ), '_self', array( 'id' => 'commentform' )
-                );
+            // Add the fields
+            $form->addElement( 'text', 'username', t( 'name' ) );
+            $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
+            $form->addElement( 'text', 'userwebsite', t( 'website' ) );
+            $form->addElement( 'hidden', '_userspam', t('choose_no_spam'), array() );
+            $form->addElement( 'textarea', 'comment', '' );
+            $form->addElement(
+                'submit', 'cmdSubmit', t( 'submit_comment' ),
+                array(
+                    'id' => 'submit',
+                    'onClick' => 'this.document.getElementById(\'comments__userspam\').value = 3; return true;'
+                )
+            );
+            $form->addElement( 'hidden', 'item_id' );
 
-                // Add the fields
-                $form->addElement( 'text', 'username', t( 'name' ) );
-                $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
-                $form->addElement( 'text', 'userwebsite', t( 'website' ) );
-                $form->addElement( 'hidden', '_userspam', t('choose_no_spam'), array() );
-                $form->addElement( 'textarea', 'comment', '' );
-                $form->addElement(
-                    'submit', 'cmdSubmit', t( 'submit_comment' ),
-                    array(
-                        'id' => 'submit',
-                        'onClick' => 'this.document.getElementById(\'comments__userspam\').value = 3; return true;'
-                    )
-                );
-                $form->addElement( 'hidden', 'item_id' );
+            // Set the defaults
+            $defaults = array();
+            $defaults['item_id']     = $id;
+            $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
+            $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
+            $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
+            $defaults['_userspam']   = 1;
+            $form->setDefaults( $defaults );
 
-                // Set the defaults
-                $defaults = array();
-                $defaults['item_id']     = $id;
-                $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
-                $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
-                $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
-                $defaults['_userspam']   = 1;
-                $form->setDefaults( $defaults );
+            // Set the rules
+            $form->addRule( 'username',    'required',  t( 'err_name' ) );
+            $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
+            $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), 35 );
+            $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
+            $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
+            $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
+            $form->addRule( '_userspam',   'value',     t( 'err_userspam' ), '3' );
+            $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
-                // Set the rules
-                $form->addRule( 'username',    'required',  t( 'err_name' ) );
-                $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
-                $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), 35 );
-                $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
-                $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
-                $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
-                $form->addRule( '_userspam',   'value',     t( 'err_userspam' ), '3' );
-                $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
+            // Add the filters
+            $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
+            $form->addFilter( 'comment', 'safe_html' );
 
-                // Add the filters
-                $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );
-                $form->addFilter( 'comment', 'safe_html' );
+            // Process the form
+            if ( $form->validate() === true ) {
 
-                // Process the form
-                if ( $form->validate() === true ) {
+                // Get the form values
+                $values = $form->getValues();
 
-                    // Get the form values
-                    $values = $form->getValues();
+                // Simple spam protection
+                if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) === false ) {
+                    $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+                }
 
-                    // Simple spam protection
-                    if ( ! empty( $values['userwebsite'] ) && strpos( $values['userwebsite'], '.' ) === false ) {
-                        $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
-                    }
+                // Fix any faulty web addresses
+                if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
+                    $values['userwebsite'] = 'http://' . $values['userwebsite'];
+                }
 
-                    // Fix any faulty web addresses
-                    if ( ! empty( $values['userwebsite'] ) && substr( strtolower( $values['userwebsite'] ), 0, 7 ) != 'http://' ) {
-                        $values['userwebsite'] = 'http://' . $values['userwebsite'];
-                    }
+                // Save the username, useremail and userwebsite
+                setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
+                setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
+                setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
 
-                    // Save the username, useremail and userwebsite
-                    setcookie( 'YD_USER_NAME',    $values['username'],    time() + 31536000, '/' );
-                    setcookie( 'YD_USER_EMAIL',   $values['useremail'],   time() + 31536000, '/' );
-                    setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
+                // Add the values to the database
+                $comment_id = $this->weblog->addComment( $values );
 
-                    // Add the values to the database
-                    $comment_id = $this->weblog->addComment( $values );
+                // Send an email if configured
+                if ( $comment_id > 0 && YDConfig::get( 'email_new_comment', true ) ) {
 
-                    // Send an email if configured
-                    if ( $comment_id > 0 && YDConfig::get( 'email_new_comment', true ) ) {
+                    // Include the YDEmail library
+                    YDInclude( 'YDEmail.php' );
 
-                        // Include the YDEmail library
-                        YDInclude( 'YDEmail.php' );
+                    // Get the list of subscriptions
+                    $subscribers = $this->weblog->getCommentSubscribers( $id );
 
-                        // Get the list of subscriptions
-                        $subscribers = $this->weblog->getCommentSubscribers( $id );
+                    // Get the list of subscriptions
+                    $users = $this->weblog->getUsers();
 
-                        // Get the list of subscriptions
-                        $users = $this->weblog->getUsers();
+                    // Add the comment to the email template
+                    $this->tpl->assign( 'eml_comment', $values );
 
-                        // Add the comment to the email template
-                        $this->tpl->assign( 'eml_comment', $values );
-
-                        // Create the email and send it
-                        $eml = new YDEmail();
-                        if ( ! empty( $item['user_email'] ) ) {
-                            $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
-                        } else {
-                            $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
-                        }
-                        $eml->setReplyTo( 'no at reply.net' );
-                        $eml->addBcc( $item['user_email'] );
-                        foreach ( $subscribers as $subscriber ) {
-                            $eml->addBcc( $subscriber );
-                        }
-                        foreach ( $users as $user ) {
-                            $eml->addBcc( $user['email'], $user['name'] );
-                        }
-                        $eml->setSubject( t('new_comment') . ': ' . strip_tags( $item['title'] ) );
-                        $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
-                        $eml->send();
-
+                    // Create the email and send it
+                    $eml = new YDEmail();
+                    if ( ! empty( $item['user_email'] ) ) {
+                        $eml->setFrom( $item['user_email'], YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
+                    } else {
+                        $eml->setFrom( 'nobody at nowhere.com', YDConfig::get( 'weblog_title', 'Untitled Weblog' ) );
                     }
+                    $eml->setReplyTo( 'no at reply.net' );
+                    $eml->addBcc( $item['user_email'] );
+                    foreach ( $subscribers as $subscriber ) {
+                        $eml->addBcc( $subscriber );
+                    }
+                    foreach ( $users as $user ) {
+                        $eml->addBcc( $user['email'], $user['name'] );
+                    }
+                    $eml->setSubject( t('new_comment') . ': ' . strip_tags( $item['title'] ) );
+                    $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
+                    $eml->send();
 
-                    // Clear the cache
-                    $this->clearCache();
-
-                    // Redirect to the item
-                    $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
-
                 }
 
-                // Add the form to the template
-                $this->tpl->assignForm( 'comments_form', $form );
+                // Clear the cache
+                $this->clearCache();
 
+                // Redirect to the item
+                $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+
             }
 
+            // Add the form to the template
+            $this->tpl->assignForm( 'comments_form', $form );
+
             // Display the template
             $this->display();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-08-31 15:31:35 UTC (rev 2060)
@@ -52,12 +52,6 @@
             content_css : 'manage_editor.css'
         });{/literal}
 
-        {literal}function YDDisableAutoClose( obj ) {
-            if ( obj.checked ) {
-                document.getElementById("itemForm_auto_close").checked = false;
-            }
-        }{/literal}
-
     //-->
     </script>
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-08-31 15:31:35 UTC (rev 2060)
@@ -30,9 +30,7 @@
             $config['use_cache']           = ( $config['use_cache'] ) ? t('yes') : t('no');
             $config['friendly_urls']       = ( $config['friendly_urls'] ) ? t('yes') : t('no');
             $config['include_debug_info']  = ( $config['include_debug_info'] ) ? t('yes') : t('no');
-            $config['dflt_allow_comments'] = ( $config['dflt_allow_comments'] ) ? t('yes') : t('no');
             $config['dflt_is_draft']       = ( $config['dflt_is_draft'] ) ? t('yes') : t('no');
-            $config['auto_close_items']    = ( empty( $config['auto_close_items'] ) ) ? '-' : $config['auto_close_items'];
 
             // Assign it to the template
             $this->tpl->assign( 'config', $config );
@@ -92,8 +90,6 @@
 
             $form->addElement( 'checkbox', 'friendly_urls', t( 'cfg_friendly_urls' ), array( 'style' => 'border: none;' ) );
 
-            $form->addElement( 'checkbox', 'dflt_allow_comments', t( 'allow_comments' ), array( 'style' => 'border: none;' ) );
-            $form->addElement( 'text', 'auto_close_items', t( 'cfg_auto_close_items' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'checkbox', 'dflt_is_draft', t( 'is_draft' ), array( 'style' => 'border: none;' ) );
 
             $form->addElement( 'textarea', 'blocked_ips', t( 'cfg_blocked_ips' ), array( 'class' => 'tfMNoMCE' ) );
@@ -112,7 +108,6 @@
             $form->addRule( 'weblog_entries_fp', 'numeric', t( 'err_weblog_entries_fp_num' ) );
             $form->addRule( 'max_syndicated_items', 'required', t( 'err_max_syndicated_items' ) );
             $form->addRule( 'max_syndicated_items', 'numeric', t( 'err_max_syndicated_items_num' ) );
-            $form->addRule( 'auto_close_items', 'numeric', t( 'err_auto_close_items' ) );
 
             // Add the filters
             $form->addFilters( 
@@ -170,8 +165,6 @@
             $config['max_syndicated_items'] = YDConfig::get( 'max_syndicated_items', 20 );
             $config['use_cache']            = YDConfig::get( 'use_cache',            false );
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );
-            $config['auto_close_items']     = YDConfig::get( 'auto_close_items',     '' );
-            $config['dflt_allow_comments']  = YDConfig::get( 'dflt_allow_comments',  true );
             $config['dflt_is_draft']        = YDConfig::get( 'dflt_is_draft',        false );
             $config['blocked_ips']          = YDConfig::get( 'blocked_ips',          YDFormatStringWithListValues( '' ) );
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-08-31 15:31:35 UTC (rev 2060)
@@ -91,17 +91,9 @@
             <th colspan="3" class="adminRowLG">&raquo; {t w="cfg_default_item_settings"}</th>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="300">{t w="allow_comments"}</td>
-            <td class="adminRowL" width="400">{$config.dflt_allow_comments}</td>
+            <td class="adminRowL" width="300">{t w="is_draft"}</td>
+            <td class="adminRowL" width="400">{$config.dflt_is_draft}</td>
         </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="300">{t w="cfg_auto_close_items"}</td>
-            <td class="adminRowL" width="400">{$config.auto_close_items}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="is_draft"}</td>
-            <td class="adminRowL">{$config.dflt_is_draft}</td>
-        </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-08-31 15:31:35 UTC (rev 2060)
@@ -19,21 +19,15 @@
 
             // Get the filter
             $filter = 'active';
-            if ( isset( $_GET['filter'] ) ) {
-                if ( strtolower( $_GET['filter'] ) == 'drafts' ) {
-                    $filter = 'drafts';
-                } elseif( strtolower( $_GET['filter'] ) == 'closed' ) {
-                    $filter = 'closed';
-                }
+            if ( isset( $_GET['filter'] ) && strtolower( $_GET['filter'] ) == 'drafts' ) {
+                $filter = 'drafts';
             }
 
             // Get the list of items
             if ( $filter == 'active' ) {
-                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 0 AND allow_comments = 1' );
-            } elseif ( $filter == 'drafts' ) {
-                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 1' );
+                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 0' );
             } else {
-                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND allow_comments = 0' );
+                $items = $this->weblog->getItems( -1, -1, 'created desc', 'AND is_draft = 1' );
             }
 
             // Get the pagesize and current page from the URL
@@ -65,8 +59,6 @@
             $form->addElement( 'select',          'category_id',    t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
             $form->addElement( 'datetimeselect',  'created',        t('created_on'),       array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );
-            $form->addElement( 'checkbox',        'allow_comments', t('allow_comments'),   array( 'style' => 'border: none;', 'onClick' => 'YDDisableAutoClose(this)') );
-            $form->addElement( 'checkbox',        'auto_close',     t('auto_close_item'),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'checkbox',        'is_draft',       t('is_draft'),         array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
             $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),                  array( 'class' => 'button' ) );
@@ -109,13 +101,6 @@
 
                 // Get the defaults
                 $defaults = array();
-                $defaults['allow_comments'] = YDConfig::get( 'dflt_allow_comments', true );
-                $auto_close_items = YDConfig::get( 'auto_close_items', true );
-                if ( empty( $auto_close_items ) ) {
-                    $defaults['auto_close'] = false;
-                } else {
-                    $defaults['auto_close'] = true;
-                }
                 $defaults['is_draft'] = YDConfig::get( 'dflt_is_draft', false );
 
                 // Set the form defaults
@@ -221,8 +206,6 @@
                 // Redirect to the default action
                 if ( $values['is_draft'] ) {
                     $this->redirect( YD_SELF_SCRIPT . '?filter=drafts' );
-                } elseif ( ! $values['allow_comments'] ) {
-                    $this->redirect( YD_SELF_SCRIPT . '?filter=closed' );
                 } else {
                     $this->redirectToAction();
                 }

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-08-31 15:31:35 UTC (rev 2060)
@@ -56,8 +56,6 @@
                 {if $filter == 'active'}<b>{/if}{t w="active_items"}{if $filter == 'active'}</b>{/if}</a>
             | <a href="{$YD_SELF_SCRIPT}?filter=drafts">
                 {if $filter == 'drafts'}<b>{/if}{t w="drafts_items"}{if $filter == 'drafts'}</b>{/if}</a>
-            | <a href="{$YD_SELF_SCRIPT}?filter=closed">
-                {if $filter == 'closed'}<b>{/if}{t w="closed_items"}{if $filter == 'drafts'}</b>{/if}</a>
         </th>
         <th class="adminRowLGR">
             <a href="{$YD_SELF_SCRIPT}?do=edit"><img src="images/icon_add.gif" border="0" /></a>
@@ -88,9 +86,6 @@
                     {if $item.is_draft eq '1'}<i>{/if}
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$item.id}">{$item.title}</a>
                     <br/>
-                    {if $item.allow_comments eq '0'}
-                        {t w="closed"}
-                    {/if}
                     {if $item.is_draft eq '1'}</i>{/if}
                 </td>
                 <td class="adminRowR">
@@ -177,14 +172,6 @@
                 <td class="adminRowL">{$form.modified.html}</td> 
             </tr>
             <tr> 
-                <td class="adminRowL">{$form.allow_comments.label_html}</td> 
-                <td class="adminRowL">{$form.allow_comments.html}</td> 
-            </tr>
-            <tr> 
-                <td class="adminRowL">{$form.auto_close.label_html}</td> 
-                <td class="adminRowL">{$form.auto_close.html}</td> 
-            </tr>
-            <tr> 
                 <td class="adminRowL">{$form.is_draft.label_html}</td> 
                 <td class="adminRowL">{$form.is_draft.html}</td> 
             </tr>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-08-31 15:31:35 UTC (rev 2060)
@@ -125,39 +125,31 @@
     <a name="respond"></a>
     <h3 id="respond">{t w="leave_comment"}</h3>
 
-    {if $comments_form}
+    {$comments_form.tag}
 
-        {$comments_form.tag}
+        {$comments_form._userspam.html}
 
-            {$comments_form._userspam.html}
+        {if $comments_form.errors_unique_messages}
+            <p class="postmetadata alt" style="color: red; text-align: left;">
+                <b>{t w="error_comment"}<br/></b>
+                {foreach from=$comments_form.errors_unique_messages item="error"}
+                    {$error}<br/>
+                {/foreach}
+            </p>
+        {/if}
 
-            {if $comments_form.errors_unique_messages}
-                <p class="postmetadata alt" style="color: red; text-align: left;">
-                    <b>{t w="error_comment"}<br/></b>
-                    {foreach from=$comments_form.errors_unique_messages item="error"}
-                        {$error}<br/>
-                    {/foreach}
-                </p>
-            {/if}
+        {$comments_form.item_id.html}
 
-            {$comments_form.item_id.html}
+        <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
+        <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
+        <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
 
-            <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
-            <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
-            <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
+        <p>{$comments_form.comment.html}</p>
 
-            <p>{$comments_form.comment.html}</p>
+        <p>{$comments_form.cmdSubmit.html}</p>
 
-            <p>{$comments_form.cmdSubmit.html}</p>
+    {$comments_form.endtag}
 
-        {$comments_form.endtag}
-
-    {else}
-
-        <p>{t w="item_closed"}</p>
-
-    {/if}
-
 </div>
 
 {include file="__std_sidebar.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-31 15:19:03 UTC (rev 2059)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-08-31 15:31:35 UTC (rev 2060)
@@ -129,39 +129,31 @@
     <a name="respond"></a>
     <h3 id="respond">{t w="leave_comment"}</h3>
 
-    {if $comments_form}
+    {$comments_form.tag}
 
-        {$comments_form.tag}
+        {$comments_form._userspam.html}
 
-            {$comments_form._userspam.html}
+        {if $comments_form.errors_unique_messages}
+            <p class="postmetadata alt" style="color: red; text-align: left;">
+                <b>{t w="error_comment"}<br/></b>
+                {foreach from=$comments_form.errors_unique_messages item="error"}
+                    {$error}<br/>
+                {/foreach}
+            </p>
+        {/if}
 
-            {if $comments_form.errors_unique_messages}
-                <p class="postmetadata alt" style="color: red; text-align: left;">
-                    <b>{t w="error_comment"}<br/></b>
-                    {foreach from=$comments_form.errors_unique_messages item="error"}
-                        {$error}<br/>
-                    {/foreach}
-                </p>
-            {/if}
+        {$comments_form.item_id.html}
 
-            {$comments_form.item_id.html}
+        <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
+        <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
+        <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
 
-            <p>{$comments_form.username.html} <small>{$comments_form.username.label_html}</small></p>
-            <p>{$comments_form.useremail.html} <small>{$comments_form.useremail.label_html}</small></p>
-            <p>{$comments_form.userwebsite.html} <small>{$comments_form.userwebsite.label_html}</small></p>
+        <p>{$comments_form.comment.html}</p>
 
-            <p>{$comments_form.comment.html}</p>
+        <p>{$comments_form.cmdSubmit.html}</p>
 
-            <p>{$comments_form.cmdSubmit.html}</p>
+    {$comments_form.endtag}
 
-        {$comments_form.endtag}
-
-    {else}
-
-        <p>{t w="item_closed"}</p>
-
-    {/if}
-
 </div>
 
 {include file="__std_sidebar.tpl"}



From pclaerhout at mail.berlios.de  Thu Aug 31 17:34:55 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 31 Aug 2006 17:34:55 +0200
Subject: [ydf-devel] r2061 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200608311534.k7VFYtJC013092@sheep.berlios.de>

Author: pclaerhout
Date: 2006-08-31 17:34:54 +0200 (Thu, 31 Aug 2006)
New Revision: 2061

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/index.php
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
Log:
Forgot to update the manage index page.

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-08-31 15:31:35 UTC (rev 2060)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-08-31 15:34:54 UTC (rev 2061)
@@ -18,7 +18,7 @@
         function actionDefault() {
 
             // Get the 5 newest items
-            $items = $this->weblog->getItems( 5, -1, 'created desc', 'AND is_draft = 0 AND allow_comments = 1' );
+            $items = $this->weblog->getItems( 5, -1, 'created desc', 'AND is_draft = 0' );
 
             // Assign it to the template
             $this->tpl->assign( 'items', $items );

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-31 15:31:35 UTC (rev 2060)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-08-31 15:34:54 UTC (rev 2061)
@@ -8,7 +8,6 @@
         <th colspan="3" class="adminRowLG">
             &raquo; <a href="items.php"><b>{t w="active_items"}</b></a>
             | <a href="items.php?filter=drafts">{t w="drafts_items"}</a>
-            | <a href="items.php?filter=closed">{t w="closed_items"}</a>
         </th>
         <th class="adminRowLGR">
             <a href="items.php?do=edit"><img src="images/icon_add.gif" border="0" /></a>
@@ -37,9 +36,6 @@
                 {if $item.is_draft eq '1'}<i>{/if}
                 <a href="items.php?do=edit&id={$item.id}">{$item.title}</a>
                 <br/>
-                {if $item.allow_comments eq '0'}
-                    {t w="closed"}{if $item.is_draft eq '1'}, {/if}
-                {/if}
                 {if $item.is_draft eq '1'}{t w="draft"}{/if}
                 {if $item.is_draft eq '1'}</i>{/if}
             </td>



