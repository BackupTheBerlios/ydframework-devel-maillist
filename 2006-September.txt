From ximian at mail.berlios.de  Sat Sep  2 00:14:50 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 2 Sep 2006 00:14:50 +0200
Subject: [ydf-devel] r2062 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200609012214.k81MEoUY004821@sheep.berlios.de>

Author: ximian
Date: 2006-09-02 00:14:43 +0200 (Sat, 02 Sep 2006)
New Revision: 2062

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
Log:
make spans with labels, otherwise forms with spans can be confuse to understand

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2006-08-31 15:34:54 UTC (rev 2061)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2006-09-01 22:14:43 UTC (rev 2062)
@@ -53,7 +53,6 @@
 
             // Set the value correctly
             $this->setValue( $label );
-            $this->_placeLabel = 'none';
 
             // Indicate if filters need to be applied
             $this->_applyFilters = false;



From ximian at mail.berlios.de  Sat Sep  2 19:55:21 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 2 Sep 2006 19:55:21 +0200
Subject: [ydf-devel] r2063 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609021755.k82HtL5S011140@sheep.berlios.de>

Author: ximian
Date: 2006-09-02 19:55:01 +0200 (Sat, 02 Sep 2006)
New Revision: 2063

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
- added support for custom options in YDForm::addFormRule.

  Now it's possible to define a form rule like:
  $form->addFormRule( array( & $this, '_check' ), $simpleOption_or_array );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-01 22:14:43 UTC (rev 2062)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-02 17:55:01 UTC (rev 2063)
@@ -625,9 +625,10 @@
          *  __ALL__ to add a form wide error.
          *
          *  @param $callback    The callback of the funtion to perform for this form rule.
+         *  @param $options     (Optional) Custom rule options
          */
-        function addFormRule( $callback ) {
-            array_push( $this->_formrules, $callback );
+        function addFormRule( $callback, $options = null ) {
+            array_push( $this->_formrules, array( $callback, $options ) );
         }
 
         /**
@@ -1036,15 +1037,16 @@
             foreach ( $this->_formrules as $rule ) {
 
                 // Check if the callback is valid
-                if ( ! is_callable( $rule ) ) {
-                    trigger_error( 'The callback specified for the form "' . $rule . '" is not valid', YD_ERROR );
+                if ( ! is_callable( $rule[0] ) ) {
+                    trigger_error( 'The callback specified for the form "' . $rule[0] . '" is not valid', YD_ERROR );
                 }
 
                 // Get the form values
                 $values = $this->getValues();
 
                 // Execute the rule
-                $result = call_user_func( $rule, $values );
+                if ( is_null( $rule[1] ) ) $result = call_user_func( $rule[0], $values );
+                else                       $result = call_user_func( $rule[0], $values, $rule[1] );
 
                 // Check the result
                 if ( is_array( $result ) ) {



From pclaerhout at mail.berlios.de  Sat Sep  2 20:35:59 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 2 Sep 2006 20:35:59 +0200
Subject: [ydf-devel] r2064 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609021835.k82IZxjE023385@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-02 20:35:57 +0200 (Sat, 02 Sep 2006)
New Revision: 2064

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Finally made YDF2_Process.php work under all server APIs that PHP runs on.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-02 17:55:01 UTC (rev 2063)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-02 18:35:57 UTC (rev 2064)
@@ -59,9 +59,6 @@
     @define( 'YD_FW_HOMEPAGE', 'http://ydframework.berlios.de/' );
     @define( 'YD_FW_COPYRIGHT', '(c) 2002-2006 Pieter Claerhout, pieter at yellowduck.be' );
 
-    // Server constants
-    @define( 'YD_SERVER_API', php_sapi_name() );
-
     // Directory paths
     @define( 'YD_DIR_HOME', dirname( __FILE__ ) );
     @define( 'YD_DIR_HOME_CLS', YD_DIR_HOME . '/YDClasses' );
@@ -69,10 +66,7 @@
     @define( 'YD_DIR_TEMP', YD_DIR_HOME . '/temp' );
 
     // File and URL constants
-    @define( 'YD_SELF_SCRIPT', $_SERVER['PHP_SELF'] );
-    if ( ! isset( $_SERVER['SCRIPT_FILENAME'] ) || substr( YD_SERVER_API, 0, 3 ) == 'cgi' ) {
-        $_SERVER['SCRIPT_FILENAME'] = $_SERVER['PATH_TRANSLATED'];
-    }
+    @define( 'YD_SELF_SCRIPT', $_SERVER['PATH_TRANSLATED'] );
     @define( 'YD_SELF_FILE', $_SERVER['SCRIPT_FILENAME'] );
     @define( 'YD_SELF_DIR', dirname( YD_SELF_FILE ) );
     @define( 'YD_SELF_URI', $_SERVER['REQUEST_URI'] );



From francisco at fusemail.com  Sat Sep  2 20:44:52 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sat, 02 Sep 2006 19:44:52 +0100
Subject: [ydf-devel] r2064 - YDFramework2.0/trunk/YDFramework2
In-Reply-To: <200609021835.k82IZxjE023385@sheep.berlios.de>
References: <200609021835.k82IZxjE023385@sheep.berlios.de>
Message-ID: <44F9D124.8060903@fusemail.com>

Hi Pieter

> Author: pclaerhout
> Date: 2006-09-02 20:35:57 +0200 (Sat, 02 Sep 2006)
> New Revision: 2064
> 
> Modified:
>    YDFramework2.0/trunk/YDFramework2/YDF2_init.php
> Log:
> Finally made YDF2_Process.php work under all server APIs that PHP runs on.


Now i get all image paths ( created with YDUrl::makeLinkAbsolute ) insane.

I get something like: http:://localhost/C:\...  (in b2064 only)


regards
Francisco A


From pclaerhout at mail.berlios.de  Sat Sep  2 20:53:59 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 2 Sep 2006 20:53:59 +0200
Subject: [ydf-devel] r2065 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609021853.k82Irx0G029577@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-02 20:53:57 +0200 (Sat, 02 Sep 2006)
New Revision: 2065

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Fixed my previous merge...

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-02 18:35:57 UTC (rev 2064)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-02 18:53:57 UTC (rev 2065)
@@ -66,8 +66,8 @@
     @define( 'YD_DIR_TEMP', YD_DIR_HOME . '/temp' );
 
     // File and URL constants
-    @define( 'YD_SELF_SCRIPT', $_SERVER['PATH_TRANSLATED'] );
-    @define( 'YD_SELF_FILE', $_SERVER['SCRIPT_FILENAME'] );
+    @define( 'YD_SELF_SCRIPT', $_SERVER['PHP_SELF'] );
+    @define( 'YD_SELF_FILE', $_SERVER['PATH_TRANSLATED'] );
     @define( 'YD_SELF_DIR', dirname( YD_SELF_FILE ) );
     @define( 'YD_SELF_URI', $_SERVER['REQUEST_URI'] );
 



From pieter at yellowduck.be  Sat Sep  2 20:54:18 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Sat, 2 Sep 2006 20:54:18 +0200
Subject: [ydf-devel] r2064 - YDFramework2.0/trunk/YDFramework2
In-Reply-To: <44F9D124.8060903@fusemail.com>
References: <200609021835.k82IZxjE023385@sheep.berlios.de>
	<44F9D124.8060903@fusemail.com>
Message-ID: <4aef63030609021154v2d2b4892s26156739984efc47@mail.gmail.com>

Fixed in build 2065.

my mistake.


pieter

On 9/2/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi Pieter
>
> > Author: pclaerhout
> > Date: 2006-09-02 20:35:57 +0200 (Sat, 02 Sep 2006)
> > New Revision: 2064
> >
> > Modified:
> >    YDFramework2.0/trunk/YDFramework2/YDF2_init.php
> > Log:
> > Finally made YDF2_Process.php work under all server APIs that PHP runs
> on.
>
>
> Now i get all image paths ( created with YDUrl::makeLinkAbsolute ) insane.
>
> I get something like: http:://localhost/C:\...  (in b2064 only)
>
>
> regards
> Francisco A
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060902/7c945d4d/attachment.html>

From francisco at fusemail.com  Sat Sep  2 20:53:39 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sat, 02 Sep 2006 19:53:39 +0100
Subject: [ydf-devel] r2064 - YDFramework2.0/trunk/YDFramework2
In-Reply-To: <4aef63030609021154v2d2b4892s26156739984efc47@mail.gmail.com>
References: <200609021835.k82IZxjE023385@sheep.berlios.de>	<44F9D124.8060903@fusemail.com>
	<4aef63030609021154v2d2b4892s26156739984efc47@mail.gmail.com>
Message-ID: <44F9D333.6040009@fusemail.com>

Hi Pieter

> Fixed in build 2065.

Thanks. Everything seem fine now.

> my mistake.

No problem.


regards
Francisco A


From david_db at mail.berlios.de  Sun Sep  3 14:01:25 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Sun, 3 Sep 2006 14:01:25 +0200
Subject: [ydf-devel] r2066 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200609031201.k83C1PgV009195@sheep.berlios.de>

Author: david_db
Date: 2006-09-03 14:01:11 +0200 (Sun, 03 Sep 2006)
New Revision: 2066

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Modified YDDatabaseObject:

- Added resetRelations() that resets all relations.
- Added parameter to reset() called $all that resets everything in the object including relations and other custom variables when true (default: false).
- Modified resetValues to reset values in selects vars too.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-02 18:53:57 UTC (rev 2065)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-03 12:01:11 UTC (rev 2066)
@@ -1733,22 +1733,14 @@
          *  This function resets all information in the object and relation objects.
          */
         function resetAll() {
-            
-            $relations = array_keys( get_object_vars( $this->_relations ) );
-
-            foreach ( $relations as $relation ) {
-                $this->resetRelation( $relation );
-            }
-            
-            $this->reset();
-            
+            $this->reset( true );
         }
 
         /**
          *  This function resets the object's values, any additional query value and
          *  any result remaining to be fetch.
          */
-        function reset() {
+        function reset( $all=false ) {
             
             // before reset callbacks
             $res = $this->_executeCallbacks( 'reset', true );
@@ -1757,7 +1749,12 @@
                 return $res;
             }
             
-            $this->resetObject();
+			if ( $all ) {
+				$this->resetObject();
+				$this->resetRelations();
+			} else {
+				$this->resetValues();
+			}
             $this->resetQuery();
             $this->resetResults();
             $this->resetCount();
@@ -1788,23 +1785,31 @@
          *  This function resets the object's field values.
          */
         function resetValues() {
-            $this->setValues( array() );
+            
+			$this->setValues( array() );
+			
+			$selects = array_keys( get_object_vars( $this->_selects ) );
+
+            foreach ( $selects as $select ) {
+                unset( $this->$select );
+            }
+			
         }
         
         /**
-         *  This function resets the all object's values.
+         *  This function resets the object.
          */
         function resetObject() {
             
-            $vars = get_object_vars( $this );
-            
             $relation_vars = array();
-            foreach ( $this->_relations as $rel ) {
-                $relation_vars[] = $rel->getForeignVar();
-                if ( $rel->isManyToMany() ) {
-                    $relation_vars[] = $rel->getCrossVar();
-                }
-            }
+			foreach ( $this->_relations as $rel ) {
+				$relation_vars[] = $rel->getForeignVar();
+				if ( $rel->isManyToMany() ) {
+					$relation_vars[] = $rel->getCrossVar();
+				}
+			}
+			
+			$vars = get_object_vars( $this );
             
             foreach ( $vars as $var => $value ) {
                 
@@ -1815,7 +1820,20 @@
             }
             
         }
+		
+		/**
+         *  This function unloads all relations.
+         */
+		function resetRelations() {
+			
+			$relations = array_keys( get_object_vars( $this->_relations ) );
 
+            foreach ( $relations as $relation ) {
+                $this->resetRelation( $relation );
+            }
+			
+		}
+
         /**
          *  This function resets any query addition.
          */



From david_db at mail.berlios.de  Mon Sep  4 05:24:50 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Mon, 4 Sep 2006 05:24:50 +0200
Subject: [ydf-devel] r2067 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200609040324.k843OoBG001961@sheep.berlios.de>

Author: david_db
Date: 2006-09-04 05:24:32 +0200 (Mon, 04 Sep 2006)
New Revision: 2067

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Changed the behavior of YDDatabaseObject::reset() and YDDatabaseObject::resetAll() again. Now reset() clears the object's registered fields values, selects values, query values and results but not another custom variables. And resetAll() uses reset() and resetRelations() that executes a resetAll() in all relations objects.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-03 12:01:11 UTC (rev 2066)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-04 03:24:32 UTC (rev 2067)
@@ -952,42 +952,6 @@
         }
 
         /**
-         *  This function resets the information defined in relation objects.
-         *
-         *  @param $relation  (optional) The relation name. If empty, the last relations loaded.
-         */
-        function resetRelation( $relation='' ) {
-
-            $relations = $this->_last;
-
-            if ( strlen( $relation ) ) {
-                $relations = array( $relation );
-            }
-
-            foreach ( $relations as $relation ) {
-
-                $rel = & $this->getRelation( $relation );
-
-                $f_var = $rel->getForeignVar();
-                
-                if ( isset( $this->$f_var ) ) {
-                    $this->$f_var->reset();
-                }
-
-                if ( $rel->isManyToMany() ) {
-
-                    $c_var = $rel->getCrossVar();
-                    
-                    if ( isset( $this->$c_var ) ) {
-                        $this->$c_var->reset();
-                    }
-
-                }
-            }
-
-        }
-
-        /**
          *  This function executes an INSERT query based on the values of the object.
          *
          *  @param $values_noquote  (optional) Associative array that defines values that
@@ -1733,14 +1697,15 @@
          *  This function resets all information in the object and relation objects.
          */
         function resetAll() {
-            $this->reset( true );
+            $this->reset();
+			$this->resetRelations();
         }
 
         /**
-         *  This function resets the object's values, any additional query value and
-         *  any result remaining to be fetch.
+         *  This function resets the object's registered fields values, selects values, query values
+         *  and results remaining to be fetch.
          */
-        function reset( $all=false ) {
+        function reset() {
             
             // before reset callbacks
             $res = $this->_executeCallbacks( 'reset', true );
@@ -1749,12 +1714,7 @@
                 return $res;
             }
             
-			if ( $all ) {
-				$this->resetObject();
-				$this->resetRelations();
-			} else {
-				$this->resetValues();
-			}
+			$this->resetValues();
             $this->resetQuery();
             $this->resetResults();
             $this->resetCount();
@@ -1795,25 +1755,25 @@
             }
 			
         }
+
+        /**
+         *  This function resets any query addition.
+         */
+        function resetQuery() {
+            $this->_query->reset();
+            $this->_all = true;
+        }
         
         /**
-         *  This function resets the object.
+         *  This function resets the object completely.
          */
         function resetObject() {
             
-            $relation_vars = array();
-			foreach ( $this->_relations as $rel ) {
-				$relation_vars[] = $rel->getForeignVar();
-				if ( $rel->isManyToMany() ) {
-					$relation_vars[] = $rel->getCrossVar();
-				}
-			}
-			
-			$vars = get_object_vars( $this );
+            $vars = get_object_vars( $this );
             
             foreach ( $vars as $var => $value ) {
                 
-                if ( substr( $var, 0, 1 ) != '_' && ! in_array( $var, $relation_vars ) ) {
+                if ( substr( $var, 0, 1 ) != '_' ) {
                     unset( $this->$var );
                 }
                 
@@ -1833,13 +1793,41 @@
             }
 			
 		}
-
+		
         /**
-         *  This function resets any query addition.
+         *  This function resets the information defined in relation objects.
+         *
+         *  @param $relation  (optional) The relation name. If empty, the last relations loaded.
          */
-        function resetQuery() {
-            $this->_query->reset();
-            $this->_all = true;
+        function resetRelation( $relation='' ) {
+
+            $relations = $this->_last;
+
+            if ( strlen( $relation ) ) {
+                $relations = array( $relation );
+            }
+
+            foreach ( $relations as $relation ) {
+
+                $rel = & $this->getRelation( $relation );
+
+                $f_var = $rel->getForeignVar();
+                
+                if ( isset( $this->$f_var ) ) {
+                    $this->$f_var->resetAll();
+                }
+
+                if ( $rel->isManyToMany() ) {
+
+                    $c_var = $rel->getCrossVar();
+                    
+                    if ( isset( $this->$c_var ) ) {
+                        $this->$c_var->resetAll();
+                    }
+
+                }
+            }
+
         }
 
         /**



From david_db at mail.berlios.de  Mon Sep  4 05:40:36 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Mon, 4 Sep 2006 05:40:36 +0200
Subject: [ydf-devel] r2068 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200609040340.k843eaXu004734@sheep.berlios.de>

Author: david_db
Date: 2006-09-04 05:40:28 +0200 (Mon, 04 Sep 2006)
New Revision: 2068

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed YDDatabaseObject::resetObject() to unset relation vars if they start with underscore too.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-04 03:24:32 UTC (rev 2067)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-04 03:40:28 UTC (rev 2068)
@@ -1778,6 +1778,18 @@
                 }
                 
             }
+			
+			foreach ( $this->_relations as $rel ) {
+			
+                $f_var = $rel->getForeignVar();
+				unset( $this->$f_var );
+				
+				if ( $rel->isManyToMany() ) {
+					$c_var = $rel->getCrossVar();
+					unset( $this->$c_var );
+				}
+				
+            }
             
         }
 		



From david_db at mail.berlios.de  Mon Sep  4 05:41:19 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Mon, 4 Sep 2006 05:41:19 +0200
Subject: [ydf-devel] r2069 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200609040341.k843fJQd005853@sheep.berlios.de>

Author: david_db
Date: 2006-09-04 05:41:14 +0200 (Mon, 04 Sep 2006)
New Revision: 2069

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
Fixed YDDatabaseObject::_version.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-04 03:40:28 UTC (rev 2068)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-04 03:41:14 UTC (rev 2069)
@@ -104,7 +104,7 @@
 
             // Setup the module
             $this->_author = 'David Bittencourt';
-            $this->_version = '4.28';
+            $this->_version = '4.30';
             $this->_copyright = '(c) 2005 David Bittencourt, muitocomplicado at hotmail.com';
             $this->_description = 'This class defines a YDDatabaseObject object.';
 



From david_db at mail.berlios.de  Mon Sep  4 10:15:35 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Mon, 4 Sep 2006 10:15:35 +0200
Subject: [ydf-devel] r2070 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609040815.k848FZxh030329@sheep.berlios.de>

Author: david_db
Date: 2006-09-04 10:15:31 +0200 (Mon, 04 Sep 2006)
New Revision: 2070

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Fixed YDTemplate_make_timestamp() when using dates in other formats (e.g. ISO).

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-04 03:41:14 UTC (rev 2069)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-04 08:15:31 UTC (rev 2070)
@@ -558,7 +558,6 @@
         if ( is_numeric( $time ) && $time != -1 ) {
             return intval( $time );
         }
-        $time = strtotime( $string );
         if ( preg_match( '/^\d{14}$/', $string ) ) {
             $time = mktime(
                 substr( $string, 8, 2 ), substr( $string, 10, 2 ), substr( $string, 12, 2 ),
@@ -566,7 +565,7 @@
             );
             return $time;
         }
-        $time = ( int ) $string;
+        $time = ( int ) strtotime( $string );
         if ( $time > 0 ) {
             return $time;
         } else {



From ximian at mail.berlios.de  Mon Sep  4 18:39:43 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 18:39:43 +0200
Subject: [ydf-devel] r2071 - in
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent: .
	languages languages/YDCMUsers
Message-ID: <200609041639.k84GdhxW029739@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 18:38:40 +0200 (Mon, 04 Sep 2006)
New Revision: 2071

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
Log:
- cleaner code on YDCMComponent: new user management db scheme based on tree objects (like the content).. much much better
- added group mamanagement
- added permission management

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -30,7 +30,7 @@
     YDInclude( 'YDDatabaseObject.php' );
 	YDInclude( 'YDDatabaseTree.php' );
 	YDInclude( 'YDUrl.php' );
-	YDInclude( 'YDError.php' );
+	YDInclude( 'YDResult.php' );
 
 	// include YDCM libs
 	YDInclude( 'YDCMComp.php' );
@@ -189,6 +189,7 @@
 			// check if we have a custom id
 			if( is_null( $id ) ) $id = $this->_id;
 
+			// TODO: check if return element is a array
 			return $tree->getDescendants( $id );
 		}
 
@@ -374,33 +375,4 @@
     }
 
 
-	@define ( YD_ERROR_OK, 1000 );
-	
-    YDConfig::set( 'YD_ERROR_LEVELS', array(
-            YD_ERROR_NOTICE  => 'Notice',
-            YD_ERROR_WARNING => 'Warning',
-            YD_ERROR_FATAL   => 'Fatal',
-            YD_ERROR_OK      => 'Ok'
-        ));
-
-	// experimental class to handle all YDCM method results
-	class YDResult extends YDError{
-	
-        /**
-         *  This method creates a OK type
-         *
-         *  @param  $message  The message.
-         *  @param  $value    (optional) A custom value
-         *
-         *  @returns     An YDCMResult object.
-         *
-         *  @static
-         */
-        function ok( $message, $value = null ) {
-            return YDError::_error( YD_ERROR_OK, $message, $value );
-        }
-
-
-	}
-
 ?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -0,0 +1,375 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// set components path
+	YDConfig::set( 'YD_DBOBJECT_PATH', YD_DIR_HOME_ADD . '/YDCMComponent', false );
+
+	// add translations directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMGroup/' );
+
+	// add YDF libs needed by this class
+	YDInclude( 'YDDatabaseObject.php' );
+	YDInclude( 'YDValidateRules.php' );
+	YDInclude( 'YDResult.php' );
+
+	// add YDCM libs
+	YDInclude( 'YDCMUserobject.php' );
+
+
+	// user class
+    class YDCMGroup extends YDDatabaseObject {
+    
+        function YDCMGroup() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMGroup' );
+
+			// register fields
+			$this->registerField( 'group_id' );
+			$this->registerField( 'name' );
+			$this->registerField( 'description' );			
+
+			// init relation with userobject
+            $rel = & $this->registerRelation( 'ydcmuserobject', false, 'ydcmuserobject' );
+			$rel->setLocalKey( 'group_id' );
+            $rel->setForeignKey( 'userobject_id' );
+		}
+
+
+        /**
+         *  This method checks if a group ID is valid ( will check if group_id is on its 2 tables )
+         *
+         *  @param $group_id        Group id
+         *
+         *  @returns    TRUE if valid, FALSE otherwise
+         */
+		function validID( $group_id ){
+		
+			// reset values
+			$this->resetAll();
+
+			// find all rows this user id
+			$this->where( 'group_id = ' . intval( $group_id ) );
+
+			// join all tables when finding (to check if group_id really belongs to all 3 tables)
+			return ( $this->findAll() == 1 );
+		}
+
+
+        /**
+         *  This method deletes a group
+         *
+         *  @param $group_id       Group id
+         *
+         *  @returns    delete()
+         */
+		function deleteUser( $group_id ){
+		
+			// reset stuff
+			$this->resetAll();
+			
+			$this->set( 'group_id', intval( $group_id ) );
+			
+			return $this->delete();
+		}
+
+
+        /**
+         *  This method adds form elements for group editing
+		 *
+		 * @param $group_id     Group id to edit
+		 *
+		 * @param $editable     (Optional) Boolean flag that defines if elements are editable
+         */
+		function addFormEdit( $group_id, $editable = true ){
+
+		 	return $this->_addFormDetails( $group_id, true, $editable );
+		}
+
+
+        /**
+         *  This method adds form elements for addind a new group
+		 *
+		 * @param $parent_group_id    (Optional) Parent id
+         */
+		function addFormNew( $parent_group_id = null ){
+
+		 	return $this->_addFormDetails( $parent_group_id, false, true );
+		}
+		 
+		
+        /**
+         *  Helper method for user management
+		 *
+		 * @param $id           If you will EDIT some group this is the group id to edit
+         *                      If you will ADD a new group this is the parent id. Use NULL to add it to the root tree
+         *
+		 * @param $edit         TRUE: We are editing a group, FALSE: we are creating a group
+		 *
+		 * @param $editable     When editing a group, this boolean flag defines if form elements are editable (default true)
+         */
+		function _addFormDetails( $id, $edit, $editable ){
+
+			YDInclude( 'YDForm.php' );
+
+			// init form
+			$this->_form = new YDForm( 'YDCMGroup' );
+
+			// add name and drecription
+			if ( $editable ){
+				$this->_form->addElement( 'text',     'name',        t( 'group name' ) );
+				$this->_form->addElement( 'textarea', 'description', t( 'group description' ), array( 'rows' => 4, 'cols' => 40 ) );
+				$this->_form->addElement( 'select',   'state',       t( 'group state' ), array(), array( 0 => t( 'Blocked' ), 1 => t( 'Active' ) ) );
+
+				$this->_form->addFormRule( array( & $this, '_checkgroup' ), array( $edit, $id ) );
+
+			}else{
+				$this->_form->addElement( 'span', 'name',        t( 'group name' ) );
+				$this->_form->addElement( 'span', 'description', t( 'group description' ) );
+			}
+
+			// if we are editing a group, set form defaults
+			if ( $edit ){
+
+				// add submit button
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+
+				// set form defaults based on user attributes
+				$this->_form->setDefaults( $this->getGroup( $id ) );
+
+			}else{
+
+				// add submit button
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
+			}
+
+		}
+
+
+        /**
+         *  Internal method to check if a group name already exists 
+         */
+		function _checkgroup( $values, $options ){
+
+			$this->resetAll();
+			
+			$this->set( 'name', $values[ 'name' ] );
+
+			// check if we are editing. if yes, we should check if the name is already used only by another group than current
+			if ( $options[0] == true )
+				$this->where( 'group_id != ' . intval( $options[1] ) );
+			
+			if ( $this->find() == 0 ) return true;
+			
+			return array( '__ALL__' => t( 'group exists' ) );
+		}
+
+
+        /**
+         *  This method updates group attributes
+         *
+         *  @param $id           Group id to save attributes
+         *  @param $formvalues   (Optional) Custom array with attributes
+         *
+         *  @returns    YDResult object. OK      - form updated
+		 *                               WARNING - there are form errors
+         *                               FATAL   - was not possible to update
+         */
+		function saveFormEdit( $id, $formvalues = null ){
+
+			return $this->_saveFormDetails( $id, true, $formvalues );
+		}
+
+
+        /**
+         *  This method adds a new group
+         *
+         *  @param $parent_id    (Optional) Parent id of this new group
+         *  @param $formvalues   (Optional) Custom array with attributes
+         *
+         *  @returns    YDResult object. OK      - form added
+		 *                               WARNING - there are form errors
+         *                               FATAL   - was not possible to add
+         */
+		function saveFormNew( $parent_id = null, $formvalues = null ){
+
+			return $this->_saveFormDetails( $parent_id, false, $formvalues );
+		}
+
+
+        /**
+         *  This method adds/saves a group
+         *
+         *  @param $id           If we are editing, $id is the group id. If we are adding, $id is the parent_id
+         *  @param $edit         Boolean flag that defines if we are editing $id or adding to $id
+         *  @param $formvalues   (Optional) Custom array with attributes
+         *
+         *  @returns    YDResult
+         */
+		function _saveFormDetails( $id, $edit, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->_form->validate( $formvalues ) )
+				return YDResult::warning( t( 'form errors' ), $this->_form->getErrors() );
+
+			// get form values EXCLUDING spans
+			$values = $this->_form->getValues();
+
+			// check if we are editing or adding an element
+			if ( $edit ){
+
+				// create userobject node
+				$userobject = array();
+				$userobject['type']  = 'YDCMGroup';
+				$userobject['reference'] = $values[ 'name' ];
+//				$userobject['state']     = $values[ 'state' ];
+
+				// update userobject
+				$uobj = new YDCMUserobject();
+				$res  = $uobj->updateNode( $userobject, $id );
+
+				// create user row
+				$group = array();
+				$group['name']        = $values[ 'name' ];
+				$group['description'] = $values[ 'description' ];
+
+				// update user
+				$this->resetValues();
+				$this->setValues( $group );
+				$this->where( 'group_id = '. $id ); 
+
+				$res = $this->update();
+				
+				// check update result and return
+				if ( $res > 0 ) return YDResult::ok( t( 'group details updated' ), $res );
+				else            return YDResult::warning( t( 'group not updated' ), $res );
+
+			}else{
+
+				// create userobject node
+				$userobject = array();
+				$userobject['type']      = 'YDCMGroup';
+				$userobject['reference'] = $values[ 'name' ];
+				$userobject['state']     = isset( $values[ 'state' ] ) ? $values[ 'state' ] : 0;
+
+				// check default parent id
+				if ( is_null( $id ) ) $id = 1;
+
+				// TODO: check if group is valid (and, eg,  is not a user node)
+
+				// update userobject and get new id
+				$uobj = new YDCMUserobject();
+				$res  = $uobj->addNode( $userobject, intval( $id ) );
+
+				// create user row
+				$group = array();
+				$group[ 'group_id' ]    = $res;
+				$group[ 'name' ]        = $values[ 'name' ];
+				$group[ 'description' ] = $values[ 'description' ];
+
+				// reset object
+				$this->resetAll();
+				$this->setValues( $group );
+
+				// insert values
+				if ( $this->insert() ) return YDResult::ok( t( 'group added' ), $res );
+				else                   return YDResult::fatal( t( 'group not added' ), $res );
+			}
+
+		}
+
+
+        /**
+         *  This returns the form
+         *
+         *  @param $defaults  (Optional) default values array to apply in form
+         *
+         *  @returns    YDForm object
+         */
+		function & getForm( $defaults = false ){
+
+			// check if we have form defaults and apply them
+			if ( is_array( $defaults ) ) $this->_form->setDefaults( $defaults );
+
+			return $this->_form;
+		}
+
+
+        /**
+         *  This method returns user attributes
+         *
+         *  @param      $group_id    Group id or group name
+         *
+         *  @returns    FALSE if group not valid, ARRAY with details otherwise
+         */
+		function getGroup( $group_id ){
+
+			$this->resetAll();
+
+			// set group id to search for
+			if ( is_numeric( $group_id ) ) $this->set( 'group_id',  intval( $group_id ) );
+			else                           $this->set( 'name',      strval( $group_id ) );
+
+			// get all attributes
+			if ( $this->findAll() != 1 ) return false;
+
+			return $this->getValues();
+		}
+
+
+        /**
+         *  This method returns a specific group attribute
+         *
+         *  @param      $group_id    Group id to use
+         *  @param      $attribute   Attribute name string
+         *
+         *  @returns    FALSE if group not valid, attribute string otherwise
+         */
+		function getGroupAttribute( $group_id, $attribute ){
+
+			$this->resetAll();
+
+			// set user id
+			$this->set( 'group_id', intval( $group_id ) );
+
+			// get all attributes
+			if ( $this->find() != 1 ) return false;
+
+			return $this->get( $attribute );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -0,0 +1,236 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// set components path
+	YDConfig::set( 'YD_DBOBJECT_PATH', YD_DIR_HOME_ADD . '/YDCMComponent', false );
+
+	// include YDF libs
+	YDInclude( 'YDDatabaseObject.php' );
+
+
+
+    class YDCMPermission extends YDDatabaseObject {
+    
+        function YDCMPermission() {
+
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMPermission' );
+
+			// register fields	
+			$this->registerField( 'permission_id' );
+			$this->registerField( 'class' );
+			$this->registerField( 'action' );
+
+			// init relation with userobject
+            $rel = & $this->registerRelation( 'ydcmuserobject', false, 'ydcmuserobject' );
+			$rel->setLocalKey( 'permission_id' );
+            $rel->setForeignKey( 'userobject_id' );
+
+			// init valid actions
+			$this->_actions = array();
+		}
+
+
+        /**
+         *  This function return an array of permissions
+         *
+         *  @param     $userobject_id    Userobject id
+         *  @param     $translate        (Optional) Translate permissions
+		 *
+         *  @returns    An array with all permissions
+         */
+		function getPermissions( $userobject_id, $translate = false ){
+		
+			$this->resetAll();
+			$this->set( 'permission_id', intval( $userobject_id ) );
+			$this->findAll();
+
+			$permissions = $this->getResultsAsAssocArray( array( 'class', 'action' ) );
+
+			// filter permissions
+			foreach ( $permissions as $class => $actions )
+				foreach( $actions as $action => $info )
+					if ( ! $this->actionIsRegistered( $class, $action ) ) unset( $permissions[ $class ][ $action ] );
+
+			// cycle all classes to see if there are empty classes. on the above unset some classes could be without actions
+			foreach ( $permissions as $class => $actions )
+				if ( empty( $actions ) ) unset( $permissions[ $class ] );
+
+			// if we don't want to translated permissions, just return
+			if ( !$translate ) return $permissions;
+
+			$arr_translated = array();
+
+			// cycle classes and compute translated actions
+			foreach( $permissions as $class => $actions ){
+
+				// get translations of this component
+				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/YDCMComponent/languages/' . $class );
+
+				// add class to new array
+				if ( !isset( $arr_translated[ $class ] ) ) $arr_translated[] = $class;
+
+				// cycle actions to compute translated string
+				foreach( $actions as $action => $info )
+					$arr_translated[ $class ][ t( "permission $class $action" ) ] = $info;
+			}
+			
+			return $arr_translated;
+		}
+
+
+        /**
+         *  This function returns all permissions of a userobject
+         *
+         *  @param     $userobject_id   Userobject id (or array of userobjects ) to delete
+         *
+         *  @returns   Boolean TRUE if deleted, FALSE otherwise
+         */
+		function deletePermissions( $userobject_id ){
+
+			// check if argument is array
+			if ( !is_array( $userobject_id ) ) $userobject_id = array( $userobject_id );
+
+			$this->resetAll();
+
+			// delete all permissions of correspondent userobjects
+			$this->where( 'permission_id IN ("' . implode( '","', $userobject_id ) . '")' );
+
+			return ( $this->delete() > 0 );
+		}
+
+
+
+        /**
+         *  This function added a new action to database
+         *
+         *  @param     $userobject_id   Userobject id
+         *  @param     $class           Class name
+         *  @param     $action          Action name
+         *
+         *  @returns   Boolean TRUE if added, FALSE otherwise
+         */
+		function addPermission( $userobject_id, $class, $action ){
+
+			if ( ! $this->actionIsRegistered( $class, $action ) ) return false;
+
+			// reset old stuff
+			$this->resetAll();
+
+			// TODO: check if userobject exists
+			$this->set( 'permission_id', intval( $userobject_id ) );
+			$this->set( 'class', $class );
+			$this->set( 'action', $action );
+
+			// return insert result
+			return ( $this->insert() == 1 );
+		}
+
+
+        /**
+         *  This function registers a valid system permission
+         *
+         *  @param     $class    Class name
+         *  @param     $action   Action name
+         *
+         *  @returns   TRUE if added, FALSE is already exists
+         */
+		function registerAction( $class, $action ){
+
+			$this->_actions[ $class ][] = $action;
+
+			return true;
+		}
+
+
+        /**
+         *  This function checks if a class+action is registered
+         *
+         *  @param     $class    Class name
+         *  @param     $action   Action name
+         *
+         *  @returns   TRUE if registered, FALSE otherwise
+         */
+		function actionIsRegistered( $class, $action ){
+
+			if ( isset( $this->_actions[ $class ] ) && in_array( $action, $this->_actions[ $class ] ) ) return true;
+
+			return false;
+		}
+
+
+        /**
+         *  This function returns all registered actions
+         *
+         *  @param     $class    (Optional) Class name. default NULL to get actions from all classes
+         *
+         *  @returns   Associative array:  array( CLASS => array( ACTION, ACTION, .. ) ), or array when class argument is defined
+         */
+		function getRegisteredActions( $class = null ){
+
+			// check if we want actions from all classes
+			if ( is_null( $class ) ) return $this->_actions;
+			
+			// check if action exists
+			if ( isset( $this->_actions[ $class ] ) ) return $this->_actions[ $class ];
+
+			return array();
+		}
+
+
+        /**
+         *  This function checks if a userobject if can do some action
+         *
+         *  @param     $userobject_id     Userobject id
+         *
+         *  @returns   Boolean TRUE or FALSE
+         */
+		function can( $userobject_id, $class, $action ){
+
+			// check if class and action are registed
+			if ( ! isset( $this->_actions[ $class ] ) || ! in_array( $action, $this->_actions[ $class ] ) ) return false;
+
+			$this->resetAll();
+			
+			// try to get a row joined with userobject
+			$this->set( 'permission_id', $userobject_id );
+			$this->set( 'class', $class );
+			$this->set( 'action', $action );
+
+			return ( $this->find( 'ydcmuserobject' ) == 1 );
+		}
+
+}
+
+?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermissions.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -1,184 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-
-    class YDCMPermissions extends YDDatabaseObject {
-    
-        function YDCMPermissions() {
-
-			// init component as non default
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMPermissions' );
-
-            // register custom key
-            $this->registerKey( 'permission_id', true );
-
-			// register fields	
-			$this->registerField( 'user_id' );
-			$this->registerField( 'object' );
-			$this->registerField( 'object_action' );
-		}
-
-
-        /**
-         *  This function return an array of permissions
-         *
-         *  @param     $user_id    User id to get permissions
-         *  @param     $translate  (Optional) Translate permissions
-		 *
-         *  @returns    An array with all permission groupby object
-         */
-		function getPermissions( $user_id, $translate = false ){
-		
-			$this->resetValues();
-			$this->user_id = intval( $user_id );
-			$this->orderby( 'object DESC, object_action DESC' );
-			$this->find();
-
-			$permissions = $this->getResultsAsAssocArray( array( 'object', 'object_action' ) );
-			
-			if ( !$translate ) return $permissions;
-
-			$arr_translated = array();
-
-			// cycle objects and compute translated actions
-			foreach( $permissions as $obj => $perms ){
-
-				// get permission translations of this component
-				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
-
-				if (!isset( $arr_translated[ $obj ] ) ) $arr_translated[] = $obj;
-
-				foreach( $perms as $p )
-					$arr_translated[ $obj ][] = t( $p );
-			}
-			
-			return $arr_translated;
-		}
-
-
-        /**
-         *  This function return an array of permissions
-         *
-         *  @param     $user_id   User id (or Array of ids ) to delete
-         */
-		function deletePermissions( $user_id ){
-
-			if ( !is_array( $user_id ) ) $user_id = array( $user_id );
-
-			$this->resetValues();
-			$this->where( 'user_id IN ("' . implode( '","', $user_id ) . '")' );
-
-			return $this->delete();
-		}
-
-
-        /**
-         *  This function assigns an array of permissions to a user
-         *
-         *  @param     $user_id     User id to get permissions
-         *  @param     $parend_id   Parent id form permission comparation
-         *  @param     $permissions Array with permissions
-         */
-		function setPermissions( $user_id, $parent_id, $values ){
-
-			// init temp array permissions
-			$permissions_valid  = array();
-			$permissions_to_add = array();
-			$permissions_to_del = array();
-
-			// get parent permissions
-			$permissions_parent = $this->getPermissions( $parent_id );
-
-			// filter $values and get permissions that are in parent
-			foreach( $permissions_parent as $obj => $perms )
-				foreach( $perms as $p => $arr )
-					if( isset( $values[ $obj ][ $p ] ) && $values[ $obj ][ $p ] == 1 )
-						$permissions_valid[ $obj ][] = $p;
-
-			// get user permissions
-			$permissions_user = $this->getPermissions( $user_id );
-
-			// cycle user permissions to see the ones we need to delete
-			foreach( $permissions_user as $obj => $perms )
-				foreach( $perms as $p => $arr )
-					if ( !isset( $permissions_valid[ $obj ] ) || !in_array( $p, $permissions_valid[ $obj ] ) ) 
-						$permissions_to_del[ $obj ][] = $p;
-
-			// cycle current permissions to see the ones we need to add
-			foreach( $permissions_valid as $obj => $perms )
-				foreach( $perms as $p )
-					if ( !isset( $permissions[ $obj ][$p] ) )
-						$permissions_to_add[ $obj ][] = $p;
-
-
-			$p_add = 0;
-			$t_add = 0;
-
-			$p_del = 0;
-			$t_del = 0;
-
-			// cycle permissions to delete and delete them from db
-			foreach ( $permissions_to_del as $obj => $perms )
-				foreach ( array_values( $perms ) as $p ){
-
-					$this->resetAll();
-					$this->user_id        = $user_id;
-					$this->object         = $obj;
-					$this->object_action  = $p;
-
-					if ($this->delete()) $p_del++;
-					$t_del++;
-				}
-
-			// cycle permissions to add and insert them in db
-			foreach ( $permissions_to_add as $obj => $perms )
-				foreach ( array_values( $perms ) as $p ){
-
-					$this->resetAll();
-					$this->user_id        = $user_id;
-					$this->object         = $obj;
-					$this->object_action  = $p;
-
-					if ($this->insert()) $p_add++;
-					$t_add++;
-				}
-
-			if ($p_add == $t_add && $p_del == $t_del ) return true;
-			
-			return false;
-		}
-
-}
-
-?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -0,0 +1,653 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// set components path
+	YDConfig::set( 'YD_DBOBJECT_PATH', YD_DIR_HOME_ADD . '/YDCMComponent', false );
+
+	// add translations directory
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
+
+	// add YDF libs needed by this class
+	YDInclude( 'YDDatabaseObject.php' );
+	YDInclude( 'YDValidateRules.php' );
+	YDInclude( 'YDUtil.php' );
+	YDInclude( 'YDResult.php' );
+
+	// add YDCM libs
+	YDInclude( 'YDCMLanguages.php' );
+	YDInclude( 'YDCMTemplates.php' );
+	YDInclude( 'YDCMUserobject.php' );
+
+
+	// user class
+    class YDCMUser extends YDDatabaseObject {
+    
+        function YDCMUser() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUser' );
+
+			// register fields
+			$this->registerField( 'user_id' );
+			$this->registerField( 'username' );
+			$this->registerField( 'password' );
+			$this->registerField( 'name' );
+			$this->registerField( 'email' );			
+			$this->registerField( 'other' );	
+			$this->registerField( 'lang_id' );
+			$this->registerField( 'login_start' );
+			$this->registerField( 'login_end' );
+			$this->registerField( 'login_counter' );			
+			$this->registerField( 'login_last' );
+			$this->registerField( 'login_current' );
+			$this->registerField( 'template' );
+
+			// init relation with userobject
+            $rel = & $this->registerRelation( 'ydcmuserobject', false, 'ydcmuserobject' );
+			$rel->setLocalKey( 'user_id' );
+            $rel->setForeignKey( 'userobject_id' );
+
+			// init relation with languages table
+            $rel = & $this->registerRelation( 'ydcmlanguages', false, 'ydcmlanguages' );
+			$rel->setLocalKey( 'lang_id' );
+            $rel->setForeignKey( 'language_id' );
+		}
+
+
+        /**
+         *  This method checks if a username and password are valid
+         *
+         *  @param $username  User username
+         *  @param $password  User password (if password length is smaller than 32 we must md5 it, password form elements must have max 31)
+         *
+         *  @returns    user_id if valid, false otherwise
+         */
+		function valid( $username = '', $password = '' ){
+
+			// test username and password
+			if ( !YDValidateRules::alphanumeric( $username ) )   return false;
+			if ( !YDValidateRules::maxlength( $username, 100 ) ) return false;
+			if ( !YDValidateRules::alphanumeric( $password ) )   return false;
+			if ( !YDValidateRules::maxlength( $password, 32 ) )  return false;
+
+			// reset values
+			$this->resetAll();
+
+			// set username
+			$this->set( 'username', $username );
+
+			// if password is not in md5 format we must set it
+			if ( strlen( $password ) != 32 ) $password = md5( $password );
+
+			// set password
+			$this->set( 'password', $password );
+			
+			// check user state based on state and/or user login schedule
+			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
+
+			// relation with userobject
+			$this->load( 'ydcmuserobject' );
+			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
+
+			// test if we get just one user
+			if ( $this->find( 'ydcmuserobject' ) == 1 ) return intval( $this->get( 'user_id' ) );
+
+			return false;
+		}
+
+
+        /**
+         *  This method checks if a user ID is valid ( will check if user_id is on its 3 tables )
+         *
+         *  @param $user_id        User id
+         *
+         *  @returns    TRUE if valid, FALSE otherwise
+         */
+		function validID( $user_id ){
+		
+			// reset values
+			$this->resetAll();
+
+			// find all rows this user id
+			$this->where( 'user_id = ' . intval( $user_id ) );
+
+			// join all tables when finding (to check if user_id really belongs to all 3 tables)
+			return ( $this->findAll() == 1 );
+		}
+
+
+        /**
+         *  This method deletes a user (and all children) or just the children
+         *
+         *  @param $user_id        User id
+         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes user id and children, FALSE deletes children only
+         *
+         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
+         */
+		function deleteUser( $user_id, $includeParent = true ){
+		
+			// get ids to delete
+			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
+
+			// delete all permissions of this users
+			$this->perm->deletePermissions( $ids );
+
+			// delete node from users table
+			$this->tree->deleteNode( $user_id, $includeParent );
+		}
+
+
+        /**
+         *  This method adds form elements for user editing
+		 *
+		 * @param $user_id      User id to edit
+		 *
+		 * @param $editable     Array with form element names that are editable
+		 * @param $noneditable  (Optional) Array with form element names that are NOT editable
+		 * @param $translate    (Optional) User details should be translated
+         */
+		function addFormEdit( $id, $editable, $noneditable = array(), $translate = true ){
+
+		 	return $this->_addFormDetails( $id, true, $editable, $noneditable, $translate );
+		}
+
+
+        /**
+         *  This method adds form elements for addind a new user
+		 *
+		 * @param $parent_id    Group id of this new user
+		 * @param $editable     Array with form element names that are editable
+		 * @param $noneditable  (Optional) Array with form element names that are NOT editable
+		 * @param $translate    (Optional) User details should be translated
+         */
+		function addFormNew( $id, $editable, $noneditable = array(), $translate = true ){
+
+		 	return $this->_addFormDetails( $id, false, $editable, $noneditable, $translate );
+		}
+		 
+		
+        /**
+         *  Helper method for user management
+		 *
+		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
+         *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
+         *
+		 * @param $editable     Array with form element names that are editable
+		 *
+		 * @param $noneditable  Array with form element names that are NOT editable
+		 *
+		 * @param $translate    User details should be translated
+         */
+		function _addFormDetails( $id, $edit, $editable, $noneditable, $translate ){
+
+			YDInclude( 'YDForm.php' );
+
+			// init form
+			$this->_form = new YDForm( 'YDCMUsers' );
+
+			// check arguments
+			if ( !is_array( $editable ) ) $editable = array( $editable );
+			if ( !is_array( $noneditable ) ) $noneditable = array( $noneditable );
+
+			// add username
+			if ( in_array( 'username', $editable ) ){
+				$this->_form->addElement( 'text', 'username', t('user_username') );
+				$this->_form->addFormRule( array( & $this, '_checkuser' ), array( $edit, $id ) );
+
+			}else if ( in_array( 'username', $noneditable ) ){
+				$this->_form->addElement( 'span', 'username', t('user_username') );
+			}
+
+			// add password
+			if ( in_array( 'password', $editable ) ){
+				$this->_form->addElement( 'password', 'password', t('user_password') );				
+			}
+
+			// add state
+			if ( in_array( 'state', $editable ) ){
+				$this->_form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+				$this->_form->addElement( 'datetimeselect', 'login_start', t('login_start') );
+				$this->_form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
+
+			}else if ( in_array( 'state', $noneditable ) ){
+				$this->_form->addElement( 'span',           'state',       t('login_state') );
+				$this->_form->addElement( 'span',           'login_start', t('login_start') );
+				$this->_form->addElement( 'span',           'login_end',   t('login_end') );
+			}
+
+			// add common user details
+			if ( in_array( 'details', $editable ) ){
+				$this->_form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
+				$this->_form->addElement( 'text',      'email',         t('user_email') );
+				$this->_form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
+
+				$languages = new YDCMLanguages();
+				$languages = $languages->active();
+				$this->_form->addElement( 'select',    'lang_id',       t('user_language'), array(), $languages );
+
+				$templates = new YDCMTemplates();
+    	        $this->_form->addElement( 'select',    'template',      t('user_template'), array(), $templates->admin_templates() );
+
+				$this->_form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
+				$this->_form->addRule( 'email',       'email',          t('email not valid') );
+				$this->_form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
+				$this->_form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages ) );
+				$this->_form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
+
+			}else if ( in_array( 'details', $noneditable ) ){
+				$this->_form->addElement( 'span',      'name',          t('user_name') );
+				$this->_form->addElement( 'span',      'email',         t('user_email') );
+				$this->_form->addElement( 'span',      'other',         t('user_other') );
+				$this->_form->addElement( 'span',      'lang_id',       t('user_language') );
+				$this->_form->addElement( 'span',      'template',      t('user_template') );
+			}
+
+			// add access information
+			if ( in_array( 'access', $noneditable ) ){
+				$this->_form->addElement( 'span', 'login_counter', t('login_counter') );
+    	        $this->_form->addElement( 'span', 'login_last',    t('login_last') );
+    	        $this->_form->addElement( 'span', 'login_current', t('login_current') );
+			}
+
+			// if we are editing a user it's a good idea to set form defaults with user node attributes
+			if ( $edit ){
+
+				// add submit button
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+
+				// set form defaults based on user attributes
+				$this->_form->setDefaults( $this->getUser( $id, $translate ) );
+
+			}else{
+
+				// add submit button
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
+
+				// when adding a user, if login_end date exists we setup 7 days interval
+				if ( $this->_form->isElement( 'login_end' ) )
+					$this->_form->setDefault( 'login_end', time() + 7 * 24 * 3600 );
+			}
+
+		}
+
+        /**
+         *  Internal method to check if a username already exists 
+         */
+		function _checkuser( $values, $options ){
+
+			$this->resetAll();
+			
+			$this->set( 'username', $values[ 'username' ] );
+
+			// check if we are editing. if yes, we should check if the username is already used only by another user than current
+			if ( $options[0] == true )
+				$this->where( 'user_id != ' . intval( $options[1] ) );
+			
+			if ( $this->find() == 0 ) return true;
+			
+			return array( '__ALL__' => t( 'username exists' ) );
+		}
+
+
+        /**
+         *  This method updates user attributes
+         *
+         *  @param $id           User id to save attributes
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    YDResult object. OK      - form updated
+		 *                               WARNING - there are form errors
+         *                               FATAL   - was not possible to update
+         */
+		function saveFormEdit( $id, $formvalues = null ){
+
+			return $this->_saveFormDetails( $id, true, $formvalues );
+		}
+
+
+        /**
+         *  This method adds a new user
+         *
+         *  @param $parent_id    Parent id of this new user
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    YDResult object. OK      - form added
+		 *                               WARNING - there are form errors
+         *                               FATAL   - was not possible to add
+         */
+		function saveFormNew( $parent_id, $formvalues = null ){
+
+			return $this->_saveFormDetails( $parent_id, false, $formvalues );
+		}
+
+
+        /**
+         *  This method adds/saves a user
+         *
+         *  @param $id           If we are editing, $id is the user id. If we are adding, $id is the parent_id
+         *  @param $edit         Boolean flag that defines if we are editing $id or adding to $id
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    YDResult
+         */
+		function _saveFormDetails( $id, $edit, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->_form->validate( $formvalues ) )
+				return YDResult::warning( t( 'form errors' ), $this->_form->getErrors() );
+
+			// get form values EXCLUDING spans
+			$values = $this->_form->getValues();
+
+			// check if we are editing or adding an element
+			if ( $edit ){
+
+				// create userobject node
+				$userobject = array();
+				$userobject['type']  = 'YDCMUser';
+				if ( isset( $values[ 'name' ] ) )  $userobject['reference'] = $values[ 'name' ];
+				if ( isset( $values[ 'state' ] ) ) $userobject['state']     = $values[ 'state' ];
+
+				// update userobject
+				$uobj = new YDCMUserobject();
+				$res  = $uobj->updateNode( $userobject, $id );
+
+				// create user row
+				$user = array();
+				if ( isset( $values[ 'password' ] ) ) $user['password'] = md5( $values[ 'password' ] );
+				if ( isset( $values[ 'username' ] ) ) $user['username'] = $values[ 'username' ];
+				if ( isset( $values[ 'name' ] ) )     $user['name']     = $values[ 'name' ];
+				if ( isset( $values[ 'email' ] ) )    $user['email']    = $values[ 'email' ];
+				if ( isset( $values[ 'other' ] ) )    $user['other']    = $values[ 'other' ];
+				if ( isset( $values[ 'lang_id' ] ) )  $user['lang_id']  = $values[ 'lang_id' ];
+				if ( isset( $values[ 'template' ] ) ) $user['template'] = $values[ 'template' ];
+
+				// check login schedule dates
+				if ( isset( $user['login_start'] ) ) $user[ 'login_start' ] = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
+				if ( isset( $user['login_end'] ) )   $user[ 'login_end' ]   = YDStringUtil::formatDate( $values[ 'login_end' ], 'datetimesql' );
+
+				// update user
+				$this->resetValues();
+				$this->setValues( $user );
+				$this->where( 'user_id = '. $id ); 
+
+				$res = $this->update();
+				
+				// check update result and return
+				if ( $res > 0 ) return YDResult::ok( t( 'user details updated' ), $res );
+				else            return YDResult::warning( t( 'user not updated' ), $res );
+
+			}else{
+
+				// create userobject node
+				$userobject = array();
+				$userobject['type']      = 'YDCMUser';
+				$userobject['reference'] = $values[ 'name' ];
+				$userobject['state']     = isset( $values[ 'state' ] ) ? $values[ 'state' ] : 0;
+				
+				// update userobject and get new id
+				$uobj = new YDCMUserobject();
+				$res  = $uobj->addNode( $userobject, $id );
+
+				// create user row
+				$user = array();
+
+				// add REQUIRED values
+				$user[ 'user_id' ]       = $res;
+				$user[ 'password' ]      = md5( $values[ 'password' ] );
+				$user[ 'username' ]      = $values[ 'username' ];
+				$user[ 'lang_id' ]       = $values[ 'lang_id' ];
+				$user[ 'template' ]      = $values[ 'template' ];
+
+				$user[ 'name' ]          = isset( $values[ 'name' ] )  ? $values[ 'name' ]  : '';
+				$user[ 'email' ]         = isset( $values[ 'email' ] ) ? $values[ 'email' ] : '';
+				$user[ 'other' ]         = isset( $values[ 'other' ] ) ? $values[ 'other' ] : '';
+				$user[ 'login_counter' ] = 0;
+				$user[ 'login_start' ]   = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'login_end' ]     = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'login_last' ]    = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'login_current' ] = YDStringUtil::formatDate( 0, 'datetimesql' );
+
+				// reset object
+				$this->resetAll();
+
+				$this->setValues( $user );
+
+				// insert values
+				if ( $this->insert() ) return YDResult::ok( t( 'user added' ), $res );
+				else                   return YDResult::fatal( t( 'user not added' ), $res );
+			}
+
+		}
+
+
+        /**
+         *  This function adds form elements for password changing
+         *
+         * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
+         *                                 This box is used when the user wants to change its pass and not when we want to change another user pass
+         *                                 TRUE: include box; FALSE: don't include
+         */
+		function addFormPassword( $oldpassword = true ){
+
+			YDInclude( 'YDForm.php' );
+
+			// init form
+			$this->_form = new YDForm( 'YDCMUsers' );
+
+			// add new password box
+            $this->_form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
+			$this->_form->addRule(    'new',         'required',     t('passwords are required') );
+			$this->_form->addRule(    'new',         'maxlength',    t('passwords too big'), 31 );
+			$this->_form->addRule(    'new',         'alphanumeric', t('passwords not alphanumeric') );
+
+			// add new_confirm password box
+            $this->_form->addElement( 'password',    'new_confirm',  t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
+			$this->_form->addRule(    'new_confirm', 'required',     t('passwords are required') );
+			$this->_form->addRule(    'new_confirm', 'maxlength',    t('passwords too big'), 31 );
+			$this->_form->addRule(    'new_confirm', 'alphanumeric', t('passwords not alphanumeric') );
+
+			// add compare rule to new password and confirmation password
+			$this->_form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			// add old password box
+			if ( $oldpassword ){
+            	$this->_form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
+				$this->_form->addRule(    'old',      'required',     t('passwords are required') );
+				$this->_form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
+				$this->_form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
+			}
+		}
+
+
+        /**
+         *  This function updates a user password
+         *
+         *  @param $user_id     User id to update password
+         *  @param $formvalues  (Otional) Custom array with 2 passwords (new and new_confirm)
+         *
+         *  @returns    YDResult object. OK      - password updated
+		 *                               WARNING - there are form errors
+         *                               FATAL   - was not possible to update
+         */
+		function saveFormPassword( $user_id, $formvalues = null ){
+
+			// check form validation
+			if ( !$this->_form->validate( $formvalues ) )
+				return YDResult::warning( t( 'form errors' ), $this->_form->getErrors() );
+
+			// reset values
+			$this->resetAll();
+
+			// set new password
+			$this->set( 'password', md5( $this->_form->getValue( 'new' ) ) );
+
+			$this->where( 'user_id = ' . intval( $user_id ) );
+
+			// update user and get result
+			if ( $this->update() == 1 ) return YDResult::ok( t('user password updated') );
+			else                        return YDResult::fatal( t('password not updated') );
+		}
+
+
+        /**
+         *  This returns the user form
+         *
+         *  @param $defaults  (Optional) default values array to apply in form
+         *
+         *  @returns    YDForm object
+         */
+		function & getForm( $defaults = false ){
+
+			// check if we have form defaults and apply them
+			if ( is_array( $defaults ) ) $this->_form->setDefaults( $defaults );
+
+			return $this->_form;
+		}
+
+
+        /**
+         *  This method returns user attributes
+         *
+         *  @param      $user_id     User id or username
+         *  @param      $translate   (Optional) Boolean that defines if result must be translated
+         *
+         *  @returns    FALSE if user not found, user details array otherwise
+         */
+		function getUser( $user_id, $translate = false ){
+
+			$this->resetAll();
+
+			// set user id to search for
+			if ( is_numeric( $user_id ) ) $this->set( 'user_id',  intval( $user_id ) );
+			else                          $this->set( 'username', strval( $user_id ) );
+
+			// get all attributes
+			if ( $this->findAll() != 1 ) return false;
+
+			// password should be NOT visible
+			$this->set( 'password', '' );
+
+			// check if we want human readable elements
+			if ( $translate ){
+
+				// translate states
+				switch( intval( $this->get( 'ydcmuserobject_state' ) ) ){
+					case 0 : $this->set( 'ydcmuserobject_state', t('blocked') );
+							 $this->set( 'login_start',          t('not applicable') );
+							 $this->set( 'login_end',            t('not applicable') );
+							 break;
+					case 1 : $this->set( 'ydcmuserobject_state', t('active') );
+							 $this->set( 'login_start',          t('not applicable') );
+							 $this->set( 'login_end',            t('not applicable') );
+							 break;
+					case 2 : $this->set( 'ydcmuserobject_state', t('schedule') );
+							 break;
+				}
+
+			}
+
+			return $this->getValues();
+		}
+
+
+        /**
+         *  This method returns a specific user attribute
+         *
+         *  @param      $user_id     User id to use (instead of internal)
+         *  @param      $attribute   Attribute name string
+         *
+         *  @returns    FALSE if attribute not found, attribute string otherwise
+         */
+		function getUserAttribute( $user_id, $attribute ){
+
+			$this->resetValues();
+
+			// set user id
+			$this->set( 'user_id', intval( $user_id ) );
+
+			// get all attributes
+			if ( $this->find() != 1 ) return false;
+
+			return $this->get( $attribute );
+		}
+
+
+        /**
+         *  This function updates current user login details
+         *
+         *  @returns    true if user login details updated, false if user is not valid or details not updated
+         */
+		function updateLogin(){
+
+			$this->resetAll();
+			
+			// set our user_id for search
+			$this->set( 'user_id', $this->currentID() );
+
+			// get all attributes
+			$this->find();
+
+			// increase login counter value
+			$this->set( 'login_counter', 1 + $this->get( 'login_counter' ) );
+
+			// set last login date
+			$this->set( 'login_last', $this->get( 'login_current' ) );
+
+			// set current login
+			$this->set( 'login_current', YDStringUtil::formatDate( time(), 'datetimesql' ) );
+
+			// because we don't have a primary key we must do this
+			$this->where( 'user_id = ' . $this->get( 'user_id' ) );
+			
+			// return update result
+			if ( $this->update() == 1 ) return true;
+			
+			return false;
+		}
+		
+		
+        /**
+         *  This method returns the id of the current user if you use PHP_AUTH_USER and PHP_AUTH_PW for authentication
+         */
+		function currentID(){
+		
+			// check if user is valid and get user id
+			return $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
+		}
+
+
+    }
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -0,0 +1,184 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+	// add YD libs
+//	YDInclude( 'YDForm.php' );
+	YDInclude( 'YDDatabaseTree.php' );
+//	YDInclude( 'YDDatabaseObject.php' );
+	// add YDCM libs
+//	YDInclude( 'YDCMPermissions.php' );
+
+	// add local translation directory
+//	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
+
+
+    class YDCMUserobject extends YDDatabaseObject {
+    
+        function YDCMUserobject() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUserobject' );
+
+            // register custom key
+            $this->registerKey( 'userobject_id', true );
+
+			// register custom fields
+			$this->registerField( 'parent_id' );
+			$this->registerField( 'nleft' );
+			$this->registerField( 'nright' );
+			$this->registerField( 'nlevel' );
+			$this->registerField( 'position' );
+			$this->registerField( 'type' );			
+			$this->registerField( 'reference' );			
+			$this->registerField( 'state' );
+
+			// create tree object
+			$this->tree = new YDDatabaseTree( 'default', 'YDCMUserobject', 'userobject_id', 'parent_id', 'parent_id' );
+
+			// add tree fields
+			$this->tree->addField( 'parent_id' );
+			$this->tree->addField( 'type' );
+			$this->tree->addField( 'reference' );			
+			$this->tree->addField( 'state' );			
+		}
+
+
+        /**
+         *  This method returns all sub users of a userobject
+         *
+         *  @param  $parent_id   Parent id
+         *
+         *  @returns    Array with user and children nodes
+         */
+		function getTreeElements( $parent_id, $includeNode = true ){
+
+			return $this->tree->getDescendants( $parent_id, $includeNode );
+		}
+
+
+        /**
+         *  This method checks if a userobject is descendant of another
+         *
+         *  @param      $userobject_id User id to test if id descendant
+         *  @param      $parent_id     Parent id
+         *
+         *  @returns    boolean. TRUE if is descendant, FALSE if not descendant
+         */
+		function isDescendantOf( $userobject_id, $parent_id ){
+
+			return $this->tree->isDescendantOf( intval( $userobject_id ), intval( $parent_id ) );
+		}
+
+
+        /**
+         *  This method deletes a userobject (and all children) or just the children
+         *
+         *  @param $userobject_id  Userobject id
+         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes userobject id and children, FALSE deletes children only
+         *
+         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
+         */
+		function deleteUser( $userobject_id, $includeParent = true ){
+		
+			// delete node from users table
+			$this->tree->deleteNode( $userobject_id, $includeParent );
+		}
+
+
+        /**
+         *  This method adds a userobject
+         *
+         *  @param $values     Array with values
+         *  @param $parent_id  Parent id
+         *
+         *  @returns    node id
+         */
+		function addNode( $values, $parent_id ){
+		
+			// add node
+			return $this->tree->addNode( $values, $parent_id );
+		}
+
+
+        /**
+         *  This method updates a userobject
+         *
+         *  @param $values  Array with values
+         *  @param $id      Userobject id
+         *
+         *  @returns    $values
+         */
+		function updateNode( $values, $id ){
+		
+			// update node
+			return $this->tree->updateNode( $values, $id );
+		}
+
+
+        /**
+         *  This method moves all direct children of a node up
+         *
+         *  @param $userobject_id  Userobject id
+         *
+         *  @returns    TRUE, FALSE  TODO: convert to YDResult
+         */
+		function moveChildrenUp( $userobject_id ){
+		
+			// reset possible old stuff
+			$this->resetAll();
+
+			// get parent_id of this userobject
+			$this->set( 'userobject_id', intval( $userobject_id ) );
+
+			// check if user is valid
+			if ( $this->find() != 1 ) return false;
+
+			// save parent_id for future use
+			$parent_id = $this->get( 'parent_id ' );
+
+			// reset all previous class values
+			$this->resetAll();
+
+			// update all children to new parent_id
+			$this->set( 'parent_id', intval( $parent_id ) );
+			$this->where( 'parent_id', $userobject_id );
+
+			// update node
+			return $this->update();
+		}
+
+
+    }
+?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUsers.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -1,705 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-
-	// add YD libs
-	YDInclude( 'YDForm.php' );
-
-	// add YDCM libs
-	YDInclude( 'YDCMPermissions.php' );
-
-	// add local translation directory
-	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
-
-
-    class YDCMUsers extends YDDatabaseObject {
-    
-        function YDCMUsers() {
-        
-			// init DB object
-            $this->YDDatabaseObject();
-
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMUsers' );
-
-            // register custom key
-            $this->registerKey( 'user_id', true );
-
-			// register custom fields
-			$this->registerField( 'parent_id' );
-			$this->registerField( 'nleft' );
-			$this->registerField( 'nright' );
-			$this->registerField( 'nlevel' );
-			$this->registerField( 'username' );
-			$this->registerField( 'password' );
-			$this->registerField( 'name' );
-			$this->registerField( 'email' );			
-			$this->registerField( 'other' );			
-			$this->registerField( 'language_id' );
-			$this->registerField( 'state' );
-			$this->registerField( 'login_start' );
-			$this->registerField( 'login_end' );
-			$this->registerField( 'login_counter' );			
-			$this->registerField( 'login_last' );
-			$this->registerField( 'login_current' );
-			$this->registerField( 'created_user' );
-			$this->registerField( 'created_date' );
-			$this->registerField( 'template' );
-
-			// relation with languages table
-            $rel = & $this->registerRelation( 'ydcmlanguages', false, 'ydcmlanguages' );
-			$rel->setLocalKey( 'language_id' );
-            $rel->setForeignKey( 'language_id' );
-
-			// create tree object
-			$this->tree = new YDDatabaseTree( 'default', 'YDCMUsers', 'user_id', 'parent_id', 'parent_id' );
-
-			// add tree fields
-			$this->tree->addField( 'parent_id' );
-			$this->tree->addField( 'username' );
-			$this->tree->addField( 'password' );
-			$this->tree->addField( 'name' );
-			$this->tree->addField( 'email' );			
-			$this->tree->addField( 'other' );			
-			$this->tree->addField( 'language_id' );
-			$this->tree->addField( 'state' );			
-			$this->tree->addField( 'login_start' );
-			$this->tree->addField( 'login_end' );
-			$this->tree->addField( 'login_counter' );			
-			$this->tree->addField( 'login_last' );
-			$this->tree->addField( 'login_current' );
-			$this->tree->addField( 'type' );
-			$this->tree->addField( 'created_user' );
-			$this->tree->addField( 'created_date' );
-			$this->tree->addField( 'template' );
-
-			// init permissions
-			$this->perm = new YDCMPermissions();
-		}
-
-
-        /**
-         *  This method returns all sub users of a user
-         *
-         *  @param  $parent_id   Parent id
-         *
-         *  @returns    Array with user and children nodes
-         */
-		function getTreeElements( $parent_id ){
-
-			return $this->tree->getDescendants( $parent_id, true );
-		}
-
-
-        /**
-         *  This method checks if a user is descendant of another user
-         *
-         *  @param      $id          User id to test if id descendant
-         *  @param      $parent_id   Parent id
-         *
-         *  @returns    boolean. TRUE if is descendant, FALSE if not descendant
-         */
-		function isDescendantOf( $user_id, $parent_id ){
-
-			return $this->tree->isDescendantOf( intval( $user_id ), intval( $parent_id ) );
-		}
-
-
-        /**
-         *  This method checks if a username and password are valid
-         *
-         *  @param $username  User username
-         *  @param $password  User password (if password length is smaller than 32 we must md5 it, password form elements must have max 31)
-         *
-         *  @returns    true if valid, false otherwise
-         */
-		function valid( $username = '', $password = '' ){
-
-			// teste username and password rules
-			if (!YDValidateRules::alphanumeric(	$username))			return false;
-			if (!YDValidateRules::maxlength(	$username, 100))	return false;
-			if (!YDValidateRules::alphanumeric(	$password))			return false;
-			if (!YDValidateRules::maxlength(	$password, 32))		return false;
-
-			// reset values
-			$this->resetValues();
-
-			// set username
-			$this->username = $username;
-
-			// if password is not in md5 format we must set it
-			if ( strlen( $password ) != 32 ) $password = md5( $password );
-
-			// set password
-			$this->password = $password;
-			
-			// check user state based on state and/or user login schedule
-			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
-
-			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
-
-			// test if we get just one user
-			if ( $this->find() == 1 ) return true;
-
-			return false;
-		}
-
-
-        /**
-         *  This method deletes a user (and all children) or just the children
-         *
-         *  @param $user_id        User id
-         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes user id and children, FALSE deletes children only
-         *
-         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
-         */
-		function deleteUser( $user_id, $includeParent = true ){
-		
-			// get ids to delete
-			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
-
-			// delete all permissions of this users
-			$this->perm->deletePermissions( $ids );
-
-			// delete node from users table
-			$this->tree->deleteNode( $user_id, $includeParent );
-		}
-
-
-        /**
-         *  This method adds form elements for user editing
-		 *
-		 * @param $user_id      User id to edit
-		 *
-		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
-		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
-		 * 
-		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
-		 *                                 TRUE: is a box (editable); NULL: inexistent
-		 * 
-		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
-		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
-		 * 
-		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
-		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
-		 *
-		 * @param $accessinfo   (Optional) Defines if we want to include access information
-		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
-		 *
-		 * @param $permissionediting  (Optional) Defines if permissions are editable
-		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
-         */
-		function addFormEdit( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
-
-		 	return $this->_addFormDetails( $id, true, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
-		}
-
-
-        /**
-         *  This method adds form elements for addind a new user
-		 *
-		 * @param $parent_id    Parent id of this new user
-         *
-		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
-		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
-		 * 
-		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
-		 *                                 TRUE: is a box (editable); NULL: inexistent
-		 * 
-		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
-		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
-		 * 
-		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
-		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
-		 *
-		 * @param $accessinfo   (Optional) Defines if we want to include access information
-		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
-		 *
-		 * @param $permissionediting  (Optional) Defines if permissions are editable
-		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
-         */
-		function addFormNew( $id, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
-
-		 	return $this->_addFormDetails( $id, false, $username, $password, $logindetails, $userdetails, $accessinfo, $permissionediting );
-		}
-		 
-		
-        /**
-         *  Helper method for user management
-		 *
-		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
-         *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
-         *
-		 * @param $edit         If you are editing a user set TRUE. If you are adding a new user set FALSE
-		 *
-		 * @param $username     (Optional) Defines if the username is a box (editable), a span for information only or inexistent
-		 *                                 TRUE: is a box (editable); FALSE: is a span; NULL: inexistent
-		 * 
-		 * @param $password     (Optional) Defines if the password is a box (editable) or inexistent
-		 *                                 TRUE: is a box (editable); NULL: inexistent
-		 * 
-		 * @param $logindetails (Optional) Defines if login details are editable (eg: login schedule dates)
-		 *                                 TRUE: login details are editable; FALSE: login details are spans (just information); NULL: login details are inexistent
-		 * 
-		 * @param $userdetails  (Optional) Defines if user details are editable (eg: name, email, other info, template, language)
-		 *                                 TRUE: user details are editable; FALSE: user details are spans (just information); NULL: inexistent
-		 *
-		 * @param $accessinfo   (Optional) Defines if we want to include access information
-		 *                                 TRUE: include information (spans); FALSE or NULL: don't include
-		 *
-		 * @param $permissionediting  (Optional) Defines if permissions are editable
-		 *                                       TRUE: permissions are checkboxgroups; FALSE or NULL: inexistent
-         */
-		function _addFormDetails( $id, $edit, $username = null, $password = null, $logindetails = null, $userdetails = null, $accessinfo = null, $permissionediting = null ){
-
-			// init form
-			$this->form = new YDForm( 'YDCMUsers' );
-
-			// add username
-			if ( $username === true )       $this->form->addElement( 'text', 'username', t('user_username') );
-			else if ( $username === false ) $this->form->addElement( 'span', 'username', t('user_username') );
-
-			// add password
-			if ( $password === true ) $this->form->addElement( 'password', 'password', t('user_password') );
-
-			// add login details
-			if ( $logindetails === true ){
-				$this->form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-				$this->form->addElement( 'datetimeselect', 'login_start', t('login_start') );
-				$this->form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
-
-			}else if ( $logindetails === false ){
-				$this->form->addElement( 'span',           'state',       t('login_state') );
-				$this->form->addElement( 'span',           'login_start', t('login_start') );
-				$this->form->addElement( 'span',           'login_end',   t('login_end') );
-			}
-
-			// add common user details
-            if ( $userdetails === true ){
-				$this->form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
-				$this->form->addElement( 'text',      'email',         t('user_email') );
-				$this->form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
-
-				$languages = YDCMComponent::module( 'YDCMLanguages' );
-				$languages = $languages->active();
-				$this->form->addElement( 'select',    'language_id',   t('user_language'),      array(), $languages );
-
-				$templates = YDCMComponent::module( 'YDCMTemplates' );
-    	        $this->form->addElement( 'select',    'template',      t('user_template'),      array(), $templates->admin_templates() );
-
-				$this->form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
-				$this->form->addRule( 'email',       'email',          t('email not valid') );
-				$this->form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
-				$this->form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages ) );
-				$this->form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
-
-			}else if ( $userdetails === false ){
-				$this->form->addElement( 'span',      'name',          t('user_name') );
-				$this->form->addElement( 'span',      'email',         t('user_email') );
-				$this->form->addElement( 'span',      'other',         t('user_other') );
-				$this->form->addElement( 'span',      'language_id',   t('user_language') );
-				$this->form->addElement( 'span',      'template',      t('user_template') );
-			}
-
-			// add access information
-			if ( $accessinfo === true ){
-				$this->form->addElement( 'span', 'login_counter', t('login_counter') );
-    	        $this->form->addElement( 'span', 'login_last',    t('login_last') );
-    	        $this->form->addElement( 'span', 'login_current', t('login_current') );
-    	        $this->form->addElement( 'span', 'created_user',  t('created_user') );
-    	        $this->form->addElement( 'span', 'created_date',  t('created_date') );
-			}
-
-			// add submit button
-			if ( $edit ) $this->form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
-			else         $this->form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
-
-			// if we are editing a user it's a good idea to set form defaults with user node attributes
-			if ( $edit ){
-
-				// get user attributes
-				$node = $this->getUser( $id );
-
-				// set form defaults based on user attributes
-				$this->form->setDefaults( $node );
-			}
-
-
-			// PERMISSION CHECKBOXGROUPS
-//			if ( $permissionediting !== true ) return;
-
-			// check if we are editing or creating
-			if ( $edit ){
-
-				// on editing, permissions avaiable are the parent permissions ( parent of $id )
-				$permissions_avaiable = $this->perm->getPermissions( $node['parent_id'] );
-
-				// get current user permissions. We will need them to compare with parent permissions
-				$permissions = $node[ 'permissions' ];
-
-			// on adding, permissions avaiable are the parent permissions ( $id permissions )
-			}else{
-				$permissions_avaiable = $this->perm->getPermissions( $id );
-			}
-
-			// custom form variable that has the dynamic permissions checkboxgroups html
-			$this->form->permissions_html = array();
-
-			// cycle parent permissions to create form checkboxgroup for this user
-			foreach( $permissions_avaiable as $obj => $perm ){
-
-				// get permission translations of this component
-				YDLocale::addDirectory( YD_DIR_HOME_ADD . '/' . $obj . '/languages/' );
-
-				// init checkboxgroup options
-				$options  = array();
-				$selected = array();
-
-				// cycle all permissions of this object to create checkboxgroup options array
-				foreach( $perm as $p ){
-				
-					// add option with translated string
-					// eg, if we are in 'YDCMPage' object and action is 'delete' we will add ( YDCMPage => array( 'delete' => t('YDCMPage_delete') ) )
-					$options[ $p['object_action' ] ] = t( $obj . '_' . $p['object_action' ] );
-
-					// on editing we must check if this action is select of not ( checking if this action is in parent actions)
-					if ( $edit && isset( $permissions[ $obj ] ) && in_array( $p['object_action' ], array_keys( $permissions[ $obj ] ) )){
-						$selected[ $p['object_action' ] ] = 1;
-					}
-				}
-
-				// add object checkbox or spans
-				if ( $permissionediting === true )       $el = & $this->form->addElement( 'checkboxgroup', $obj, $obj, array(), $options );
-				else if ( $permissionediting === false ) $el = & $this->form->addElement( 'span', $obj, $obj );
-
-				// add default for this checkboxgroup if we are editing
-				if ( $edit ){
-					if ( $permissionediting === true )       $this->form->setDefault( $obj, $selected );
-					else if ( $permissionediting === false ) $this->form->setDefault( $obj, implode( '<br>', array_keys( $selected ) ) );
-				}
-
-				// this will store the checkboxgroups html in a variable for better templating placement
-				$this->form->permissions_html[ $obj ] = $el->toHtml();
-			}
-
-		}
-
-
-        /**
-         *  This method updates user attributes
-         *
-         *  @param $id           User id to save attributes
-         *  @param $created_user User id that wants to create this new user
-         *  @param $formvalues   (Optional) Custom array with user attributes
-         *
-         *  @returns    TRUE if updated, ARRAY with form errors otherwise
-         */
-		function saveFormEdit( $id, $created_user, $formvalues = null ){
-
-			return $this->_saveFormDetails( $id, true, $created_user, $formvalues );
-		}
-
-
-        /**
-         *  This method adds a new user
-         *
-         *  @param $parent_id    Parent id of this new user
-         *  @param $created_user User id that wants to create this new user
-         *  @param $formvalues   (Optional) Custom array with user attributes
-         *
-         *  @returns    TRUE if added, ARRAY with form errors otherwise
-         */
-		function saveFormNew( $parent_id, $created_user, $formvalues = null ){
-
-			return $this->_saveFormDetails( $parent_id, false, $created_user, $formvalues );
-		}
-
-
-        /**
-         *  This method adds/saves a user
-         *
-         *  @param $id           If we are editing $id is the user id. If we are adding, $id is the parent_id
-         *  @param $edit         Boolean flag that defines we we are editing $id or adding to $id
-         *  @param $created_user User id that wants to create this new user
-         *  @param $formvalues   (Optional) Custom array with user attributes
-         *
-         *  @returns    TRUE if updated, ARRAY with form errors otherwise
-         */
-		function _saveFormDetails( $id, $edit, $created_user, $formvalues = null ){
-
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			// get form values avaiable
-			$values = $this->form->getValues();
-		
-			// parse fixed values
-			$values['type']          = 'YDCMUseradministrator';
-			$values['nlevel']        = 1;
-			$values['created_user']  = intval( $created_user );
-			$values['created_date']  = YDStringUtil::formatDate( time(), 'datetimesql' );
-			$values['login_counter'] = 0;
-
-			// parse special elements
-			if ( $this->form->isElement( 'login_start' ) ) $values['login_start'] = YDStringUtil::formatDate( $values['login_start'], 'datetimesql' );
-			if ( $this->form->isElement( 'login_start' ) ) $values['login_end']   = YDStringUtil::formatDate( $values['login_end'],   'datetimesql' );
-			if ( $this->form->isElement( 'password' ) )    $values['password']    = md5( $values['password'] );
-
-			// check if we are editing or adding an element
-			if ( $edit ){
-
-				// update node to YDUsers table
-				$res = $this->tree->updateNode( $values, $id );
-	
-				// change user permissions in YDCMPermissions
-				return $this->perm->setPermissions( $id, $this->getUserAttribute( $id, 'parent_id' ), $values );
-			}else{
-			
-				// add node to YDUsers table
-				$newID = $this->tree->addNode( $values, $id );
-
-				// change user permissions in YDCMPermissions
-				return $this->perm->setPermissions( $newID, $id, $values );
-			}
-
-		}
-
-
-        /**
-         *  This function adds form elements for password changing
-         *
-         * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
-         *                                 This box is used when the user wants to change its pass and not when we want to change another user pass
-         *                                 TRUE: include box; FALSE: don't include
-         */
-		function addFormPassword( $oldpassword = true ){
-
-			// init form
-			$this->form = new YDForm( 'YDCMUsers' );
-
-			// add new password box
-            $this->form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
-			$this->form->addRule(    'new',         'required',     t('passwords are required') );
-			$this->form->addRule(    'new',         'maxlength',    t('passwords too big'), 31 );
-			$this->form->addRule(    'new',         'alphanumeric', t('passwords not alphanumeric') );
-
-			// add new_confirm password box
-            $this->form->addElement( 'password',    'new_confirm',  t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
-			$this->form->addRule(    'new_confirm', 'required',     t('passwords are required') );
-			$this->form->addRule(    'new_confirm', 'maxlength',    t('passwords too big'), 31 );
-			$this->form->addRule(    'new_confirm', 'alphanumeric', t('passwords not alphanumeric') );
-
-			// add compare rule to new password and confirmation password
-			$this->form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
-
-			// add old password box
-			if ( $oldpassword ){
-            	$this->form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
-				$this->form->addRule(    'old',      'required',     t('passwords are required') );
-				$this->form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
-				$this->form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
-			}
-		}
-
-
-        /**
-         *  This function updates a user password
-         *
-         *  @param $user_id     User id to update password
-         *  @param $formvalues  (Otional) Custom array with 2 passwords (new and new_confirm)
-         *
-         *  @returns    true if updated or array with form errors otherwise
-         */
-		function saveFormPassword( $user_id, $formvalues = null ){
-
-			// check form validation
-			if ( !$this->form->validate( $formvalues ) )
-				return $this->form->getErrors();
-
-			// reset values
-			$this->resetAll();
-
-			// set new password
-			$this->user_id  = intval( $user_id );
-			$this->password = md5( $this->form->getValue( 'new' ) );
-
-			// update user and get result
-			if ( $this->update() == 1 ) return true;
-
-			return false;
-		}
-
-
-        /**
-         *  This returns the user form
-         *
-         *  @param $defaults  (Optional) default values array to apply in form
-         *
-         *  @returns    YDForm object
-         */
-		function & getForm( $defaults = false ){
-
-			// check if we have form defaults and apply them
-			if ( is_array( $defaults ) ) $this->form->setDefaults( $defaults );
-
-			return $this->form;
-		}
-
-
-        /**
-         *  This method returns user attributes
-         *
-         *  @param      $user_id     User id to use (instead of internal)
-         *  @param      $translate   (Optional) Boolean that defines if result must be translated
-         *
-         *  @returns    User details
-         */
-		function getUser( $user_id, $translate = false ){
-
-			$this->resetValues();
-
-			// set user id
-			$this->user_id = intval( $user_id );
-
-			// get all attributes
-			if ( $this->findAll() != 1 ) return false;
-
-			// password should always empty
-			$this->password = '';
-
-			// check if we want human readable elements
-			if ( $translate ){
-
-				// check if state not schedule
-				if ( $this->state != 2 ){
-					$this->login_start = t('not applicable');
-					$this->login_end   = t('not applicable');
-				}
-
-				if ( $this->state == 0 )      $this->state = t('blocked');
-				else if ( $this->state == 1 ) $this->state = t('active');
-				else                          $this->state = t('schedule');
-
-				// check if user is root
-				if ( $this->created_user == 0 ){
-					$this->created_user = t('not applicable');
-					$this->created_date = t('not applicable');
-				}
-			}
-
-			// add permissions
-			$values = $this->getValues();
-			$values[ 'permissions' ] = $this->perm->getPermissions( intval( $user_id ) );
-			
-			return $values;
-		}
-
-
-        /**
-         *  This method returns a specific user attribute
-         *
-         *  @param      $user_id     User id to use (instead of internal)
-         *  @param      $attribute   Attribute string
-         *
-         *  @returns    User details
-         */
-		function getUserAttribute( $user_id, $attribute ){
-
-			$this->resetValues();
-
-			// set user id
-			$this->user_id = intval( $user_id );
-
-			// get all attributes
-			if ( $this->find() != 1 ) return false;
-
-			return $this->get( $attribute );
-		}
-
-
-        /**
-         *  This function updates current user login details
-         *
-         *  @returns    true if user login details updated, false if user is not valid or details not updated
-         */
-		function updateLogin(){
-
-			YDInclude( 'YDUtil.php' );
-
-			$this->resetValues();
-			
-			// get current user id
-			$res = $this->currentID();
-
-			// check if user exists
-			if ( $res == false ) return false;
-			
-			// get all attributes
-			$this->find();
-
-			// increase login value
-			$this->login_counter ++;
-
-			// set last login date
-			$this->login_last = $this->login_current;
-
-			// set current login
-			$this->login_current = YDStringUtil::formatDate( time(), 'datetimesql' );
-
-			// return update result
-			if ( $this->update() == 1 ) return true;
-			
-			return false;
-		}
-		
-		
-        /**
-         *  This method returns the id of the current user if you use PHP_AUTH_USER and PHP_AUTH_PW for authentication
-         */
-		function currentID(){
-		
-			// reset user values
-			$this->resetValues();
-		
-			// check if user is valid and get user id ( YDCMUsers::valid does it )
-			$valid = $this->valid( $_SERVER['PHP_AUTH_USER'], $_SERVER['PHP_AUTH_PW'] );
-
-			// if user is not valid we should return false
-			if ( $valid === false ) return false;
-
-			// return user id found by $this->valid
-			return $this->user_id;
-		}
-
-
-    }
-?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/en.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -47,6 +47,9 @@
 $GLOBALS['t']['password not updated'] = 'Password was not updated';
 $GLOBALS['t']['user not updated'] = 'User was not updated';
 $GLOBALS['t']['user added'] = 'New user added';
+$GLOBALS['t']['user not added'] = 'Impossible do add user';
+$GLOBALS['t']['username exists'] = 'User already exists';
+$GLOBALS['t']['administrator and move children up'] = 'Administrator and move children up';
 $GLOBALS['t']['administrator and children'] = 'Administrator and children';
 $GLOBALS['t']['children only'] = 'Children only';
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/pt.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -47,8 +47,11 @@
 $GLOBALS['t']['password not updated'] = 'A password n&atilde;o foi actualizada';
 $GLOBALS['t']['user not updated'] = 'O utilizador n&atilde;o foi actualizado';
 $GLOBALS['t']['user added'] = 'Utilizador adicionado';
-$GLOBALS['t']['administrator and children'] = 'Administrador e sub-administratores';
-$GLOBALS['t']['children only'] = 'Apenas sub-administratores';
+$GLOBALS['t']['user not added'] = 'Impossivel adicionar utilizador';
+$GLOBALS['t']['username exists'] = 'O utilizador ja existe';
+$GLOBALS['t']['administrator and move children up'] = 'Administrador e mover sub-admins para cima';
+$GLOBALS['t']['administrator and children'] = 'Administrador e sub-admins';
+$GLOBALS['t']['children only'] = 'Apenas sub-admins';
 
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -29,6 +29,8 @@
 $GLOBALS['t']['state'] = 'State';
 $GLOBALS['t']['add'] = 'Add';
 $GLOBALS['t']['add component'] = 'Add component';
+$GLOBALS['t']['add user'] = 'Add user';
+$GLOBALS['t']['add group'] = 'Add group';
 $GLOBALS['t']['move'] = 'Move';
 $GLOBALS['t']['move up'] = 'Move up';
 $GLOBALS['t']['move down'] = 'Move down';
@@ -61,4 +63,6 @@
 $GLOBALS['t']['audit'] = 'Audit';
 $GLOBALS['t']['user management'] = 'User management';
 $GLOBALS['t']['general configuration'] = 'General configuration';
+
+$GLOBALS['t']['form errors'] = 'Form errors';
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-09-04 08:15:31 UTC (rev 2070)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-09-04 16:38:40 UTC (rev 2071)
@@ -29,6 +29,8 @@
 $GLOBALS['t']['state'] = 'Estado';
 $GLOBALS['t']['add'] = 'Adicionar';
 $GLOBALS['t']['add component'] = 'Adicionar component';
+$GLOBALS['t']['add user'] = 'Adicionar utilizador';
+$GLOBALS['t']['add group'] = 'Adicionar grupo';
 $GLOBALS['t']['move'] = 'Mover';
 $GLOBALS['t']['move up'] = 'Mover para cima';
 $GLOBALS['t']['move down'] = 'Mover para baixo';
@@ -59,4 +61,8 @@
 $GLOBALS['t']['general configuration'] = 'Configura&ccedil;&atilde;o geral';
 
 
+
+
+
+$GLOBALS['t']['form errors'] = 'Erros no formulario';
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Mon Sep  4 18:44:15 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 18:44:15 +0200
Subject: [ydf-devel] r2072 - in YDFramework2.0/trunk/examples: . cm
	cm/backend
Message-ID: <200609041644.k84GiFS9030736@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 18:43:20 +0200 (Mon, 04 Sep 2006)
New Revision: 2072

Added:
   YDFramework2.0/trunk/examples/cm/backend/groups.php
   YDFramework2.0/trunk/examples/cm/backend/permissions.php
Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
   YDFramework2.0/trunk/examples/cm/cm.php
   YDFramework2.0/trunk/examples/cm/cm.sql
   YDFramework2.0/trunk/examples/index.tpl
Log:
- updated YDCMComponent examples:
  + updated user example for new db scheme
  * added group management example
  * added permission management example
  + updated DBDesigner4 scheme
  + updated cm.sql file

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-09-04 16:43:20 UTC (rev 2072)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="102" YPos="31" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="356" YPos="7" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="xpto" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -267,66 +267,6 @@
 <REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 </REGIONS>
 <TABLES>
-<TABLE ID="1158" Tablename="YDCMAudit" PrevTableName="admin_log" XPos="1100" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="2" >
-<COLUMNS>
-<COLUMN ID="1169" ColName="YDCMAudit_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement action">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1172" ColName="permission_id" PrevColName="action" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="action object">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1173" ColName="permission_result" PrevColName="itemid" Pos="5" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional action result">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1170" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="14" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of this action">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1754" ColName="date_time" PrevColName="" Pos="10" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date and time of this action">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1749" ColName="browser" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="browser codename">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1750" ColName="platform" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(20)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="operative system">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1751" ColName="url" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="url for visitors only">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1752" ColName="hits" PrevColName="" Pos="9" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Hits are used for visitors only (flood protection)">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-</COLUMNS>
-<RELATIONS_END>
-<RELATION_END ID="1785" />
-</RELATIONS_END>
-<INDICES>
-<INDEX ID="1176" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1169" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
-</TABLE>
 <TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
 <COLUMNS>
 <COLUMN ID="1732" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
@@ -335,13 +275,13 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1297" ColName="current_version" PrevColName="version" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="this is the current version of this page">
+<COLUMN ID="1297" ColName="current_version" PrevColName="" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="this is the current version of this page">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1181" ColName="html" PrevColName="content" Pos="2" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="page html">
+<COLUMN ID="1181" ColName="html" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="page html">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -379,9 +319,9 @@
 <RELATION_END ID="1704" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,NULL,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`cand!
 rag`,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPa!
 ge\a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-0!
 0 00:00:
00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`!
 ,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
+<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,0,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag!
 `,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPage\!
 a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 0!
 0:00:00\
a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`n!
 left`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
 <COLUMNS>
-<COLUMN ID="1191" ColName="content_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
+<COLUMN ID="1191" ColName="content_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -439,17 +379,17 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1204" ColName="searcheable" PrevColName="search" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component will be afected by visitors searches">
+<COLUMN ID="1204" ColName="searcheable" PrevColName="" Pos="14" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="component will be afected by visitors searches">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1206" ColName="published_date_start" PrevColName="date_start" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
+<COLUMN ID="1206" ColName="published_date_start" PrevColName="" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule start date (used when state is schedule)">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1207" ColName="published_date_end" PrevColName="date_end" Pos="17" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
+<COLUMN ID="1207" ColName="published_date_end" PrevColName="" Pos="17" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="schedule end date (used when state is schedule)">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -478,7 +418,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="460" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
+<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="480" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
 <COLUMNS>
 <COLUMN ID="1733" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -502,9 +442,9 @@
 <RELATION_END ID="1706" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="500" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="520" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
 <COLUMNS>
-<COLUMN ID="1219" ColName="language_id" PrevColName="lang" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
+<COLUMN ID="1219" ColName="language_id" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
@@ -520,7 +460,7 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1221" ColName="visitors_default" PrevColName="default_lang" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="this is the default language for visitors side. 1 true, 0 false">
+<COLUMN ID="1221" ColName="visitors_default" PrevColName="" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="this is the default language for visitors side. 1 true, 0 false">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -534,8 +474,8 @@
 </COLUMN>
 </COLUMNS>
 <RELATIONS_START>
-<RELATION_START ID="1366" />
 <RELATION_START ID="1693" />
+<RELATION_START ID="1877" />
 </RELATIONS_START>
 <INDICES>
 <INDEX ID="1290" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -547,13 +487,13 @@
 </TABLE>
 <TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="680" YPos="920" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
 <COLUMNS>
-<COLUMN ID="1231" ColName="search_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
+<COLUMN ID="1231" ColName="search_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1232" ColName="date" PrevColName="timestamp" Pos="2" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="search date">
+<COLUMN ID="1232" ColName="date" PrevColName="" Pos="2" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="search date">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -571,9 +511,9 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1168" Tablename="YDCMUsers" PrevTableName="users" XPos="800" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMRoot\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,1,\!
 a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUseradministrators\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,\a\a,\a\a,NULL,NULL,NULL,\aen\a,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\aYDCMUservisitors\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,\aadmin\a,\a21232f297a57a5a743!
 894a0e4a801fc3\a,\aAdmin\a,\aemail at host.com\a,\aother info\a,\!
 aen\a,1,
\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,40,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a,0,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,\afrancisco\a,\ab5d5f67b30809413156655abdda382a3\a,\aFrancisco Azevedo\a,\a\a,\a\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2004-05-08 05:05:06\a,19,\a2006-08-08 16:26:39\a,\a2006-08-08 17:18:19\a,2,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`templat!
 e`) VALUES (102,101,5,6,5,\apieter\a,\a\a,\aPieter\a,\a\a,\aaasdasdasd\a,\aen\a,1,\a2001-01-01 00:00:00\a,\a2001-01-01 00:00:00\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a0000-00-00 00:00:00\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,\adavid\a,\a\a,\aDavid\a,\a\a,\a\a,\aen\a,1,\a2006-08-08 16:27:35\a,\a2006-08-08 16:27:35\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101,\a2006-08-08 16:28:01\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`!
 ,`created_date`,`type`,`position`,`template`) VALUES (104,100,!
 12,17,4,
\apedro\a,\a\a,\aPedro Cerqueira\a,\a\a,\axpto\a,\aen\a,1,\a2006-08-08 16:29:51\a,\a2006-08-08 16:29:51\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:30:06\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,\alimpeza\a,\a\a,\aLimpeza\a,\a\a,\aasfdasdasdasd\a,\aen\a,1,\a2006-08-08 16:32:11\a,\a2006-08-08 16:32:11\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 16:32:26\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`crea!
 ted_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,\ameireles\a,\a\a,\aMeireles\a,\a\a,\ameireles\a,\aen\a,1,\a2006-08-08 17:14:44\a,\a2006-08-08 17:14:44\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-08 17:15:09\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,\amarc\a,\a\a,\aMarc\a,\a\a,\aVassoutinha\a,\aen\a,1,\a2006-08-09 15:57:27\a,\a2006-12-09 15:57:27\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 15:57:49\a,\aYDCMUseradministrator\a,1,\adefault\a);\nINSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_co!
 unter`,`login_last`,`login_current`,`created_user`,`created_da!
 te`,`typ
e`,`position`,`template`) VALUES (113,100,18,19,4,\aextra\a,\a\a,\aExtra user\a,\a\a,\auser OKuser OKuser OK\a,\aen\a,1,\a2006-08-09 16:13:57\a,\a2006-08-09 16:13:57\a,NULL,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100,\a2006-08-09 16:14:20\a,\aYDCMUseradministrator\a,1,\adefault\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
+<TABLE ID="1168" Tablename="YDCMUserobject" PrevTableName="users" XPos="780" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmuserobject` VALUES (1,0,  1,24,1,1, \aYDCMRoot\a, \a\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (2,1,  2,21,2,1, \aYDCMGroup\a, \aAdministrators\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (3,1,22,23,2,1, \aYDCMVisitor\a, \aVisitors\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (4,2,  3,20,3,1, \aYDCMUser\a,   \aadmin\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (5,4,  4,11,4,1, \aYDCMGroup\a, \amini admins\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (6,5,  5,  6,5,1, \aYDCMUser\a,   \apieter\a,1);\nINSERT INTO `ydcmuserobject` VALUES (7,5,  7,  8,5,1, \aYDCMUser\a,   \adavid\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (8,4,12, 17,4,1, \aYDCMGroup\a, \aspecial admins\a, 1 );\nINSERT INTO `ydcmuserobject` VALUES (9,  8,13, 14,5,1, \aYDCMUser\a,  \alimpeza\a, 1);\nINSERT INTO `ydc!
 muserobject` VALUES (10,8,15, 16,5,1, \aYDCMUser\a,  \ameireles\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (11,5,9,   10,5,1, \aYDCMUser\a,  \amarc\a,1);\nINSERT INTO `ydcmuserobject` VALUES (12,4,18, 19,4,1, \aYDCMGroup\a,   \aextra\a,1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
 <COLUMNS>
-<COLUMN ID="1238" ColName="user_id" PrevColName="id" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
+<COLUMN ID="1238" ColName="userobject_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -585,24 +525,19 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1758" ColName="type " PrevColName="type_2" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMVisitor\a" Comments="\aYDCMAdministrator\a or \aYDCMVisitor\a">
+<COLUMN ID="1240" ColName="nleft" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1240" ColName="nleft" PrevColName="path" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
-<OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1241" ColName="nright" PrevColName="position" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nright">
+<COLUMN ID="1241" ColName="nright" PrevColName="" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nright">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1242" ColName="nlevel" PrevColName="children" Pos="5" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nlevel">
+<COLUMN ID="1242" ColName="nlevel" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nlevel">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -614,89 +549,31 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1244" ColName="username" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1758" ColName="type " PrevColName="" Pos="19" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\aYDCMUser\a" Comments="\aYDCMUser\a or \aYDCMGroup\a">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1245" ColName="password" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1246" ColName="reference" PrevColName="" Pos="9" idDatatype="20" DatatypeParams="(100)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="just a node description">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1246" ColName="name" PrevColName="" Pos="9" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1250" ColName="state" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="node state">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1247" ColName="email" PrevColName="" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1248" ColName="other" PrevColName="" Pos="11" idDatatype="28" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="other user informations">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1249" ColName="language_id" PrevColName="language" Pos="12" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="language code for administration">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1795" ColName="template" PrevColName="" Pos="21" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\adefault\a" Comments="Administration template name ">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1250" ColName="state" PrevColName="" Pos="13" idDatatype="1" DatatypeParams="(1)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="user state">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1251" ColName="login_start" PrevColName="" Pos="14" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the start date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1252" ColName="login_end" PrevColName="" Pos="15" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="when state is schedule this is the end date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1255" ColName="login_counter" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="(11)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="login counter">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1256" ColName="login_last" PrevColName="" Pos="19" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="last login date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1257" ColName="login_current" PrevColName="" Pos="20" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="date of current session">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1254" ColName="created_user" PrevColName="" Pos="17" idDatatype="5" DatatypeParams="(20)" Width="0" Prec="0" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="id  of user that created this user">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1253" ColName="created_date" PrevColName="created" Pos="16" idDatatype="15" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="creation date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1383" />
 <RELATION_START ID="1436" />
 <RELATION_START ID="1410" />
-<RELATION_START ID="1741" />
-<RELATION_START ID="1784" />
+<RELATION_START ID="1861" />
+<RELATION_START ID="1867" />
+<RELATION_START ID="1870" />
 </RELATIONS_START>
-<RELATIONS_END>
-<RELATION_END ID="1366" />
-</RELATIONS_END>
 <INDICES>
 <INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
 <INDEXCOLUMNS>
@@ -705,7 +582,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,1,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\aa!
 ss local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,1,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat!
 =0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinke!
 dObject=
"0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
+<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,4,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\!
 a,NULL,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\n!
 RowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments=!
 "" Colla
psed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
 <COLUMNS>
 <COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -713,6 +590,12 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1838" ColName="userobject_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 <COLUMN ID="1734" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
@@ -729,12 +612,6 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1371" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
 <COLUMN ID="1372" ColName="subject" PrevColName="" Pos="2" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
@@ -747,22 +624,22 @@
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1379" ColName="reportedby_user" PrevColName="reported_by" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1379" ColName="reportedby_user" PrevColName="" Pos="9" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1380" ColName="reportedby_local" PrevColName="reported_to_in" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1380" ColName="reportedby_local" PrevColName="" Pos="10" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1381" ColName="reportedby_date" PrevColName="reported_to" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1381" ColName="reportedby_date" PrevColName="" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1676" ColName="reportedby_type" PrevColName="reported_by_type" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1676" ColName="reportedby_type" PrevColName="" Pos="16" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
@@ -811,7 +688,7 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1701" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1839" ColName="userobject_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -844,7 +721,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="500" YPos="320" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
+<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="460" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
 <COLUMNS>
 <COLUMN ID="1578" ColName="lock_id" PrevColName="" Pos="2" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="lock ID">
 <OPTIONSELECTED>
@@ -852,13 +729,13 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1432" ColName="content_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="component code">
+<COLUMN ID="1840" ColName="userobject_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1434" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="user id that lock component">
+<COLUMN ID="1432" ColName="content_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="component code">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -881,7 +758,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="660" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="680" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -967,20 +844,14 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_!
 id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`ver!
 sion_date`,`user_id`) VALUES (10,11,\aen\a,\aPortals\a,1,\a000!
 0-00-00 
00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a,100);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
+<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a);\!
 nINSERT INTO `ydcmcomp` VALUES (10,11,\aen\a,\aPortals\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
 <COLUMNS>
-<COLUMN ID="1680" ColName="component_id" PrevColName="title_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1680" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1745" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="User that created this element">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
 <COLUMN ID="1684" ColName="content_id" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
@@ -997,13 +868,13 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1683" ColName="version_default" PrevColName="rendered" Pos="2" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="This is the default version">
+<COLUMN ID="1683" ColName="version_default" PrevColName="" Pos="2" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="This is the default version">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1737" ColName="version_date" PrevColName="default_date" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Version created in this date">
+<COLUMN ID="1737" ColName="version_date" PrevColName="" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Version created in this date">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
@@ -1017,7 +888,6 @@
 <RELATIONS_END>
 <RELATION_END ID="1692" />
 <RELATION_END ID="1693" />
-<RELATION_END ID="1741" />
 </RELATIONS_END>
 <INDICES>
 <INDEX ID="1681" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
@@ -1027,62 +897,139 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1771" Tablename="YDCMPermissions" PrevTableName="Table_14" XPos="800" YPos="620" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (118,\aYDCMPage\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (120,\aYDCMPage\a,\adelete\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,101);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1"!
  Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1771" Tablename="YDCMPermission" PrevTableName="Table_14" XPos="1100" YPos="560" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` VALUES (2,\aYDCMRootmenu\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (2,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (2,\aYDCMPage\a,\acreate\a);\nINSERT INTO `ydcmpermissions` VALUES (5,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (5,\aYDCMPage\a,\acreate\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
-<COLUMN ID="1781" ColName="permission_id" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1969" ColName="permission_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1773" ColName="user_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1775" ColName="class" PrevColName="object" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1776" ColName="action" PrevColName="object_action" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\a\a," Comments="">
+<OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1775" ColName="object" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1870" />
+</RELATIONS_END>
+</TABLE>
+<TABLE ID="1800" Tablename="YDCMGroup" PrevTableName="Table_15" XPos="1100" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmgroup` VALUES (  2, \aAdministrators\a, \aCan do everything\a);\nINSERT INTO `ydcmgroup` VALUES (  3, \aVisitors\a, \aCan do nothing\a);\nINSERT INTO `ydcmgroup` VALUES (  5, \aMini admins\a, \aHave Admin user as leader\a);\nINSERT INTO `ydcmgroup` VALUES (  8, \aSpecial group\a, \aJust another group\a);\nINSERT INTO `ydcmgroup` VALUES (12, \aExtra group\a, \aAn empty group\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" >
+<COLUMNS>
+<COLUMN ID="1967" ColName="group_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1776" ColName="object_action" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1804" ColName="name" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
+<COLUMN ID="1859" ColName="description" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="\a\a," Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
 </COLUMNS>
-<RELATIONS_START>
-<RELATION_START ID="1785" />
-</RELATIONS_START>
 <RELATIONS_END>
-<RELATION_END ID="1784" />
+<RELATION_END ID="1867" />
 </RELATIONS_END>
-<INDICES>
-<INDEX ID="1782" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
-<INDEXCOLUMNS>
-<INDEXCOLUMN idColumn="1781" LengthParam="0" />
-</INDEXCOLUMNS>
-</INDEX>
-</INDICES>
 </TABLE>
+<TABLE ID="1842" Tablename="YDCMUser" PrevTableName="Table_16" XPos="1100" YPos="280" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO YDCMUser VALUES ( 4, \aadmin\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aAdmin name\a,\aemail at host.com\a,\aother info\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 6, \apieter\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aPieter C\a,\apieter at ydf.org\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 7, \adavid\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aDavid B\a,\adavid at mt.gmail.com\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES ( 9, \alimpeza\a, \a21232f297a57a5a7438!
 94a0e4a801fc3\a,\aLimpeza Park\a,\alp at lp.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES (10, \ameireles\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aMeireles dos Santos\a,\amlres at mlres.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES (11, \afrancisco\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aFrancisco A\a,\afa at mant.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
+<COLUMNS>
+<COLUMN ID="1965" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1846" ColName="username" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(100)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1847" ColName="password " PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(32)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1848" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1849" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1850" ColName="other" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1977" ColName="lang_id" PrevColName="" Pos="1" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1852" ColName="template" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1853" ColName="login_start" PrevColName="" Pos="8" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1854" ColName="login_end" PrevColName="" Pos="9" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1856" ColName="login_last" PrevColName="" Pos="11" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1857" ColName="login_current" PrevColName="" Pos="12" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="1855" ColName="login_counter" PrevColName="" Pos="10" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="0," Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="1861" />
+<RELATION_END ID="1877" />
+</RELATIONS_END>
+</TABLE>
 </TABLES>
 <RELATIONS>
-<RELATION ID="1366" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1168" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="38" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="52" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="19" />
-<RELATION ID="1383" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="5" EndIntervalOffsetY="-4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
+<RELATION ID="1383" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="userobject_id=userobject_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="8" StartIntervalOffsetY="-23" EndIntervalOffsetX="5" EndIntervalOffsetY="-4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
 <RELATION ID="1409" RelationName="post_id" Kind="2" SrcTable="1367" DestTable="1401" FKFields="post_id=post_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" />
-<RELATION ID="1436" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
-<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="31" CaptionOffsetY="-6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
+<RELATION ID="1436" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1430" FKFields="userobject_id=userobject_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="6" CaptionOffsetY="4" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1437" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1430" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="12" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="20" CaptionOffsetY="6" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="29" />
 <RELATION ID="1692" RelationName="content_id" Kind="2" SrcTable="1162" DestTable="1678" FKFields="content_id=content_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="-3" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-44" CaptionOffsetY="-24" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="47" />
-<RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="31" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
-<RELATION ID="1410" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
+<RELATION ID="1693" RelationName="language_id" Kind="2" SrcTable="1165" DestTable="1678" FKFields="language_id=language_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="25" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="19" CaptionOffsetY="-72" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="48" />
+<RELATION ID="1410" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1401" FKFields="userobject_id=userobject_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="5" CaptionOffsetY="3" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="14" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="28" />
 <RELATION ID="1704" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1160" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="43" />
 <RELATION ID="1706" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1163" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
 <RELATION ID="1709" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="-4" StartIntervalOffsetX="-2" StartIntervalOffsetY="-53" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 <RELATION ID="1712" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="1" CaptionOffsetY="1" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
-<RELATION ID="1741" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1678" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="4" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
-<RELATION ID="1784" RelationName="user_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="user_id=user_id\n" FKFieldsComments="\n" relDirection="3" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="-35" CaptionOffsetY="-26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" />
-<RELATION ID="1785" RelationName="permission_id" Kind="2" SrcTable="1771" DestTable="1158" FKFields="permission_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+<RELATION ID="1861" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1842" FKFields="userobject_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="4" CaptionOffsetY="26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
+<RELATION ID="1867" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1800" FKFields="userobject_id=group_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1870" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="userobject_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1877" RelationName="language_id" Kind="5" SrcTable="1165" DestTable="1842" FKFields="language_id=lang_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
 </RELATIONS>
 <NOTES>
 </NOTES>

Added: YDFramework2.0/trunk/examples/cm/backend/groups.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/groups.php	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/backend/groups.php	2006-09-04 16:43:20 UTC (rev 2072)
@@ -0,0 +1,92 @@
+<?php
+
+	// include global parameters
+    include_once( dirname( __FILE__ ) . '/../cm.php' );
+
+	// include libs
+    YDInclude( 'YDRequest.php' );
+	YDInclude( 'YDCMGroup.php' );
+
+
+    // Class definition
+    class groups extends YDRequest {
+
+        // Class constructor
+        function groups() {
+
+			// init parent class
+            $this->YDRequest();
+
+			// create a group object
+			$this->groups = new YDCMGroup();
+        }
+
+
+        // Default action (that shows group details)
+        function actionDefault() {
+
+			// get group 2
+			YDDebugUtil::dump( $this->groups->getGroup( 2 ), '$this->groups->getGroup( 2 );' );
+
+			// get group 4 (don't exist because node is a user)
+			YDDebugUtil::dump( $this->groups->getGroup( 4 ), '$this->groups->getGroup( 4 ); // 4 is a user' );
+
+			// get group with name 'Administrators'
+			YDDebugUtil::dump( $this->groups->getGroup( 'Administrators' ), '$this->groups->getGroup( "Administrators" );' );
+        }
+
+
+        // Edit group example
+        function actionEdit() {
+
+			// add editing form of group id 2
+			$this->groups->addFormEdit( 2 );
+
+			// get form
+			$form = & $this->groups->getForm();
+
+			// if form is not submitted just show it
+			if ( ! $form->isSubmitted() ) return $form->display();
+
+			// update user 6 with submitted information, magic isn't it ;)
+			$result = $this->groups->saveFormEdit( 2 );
+
+			// print result message
+			if ( $result->ok ) print( 'OK: ' . $result->message );
+			else               print( 'Error: ' . $result->message );
+
+			// display form again
+			$form->display();
+        }
+
+
+		// this action will add a new group
+		function actionNew(){
+
+			// add form for adding a new user
+			$this->groups->addFormNew();
+
+			// get form
+			$form = & $this->groups->getForm();
+
+			// if form is not submitted just show it
+			if ( ! $form->isSubmitted() ) return $form->display();
+
+			// add group
+			$result = $this->groups->saveFormNew(4);
+			
+			// print result message
+			if ( $result->ok ) print( 'OK: ' . $result->message );
+			else               print( 'Error: ' . $result->message );
+
+			// display form again
+			$form->display();
+		}
+
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Added: YDFramework2.0/trunk/examples/cm/backend/permissions.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-04 16:43:20 UTC (rev 2072)
@@ -0,0 +1,76 @@
+<?php
+
+	// include global parameters
+    include_once( dirname( __FILE__ ) . '/../cm.php' );
+
+	// include libs
+    YDInclude( 'YDRequest.php' );
+	YDInclude( 'YDCMPermission.php' );
+
+
+    // Class definition
+    class permissions extends YDRequest {
+
+        // Class constructor
+        function permissions() {
+
+			// init parent class
+            $this->YDRequest();
+
+			// create a permissions object
+			$this->perms = new YDCMPermission();
+
+			// register system permissions (read: define here all possible permissions)
+			$this->perms->registerAction( 'YDCMPage',  'create' );
+			$this->perms->registerAction( 'YDCMPage',  'delete' );
+			$this->perms->registerAction( 'YDCMGroup', 'add' );
+			$this->perms->registerAction( 'YDCMGroup', 'edit' );
+        }
+
+
+        // Default action
+        function actionDefault() {
+
+            print(" In our database we have the next permission system:              <br>
+                    INSERT INTO `ydcmpermission` VALUES (2,'YDCMRootmenu','delete'); <br>
+                    INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','delete');     <br>
+                    INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','create');     <br>
+                    INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','delete');     <br>
+                    INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','create');     ");
+
+			// check if userobject 2 can 'YDCMPage'+'delete'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'delete' ), "$this->perms->can( 2, 'YDCMPage', 'delete' );  // check if userobject 2 can 'YDCMPage'+'delete'" );
+
+			// check if userobject 5 can 'YDCMPage'+'add'
+			YDDebugUtil::dump( $this->perms->can( 5, 'YDCMPage', 'add' ), "$this->perms->can( 5, 'YDCMPage', 'add' );  // check if userobject 5 can 'YDCMPage'+'add'" );
+
+			// check if userobject 2 can 'YDCMRootmenu'+'delete'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMRootmenu', 'delete' ), "$this->perms->can( 2, 'YDCMRootmenu', 'delete' );  // action is in DB but its NOT registered" );
+
+			// get permissions of userobject 2
+			YDDebugUtil::dump( $this->perms->getPermissions( 2 ), "$this->perms->getPermissions( 2 );" );
+
+			// get translated permissions of userobject 5
+			YDDebugUtil::dump( $this->perms->getPermissions( 5, true ), "$this->perms->getPermissions( 5, true );  // translated permissions" );
+
+			// get registered system actions
+			YDDebugUtil::dump( $this->perms->getRegisteredActions(), "$this->perms->getRegisteredActions();  // get registered system actions" );
+
+			// delete all actions of userobject 10
+			YDDebugUtil::dump( $this->perms->deletePermissions( 10 ), "$this->perms->deletePermissions( 10 );  // try to delete all permissions of userobject 10. userobject do NOT exist" );
+
+			// add permission 'YDCMPage'+'create' to userobject 8
+			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'create' ), "$this->perms->addPermission( 8, 'YDCMPage', 'create' );  // add permission 'YDCMPage'+'create' to userobject 8" );
+
+			// add permission 'YDCMPage'+'publish' to userobject 8
+			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'publish' ), "$this->perms->addPermission( 8, 'YDCMPage', 'publish' );  // 'YDCMPage'+'publish' is not registered" );
+		}
+
+
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-04 16:43:20 UTC (rev 2072)
@@ -1,37 +1,48 @@
 <?php
 
+	// include global parameters
     include_once( dirname( __FILE__ ) . '/../cm.php' );
 
-	YDInclude( 'YDCMUsers.php' );
+    YDInclude( 'YDRequest.php' );
+	YDInclude( 'YDCMUser.php' );
 
+
     // Class definition
-    class userdetails extends cm {
+    class userdetails extends YDRequest {
 
         // Class constructor
         function userdetails() {
 
 			// init parent class
-            $this->cm();
+            $this->YDRequest();
 
 			// create a user object
-			$this->users = new YDCMUsers();
+			$this->users = new YDCMUser();
         }
 
 
         // Default action (that shows user details form with some editable fields)
         function actionDefault() {
 
-			// get user id 101 details and display them
-			YDDebugUtil::dump( $this->users->getUser( 101, true ), '$this->users->getUser( 101, true )' );
+			// get user 6 
+			YDDebugUtil::dump( $this->users->getUser( 6 ), '$this->users->getUser( 6 );' );
+
+			// get user 4 (with details translated)
+			YDDebugUtil::dump( $this->users->getUser( 4, true ), '$this->users->getUser( 4, true ); // details translated' );
+
+			// get user 3 (don't exist because node is a group)
+			YDDebugUtil::dump( $this->users->getUser( 3 ), '$this->users->getUser( 3 ); // 3 is a group' );
+
+			// get user with username 'francisco'
+			YDDebugUtil::dump( $this->users->getUser( 'francisco' ), '$this->users->getUser( "francisco" );' );
         }
 
 
         // Edit user example
         function actionEdit() {
 
-			// add editing form of user 101.
-			// user cannot edit username, cannot see password, cannot see login details, can edit user details, cannot see access info, cann edit permissions
-			$this->users->addFormEdit( 101, false, null, null, true, null, true );
+			// add editing form (with details edition) with defaults of user 6
+			$this->users->addFormEdit( 6, 'details' );
 
 			// get form
 			$form = & $this->users->getForm();
@@ -39,26 +50,23 @@
 			// if form is not submitted just show it
 			if ( ! $form->isSubmitted() ) return $form->display();
 
-			// update user 101 with submitted information, magic isn't it ;) 100 is our id (created user, for loggin)
-			$result = $this->users->saveFormEdit( 101, 100 );
+			// update user 6 with submitted information, magic isn't it ;)
+			$result = $this->users->saveFormEdit( 6 );
 
-			// check if result is a array (form error messages)
-			if ( is_array( $result ) ) return $form->display();
+			// print result message
+			if ( $result->ok ) print( 'OK: ' . $result->message );
+			else               print( 'Error: ' . $result->message );
 
-			// if update was sucessfull, show ok message in current language
-			if ( $result == 1 ) return print( t( 'user details updated' ) );
-
-			// if form is valid but details are not changed (because are same as the db ones)
-			if ( $result == 0 ) return print( t( 'user not updated' ) );
+			// display form again
+			$form->display();
         }
 
 
 		// this action will add a new sub-user of the root (super-administrator: id 100)
 		function actionNew(){
 
-			// add form for adding a new user as child of user 100. 
-			// user can edit username, can edit password, can edit login details, can edit user details, cannot see access info, can edit permissions
-			$this->users->addFormNew( 100, true, true, true, true, null, true );
+			// add form for adding a new user to group 2
+			$this->users->addFormNew( 2, array( 'username', 'password', 'state', 'details' ) );
 
 			// get form
 			$form = & $this->users->getForm();
@@ -66,14 +74,15 @@
 			// if form is not submitted just show it
 			if ( ! $form->isSubmitted() ) return $form->display();
 
-			// add user ( 1st argument 100: parent of new user is 100; 2nd arg 100: we (user id that is creating this element) have id 100
-			$result = $this->users->saveFormNew( 100, 100 );
+			// add user to group 2
+			$result = $this->users->saveFormNew( 2 );
 			
-			// check if result has form errors
-			if ( is_array( $result ) ) return $form->display();
+			// print result message
+			if ( $result->ok ) print( 'OK: ' . $result->message );
+			else               print( 'Error: ' . $result->message );
 
-			// if creation is sucessfull, show ok message in current language
-			print( t( 'user added' ) );
+			// display form again
+			$form->display();
 		}
 
 

Modified: YDFramework2.0/trunk/examples/cm/cm.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.php	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/cm.php	2006-09-04 16:43:20 UTC (rev 2072)
@@ -1,16 +1,12 @@
 <?php
 
-    // Initialize the Yellow Duck Framework
+    // initialize the Yellow Duck Framework
     include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
 
-    // Includes
-    YDInclude( 'YDRequest.php' );
-    YDInclude( 'YDTemplate.php' );
-    YDInclude( 'YDDatabase.php' );
-    YDInclude( 'YDCMComponent.php' );
+	YDInclude( 'YDDatabase.php' );
 
     // set YDDatabase instance connection
-    YDDatabase::registerInstance( 'default', 'mysql', 'ph', 'root', '', 'localhost' );
+    YDDatabase::registerInstance( 'default', 'mysql', 'xpto', 'root', '', 'localhost' );
 
 	// set portal language. Currently you can user 'en' and 'pt'.
 	YDLocale::set( 'en' );
@@ -18,15 +14,4 @@
 	// set admin template path
 	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', dirname( __FILE__ ) . '/backend/templates' );
 
-    // Class definition for the index request
-    class cm extends YDRequest {
-
-        // Class constructor
-        function cm() {
-
-            $this->YDRequest();
-            $this->template = new YDTemplate();
-        }
-
-    }
 ?>

Modified: YDFramework2.0/trunk/examples/cm/cm.sql
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.sql	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/cm/cm.sql	2006-09-04 16:43:20 UTC (rev 2072)
@@ -1,10 +1,3 @@
-CREATE TABLE YDCMStatistics_downloads (
-  download_is INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  date DATETIME NULL,
-  filename VARCHAR(255) NULL,
-  PRIMARY KEY(download_is)
-);
-
 CREATE TABLE YDCMLanguages (
   language_id VARCHAR(255) NOT NULL,
   name VARCHAR(50) NOT NULL,
@@ -18,13 +11,6 @@
 INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('pt','Portugu?s',1,0,0);
 
 
-CREATE TABLE YDCMStatistics_searches (
-  search_id INTEGER(10) NOT NULL AUTO_INCREMENT,
-  date DATETIME NOT NULL,
-  word VARCHAR(255) NOT NULL,
-  PRIMARY KEY(search_id)
-);
-
 CREATE TABLE YDCMTree (
   content_id INTEGER(10) NOT NULL AUTO_INCREMENT,
   parent_id INTEGER UNSIGNED NULL,
@@ -44,7 +30,7 @@
   PRIMARY KEY(content_id)
 );
 
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,NULL,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,0,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
@@ -57,105 +43,115 @@
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 
 
-CREATE TABLE YDCMUsers (
-  user_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+CREATE TABLE YDCMStatistics_downloads (
+  download_is INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  date DATETIME NULL,
+  filename VARCHAR(255) NULL,
+  PRIMARY KEY(download_is)
+);
+
+CREATE TABLE YDCMStatistics_searches (
+  search_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+  date DATETIME NOT NULL,
+  word VARCHAR(255) NOT NULL,
+  PRIMARY KEY(search_id)
+);
+
+CREATE TABLE YDCMUserobject (
+  userobject_id INTEGER(10) NOT NULL AUTO_INCREMENT,
   parent_id INTEGER UNSIGNED NOT NULL,
-  type  VARCHAR(100) NOT NULL DEFAULT 'YDCMVisitor',
   nleft INTEGER NOT NULL,
   nright INTEGER NOT NULL,
   nlevel INTEGER NOT NULL,
   position INTEGER UNSIGNED NULL DEFAULT 1,
-  username VARCHAR(100) NOT NULL,
-  password VARCHAR(100) NOT NULL,
-  name VARCHAR(255) NULL,
-  email VARCHAR(255) NULL,
-  other TEXT NULL,
-  language_id VARCHAR(255) NOT NULL,
-  template VARCHAR(255) NULL DEFAULT 'default',
+  type  VARCHAR(100) NOT NULL DEFAULT 'YDCMUser',
+  reference VARCHAR(100) NULL,
   state TINYINT(1) NOT NULL,
-  login_start DATETIME NOT NULL,
-  login_end DATETIME NOT NULL,
-  login_counter INTEGER(11) NULL,
-  login_last DATETIME NOT NULL,
-  login_current DATETIME NOT NULL,
-  created_user INTEGER(20) NULL,
-  created_date DATETIME NOT NULL,
-  PRIMARY KEY(user_id),
-  FOREIGN KEY(language_id)
-    REFERENCES YDCMLanguages(language_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION
+  PRIMARY KEY(userobject_id)
 );
 
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (1,0,1,24,1,'','',NULL,NULL,NULL,'en',0,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMRoot',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (2,1,2,21,2,'','',NULL,NULL,NULL,'en',1,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMUseradministrators',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (3,1,22,23,2,'','',NULL,NULL,NULL,'en',0,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',NULL,'0000-00-00 00:00:00','YDCMUservisitors',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (100,2,3,20,3,'admin','21232f297a57a5a743894a0e4a801fc3','Admin','email at host.com','other info','en',1,'1970-01-01 00:00:00','1970-01-01 00:00:00',40,'2006-08-15 16:34:08','2006-08-15 16:35:51',0,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (101,100,4,11,4,'francisco','b5d5f67b30809413156655abdda382a3','Francisco Azevedo','','','en',1,'2001-01-01 00:00:00','2004-05-08 05:05:06',19,'2006-08-08 16:26:39','2006-08-08 17:18:19',2,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (102,101,5,6,5,'pieter','','Pieter','','aasdasdasd','en',1,'2001-01-01 00:00:00','2001-01-01 00:00:00',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'0000-00-00 00:00:00','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (103,101,7,8,5,'david','','David','','','en',1,'2006-08-08 16:27:35','2006-08-08 16:27:35',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',101,'2006-08-08 16:28:01','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (104,100,12,17,4,'pedro','','Pedro Cerqueira','','xpto','en',1,'2006-08-08 16:29:51','2006-08-08 16:29:51',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 16:30:06','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (105,104,13,14,5,'limpeza','','Limpeza','','asfdasdasdasd','en',1,'2006-08-08 16:32:11','2006-08-08 16:32:11',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 16:32:26','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (108,104,15,16,5,'meireles','','Meireles','','meireles','en',1,'2006-08-08 17:14:44','2006-08-08 17:14:44',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-08 17:15:09','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (111,101,9,10,5,'marc','','Marc','','Vassoutinha','en',1,'2006-08-09 15:57:27','2006-12-09 15:57:27',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-09 15:57:49','YDCMUseradministrator',1,'default');
-INSERT INTO `ydcmusers` (`user_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`username`,`password`,`name`,`email`,`other`,`language_id`,`state`,`login_start`,`login_end`,`login_counter`,`login_last`,`login_current`,`created_user`,`created_date`,`type`,`position`,`template`) VALUES (113,100,18,19,4,'extra','','Extra user','','user OKuser OKuser OK','en',1,'2006-08-09 16:13:57','2006-08-09 16:13:57',NULL,'0000-00-00 00:00:00','0000-00-00 00:00:00',100,'2006-08-09 16:14:20','YDCMUseradministrator',1,'default');
+INSERT INTO `ydcmuserobject` VALUES (1,0,  1,24,1,1, 'YDCMRoot', '', 1);
+INSERT INTO `ydcmuserobject` VALUES (2,1,  2,21,2,1, 'YDCMGroup', 'Administrators', 1);
+INSERT INTO `ydcmuserobject` VALUES (3,1,22,23,2,1, 'YDCMVisitor', 'Visitors', 1);
+INSERT INTO `ydcmuserobject` VALUES (4,2,  3,20,3,1, 'YDCMUser',   'admin', 1);
+INSERT INTO `ydcmuserobject` VALUES (5,4,  4,11,4,1, 'YDCMGroup', 'mini admins', 1);
+INSERT INTO `ydcmuserobject` VALUES (6,5,  5,  6,5,1, 'YDCMUser',   'pieter',1);
+INSERT INTO `ydcmuserobject` VALUES (7,5,  7,  8,5,1, 'YDCMUser',   'david', 1);
+INSERT INTO `ydcmuserobject` VALUES (8,4,12, 17,4,1, 'YDCMGroup', 'special admins', 1 );
+INSERT INTO `ydcmuserobject` VALUES (9,  8,13, 14,5,1, 'YDCMUser',  'limpeza', 1);
+INSERT INTO `ydcmuserobject` VALUES (10,8,15, 16,5,1, 'YDCMUser',  'meireles', 1);
+INSERT INTO `ydcmuserobject` VALUES (11,5,9,   10,5,1, 'YDCMUser',  'marc',1);
+INSERT INTO `ydcmuserobject` VALUES (12,4,18, 19,4,1, 'YDCMGroup',   'extra',1);
 
 
-CREATE TABLE YDCMPermissions (
-  permission_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  user_id INTEGER(10) NOT NULL,
-  object VARCHAR(255) NOT NULL,
-  object_action VARCHAR(255) NOT NULL,
-  PRIMARY KEY(permission_id),
-  FOREIGN KEY(user_id)
-    REFERENCES YDCMUsers(user_id)
+CREATE TABLE YDCMPermission (
+  permission_id INTEGER(10) NOT NULL,
+  class VARCHAR(255) NOT NULL,
+  action VARCHAR(255) NOT NULL DEFAULT '',
+  FOREIGN KEY(permission_id)
+    REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
 );
 
-INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (117,'YDCMRootmenu','delete',100);
-INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (118,'YDCMPage','delete',100);
-INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (119,'YDCMPage','create',100);
-INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (120,'YDCMPage','delete',101);
-INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (121,'YDCMPage','create',101);
+INSERT INTO `ydcmpermission` VALUES (2,'YDCMRootmenu','delete');
+INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','delete');
+INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','create');
+INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','delete');
+INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','create');
 
 
-CREATE TABLE YDCMAudit (
-  YDCMAudit_id INTEGER NOT NULL AUTO_INCREMENT,
-  permission_id INTEGER UNSIGNED NOT NULL,
-  permission_result VARCHAR(255) NULL,
-  date DATE NOT NULL,
-  date_time DATETIME NOT NULL,
-  browser VARCHAR(20) NULL,
-  platform VARCHAR(20) NULL,
-  url VARCHAR(255) NULL,
-  hits INTEGER UNSIGNED NULL,
-  PRIMARY KEY(YDCMAudit_id),
-  FOREIGN KEY(permission_id)
-    REFERENCES YDCMPermissions(permission_id)
+CREATE TABLE YDCMGroup (
+  group_id INTEGER(10) NOT NULL,
+  name VARCHAR(255) NOT NULL,
+  description VARCHAR(255) NULL DEFAULT '',
+  FOREIGN KEY(group_id)
+    REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
 );
 
-CREATE TABLE YDCMLocks (
-  lock_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  content_id INTEGER(10) NOT NULL,
+INSERT INTO `ydcmgroup` VALUES (  2, 'Administrators', 'Can do everything');
+INSERT INTO `ydcmgroup` VALUES (  3, 'Visitors', 'Can do nothing');
+INSERT INTO `ydcmgroup` VALUES (  5, 'Mini admins', 'Have Admin user as leader');
+INSERT INTO `ydcmgroup` VALUES (  8, 'Special group', 'Just another group');
+INSERT INTO `ydcmgroup` VALUES (12, 'Extra group', 'An empty group');
+
+
+CREATE TABLE YDCMUser (
   user_id INTEGER(10) NOT NULL,
-  datetime  DATETIME NOT NULL,
-  PRIMARY KEY(lock_id),
+  username VARCHAR(100) NOT NULL,
+  password  VARCHAR(32) NOT NULL,
+  name VARCHAR(255) NULL,
+  email VARCHAR(255) NULL,
+  other TEXT NULL,
+  lang_id VARCHAR(255) NOT NULL,
+  template VARCHAR(255) NULL,
+  login_start DATETIME NULL,
+  login_end DATETIME NULL,
+  login_last DATETIME NULL,
+  login_current DATETIME NULL,
+  login_counter INTEGER UNSIGNED NULL DEFAULT 0,
   FOREIGN KEY(user_id)
-    REFERENCES YDCMUsers(user_id)
+    REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION,
-  FOREIGN KEY(content_id)
-    REFERENCES YDCMTree(content_id)
+  FOREIGN KEY(lang_id)
+    REFERENCES YDCMLanguages(language_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
 );
 
+INSERT INTO YDCMUser VALUES ( 4, 'admin', '21232f297a57a5a743894a0e4a801fc3','Admin name','email at host.com','other info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
+INSERT INTO YDCMUser VALUES ( 6, 'pieter', '21232f297a57a5a743894a0e4a801fc3','Pieter C','pieter at ydf.org','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
+INSERT INTO YDCMUser VALUES ( 7, 'david', '21232f297a57a5a743894a0e4a801fc3','David B','david at mt.gmail.com','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51'); 
+INSERT INTO YDCMUser VALUES ( 9, 'limpeza', '21232f297a57a5a743894a0e4a801fc3','Limpeza Park','lp at lp.xpto','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51'); 
+INSERT INTO YDCMUser VALUES (10, 'meireles', '21232f297a57a5a743894a0e4a801fc3','Meireles dos Santos','mlres at mlres.xpto','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
+INSERT INTO YDCMUser VALUES (11, 'francisco', '21232f297a57a5a743894a0e4a801fc3','Francisco A','fa at mant.xpto','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
+
+
 CREATE TABLE YDCMComp (
   component_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  user_id INTEGER(10) NOT NULL,
   content_id INTEGER(10) NOT NULL,
   language_id VARCHAR(255) NULL,
   title VARCHAR(255) NULL,
@@ -169,29 +165,41 @@
   FOREIGN KEY(language_id)
     REFERENCES YDCMLanguages(language_id)
       ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+);
+
+INSERT INTO `ydcmcomp` VALUES (1,5,'en','Apache friends',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (2,6,'en','PostGre en',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (3,6,'pt','PostGre pt',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (4,7,'en','mySql howto',1,'2000-01-01 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (5,7,'pt','ajuda mySql',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (6,9,'en','Databases we use',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (7,9,'pt','Bases de dados',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (8,10,'en','Generators help',1,'2000-01-01 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (9,10,'pt','Ajuda sobre geradores',1,'2002-02-02 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (10,11,'en','Portals',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (11,11,'pt','Portais',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (12,8,'en','Menu Links',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (13,8,'pt','O meu menu de atalhos',1,'0000-00-00 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (14,10,'en','Gener',0,'3002-02-02 00:00:00');
+
+
+CREATE TABLE YDCMLocks (
+  lock_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  userobject_id INTEGER(10) NOT NULL,
+  content_id INTEGER(10) NOT NULL,
+  datetime  DATETIME NOT NULL,
+  PRIMARY KEY(lock_id),
+  FOREIGN KEY(userobject_id)
+    REFERENCES YDCMUserobject(userobject_id)
+      ON DELETE NO ACTION
       ON UPDATE NO ACTION,
-  FOREIGN KEY(user_id)
-    REFERENCES YDCMUsers(user_id)
+  FOREIGN KEY(content_id)
+    REFERENCES YDCMTree(content_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
 );
 
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (1,5,'en','Apache friends',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (2,6,'en','PostGre en',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (3,6,'pt','PostGre pt',1,'0000-00-00 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (4,7,'en','mySql howto',1,'2000-01-01 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (5,7,'pt','ajuda mySql',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (6,9,'en','Databases we use',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (7,9,'pt','Bases de dados',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (8,10,'en','Generators help',1,'2000-01-01 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (9,10,'pt','Ajuda sobre geradores',1,'2002-02-02 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (10,11,'en','Portals',1,'0000-00-00 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (11,11,'pt','Portais',1,'0000-00-00 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (12,8,'en','Menu Links',1,'0000-00-00 00:00:00',101);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (13,8,'pt','O meu menu de atalhos',1,'0000-00-00 00:00:00',100);
-INSERT INTO `ydcmcomp` (`component_id`,`content_id`,`language_id`,`title`,`version_default`,`version_date`,`user_id`) VALUES (14,10,'en','Gener',0,'3002-02-02 00:00:00',100);
-
-
 CREATE TABLE YDCMPage (
   component_id INTEGER UNSIGNED NOT NULL,
   current_version TINYINT(1) NULL,
@@ -250,10 +258,10 @@
 
 CREATE TABLE YDCMHelpdesk_posts (
   post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  userobject_id INTEGER(10) NOT NULL,
   component_id INTEGER UNSIGNED NOT NULL,
   state_id VARCHAR(255) NULL,
   urgency_id VARCHAR(255) NULL,
-  user_id INTEGER(10) NOT NULL,
   subject TEXT NULL,
   text TEXT NULL,
   creation_date DATETIME NOT NULL,
@@ -266,8 +274,8 @@
   assignedto_date DATETIME NOT NULL,
   assignedto_type VARCHAR(255) NULL,
   PRIMARY KEY(post_id),
-  FOREIGN KEY(user_id)
-    REFERENCES YDCMUsers(user_id)
+  FOREIGN KEY(userobject_id)
+    REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION,
   FOREIGN KEY(component_id)
@@ -276,15 +284,15 @@
       ON UPDATE NO ACTION
 );
 
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',1,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',1,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,'1','1',1,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`user_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,'1','1',1,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',4,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',4,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
 
 
 CREATE TABLE YDCMHelpdesk_response (
   response_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  user_id INTEGER(10) NOT NULL,
+  userobject_id INTEGER(10) NOT NULL,
   post_id INTEGER UNSIGNED NOT NULL,
   date DATETIME NULL,
   description TEXT NULL,
@@ -293,8 +301,8 @@
     REFERENCES YDCMHelpdesk_posts(post_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION,
-  FOREIGN KEY(user_id)
-    REFERENCES YDCMUsers(user_id)
+  FOREIGN KEY(userobject_id)
+    REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
 );

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-09-04 16:38:40 UTC (rev 2071)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-09-04 16:43:20 UTC (rev 2072)
@@ -270,7 +270,7 @@
             </td>
         </tr>
         <tr>
-            <td valign="top"><a href="form_checkboxgroup.php">Using the checkboxgroup elementL</a></td>
+            <td valign="top"><a href="form_checkboxgroup.php">Using the checkboxgroup element</a></td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=form_checkboxgroup.php">form_checkboxgroup.php</a>
                 <br/>
@@ -720,7 +720,7 @@
           <td><b>&nbsp;</b></td>
         </tr>
         <tr>
-          <td valign="top" rowspan="4">&nbsp;</td>
+          <td valign="top" rowspan="6">&nbsp;</td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/instructions.txt">Instructions (database and configuration) </a></td>
           <td valign="top">&nbsp;</td>
         </tr>
@@ -731,9 +731,21 @@
           <td colspan="2" valign="top"><strong>Backend examples</strong></td>
         </tr>
         <tr>
-          <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php">User management ( details, add )</a><br/>
+          <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php">User management ( how to get details )</a><br>
+&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php?do=edit">User management ( edit a user )</a><br>
+&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php?do=new">User management ( add a new user )</a><br/></td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/userdetails.php">cm/backend/userdetails.php</a> </td>
+        </tr>
+        <tr>
+          <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/groups.php">Groups ( how to get details )</a><br>
+&nbsp;&nbsp;&nbsp;<a href="cm/backend/groups.php?do=edit">Groups ( edit a group )</a><br>
+&nbsp;&nbsp;&nbsp;<a href="cm/backend/groups.php?do=new">Groups ( add a new group )</a><br/></td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/groups.php">cm/backend/groups.php</a> </td>
+        </tr>
+        <tr>
+          <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php">Permissions ( register, check, add, delete )</a><br>
           </td>
-          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/userdetails.php">cm/backend/userdetails.php</a> </td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/permissions.php">cm/backend/permissions.php</a> </td>
           </tr>
         <tr>
             <td colspan="2"><b>&nbsp;<br/>YDXml</b></td>
@@ -751,11 +763,27 @@
             </td>
         </tr>
         <tr>
+          <td colspan="2"><b>&nbsp;<br/>
+            YDError and YDResult </b></td>
+          <td><b>&nbsp;</b></td>
+        </tr>
+        <tr>
+          <td valign="top">&nbsp;</td>
+          <td valign="top"><a href="error.php">Using the YDError class</a></td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=error.php">error.php</a> </td>
+        </tr>
+        <tr>
+          <td valign="top">&nbsp;</td>
+          <td valign="top"><a href="result.php">YDResult class (OK result)</a><br>
+          <a href="result.php?do=errors">YDResult class (FATAL result)</a></td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=result.php">result.php</a></td>
+        </tr>
+        <tr>
             <td colspan="2"><b>&nbsp;<br/>Other classes and modules</b></td>
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="16" valign="top">&nbsp;</td>
+            <td rowspan="15" valign="top">&nbsp;</td>
             <td valign="top"><a href="constants.php">YDFramework2 constants</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=constants.php">constants.php</a>
@@ -820,12 +848,6 @@
             </td>
         </tr>
         <tr>
-            <td valign="top"><a href="error.php">Using the YDError class</a></td>
-            <td valign="top">
-                <a href="{$YD_SELF_SCRIPT}?do=source&id=error.php">error.php</a>
-            </td>
-        </tr>
-        <tr>
             <td valign="top"><a href="guidutil.php">Using the YDGuidUtil class</a></td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=guidutil.php">guidutil.php</a>



From ximian at mail.berlios.de  Mon Sep  4 18:45:56 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 18:45:56 +0200
Subject: [ydf-devel] r2073 - in YDFramework2.0/trunk/examples: . cm/backend
Message-ID: <200609041645.k84GjuM6031501@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 18:45:19 +0200 (Mon, 04 Sep 2006)
New Revision: 2073

Added:
   YDFramework2.0/trunk/examples/result.php
Removed:
   YDFramework2.0/trunk/examples/cm/backend/returns.php
Log:
- moved YDResult example from cm examples to generic examples dir

Deleted: YDFramework2.0/trunk/examples/cm/backend/returns.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/returns.php	2006-09-04 16:43:20 UTC (rev 2072)
+++ YDFramework2.0/trunk/examples/cm/backend/returns.php	2006-09-04 16:45:19 UTC (rev 2073)
@@ -1,93 +0,0 @@
-<?php
-
-    include_once( dirname( __FILE__ ) . '/../cm.php' );
-
-    // Class definition
-    class returns extends cm {
-
-        // Class constructor
-        function returns() {
-
-			// init parent class and test class
-            $this->cm();
-			$this->test = new mytest();
-        }
-
-
-        // Default action, demonstrates the simplest way of handle results
-        function actionDefault() {
-
-			// try to div by 0
-			$res = $this->test->div( 10 );
-			
-			// check if div processing was ok or we get errors
-			if ( $res->ok ) print $res->message;
-			else            print 'ERROR: ' . $res->message;
-        }
-
-
-        // Check error types
-        function actionErrors() {
-
-			// set internal test 5 ;) (we will get an error)
-			$this->test->set( 5 );
-
-			// try to div by 10
-			$res = $this->test->div( 10 );
-			
-			// check if div processing was ok
-			if ( $res->ok ) return print $res->message . ' ' . $res->value;
-
-			// get error
-			if ( $res->custom == 0 ){
-
-				// do something about 'x' argument being 0
-				print $res->message;
-			}
-
-			if ( $res->custom == 1 ){
-
-				// do something about internal 'a' variable being 5
-				print $res->message;
-			}
-
-			// in any case of error, show all information
-			$res->dump();
-        }
-
-
-    }
-
-
-	class mytest{
-	
-		function mytest(){
-			$this->a = 10;
-		}
-
-
-		function set( $a ){
-			$this->a = $a;
-		}
-
-
-		function div( $x ){
-		
-			// test if internal x is valid and test if $x is valid
-			if ( $x == 0 )       return YDResult::fatal( 'Argument cannot be zero', 0 );
-			if ( $this->a == 5 ) return YDResult::fatal( 'Internal value cannot be five :D', 1);
-			
-			// compute result value
-			$result = ( $this->a / 10 );
-			
-			// return a ok result
-			return YDResult::ok( 'Div made with sucess!', $result );
-		}
-
-	}
-	
-
-    // Process the request
-    YDInclude( 'YDF2_process.php' );
-
-?>

Added: YDFramework2.0/trunk/examples/result.php
===================================================================
--- YDFramework2.0/trunk/examples/result.php	2006-09-04 16:43:20 UTC (rev 2072)
+++ YDFramework2.0/trunk/examples/result.php	2006-09-04 16:45:19 UTC (rev 2073)
@@ -0,0 +1,83 @@
+<?php
+
+    // ydf include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+	YDInclude( 'YDRequest.php' );
+	YDInclude( 'YDResult.php' );
+
+
+    // Class definition
+    class result extends YDRequest {
+
+        // Class constructor
+        function result() {
+
+			// init parent class and test class
+            $this->YDRequest();
+			$this->test = new mytest();
+        }
+
+
+        // Default action, demonstrates the simplest way of handle results
+        function actionDefault() {
+
+			// try to div by 0
+			$res = $this->test->div( 10 );
+			
+			// check if div processing was ok or we get errors
+			if ( $res->ok ) print $res->message;
+			else            print 'ERROR: ' . $res->message;
+        }
+
+
+        // Check error types
+        function actionErrors() {
+
+			// set internal test 5 ;) (we will get an error)
+			$this->test->set( 5 );
+
+			// try to div by 10
+			$res = $this->test->div( 10 );
+			
+			// check if div processing was ok
+			if ( $res->ok ) return print $res->message . ' ' . $res->value;
+			else            return $res->dump();
+        }
+
+
+    }
+
+
+	class mytest{
+	
+		function mytest(){
+			$this->a = 10;
+		}
+
+
+		function set( $a ){
+			$this->a = $a;
+		}
+
+
+		function div( $x ){
+		
+			// test if internal x is valid and test if $x is valid
+			if ( $x == 0 )       return YDResult::fatal( 'Argument cannot be zero', 0 );
+			if ( $this->a == 5 ) return YDResult::fatal( 'Internal value cannot be five :D', 1);
+			
+			// compute result value
+			$result = ( $this->a / 10 );
+			
+			// return a ok result
+			return YDResult::ok( 'Div made with sucess!', $result );
+		}
+
+	}
+	
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>



From ximian at mail.berlios.de  Mon Sep  4 20:16:13 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 20:16:13 +0200
Subject: [ydf-devel] r2074 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609041816.k84IGDl0032190@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 20:15:44 +0200 (Mon, 04 Sep 2006)
New Revision: 2074

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
- YDDatabaseTree::updateNode now returns the total lines (nodes) affected

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-09-04 16:45:19 UTC (rev 2073)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2006-09-04 18:15:44 UTC (rev 2074)
@@ -743,7 +743,7 @@
          *  @param $values      The field values of the node.
          *  @param $id          (optional) The ID of the node to update.
          *
-         *  @returns    The values of the node that is updated.
+         *  @returns    Total of lines affected
          */
         function updateNode( $values, $id=null ) {
 
@@ -760,18 +760,18 @@
             $id = empty( $id ) ? $values['id'] : $id;
 
             // Perform the insert
-            $this->db->executeUpdate(
+            $res = $this->db->executeUpdate(
                 $this->table, $values, sprintf( '%s = %s', $idField, $this->db->escapeSql( $id ) )
             );
 
             // Rebuild the tree
             $this->rebuild();
 
-            // Return the node
-            return $values;
-
+            // Return total of lines affected
+            return $res;
         }
 
+
         /**
          *  Delete the node and it's children.
          *



From ximian at mail.berlios.de  Mon Sep  4 20:54:02 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 20:54:02 +0200
Subject: [ydf-devel] r2075 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609041854.k84Is2eZ010585@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 20:53:41 +0200 (Mon, 04 Sep 2006)
New Revision: 2075

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
- new feature YDForm::addRule can apply a rule to all form elements when argument is '__ALL__'.

Eg: $form->addRule( '__ALL__', 'required', ... );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-04 18:15:44 UTC (rev 2074)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-04 18:53:41 UTC (rev 2075)
@@ -546,13 +546,16 @@
          *  Add a rule to the form for the specified field.
          *
          *  @param  $element    The element to apply the rule on. If you specify an array, it will add the rule for each
-         *                      element in the array.
+         *                      element in the array. If you specify '__ALL__', it will add the rule to all form elements
          *  @param  $rule       The name of the rule to apply.
          *  @param  $error      The error message to show if an error occured.
          *  @param  $options    (optional) The options to pass to the validator function.
          */
         function addRule( $element, $rule, $error, $options=null ) {
 
+			// Check if element is special element '__ALL__'
+			if ( is_string( $element) && $element == '__ALL__' ) $element = array_keys( $this->_elements );
+
             // Check if the element is an array or not
             if ( is_array( $element ) ) {
 



From ximian at mail.berlios.de  Mon Sep  4 23:08:15 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 23:08:15 +0200
Subject: [ydf-devel] r2076 - in
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent: .
	languages languages/YDCMGroup languages/YDCMUser
Message-ID: <200609042108.k84L8Fl0027724@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 23:07:28 +0200 (Mon, 04 Sep 2006)
New Revision: 2076

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/pt.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php
Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUsers/
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
Log:
modification on YDCMComponent:
   - translated strings are now uniform
   - YDCMGroup _saveFormDetails checks if update was made in userobject node too.
   - YDCMGroup now uses state form element correctly
   - added YDCMGroup translation strings
   - simplification of adding forms for editing/creating users in YDCMUser

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -110,12 +110,10 @@
          *  This method adds form elements for group editing
 		 *
 		 * @param $group_id     Group id to edit
-		 *
-		 * @param $editable     (Optional) Boolean flag that defines if elements are editable
          */
-		function addFormEdit( $group_id, $editable = true ){
+		function addFormEdit( $group_id ){
 
-		 	return $this->_addFormDetails( $group_id, true, $editable );
+		 	return $this->_addFormDetails( $group_id, true );
 		}
 
 
@@ -126,7 +124,7 @@
          */
 		function addFormNew( $parent_group_id = null ){
 
-		 	return $this->_addFormDetails( $parent_group_id, false, true );
+		 	return $this->_addFormDetails( $parent_group_id, false );
 		}
 		 
 		
@@ -137,44 +135,38 @@
          *                      If you will ADD a new group this is the parent id. Use NULL to add it to the root tree
          *
 		 * @param $edit         TRUE: We are editing a group, FALSE: we are creating a group
-		 *
-		 * @param $editable     When editing a group, this boolean flag defines if form elements are editable (default true)
          */
-		function _addFormDetails( $id, $edit, $editable ){
+		function _addFormDetails( $id, $edit ){
 
 			YDInclude( 'YDForm.php' );
 
 			// init form
 			$this->_form = new YDForm( 'YDCMGroup' );
 
-			// add name and drecription
-			if ( $editable ){
-				$this->_form->addElement( 'text',     'name',        t( 'group name' ) );
-				$this->_form->addElement( 'textarea', 'description', t( 'group description' ), array( 'rows' => 4, 'cols' => 40 ) );
-				$this->_form->addElement( 'select',   'state',       t( 'group state' ), array(), array( 0 => t( 'Blocked' ), 1 => t( 'Active' ) ) );
+			// add elements
+			$this->_form->addElement( 'text',     'name',        t( 'ydcmgroup label name' ) );
+			$this->_form->addElement( 'textarea', 'description', t( 'ydcmgroup label description' ), array( 'rows' => 4, 'cols' => 40 ) );
+			$this->_form->addElement( 'select',   'state',       t( 'ydcmgroup label state' ), array(), array( 0 => t( 'Blocked' ), 1 => t( 'Active' ) ) );
 
-				$this->_form->addFormRule( array( & $this, '_checkgroup' ), array( $edit, $id ) );
+			// add rules
+			$this->_form->addFormRule( array( & $this, '_checkgroup' ), array( $edit, $id ) );
 
-			}else{
-				$this->_form->addElement( 'span', 'name',        t( 'group name' ) );
-				$this->_form->addElement( 'span', 'description', t( 'group description' ) );
+
+			// if we are not editing a group, just add a submit button and return
+			if ( ! $edit ){
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label new' ) );
+				return;
 			}
 
-			// if we are editing a group, set form defaults
-			if ( $edit ){
+			// if we are editing, set defaults and add a submit button
+			$defaults = $this->getGroup( $id );
+			$this->_form->setDefaults( $defaults );
 
-				// add submit button
-				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+			// state default is 'ydcmuserobject_state' because it's on userobject table
+			$this->_form->setDefault( 'state', $defaults[ 'ydcmuserobject_state' ] );
 
-				// set form defaults based on user attributes
-				$this->_form->setDefaults( $this->getGroup( $id ) );
-
-			}else{
-
-				// add submit button
-				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
-			}
-
+			// add submit button
+			$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label save' ) );
 		}
 
 
@@ -193,7 +185,7 @@
 			
 			if ( $this->find() == 0 ) return true;
 			
-			return array( '__ALL__' => t( 'group exists' ) );
+			return array( '__ALL__' => t( 'ydcmgroup mess group exists' ) );
 		}
 
 
@@ -254,7 +246,7 @@
 				$userobject = array();
 				$userobject['type']  = 'YDCMGroup';
 				$userobject['reference'] = $values[ 'name' ];
-//				$userobject['state']     = $values[ 'state' ];
+				$userobject['state']     = $values[ 'state' ];
 
 				// update userobject
 				$uobj = new YDCMUserobject();
@@ -270,11 +262,12 @@
 				$this->setValues( $group );
 				$this->where( 'group_id = '. $id ); 
 
-				$res = $this->update();
+				// updated and sum lines afected to userobject lines afected
+				$res += $this->update();
 				
-				// check update result and return
-				if ( $res > 0 ) return YDResult::ok( t( 'group details updated' ), $res );
-				else            return YDResult::warning( t( 'group not updated' ), $res );
+				// check update from node update and from group update
+				if ( $res > 0 ) return YDResult::ok( t( 'ydcmgroup mess details updated' ), $res );
+				else            return YDResult::warning( t( 'ydcmgroup mess details not updated' ), $res );
 
 			}else{
 
@@ -282,12 +275,12 @@
 				$userobject = array();
 				$userobject['type']      = 'YDCMGroup';
 				$userobject['reference'] = $values[ 'name' ];
-				$userobject['state']     = isset( $values[ 'state' ] ) ? $values[ 'state' ] : 0;
+				$userobject['state']     = $values[ 'state' ];
 
 				// check default parent id
 				if ( is_null( $id ) ) $id = 1;
 
-				// TODO: check if group is valid (and, eg,  is not a user node)
+				// TODO: check if group is valid (and, eg, is not a user node)
 
 				// update userobject and get new id
 				$uobj = new YDCMUserobject();
@@ -304,8 +297,8 @@
 				$this->setValues( $group );
 
 				// insert values
-				if ( $this->insert() ) return YDResult::ok( t( 'group added' ), $res );
-				else                   return YDResult::fatal( t( 'group not added' ), $res );
+				if ( $this->insert() ) return YDResult::ok( t( 'ydcmgroup mess created' ), $res );
+				else                   return YDResult::fatal( t( 'ydcmgroup mess impossible to create' ), $res );
 			}
 
 		}

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -31,7 +31,7 @@
 
 	// add translations directory
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
-	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
+	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUser/' );
 
 	// add YDF libs needed by this class
 	YDInclude( 'YDDatabaseObject.php' );
@@ -173,14 +173,11 @@
          *  This method adds form elements for user editing
 		 *
 		 * @param $user_id      User id to edit
-		 *
-		 * @param $editable     Array with form element names that are editable
-		 * @param $noneditable  (Optional) Array with form element names that are NOT editable
-		 * @param $translate    (Optional) User details should be translated
+		 * @param $noneditable  (Optional) Array with form element names that are NOT editable (are spans).
          */
-		function addFormEdit( $id, $editable, $noneditable = array(), $translate = true ){
+		function addFormEdit( $id, $noneditable = array() ){
 
-		 	return $this->_addFormDetails( $id, true, $editable, $noneditable, $translate );
+		 	return $this->_addFormDetails( $id, true, $noneditable );
 		}
 
 
@@ -188,13 +185,10 @@
          *  This method adds form elements for addind a new user
 		 *
 		 * @param $parent_id    Group id of this new user
-		 * @param $editable     Array with form element names that are editable
-		 * @param $noneditable  (Optional) Array with form element names that are NOT editable
-		 * @param $translate    (Optional) User details should be translated
          */
-		function addFormNew( $id, $editable, $noneditable = array(), $translate = true ){
+		function addFormNew( $id ){
 
-		 	return $this->_addFormDetails( $id, false, $editable, $noneditable, $translate );
+		 	return $this->_addFormDetails( $id, false );
 		}
 		 
 		
@@ -203,14 +197,12 @@
 		 *
 		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
          *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
-         *
-		 * @param $editable     Array with form element names that are editable
 		 *
 		 * @param $noneditable  Array with form element names that are NOT editable
 		 *
 		 * @param $translate    User details should be translated
          */
-		function _addFormDetails( $id, $edit, $editable, $noneditable, $translate ){
+		function _addFormDetails( $id, $edit, $noneditable = array() ){
 
 			YDInclude( 'YDForm.php' );
 
@@ -218,82 +210,77 @@
 			$this->_form = new YDForm( 'YDCMUsers' );
 
 			// check arguments
-			if ( !is_array( $editable ) ) $editable = array( $editable );
 			if ( !is_array( $noneditable ) ) $noneditable = array( $noneditable );
 
 			// add username
-			if ( in_array( 'username', $editable ) ){
-				$this->_form->addElement( 'text', 'username', t('user_username') );
+			if ( in_array( 'username', $noneditable ) ){
+				$this->_form->addElement( 'span', 'username', t( 'ydcmuser label username' ) );
+			}else{
+				$this->_form->addElement( 'text', 'username', t( 'ydcmuser label username' ) );
 				$this->_form->addFormRule( array( & $this, '_checkuser' ), array( $edit, $id ) );
-
-			}else if ( in_array( 'username', $noneditable ) ){
-				$this->_form->addElement( 'span', 'username', t('user_username') );
 			}
 
-			// add password
-			if ( in_array( 'password', $editable ) ){
-				$this->_form->addElement( 'password', 'password', t('user_password') );				
-			}
+			// add password box for new users or editing users
+			if ( ! $edit || ( $edit && ! in_array( 'password', $noneditable ) ) )
+				$this->_form->addElement( 'password', 'password', t( 'ydcmuser label password' ) );				
 
 			// add state
-			if ( in_array( 'state', $editable ) ){
-				$this->_form->addElement( 'select',         'state',       t('login_state'), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-				$this->_form->addElement( 'datetimeselect', 'login_start', t('login_start') );
-				$this->_form->addElement( 'datetimeselect', 'login_end',   t('login_end'));
-
-			}else if ( in_array( 'state', $noneditable ) ){
-				$this->_form->addElement( 'span',           'state',       t('login_state') );
-				$this->_form->addElement( 'span',           'login_start', t('login_start') );
-				$this->_form->addElement( 'span',           'login_end',   t('login_end') );
+			if ( in_array( 'state', $noneditable ) ){
+				$this->_form->addElement( 'span',           'state',       t( 'ydcmuser label state' ) );
+				$this->_form->addElement( 'span',           'login_start', t( 'ydcmuser label login_start' ) );
+				$this->_form->addElement( 'span',           'login_end',   t( 'ydcmuser label login_end' ) );
+			}else{
+				$this->_form->addElement( 'select',         'state',       t( 'ydcmuser label state' ), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+				$this->_form->addElement( 'datetimeselect', 'login_start', t( 'ydcmuser label login_start' ) );
+				$this->_form->addElement( 'datetimeselect', 'login_end',   t( 'ydcmuser label login_end' ) );
 			}
 
 			// add common user details
-			if ( in_array( 'details', $editable ) ){
-				$this->_form->addElement( 'text',      'name',          t('user_name'),     array('size' => 50, 'maxlength' => 255) );
-				$this->_form->addElement( 'text',      'email',         t('user_email') );
-				$this->_form->addElement( 'textarea',  'other',         t('user_other'),    array('rows' => 4, 'cols' => 30) );
+			if ( in_array( 'details', $noneditable ) ){
+				$this->_form->addElement( 'span',      'name',          t( 'ydcmuser label name' ) );
+				$this->_form->addElement( 'span',      'email',         t( 'ydcmuser label email' ) );
+				$this->_form->addElement( 'span',      'other',         t( 'ydcmuser label other' ) );
+				$this->_form->addElement( 'span',      'lang_id',       t( 'ydcmuser label language' ) );
+				$this->_form->addElement( 'span',      'template',      t( 'ydcmuser label template' ) );
+			}else{
+				$this->_form->addElement( 'text',      'name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
+				$this->_form->addElement( 'text',      'email',         t( 'ydcmuser label email' ) );
+				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 4, 'cols' => 30) );
 
 				$languages = new YDCMLanguages();
 				$languages = $languages->active();
-				$this->_form->addElement( 'select',    'lang_id',       t('user_language'), array(), $languages );
+				$this->_form->addElement( 'select',    'lang_id',       t( 'ydcmuser label language' ), array(), $languages );
 
 				$templates = new YDCMTemplates();
-    	        $this->_form->addElement( 'select',    'template',      t('user_template'), array(), $templates->admin_templates() );
+    	        $this->_form->addElement( 'select',    'template',      t( 'ydcmuser label template' ), array(), $templates->admin_templates() );
 
-				$this->_form->addRule( 'name',        'maxlength',      t('name too big'),  255 );
-				$this->_form->addRule( 'email',       'email',          t('email not valid') );
-				$this->_form->addRule( 'other',       'maxlength',      t('other too big'), 5000 );
-				$this->_form->addRule( 'language_id', 'in_array',       t('language not valid'), array_keys( $languages ) );
-				$this->_form->addRule( 'template',    'in_array',       t('template not valid'), array_keys( $templates->admin_templates() ) );
-
-			}else if ( in_array( 'details', $noneditable ) ){
-				$this->_form->addElement( 'span',      'name',          t('user_name') );
-				$this->_form->addElement( 'span',      'email',         t('user_email') );
-				$this->_form->addElement( 'span',      'other',         t('user_other') );
-				$this->_form->addElement( 'span',      'lang_id',       t('user_language') );
-				$this->_form->addElement( 'span',      'template',      t('user_template') );
+				$this->_form->addRule( 'name',        'maxlength',      t( 'ydcmuser mess name too big' ),  255 );
+				$this->_form->addRule( 'email',       'email',          t( 'ydcmuser mess email not valid' ) );
+				$this->_form->addRule( 'other',       'maxlength',      t( 'ydcmuser mess other too big' ), 5000 );
+				$this->_form->addRule( 'language_id', 'in_array',       t( 'ydcmuser mess language not valid' ), array_keys( $languages ) );
+				$this->_form->addRule( 'template',    'in_array',       t( 'ydcmuser mess template not valid' ), array_keys( $templates->admin_templates() ) );
 			}
 
-			// add access information
-			if ( in_array( 'access', $noneditable ) ){
-				$this->_form->addElement( 'span', 'login_counter', t('login_counter') );
-    	        $this->_form->addElement( 'span', 'login_last',    t('login_last') );
-    	        $this->_form->addElement( 'span', 'login_current', t('login_current') );
+			// add access information when editing
+			if ( $edit ) {
+				$this->_form->addElement( 'span', 'login_counter', t( 'ydcmuser label login_counter' ) );
+   	        	$this->_form->addElement( 'span', 'login_last',    t( 'ydcmuser label login_last' ) );
+   	        	$this->_form->addElement( 'span', 'login_current', t( 'ydcmuser label login_current' ) );
 			}
 
 			// if we are editing a user it's a good idea to set form defaults with user node attributes
 			if ( $edit ){
 
 				// add submit button
-				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'save' ) );
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmuser label save' ) );
 
 				// set form defaults based on user attributes
-				$this->_form->setDefaults( $this->getUser( $id, $translate ) );
+				$this->_form->setDefaults( $this->getUser( $id ) );
 
 			}else{
 
 				// add submit button
-				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'add' ) );
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmuser label new' ) );
 
 				// when adding a user, if login_end date exists we setup 7 days interval
 				if ( $this->_form->isElement( 'login_end' ) )
@@ -317,7 +304,7 @@
 			
 			if ( $this->find() == 0 ) return true;
 			
-			return array( '__ALL__' => t( 'username exists' ) );
+			return array( '__ALL__' => t( 'ydcmuser mess username exists' ) );
 		}
 
 
@@ -406,8 +393,8 @@
 				$res = $this->update();
 				
 				// check update result and return
-				if ( $res > 0 ) return YDResult::ok( t( 'user details updated' ), $res );
-				else            return YDResult::warning( t( 'user not updated' ), $res );
+				if ( $res > 0 ) return YDResult::ok( t( 'ydcmuser mess updated' ), $res );
+				else            return YDResult::warning( t( 'ydcmuser mess impossible to update' ), $res );
 
 			}else{
 
@@ -446,8 +433,8 @@
 				$this->setValues( $user );
 
 				// insert values
-				if ( $this->insert() ) return YDResult::ok( t( 'user added' ), $res );
-				else                   return YDResult::fatal( t( 'user not added' ), $res );
+				if ( $this->insert() ) return YDResult::ok( t( 'ydcmuser mess created' ), $res );
+				else                   return YDResult::fatal( t( 'ydcmuser mess impossible to create' ), $res );
 			}
 
 		}
@@ -467,28 +454,20 @@
 			// init form
 			$this->_form = new YDForm( 'YDCMUsers' );
 
-			// add new password box
-            $this->_form->addElement( 'password',    'new',          t('password_new'),         array('size' => 30, 'maxlength' => 31) );
-			$this->_form->addRule(    'new',         'required',     t('passwords are required') );
-			$this->_form->addRule(    'new',         'maxlength',    t('passwords too big'), 31 );
-			$this->_form->addRule(    'new',         'alphanumeric', t('passwords not alphanumeric') );
+			// add old password box
+			if ( $oldpassword )
+            	$this->_form->addElement( 'password', 'old',          t('ydcmuser label old password'),         array('size' => 20, 'maxlength' => 31) );
 
-			// add new_confirm password box
-            $this->_form->addElement( 'password',    'new_confirm',  t('password_new_confirm'), array('size' => 30, 'maxlength' => 31) );
-			$this->_form->addRule(    'new_confirm', 'required',     t('passwords are required') );
-			$this->_form->addRule(    'new_confirm', 'maxlength',    t('passwords too big'), 31 );
-			$this->_form->addRule(    'new_confirm', 'alphanumeric', t('passwords not alphanumeric') );
+			// add password boxes
+            $this->_form->addElement( 'password',    'new',          t('ydcmuser label new password'),         array('size' => 30, 'maxlength' => 31) );
+            $this->_form->addElement( 'password',    'new_confirm',  t('ydcmuser label confirm password'), array('size' => 30, 'maxlength' => 31) );
 
+			$this->_form->addRule(    '__ALL__',     'required',     t('ydcmuser mess passwords are required') );
+			$this->_form->addRule(    '__ALL__',     'maxlength',    t('ydcmuser mess passwords too big'), 31 );
+			$this->_form->addRule(    '__ALL__',     'alphanumeric', t('ydcmuser mess passwords not alphanumeric') );
+
 			// add compare rule to new password and confirmation password
 			$this->_form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
-
-			// add old password box
-			if ( $oldpassword ){
-            	$this->_form->addElement( 'password', 'old',          t('password_old'),         array('size' => 20, 'maxlength' => 31) );
-				$this->_form->addRule(    'old',      'required',     t('passwords are required') );
-				$this->_form->addRule(    'old',      'maxlength',    t('passwords too big'), 31 );
-				$this->_form->addRule(    'old',      'alphanumeric', t('passwords not alphanumeric') );
-			}
 		}
 
 
@@ -517,8 +496,8 @@
 			$this->where( 'user_id = ' . intval( $user_id ) );
 
 			// update user and get result
-			if ( $this->update() == 1 ) return YDResult::ok( t('user password updated') );
-			else                        return YDResult::fatal( t('password not updated') );
+			if ( $this->update() == 1 ) return YDResult::ok( t('ydcmuser mess password updated') );
+			else                        return YDResult::fatal( t('ydcmuser mess password not updated') );
 		}
 
 

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -0,0 +1,25 @@
+<?php
+
+// PERMISSIONS
+$GLOBALS['t']['ydcmgroup perm properties'] = 'See properties';
+$GLOBALS['t']['ydcmgroup perm create']     = 'Create';
+$GLOBALS['t']['ydcmgroup perm delete']     = 'Delete';
+$GLOBALS['t']['ydcmgroup perm edit']       = 'Edit';
+
+
+// FORM LABELS
+$GLOBALS['t']['ydcmgroup label name']        = 'Name';
+$GLOBALS['t']['ydcmgroup label description'] = 'Description';
+$GLOBALS['t']['ydcmgroup label state']       = 'State';
+$GLOBALS['t']['ydcmgroup label new']         = 'Create group';
+$GLOBALS['t']['ydcmgroup label save']        = 'Save group';
+
+
+// FORM RULES/ERRORS/MESSAGES
+$GLOBALS['t']['ydcmgroup mess group exists']         = 'Group name already exists';
+$GLOBALS['t']['ydcmgroup mess details updated']      = 'Group details updated';
+$GLOBALS['t']['ydcmgroup mess details not updated']  = 'No updates were made';
+$GLOBALS['t']['ydcmgroup mess created']              = 'New group created';
+$GLOBALS['t']['ydcmgroup mess impossible to create'] = 'Impossible to create group';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/pt.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/pt.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -0,0 +1,25 @@
+<?php
+
+// PERMISSIONS
+$GLOBALS['t']['ydcmgroup perm properties'] = 'Ver propriedades';
+$GLOBALS['t']['ydcmgroup perm create']     = 'Criar';
+$GLOBALS['t']['ydcmgroup perm delete']     = 'Eliminar';
+$GLOBALS['t']['ydcmgroup perm edit']       = 'Editar';
+
+
+// FORM LABELS
+$GLOBALS['t']['ydcmgroup label name']        = 'Nome';
+$GLOBALS['t']['ydcmgroup label description'] = 'Descri&ccedil;&atilde;o';
+$GLOBALS['t']['ydcmgroup label state']       = 'Estado';
+$GLOBALS['t']['ydcmgroup label new']         = 'Criar grupo';
+$GLOBALS['t']['ydcmgroup label save']        = 'Guardar grupo';
+
+
+// FORM RULES/ERRORS/MESSAGES
+$GLOBALS['t']['ydcmgroup mess group exists']         = 'O nome do grupo j&aacute; existe';
+$GLOBALS['t']['ydcmgroup mess details updated']      = 'Grupo actualizado';
+$GLOBALS['t']['ydcmgroup mess details not updated']  = 'N&atilde;o foram feitas actualiza&ccedil;&otilde;es';
+$GLOBALS['t']['ydcmgroup mess created']              = 'Novo grupo criado';
+$GLOBALS['t']['ydcmgroup mess impossible to create'] = 'Imposs&iacute;vel criar grupo';
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -0,0 +1,53 @@
+<?php
+
+// PERMISSIONS
+$GLOBALS['t']['ydcmuser perm properties'] = 'See properties';
+$GLOBALS['t']['ydcmuser perm create']     = 'Create';
+$GLOBALS['t']['ydcmuser perm delete']     = 'Delete';
+$GLOBALS['t']['ydcmuser perm edit']       = 'Edit';
+
+// FORM LABELS
+$GLOBALS['t']['ydcmuser label username'] = 'Username';
+$GLOBALS['t']['ydcmuser label password'] = 'Password';
+$GLOBALS['t']['ydcmuser label name'] = 'Name';
+$GLOBALS['t']['ydcmuser label email'] = 'Email';
+$GLOBALS['t']['ydcmuser label other'] = 'Other';
+$GLOBALS['t']['ydcmuser label language'] = 'Language';
+$GLOBALS['t']['ydcmuser label template'] = 'Template';
+$GLOBALS['t']['ydcmuser label state'] = 'Login';
+$GLOBALS['t']['ydcmuser label login_start'] = 'Login start date';
+$GLOBALS['t']['ydcmuser label login_end'] = 'Login end date';
+$GLOBALS['t']['ydcmuser label login_counter'] = 'Total of logins';
+$GLOBALS['t']['ydcmuser label login_last'] = 'Last login date';
+$GLOBALS['t']['ydcmuser label login_current'] = 'Current login date';
+$GLOBALS['t']['ydcmuser label new'] = 'Create user';
+$GLOBALS['t']['ydcmuser label save'] = 'Save user';
+	// password form
+$GLOBALS['t']['ydcmuser label old password'] = 'Old password';
+$GLOBALS['t']['ydcmuser label new password'] = 'New password';
+$GLOBALS['t']['ydcmuser label confirm password'] = 'Confirm password';
+
+
+// FORM RULES/ERRORS/MESSAGES
+$GLOBALS['t']['ydcmuser mess username exists'] = 'Username already exists';
+$GLOBALS['t']['ydcmuser mess updated'] = 'User details updated';
+$GLOBALS['t']['ydcmuser mess impossible to update'] = 'Was not possible to update user';
+$GLOBALS['t']['ydcmuser mess created'] = 'New user created';
+$GLOBALS['t']['ydcmuser mess impossible to create'] = 'Was not possible to create user';
+$GLOBALS['t']['ydcmuser mess email not valid'] = 'Email is not valid';
+$GLOBALS['t']['ydcmuser mess language not valid'] = 'Language is not valid';
+$GLOBALS['t']['ydcmuser mess template not valid'] = 'Template is not valid';
+	// password form
+$GLOBALS['t']['ydcmuser mess passwords are required'] = 'All passwords are required';
+$GLOBALS['t']['ydcmuser mess passwords too big'] = 'All passwords must not exceed 31 characters';
+$GLOBALS['t']['ydcmuser mess passwords not alphanumeric'] = 'All passwords must be alphanumeric';
+$GLOBALS['t']['ydcmuser mess password updated'] = 'User password updated';
+$GLOBALS['t']['ydcmuser mess password not updated'] = 'User password not updated';
+
+// OTHER
+$GLOBALS['t']['ydcmuser administrator and move children up'] = 'Administrator and move children up';
+$GLOBALS['t']['ydcmuser administrator and children'] = 'Administrator and children';
+$GLOBALS['t']['ydcmuser children only'] = 'Children only';
+$GLOBALS['t']['ydcmuser add group'] = 'Add group';
+$GLOBALS['t']['ydcmuser change password'] = 'Change password';
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -0,0 +1,53 @@
+<?php
+
+// PERMISSIONS
+$GLOBALS['t']['ydcmuser perm properties'] = 'Ver propriedades';
+$GLOBALS['t']['ydcmuser perm create']     = 'Criar';
+$GLOBALS['t']['ydcmuser perm delete']     = 'Eliminar';
+$GLOBALS['t']['ydcmuser perm edit']       = 'Editar';
+
+// FORM LABELS
+$GLOBALS['t']['ydcmuser label username'] = 'Username';
+$GLOBALS['t']['ydcmuser label password'] = 'Password';
+$GLOBALS['t']['ydcmuser label name'] = 'Nome';
+$GLOBALS['t']['ydcmuser label email'] = 'Email';
+$GLOBALS['t']['ydcmuser label other'] = 'Outras informa&ccedil;&otilde;es';
+$GLOBALS['t']['ydcmuser label language'] = 'Idioma';
+$GLOBALS['t']['ydcmuser label template'] = 'Template';
+$GLOBALS['t']['ydcmuser label state'] = 'Login';
+$GLOBALS['t']['ydcmuser label login_start'] = 'Data inicial de login';
+$GLOBALS['t']['ydcmuser label login_end'] = 'Data final de login';
+$GLOBALS['t']['ydcmuser label login_counter'] = 'Total of login';
+$GLOBALS['t']['ydcmuser label login_last'] = '&Uacute;ltimo acesso';
+$GLOBALS['t']['ydcmuser label login_current'] = 'Acesso actual';
+$GLOBALS['t']['ydcmuser label new'] = 'Criar utilizador';
+$GLOBALS['t']['ydcmuser label save'] = 'Guardar utilizador';
+	// password form
+$GLOBALS['t']['ydcmuser label old password'] = 'Password actual';
+$GLOBALS['t']['ydcmuser label new password'] = 'Nova password';
+$GLOBALS['t']['ydcmuser label confirm password'] = 'Confirme nova password';
+
+
+// FORM RULES/ERRORS/MESSAGES
+$GLOBALS['t']['ydcmuser mess username exists'] = 'O utilizador j&aacute; existe';
+$GLOBALS['t']['ydcmuser mess updated'] = 'Utilizador modificado';
+$GLOBALS['t']['ydcmuser mess impossible to update'] = 'N&atilde;o foi poss&iacute;vel actualizar o utilizador';
+$GLOBALS['t']['ydcmuser mess created'] = 'Novo utilizador criado';
+$GLOBALS['t']['ydcmuser mess impossible to create'] = 'N&atilde;o foi poss&iacute;vel criar o utilizador';
+$GLOBALS['t']['ydcmuser mess email not valid'] = 'O email n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['ydcmuser mess language not valid'] = 'O idioma n&atilde;o &eacute; v&aacute;lido';
+$GLOBALS['t']['ydcmuser mess template not valid'] = 'O template n&atilde;o &eacute; v&aacute;lido';
+	// password form
+$GLOBALS['t']['ydcmuser mess passwords are required'] = 'Todas as passwords s&atilde;o obrigat&oacute;rias';
+$GLOBALS['t']['ydcmuser mess passwords too big'] = 'As passwords n&atilde;o podem exceder os 31 characteres';
+$GLOBALS['t']['ydcmuser mess passwords not alphanumeric'] = 'As passwords t&ecirc;m de ser alfanum&eacute;ricas';
+$GLOBALS['t']['ydcmuser mess password updated'] = 'Passwords actualizadas';
+$GLOBALS['t']['ydcmuser mess password not updated'] = 'As passwords n&atilde; foram actualizadas';
+
+// OTHER
+$GLOBALS['t']['ydcmuser administrator and move children up'] = 'Utilizador e mover grupos para cima';
+$GLOBALS['t']['ydcmuser administrator and children'] = 'Administrador e grupos';
+$GLOBALS['t']['ydcmuser children only'] = 'Apenas os sub-grupos';
+$GLOBALS['t']['ydcmuser add group'] = 'Criar grupo';
+$GLOBALS['t']['ydcmuser change password'] = 'Alterar password';
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -30,7 +30,6 @@
 $GLOBALS['t']['add'] = 'Add';
 $GLOBALS['t']['add component'] = 'Add component';
 $GLOBALS['t']['add user'] = 'Add user';
-$GLOBALS['t']['add group'] = 'Add group';
 $GLOBALS['t']['move'] = 'Move';
 $GLOBALS['t']['move up'] = 'Move up';
 $GLOBALS['t']['move down'] = 'Move down';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-09-04 18:53:41 UTC (rev 2075)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/pt.php	2006-09-04 21:07:28 UTC (rev 2076)
@@ -30,7 +30,6 @@
 $GLOBALS['t']['add'] = 'Adicionar';
 $GLOBALS['t']['add component'] = 'Adicionar component';
 $GLOBALS['t']['add user'] = 'Adicionar utilizador';
-$GLOBALS['t']['add group'] = 'Adicionar grupo';
 $GLOBALS['t']['move'] = 'Mover';
 $GLOBALS['t']['move up'] = 'Mover para cima';
 $GLOBALS['t']['move down'] = 'Mover para baixo';
@@ -43,6 +42,10 @@
 $GLOBALS['t']['administrator'] = 'Administrador';
 $GLOBALS['t']['administrators'] = 'Administradores';
 
+$GLOBALS['t']['published'] = 'Publicado';
+$GLOBALS['t']['not published'] = 'N?o publicado';
+$GLOBALS['t']['schedule'] = 'Calend&aacute;rio';
+
 $GLOBALS['t']['translate'] = 'Traduzir';
 $GLOBALS['t']['translate to'] = 'Traduzir para';
 
@@ -60,9 +63,5 @@
 $GLOBALS['t']['user management'] = 'Gest&atilde;o de utilizadores';
 $GLOBALS['t']['general configuration'] = 'Configura&ccedil;&atilde;o geral';
 
-
-
-
-
 $GLOBALS['t']['form errors'] = 'Erros no formulario';
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Mon Sep  4 23:11:34 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 4 Sep 2006 23:11:34 +0200
Subject: [ydf-devel] r2077 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200609042111.k84LBYht028085@sheep.berlios.de>

Author: ximian
Date: 2006-09-04 23:11:08 +0200 (Mon, 04 Sep 2006)
New Revision: 2077

Modified:
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
Log:
- updated YDCMUsers example for previous commit modifications

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-04 21:07:28 UTC (rev 2076)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-04 21:11:08 UTC (rev 2077)
@@ -41,8 +41,8 @@
         // Edit user example
         function actionEdit() {
 
-			// add editing form (with details edition) with defaults of user 6
-			$this->users->addFormEdit( 6, 'details' );
+			// add editing form defaults of userobject 6
+			$this->users->addFormEdit( 6 );
 
 			// get form
 			$form = & $this->users->getForm();
@@ -66,7 +66,7 @@
 		function actionNew(){
 
 			// add form for adding a new user to group 2
-			$this->users->addFormNew( 2, array( 'username', 'password', 'state', 'details' ) );
+			$this->users->addFormNew( 2 );
 
 			// get form
 			$form = & $this->users->getForm();



From muitocomplicado at gmail.com  Tue Sep  5 03:21:16 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Mon, 4 Sep 2006 22:21:16 -0300
Subject: [ydf-devel] YDForm::addFilter with __ALL__
Message-ID: <12260be20609041821y3e52e601p328b503ed058928d@mail.gmail.com>

In revision 1994 Ximian added a special check in YDForm::_applyFilters for
the date form element that broke addFilter with the special element __ALL__
when using date elements in a form.

The reason is that when the value is an array (e.g. date elements) we have
this code:

$element = & $this->getElement( $name );

But when $name = __ALL__ an error returns because is not an element.

I tried to add a check for the element name but we still get a problem with
the date element because it will always pass an array to the callback
function. So we get errors with trim, for example.

The thing is some filters we want to pass the complete array, and another
ones we want to filter all elements of the array.

I tried to define in addFilter what Ximian did in addRule:

// Check if element is special element '__ALL__'
if ( is_string( $element) && $element == '__ALL__' ) $element = array_keys(
$this->_elements );

But this will only add filters to the current defined elements. This is
reasonable but maybe someone is adding filters with __ALL__ before adding
any elements to the form (I was doing it).

I don't have a good solution for it. Maybe someone could help us out.

-db
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060904/5c279c58/attachment.html>

From francisco at fusemail.com  Tue Sep  5 19:16:13 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 05 Sep 2006 18:16:13 +0100
Subject: [ydf-devel] YDForm::addFilter with __ALL__
In-Reply-To: <12260be20609041821y3e52e601p328b503ed058928d@mail.gmail.com>
References: <12260be20609041821y3e52e601p328b503ed058928d@mail.gmail.com>
Message-ID: <44FDB0DD.9080003@fusemail.com>

Hi David

Yes, it's true that $form::addRule( '__ALL__', ... ) only works for the 
current form elements. This means that, if we had elements _after_ an 
'__ALL__' rule, those elements will not be affected.

I really think that this is correct and i don't know why should we add a 
filter to an element if the element even don't exist yet.
Anyway, special filters that affect all elements could be defined before 
the elements, but that's not trivial to implement (i think).


Are you sure, that is really _required_ that addRule('__ALL__',..) even 
elements that are added later?


Maybe Pieter (the YDForm master) could talk about how difficult is this 
to implement..


regards
Francisco A




From ximian at mail.berlios.de  Tue Sep  5 20:35:28 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 5 Sep 2006 20:35:28 +0200
Subject: [ydf-devel] r2078 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormElements
Message-ID: <200609051835.k85IZSdw002415@sheep.berlios.de>

Author: ximian
Date: 2006-09-05 20:34:46 +0200 (Tue, 05 Sep 2006)
New Revision: 2078

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
- added new YDForm element: selectimage
  This is a select box with a built-in image on right that reflects the selected box value.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-04 21:11:08 UTC (rev 2077)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-05 18:34:46 UTC (rev 2078)
@@ -119,6 +119,7 @@
             $this->registerElement( 'radio', 'YDFormElement_Radio', 'YDFormElement_Radio.php' );
             $this->registerElement( 'reset', 'YDFormElement_Reset', 'YDFormElement_Reset.php' );
             $this->registerElement( 'select', 'YDFormElement_Select', 'YDFormElement_Select.php' );
+            $this->registerElement( 'selectimage', 'YDFormElement_SelectImage', 'YDFormElement_SelectImage.php' );
             $this->registerElement( 'submit', 'YDFormElement_Submit', 'YDFormElement_Submit.php' );
             $this->registerElement( 'text', 'YDFormElement_Text', 'YDFormElement_Text.php' );
             $this->registerElement( 'textarea', 'YDFormElement_TextArea', 'YDFormElement_TextArea.php' );

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2006-09-04 21:11:08 UTC (rev 2077)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2006-09-05 18:34:46 UTC (rev 2078)
@@ -0,0 +1,213 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php');
+
+    /**
+     *	This is the class that define a select button form element.
+     */
+    class YDFormElement_SelectImage extends YDFormElement {
+
+        /**
+         *	This is the class constructor for the YDFormElement_SelectImage class.
+         *
+         *	@param $form		The name of the form to which this element is connected.
+         *	@param $name		The name of the form element.
+         *	@param $label		(optional) The label for the form element.
+         *	@param $attributes	(optional) The attributes for the form element.
+         *	@param $options		(optional) Associative array with the values to show in the select box.
+         */
+        function YDFormElement_SelectImage( $form, $name, $label='', $attributes=array(), $options=array() ) {
+
+			// compute image parameters
+			$this->_image_parameters = array();
+
+			// check if src exist
+			if ( isset( $attributes['src'] ) ){
+				$this->_img_src = $attributes['src'] . '/';
+				unset( $attributes['src'] );
+			}
+
+			// create default extension
+			$this->_img_ext = "";
+
+			// check if ext exist
+			if ( isset( $attributes['ext'] ) ){
+				$this->_img_ext = "." . $attributes['ext'];
+				unset( $attributes['ext'] );
+			}
+
+			// check if width exist
+			if ( isset( $attributes['width'] ) ){
+				$this->_image_parameters['width'] = $attributes['width'];
+				unset( $attributes['width'] );
+			}
+
+			// check if height exist
+			if ( isset( $attributes['height'] ) ){
+				$this->_image_parameters['height'] = $attributes['height'];
+				unset( $attributes['height'] );
+			}
+
+            // Initialize the parent
+            $this->YDFormElement( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'selectimage';
+
+            // Indicate if filters need to be applied
+            $this->_applyFilters = false;
+
+            // If options is just an element we should add create an array with it
+            if( !is_array( $options ) ) $this->_options = array( $options );
+        }
+
+
+        /**
+         *	This function will return the element as HTML.
+         *
+         *	@returns	The form element as HTML text.
+         */
+        function toHtml() {
+
+            // Create the list of attributes
+            $attribs = array( 'name' => $this->_form . '_' . $this->_name, 'onchange' => "document.getElementById('" . $this->getAttribute( 'id' ) . "_image').src='" . $this->_img_src . "' + document.getElementById('" . $this->getAttribute( 'id' ) . "').options[this.selectedIndex].value + '" . $this->_img_ext . "';" );
+            $attribs = array_merge( $this->_attributes, $attribs );
+
+            // Start html table and insert select in left column
+            $html = '<table border="0" cellspacing="0" cellpadding="0"><tr><td>';
+
+			// add select
+            $html .= '<select' . YDForm::_convertToHtmlAttrib( $attribs ) . '>';
+            foreach ( $this->_options as $val=>$label ) {
+                if ( strval( $this->_value ) == strval( $val ) ) {
+                    $html .= '<option value="' . $val . '" selected="selected">' . $label . '</option>';
+                } else {
+                    $html .= '<option value="' . $val . '">' . $label . '</option>';
+                }
+            }
+
+			// end select and left column
+            $html .= '</select></td>';
+
+			// compute image source
+			$source = $this->_img_src;
+
+			// compute selected option. If default value was set, use it. Otherwise use 1st option
+			if ( ! empty( $this->_value ) ){
+				$source .= $this->_value;
+			}else{
+				$values  = array_keys( $this->_options );
+				$source .= $values[0];
+			}
+
+			// add extension
+			$source .= $this->_img_ext;
+
+            // Create the list of attributes for image
+            $attribs = array( 'id' => $this->getAttribute( 'id' ) . '_image', 'src' => $source );
+            $attribs = array_merge( $this->_image_parameters, $attribs );
+
+			// add image html to right column and close table row
+			$html .= '<td>&nbsp;&nbsp;&nbsp;<img' . YDForm::_convertToHtmlAttrib( $attribs ) . '></td></tr></table>';
+
+            return $html;
+
+        }
+
+
+        /**
+         *	This function returns the default javascript event of this element
+         */
+        function getJSEvent(){ 
+
+            return 'onchange';
+        }
+
+
+        /**
+         *	This function gets an element value using javascript
+         *
+         *	@param $options		(optional) The options for the elment.
+         */
+        function getJS( $options = null ){ 
+
+            // if we want all values and not only the select one
+            if (in_array( 'all', $options )){
+
+                $js  = "\n\t" . 'var __ydtmparr = new Array();';
+                $js .= "\n\t" . 'var __ydtmpsel = document.getElementById("' . $this->getAttribute('id') . '");';
+                $js .= "\n\t" . 'for (i = 0; i < __ydtmpsel.length; i++){';
+                $js .= "\n\t" . '    __ydtmparr[ __ydtmpsel.options[i].value ] = __ydtmpsel.options[i].text;';
+                $js .= "\n\t" . '}';
+                $js .= "\n\t" . 'return __ydtmparr;' . "\n";
+
+                return $js;
+            }
+
+            // return just the value 
+            return 'return document.getElementById("' . $this->getAttribute('id') . '").value;';
+        }
+
+
+        /**
+         *	This function sets an element value using javascript
+         *
+         *	@param $result		The result value
+         *	@param $attribute	(optional) Element attribute
+         *	@param $options		(optional) The options for the elment.
+         */
+        function setJS( $result, $attribute = null, $options = null ){ 
+
+            // if atribute event is not defined we must create a default one
+            if ( is_null( $attribute ) ) $attribute = 'value';
+
+            // create select variable
+            $js = 'var __ydfselect = document.getElementById("' . $this->getAttribute('id') . '");';
+
+            // if we want to define the selected option
+            if ( !is_array( $result ) )
+                return $js . 'for (counter = 0; counter < __ydfselect.length; counter++){
+                                 if (__ydfselect[counter].value == "' . addslashes( $result ) . '"){
+                                     __ydfselect.selectedIndex = counter;
+                                 }
+                              }';
+
+            // if we want to replace all select options
+            $js .= '__ydfselect.options.length = 0;';
+            foreach( $result as $key => $value )
+                $js .= '    __ydfselect.options[ __ydfselect.options.length  ] = new Option("' . addslashes( $value ) . '","' . addslashes( $key ) . '"); ';
+
+            return $js;
+        }
+
+
+    }
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Tue Sep  5 20:37:42 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 5 Sep 2006 20:37:42 +0200
Subject: [ydf-devel] r2079 - in YDFramework2.0/trunk/examples: . flags
Message-ID: <200609051837.k85Ibgdp004345@sheep.berlios.de>

Author: ximian
Date: 2006-09-05 20:37:08 +0200 (Tue, 05 Sep 2006)
New Revision: 2079

Added:
   YDFramework2.0/trunk/examples/flags/
   YDFramework2.0/trunk/examples/flags/be.gif
   YDFramework2.0/trunk/examples/flags/br.gif
   YDFramework2.0/trunk/examples/flags/pt.gif
   YDFramework2.0/trunk/examples/form_selectimage.php
Log:
- added an example ( form_selectimage.php file ) on how to use the new selectimage YDForm element

Added: YDFramework2.0/trunk/examples/flags/be.gif
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/flags/be.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/flags/br.gif
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/flags/br.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/flags/pt.gif
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/flags/pt.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/form_selectimage.php
===================================================================
--- YDFramework2.0/trunk/examples/form_selectimage.php	2006-09-05 18:34:46 UTC (rev 2078)
+++ YDFramework2.0/trunk/examples/form_selectimage.php	2006-09-05 18:37:08 UTC (rev 2079)
@@ -0,0 +1,39 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDForm.php' );
+    YDInclude( 'YDTemplate.php' );
+
+    // Class definition
+    class form_selectimage extends YDRequest {
+
+        // Class constructor
+        function form_selectimage() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+			// create options and attributes
+			$options    = array( 'pt' => 'Portugal', 'br' => 'Brasil', 'be' => 'Belgium' );
+			$attributes = array( 'src' => YDUrl::makeLinkAbsolute( './flags/' ), 'ext' => 'gif' );
+			
+            // Create the form and add element
+            $form = new YDForm( 'form1' );
+            $form->addElement( 'selectimage', 'si',  'Select country', $attributes, $options );
+
+            // Display the template
+            $form->display();
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file



From muitocomplicado at gmail.com  Tue Sep  5 21:14:25 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Tue, 5 Sep 2006 16:14:25 -0300
Subject: [ydf-devel] YDForm::addFilter with __ALL__
In-Reply-To: <44FDB0DD.9080003@fusemail.com>
References: <12260be20609041821y3e52e601p328b503ed058928d@mail.gmail.com>
	<44FDB0DD.9080003@fusemail.com>
Message-ID: <12260be20609051214g66b8aa88v27401a18d0974881@mail.gmail.com>

I think we should redefine addFilter the same way addRule does - to only add
filters to current defined elements.

-db


On 9/5/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
> Hi David
>
> Yes, it's true that $form::addRule( '__ALL__', ... ) only works for the
> current form elements. This means that, if we had elements _after_ an
> '__ALL__' rule, those elements will not be affected.
>
> I really think that this is correct and i don't know why should we add a
> filter to an element if the element even don't exist yet.
> Anyway, special filters that affect all elements could be defined before
> the elements, but that's not trivial to implement (i think).
>
>
> Are you sure, that is really _required_ that addRule('__ALL__',..) even
> elements that are added later?
>
>
> Maybe Pieter (the YDForm master) could talk about how difficult is this
> to implement..
>
>
> regards
> Francisco A
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060905/41b9f2b0/attachment.html>

From pclaerhout at mail.berlios.de  Wed Sep  6 20:47:45 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 6 Sep 2006 20:47:45 +0200
Subject: [ydf-devel] r2080 - in YDFramework2.0/trunk/YDFramework2/addons: .
	YDAkismet
Message-ID: <200609061847.k86Ilj1m017367@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-06 20:47:45 +0200 (Wed, 06 Sep 2006)
New Revision: 2080

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
Log:
Added an addon that integrates with the akismet.com comment spam checking webservice.

Added: YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-09-05 18:37:08 UTC (rev 2079)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-09-06 18:47:45 UTC (rev 2080)
@@ -0,0 +1,135 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDHttpClient.php' );
+
+    /**
+     *	This class is an interface to the Akismet comment spam checking webservice.
+     */
+    class YDAkismet extends YDAddOnModule {
+
+        /**
+         *	This is the class constructor for the YDAkismet module.
+         */
+        function YDAkismet( $blog_url, $api_key ) {
+
+            // Initialize the parent class
+            $this->YDAddOnModule();
+
+            // Setup the module
+            $this->_author = 'Pieter Claerhout';
+            $this->_version = '1.0';
+            $this->_copyright = '(c) Copyright 2002-2005 Pieter Claerhout';
+            $this->_description = 'This class is an interface to the Akismet comment spam checking webservice.';
+
+            // Set the variables
+            $this->blog_url = $blog_url;
+            $this->api_key  = $api_key;
+
+        }
+
+        /**
+         *  This function verifies a comment against Akismet.
+         *
+         *  @param  $comment    The contents of the comment.
+         *  @param  $author     The name of the author of the comment.
+         *  @param  $email      (optional) The email address of the author of the comment.
+         *  @param  $url        (optional) The url of the website of the author of the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_agent (optional) The user agent of the person who submitted the comment.
+         *  @param  $referrer   (optional) The HTTP referrer of the person who submitted the comment.
+         *
+         *  @returns    True if the comment is spam, false if the comment is not spam. If something went wrong, a null
+         *              value is returned.
+         */
+        function checkComment( $comment, $author, $email='', $url='', $user_ip='', $user_agent='', $referrer='' ) {
+
+            // Do the request
+            $result = $this->doRequest(
+                'rest.akismet.com', '/1.1/verify-key', array( 'key' => $this->api_key, 'blog' => $this->blog_url )
+            );
+
+            // If result is null, return null
+            if ( is_null( $result ) ) {
+                return null;
+            }
+
+            // Get the comment data
+            $data = array();
+            $data['blog'] = $this->blog_url;
+            $data['user_ip'] = empty( $user_ip ) ? $_SERVER['REMOTE_ADDR'] : $user_ip;
+            $data['user_agent'] = empty( $user_agent ) ? $_SERVER['HTTP_USER_AGENT'] : $user_agent;
+            if ( empty( $referrer ) ) {
+                if ( isset( $_SERVER['HTTP_REFERER'] ) ) {
+                    $data['referrer'] = $_SERVER['HTTP_REFERER'];
+                }
+            } else {
+                $data['referrer'] = $referrer;
+            }
+            $data['comment_author'] = $author;
+            $data['comment_author_email'] = $email;
+            $data['comment_author_url'] = $url;
+            $data['comment_content'] = $comment;
+
+            // Check the comment
+            $result = $this->doRequest( $this->api_key . '.rest.akismet.com', '/1.1/comment-check', $data );
+
+            // Return the result
+            if ( is_null( $result ) ) {
+                return null;
+            } else {
+                return ( strtolower( $result ) == 'false' ) ? false : true;
+            }
+
+        }
+
+        /**
+         *  Do a HTTP request.
+         *
+         *  @param  $host   The host to post to
+         *  @param  $url    The URL to post to
+         *  @param  $data   The POST data to send.
+         *
+         *  @return The data if something was returned, null if something failed.
+         */
+        function doRequest( $host, $url, $data ) {
+            $client = new YDHttpClient( $host, 80 );
+            $client->user_agent = YD_FW_NAME . '/' . YD_FW_VERSION . ' | ' . $this->getClassName() . '/' . $this->_version;
+            $result = @ $client->post( $url, $data );
+            if ( $result == false ) {
+                return null;
+            } else {
+                return @ $client->getContent();
+            }
+        }
+
+    }
+
+?>



From pclaerhout at mail.berlios.de  Wed Sep  6 20:55:10 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 6 Sep 2006 20:55:10 +0200
Subject: [ydf-devel] r2081 - in YDFramework2.0/trunk/examples/weblog: .
	include include/languages manage skins/default
	skins/default_with_lightbox
Message-ID: <200609061855.k86ItAYX018240@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-06 20:55:09 +0200 (Wed, 06 Sep 2006)
New Revision: 2081

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Added integration with Akismet for checking spam in comments.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -165,7 +165,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 3;
+            $current_schema = 4;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -177,6 +177,7 @@
                 $fields = $this->dbmeta->getFields( '#_comments' );
                 $this->executeIfMissing( 'useragent', $fields, 'ALTER TABLE #_comments ADD useragent varchar(255) AFTER userip' );
                 $this->executeIfMissing( 'userrequrl', $fields, 'ALTER TABLE #_comments ADD userrequrl varchar(255) AFTER useragent' );
+                $this->executeIfMissing( 'is_spam', $fields, 'ALTER TABLE #_comments ADD is_spam TINYINT(1) DEFAULT "0" NOT NULL AFTER comment' );
 
                 // Add any missing items fields
                 $fields = $this->dbmeta->getFields( '#_items' );
@@ -449,14 +450,19 @@
         }
 
         // Get the comments for an item
-        function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1, $public_only=false ) {
-            $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
+        function getComments( $item_id=null, $order='created', $limit=-1, $offset=-1, $public_only=false, $spam_only=false ) {
+            $query = 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.is_spam as is_spam, c.created as created, c.modified as modified, i.title as item_title, i.is_draft as item_is_draft FROM #_comments c, #_items i WHERE c.item_id = i.id';
             if ( $item_id ) {
                 $query .= ' and item_id = ' . $this->str( $item_id );
             }
             if ( $public_only == true ) {
                 $query .= ' and i.is_draft = 0';
             }
+            if ( $spam_only == true ) {
+                $query .= ' and c.is_spam = 1';
+            } else {
+                $query .= ' and c.is_spam = 0';
+            }
             $records = $this->db->getRecords( $this->_prepareQuery( $query, $order ), $limit, $offset );
             foreach ( $records as $key=>$record ) {
                 $records[$key]['comment'] = trim( strip_tags( $record['comment'] ) );
@@ -466,7 +472,7 @@
 
         // Get a comment by it's ID
         function getCommentById( $comment_id ) {
-            $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id and c.id = ' . $this->str( $comment_id ) );
+            $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.is_spam as is_spam, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id and c.id = ' . $this->str( $comment_id ) );
             $record  = $this->db->getRecord( $sql );
             $record['comment'] = trim( strip_tags( $record['comment'] ) );
             return $record;
@@ -474,14 +480,52 @@
 
         // Add a comment
         function addComment( $values ) {
+
+            // Update the values
             $values['userip'] = $_SERVER['REMOTE_ADDR'];
             $values['useragent'] = $_SERVER['HTTP_USER_AGENT'];
             $values['userrequrl'] = $_SERVER['REQUEST_URI'];
+
+            // Check against akismet if a key is there
+            if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
+
+                // Include the YDAkismet addon
+                include_once( YD_DIR_HOME_ADD . '/YDAkismet/YDAkismet.php' );
+
+                // Get the URL of the weblog
+                $weblog_url = dirname( YDRequest::getCurrentUrl( true ) ) . '/';
+
+                // Initialize YDAkismet
+                $akismet = new YDAkismet( $weblog_url, YDConfig::get( 'akismet_key', '' ) );
+
+                // Check if it's spam or not
+                $result = $akismet->checkComment(
+                    $values['comment'], $values['username'], $values['useremail'], $values['userwebsite'],
+                    $values['userip'], $values['useragent']
+                );
+
+                // Update the comment values
+                if ( $result == NULL || $result === false ) {
+                    $values['is_spam'] = 0;
+                } else {
+                    $values['is_spam'] = 1;
+                }
+
+            }
+
+            // Add the comment
             $result = $this->_executeInsert( '#_comments', $values );
-            $comment_id = $this->db->getLastInsertID();
-            $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $values['item_id'] );
-            $this->db->executeSql( $sql );
+
+            // Only update the items table if not spam
+            if ( ! $values['is_spam'] ) {
+                $comment_id = $this->db->getLastInsertID();
+                $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $values['item_id'] );
+                $this->db->executeSql( $sql );
+            }
+
+            // Return the comment id
             return $comment_id;
+
         }
 
         // Update a comment
@@ -489,12 +533,34 @@
             return $this->db->executeUpdate( '#_comments', $values, 'id = ' . $this->str( $values['id'] ) );
         }
 
+        // Update a comment and mark it as spam
+        function updateCommentAsSpam( $comment_id ) {
+            $comment = $this->getCommentById( $comment_id );
+            $comment['is_spam'] = 1;
+            unset( $comment['item_title'] );
+            $this->updateComment( $comment );
+            $sql = 'UPDATE #_items SET num_comments = num_comments-1 WHERE id = ' . $this->str( $comment['item_id'] );
+            $this->db->executeSql( $sql );
+        }
+
+        // Update a comment and unmark it as spam
+        function updateCommentAsNotSpam( $comment_id ) {
+            $comment = $this->getCommentById( $comment_id );
+            $comment['is_spam'] = 0;
+            unset( $comment['item_title'] );
+            $this->updateComment( $comment );
+            $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $comment['item_id'] );
+            $this->db->executeSql( $sql );
+        }
+
         // Delete a comment
         function deleteComment( $comment_id ) {
             $comment = $this->getCommentById( $comment_id );
             $result = $this->_deleteFromTableUsingID( '#_comments', $comment_id );
-            $sql = 'UPDATE #_items SET num_comments = num_comments-1 WHERE id = ' . $this->str( $comment['item_id'] );
-            $this->db->executeSql( $sql );
+            if ( ! $comment['is_spam'] ) {
+                $sql = 'UPDATE #_items SET num_comments = num_comments-1 WHERE id = ' . $this->str( $comment['item_id'] );
+                $this->db->executeSql( $sql );
+            }
             return $result;
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -252,6 +252,10 @@
 $GLOBALS['t']['mail'] = 'Email';
 $GLOBALS['t']['no_comments_found'] = 'No comments were found';
 $GLOBALS['t']['posted_from'] = 'Posted from IP address';
+$GLOBALS['t']['a_comments_spam'] = 'Spam comments';
+$GLOBALS['t']['mark_as_spam'] = 'mark as spam';
+$GLOBALS['t']['mark_as_not_spam'] = 'mark as not spam';
+$GLOBALS['t']['is_spam'] = 'Spam comment';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Settings';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -252,6 +252,10 @@
 $GLOBALS['t']['mail'] = 'Email';
 $GLOBALS['t']['no_comments_found'] = 'Er werden geen commentaren gevonden';
 $GLOBALS['t']['posted_from'] = 'Gepost van het IP adres';
+$GLOBALS['t']['a_comments_spam'] = 'Spam commentaren';
+$GLOBALS['t']['mark_as_spam'] = 'markeer als spam';
+$GLOBALS['t']['mark_as_not_spam'] = 'markeer als niet spam';
+$GLOBALS['t']['is_spam'] = 'Spam commentaar';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Instellingen';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -56,15 +56,8 @@
             $form->addElement( 'text', 'username', t( 'name' ) );
             $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
             $form->addElement( 'text', 'userwebsite', t( 'website' ) );
-            $form->addElement( 'hidden', '_userspam', t('choose_no_spam'), array() );
             $form->addElement( 'textarea', 'comment', '' );
-            $form->addElement(
-                'submit', 'cmdSubmit', t( 'submit_comment' ),
-                array(
-                    'id' => 'submit',
-                    'onClick' => 'this.document.getElementById(\'comments__userspam\').value = 3; return true;'
-                )
-            );
+            $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ) );
             $form->addElement( 'hidden', 'item_id' );
 
             // Set the defaults
@@ -73,7 +66,6 @@
             $defaults['username']    = empty( $_COOKIE['YD_USER_NAME'] ) ? '' : $_COOKIE['YD_USER_NAME'];
             $defaults['useremail']   = empty( $_COOKIE['YD_USER_EMAIL'] ) ? '' : $_COOKIE['YD_USER_EMAIL'];
             $defaults['userwebsite'] = empty( $_COOKIE['YD_USER_WEBSITE'] ) ? '' : $_COOKIE['YD_USER_WEBSITE'];
-            $defaults['_userspam']   = 1;
             $form->setDefaults( $defaults );
 
             // Set the rules
@@ -83,7 +75,6 @@
             $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
             $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
             $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
-            $form->addRule( '_userspam',   'value',     t( 'err_userspam' ), '3' );
             $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
 
             // Add the filters

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -17,6 +17,12 @@
         // Default action
         function actionDefault() {
 
+            // Get the filter
+            $filter = 'no_spam';
+            if ( isset( $_GET['filter'] ) && strtolower( $_GET['filter'] ) == 'spam' ) {
+                $filter = 'spam';
+            }
+
             // Get the ID from the query string
             $id = $this->getIdFromQS();
 
@@ -33,7 +39,11 @@
             } else {
 
                 // Get the list of comments
-                $comments = $this->weblog->getComments( null, 'CREATED DESC' );
+                if ( $filter == 'no_spam' ) {
+                    $comments = $this->weblog->getComments( null, 'CREATED DESC' );
+                } else {
+                    $comments = $this->weblog->getComments( null, 'CREATED DESC', -1, -1, false, true );
+                }
 
             }
 
@@ -45,6 +55,7 @@
 
             // Assign it to the template
             $this->tpl->assign( 'comments', $comments );
+            $this->tpl->assign( 'filter', $filter );
 
             // Display the template
             $this->display();
@@ -61,6 +72,7 @@
             $form->addElement( 'text',            'userwebsite', t('website'), array( 'class' => 'tfM' ) );
             $form->addElement( 'wladmintextarea', 'comment',     t('comment'), array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'created',     t('created_on'), array( 'class' => 'tfM' ) );
+            $form->addElement( 'checkbox',        'is_spam',     t('is_spam'), array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
             $form->addElement( 'submit',          '_cmdSubmit',  t('OK'),      array( 'class' => 'button' ) );
 
@@ -161,6 +173,44 @@
 
         }
 
+        // Action to mark a comment as spam
+        function actionMark_as_spam() {
+
+            // Get the ID from the query string
+            $id = $this->getIdFromQS();
+
+            // If there is something, set the defaults
+            if ( $id ) {
+
+                // Delete the comment
+                $this->weblog->updateCommentAsSpam( $id );
+
+            }
+
+            // Redirect to the default acton
+            $this->redirect( YD_SELF_SCRIPT . '?filter=spam' );
+
+        }
+
+        // Action to unmark a comment as spam
+        function actionMark_as_not_spam() {
+
+            // Get the ID from the query string
+            $id = $this->getIdFromQS();
+
+            // If there is something, set the defaults
+            if ( $id ) {
+
+                // Delete the comment
+                $this->weblog->updateCommentAsNotSpam( $id );
+
+            }
+
+            // Redirect to the default acton
+            $this->redirectToAction();
+
+        }
+
     }
 
     // Process the request

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-09-06 18:55:09 UTC (rev 2081)
@@ -66,7 +66,14 @@
     {/if}
     <tr>
         <th class="adminRowLG" colspan="7">
-            &raquo; {t w="a_comments"}
+            {if $item}
+                &raquo; {t w="a_comments"}
+            {else}
+                &raquo; <a href="{$YD_SELF_SCRIPT}">
+                    {if $filter == 'no_spam'}<b>{/if}{t w="a_comments"}{if $filter == 'no_spam'}</b>{/if}</a>
+                | <a href="{$YD_SELF_SCRIPT}?filter=spam">
+                    {if $filter == 'spam'}<b>{/if}{t w="a_comments_spam"}{if $filter == 'spam'}</b>{/if}</a>
+            {/if}
         </th>
     </tr>
     {if $comments->set}
@@ -110,6 +117,12 @@
                     |
                     <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
                      onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
+                    <br/>
+                    {if $comment.is_spam}
+                        <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
+                    {else}
+                        <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
+                    {/if}
                 </td>
             </tr>
         {/foreach}
@@ -185,6 +198,10 @@
                 <td class="adminRowL">{$form.created.html}</td>
             </tr>
             <tr>
+                <td class="adminRowL">{$form.is_spam.label_html}</td>
+                <td class="adminRowL">{$form.is_spam.html}</td>
+            </tr>
+            <tr>
                 <td class="adminRowL" colspan="2" style="border: 0px;">
                     {$form._cmdSubmit.html}
                     {$form._cmdDelete.html}

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-06 18:55:09 UTC (rev 2081)
@@ -93,6 +93,7 @@
             $form->addElement( 'checkbox', 'dflt_is_draft', t( 'is_draft' ), array( 'style' => 'border: none;' ) );
 
             $form->addElement( 'textarea', 'blocked_ips', t( 'cfg_blocked_ips' ), array( 'class' => 'tfMNoMCE' ) );
+            $form->addElement( 'text', 'akismet_key', t( 'cfg_akismet_key' ), array( 'class' => 'tfM' ) );
 
             $form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 
@@ -167,6 +168,7 @@
             $config['friendly_urls']        = YDConfig::get( 'friendly_urls',        false );
             $config['dflt_is_draft']        = YDConfig::get( 'dflt_is_draft',        false );
             $config['blocked_ips']          = YDConfig::get( 'blocked_ips',          YDFormatStringWithListValues( '' ) );
+            $config['akismet_key']          = YDConfig::get( 'akismet_key',          '' );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-06 18:55:09 UTC (rev 2081)
@@ -138,6 +138,10 @@
             <td class="adminRowL" width="300">{t w="cfg_blocked_ips"}</td>
             <td class="adminRowL" width="400">{$config.blocked_ips|default:'-'|replace:', ':'<br/>'}</td>
         </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="cfg_akismet_key"}</td>
+            <td class="adminRowL">{$config.akismet_key|default:'-'}</td>
+        </tr>
     </table>
     <p><input type="button" class="button" onClick="window.location='{$YD_SELF_SCRIPT}?do=edit';" value="{t w="change_config"}" />
 {/if}
@@ -274,6 +278,10 @@
                 <td class="adminRowL" width="300">{$form.blocked_ips.label_html}</td>
                 <td class="adminRowL" width="400">{$form.blocked_ips.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL">{$form.akismet_key.label_html}</td>
+                <td class="adminRowL">{$form.akismet_key.html}</td>
+            </tr>
         </table>
         <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-06 18:55:09 UTC (rev 2081)
@@ -114,6 +114,7 @@
                             | <a href="manage/comments.php?do=edit&id={$comment.id}" target="_blank">{t w="edit"}</a>
                             | <a href="manage/comments.php?do=delete&id={$comment.id}"
                                  onClick="return YDConfirmDelete( '{$item.title|addslashes}' );">{t w="delete"}</a>
+                            | <a href="manage/comments.php?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
                         {/if}
                     </small>
                     <p>{$comment.comment|bbcode}</p>
@@ -127,8 +128,6 @@
 
     {$comments_form.tag}
 
-        {$comments_form._userspam.html}
-
         {if $comments_form.errors_unique_messages}
             <p class="postmetadata alt" style="color: red; text-align: left;">
                 <b>{t w="error_comment"}<br/></b>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-06 18:47:45 UTC (rev 2080)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-06 18:55:09 UTC (rev 2081)
@@ -118,6 +118,7 @@
                             | <a href="manage/comments.php?do=edit&id={$comment.id}" target="_blank">{t w="edit"}</a>
                             | <a href="manage/comments.php?do=delete&id={$comment.id}"
                                  onClick="return YDConfirmDelete( '{$item.title|addslashes}' );">{t w="delete"}</a>
+                            | <a href="manage/comments.php?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
                         {/if}
                     </small>
                     <p>{$comment.comment|bbcode}</p>
@@ -131,8 +132,6 @@
 
     {$comments_form.tag}
 
-        {$comments_form._userspam.html}
-
         {if $comments_form.errors_unique_messages}
             <p class="postmetadata alt" style="color: red; text-align: left;">
                 <b>{t w="error_comment"}<br/></b>



From pclaerhout at mail.berlios.de  Wed Sep  6 20:59:22 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 6 Sep 2006 20:59:22 +0200
Subject: [ydf-devel] r2082 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609061859.k86IxMG4018645@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-06 20:59:22 +0200 (Wed, 06 Sep 2006)
New Revision: 2082

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
Log:
Removed the schema install date from the server info screen.

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-09-06 18:55:09 UTC (rev 2081)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-09-06 18:59:22 UTC (rev 2082)
@@ -46,7 +46,7 @@
     </tr>
     <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
         <td class="adminRowL" width="300">{t w="schema_version"}</td>
-        <td class="adminRowL" width="400">{$schema_info.version} ({t w="installed_on"} {$schema_info.installed|date:"%d %B %Y"|lower})</td>
+        <td class="adminRowL" width="400">{$schema_info.version}</td>
     </tr>
     <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
         <td class="adminRowL">Smarty</td>



From pclaerhout at mail.berlios.de  Thu Sep  7 12:12:54 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:12:54 +0200
Subject: [ydf-devel] r2083 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200609071012.k87ACs0i007884@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:12:54 +0200 (Thu, 07 Sep 2006)
New Revision: 2083

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Added some missing translations.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-06 18:59:22 UTC (rev 2082)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 10:12:54 UTC (rev 2083)
@@ -297,6 +297,7 @@
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
+$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">get one here</a>)';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-06 18:59:22 UTC (rev 2082)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 10:12:54 UTC (rev 2083)
@@ -297,6 +297,7 @@
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
+$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">hier te verkrijgen</a>)';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';



From pclaerhout at mail.berlios.de  Thu Sep  7 12:16:28 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:16:28 +0200
Subject: [ydf-devel] r2084 - in YDFramework2.0/trunk/examples/weblog:
	include/languages manage
Message-ID: <200609071016.k87AGSSP008149@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:16:27 +0200 (Thu, 07 Sep 2006)
New Revision: 2084

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/cache.tpl
   YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
Log:
Reorganized some admin tools.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 10:16:27 UTC (rev 2084)
@@ -345,7 +345,7 @@
 $GLOBALS['t']['bck_data_only'] = 'Data only';
 
 // manage/version_info.tpl
-$GLOBALS['t']['h_diagtools'] = 'Diagnostic tools';
+$GLOBALS['t']['h_diagtools'] = 'Tools';
 $GLOBALS['t']['a_version_info'] = 'Auto Update';
 $GLOBALS['t']['version_check'] = 'Check Version';
 $GLOBALS['t']['installed_version'] = 'Installed version';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 10:16:27 UTC (rev 2084)
@@ -345,7 +345,7 @@
 $GLOBALS['t']['bck_data_only'] = 'Enkel de data';
 
 // manage/version_info.tpl
-$GLOBALS['t']['h_diagtools'] = 'Diagnose tools';
+$GLOBALS['t']['h_diagtools'] = 'Tools';
 $GLOBALS['t']['a_version_info'] = 'Auto Update';
 $GLOBALS['t']['version_check'] = 'Controleer Versie';
 $GLOBALS['t']['installed_version'] = 'Ge&iuml;nstalleerde versie';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 10:16:27 UTC (rev 2084)
@@ -121,17 +121,12 @@
                 </tr>
                 <tr>
                     <td class="adminRowL">
-                        <b>{t w="h_maintenance"}</b><br/>
+                        <b>{t w="h_diagtools"}</b><br/>
+                        &raquo; <a href="serverinfo.php">{t w="a_server_info"}</a><br/>
                         &raquo; <a href="dbbackup.php">{t w="a_db_backup"}</a><br/>
                         &raquo; <a href="cache.php">{t w="a_cleanup_cache"}</a><br/>
                     </td>
                 </tr>
-                <tr>
-                    <td class="adminRowL">
-                        <b>{t w="h_diagtools"}</b><br/>
-                        &raquo; <a href="serverinfo.php">{t w="a_server_info"}</a><br/>
-                    </td>
-                </tr>
                 {if $keep_stats or $google_analytics}
                     <tr>
                         <td class="adminRowL">

Modified: YDFramework2.0/trunk/examples/weblog/manage/cache.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/cache.tpl	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/manage/cache.tpl	2006-09-07 10:16:27 UTC (rev 2084)
@@ -1,6 +1,6 @@
 {include file="__mng_header.tpl"}
 
-<p class="title">{t w="h_maintenance"} &raquo; {t w="a_cleanup_cache"}</p>
+<p class="title">{t w="h_diagtools"} &raquo; {t w="a_cleanup_cache"}</p>
 
 {if $message}
     <p><table width="700" cellspacing="0" cellpadding="0" border="0">

Modified: YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/manage/dbbackup.tpl	2006-09-07 10:16:27 UTC (rev 2084)
@@ -1,6 +1,6 @@
 {include file="__mng_header.tpl"}
 
-<p class="title">{t w="h_maintenance"} &raquo; {t w="a_db_backup"}</p>
+<p class="title">{t w="h_diagtools"} &raquo; {t w="a_db_backup"}</p>
 
 {if $form.errors}
     <p><table width="700" cellspacing="0" cellpadding="0" border="0">

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-09-07 10:12:54 UTC (rev 2083)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.tpl	2006-09-07 10:16:27 UTC (rev 2084)
@@ -1,6 +1,6 @@
 {include file="__mng_header.tpl"}
 
-<p class="title">{t w="h_maintenance"} &raquo; {t w="a_server_info"}</p>
+<p class="title">{t w="h_diagtools"} &raquo; {t w="a_server_info"}</p>
 
 <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>



From pclaerhout at mail.berlios.de  Thu Sep  7 12:22:16 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:22:16 +0200
Subject: [ydf-devel] r2085 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609071022.k87AMGLS008651@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:22:16 +0200 (Thu, 07 Sep 2006)
New Revision: 2085

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Fixed a bug in YDTemplate where it would incorrectly convert a numeric string to a date/time object.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-07 10:16:27 UTC (rev 2084)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-07 10:22:16 UTC (rev 2085)
@@ -555,8 +555,8 @@
         if ( empty( $string ) ) {
             $string = "now";
         }
-        if ( is_numeric( $time ) && $time != -1 ) {
-            return intval( $time );
+        if ( is_numeric( $string ) && $time != -1 ) {
+            return intval( $string );
         }
         if ( preg_match( '/^\d{14}$/', $string ) ) {
             $time = mktime(



From pclaerhout at mail.berlios.de  Thu Sep  7 12:43:28 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:43:28 +0200
Subject: [ydf-devel] r2086 - in YDFramework2.0/trunk/examples/weblog: .
	include manage
Message-ID: <200609071043.k87AhSdW011763@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:43:23 +0200 (Thu, 07 Sep 2006)
New Revision: 2086

Modified:
   YDFramework2.0/trunk/examples/weblog/archive.php
   YDFramework2.0/trunk/examples/weblog/archive_gallery.php
   YDFramework2.0/trunk/examples/weblog/category.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/index.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/item_gallery.php
   YDFramework2.0/trunk/examples/weblog/manage/cache.php
   YDFramework2.0/trunk/examples/weblog/manage/categories.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
   YDFramework2.0/trunk/examples/weblog/manage/items.php
   YDFramework2.0/trunk/examples/weblog/manage/pages.php
   YDFramework2.0/trunk/examples/weblog/page.php
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Some major code cleanup.

Modified: YDFramework2.0/trunk/examples/weblog/archive.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/archive.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/archive.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -23,10 +23,8 @@
             // Convert to a nested array
             $items = YDArrayUtil::convertToNested( $items, 'yearmonth' );
 
-            // Add them to the template
+            // Assign the variables to the template
             $this->tpl->assign( 'items', $items );
-
-            // Set the title
             $this->tpl->assign( 'title', t('archives') );
 
             // Display the template

Modified: YDFramework2.0/trunk/examples/weblog/archive_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/archive_gallery.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/archive_gallery.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -29,10 +29,8 @@
                 }
             }
 
-            // Add them to the template
+            // Assign the variables to the template
             $this->tpl->assign( 'items', $items );
-
-            // Set the title
             $this->tpl->assign( 'title', t('archives_gallery') );
 
             // Display the template

Modified: YDFramework2.0/trunk/examples/weblog/category.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/category.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/category.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -24,11 +24,9 @@
             // Get the category items
             $items = $this->weblog->getItemsByCategoryId( $id );
 
-            // Add them to the template
+            // Assign the variables to the template
             $this->tpl->assign( 'category', $category );
             $this->tpl->assign( 'items',    $items );
-
-            // Set the title
             $this->tpl->assign(
                 'title', t('archive_for_the') . '\'' . $category['title'] . '\' ' .  strtolower( t('category') )
             );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -86,34 +86,20 @@
 
         // Function to show a thumbnail
         function actionThumbnail() {
-
-            // Get the image name
             if ( ! isset( $_GET['id'] ) ) {
                 die( 'No image selected.' );
             }
-
-            // Create a new image object
             $img = new YDFSImage( dirname( __FILE__ ) . '/../' . YDConfig::get( 'dir_uploads', 'uploads' ) . '/' . $_GET['id'] );
-
-            // Output the thumbnail
             $img->outputThumbnail( 100, 100 );
-
         }
 
         // Function to show a thumbnail
         function actionThumbnailSmall() {
-
-            // Get the image name
             if ( ! isset( $_GET['id'] ) ) {
                 die( 'No image selected.' );
             }
-
-            // Create a new image object
             $img = new YDFSImage( YDConfig::get( 'dir_uploads', 'uploads' ) . '/' . $_GET['id'] );
-
-            // Output the thumbnail
             $img->outputThumbnail( 48, 48 );
-
         }
 
         // Function to get the ID from the query string
@@ -193,53 +179,28 @@
 
         // Fetch a template
         function fetch( $customTpl=null ) {
-
-            // Initialize the template
             $this->initTemplate();
-
-            // Log a request to the stats
             $this->_logRequest();
-
-            // Parse the template
             $data = $this->tpl->fetch( $customTpl );
-
-            // Check if caching is enabled
             if ( YDConfig::get( 'use_cache', false ) ) {
-
-                // Save the cache if needed
                 if ( $this->caching === true ) {
-
-                    // Save the cache
                     $f = fopen( YD_WEBLOG_CACHE_FNAME, 'wb' );
                     fwrite( $f, $data );
                     fclose( $f );
-
                 }
-
             }
-
-            // Return the parsed templaet
             return $data;
-
         }
 
         // Display the named template
         function display( $customTpl=null ) {
-
-            // Display a fetched template
             echo( $this->fetch( $customTpl ) );
-
         }
 
         // Get the name of the template
         function getTemplateName( $customTpl=null ) {
-
-            // Get the correct template name
             $name = is_null( $customTpl ) ? strtolower( get_class( $this ) ) : $customTpl;
-
-            // Return the file path
             return  $this->tpl->template_dir . $name . YD_TPL_EXT;
-
         }
 
         // Function to disbable request logging
@@ -379,36 +340,22 @@
 
         // Function to show a thumbnail
         function actionThumbnailSmall() {
-
-            // Get the image name
             if ( ! isset( $_GET['id'] ) ) {
                 die( 'No image selected.' );
             }
-
-            // Create a new image object
             $img = new YDFSImage( YDConfig::get( 'dir_uploads', '../uploads' ) . '/' . $_GET['id'] );
-
-            // Output the thumbnail
             $img->outputThumbnail( 48, 48 );
-
         }
 
         // Function to get the cookie path
         function _getCookiePath() {
-
-            // Get the path
             if ( YDStringUtil::endsWith( dirname( YD_SELF_SCRIPT ), '/manage' ) ) {
                 $cookiePath = dirname( dirname( YD_SELF_SCRIPT ) );
             } else {
                 $cookiePath =  dirname( YD_SELF_SCRIPT );
             }
-
-            // Trim the unneeded characters
             $cookiePath = rtrim( str_replace( '\\', '/', $cookiePath ), '/' );
-
-            // Return the cookie path
             return $cookiePath . '/';
-
         }
 
         // The login action
@@ -471,16 +418,9 @@
 
         // Logout action
         function actionLogout() {
-
-            // Get the path for the cookies
             $cookiePath = $this->_getCookiePath();
-
-            // Set the cookie
             setcookie( 'YD_USER_PASS', null, time() - 31536000, $cookiePath );
-
-            // Redirect to the login
             $this->redirectToAction( 'login' );
-
         }
 
         // Check for authentication

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -66,35 +66,18 @@
         }
     }
 
-    // Check if the user wanted to use caching
+    // Cache output if needed
     if ( YDConfig::get( 'use_cache', false ) ) {
-
-        // Check if we allow caching
         if ( sizeof( $_POST ) == 0 ) {
-
-            // Check if there is a cache item for this request
             if ( is_file( YD_WEBLOG_CACHE_FNAME ) ) {
-
-                // Output the cached item
                 $data = file_get_contents( YD_WEBLOG_CACHE_FNAME );
-
-                // Include a cache filter if any
                 @include( dirname( __FILE__ ) . '/cache_filter.php' );
-
-                // Add the elapsed time
                 $elapsed = $GLOBALS['timer']->getElapsed();
-
-                // Log the request to the statistics
                 $req = new YDWeblogRequest();
                 $req->_logRequest();
-
-                // Add the statistics
                 die( $data . YD_CRLF . '<!-- #cached: ' . $elapsed . ' ms -->' );
-
             }
-
         }
-
     }
 
     // Include the standard modules
@@ -102,7 +85,6 @@
     YDInclude( 'YDUtil.php' );
     YDInclude( 'YDForm.php' );
     YDInclude( 'YDFileSystem.php' );
-    YDInclude( 'YDFormElements/YDFormElement_TextArea.php' );
 
     // Check if the weblog application is locked or not
     $db = YDDatabase::getInstance(
@@ -110,13 +92,6 @@
         YDConfig::get( 'db_name', 'YDWeblog' ), YDConfig::get( 'db_user', 'root' ),
         YDConfig::get( 'db_pass', '' ), YDConfig::get( 'db_host', 'localhost' )
     );
-    $tables = $db->getRecords( 'show tables' );
-    $table_field_name = 'tables_in_' . strtolower( YDConfig::get( 'db_name', 'YDWeblog' ) );
-    foreach ( $tables as $table ) {
-        if ( strtolower( $table[$table_field_name] ) == YDConfig::get( 'db_prefix', '' ) . 'locked' ) {
-            die( 'Weblog application is being updated. Please come again later.' );
-        }
-    }
 
     // Set the right locale
     $language = YDConfig::get( 'weblog_language', 'en' );
@@ -239,39 +214,10 @@
 
         // Class constructor
         function YDWeblogForm( $name, $method='post', $action='', $target='_self', $attributes=array() ) {
-
-            // Initialize the parent
             $this->YDForm( $name, $method, $action, $target, $attributes );
-
-            // Set the required
             $this->setHtmlRequired( '', ' <span class="required">(' . t( 'required' ) . ')</span>' );
-
-            // Register the form element
-            $this->registerElement( 'wlbbtextarea', 'YDWeblogFormElement_BBTextArea' );
-            $this->registerElement( 'wladmintextarea', 'YDFormElement_AdminTextArea' );
-
         }
 
     }
 
-    // A BB Text Area form element
-    class YDWeblogFormElement_BBTextArea extends YDFormElement_TextArea {
-
-        // Class constructor
-        function YDWeblogFormElement_BBTextArea( $form, $name, $label='', $attributes=array(), $options=array() ) {
-            $this->YDFormElement_TextArea( $form, $name, $label, $attributes, $options );
-        }
-
-    }
-
-    // Custom bbtext area
-    class YDFormElement_AdminTextArea extends YDWeblogFormElement_BBTextArea {
-
-        // Class constructor
-        function YDFormElement_AdminTextArea( $form, $name, $label='', $attributes=array(), $options=array() ) {
-            $this->YDWeblogFormElement_BBTextArea( $form, $name, $label, $attributes, $options );
-        }
-
-    }
-
-?>
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/index.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/index.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -15,13 +15,13 @@
         function actionDefault() {
 
             // Get the ID from the query string
-            $id = $this->getIdFromQS();
+            $id = $this->getQueryStringParameterAsInt( 'id', -1 );
             if ( $id != -1 ) {
                 $this->redirect( 'item.php?id=' . $id );
             }
 
             // Add support for itemid query strings
-            $id = @is_numeric( $_GET['itemid'] ) ? intval( $_GET['itemid'] ) : -1;
+            $id = $this->getQueryStringParameterAsInt( 'itemid', -1 );
             if ( $id != -1 ) {
                 $this->redirect( 'item.php?id=' . $id );
             }
@@ -30,7 +30,7 @@
             $items     = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ) );
             $old_items = $this->weblog->getPublicItems( YDConfig::get( 'weblog_entries_fp', 5 ), sizeof( $items ) );
 
-            // Assign them to the template
+            // Assign the variables to the template
             $this->tpl->assign( 'items',     $items );
             $this->tpl->assign( 'old_items', $old_items );
 

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -30,9 +30,6 @@
             $item  = @ $this->weblog->getPublicItemById( $id );
             $this->redirectIfMissing( $item );
 
-            // Set the title
-            $this->tpl->assign( 'title', $item['title'] );
-
             // Get the related items
             $related_items = $this->weblog->getRelatedItemsByItem( YDConfig::get( 'weblog_entries_fp', 5 ), $item );
 
@@ -42,7 +39,8 @@
             // Get the comments
             $comments = $this->weblog->getComments( $id );
 
-            // Add them to the template
+            // Assign the variables to the template
+            $this->tpl->assign( 'title', $item['title'] );
             $this->tpl->assign( 'item', $item );
             $this->tpl->assign( 'related_items', $related_items );
             $this->tpl->assign( 'comments', $comments );

Modified: YDFramework2.0/trunk/examples/weblog/item_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -64,11 +64,9 @@
                 $image->exif = null;
             }
 
-            // Add them to the template
+            // Assign the variables to the template
             $this->tpl->assign( 'item',  $item );
             $this->tpl->assign( 'image', $image );
-
-            // Set the title
             $this->tpl->assign( 'title', $item['title'] . ' &raquo; ' . $image->getBasenameNoExt() );
 
             // Display the template

Modified: YDFramework2.0/trunk/examples/weblog/manage/cache.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/cache.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/manage/cache.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -8,10 +8,7 @@
 
         // Class constructor
         function cache() {
-
-            // Initialize the parent
             $this->YDWeblogAdminRequest();
-
         }
 
         // Default action
@@ -32,7 +29,6 @@
             $form->addElement( 'submit', '_cmdSubmit', t( 'cleanup' ), array( 'class' => 'button' ) );
             $form->setDefaults( array( 'cache_pub' => 1, 'cache_web' => 1, 'cache_tmb' => 1, 'cache_tpl' => 1 ) );
 
-
             // Validate the form
             if ( $form->validate() == true ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -77,34 +77,18 @@
 
             // Add a form rule for new links
             if ( $this->form->getValue( 'id' ) == '' ) {
-
-                // Add a rule to make sure the category is unique
                 $this->form->addFormRule( array( & $this, 'checkUniqueCategory' ) );
-
             }
 
             // Process the form
             if ( $this->form->validate() === true ) {
-
-                // Get the form values
                 $values = $this->form->getValues();
-
-                // If there is an ID, we do an edit
                 if ( $values['id'] ) {
-
-                    // Update the database
                     $this->weblog->updateCategory( $values );
-
                 } else {
-
-                    // Add it to the database
                     $this->weblog->addCategory( $values );
-
                 }
-
-                // Redirect to the default acton
                 $this->redirectToAction();
-
             }
 
             // Add the form to the template
@@ -117,36 +101,21 @@
 
         // Delete a category
         function actionDelete() {
-
-            // Get the ID from the query string
             $id = $this->getIdFromQS();
-
-            // If there is something, set the defaults
             if ( $id ) {
-
-                // Delete the category
                 $this->weblog->deleteCategory( $id );
-
             }
-
-            // Redirect to the default acton
             $this->redirectToAction();
-
         }
 
         // Check for a unique category
         function checkUniqueCategory( $values ) {
-
-            // Get the category by name
             $category = $this->weblog->getCategoryByName( $values['title'] );
-
-            // Return an error if it exists
             if ( $category ) {
                 return array( '__ALL__' => t( 'err_unique_category' ) );
             } else {
                 return true;
             }
-
         }
 
     }

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -8,10 +8,7 @@
 
         // Class constructor
         function comments() {
-
-            // Initialize the parent
             $this->YDWeblogAdminRequest();
-
         }
 
         // Default action
@@ -70,7 +67,7 @@
             $form->addElement( 'text',            'username',    t('name'),    array( 'class' => 'tfM' ) );
             $form->addElement( 'text',            'useremail',   t('mail'),    array( 'class' => 'tfM' ) );
             $form->addElement( 'text',            'userwebsite', t('website'), array( 'class' => 'tfM' ) );
-            $form->addElement( 'wladmintextarea', 'comment',     t('comment'), array( 'class' => 'tfM' ) );
+            $form->addElement( 'textarea',        'comment',     t('comment'), array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'created',     t('created_on'), array( 'class' => 'tfM' ) );
             $form->addElement( 'checkbox',        'is_spam',     t('is_spam'), array( 'style' => 'border: none;' ) );
             $form->addElement( 'hidden',          'id' );
@@ -123,10 +120,7 @@
 
             // Check if the comment exists
             if ( $form->getValue( 'id' ) == '' ) {
-
-                // Return to the default action
                 $this->redirectToAction();
-
             }
 
             // Process the form
@@ -156,59 +150,29 @@
 
         // Delete a category
         function actionDelete() {
-
-            // Get the ID from the query string
             $id = $this->getIdFromQS();
-
-            // If there is something, set the defaults
             if ( $id ) {
-
-                // Delete the comment
                 $this->weblog->deleteComment( $id );
-
             }
-
-            // Redirect to the default acton
             $this->redirectToAction();
-
         }
 
         // Action to mark a comment as spam
         function actionMark_as_spam() {
-
-            // Get the ID from the query string
             $id = $this->getIdFromQS();
-
-            // If there is something, set the defaults
             if ( $id ) {
-
-                // Delete the comment
                 $this->weblog->updateCommentAsSpam( $id );
-
             }
-
-            // Redirect to the default acton
             $this->redirect( YD_SELF_SCRIPT . '?filter=spam' );
-
         }
 
         // Action to unmark a comment as spam
         function actionMark_as_not_spam() {
-
-            // Get the ID from the query string
             $id = $this->getIdFromQS();
-
-            // If there is something, set the defaults
             if ( $id ) {
-
-                // Delete the comment
                 $this->weblog->updateCommentAsNotSpam( $id );
-
             }
-
-            // Redirect to the default acton
             $this->redirectToAction();
-
         }
 
     }

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -54,8 +54,8 @@
             // Create the edit form
             $form = new YDWeblogForm( 'itemForm', 'POST', YD_SELF_SCRIPT . '?do=edit' );
             $form->addElement( 'text',            'title',          t('item_title'),       array( 'class' => 'tfM' ) );
-            $form->addElement( 'wladmintextarea', 'body',           t('item_body'),        array( 'class' => 'tfM' ) );
-            $form->addElement( 'wladmintextarea', 'body_more',      t('item_body_more'),   array( 'class' => 'tfM' ) );
+            $form->addElement( 'textarea',        'body',           t('item_body'),        array( 'class' => 'tfM' ) );
+            $form->addElement( 'textarea',        'body_more',      t('item_body_more'),   array( 'class' => 'tfM' ) );
             $form->addElement( 'select',          'category_id',    t('category'),         array( 'class' => 'tfM', 'style' => 'width: 100%' ), $categories );
             $form->addElement( 'datetimeselect',  'created',        t('created_on'),       array( 'class' => 'tfM' ) );
             $form->addElement( 'datetimeselect',  'modified',       t('last_modified_on'), array( 'class' => 'tfM' ) );

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -15,7 +15,7 @@
             // Create the image upload form
             $this->form = new YDWeblogForm( 'pageForm', 'POST', YD_SELF_SCRIPT . '?do=edit' );
             $this->form->addElement( 'text', 'title', t('page_title'), array( 'class' => 'tfM' ) );
-            $this->form->addElement( 'wladmintextarea', 'body', t('page_body'), array( 'class' => 'taM' ) );
+            $this->form->addElement( 'textarea', 'body', t('page_body'), array( 'class' => 'taM' ) );
             $this->form->addElement( 'datetimeselect', 'created',     t('created_on'), array( 'class' => 'tfM' ) );
             $this->form->addElement( 'checkbox',       'is_draft',    t('is_draft'), array( 'style' => 'border: none;' ) );
             $this->form->addElement( 'hidden', 'id' );

Modified: YDFramework2.0/trunk/examples/weblog/page.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/page.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/page.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -21,10 +21,8 @@
             $page  = $this->weblog->getPublicPageById( $id );
             $this->redirectIfMissing( $page );
 
-            // Set the title
+            // Assign the variables to the template
             $this->tpl->assign( 'title', $page['title'] );
-
-            // Add them to the template
             $this->tpl->assign( 'page', $page );
 
             // Display the template

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-09-07 10:22:16 UTC (rev 2085)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-09-07 10:43:23 UTC (rev 2086)
@@ -11,10 +11,7 @@
 
         // Class constructor
         function xml() {
-
-            // Initialize the parent
             $this->YDWeblogRequest();
-
         }
 
         // Function to output the feed



From pclaerhout at mail.berlios.de  Thu Sep  7 12:48:49 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:48:49 +0200
Subject: [ydf-devel] r2087 - in YDFramework2.0/trunk/examples/weblog: .
	include skins/default skins/default_with_lightbox
Message-ID: <200609071048.k87Amn64017606@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:48:48 +0200 (Thu, 07 Sep 2006)
New Revision: 2087

Removed:
   YDFramework2.0/trunk/examples/weblog/include/exifer/
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/item_gallery.php
   YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_gallery.tpl
Log:
Removed the EXIF stuff from the weblog application as they were not really used in the first place.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 10:48:48 UTC (rev 2087)
@@ -207,9 +207,6 @@
                 $this->db->executeSql( 'ALTER TABLE #_schemaversion CHANGE installed installed INT(11)' );
                 $this->db->executeSql( 'UPDATE #_schemaversion SET installed = unix_timestamp() WHERE installed = 0' );
 
-                // Remove the auto close fields from the items
-
-
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 10:48:48 UTC (rev 2087)
@@ -50,7 +50,6 @@
     // Include other libraries
     YDInclude( dirname( __FILE__ ) . '/YDWeblogAPI.php' );
     YDInclude( dirname( __FILE__ ) . '/YDWeblogRequest.php' );
-    YDInclude( dirname( __FILE__ ) . '/exifer/exif.php' );
     YDInclude( YD_DIR_HOME . '/3rdparty/smarty/libs/plugins/modifier.truncate.php' );
 
     // Check for blocked IP addresses

Modified: YDFramework2.0/trunk/examples/weblog/item_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/item_gallery.php	2006-09-07 10:48:48 UTC (rev 2087)
@@ -46,24 +46,6 @@
                 }
             }
 
-            // Get the EXIF info for the image
-            $result = read_exif_data_raw( $image->getAbsolutePath(), false );
-            $image->exif = array();
-            if ( isset( $result['IFD0'] ) ) {
-                $image->exif = array_merge( $image->exif, $result['IFD0'] );
-            }
-            if ( isset( $result['SubIFD'] ) ) {
-                $image->exif = array_merge( $image->exif, $result['SubIFD'] );
-            }
-            if ( $image->exif ) {
-                @ $image->exif['full'] = $image->exif['Model'] . ' ' . str_replace( ' sec', 's', $image->exif['ExposureTime'] )
-                                     . ' ' . str_replace( ' ', '/', $image->exif['ApertureValue'] ) . ' ' .  t('at')
-                                     . ' ' . str_replace( ' ', '', $image->exif['FocalLength'] ) . ' ISO'
-                                     . $image->exif['ISOSpeedRatings'];
-            } else {
-                $image->exif = null;
-            }
-
             // Assign the variables to the template
             $this->tpl->assign( 'item',  $item );
             $this->tpl->assign( 'image', $image );

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-09-07 10:48:48 UTC (rev 2087)
@@ -45,10 +45,6 @@
                     ({t w="image"} {$image->num} {t w="of"} {$image->total_images})
                     <br/>
                     {t w="item"}: <a href="{$item|@link_item}">{$item.title}</a>
-                    {if $image->exif}
-                        <br/>
-                        EXIF: {$image->exif.full}
-                    {/if}
                 </small>
             </p>
 

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 10:48:48 UTC (rev 2087)
@@ -18,7 +18,7 @@
                             <td width="12%" align="center" valign="middle" height="60">
                                 {if $image}
                                     <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                                    title="{$item.title} &raquo; {$image->getBasenameNoExt()}<br/>{$image->exif.full}"
+                                    title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
                                     ><img src="{$image|link_thumb_small}" alt="{$image->getBaseName()}" width="{$image->relative_path_s_obj->getWidth()}" height="{$image->relative_path_s_obj->getHeight()}"></a>
                                 {else}
                                     &nbsp;

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 10:48:48 UTC (rev 2087)
@@ -54,7 +54,7 @@
                     <td width="33%" align="center" style="vertical-align: middle;" height="100">
                         {if $image}
                             <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}<br/>{$image->exif.full}"
+                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
                              ><img src="{$image|link_thumb}" alt="{$image->getBaseName()}"
                              width="{$image->relative_path_m_obj->getWidth()}" height="{$image->relative_path_m_obj->getHeight()}"></a>
                         {else}
@@ -68,7 +68,7 @@
                     <td width="33%" align="center">
                         {if $image}
                             <p><a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}<br/>{$image->exif.full}"
+                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
                              >{$image->getBasenameNoExt()}</a><br/>&nbsp;</p>
                         {else}
                             &nbsp;

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_gallery.tpl	2006-09-07 10:43:23 UTC (rev 2086)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item_gallery.tpl	2006-09-07 10:48:48 UTC (rev 2087)
@@ -45,10 +45,6 @@
                     ({t w="image"} {$image->num} {t w="of"} {$image->total_images})
                     <br/>
                     {t w="item"}: <a href="{$item|@link_item}">{$item.title}</a>
-                    {if $image->exif}
-                        <br/>
-                        EXIF: {$image->exif.full}
-                    {/if}
                 </small>
             </p>
 



From pclaerhout at mail.berlios.de  Thu Sep  7 12:55:55 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 12:55:55 +0200
Subject: [ydf-devel] r2088 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200609071055.k87Attrb024538@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 12:55:55 +0200 (Thu, 07 Sep 2006)
New Revision: 2088

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Removed an SQL statement that was execute twice.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 10:48:48 UTC (rev 2087)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 10:55:55 UTC (rev 2088)
@@ -130,9 +130,6 @@
         // Get the schema version
         function getSchemaVersion() {
 
-            // Check if the schema version table exists
-            $tables = $this->dbmeta->getTables();
-
             // Create the schemaversion table if it doesn't exists
             if ( ! $this->dbmeta->tableExists( '#_schemaversion' ) ) {
                 $sql = 'CREATE TABLE #_schemaversion (installed INT(11), version INT (11))';



From pclaerhout at mail.berlios.de  Thu Sep  7 15:42:42 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 15:42:42 +0200
Subject: [ydf-devel] r2089 - in YDFramework2.0/trunk/examples/weblog: .
	include include/languages manage
Message-ID: <200609071342.k87DggA3005306@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 15:42:42 +0200 (Thu, 07 Sep 2006)
New Revision: 2089

Removed:
   YDFramework2.0/trunk/examples/weblog/manage/stats.php
   YDFramework2.0/trunk/examples/weblog/manage/stats.tpl
Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/index.php
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/manage.css
   YDFramework2.0/trunk/examples/weblog/xml.php
Log:
Removed the internal statistics as they were not as powerful as I would like them to be. Using a tool like Google Analytics or something similar is way more powerful.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -162,7 +162,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 4;
+            $current_schema = 5;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -204,6 +204,10 @@
                 $this->db->executeSql( 'ALTER TABLE #_schemaversion CHANGE installed installed INT(11)' );
                 $this->db->executeSql( 'UPDATE #_schemaversion SET installed = unix_timestamp() WHERE installed = 0' );
 
+                // Drop the statistics tables
+                $this->db->executeSql( 'DROP TABLE #_statistics' );
+                $this->db->executeSql( 'DROP TABLE #_statistics_init' );
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 
@@ -225,34 +229,6 @@
             }
         }
 
-        // Function to log a request to the statistics
-        function logRequestToStats( $values ) {
-
-            // Default to index.php
-            if ( ! empty( $values['uri'] ) ) {
-
-                // Create the where clause
-                $where = array();
-                foreach ( $values as $key=>$val ) {
-                    array_push( $where, $key . '=' . $this->str( $val ) );
-                }
-                $where =implode( ' and ', $where );
-
-                // Generate the SQL statement
-                $sql = $this->db->_createSqlUpdate( '#_statistics', $values, $where );
-                $sql = str_replace( ' WHERE', ',hits=hits+1 WHERE', $sql );
-
-                // Execute the SQL
-                $affected = $this->db->executeSql( $sql );
-                if ( $affected === 0 ) {
-                    $values['hits'] = '1';
-                    $this->db->executeInsert( '#_statistics', $values );
-                }
-
-            }
-
-        }
-
         // Function to auto add some records to an item
         function _fixItem( $item, $order='created desc, title' ) {
 
@@ -713,30 +689,6 @@
             );
         }
 
-        // Get the install date
-        function getInstallDate() {
-            return strtotime( $this->db->getValue( 'SELECT created FROM #_statistics_init LIMIT 1' ) );
-        }
-
-        // Get the total num of hits
-        function getTotalHits() {
-            $result = $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics' );
-            return empty( $result ) ? 0 : $result;
-        }
-
-        // Get the total num of hits without the bots
-        function getTotalHitsNoBots() {
-            $result = $this->db->getValue( 'SELECT SUM(hits) FROM #_statistics WHERE browser != \'bot\'' );
-            return empty( $result ) ? 0 : $result;
-        }
-
-        // Reset the statistics
-        function resetStats() {
-            $this->db->executeSql( 'truncate #_statistics' );
-            $this->db->executeSql( 'truncate #_statistics_init' );
-            $this->db->executeInsert( '#_statistics_init', array( 'created' => $this->db->getDate( '__NOW__' ) ) );
-        }
-
         // Get the number of items
         function getStatsItemCount() {
             return $this->db->getValue( 'SELECT count(*) FROM #_items' );
@@ -747,85 +699,6 @@
             return $this->db->getValue( 'SELECT count(*) FROM #_comments' );
         }
 
-        // Get the stats from the last 6 months
-        function getStatsMonths( $limit=6 ) {
-            YDInclude( 'YDDate.php' );
-            $records = $this->db->getRecords(
-                'SELECT DATE_FORMAT(date,\'%Y-%m\') AS YearMonth, SUM(hits) AS hits FROM #_statistics '
-              . ' GROUP BY YearMonth ORDER BY date DESC', $limit
-            );
-            foreach ( $records as $key=>$record ) {
-                $date = new YDDate( $record['yearmonth'] . '-01' );
-                $records[$key]['yearmonth'] = $record['yearmonth'] . ' (' . strtolower( $date->getMonthName() ) . ')';
-            }
-            return $records;
-        }
-
-        // Get the stats from the last 7 days
-        function getStatsDays( $limit=7 ) {
-            YDInclude( 'YDDate.php' );
-            $records = $this->db->getRecords(
-                'SELECT date, SUM(hits) AS hits FROM #_statistics GROUP BY date ORDER BY date DESC', $limit
-            );
-            foreach ( $records as $key=>$record ) {
-                $date = new YDDate( $record['date'] );
-                $records[$key]['date'] = $record['date'] . ' (' . strtolower( $date->getDayName() ) . ')';
-            }
-            return $records;
-        }
-
-        // Get the top 10 URLs
-        function getStatsUrls( $limit=10 ) {
-            return $this->db->getRecords(
-                'SELECT uri, SUM(hits) AS hits FROM #_statistics GROUP BY uri ORDER BY hits DESC', $limit
-            );
-        }
-
-        // Get the browser statistics
-        function getStatsBrowser() {
-            $browsers = array(
-                'bot'       => 'Automatic Bots',
-                'opera'     => 'Opera',
-                'ie'        => 'Internet Explorer',
-                'safari'    => 'Apple Safari',
-                'konqueror' => 'Konqueror',
-                'feed'      => 'RSS Reader',
-                'mozilla'   => 'Netscape/Mozilla/FireFox',
-                'unknown'   => t('other'),
-            );
-            $browserStats = $this->db->getRecords(
-                'SELECT browser, SUM(hits) AS hits FROM #_statistics GROUP BY browser ORDER BY hits DESC'
-            );
-            if ( sizeof( $browserStats ) > 0 ) {
-                foreach ( $browserStats as $key=>$val ) {
-                    $browserStats[$key]['browser'] = $browsers[ $val['browser'] ];
-                }
-            }
-            return $browserStats;
-        }
-
-        // Get the OS statistics
-        function getStatsOs() {
-            $platforms = array(
-                'win'       => 'Microsoft Windows',
-                'mac'       => 'Apple Macintosh',
-                'linux'     => 'Linux',
-                'unix'      => 'Unix',
-                'bot'       => 'Automatic Bots',
-                'feed'      => 'RSS Reader',
-                'unknown'   => t('other'),
-            );
-            $osStats = $this->db->getRecords(
-                'SELECT platform, SUM(hits) AS hits FROM #_statistics GROUP BY platform ORDER BY hits DESC'
-            );
-            if ( sizeof( $osStats ) > 0 ) {
-                foreach ( $osStats as $key=>$val ) {
-                    $osStats[$key]['platform'] = $platforms[ $val['platform'] ];
-                }
-            }
-            return $osStats;
-        }
-
         // Get the commenter statistics
         function getCommenterStats( $limit=10 ) {
             return $this->db->getRecords(

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -36,7 +36,6 @@
             $this->dir_uploads = YDConfig::get( 'dir_uploads', 'uploads' );
             $this->dir_skins   = YDConfig::get( 'dir_skins',   'skins' ) . '/';
 
-
             // Default to default skin
             if ( ! is_dir( dirname( __FILE__ ) . '/../' . $this->dir_skins . $this->skin . '/' ) ) {
                 YDConfig::set( 'weblog_skin', 'default' );
@@ -62,9 +61,6 @@
             $this->tpl->register_modifier( 'text_num_comments', 'YDTplModTextNumComments' );
             $this->tpl->register_modifier( 'text_num_images', 'YDTplModTextNumImages' );
 
-            // Get the browser information
-            $this->browser = new YDBrowserInfo();
-
         }
 
         // Clear the cache
@@ -180,7 +176,6 @@
         // Fetch a template
         function fetch( $customTpl=null ) {
             $this->initTemplate();
-            $this->_logRequest();
             $data = $this->tpl->fetch( $customTpl );
             if ( YDConfig::get( 'use_cache', false ) ) {
                 if ( $this->caching === true ) {
@@ -203,48 +198,6 @@
             return  $this->tpl->template_dir . $name . YD_TPL_EXT;
         }
 
-        // Function to disbable request logging
-        function _logRequest() {
-
-            // Check if we need to log statistics or not
-            if ( YDConfig::get( 'keep_stats', true ) ) {
-
-                // Get the logging data
-                $values = array();
-                $values['uri'] = str_replace( dirname( YD_SELF_SCRIPT ) . '/', '', $this->getNormalizedUri() );
-                if ( substr( $values['uri'], 0, 1 ) == '/' ) {
-                    $values['uri'] = substr( $values['uri'], 1 );
-                }
-                if ( substr( $values['uri'], 0, 4 ) == '.php' ) {
-                    $values['uri'] = basename( YD_SELF_SCRIPT ) . substr( $values['uri'], 4 );
-                }
-                $values['date'] = strftime( '%Y-%m-%d' );
-                $values['browser'] = $this->browser->browser;
-                $values['platform'] = $this->browser->platform;
-
-                // Fix the short URLs so that they all look the same
-                if ( YDConfig::get( 'friendly_urls', true ) && strpos( $values['uri'], '_' ) ) {
-                    if ( YDStringUtil::startswith( $values['uri'], 'image/', false ) ) {
-                        $values['uri'] = 'item_gallery.php?id=' . substr( $values['uri'], 6 );
-                    } elseif ( YDStringUtil::startswith( $values['uri'], 'archive' ) ) {
-                    } else {
-                        $values['uri'] = substr( $values['uri'], 0, strpos( $values['uri'], '_' ) )
-                                       . substr( $values['uri'], strpos( $values['uri'], '.php?id=' ) );
-                    }
-                }
-
-                // Add index.php
-                if ( empty( $values['uri'] ) && basename( YD_SELF_SCRIPT ) == 'index.php' ) {
-                    $values['uri'] = 'index.php';
-                }
-
-                // Add them to the database
-                $this->weblog->logRequestToStats( $values );
-
-            }
-
-        }
-
         // Check for authentication
         function isAuthenticated() {
             if ( ! empty( $_COOKIE[ 'YD_USER_NAME' ] ) && ! empty( $_COOKIE[ 'YD_USER_PASS' ] ) ) {
@@ -317,7 +270,6 @@
             $this->tpl->assign( 'weblog_description', YDConfig::get( 'weblog_description', 'Untitled Weblog Description' ) );
             $this->tpl->assign( 'weblog_language',    YDConfig::get( 'weblog_language', 'en' ) );
             $this->tpl->assign( 'google_analytics',   YDConfig::get( 'google_analytics', '' ) != '' );
-            $this->tpl->assign( 'keep_stats',         YDConfig::get( 'keep_stats', true ) );
 
             // Get the link to the different directories
             $uploads_dir = YDUrl::makeLinkAbsolute( '../' . $this->dir_uploads );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblog_init.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -73,7 +73,6 @@
                 @include( dirname( __FILE__ ) . '/cache_filter.php' );
                 $elapsed = $GLOBALS['timer']->getElapsed();
                 $req = new YDWeblogRequest();
-                $req->_logRequest();
                 die( $data . YD_CRLF . '<!-- #cached: ' . $elapsed . ' ms -->' );
             }
         }

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -293,7 +293,7 @@
 $GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Show debugging information';
 $GLOBALS['t']['cfg_default_item_settings'] = 'Default values for new items';
-$GLOBALS['t']['cfg_weblog_google_analytics'] = 'Google Analytics Account';
+$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -293,7 +293,7 @@
 $GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
 $GLOBALS['t']['cfg_include_debug_info'] = 'Toon debugging informatie';
 $GLOBALS['t']['cfg_default_item_settings'] = 'Standaard waardes voor nieuwe posts';
-$GLOBALS['t']['cfg_weblog_google_analytics'] = 'Google Analytics Account';
+$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
 $GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
 $GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 13:42:42 UTC (rev 2089)
@@ -127,16 +127,11 @@
                         &raquo; <a href="cache.php">{t w="a_cleanup_cache"}</a><br/>
                     </td>
                 </tr>
-                {if $keep_stats or $google_analytics}
+                {if $google_analytics}
                     <tr>
                         <td class="adminRowL">
                             <b>{t w="h_statistics"}</b><br/>
-                            {if $keep_stats}
-                                &raquo; <a href="stats.php">{t w="a_statistics"}</a><br/>
-                            {/if}
-                            {if $google_analytics}
-                                &raquo; <a href="https://www.google.com/analytics/home/" target="_blank">{t w="cfg_google_analytics"}</a><br/>
-                            {/if}
+                            &raquo; <a href="https://www.google.com/analytics/home/" target="_blank">{t w="cfg_google_analytics"}</a><br/>
                         </td>
                     </tr>
                 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -26,7 +26,6 @@
             // Fix the boolean values
             $config['email_new_comment']   = ( $config['email_new_comment'] ) ? t('yes') : t('no');
             $config['email_new_item']      = ( $config['email_new_item'] ) ? t('yes') : t('no');
-            $config['keep_stats']          = ( $config['keep_stats'] ) ? t('yes') : t('no');
             $config['use_cache']           = ( $config['use_cache'] ) ? t('yes') : t('no');
             $config['friendly_urls']       = ( $config['friendly_urls'] ) ? t('yes') : t('no');
             $config['include_debug_info']  = ( $config['include_debug_info'] ) ? t('yes') : t('no');
@@ -79,7 +78,6 @@
             $form->addElement( 'select', 'weblog_skin', t( 'cfg_weblog_skin' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $skins );
             $form->addElement( 'select', 'weblog_language', t( 'cfg_weblog_language' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $languages );
             $form->addElement( 'checkbox', 'include_debug_info', t( 'cfg_include_debug_info' ), array( 'style' => 'border: none;' ) );
-            $form->addElement( 'checkbox', 'keep_stats', t( 'cfg_keep_stats' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'google_analytics', t( 'cfg_weblog_google_analytics' ), array( 'class' => 'tfM' ) );
 
             $form->addElement( 'checkbox', 'email_new_comment', t( 'cfg_notification_email_comment' ),  array( 'style' => 'border: none;' ) );
@@ -158,7 +156,6 @@
             $config['weblog_entries_fp']    = YDConfig::get( 'weblog_entries_fp',    1 );
             $config['weblog_skin']          = YDConfig::get( 'weblog_skin',          'default' );
             $config['weblog_language']      = YDConfig::get( 'weblog_language',      'nl' );
-            $config['keep_stats']           = YDConfig::get( 'keep_stats',           true );
             $config['google_analytics']     = YDConfig::get( 'google_analytics',     '' );
             $config['include_debug_info']   = YDConfig::get( 'include_debug_info',   false );
             $config['email_new_comment']    = YDConfig::get( 'email_new_comment',    true );

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-07 13:42:42 UTC (rev 2089)
@@ -77,10 +77,6 @@
             <td class="adminRowL">{$config.include_debug_info}</td>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="cfg_keep_stats"}</td>
-            <td class="adminRowL">{$config.keep_stats}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="cfg_weblog_google_analytics"}</td>
             <td class="adminRowL">{$config.google_analytics|default:'-'}</td>
         </tr>
@@ -209,10 +205,6 @@
                 <td class="adminRowL">{$form.include_debug_info.html}</td>
             </tr>
             <tr>
-                <td class="adminRowL">{$form.keep_stats.label_html}</td>
-                <td class="adminRowL">{$form.keep_stats.html}</td>
-            </tr>
-            <tr>
                 <td class="adminRowL">{$form.google_analytics.label_html}</td>
                 <td class="adminRowL">{$form.google_analytics.html}</td>
             </tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -24,30 +24,13 @@
             $this->tpl->assign( 'items', $items );
 
             // Get the global statistics
-            $installDate   = $this->weblog->getInstallDate();
-            $daysOnline    = round( ( time() - $installDate ) / 86400 );
             $totalItems    = $this->weblog->getStatsItemCount();
             $totalComments = $this->weblog->getStatsCommentCount();
 
             // Assign these to the template
-            $this->tpl->assign( 'installDate',   $installDate );
-            $this->tpl->assign( 'daysOnline',    $daysOnline );
             $this->tpl->assign( 'totalItems',    $totalItems );
             $this->tpl->assign( 'totalComments', $totalComments );
 
-            // Check if we need to log statistics or not
-            if ( YDConfig::get( 'keep_stats', true ) ) {
-
-                // Get the averages
-                $totalHits     = $this->weblog->getTotalHits();
-                $avg_hitsaday  = @ intval( $totalHits / $daysOnline );
-
-                // Assign these to the template
-                $this->tpl->assign( 'totalHits',     $totalHits );
-                $this->tpl->assign( 'avg_hitsaday',  $avg_hitsaday );
-
-            }
-
             // Display the template
             $this->display();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2006-09-07 13:42:42 UTC (rev 2089)
@@ -73,27 +73,14 @@
             <td class="adminRowL">{t w="server"}</td>
             <td class="adminRowL" colspan="2">{$smarty.server.SERVER_NAME}{if $smarty.server.SERVER_PORT != '80'}:{$smarty.server.SERVER_PORT}{/if}</td>
         </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="installed_version"}</td>
-            <td class="adminRowL" colspan="2">{$YD_FW_REVISION}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="300">{t w="installed_since"}</td>
-            <td class="adminRowL" width="400" colspan="2">{$installDate|date:"%d %B %Y"|lower}</td>
-        </tr>
     </table>
 </td>
 <td width="350" align="right" valign="top">
     <table width="340" cellspacing="0" cellpadding="0" border="0">
         <tr>
-            <th class="adminRowLG">&raquo; <a href="stats.php"><b>{t w="a_statistics"}</b></a></th>
-            <th class="adminRowLGR"><a href="stats.php"><img src="images/more_details.gif" border="0" /></a></th>
+            <th class="adminRowLG" colspan="3">&raquo; {t w="a_statistics"}</th>
         </tr>
         <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="num_days_online"}</td>
-            <td class="adminRowL" colspan="2">{$daysOnline} {t w="days"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
             <td class="adminRowL">{t w="totalItems"}</td>
             <td class="adminRowL" colspan="2">{$totalItems} {t w="items"}</td>
         </tr>
@@ -101,16 +88,6 @@
             <td class="adminRowL">{t w="totalComments"}</td>
             <td class="adminRowL" colspan="2">{$totalComments} {t w="comments" lower=true}</td>
         </tr>
-        {if $keep_stats}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{t w="total_hits"}</td>
-                <td class="adminRowL" colspan="2">{$totalHits} {t w="hits"}</td>
-            </tr>
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{t w="avg_hits_per_day"}</td>
-                <td class="adminRowL" colspan="2">{$avg_hitsaday} {t w="hits"}</td>
-            </tr>
-        {/if}
     </table>
 </td></tr>
 </table>

Modified: YDFramework2.0/trunk/examples/weblog/manage/manage.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-07 13:42:42 UTC (rev 2089)
@@ -228,18 +228,6 @@
     width: 200px;
 }
 
-td.adminGraphD {
-	background: url(images/default-bg.gif);
-	background-position: 0% 100%;
-	background-repeat: repeat-x;
-}
-
-td.adminGraphL {
-	background: url(images/nav-bg.gif);
-	background-position: 0% 100%;
-	background-repeat: repeat-x;
-}
-
 a.leftColSelected {
     color: darkred;
     font-weight: bold;
@@ -261,6 +249,5 @@
     cursor: pointer;
 }
 
-
 input[type=checkbox], input[type=radio] { border:none; }
 input[type=submit], input[type=button] { background:white url(images/nav-bg.gif) bottom repeat-x; }

Deleted: YDFramework2.0/trunk/examples/weblog/manage/stats.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/stats.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -1,178 +0,0 @@
-<?php
-
-    // Include the Yellow Duck Framework
-    include_once( dirname( __FILE__ ) . '/../include/YDWeblog_init.php' );
-
-    // Class definition
-    class stats extends YDWeblogAdminRequest {
-
-        // Class constructor
-        function stats() {
-
-            // Initialize the parent
-            $this->YDWeblogAdminRequest();
-
-            // Check if we log statistics or not
-            if ( ! YDConfig::get( 'keep_stats', true ) ) {
-                $this->redirect();
-            }
-
-            // Register the graph template function
-            $this->tpl->register_function( 'graph', array( & $this, 'templateGraph' ) );
-
-            // Update the possible wrong statistics
-            $this->weblog->db->executeSql(
-                "update #_statistics set uri = concat( 'item', uri ) where uri like '.php?id=%'"
-            );
-
-            // Merge the other and unknown values
-            $this->weblog->db->executeSql( "update #_statistics set browser = 'unknown' where browser = 'other'" );
-            $this->weblog->db->executeSql( "update #_statistics set browser = 'bot' where browser = 'search'" );
-            $this->weblog->db->executeSql( "update #_statistics set browser = 'feed' where browser = 'rss reader'" );
-            $this->weblog->db->executeSql( "update #_statistics set browser = 'mozilla' where browser = 'firefox'" );
-            $this->weblog->db->executeSql( "update #_statistics set platform = 'unknown' where platform = 'other'" );
-
-        }
-
-        // Special template function to draw a graph
-        function templateGraph( $params ) {
-
-            // Calculate the widths
-            if ( empty( $params['width'] ) ) {
-                $params['width'] = '1';
-                $params['rest']  = '100';
-            } else {
-                $params['rest']  = 100 - intval( $params['width'] );
-            }
-
-            // Construct the graph
-            return '<table width="100%"  cellspacing="0" cellpadding="0" border="0"><tr>'
-                 . '<td class="adminGraphD" width="' . $params['width'] . '" height="10"></td>'
-                 . '<td class="adminGraphL" width="' . $params['rest']  . '" height="10"></td>'
-                 . '</tr></table>';
-
-        }
-
-        // Default action
-        function actionDefault() {
-
-            // Get the install date
-            $installDate        = $this->weblog->getInstallDate();
-            $daysOnline         = round( ( time() - $installDate ) / 86400 );
-            $totalHits          = $this->weblog->getTotalHits();
-            $totalHitsNoBots    = $this->weblog->getTotalHitsNoBots();
-            $avg_hitsaday       = @ intval( $totalHits / $daysOnline );
-            $avg_hitsadayNoBots = @ intval( $totalHitsNoBots / $daysOnline );
-            $totalItems         = $this->weblog->getStatsItemCount();
-            $totalComments      = $this->weblog->getStatsCommentCount();
-
-            // Assign these to the template
-            $this->tpl->assign( 'installDate',        $installDate );
-            $this->tpl->assign( 'daysOnline',         $daysOnline );
-            $this->tpl->assign( 'totalHits',          $totalHits );
-            $this->tpl->assign( 'totalHitsNoBots',    $totalHitsNoBots );
-            $this->tpl->assign( 'avg_hitsaday',       $avg_hitsaday );
-            $this->tpl->assign( 'avg_hitsadayNoBots', $avg_hitsadayNoBots );
-            $this->tpl->assign( 'totalItems',         $totalItems );
-            $this->tpl->assign( 'totalComments',      $totalComments );
-
-            // Get the list of the last 6 months
-            $last6Months  = $this->weblog->getStatsMonths();
-            $last7Days    = $this->weblog->getStatsDays();
-            $top10Urls    = $this->weblog->getStatsUrls();
-            $browserStats = $this->weblog->getStatsBrowser();
-            $osStats      = $this->weblog->getStatsOs();
-            $commentStats = $this->weblog->getCommenterStats();
-
-            // Assign these to the template
-            $this->tpl->assign( 'last6Months',  $this->_calculateGraph( $last6Months ) );
-            $this->tpl->assign( 'last7Days',    $this->_calculateGraph( $last7Days ) );
-            $this->tpl->assign( 'top10Urls',    $this->_calculateGraph( $top10Urls ) );
-            $this->tpl->assign( 'browserStats', $this->_calculateGraph( $browserStats ) );
-            $this->tpl->assign( 'osStats',      $this->_calculateGraph( $osStats ) );
-            $this->tpl->assign( 'commentStats', $this->_calculateGraph( $commentStats ) );
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // The showMonths action
-        function actionShowMonths() {
-
-            // Get the list of all the months
-            $months = $this->weblog->getStatsMonths( -1 );
-            $this->tpl->assign( 'months', $this->_calculateGraph( $months ) );
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // The showDays action
-        function actionShowDays() {
-
-            // Get the list of all the days
-            $days = $this->weblog->getStatsDays( -1 );
-            $this->tpl->assign( 'days', $this->_calculateGraph( $days ) );
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // The showUrls action
-        function actionShowUrls() {
-
-            // Get the list of all the days
-            $urls = $this->weblog->getStatsUrls( -1 );
-            $this->tpl->assign( 'urls', $this->_calculateGraph( $urls ) );
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // The Commenters action
-        function actionShowCommenters() {
-
-            // Get the list of all the days
-            $commenters = $this->weblog->getCommenterStats( -1 );
-            $this->tpl->assign( 'commenters', $this->_calculateGraph( $commenters ) );
-
-            // Display the template
-            $this->display();
-
-        }
-
-        // Reset the statistics
-        function actionReset() {
-            $this->weblog->resetStats();
-            $this->redirectToAction();
-        }
-
-        // Function to calculate the width of the graph elements
-        function _calculateGraph( $data, $field='hits' ) {
-            if ( sizeof( $data ) > 0 ) {
-                $maxHits = 0;
-                foreach ( $data as $key=>$val ) {
-                    if ( $val[$field] > $maxHits ) {
-                        $maxHits = $val[$field];
-                    }
-                }
-                foreach ( $data as $key=>$val ) {
-                    $data[$key][$field .'_pct'] = intval( ( $val[$field] / $maxHits ) * 100 ) . '%';
-                    if ( $data[$key][$field .'_pct'] == '0' ) {
-                        $data[$key][$field .'_pct'] = '1';
-                    }
-                }
-            }
-            return $data;
-        }
-
-    }
-
-    // Process the request
-    YDInclude( 'YDF2_process.php' );
-
-?>

Deleted: YDFramework2.0/trunk/examples/weblog/manage/stats.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/stats.tpl	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/manage/stats.tpl	2006-09-07 13:42:42 UTC (rev 2089)
@@ -1,269 +0,0 @@
-{include file="__mng_header.tpl"}
-
-{if $YD_ACTION == 'default'}
-
-    <p class="title">{t w="h_statistics"} &raquo; {t w="a_statistics"}</p>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowLG">&raquo; {t w="general_stats"}</th>
-            <th colspan="2" class="adminRowLGR">
-                <a href="{$YD_SELF_SCRIPT}?do=reset"
-                 onClick="return YDConfirmAction( '{t w="reset_stats"}' );"><b>{t w="reset_stats"}</b></a>
-            </th>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="350">{t w="installed_since"}</td>
-            <td class="adminRowL" width="350" colspan="2">{$installDate|date:"%d %B %Y"|lower}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="num_days_online"}</td>
-            <td class="adminRowL" colspan="2">{$daysOnline} {t w="days"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="totalItems"}</td>
-            <td class="adminRowL" colspan="2">{$totalItems} {t w="items"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="totalComments"}</td>
-            <td class="adminRowL" colspan="2">{$totalComments} {t w="comments" lower=true}</td>
-        </tr>
-    </table>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th colspan="3" class="adminRowLG">&raquo; {t w="total_average_stats"}</th>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="total_hits"}</td>
-            <td class="adminRowL" colspan="2">{$totalHits} {t w="hits"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="total_hits_no_bots"}</td>
-            <td class="adminRowL" colspan="2">{$totalHitsNoBots} {t w="hits"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="avg_hits_per_day"}</td>
-            <td class="adminRowL" colspan="2">{$avg_hitsaday} {t w="hits"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="avg_hits_per_day_no_bots"}</td>
-            <td class="adminRowL" colspan="2">{$avg_hitsadayNoBots} {t w="hits"}</td>
-        </tr>
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG">&raquo; {t w="hits_last_6_months"}</th>
-            <th colspan="2" class="adminRowLGR">
-                <a href="{$YD_SELF_SCRIPT}?do=showMonths"><img src="images/more_details.gif" border="0" /></a>
-                <a href="{$YD_SELF_SCRIPT}?do=showMonths"><b>{t w="all_months"}</b></a>
-            </th>
-        </tr>
-        {foreach from=$last6Months item="last6Month"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" width="200">{$last6Month.yearmonth}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$last6Month.hits_pct}</td>
-                <td class="adminRowR" width="100">{$last6Month.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG">&raquo; {t w="hits_last_7_days"}</th>
-            <th colspan="2" class="adminRowLGR">
-                <a href="{$YD_SELF_SCRIPT}?do=showDays"><img src="images/more_details.gif" border="0" /></a>
-                <a href="{$YD_SELF_SCRIPT}?do=showDays"><b>{t w="all_days"}</b></a>
-            </th>
-        </tr>
-        {foreach from=$last7Days item="last7Day"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$last7Day.date}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$last7Day.hits_pct}</td>
-                <td class="adminRowR">{$last7Day.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG">&raquo; {t w="top_10_urls"}</th>
-            <th colspan="2" class="adminRowLGR">
-                <a href="{$YD_SELF_SCRIPT}?do=showUrls"><img src="images/more_details.gif" border="0" /></a>
-                <a href="{$YD_SELF_SCRIPT}?do=showUrls"><b>{t w="all_urls"}</b></a>
-            </th>
-        </tr>
-        {foreach from=$top10Urls item="top10Url"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">
-                    <a href="../{$top10Url.uri}" target="_blank">{$top10Url.uri}</a>
-                </td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$top10Url.hits_pct}</td>
-                <td class="adminRowR">{$top10Url.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG">&raquo; {t w="top_10_commenters"}</th>
-            <th colspan="2" class="adminRowLGR">
-                <a href="{$YD_SELF_SCRIPT}?do=showCommenters"><img src="images/more_details.gif" border="0" /></a>
-                <a href="{$YD_SELF_SCRIPT}?do=showCommenters"><b>{t w="all_commenters"}</b></a>
-            </th>
-        </tr>
-        {foreach from=$commentStats item="commenter"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$commenter.username}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$commenter.hits_pct}</td>
-                <td class="adminRowR">{$commenter.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th colspan="3" class="adminRowLG">&raquo; {t w="web_browsers"}</th>
-        </tr>
-        {foreach from=$browserStats item="browserStat"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$browserStat.browser}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$browserStat.hits_pct}</td>
-                <td class="adminRowR" width="100">{$browserStat.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-        <tr><td colspan="3">&nbsp;</td></tr>
-        <tr>
-            <th colspan="3" class="adminRowLG">&raquo; {t w="operating_systems"}</th>
-        </tr>
-        {foreach from=$osStats item="osStat"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL">{$osStat.platform}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$osStat.hits_pct}</td>
-                <td class="adminRowR" width="100">{$osStat.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-
-    </table>
-
-{/if}
-
-{if $YD_ACTION == 'showmonths'}
-
-    <p class="title">{t w="h_statistics"} &raquo; {t w="all_months"}</p>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th colspan="2" class="adminRowLG">&raquo; {t w="all_months"}</th>
-            <th class="adminRowLGR">&raquo; <a href="stats.php"><b>{t w="back"}</b></a></th>
-        </tr>
-        {foreach from=$months item="month"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" width="200">{$month.yearmonth}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$month.hits_pct}</td>
-                <td class="adminRowR" width="100">{$month.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-    </table>
-
-{/if}
-
-{if $YD_ACTION == 'showdays'}
-
-    <p class="title">{t w="h_statistics"} &raquo; {t w="all_days"}</p>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th colspan="2" class="adminRowLG">&raquo; {t w="all_days"}</th>
-            <th class="adminRowLGR">&raquo; <a href="stats.php"><b>{t w="back"}</b></a></th>
-        </tr>
-        {foreach from=$days item="day"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" width="200">{$day.date}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$day.hits_pct}</td>
-                <td class="adminRowR" width="100">{$day.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-    </table>
-
-{/if}
-
-{if $YD_ACTION == 'showurls'}
-
-    <p class="title">{t w="h_statistics"} &raquo; {t w="all_urls"}</p>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th colspan="2" class="adminRowLG">&raquo; {t w="all_urls"}</th>
-             <th class="adminRowLGR">&raquo; <a href="stats.php"><b>{t w="back"}</b></a></th>
-       </tr>
-        {foreach from=$urls item="url"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" width="200"><a href="../{$url.uri}" target="_blank">{$url.uri}</a>   </td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$url.hits_pct}</td>
-                <td class="adminRowR" width="100">{$url.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-    </table>
-
-{/if}
-
-{if $YD_ACTION == 'showcommenters'}
-
-    <p class="title">{t w="h_statistics"} &raquo; {t w="all_commenters"}</p>
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th colspan="2" class="adminRowLG">&raquo; {t w="all_commenters"}</th>
-            <th class="adminRowLGR">&raquo; <a href="stats.php"><b>{t w="back"}</b></a></th>
-        </tr>
-        {foreach from=$commenters item="commenter"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" width="200">{$commenter.username}</td>
-                <td class="adminRowL" style="vertical-align: middle;">{graph width=$commenter.hits_pct}</td>
-                <td class="adminRowR" width="100">{$commenter.hits}</td>
-            </tr>
-        {foreachelse}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                <td class="adminRowL" colspan="3">{t w="nothing_found"}</td>
-            </tr>
-        {/foreach}
-    </table>
-
-{/if}
-
-{include file="__mng_footer.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/xml.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/xml.php	2006-09-07 10:55:55 UTC (rev 2088)
+++ YDFramework2.0/trunk/examples/weblog/xml.php	2006-09-07 13:42:42 UTC (rev 2089)
@@ -17,7 +17,6 @@
         // Function to output the feed
         function outputXml( $type ) {
             $this->feed->outputXml( $type );
-            $this->_logRequest();
         }
 
         // Default action



From pclaerhout at mail.berlios.de  Thu Sep  7 15:48:30 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 15:48:30 +0200
Subject: [ydf-devel] r2090 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609071348.k87DmUbS005750@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 15:48:30 +0200 (Thu, 07 Sep 2006)
New Revision: 2090

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/config.php
Log:
The database password is no longer shown in the settings of the weblog application.

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-07 13:42:42 UTC (rev 2089)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-07 13:48:30 UTC (rev 2090)
@@ -31,6 +31,9 @@
             $config['include_debug_info']  = ( $config['include_debug_info'] ) ? t('yes') : t('no');
             $config['dflt_is_draft']       = ( $config['dflt_is_draft'] ) ? t('yes') : t('no');
 
+            // Hide the database password if any
+            $config['db_pass'] = str_repeat( '*', strlen( $config['db_pass'] ) );
+
             // Assign it to the template
             $this->tpl->assign( 'config', $config );
 
@@ -69,7 +72,7 @@
             $form->addElement( 'text', 'db_host', t( 'cfg_db_host' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'text', 'db_name', t( 'cfg_db_name' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'text', 'db_user', t( 'cfg_db_user' ), array( 'class' => 'tfM' ) );
-            $form->addElement( 'text', 'db_pass', t( 'cfg_db_pass' ), array( 'class' => 'tfM' ) );
+            $form->addElement( 'password', 'db_pass', t( 'cfg_db_pass' ), array( 'class' => 'tfM' ) );
             $form->addElement( 'text', 'db_prefix', t( 'cfg_db_prefix' ), array( 'class' => 'tfM' ) );
 
             $form->addElement( 'text', 'weblog_title', t( 'cfg_weblog_title' ), array( 'class' => 'tfM' ) );



From pclaerhout at mail.berlios.de  Thu Sep  7 16:07:03 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:07:03 +0200
Subject: [ydf-devel] r2091 -
	YDFramework2.0/trunk/YDFramework2/addons/YDBBCode
Message-ID: <200609071407.k87E738s007871@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:07:02 +0200 (Thu, 07 Sep 2006)
New Revision: 2091

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
Log:
Fixed the XHTML output of the YDBBCode addon.

See also: [ Bug #7538 ] simple fixes in default weblog skin


Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-09-07 13:48:30 UTC (rev 2090)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-09-07 14:07:02 UTC (rev 2091)
@@ -64,8 +64,8 @@
             $this->addRule( "/\[mail\]([^<> \n]+?)\[\/mail\]/i", '<a href="mailto:\\1">\\1</a>' );
             $this->addRule( "/\[email=([^<> \n]+?)\](.+?)\[\/email\]/i", '<a href="mailto:\\1">\\2</a>' );
             $this->addRule( "/\[email\]([^<> \n]+?)\[\/email\]/i", '<a href="mailto:\\1">\\1</a>' );
-            $this->addRule( "/\[img=([^<> \n]+?)\](.+?)\[\/img\]/i", '<a href="\\1"><img border="0" src="\\2"></a>' );
-            $this->addRule( "/\[img\]([^<> \n]+?)\[\/img\]/i", '<img border="0" src="\\1">' );
+            $this->addRule( "/\[img=([^<> \n]+?)\](.+?)\[\/img\]/i", '<a href="\\1"><img border="0" src="\\2" alt="\\2" /></a>' );
+            $this->addRule( "/\[img\]([^<> \n]+?)\[\/img\]/i", '<img border="0" src="\\1" alt="\\1" />' );
             $this->addRule( "/\[color=([^<> \n]+?)\](.+?)\[\/color\]/i", '<font color="\\1">\\2</font>' );
 
             // Attributes to convert links



From pclaerhout at mail.berlios.de  Thu Sep  7 16:08:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:08:37 +0200
Subject: [ydf-devel] r2092 - in YDFramework2.0/trunk/examples/weblog: manage
	skins/default skins/default_with_lightbox
Message-ID: <200609071408.k87E8b8u007967@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:08:37 +0200 (Thu, 07 Sep 2006)
New Revision: 2092

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/__std_header.tpl
Log:
Fixed the XHTML output of the YDWeblog skin.

See also: [ Bug #7538 ] simple fixes in default weblog skin


Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 14:07:02 UTC (rev 2091)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 14:08:37 UTC (rev 2092)
@@ -6,9 +6,9 @@
 
     <link rel="stylesheet" type="text/css" href="manage.css" />
 
-    <script language="JavaScript" src="../tiny_mce/tiny_mce_gzip.php"></script>
+    <script type="text/javascript" src="../tiny_mce/tiny_mce_gzip.php"></script>
 
-    <script language="JavaScript">
+    <script type="text/javascript">
     <!--
 
         {literal}function YDConfirmDelete( name ) {{/literal}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl	2006-09-07 14:07:02 UTC (rev 2091)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/__std_header.tpl	2006-09-07 14:08:37 UTC (rev 2092)
@@ -33,7 +33,7 @@
     <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="{$weblog_link_atom}" />
 
     {if $user.name}
-        <script language="JavaScript">
+        <script type="text/javascript">
         <!--
 
             {literal}function YDConfirmDelete( img ) {{/literal}
@@ -46,9 +46,9 @@
 
     {$weblog_google_analytics}
 
-    <script language="JavaScript" src="tiny_mce/tiny_mce_gzip.php"></script>
+    <script type="text/javascript" src="tiny_mce/tiny_mce_gzip.php"></script>
 
-    <script language="JavaScript">
+    <script type="text/javascript">
     <!--
 
         {literal}tinyMCE.init({

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/__std_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/__std_header.tpl	2006-09-07 14:07:02 UTC (rev 2091)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/__std_header.tpl	2006-09-07 14:08:37 UTC (rev 2092)
@@ -39,7 +39,7 @@
     <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="{$weblog_link_atom}" />
 
     {if $user.name}
-        <script language="JavaScript">
+        <script type="text/javascript">
         <!--
 
             {literal}function YDConfirmDelete( img ) {{/literal}
@@ -52,9 +52,9 @@
 
     {$weblog_google_analytics}
 
-    <script language="JavaScript" src="tiny_mce/tiny_mce_gzip.php"></script>
+    <script type="text/javascript" src="tiny_mce/tiny_mce_gzip.php"></script>
 
-    <script language="JavaScript">
+    <script type="text/javascript">
     <!--
 
         {literal}tinyMCE.init({



From pclaerhout at mail.berlios.de  Thu Sep  7 16:34:24 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:34:24 +0200
Subject: [ydf-devel] r2093 - in YDFramework2.0/trunk/examples/weblog/skins:
	default default_with_lightbox
Message-ID: <200609071434.k87EYOCA010837@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:34:23 +0200 (Thu, 07 Sep 2006)
New Revision: 2093

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Fixed some wrong HTML tags in the weblog application.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 14:08:37 UTC (rev 2092)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 14:34:23 UTC (rev 2093)
@@ -23,7 +23,7 @@
                                 {/if}
                             </td>
                         {/foreach}
-                    <tr/>
+                    </tr>
                     {/foreach}
                 </table>
                 </p>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 14:08:37 UTC (rev 2092)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 14:34:23 UTC (rev 2093)
@@ -60,7 +60,7 @@
                         {/if}
                     </td>
                 {/foreach}
-            <tr/>
+            </tr>
             <tr>
                 {foreach from=$image_row item="image"}
                     <td width="33%" align="center">
@@ -71,7 +71,7 @@
                         {/if}
                      </td>
                 {/foreach}
-            <tr/>
+            </tr>
             {/foreach}
             </table></p>
         {/if}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 14:08:37 UTC (rev 2092)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 14:34:23 UTC (rev 2093)
@@ -25,7 +25,7 @@
                                 {/if}
                             </td>
                         {/foreach}
-                    <tr/>
+                    </tr>
                     {/foreach}
                 </table>
                 </p>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 14:08:37 UTC (rev 2092)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 14:34:23 UTC (rev 2093)
@@ -62,7 +62,7 @@
                         {/if}
                     </td>
                 {/foreach}
-            <tr/>
+            </tr>
             <tr>
                 {foreach from=$image_row item="image"}
                     <td width="33%" align="center">
@@ -75,7 +75,7 @@
                         {/if}
                      </td>
                 {/foreach}
-            <tr/>
+            </tr>
             {/foreach}
             </table></p>
         {/if}



From pclaerhout at mail.berlios.de  Thu Sep  7 16:38:25 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:38:25 +0200
Subject: [ydf-devel] r2094 - in YDFramework2.0/trunk/examples/weblog/skins:
	default default_with_lightbox
Message-ID: <200609071438.k87EcPxQ011434@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:38:25 +0200 (Thu, 07 Sep 2006)
New Revision: 2094

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Fixed some more HTML issues in the weblog skins.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 14:34:23 UTC (rev 2093)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 14:38:25 UTC (rev 2094)
@@ -11,7 +11,7 @@
                 </h2>
                 <small>{$item.created|date|lower} {t w="by"} <a href="mailto:{$item.user_email|escape:'hexentity'}">{$item.user_name|lower}</a></small>
                 <p>
-                    <table width="450" border=0 cellspacing=0 cellpadding=0>
+                    <table width="450" border="0" cellspacing="0" cellpadding="0">
                     {foreach from=$item.images_as_table item="image_row"}
                     <tr>
                         {foreach from=$image_row item="image"}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 14:34:23 UTC (rev 2093)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 14:38:25 UTC (rev 2094)
@@ -47,7 +47,7 @@
         {if $item.images}
             <a name="images"></a>
             <h3>{$item|@text_num_images} {t w="with"} &#8220;{$item.title}&#8221;</h3>
-            <p><table width="450" border=0 cellspacing=0 cellpadding=0>
+            <p><table width="450" border="0" cellspacing="0" cellpadding="0">
             {foreach from=$item.images_as_table item="image_row"}
             <tr>
                 {foreach from=$image_row item="image"}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 14:34:23 UTC (rev 2093)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 14:38:25 UTC (rev 2094)
@@ -11,7 +11,7 @@
                 </h2>
                 <small>{$item.created|date|lower} {t w="by"} <a href="mailto:{$item.user_email|escape:'hexentity'}">{$item.user_name|lower}</a></small>
                 <p>
-                    <table width="450" border=0 cellspacing=0 cellpadding=0>
+                    <table width="450" border="0" cellspacing="0" cellpadding="0">
                     {foreach from=$item.images_as_table item="image_row"}
                     <tr>
                         {foreach from=$image_row item="image"}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 14:34:23 UTC (rev 2093)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 14:38:25 UTC (rev 2094)
@@ -47,7 +47,7 @@
         {if $item.images}
             <a name="images"></a>
             <h3>{$item|@text_num_images} {t w="with"} &#8220;{$item.title}&#8221;</h3>
-            <p><table width="450" border=0 cellspacing=0 cellpadding=0>
+            <p><table width="450" border="0" cellspacing="0" cellpadding="0">
             {foreach from=$item.images_as_table item="image_row"}
             <tr>
                 {foreach from=$image_row item="image"}



From pclaerhout at mail.berlios.de  Thu Sep  7 16:40:52 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:40:52 +0200
Subject: [ydf-devel] r2095 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers
Message-ID: <200609071440.k87EeqiR011803@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:40:52 +0200 (Thu, 07 Sep 2006)
New Revision: 2095

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
Log:
Made the PostgreSQL driver return errors properly.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2006-09-07 14:38:25 UTC (rev 2094)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2006-09-07 14:40:52 UTC (rev 2095)
@@ -212,7 +212,7 @@
 
             // Handle errors
             if ( $result === false && $this->_failOnError === true ) {
-                trigger_error( pg_last_error( $conn ), YD_ERROR );
+                trigger_error( pg_last_error( $this->conn ), YD_ERROR );
             }
 
             // Return the result



From pclaerhout at mail.berlios.de  Thu Sep  7 16:43:19 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:43:19 +0200
Subject: [ydf-devel] r2096 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers
Message-ID: <200609071443.k87EhJAW012073@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:43:19 +0200 (Thu, 07 Sep 2006)
New Revision: 2096

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
Log:
Fixed pg_fetch_array() unable to jump to row 1 ...

See also: [ Bug #7581 ] pg_fetch_array() unable to jump to row 1 ...


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2006-09-07 14:40:52 UTC (rev 2095)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2006-09-07 14:43:19 UTC (rev 2096)
@@ -104,7 +104,7 @@
         function getRecord( $sql ) {
             $result = & $this->_connectAndExec( $sql );
             $type = YDConfig::get( 'YD_DB_FETCHTYPE' ) == YD_DB_FETCH_NUM ? PGSQL_NUM : PGSQL_ASSOC;
-            return $this->_lowerKeyNames( pg_fetch_array( $result, $type ) );
+            return $this->_lowerKeyNames( pg_fetch_array( $result, NULL, $type ) );
         }
 
         /**
@@ -123,7 +123,7 @@
             $result = & $this->_connectAndExec( $sql );
             $type = YDConfig::get( 'YD_DB_FETCHTYPE' ) == YD_DB_FETCH_NUM ? PGSQL_NUM : PGSQL_ASSOC;
             $dataset = array();
-            while ( $line = $this->_lowerKeyNames( pg_fetch_array( $result, $type ) ) ) {
+            while ( $line = $this->_lowerKeyNames( pg_fetch_array( $result, NULL, $type ) ) ) {
                 array_push( $dataset, $line );
             }
             pg_free_result( $result );



From pclaerhout at mail.berlios.de  Thu Sep  7 16:54:48 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 16:54:48 +0200
Subject: [ydf-devel] r2097 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609071454.k87Esm7F013480@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 16:54:48 +0200 (Thu, 07 Sep 2006)
New Revision: 2097

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Did some code cleanup and added the _ALL_ option to addFilter.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-07 14:43:19 UTC (rev 2096)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-07 14:54:48 UTC (rev 2097)
@@ -315,13 +315,9 @@
          *  @param  $raw      (optional) Indicates if the value is a raw value.
          */
         function setDefault( $name, $value, $raw=false ) {
-
             if ( array_key_exists( $name, $this->_elements ) ) {
-
                 $element = & $this->getElement( $name );
                 $element->setDefault( $value, $raw );
-
-                // Update the value for the existing elements
                 if ( ! $this->isSubmitted() ) {
                     if ( $raw ) {
                         $element->setRawValue( $value );
@@ -329,12 +325,9 @@
                         $element->setValue( $value );
                     }
                 }
-
             } else {
                 $this->_defaults[ $name ] = $value;
             }
-
-
         }
 
         /**
@@ -480,13 +473,7 @@
          *  @returns  A boolean indicating if the element exists.
          */
         function isElement( $name ) {
-            
-            // Check if the element exists
-            if ( array_key_exists( $name, $this->_elements ) ) {
-                return true;
-            }
-            return false;
-            
+            return array_key_exists( $name, $this->_elements ) ? true : false;
         }
 
         /**
@@ -498,34 +485,24 @@
          *  @param  $options       (Optional) Custom filter options.
          */
         function addFilter( $element, $filter, $options = null ) {
-
-            // Check if the element is an array or not
+            if ( is_string( $element) && $element == '__ALL__' ) {
+                $element = array_keys( $this->_elements );
+            }
             if ( is_array( $element ) ) {
-
-                // Add the rule for each element
                 foreach ( $element as $e ) {
                     $this->addFilter( $e, $filter, $options );
                 }
-
-                // Return
                 return;
-
             }
-
-            // Check if it's a known filter
             if ( ! array_key_exists( $filter, $this->_regFilters ) ) {
                 trigger_error( 'Unknown filter "' . $filter . '" for element "' . $element . '"', YD_ERROR );
             }
-
-            // Include the filter file
             if ( ! empty( $this->_regFilters[ $filter ]['file'] ) ) {
                 YDInclude( $this->_regFilters[ $filter ]['file'] );
             }
-
-            // Initialize the element
-            if ( ! @ is_array( $this->_filters[ $element ] ) ) { $this->_filters[ $element ] = array(); }
-
-            // Add the filter
+            if ( ! @ is_array( $this->_filters[ $element ] ) ) {
+                $this->_filters[ $element ] = array();
+            }
             array_push( $this->_filters[ $element ], array( $filter, $options ) );
         }
 
@@ -553,40 +530,25 @@
          *  @param  $options    (optional) The options to pass to the validator function.
          */
         function addRule( $element, $rule, $error, $options=null ) {
-
-			// Check if element is special element '__ALL__'
-			if ( is_string( $element) && $element == '__ALL__' ) $element = array_keys( $this->_elements );
-
-            // Check if the element is an array or not
+            if ( is_string( $element) && $element == '__ALL__' ) {
+                $element = array_keys( $this->_elements );
+            }
             if ( is_array( $element ) ) {
-
-                // Add the rule for each element
                 foreach ( $element as $e ) {
                     $this->addRule( $e, $rule, $error, $options );
                 }
-
-                // Return
                 return;
-
             }
-
-            // Check if it's a known filter
             if ( ! array_key_exists( $rule, $this->_regRules ) ) {
                 trigger_error( 'Unknown rule "' . $rule . '" for element "' . $element . '"', YD_ERROR );
             }
-
-            // Include the rule file
             if ( ! empty( $this->_regRules[ $rule ]['file'] ) ) {
                 YDInclude( $this->_regRules[ $rule ]['file'] );
             }
-
-            // Initialize the element
-            if ( ! @ is_array( $this->_rules[ $element ] ) ) { $this->_rules[ $element ] = array(); }
-
-            // Add the rule
+            if ( ! @ is_array( $this->_rules[ $element ] ) ) {
+                $this->_rules[ $element ] = array();
+            }
             array_push( $this->_rules[ $element ], array( 'rule' => $rule, 'error' => $error, 'options' => $options ) );
-
-
         }
 
         /**
@@ -691,10 +653,9 @@
         function getValues() {
             $vars = array();
             foreach ( $this->_elements as $name => $element ) {
-
-                // check if elements are special
-                if ( $element->getType() == 'span' ) continue;
-
+                if ( $element->getType() == 'span' ) {
+                    continue;
+                }
                 $vars[ $name ] = $this->getValue( $name );
             }
             return $vars;
@@ -710,21 +671,17 @@
          *  @returns    An array/string containing all active error messages
          */
         function getErrors( $asString = false, $separator = "\n", $initial = '' ) {
-
-            // get form errors
             $errors = array_unique( array_values( $this->_errors ) );
-
-            // if we want a string, we must implode with custom separator and use initial string
-            if ( $asString ) $errors = $initial . implode( $separator, $errors );
-
-            // return errors
+            if ( $asString ) {
+                $errors = $initial . implode( $separator, $errors );
+            }
             return $errors;
         }
 
         /**
-         *      Gets the name of the form.
+         *  Gets the name of the form.
          *
-         *      @returns        The name of the form.
+         *  @returns        The name of the form.
          */
         function getName() {
             return $this->_name;
@@ -736,28 +693,14 @@
          *  @returns    Boolean indicating if the form was submitted or not.
          */
         function isSubmitted() {
-
-            // Get the right variables
-            if ( $this->_method == 'get' ) {
-                $vars = $_GET;
-            } else {
-                $vars = $_POST;
-            }
-
-            // Loop over the post variables
+            $vars = ( $this->_method == 'get' ) ? $_GET : $_POST;
             foreach ( $vars as $key=>$value ) {
-
-                // Remove the form name from the element name
                 $key = preg_replace( '/^' . $this->_name . '_/', '', $key );
-
-                // Check if the key is a form element
-                if ( array_key_exists( $key, $this->_elements ) ) { return true; };
-
+                if ( array_key_exists( $key, $this->_elements ) ) {
+                    return true;
+                };
             }
-
-            // Return false
             return false;
-
         }
 
         /**
@@ -768,23 +711,13 @@
          *  @returns    Boolean indicating if the button was clicked or not.
          */
         function isClicked( $button ) {
-
-            // Get the element.
             $element = $this->getElement( $button );
-
-            // Check if it's a button
             if ( $element->isButton() === true ) {
-
-                // Check the post variables
                 if ( array_key_exists( $this->_name . '_' . $element->_name, $this->_formVars ) ) {
                     return true;
                 }
-
             }
-
-            // Return false in all other cases
             return false;
-
         }
 
         /**
@@ -819,7 +752,6 @@
             return $this->validate( $customvalues );
         }
 
-
         /**
          *  This function will return true if the form is valid. If not, it will return false.
          *
@@ -852,7 +784,8 @@
 
                         // Set the value
                         $this->_elements[ $key ]->setValue( $value );
-						$this->setDefault( $key, $value );
+                        $this->setDefault( $key, $value );
+
                     }
                 }
             }
@@ -930,6 +863,7 @@
                             }
                         }
 
+                        // Check mandatory elements
                         if ( $mandatory ) {
 
                             // Check the rule
@@ -1089,15 +1023,10 @@
          *  @returns    The rendered form.
          */
         function render( $type ) {
-
-            // Get the renderer object
             $instance = $this->getRenderer( $type );
-
-            // Return the rendered form
             return $instance->render();
-
         }
-        
+
         /**
          *  This function will use the import feature of the renderers to define
          *  the object with new settings from the content returned by the render method.
@@ -1107,19 +1036,13 @@
          *  @param  $options   (optional) Additional options.
          */
         function import( $type, $content, $options=array() ) {
-
-            // Get the renderer object
             $instance = $this->getRenderer( $type );
-
-            // Import the form
             $new_this = $instance->import( $content, $options );
-            
             foreach ( get_object_vars( $new_this ) as $key => $val ) {
                 $this->$key = $val;
             }
-
         }
-        
+
         /**
          *  This function will return an instance of a renderer class.
          *
@@ -1128,26 +1051,16 @@
          *  @returns    The renderer object.
          */
         function getRenderer( $type ) {
-            
-            // Check if the renderer is known
             if ( ! array_key_exists( $type, $this->_regRenderers ) ) {
                 trigger_error( 'Unknown for renderer type "' . $type . '".', YD_ERROR );
             }
-
-            // Include the renderer file
             if ( ! empty( $this->_regRenderers[ $type ]['file'] ) ) {
                 YDInclude( $this->_regRenderers[ $type ]['file'] );
             }
-
-            // Check if the class exists
             $class = $this->_regRenderers[ $type ]['class'];
-
-            // Return the instance
             return new $class( $this );
-        
         }
 
-
         /**
          *  This function will return the form as an array.
          *
@@ -1241,11 +1154,9 @@
          *  @param $array   Associative array containing the default values.
          */
         function setRawDefaults( $array ) {
-
             foreach ( $array as $key => $val ) {
                 $this->setDefault( $key, $val, true );
             }
-
         }
 
         /**
@@ -1284,9 +1195,7 @@
          *  @returns      The default value of the element.
          */
         function getDefault( $name ) {
-
             $element = & $this->getElement( $name );
-
             if ( ! is_null( $element->_default ) ) {
                 return $element->getDefault();
             }
@@ -1298,22 +1207,16 @@
          *  @returns  The modified elements and it's values as an associative array.
          */
         function getModifiedValues() {
-
             $modified = array();
-
             if ( $this->isSubmitted() ) {
-
                 foreach ( $this->_elements as $name => $element ) {
                     if ( $element->isModified() ) {
                         $modified[ $name ] = $this->getValue( $name );
                     }
                 }
-
             }
-
             return $modified;
         }
-
     }
 
     /**
@@ -1370,7 +1273,6 @@
             $this->_attributes[$key] = $val;
         }
 
-
         /**
          *  Function to set attributes of a form element
          *
@@ -1381,7 +1283,6 @@
                 $this->setAttribute( $k, $v );
         }
 
-
         /**
          *  Function to delete an attribute of a form element
          *
@@ -1391,7 +1292,6 @@
             if ( isset( $this->_attributes[$key] ) ) unset( $this->_attributes[$key] );
         }
 
-
         /**
          *  Function to delete all attributes of a form element
          */
@@ -1399,7 +1299,6 @@
             $this->_attributes = array() ;
         }
 
-		
         /**
          *  Function to set the option of a form element
          *
@@ -1408,9 +1307,8 @@
          */
         function setOption( $key, $val ) {
             $this->_options[$key] = $val;
-        }		
+        }
 
-
         /**
          *  Function to delete an option of a form element
          *
@@ -1420,7 +1318,6 @@
             if ( isset( $this->_options[$key] ) ) unset( $this->_options[$key] );
         }
 
-
         /**
          *  Function to delete all options of a form element
          */
@@ -1428,7 +1325,6 @@
             $this->_options = array();
         }
 
-
         /**
          *  This function sets the value for the element.
          *
@@ -1522,7 +1418,7 @@
         function getOptions() {
             return $this->_options;
         }
-        
+
         /**
          *      Gets the name of the form.
          *
@@ -1615,27 +1511,22 @@
         function toHtml() {
         }
 
-
         /**
          *	This function returns the default javascript event of this element
          */
         function getJSEvent(){ 
-
             die( 'Element type (' . $this->getType() . ') is not supported in YDAjax' );
         }
 
-
         /**
          *	This function gets an element value using javascript
          *
          *	@param $options		(optional) The options for the elment.
          */
         function getJS( $options = null ){ 
-
             die( 'Element type (' . $this->getType() . ') is not supported in YDAjax events' );
         }
 
-
         /**
          *	This function sets an element value using javascript
          *
@@ -1644,12 +1535,9 @@
          *	@param $options		(optional) The options for the elment.
          */
         function setJS( $result, $attribute = null, $options = null ){ 
-
             die( 'Element type (' . $this->getType() . ') is not supported in YDAjax responses' );
         }
 
-
-
     }
 
     /**
@@ -1706,19 +1594,11 @@
      *  @returns The filtered data as a string.
      */
     function YDFormFilter_safe_html( $data ) {
-
-        // Include the safe_html library
         require_once( YD_DIR_HOME . '/3rdparty/safehtml/classes/safehtml.php' );
-
-        // Instantiate the handler
         $safehtml = & new safehtml();
-
-        // Return the filtered data
         return $safehtml->parse( $data );
-
     }
 
-
     /**
      *  This filter reads a date form element result and returns a custom result
      *
@@ -1728,15 +1608,11 @@
      *  @returns The filtered data as a string.
      */
     function YDFormFilter_dateformat( $data, $option = "timestamp" ) {
-
-        // check if option is a array member
-        if ( isset( $data[ $option ] ) ) return $data[ $option ];
-
-        // if not a member we want a custom date format eg: "datetimesql", "%b"
+        if ( isset( $data[ $option ] ) ) {
+            return $data[ $option ];
+        }
         YDInclude( 'YDUtil.php' );
-
         return YDStringUtil::formatDate( $data, $option );
     }
 
-
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Thu Sep  7 17:12:08 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 17:12:08 +0200
Subject: [ydf-devel] r2098 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609071512.k87FC8p8014939@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 17:12:06 +0200 (Thu, 07 Sep 2006)
New Revision: 2098

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Some minor code cleanup.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-07 14:54:48 UTC (rev 2097)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-07 15:12:06 UTC (rev 2098)
@@ -264,8 +264,6 @@
             if ( ! isset( $where[$name] ) ) {
                 $where[$name] = array();
             }
-
-
         }
 
     }



From pclaerhout at mail.berlios.de  Thu Sep  7 17:16:34 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 17:16:34 +0200
Subject: [ydf-devel] r2099 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609071516.k87FGYfZ015350@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 17:16:33 +0200 (Thu, 07 Sep 2006)
New Revision: 2099

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Made the debugging output a bit more readable and less influenced by other CSS styles.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-07 15:12:06 UTC (rev 2098)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-07 15:16:33 UTC (rev 2099)
@@ -328,10 +328,11 @@
             $data = var_export( $obj, true );
             if ( $html == true ) {
                 $data = stripslashes( htmlentities( $data ) );
+                $style = ' style="text-align: left; font-size: 10pt;"';
                 if ( ! empty( $label ) ) {
-                    $data = '<pre><b style="color: navy">' . $label . '</b><br>' . $data . '</pre>';
+                    $data = '<pre' . $style . '><b style="color: navy">' . $label . '</b><br>' . $data . '</pre>';
                 } else {
-                    $data = '<pre>' . $data . '</pre>';
+                    $data = '<pre' . $style . '>' . $data . '</pre>';
                 }
             } else {
                 $data = $label . YD_CRLF . $data;



From pclaerhout at mail.berlios.de  Thu Sep  7 18:38:03 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 18:38:03 +0200
Subject: [ydf-devel] r2100 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage skins/default
	skins/default_with_lightbox
Message-ID: <200609071638.k87Gc3UG013688@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 18:37:55 +0200 (Thu, 07 Sep 2006)
New Revision: 2100

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/manage/manage.css
   YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/lightbox.css
Log:
Added support for titles and descriptions in item images.

See also: [ Feature Request #2217 ] Image label

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-07 16:37:55 UTC (rev 2100)
@@ -125,6 +125,9 @@
             // Upgrade the schema if needed
             $this->upgradeSchemaIfNeeded();
 
+            // The array that will hold the image metadata
+            $this->imagemetadata = null;
+
         }
 
         // Get the schema version
@@ -162,7 +165,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 5;
+            $current_schema = 6;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -205,9 +208,25 @@
                 $this->db->executeSql( 'UPDATE #_schemaversion SET installed = unix_timestamp() WHERE installed = 0' );
 
                 // Drop the statistics tables
-                $this->db->executeSql( 'DROP TABLE #_statistics' );
-                $this->db->executeSql( 'DROP TABLE #_statistics_init' );
+                $this->db->executeSql( 'DROP TABLE IF EXISTS #_statistics' );
+                $this->db->executeSql( 'DROP TABLE IF EXISTS #_statistics_init' );
 
+                // Create the image_metadata table
+                if ( ! $this->dbmeta->tableExists( '#_imagemetadata' ) ) {
+                    $this->db->executeSql(
+                          'CREATE TABLE #_imagemetadata ('
+                        . '  id int(11) NOT NULL auto_increment,'
+                        . '  img_path varchar(255) NOT NULL default \'\','
+                        . '  title varchar(255) default NULL,'
+                        . '  description longtext,'
+                        . '  created int(11) default NULL,'
+                        . '  modified int(11) default NULL,'
+                        . '  PRIMARY KEY  (id),'
+                        . '  UNIQUE KEY img_path (img_path)'
+                        . ')'
+                    );
+                }
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 
@@ -284,12 +303,10 @@
                     $image->relative_path = str_replace( $dir_uploads->getAbsolutePath(), '', $image->getAbsolutePath() );
 
                     // Update the backslashes
-                    $image->relative_path = str_replace( '\\', '/', $image->relative_path );
+                    $image->relative_path = ltrim( str_replace( '\\', '/', $image->relative_path ), '/' );
 
-                    // Remove the leading slash
-                    if ( substr( $image->relative_path, 0, 1 ) == '/' ) {
-                        $image->relative_path = substr( $image->relative_path, 1 );
-                    }
+                    // Merge the title and description if any
+                    $image = $this->getItemImageMetaData( $image );
 
                     // Make links to the thumbnails
                     $image->relative_path_s = dirname( $image->relative_path ) . '/s_' . basename( $image->relative_path );
@@ -337,6 +354,44 @@
             return $items;
         }
 
+        // Get the title and description for an item image
+        function getItemImageMetaData( $image ) {
+
+            // Get the image metadata if not there yet
+            if ( is_null( $this->imagemetadata ) ) {
+                $this->imagemetadata = $this->db->getRecords( 'SELECT * FROM #_imagemetadata' );
+                $this->imagemetadata = YDArrayUtil::convertToNested( $this->imagemetadata, 'img_path' );
+                foreach ( $this->imagemetadata as $key=>$val ) {
+                    $this->imagemetadata[$key] = $val[0];
+                }
+            }
+
+            // Start with the default settings
+            $image->title = $image->getBasenameNoExt();
+            $image->description = '';
+
+            // Add the image data if any
+            if ( isset( $this->imagemetadata[ $image->relative_path ] ) ) {
+                $image->title = $this->imagemetadata[ $image->relative_path ]['title'];
+                $image->description = $this->imagemetadata[ $image->relative_path ]['description'];
+            }
+
+            // Return the image metadata
+            return $image;
+
+        }
+
+        // Update the image data for an item in the database
+        function setItemImageMetaData( $item, $data ) {
+            $values = $data;
+            $values['img_path'] = $item;
+            $result = $this->_executeUpdate( '#_imagemetadata', $values, 'img_path = ' . $this->str( $item ) );
+            if ( $result == '0' ) {
+                $result = $this->_executeInsert( '#_imagemetadata', $values );
+            }
+            return $result;
+        }
+
         // Function to get a single item
         function getItem( $where ) {
             $result = $this->getItems( 1, 0, 'created desc, title', $where );

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-07 16:37:55 UTC (rev 2100)
@@ -327,6 +327,7 @@
 $GLOBALS['t']['image'] = 'image';
 $GLOBALS['t']['images'] = 'images';
 $GLOBALS['t']['item'] = 'Item';
+$GLOBALS['t']['edit_meta'] = 'metadata';
 
 // manage/index.tpl
 $GLOBALS['t']['latest_items'] = 'Latest items';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 16:37:55 UTC (rev 2100)
@@ -327,6 +327,7 @@
 $GLOBALS['t']['image'] = 'foto';
 $GLOBALS['t']['images'] = 'foto\'s';
 $GLOBALS['t']['item'] = 'Item';
+$GLOBALS['t']['edit_meta'] = 'metadata';
 
 // manage/index.tpl
 $GLOBALS['t']['latest_items'] = 'Laatste items';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -36,6 +36,15 @@
             obj.bgColor = '#FFFFFF';
         {literal}}{/literal}
 
+        {literal}function YDShowHideElement( obj ) {
+            obj = document.getElementById( obj );
+            if ( obj.style.display == 'none' ) {
+                obj.style.display = '';
+            } else {
+                obj.style.display = 'none';
+            }
+        }{/literal}
+
         {literal}tinyMCE.init({
             mode : "textareas",
             editor_deselector : "tfMNoMCE",

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-07 16:37:55 UTC (rev 2100)
@@ -19,7 +19,7 @@
             $id = $this->getIdFromQS();
 
             // Get the weblog details and go to the default view if none is matched
-            $this->item  = @ $this->weblog->getItemById( $id );
+            $this->item = @ $this->weblog->getItemById( $id );
             if ( ! $this->item ) {
                 $this->redirect( 'items.php' );
             }
@@ -161,6 +161,19 @@
 
         }
 
+        // Action to edit the metadata
+        function actionEditMetaData() {
+
+            // Update the image metadata for the submitted items
+            foreach ( $_POST['metadata'] as $item => $data ) {
+                YDDebugUtil::dump( $this->weblog->setItemImageMetaData( $item, $data ) );
+            }
+
+            // Redirect to the list view
+            $this->redirect( YD_SELF_SCRIPT . '?id=' . $this->item['id'] );
+
+        }
+
         // Function to get the itemtype details from the database
         function getImage() {
             foreach ( $this->item['images'] as $image ) {

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -49,37 +49,43 @@
         {/if}
     {/capture}
 
-    {$form.tag}
-        {$form.action.html}
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+    <tr>
+        <th class="adminRowLG" colspan="7">
+            &raquo; <a href="items.php?do=edit&id={$item.id}" style="font-weight: bold">{t w="change_item_desc"}</a>
+            ({$item.title})
+            &nbsp;
+            <a href="../item.php?id={$item.id}" target="_blank"><img src="images/more_details.gif" border="0" /></a>
+        </th>
+    </tr>
 
-        <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; <a href="items.php?do=edit&id={$item.id}" style="font-weight: bold">{t w="change_item_desc"}</a>
-                ({$item.title})
-                &nbsp;
-                <a href="../item.php?id={$item.id}" target="_blank"><img src="images/more_details.gif" border="0" /></a>
-            </th>
-        </tr>
+    <tr><td colspan="7">&nbsp;</td></tr>
+    <tr>
+        <th class="adminRowLG" colspan="7">
+            &raquo; <a href="comments.php?id={$item.id}" style="font-weight: bold">{t w="a_comments"}</a>
+            ({$item|@text_num_comments:true})
+        </th>
+    </tr>
 
-        <tr><td colspan="7">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; <a href="comments.php?id={$item.id}" style="font-weight: bold">{t w="a_comments"}</a>
-                ({$item|@text_num_comments:true})
-            </th>
-        </tr>
+    <tr><td colspan="7">&nbsp;</td></tr>
+    <tr>
+        <th class="adminRowLG" colspan="7">
+            &raquo; {t w="gallery"}
+        </th>
+    </tr>
+    </table>
 
-        <tr><td colspan="7">&nbsp;</td></tr>
+    {*<table width="700" cellspacing="0" cellpadding="0" border="0">
+    {$form.tag}
         <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; {t w="gallery"}
-            </th>
-        </tr>
-        <tr>
             <td class="adminRowL" colspan="5">{$form.image.html}</td>
             <td class="adminRowR" colspan="2">{$form._cmdSubmit.html}</td>
         </tr>
+    {$form.endtag}
+    </table>*}
+
+    <form name="metaDataForm" id="metaDataForm" action="{$YD_SELF_SCRIPT}?do=editMetaData&id={$item.id}" method="POST">
+        <table width="700" cellspacing="0" cellpadding="0" border="0">
         {if $images->set}
             <tr>
                 <th class="adminRowL" width="20%">{t w="date"}</th>
@@ -106,8 +112,20 @@
                     <td class="adminRowR" valign="top">
                         <a href="{$YD_SELF_SCRIPT}?do=delete&id={$item.id}&img={$image->relative_path}"
                          onClick="return YDConfirmDelete( '{$image->getBaseName()|addslashes}' );">{t w="delete"}</a>
+                        <br/>
+                        <a href="#" onClick="YDShowHideElement( 'meta_{$image->getBaseName()|@addslashes}' );return false;">{t w="edit_meta"}</a>
                     </td>
                 </tr>
+                <tr id="meta_{$image->getBaseName()}" style="display: none;">
+                    <td class="adminRowL" colspan="5">
+                        <input class="tfM" type="text" name="metadata[{$image->relative_path}][title]" value="{$image->title}"/>
+                        <br/>
+                        <textarea class="tfMNoMCE" name="metadata[{$image->relative_path}][description]">{$image->description}</textarea>
+                    </td>
+                    <td class="adminRowR" colspan="2">
+                        <input type="submit" class="button" value="{t w="save"}" />
+                    </td>
+                </tr>
             {/foreach}
             {$browsebar}
             <tr>
@@ -121,9 +139,8 @@
             </tr>
         {/if}
         </table>
+    </form>
 
-    {$form.endtag}
-
 {/if}
 
 {include file="__mng_footer.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/manage/manage.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-07 16:37:55 UTC (rev 2100)
@@ -169,6 +169,20 @@
     text-align: left;
 }
 
+td.adminRowCNB, th.adminRowCNB {
+    border-bottom: 0px solid #DDDDDD;
+    padding-top: 4px;
+    padding-bottom: 4px;
+    text-align: center;
+}
+
+td.adminRowRNB, th.adminRowRNB {
+    border-bottom: 0px solid #DDDDDD;
+    padding-top: 4px;
+    padding-bottom: 4px;
+    text-align: right;
+}
+
 td.adminRowC, th.adminRowC {
     border-bottom: 1px solid #DDDDDD;
     padding-top: 4px;
@@ -251,3 +265,7 @@
 
 input[type=checkbox], input[type=radio] { border:none; }
 input[type=submit], input[type=button] { background:white url(images/nav-bg.gif) bottom repeat-x; }
+
+form {
+	margin: 0px;
+}
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/archive_gallery.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -17,7 +17,7 @@
                         {foreach from=$image_row item="image"}
                             <td width="12%" align="center" valign="middle" height="60">
                                 {if $image}
-                                    <a href="item_gallery.php?id={$image->relative_path}"><img src="{$image|link_thumb_small}" alt="{$image->getBaseName()}" width="{$image->relative_path_s_obj->getWidth()}" height="{$image->relative_path_s_obj->getHeight()}"></a>
+                                    <a href="item_gallery.php?id={$image->relative_path}"><img src="{$image|link_thumb_small}" alt="{$image->title}" width="{$image->relative_path_s_obj->getWidth()}" height="{$image->relative_path_s_obj->getHeight()}"></a>
                                 {else}
                                     &nbsp;
                                 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -53,7 +53,7 @@
                 {foreach from=$image_row item="image"}
                     <td width="33%" align="center" style="vertical-align: middle;" height="100">
                         {if $image}
-                            <a href="{$image->relative_path|@link_item_gallery}"><img src="{$image|link_thumb}" alt="{$image->getBaseName()}"
+                            <a href="{$image->relative_path|@link_item_gallery}"><img src="{$image|link_thumb}" alt="{$image->title}"
                              width="{$image->relative_path_m_obj->getWidth()}" height="{$image->relative_path_m_obj->getHeight()}"></a>
                         {else}
                             &nbsp;
@@ -65,7 +65,7 @@
                 {foreach from=$image_row item="image"}
                     <td width="33%" align="center">
                         {if $image}
-                            <p><a href="{$image->relative_path|@link_item_gallery}">{$image->getBasenameNoExt()}</a><br/>&nbsp;</p>
+                            <p><a href="{$image->relative_path|@link_item_gallery}">{$image->title}</a><br/>&nbsp;</p>
                         {else}
                             &nbsp;
                         {/if}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default/item_gallery.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -25,7 +25,7 @@
 
     <div class="post">
 
-        <h2 id="post-{$item.id}"><a href="{$item|@link_item}">{$item.title}</a> &raquo; {$image->getBasenameNoExt()}</h2>
+        <h2 id="post-{$item.id}"><a href="{$item|@link_item}">{$item.title}</a> &raquo; {$image->title}</h2>
 
         <div class="entrytext">
 
@@ -33,15 +33,19 @@
             {if $image->getWidth() > $max_img_size}
                 <iframe src="{$uploads_dir}/{$image->relative_path}" width="{$max_img_size}" height="{$image->getHeight()+20}" marginwidth="0" marginheight="0"></iframe>
             {else}
-                <img src="{$uploads_dir}/{$image->relative_path}" width="{$image->getWidth()}" height="{$image->getHeight()}">
+                <img src="{$uploads_dir}/{$image->relative_path}" width="{$image->getWidth()}" height="{$image->getHeight()}" />
             {/if}
             </p>
 
+            {if $image->description}
+                {$image->description|@bbcode}
+            {/if}
+
             {$browsebar}
 
             <p class="postmetadata alt">
                 <small>
-                    {t w="image"}: {$image->getBaseName()}
+                    {t w="image"}: {$image->title}
                     ({t w="image"} {$image->num} {t w="of"} {$image->total_images})
                     <br/>
                     {t w="item"}: <a href="{$item|@link_item}">{$item.title}</a>

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/archive_gallery.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -18,8 +18,8 @@
                             <td width="12%" align="center" valign="middle" height="60">
                                 {if $image}
                                     <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                                    title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
-                                    ><img src="{$image|link_thumb_small}" alt="{$image->getBaseName()}" width="{$image->relative_path_s_obj->getWidth()}" height="{$image->relative_path_s_obj->getHeight()}"></a>
+                                    title="{$item.title} &raquo; {$image->title}{if $image->description}<p class='img_description'>{$image->description|@bbcode}</p>{/if}"
+                                    ><img src="{$image|link_thumb_small}" alt="{$image->title}" width="{$image->relative_path_s_obj->getWidth()}" height="{$image->relative_path_s_obj->getHeight()}"></a>
                                 {else}
                                     &nbsp;
                                 {/if}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-07 16:37:55 UTC (rev 2100)
@@ -54,8 +54,8 @@
                     <td width="33%" align="center" style="vertical-align: middle;" height="100">
                         {if $image}
                             <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
-                             ><img src="{$image|link_thumb}" alt="{$image->getBaseName()}"
+                             title="{$item.title} &raquo; {$image->title}{if $image->description}<p class='img_description'>{$image->description|@bbcode}</p>{/if}"
+                             ><img src="{$image|link_thumb}" alt="{$image->title}"
                              width="{$image->relative_path_m_obj->getWidth()}" height="{$image->relative_path_m_obj->getHeight()}"></a>
                         {else}
                             &nbsp;
@@ -68,8 +68,8 @@
                     <td width="33%" align="center">
                         {if $image}
                             <p><a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->getBasenameNoExt()}"
-                             >{$image->getBasenameNoExt()}</a><br/>&nbsp;</p>
+                             title="{$item.title} &raquo; {$image->title}{if $image->description}<p class='img_description'>{$image->description|@bbcode}</p>{/if}"
+                             >{$image->title}</a><br/>&nbsp;</p>
                         {else}
                             &nbsp;
                         {/if}

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/lightbox.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/lightbox.css	2006-09-07 15:16:33 UTC (rev 2099)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/lightbox.css	2006-09-07 16:37:55 UTC (rev 2100)
@@ -99,4 +99,11 @@
 * html .clearfix {
 	height: 1%;
 	}	
-	
\ No newline at end of file
+	
+p.img_description {
+	font-style: italic;
+	font-weight: normal;
+	margin: 8px;
+	padding: 0px;
+	margin-left: 24px;
+}
\ No newline at end of file



From david_db at mail.berlios.de  Thu Sep  7 19:28:24 2006
From: david_db at mail.berlios.de (david_db at mail.berlios.de)
Date: Thu, 7 Sep 2006 19:28:24 +0200
Subject: [ydf-devel] r2101 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609071728.k87HSO9M032052@sheep.berlios.de>

Author: david_db
Date: 2006-09-07 19:28:19 +0200 (Thu, 07 Sep 2006)
New Revision: 2101

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Fixed YDForm::getValue regarding the __ALL__ filter.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-07 16:37:55 UTC (rev 2100)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-07 17:28:19 UTC (rev 2101)
@@ -615,7 +615,6 @@
             // Filters should only be applied if the form is submitted and if the element type supports it.
             if ( $this->isSubmitted() ) {
                 if ( $applyFilters == true ) {
-                    $value = $this->_applyFilter( '__ALL__', $value );
                     $value = $this->_applyFilter( $name, $value );
                 }
             } else {



From pclaerhout at mail.berlios.de  Thu Sep  7 20:33:00 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 20:33:00 +0200
Subject: [ydf-devel] r2102 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200609071833.k87IX0MK012344@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 20:33:00 +0200 (Thu, 07 Sep 2006)
New Revision: 2102

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Updated the language files.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 17:28:19 UTC (rev 2101)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-07 18:33:00 UTC (rev 2102)
@@ -327,7 +327,7 @@
 $GLOBALS['t']['image'] = 'foto';
 $GLOBALS['t']['images'] = 'foto\'s';
 $GLOBALS['t']['item'] = 'Item';
-$GLOBALS['t']['edit_meta'] = 'metadata';
+$GLOBALS['t']['edit_meta'] = 'informatie';
 
 // manage/index.tpl
 $GLOBALS['t']['latest_items'] = 'Laatste items';



From pclaerhout at mail.berlios.de  Thu Sep  7 20:41:49 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 7 Sep 2006 20:41:49 +0200
Subject: [ydf-devel] r2103 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609071841.k87IfnAf013471@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-07 20:41:48 +0200 (Thu, 07 Sep 2006)
New Revision: 2103

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
Log:
Removed some unneeded debug info.

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-07 18:33:00 UTC (rev 2102)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-07 18:41:48 UTC (rev 2103)
@@ -166,7 +166,7 @@
 
             // Update the image metadata for the submitted items
             foreach ( $_POST['metadata'] as $item => $data ) {
-                YDDebugUtil::dump( $this->weblog->setItemImageMetaData( $item, $data ) );
+                $this->weblog->setItemImageMetaData( $item, $data );
             }
 
             // Redirect to the list view



From pclaerhout at mail.berlios.de  Fri Sep  8 10:59:05 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 10:59:05 +0200
Subject: [ydf-devel] r2104 -
	YDFramework2.0/trunk/YDFramework2/addons/YDAkismet
Message-ID: <200609080859.k888x5LE017626@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 10:59:05 +0200 (Fri, 08 Sep 2006)
New Revision: 2104

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
Log:
YDAkismet now by default doesn't show debugging messages.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-09-07 18:41:48 UTC (rev 2103)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-09-08 08:59:05 UTC (rev 2104)
@@ -121,6 +121,7 @@
          */
         function doRequest( $host, $url, $data ) {
             $client = new YDHttpClient( $host, 80 );
+            $client->setDebug( false );
             $client->user_agent = YD_FW_NAME . '/' . YD_FW_VERSION . ' | ' . $this->getClassName() . '/' . $this->_version;
             $result = @ $client->post( $url, $data );
             if ( $result == false ) {



From pclaerhout at mail.berlios.de  Fri Sep  8 11:00:30 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 11:00:30 +0200
Subject: [ydf-devel] r2105 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200609080900.k8890U1N017967@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 11:00:28 +0200 (Fri, 08 Sep 2006)
New Revision: 2105

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Comments with more than 3 links in there are now automatically marked as spam.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 08:59:05 UTC (rev 2104)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 09:00:28 UTC (rev 2105)
@@ -490,7 +490,7 @@
             }
             $records = $this->db->getRecords( $this->_prepareQuery( $query, $order ), $limit, $offset );
             foreach ( $records as $key=>$record ) {
-                $records[$key]['comment'] = trim( strip_tags( $record['comment'] ) );
+                $records[$key]['comment'] = trim( $record['comment'] );
             }
             return $records;
         }
@@ -499,7 +499,7 @@
         function getCommentById( $comment_id ) {
             $sql = $this->_prepareQuery( 'SELECT c.id as id, c.item_id as item_id, c.username as username, c.useremail as useremail, c.userwebsite as userwebsite, c.userip as userip, c.useragent as useragent, c.userrequrl as userrequrl, c.comment as comment, c.is_spam as is_spam, c.created as created, c.modified as modified, i.title as item_title FROM #_comments c, #_items i WHERE c.item_id = i.id and c.id = ' . $this->str( $comment_id ) );
             $record  = $this->db->getRecord( $sql );
-            $record['comment'] = trim( strip_tags( $record['comment'] ) );
+            $record['comment'] = trim( $record['comment'] );
             return $record;
         }
 
@@ -538,6 +538,12 @@
 
             }
 
+            // Check the amount of hyperlinks in the comments. More than 3 is marked as spam.
+            $count = preg_match_all( "/http:\/\//i", $values['comment'], $matches );
+            if ( $count > 3 ) {
+                $values['is_spam'] = 1;
+            }
+
             // Add the comment
             $result = $this->_executeInsert( '#_comments', $values );
 



From pclaerhout at mail.berlios.de  Fri Sep  8 11:21:04 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 11:21:04 +0200
Subject: [ydf-devel] r2106 - in YDFramework2.0/trunk/examples/weblog: .
	include
Message-ID: <200609080921.k889L4Aj019650@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 11:21:03 +0200 (Fri, 08 Sep 2006)
New Revision: 2106

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Improved the comment spam protection even more by refining the way the links are counted in the actual comment.

Another improvement that was made is that the comment emails for spam messages no longer get send to all subscribers, but only to the site authors. The email message of a spam comment is now also marked as spam with the word '[spam]' in the subject.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 09:00:28 UTC (rev 2105)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 09:21:03 UTC (rev 2106)
@@ -510,6 +510,7 @@
             $values['userip'] = $_SERVER['REMOTE_ADDR'];
             $values['useragent'] = $_SERVER['HTTP_USER_AGENT'];
             $values['userrequrl'] = $_SERVER['REQUEST_URI'];
+            $values['is_spam'] = 0;
 
             // Check against akismet if a key is there
             if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
@@ -539,23 +540,27 @@
             }
 
             // Check the amount of hyperlinks in the comments. More than 3 is marked as spam.
-            $count = preg_match_all( "/http:\/\//i", $values['comment'], $matches );
-            if ( $count > 3 ) {
+            $count1 = preg_match_all( "/href=/i", $values['comment'], $matches1 );
+            $count2 = preg_match_all( "/\[url=/i", $values['comment'], $matches2 );
+            if ( ( $count1 + $count2 ) > 3 ) {
                 $values['is_spam'] = 1;
             }
 
             // Add the comment
             $result = $this->_executeInsert( '#_comments', $values );
+            $comment_id = $this->db->getLastInsertID();
 
             // Only update the items table if not spam
             if ( ! $values['is_spam'] ) {
-                $comment_id = $this->db->getLastInsertID();
                 $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $values['item_id'] );
                 $this->db->executeSql( $sql );
             }
 
+            // Update the comment
+            $values['id'] = $comment_id;
+
             // Return the comment id
-            return $comment_id;
+            return $values;
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-09-08 09:00:28 UTC (rev 2105)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-09-08 09:21:03 UTC (rev 2106)
@@ -101,10 +101,10 @@
                 setcookie( 'YD_USER_WEBSITE', $values['userwebsite'], time() + 31536000, '/' );
 
                 // Add the values to the database
-                $comment_id = $this->weblog->addComment( $values );
+                $comment = $this->weblog->addComment( $values );
 
                 // Send an email if configured
-                if ( $comment_id > 0 && YDConfig::get( 'email_new_comment', true ) ) {
+                if ( $comment['id'] > 0 && YDConfig::get( 'email_new_comment', true ) ) {
 
                     // Include the YDEmail library
                     YDInclude( 'YDEmail.php' );
@@ -127,13 +127,27 @@
                     }
                     $eml->setReplyTo( 'no at reply.net' );
                     $eml->addBcc( $item['user_email'] );
-                    foreach ( $subscribers as $subscriber ) {
-                        $eml->addBcc( $subscriber );
+
+                    // Spam emails do not go to the subscribers
+                    if ( $comment['is_spam'] == '0' ) {
+                        foreach ( $subscribers as $subscriber ) {
+                            $eml->addBcc( $subscriber );
+                        }
                     }
+
+                    // Email the item owners
                     foreach ( $users as $user ) {
                         $eml->addBcc( $user['email'], $user['name'] );
                     }
-                    $eml->setSubject( t('new_comment') . ': ' . strip_tags( $item['title'] ) );
+
+                    // Set the subject
+                    if ( $comment['is_spam'] == 0 ) {
+                        $eml->setSubject( t('new_comment') . ': ' . strip_tags( $item['title'] ) );
+                    } else {
+                        $eml->setSubject( '[spam] ' . t('new_comment') . ': ' . strip_tags( $item['title'] ) );
+                    }
+
+                    // Send the email
                     $eml->setHtmlBody( $this->fetch( 'comment_email' ) );
                     $eml->send();
 
@@ -143,7 +157,7 @@
                 $this->clearCache();
 
                 // Redirect to the item
-                $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment_id ) );
+                $this->redirect( YDTplModLinkItem( $item, '#comment-' . $comment['id'] ) );
 
             }
 



From pclaerhout at mail.berlios.de  Fri Sep  8 11:29:12 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 11:29:12 +0200
Subject: [ydf-devel] r2107 - in YDFramework2.0/trunk/examples/weblog:
	include skins/default_with_lightbox
Message-ID: <200609080929.k889TCMj020392@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 11:29:12 +0200 (Fri, 08 Sep 2006)
New Revision: 2107

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
The image description is now properly encoded in the lightbox template.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 09:21:03 UTC (rev 2106)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 09:29:12 UTC (rev 2107)
@@ -308,6 +308,14 @@
                     // Merge the title and description if any
                     $image = $this->getItemImageMetaData( $image );
 
+                    // Create the full title, including item title, image title and description if any
+                    $image->full_description = $item['title'] . ' &raquo; ' . $image->title;
+                    if ( $image->description ) {
+                        $image->full_description .= '<p class="img_description">'
+                                                 . YDTemplate_modifier_bbcode( $image->description ) . '</p>';
+                    }
+                    $image->full_description_html = htmlspecialchars( $image->full_description, ENT_QUOTES );
+
                     // Make links to the thumbnails
                     $image->relative_path_s = dirname( $image->relative_path ) . '/s_' . basename( $image->relative_path );
                     $image->relative_path_m = dirname( $image->relative_path ) . '/m_' . basename( $image->relative_path );

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-08 09:21:03 UTC (rev 2106)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-08 09:29:12 UTC (rev 2107)
@@ -54,7 +54,7 @@
                     <td width="33%" align="center" style="vertical-align: middle;" height="100">
                         {if $image}
                             <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->title}{if $image->description}<p class='img_description'>{$image->description|@bbcode}</p>{/if}"
+                             title="{$image->full_description_html}"
                              ><img src="{$image|link_thumb}" alt="{$image->title}"
                              width="{$image->relative_path_m_obj->getWidth()}" height="{$image->relative_path_m_obj->getHeight()}"></a>
                         {else}
@@ -68,7 +68,7 @@
                     <td width="33%" align="center">
                         {if $image}
                             <p><a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$item.title} &raquo; {$image->title}{if $image->description}<p class='img_description'>{$image->description|@bbcode}</p>{/if}"
+                             title="{$image->full_description_html}"
                              >{$image->title}</a><br/>&nbsp;</p>
                         {else}
                             &nbsp;



From pclaerhout at mail.berlios.de  Fri Sep  8 11:34:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 11:34:37 +0200
Subject: [ydf-devel] r2108 -
	YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox
Message-ID: <200609080934.k889Ybod021311@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 11:34:36 +0200 (Fri, 08 Sep 2006)
New Revision: 2108

Modified:
   YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
Log:
Fixed the lightbox template so that it now show the correct image count.

Modified: YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-08 09:29:12 UTC (rev 2107)
+++ YDFramework2.0/trunk/examples/weblog/skins/default_with_lightbox/item.tpl	2006-09-08 09:34:36 UTC (rev 2108)
@@ -51,31 +51,21 @@
             {foreach from=$item.images_as_table item="image_row"}
             <tr>
                 {foreach from=$image_row item="image"}
-                    <td width="33%" align="center" style="vertical-align: middle;" height="100">
+                    <td width="33%" align="center" style="vertical-align: middle;">
                         {if $image}
-                            <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$image->full_description_html}"
-                             ><img src="{$image|link_thumb}" alt="{$image->title}"
+                            <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]" 
+                             title="{$image->full_description_html}"><img src="{$image|link_thumb}" alt="{$image->title}"
                              width="{$image->relative_path_m_obj->getWidth()}" height="{$image->relative_path_m_obj->getHeight()}"></a>
+                            <br/>
+                            <a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
+                             title="{$image->full_description_html}">{$image->title}</a>
+                             <br/>&nbsp;
                         {else}
                             &nbsp;
                         {/if}
                     </td>
                 {/foreach}
             </tr>
-            <tr>
-                {foreach from=$image_row item="image"}
-                    <td width="33%" align="center">
-                        {if $image}
-                            <p><a href="{$uploads_dir}/{$image->relative_path}" rel="lightbox[{$item.id}]"
-                             title="{$image->full_description_html}"
-                             >{$image->title}</a><br/>&nbsp;</p>
-                        {else}
-                            &nbsp;
-                        {/if}
-                     </td>
-                {/foreach}
-            </tr>
             {/foreach}
             </table></p>
         {/if}



From pclaerhout at mail.berlios.de  Fri Sep  8 11:42:07 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 11:42:07 +0200
Subject: [ydf-devel] r2109 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	YDFramework2/addons/YDFeedCreator doc
Message-ID: <200609080942.k889g7sM022361@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 11:42:06 +0200 (Fri, 08 Sep 2006)
New Revision: 2109

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
   YDFramework2.0/trunk/doc/docs_api.dxy
Log:
Fixed some API documentation issues.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-08 09:34:36 UTC (rev 2108)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-08 09:42:06 UTC (rev 2109)
@@ -443,7 +443,7 @@
         /**
          *  Sets fields names
          *
-         *  @param $field          Field name of sort
+         *  @param $fields          Field name of sort
          */
         function setFields( $fields ) {
             return $this->gr_fields = $fields;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-08 09:34:36 UTC (rev 2108)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-08 09:42:06 UTC (rev 2109)
@@ -170,10 +170,10 @@
          *  @returns 	Returns an array containing results returned from action and callback processing.
          *				Elements of this array are keyed by strings:
          *					action:before
-         *					<actionname>:before
-         *					<actionname>
-         *					<actionname>:after
-         *					action:after		 
+         *					&lt;actionname&gt;:before
+         *					&lt;actionname&gt;
+         *					&lt;actionname&gt;:after
+         *					action:after
          */
         function forward( $action ) {
             if ( strpos( $action, 'action' ) === 0 ) {
@@ -244,9 +244,9 @@
          *  @returns 	Returns an array containing results returned from action and callback processing.
          *				Elements of this array are keyed by strings:
          *					action:before
-         *					<actionname>:before
-         *					<actionname>
-         *					<actionname>:after
+         *					&lt;actionname&gt;:before
+         *					&lt;actionname&gt;
+         *					&lt;actionname&gt;:after
          *					action:after
          *
          *  @internal

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-09-08 09:34:36 UTC (rev 2108)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-09-08 09:42:06 UTC (rev 2109)
@@ -123,6 +123,7 @@
          *  @param $enclosure       (optional) The url of the enclosure.
          *  @param $enclosure_size  (optional) The size in bytes of the enclosure.
          *  @param $enclosure_type  (optional) The mime-type of the enclosure.
+         *  @param $commentlink     (optional) The link to the comment page for the item.
          *
          *  @remark
          *      Enclosures are only supported for ATOM and RSS 2.0 feeds.

Modified: YDFramework2.0/trunk/doc/docs_api.dxy
===================================================================
--- YDFramework2.0/trunk/doc/docs_api.dxy	2006-09-08 09:34:36 UTC (rev 2108)
+++ YDFramework2.0/trunk/doc/docs_api.dxy	2006-09-08 09:42:06 UTC (rev 2109)
@@ -59,7 +59,6 @@
 #---------------------------------------------------------------------------
 INPUT                  = "../YDFramework2/YDClasses" \
                          "../YDFramework2/YDF2_init.php" \
-                         "../YDFramework2/YDF2_core.php" \
                          "../YDFramework2/YDF2_process.php"  \
                          "../YDFramework2/addons"
 FILE_PATTERNS          = *.php



From muitocomplicado at gmail.com  Fri Sep  8 16:22:44 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 8 Sep 2006 11:22:44 -0300
Subject: [ydf-devel] New installation of YDWeblog
Message-ID: <12260be20609080722h730d5143r520d5b5c578937e0@mail.gmail.com>

I tried installing the most recent version of YDWeblog (dropped database
tables and config.php) but I got an error:

Fatal error: [1054] Unknown column 'auto_close' in 'ydw_items' in
...\YDFramework2\YDClasses\YDDatabase.php on line 1531

-db
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060908/8a703bc4/attachment.html>

From muitocomplicado at gmail.com  Fri Sep  8 16:35:17 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Fri, 8 Sep 2006 11:35:17 -0300
Subject: [ydf-devel] New installation of YDWeblog
In-Reply-To: <12260be20609080722h730d5143r520d5b5c578937e0@mail.gmail.com>
References: <12260be20609080722h730d5143r520d5b5c578937e0@mail.gmail.com>
Message-ID: <12260be20609080735r7f981a5fj36ecfb298dddd4eb@mail.gmail.com>

Found the error in YDWeblogAPI.php line 185.

The "AFTER auto_close" part. I deleted it and everything worked.

I didn't commit the change because maybe Pieter wants to fix it differently.

-db

On 9/8/06, David Bittencourt <muitocomplicado at gmail.com> wrote:
>
> I tried installing the most recent version of YDWeblog (dropped database
> tables and config.php) but I got an error:
>
> Fatal error: [1054] Unknown column 'auto_close' in 'ydw_items' in
> ...\YDFramework2\YDClasses\YDDatabase.php on line 1531
>
> -db
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060908/054683ff/attachment.html>

From pclaerhout at mail.berlios.de  Fri Sep  8 17:49:27 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 17:49:27 +0200
Subject: [ydf-devel] r2110 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609081549.k88FnRKl008329@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 17:49:26 +0200 (Fri, 08 Sep 2006)
New Revision: 2110

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
Log:
Re-enabled the image upload form in items_gallery.tpl.

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-08 09:42:06 UTC (rev 2109)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-08 15:49:26 UTC (rev 2110)
@@ -75,14 +75,14 @@
     </tr>
     </table>
 
-    {*<table width="700" cellspacing="0" cellpadding="0" border="0">
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
     {$form.tag}
         <tr>
             <td class="adminRowL" colspan="5">{$form.image.html}</td>
             <td class="adminRowR" colspan="2">{$form._cmdSubmit.html}</td>
         </tr>
     {$form.endtag}
-    </table>*}
+    </table>
 
     <form name="metaDataForm" id="metaDataForm" action="{$YD_SELF_SCRIPT}?do=editMetaData&id={$item.id}" method="POST">
         <table width="700" cellspacing="0" cellpadding="0" border="0">



From pclaerhout at mail.berlios.de  Fri Sep  8 17:58:52 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 17:58:52 +0200
Subject: [ydf-devel] r2111 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery
Message-ID: <200609081558.k88Fwq6K009557@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 17:58:52 +0200 (Fri, 08 Sep 2006)
New Revision: 2111

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
Log:
Fixed the docstrings in YDDatabaseQuery.

See also: [ Bug #8698 ] Fix docstrings for doxygen for YDDatabaseQuery

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-09-08 15:49:26 UTC (rev 2110)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-09-08 15:58:52 UTC (rev 2111)
@@ -524,6 +524,7 @@
          *  This function builds the tables references expression and returns it.
          *
          *  @param $title       (optional) If true, returns the FROM string. Default: true.
+         *  @param $single      (optional) Returns a single table only. Default is false.
          *
          *  @returns  The tables references expression.
          */



From pclaerhout at mail.berlios.de  Fri Sep  8 18:03:13 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 18:03:13 +0200
Subject: [ydf-devel] r2112 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormElements
Message-ID: <200609081603.k88G3D26010393@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 18:03:11 +0200 (Fri, 08 Sep 2006)
New Revision: 2112

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Fixed the docstrings in YDFramework-Core.

See also: [ Bug #8697 ] Fix docstrings for doxygen for YDFramework-Core

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2006-09-08 15:58:52 UTC (rev 2111)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2006-09-08 16:03:11 UTC (rev 2112)
@@ -137,7 +137,7 @@
         /**
          *	This function adds a new menu item
          *
-         *	@param $menu		The name of the menu
+         *	@param $name		The name of the menu
          */
 		function addMenu( $name ){
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-08 15:58:52 UTC (rev 2111)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-08 16:03:11 UTC (rev 2112)
@@ -276,9 +276,9 @@
          *  @returns 	Returns an array containing results returned from action and callback processing.
          *				Elements of this array are keyed by strings:
          *					action:before
-         *					<actionname>:before
-         *					<actionname>
-         *					<actionname>:after
+         *					&lt;actionname&gt;:before
+         *					&lt;actionname&gt;
+         *					&lt;actionname&gt;:after
          *					action:after
          */
         function process() {



From pclaerhout at mail.berlios.de  Fri Sep  8 18:14:15 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 18:14:15 +0200
Subject: [ydf-devel] r2113 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200609081614.k88GEFjF011667@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 18:14:14 +0200 (Fri, 08 Sep 2006)
New Revision: 2113

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
Log:
Fixed the docstrings in YDCMComponent.

See also: [ Bug #8699 ] Fix docstrings for doxygen for YDCMComponent

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-09-08 16:03:11 UTC (rev 2112)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2006-09-08 16:14:14 UTC (rev 2113)
@@ -115,8 +115,8 @@
         /**
          *  This function renders this element for menu
          *
-         *  @param $id           Component id
-         *  @param $urlObj       Url object
+         *  @param $id        Component id
+         *  @param $url       Url object
          *
          *  @returns    An html string
          */
@@ -299,6 +299,7 @@
          *  This function sets a node state
          *
          *  @param $state      The state code
+         *  @param $id         (optional) The ID of the node. Defaults to null.
          *
          *  @returns    1 if state changed, 0 otherwise
          */
@@ -330,7 +331,8 @@
         /**
          *  This function adds a standard node in the tree. Experimental
          *
-         *  @param $values  Node values
+         *  @param $values      Node values
+         *  @param $parent_id   (optional) The parent id for the node. Defaults to null.
          */
 		function addNode( $values, $parent_id = null ){
 
@@ -345,7 +347,8 @@
         /**
          *  This function updates a node
          *
-         *  @param $values  Node values
+         *  @param $values      Node values
+         *  @param $node_id     (optional) The ID of the node. Defaults to null.
          */
 		function updateNode( $values, $node_id = null ){
 
@@ -360,7 +363,8 @@
         /**
          *  This function moves a node
          *
-         *  @param $values  Node values
+         *  @param $x  X value
+         *  @param $y  Y value
          */
 		function moveNode( $x, $y ){
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2006-09-08 16:03:11 UTC (rev 2112)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2006-09-08 16:14:14 UTC (rev 2113)
@@ -143,6 +143,9 @@
         /**
          *  This private static function returns an array/associative array based on states/urgencies
          *
+         *  @param  $translated Indicates if we need translations or not.
+         *  @param  $arr        Array with the states.
+         *
          *  @param $translated  (Optional) boolean that defines if result uses translation strings
          */
 		function getInfo( $translated, $arr ){

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-08 16:03:11 UTC (rev 2112)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-08 16:14:14 UTC (rev 2113)
@@ -213,6 +213,8 @@
          *  This function checks if a userobject if can do some action
          *
          *  @param     $userobject_id     Userobject id
+         *  @param     $class             The class name
+         *  @param     $action            The action name
          *
          *  @returns   Boolean TRUE or FALSE
          */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-08 16:03:11 UTC (rev 2112)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-08 16:14:14 UTC (rev 2113)
@@ -172,7 +172,7 @@
         /**
          *  This method adds form elements for user editing
 		 *
-		 * @param $user_id      User id to edit
+		 * @param $id           User id to edit
 		 * @param $noneditable  (Optional) Array with form element names that are NOT editable (are spans).
          */
 		function addFormEdit( $id, $noneditable = array() ){
@@ -184,7 +184,7 @@
         /**
          *  This method adds form elements for addind a new user
 		 *
-		 * @param $parent_id    Group id of this new user
+		 * @param $id    Group id of this new user
          */
 		function addFormNew( $id ){
 
@@ -197,10 +197,9 @@
 		 *
 		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
          *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
-		 *
+		 * @param $edit         The edit parameter
+         *
 		 * @param $noneditable  Array with form element names that are NOT editable
-		 *
-		 * @param $translate    User details should be translated
          */
 		function _addFormDetails( $id, $edit, $noneditable = array() ){
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-08 16:03:11 UTC (rev 2112)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-08 16:14:14 UTC (rev 2113)
@@ -78,7 +78,8 @@
         /**
          *  This method returns all sub users of a userobject
          *
-         *  @param  $parent_id   Parent id
+         *  @param  $parent_id      Parent id
+         *  @param  $includeNode    (optional) Includes the node or not. Defaults to true.
          *
          *  @returns    Array with user and children nodes
          */



From pclaerhout at mail.berlios.de  Fri Sep  8 18:19:38 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 18:19:38 +0200
Subject: [ydf-devel] r2114 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200609081619.k88GJc3R012346@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 18:19:38 +0200 (Fri, 08 Sep 2006)
New Revision: 2114

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Fixed the install of the weblog application.

More info: [ Bug #8708 ] Install of new instance fails

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 16:14:14 UTC (rev 2113)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 16:19:38 UTC (rev 2114)
@@ -182,7 +182,7 @@
                 // Add any missing items fields
                 $fields = $this->dbmeta->getFields( '#_items' );
                 $this->executeIfMissing( 'body_more', $fields, 'ALTER TABLE #_items ADD body_more LONGTEXT AFTER body' );
-                $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER auto_close' );
+                $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_items ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER num_comments' );
                 $this->executeIfPresent( 'allow_comments', $fields, 'ALTER TABLE #_items DROP allow_comments' );
                 $this->executeIfPresent( 'auto_close', $fields, 'ALTER TABLE #_items DROP auto_close' );
 



From pclaerhout at mail.berlios.de  Fri Sep  8 20:22:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 20:22:23 +0200
Subject: [ydf-devel] r2115 - in YDFramework2.0/trunk/examples/weblog:
	include manage
Message-ID: <200609081822.k88IMNoc027762@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 20:22:19 +0200 (Fri, 08 Sep 2006)
New Revision: 2115

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
   YDFramework2.0/trunk/examples/weblog/manage/images.php
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
   YDFramework2.0/trunk/examples/weblog/manage/manage.css
Log:
Added support for specifying the maximum image size of uploads.

See also: [ Feature Request #2215 ] Image resize if image is big

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 18:22:19 UTC (rev 2115)
@@ -841,6 +841,44 @@
             $this->db->executeSql( $sql );
         }
 
+        // Function to resize an uploaded image. Takes a YDFSImage object as it's argument
+        function resizeUploadedImage( $image ) {
+
+            // Convert the YDFSFile objects to images
+            if ( is_object( $image ) && strtolower( get_class( $image ) ) == 'ydfsfile' ) {
+                $image = new YDFSImage( $image->getAbsolutePath() );
+            }
+
+            // Convert strings to images
+            if ( is_string( $image ) ) {
+                $image = new YDFSImage( $image );
+            }
+
+            // Get the maximum X and Y size
+            $max_x = YDConfig::get( 'max_img_size_x', '' );
+            $max_y = YDConfig::get( 'max_img_size_y', '' );
+            $max_x = empty( $max_x ) ? 999999 : $max_x;
+            $max_y = empty( $max_y ) ? 999999 : $max_y;
+
+            // Do nothing if maximum sizes are specified
+            if ( $max_x == 99999 && $max_y == 999999 ) {
+                return $image;
+            }
+
+            // Resize the image
+            $image->saveThumbnail( $max_x, $max_y, $image->getAbsolutePath() );
+
+            // Debugging help
+            $image->getImageSize();
+            YDDebugUtil::dump( $max_x, 'x' );
+            YDDebugUtil::dump( $max_y, 'y' );
+            YDDebugUtil::dump( $image, 'image' );
+
+            // Return the image
+            return $image;
+
+        }
+
         // Prepare a query
         function _prepareQuery( $sql, $order=null ) {
             return is_null( $order ) ? $sql : $sql . ' ORDER BY ' . $order;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-09-08 18:22:19 UTC (rev 2115)
@@ -82,6 +82,9 @@
             $form->addElement( 'select', 'weblog_language', t( 'cfg_weblog_language' ), array( 'class' => 'tfM', 'style' => 'width: 100%' ), $languages );
             $form->addElement( 'checkbox', 'include_debug_info', t( 'cfg_include_debug_info' ), array( 'style' => 'border: none;' ) );
             $form->addElement( 'text', 'google_analytics', t( 'cfg_weblog_google_analytics' ), array( 'class' => 'tfM' ) );
+            $form->addElement( 'text', 'weblog_title', t( 'cfg_weblog_title' ), array( 'class' => 'tfM' ) );
+            $form->addElement( 'text', 'max_img_size_x', t( 'cfg_max_img_size' ), array( 'class' => 'tfXS' ) );
+            $form->addElement( 'text', 'max_img_size_y', t( 'cfg_max_img_size' ), array( 'class' => 'tfXS' ) );
 
             $form->addElement( 'checkbox', 'email_new_comment', t( 'cfg_notification_email_comment' ),  array( 'style' => 'border: none;' ) );
             $form->addElement( 'checkbox', 'email_new_item', t( 'cfg_notification_email_item' ),  array( 'style' => 'border: none;' ) );
@@ -169,6 +172,8 @@
             $config['dflt_is_draft']        = YDConfig::get( 'dflt_is_draft',        false );
             $config['blocked_ips']          = YDConfig::get( 'blocked_ips',          YDFormatStringWithListValues( '' ) );
             $config['akismet_key']          = YDConfig::get( 'akismet_key',          '' );
+            $config['max_img_size_x']       = YDConfig::get( 'max_img_size_x',       '' );
+            $config['max_img_size_y']       = YDConfig::get( 'max_img_size_y',       '' );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-09-08 18:22:19 UTC (rev 2115)
@@ -80,6 +80,12 @@
             <td class="adminRowL">{t w="cfg_weblog_google_analytics"}</td>
             <td class="adminRowL">{$config.google_analytics|default:'-'}</td>
         </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="cfg_max_img_size"}</td>
+            <td class="adminRowL">
+                {$config.max_img_size_x|default:'-'} x {$config.max_img_size_y|default:'-'} pixels
+            </td>
+        </tr>
     </table>
     <table width="700" cellspacing="0" cellpadding="0" border="0">
         <tr><td colspan="3">&nbsp;</td></tr>
@@ -208,6 +214,12 @@
                 <td class="adminRowL">{$form.google_analytics.label_html}</td>
                 <td class="adminRowL">{$form.google_analytics.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL">{$form.max_img_size_x.label_html}</td>
+                <td class="adminRowL">
+                    {$form.max_img_size_x.html} x {$form.max_img_size_y.html} pixels
+                </td>
+            </tr>
         </table>
         <table width="700" cellspacing="0" cellpadding="0" border="0">
             <tr><td colspan="3">&nbsp;</td></tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/images.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/images.php	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/manage/images.php	2006-09-08 18:22:19 UTC (rev 2115)
@@ -88,6 +88,9 @@
                     $thumb->_createThumbnail( 100, 100, true );
                     $thumb->_createThumbnail(  48,  48, true );
 
+                    // Resize the uploaded image in place
+                    $thumb = $this->weblog->resizeUploadedImage( $thumb );
+
                 }
 
                 // Get the name of the action

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-08 18:22:19 UTC (rev 2115)
@@ -99,10 +99,11 @@
                             // Save it as a filee
                             $entryFile = $dir->createFile( $entry->Name, $entry->Data );
 
-
                             // Delete it if it's not an image
                             if ( ! $entryFile->isImage() ) {
                                 @ unlink( $entryFile->getAbsolutePath() );
+                            } else {
+                                $entryFile = $this->weblog->resizeUploadedImage( $entryFile );
                             }
 
                         }
@@ -112,6 +113,8 @@
                     // Check if it's an image
                     if ( ! $fileObj->isImage() ) {
                         @unlink( $fileObj->getAbsolutePath() );
+                    } else {
+                        $fileObj = $this->weblog->resizeUploadedImage( $fileObj );
                     }
 
                     // Delete the thumbnails

Modified: YDFramework2.0/trunk/examples/weblog/manage/manage.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-08 16:19:38 UTC (rev 2114)
+++ YDFramework2.0/trunk/examples/weblog/manage/manage.css	2006-09-08 18:22:19 UTC (rev 2115)
@@ -1,63 +1,63 @@
 select, input, textarea, body, p, .normal, li, td {
-    font-family: 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Verdana, Arial, Sans-Serif;
+	font-family: 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Verdana, Arial, Sans-Serif;
 }
 
 body, p, .normal, li, td, th {
-    font-size: 10pt;
-    line-height: 16pt;
+	font-size: 10pt;
+	line-height: 16pt;
 }
 
 a {
-    color: #417690;
-    text-decoration: underline;
-    font-weight: normal;
-    cursor: pointer;
+	color: #417690;
+	text-decoration: underline;
+	font-weight: normal;
+	cursor: pointer;
 }
 
 .image {
-    border:1px;
-    border-color: #000066;
-    color: #000066;
-    border-style: solid;
+	border:1px;
+	border-color: #000066;
+	color: #000066;
+	border-style: solid;
 }
 
 p.title	{
-    font-size: 150%;
-    font-weight: normal;
-    color: #417690;
+	font-size: 150%;
+	font-weight: normal;
+	color: #417690;
 }
 
 p.titleTop {
-    font-size: 150%;
-    font-weight: normal;
-    color: white;
+	font-size: 150%;
+	font-weight: normal;
+	color: white;
 }
 
 p.textTop {
-    font-weight: normal;
-    color: white;
+	font-weight: normal;
+	color: white;
 }
 
 .subline {
-    color: gray;
-    font-size: 8pt;
+	color: gray;
+	font-size: 8pt;
 }
 
 .disabled {
-    color: gray;
+	color: gray;
 }
 
 .error {
-    color: red;
-    margin: 0;
-    padding: 10px;
-    background-color: #f8f8f8;
-    border-top: 1px solid #ddd;
-    border-bottom: 1px solid #ddd;
+	color: red;
+	margin: 0;
+	padding: 10px;
+	background-color: #f8f8f8;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
 }
 
 .required {
-    color: red;
+	color: red;
 }
 
 input, textarea, select	{
@@ -70,29 +70,33 @@
 	border: none;
 }
 
+input.tfXS {
+	width: 100px;
+}
+
 input.tfS {
-    width: 300px;
+	width: 300px;
 }
 
 input.tfL {
-    width: 400px;
+	width: 400px;
 }
 
 input.tfM {
-    width: 400px;
+	width: 400px;
 }
 
 textarea {
-    width: 700px;
-    height: 300px;
-    font-family: "Lucida Sans Typewriter", "Andale Mono", "Courier New", "Courier";
-    font-size: 9pt;
-    line-height: 14pt;
+	width: 700px;
+	height: 300px;
+	font-family: "Lucida Sans Typewriter", "Andale Mono", "Courier New", "Courier";
+	font-size: 9pt;
+	line-height: 14pt;
 }
 
 textarea.tfMNoMce {
-    width: 400px;
-    height: 100px;
+	width: 400px;
+	height: 100px;
 }
 
 td.bbtoolbar {
@@ -100,109 +104,109 @@
 }
 
 select.tfS {
-    width: 200px;
+	width: 200px;
 	border:1px solid #ccc;
 }
 
 input.button {
-    width: 120px;
-    color: #417690;
-    font-weight: bold;
+	width: 120px;
+	color: #417690;
+	font-weight: bold;
 	background: white url(images/nav-bg.gif) bottom repeat-x; 
 }
 
 td, th {
-    vertical-align: top
+	vertical-align: top
 }
 
 th {
-    font-weight: bold;
+	font-weight: bold;
 }
 
 td.adminRowL, th.adminRowL {
-    border-bottom: 1px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: left;
+	border-bottom: 1px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: left;
 }
 
 td.adminRowLG, th.adminRowLG {
-    border-bottom: 1px solid #DDDDDD;
+	border-bottom: 1px solid #DDDDDD;
 	border-top: 1px solid #DDDDDD;
-    padding: 4px;
-    text-align: left;
-    color: #417690;
+	padding: 4px;
+	text-align: left;
+	color: #417690;
 	background: url(images/nav-bg.gif);
 }
 
 td.adminRowLGR, th.adminRowLGR {
-    border-bottom: 1px solid #DDDDDD;
+	border-bottom: 1px solid #DDDDDD;
 	border-top: 1px solid #DDDDDD;
-    padding: 4px;
-    text-align: right;
-    color: #417690;
+	padding: 4px;
+	text-align: right;
+	color: #417690;
 	background: url(images/nav-bg.gif);
 }
 
 td.adminRowELG, th.adminRowELG {
-    border-bottom: 1px solid #DDDDDD;
+	border-bottom: 1px solid #DDDDDD;
 	border-top: 1px solid #DDDDDD;
-    padding: 4px;
-    text-align: left;
-    color: red;
+	padding: 4px;
+	text-align: left;
+	color: red;
 	background: url(images/nav-bg.gif);
 }
 
 td.adminRowEL, th.adminRowEL {
-    border-bottom: 1px solid #DDDDDD;
+	border-bottom: 1px solid #DDDDDD;
 	border-top: 1px solid #DDDDDD;
-    padding: 4px;
-    text-align: left;
+	padding: 4px;
+	text-align: left;
 	color: red;
 	background-color: #f8f8f8;
 }
 
 td.adminRowLNB, th.adminRowLNB {
-    border-bottom: 0px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: left;
+	border-bottom: 0px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: left;
 }
 
 td.adminRowCNB, th.adminRowCNB {
-    border-bottom: 0px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: center;
+	border-bottom: 0px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: center;
 }
 
 td.adminRowRNB, th.adminRowRNB {
-    border-bottom: 0px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: right;
+	border-bottom: 0px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: right;
 }
 
 td.adminRowC, th.adminRowC {
-    border-bottom: 1px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: center;
+	border-bottom: 1px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: center;
 }
 
 td.adminRowR, th.adminRowR {
-    border-bottom: 1px solid #DDDDDD;
-    padding-top: 4px;
-    padding-bottom: 4px;
-    text-align: right;
+	border-bottom: 1px solid #DDDDDD;
+	padding-top: 4px;
+	padding-bottom: 4px;
+	text-align: right;
 }
 
 table {
-    border-width: 0px;
+	border-width: 0px;
 }
 
 td.topRow, td.topRowR {
-    padding-bottom: 8px;
+	padding-bottom: 8px;
 	background:#94da3a url(images/nav-toprow.gif) repeat-x;
 }
 
@@ -211,56 +215,56 @@
 }
 
 p.langRow, a.langRow {
-    color: white;
+	color: white;
 }
 
 td.langRowL {
-    background-color: #417690;
+	background-color: #417690;
 	background: url(images/default-bg.gif);
-    padding-top: 2px;
-    padding-bottom: 2px;
-    padding-right: 0px;
-    text-align: left;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	padding-right: 0px;
+	text-align: left;
 }
 
 td.langRowR {
-    background-color: #417690;
+	background-color: #417690;
 	background: url(images/default-bg.gif);
-    padding-top: 2px;
-    padding-bottom: 2px;
-    padding-left: 0px;
-    text-align: right;
+	padding-top: 2px;
+	padding-bottom: 2px;
+	padding-left: 0px;
+	text-align: right;
 }
 
 td.langRowE {
-    background-color: #000066;
-    padding: 2px;
-    padding-left: 4px;
+	background-color: #000066;
+	padding: 2px;
+	padding-left: 4px;
 }
 
 td.leftCol {
-    width: 200px;
+	width: 200px;
 }
 
 a.leftColSelected {
-    color: darkred;
-    font-weight: bold;
+	color: darkred;
+	font-weight: bold;
 }
 
 a.leftColUnselected {
-    font-weight: bold;
+	font-weight: bold;
 }
 
 a.yes {
-    color: green;
+	color: green;
 }
 
 a.no {
-    color: red;
+	color: red;
 }
 
 a.helpLink {
-    cursor: pointer;
+	cursor: pointer;
 }
 
 input[type=checkbox], input[type=radio] { border:none; }



From pclaerhout at mail.berlios.de  Fri Sep  8 20:33:15 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 8 Sep 2006 20:33:15 +0200
Subject: [ydf-devel] r2116 - in YDFramework2.0/trunk/examples/weblog:
	include manage
Message-ID: <200609081833.k88IXFWS028658@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-08 20:33:15 +0200 (Fri, 08 Sep 2006)
New Revision: 2116

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
Log:
The image metadata is now deleted from the database when an item gets deleted.

See also: [ Bug #8710 ] Delete image leaves metadata

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 18:22:19 UTC (rev 2115)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 18:33:15 UTC (rev 2116)
@@ -362,8 +362,8 @@
             return $items;
         }
 
-        // Get the title and description for an item image
-        function getItemImageMetaData( $image ) {
+        // Function to initialize image metadata
+        function initImageMetaData() {
 
             // Get the image metadata if not there yet
             if ( is_null( $this->imagemetadata ) ) {
@@ -374,6 +374,14 @@
                 }
             }
 
+        }
+
+        // Get the title and description for an item image
+        function getItemImageMetaData( $image ) {
+
+            // Initialize the image data
+            $this->initImageMetaData();
+
             // Start with the default settings
             $image->title = $image->getBasenameNoExt();
             $image->description = '';
@@ -400,6 +408,12 @@
             return $result;
         }
 
+        // Function to delete the image data for an item in the database
+        function removeImageMetaData( $image ) {
+            $sql = 'DELETE FROM #_imagemetadata WHERE img_path = ' . $this->str( $image );
+            return $this->db->executeSql( $sql );
+        }
+
         // Function to get a single item
         function getItem( $where ) {
             $result = $this->getItems( 1, 0, 'created desc, title', $where );

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-08 18:22:19 UTC (rev 2115)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.php	2006-09-08 18:33:15 UTC (rev 2116)
@@ -137,6 +137,9 @@
             $image = $this->getImage();
             $this->redirectIfMissing( $image );
 
+            // Remove the image metadata
+            $this->weblog->removeImageMetaData( $image );
+
             // The path to the image
             $path = realpath( '../' . YDConfig::get( 'dir_uploads', 'uploads' ) . '/' . $image );
 



From pclaerhout at mail.berlios.de  Sat Sep  9 20:36:36 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 9 Sep 2006 20:36:36 +0200
Subject: [ydf-devel] r2117 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200609091836.k89IaaOL010588@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-09 20:36:36 +0200 (Sat, 09 Sep 2006)
New Revision: 2117

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Removed some leftover debugging statements.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-08 18:33:15 UTC (rev 2116)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-09 18:36:36 UTC (rev 2117)
@@ -882,12 +882,6 @@
             // Resize the image
             $image->saveThumbnail( $max_x, $max_y, $image->getAbsolutePath() );
 
-            // Debugging help
-            $image->getImageSize();
-            YDDebugUtil::dump( $max_x, 'x' );
-            YDDebugUtil::dump( $max_y, 'y' );
-            YDDebugUtil::dump( $image, 'image' );
-
             // Return the image
             return $image;
 



From ximian at mail.berlios.de  Tue Sep 12 10:24:34 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 12 Sep 2006 10:24:34 +0200
Subject: [ydf-devel] r2118 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200609120824.k8C8OYqq003462@sheep.berlios.de>

Author: ximian
Date: 2006-09-12 10:24:24 +0200 (Tue, 12 Sep 2006)
New Revision: 2118

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
Log:
on YDFormElement_SelectImage:
 - added: support for 'border' image attribute
 - fixed: default image value when default value is set but not a valid option

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2006-09-09 18:36:36 UTC (rev 2117)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2006-09-12 08:24:24 UTC (rev 2118)
@@ -75,6 +75,12 @@
 				unset( $attributes['height'] );
 			}
 
+			// check if border exist
+			if ( isset( $attributes['border'] ) ){
+				$this->_image_parameters['border'] = $attributes['border'];
+				unset( $attributes['border'] );
+			}
+
             // Initialize the parent
             $this->YDFormElement( $form, $name, $label, $attributes, $options );
 
@@ -119,8 +125,8 @@
 			// compute image source
 			$source = $this->_img_src;
 
-			// compute selected option. If default value was set, use it. Otherwise use 1st option
-			if ( ! empty( $this->_value ) ){
+			// compute selected option. If default value was set and that value is valid, use it. Otherwise use 1st option
+			if ( ! empty( $this->_value ) && isset( $this->_options[ $this->_value ] ) ){
 				$source .= $this->_value;
 			}else{
 				$values  = array_keys( $this->_options );



From ximian at mail.berlios.de  Tue Sep 12 10:26:43 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 12 Sep 2006 10:26:43 +0200
Subject: [ydf-devel] r2119 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200609120826.k8C8QhBe003694@sheep.berlios.de>

Author: ximian
Date: 2006-09-12 10:26:27 +0200 (Tue, 12 Sep 2006)
New Revision: 2119

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
added new method: YDDatabaseObject::deleteSQL that returns the sql string needed to delete element

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-12 08:24:24 UTC (rev 2118)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-09-12 08:26:27 UTC (rev 2119)
@@ -1130,6 +1130,30 @@
         }
 
         /**
+         *  This method returns the DELETE query based on the values of the object
+         *  or any condition set by where and order.
+         *
+         *  @returns  The SQL query string.
+         */
+         function deleteSQL(){
+
+            // get current execute config value
+            $exe = YDConfig::get( 'YD_DBOBJECT_EXECUTE' );
+
+            // disable query execution
+            YDConfig::set( 'YD_DBOBJECT_EXECUTE', false );
+
+            // get delete sql
+            $res = $this->delete();
+
+            // set current execute config with original value
+            YDConfig::set( 'YD_DBOBJECT_EXECUTE', $exe );
+
+            // return sql query
+            return $res;
+        }
+
+        /**
          *  This function finds the rows that match the object field's values
          *  an any other condition added with where, group, having, etc.
          *



From pclaerhout at mail.berlios.de  Wed Sep 13 10:26:22 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 10:26:22 +0200
Subject: [ydf-devel] r2120 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609130826.k8D8QM4G006402@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 10:26:22 +0200 (Wed, 13 Sep 2006)
New Revision: 2120

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
On servers where the $_SERVER['PATH_TRANSLATED'] value is not there, $_SERVER['SCRIPT_FILENAME'] is now used.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-12 08:26:27 UTC (rev 2119)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-13 08:26:22 UTC (rev 2120)
@@ -67,7 +67,11 @@
 
     // File and URL constants
     @define( 'YD_SELF_SCRIPT', $_SERVER['PHP_SELF'] );
-    @define( 'YD_SELF_FILE', $_SERVER['PATH_TRANSLATED'] );
+    if ( isset( $_SERVER['PATH_TRANSLATED'] ) ) {
+        @define( 'YD_SELF_FILE', $_SERVER['PATH_TRANSLATED'] );
+    } else {
+        @define( 'YD_SELF_FILE', $_SERVER['SCRIPT_FILENAME'] );
+    }
     @define( 'YD_SELF_DIR', dirname( YD_SELF_FILE ) );
     @define( 'YD_SELF_URI', $_SERVER['REQUEST_URI'] );
 



From pclaerhout at mail.berlios.de  Wed Sep 13 10:31:28 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 10:31:28 +0200
Subject: [ydf-devel] r2121 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609130831.k8D8VSrh006825@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 10:31:28 +0200 (Wed, 13 Sep 2006)
New Revision: 2121

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
Fixed some errors in YDFSDirectory::getContents where glob would return false on no matches, screwing up the rest of the logic.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2006-09-13 08:26:22 UTC (rev 2120)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2006-09-13 08:31:28 UTC (rev 2121)
@@ -1398,21 +1398,30 @@
             if ( $hasMoreThanExceptions == true ) {
                 foreach ( $pattern as $patternitem ) {
                     if ( ! empty( $patternitem ) && substr( $patternitem, 0, 1 ) != '!' ) {
-                        foreach ( glob( $this->getAbsolutePath() . '/' . $patternitem ) as $file ) {
-                            $file = basename( $file );
-                            $fileListMatch[ $file ] = $file;
+                        $glob_files = glob( $this->getAbsolutePath() . '/' . $patternitem );
+                        if ( $glob_files !== false ) {
+                            foreach ( $glob_files as $file ) {
+                                $file = basename( $file );
+                                $fileListMatch[ $file ] = $file;
+                            }
                         }
                     } else if ( empty( $patternitem ) ) {
-                        foreach ( glob( $this->getAbsolutePath() . '/*' ) as $file ) {
-                            $file = basename( $file );
-                            $fileListMatch[ $file ] = $file;
+                        $glob_files = glob( $this->getAbsolutePath() . '/*' );
+                        if ( $glob_files !== false ) {
+                            foreach ( glob( $this->getAbsolutePath() . '/*' ) as $file ) {
+                                $file = basename( $file );
+                                $fileListMatch[ $file ] = $file;
+                            }
                         }
                     }
                 }
             } else {
-                foreach ( glob( $this->getAbsolutePath() . '/' . '*' ) as $file ) {
-                    $file = basename( $file );
-                    $fileListMatch[ $file ] = $file;
+                $glob_files = glob( $this->getAbsolutePath() . '/' . '*' );
+                if ( $glob_files !== false ) {
+                    foreach ( $glob_files as $file ) {
+                        $file = basename( $file );
+                        $fileListMatch[ $file ] = $file;
+                    }
                 }
             }
             $fileList = & $fileListMatch;
@@ -1420,9 +1429,12 @@
             // Remove the files that don't match
             foreach ( $pattern as $patternitem ) {
                 if ( ! empty( $patternitem ) && substr( $patternitem, 0, 1 ) == '!' ) {
-                    foreach ( glob( $this->getAbsolutePath() . '/' . substr( $patternitem, 1 ) ) as $file ) {
-                        $file = basename( $file );
-                        unset( $fileList[ $file ] );
+                    $glob_files = glob( $this->getAbsolutePath() . '/' . substr( $patternitem, 1 ) );
+                    if ( $glob_files !== false ) {
+                        foreach ( $glob_files as $file ) {
+                            $file = basename( $file );
+                            unset( $fileList[ $file ] );
+                        }
                     }
                 }
             }



From pclaerhout at mail.berlios.de  Wed Sep 13 10:50:27 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 10:50:27 +0200
Subject: [ydf-devel] r2122 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples
Message-ID: <200609130850.k8D8oRxn008387@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 10:50:26 +0200 (Wed, 13 Sep 2006)
New Revision: 2122

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/examples/database1.php
Log:
Added YDDatabaseDriver::prepareSql.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-13 08:31:28 UTC (rev 2121)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-13 08:50:26 UTC (rev 2122)
@@ -1066,6 +1066,58 @@
         }
 
         /**
+         *  Function to prepare an SQL statement with parameters. The parameters start counting from 1.
+         
+         *  This works as follows:
+         *
+         *  \code
+         *  $sql = 'SELECT * FROM comments WHERE id = :1 and author = :2'
+         *  \endcode
+         *
+         *  After a function call as follows:
+         *
+         *  \code
+         *  prepareSql( $sql, 1, 'Pieter Claerhout' );
+         *  \endcode
+         *
+         *  The SQL statement becomes:
+         *
+         *  \code
+         *  SELECT * FROM comments WHERE id = '1' and author = 'Pieter Claerhout'
+         *  \endcode
+         *
+         *  All the arguments are automatically escaped.
+         *
+         *  @returns A prepared SQL statement
+         */
+        function prepareSql() {
+
+            // Check that we have at least one argument (the SQL statement)
+            $numargs = func_num_args();
+            if ( $numargs < 1 ) {
+                trigger_error( "The function prepareSql needs at least 1 parameter.", YD_ERROR );
+            }
+
+            // Get the list of arguments
+            $args = func_get_args();
+
+            // First element is the SQL statement itself
+            $sql = array_shift( $args );
+
+            // Reset the indexes on the arguments
+            $args = array_values( $args );
+
+            // Update the SQL statement
+            foreach ( $args as $key => $arg ) {
+                $sql = str_replace( ':' . ($key+1), $this->escapeSql( $arg ), $sql );
+            }
+
+            // Return the SQL statement
+            return $sql;
+
+        }
+
+        /**
          *  Format the $date in the format the database accepts. The $date parameter can be a Unix integer timestamp or
          *  an ISO format Y-m-d. Uses the fmtDate field, which holds the format to use. If null or false or '' is passed
          *  in, it will be converted to an SQL null.

Modified: YDFramework2.0/trunk/examples/database1.php
===================================================================
--- YDFramework2.0/trunk/examples/database1.php	2006-09-13 08:31:28 UTC (rev 2121)
+++ YDFramework2.0/trunk/examples/database1.php	2006-09-13 08:50:26 UTC (rev 2122)
@@ -33,6 +33,12 @@
 
             // Test string escaping
             YDDebugUtil::dump( $db->escape( "Pieter's Framework" ), '$db->escape' );
+            YDDebugUtil::dump(
+                $db->prepareSql(
+                    'SELECT * FROM comments WHERE id = :1 and author = :2', 1, "Pieter's Author"
+                ),
+                '$db->prepareSql'
+            );
 
             // Test timestamps
             YDDebugUtil::dump( $db->getDate(), 'getDate()' );



From pclaerhout at mail.berlios.de  Wed Sep 13 12:19:21 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 12:19:21 +0200
Subject: [ydf-devel] r2123 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609131019.k8DAJL4c020363@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 12:19:21 +0200 (Wed, 13 Sep 2006)
New Revision: 2123

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added support for limiting values in YDRequest::getQueryStringParameter and YDRequest::getQueryStringParameterAsInt.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 08:50:26 UTC (rev 2122)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 10:19:21 UTC (rev 2123)
@@ -32,9 +32,9 @@
      *	framework is implemented in this class.
      */
     class YDRequest extends YDBase {
-	
-        var $_callbacks = null;	
 
+        var $_callbacks = null;
+
         /**
          *	This is the class constructor for the YDRequest class. This sets the default action to 'actionDefault' (but
          *	can be overridden later on).
@@ -76,11 +76,24 @@
          *
          *  @param  $name    The name of the query string variable.
          *  @param  $default (optional) The default value if the query string variable is not existing.
+         *  @param  $values  (optional) The allowed values as an array.
          *
          *  @returns    The value of the query string variable as a string.
          */
-        function getQueryStringParameter( $name, $default='' ) {
-            return isset( $_GET[ $name ] ) ? $_GET[ $name ] : $default;
+        function getQueryStringParameter( $name, $default='', $values=null ) {
+            if ( isset( $_GET[$name] ) ) {
+                if ( ! is_null( $values ) ) {
+                    if ( in_array( $_GET[$name], $values ) ) {
+                        return $_GET[$name];
+                    } else {
+                        return $default;
+                    }
+                } else {
+                    return $_GET[$name];
+                }
+            } else {
+                return $default;
+            }
         }
 
         /**
@@ -88,11 +101,12 @@
          *
          *  @param  $name    The name of the query string variable.
          *  @param  $default (optional) The default value if the query string variable is not existing.
+         *  @param  $values  (optional) The allowed values as an array.
          *
          *  @returns    The value of the query string variable as an integer.
          */
-        function getQueryStringParameterAsInt( $name, $default=null ) {
-            $value = $this->getQueryStringParameter( $name, $default );
+        function getQueryStringParameterAsInt( $name, $default=null, $values=null ) {
+            $value = $this->getQueryStringParameter( $name, $default, $values );
             return is_numeric( $value ) ? intval( $value ) : $default;
         }
 
@@ -215,11 +229,11 @@
          */
         function redirect( $url ) {
             if ( strpos( strtoupper( $_SERVER['SERVER_SOFTWARE'] ), 'IIS' ) ) {
-               header( 'Refresh: 0; URL=' . $url ); 
-            } else { 
-               header( 'Location: '. $url ); 
-            } 
-            die(); 
+               header( 'Refresh: 0; URL=' . $url );
+            } else {
+               header( 'Location: '. $url );
+            }
+            die();
         }
 
         /**
@@ -397,7 +411,7 @@
          *
          *  Processing of callbacks and actions in the context of a request
          *  is executed in this order:
-         * 
+         *
          *    1. (optional) before 'action' callbacks - apply to all actions
          *    2. (optional) before callback for the current action
          *	  3. Current action
@@ -411,7 +425,7 @@
          *		$this->registerCallback( 'my_after_callback', 'action', false );
          *
          *	example 3: will execute my_deafult_after_callback() after actionDefault
-         *		$this->registerCallback( 'my_deafult_after_callback', 'actionDefault', false );		 
+         *		$this->registerCallback( 'my_deafult_after_callback', 'actionDefault', false );
          *
          *  @param $method  The method name.
          *  @param $action  The action or array of actions that trigger the call.
@@ -419,11 +433,11 @@
          */
         function registerCallback( $method, $action, $before=false ) {
             if ( strtolower( $action ) != 'action' && ! $this->_callbacks->exists( strtolower( $action ) ) ) {
-                $this->_callbacks->set( strtolower( $action ),   array( 'before' => array(), 'after' => array() ) );				
+                $this->_callbacks->set( strtolower( $action ),   array( 'before' => array(), 'after' => array() ) );
             }
             if ( strtolower( $action ) != 'action' && ! $this->hasMethod( $action ) ) {
                 trigger_error(  $this->getClassName() . ' - ' .
-                                    ' action "' . $action . '" for callback "' . $method . '" does not exist.', YD_ERROR );					
+                                    ' action "' . $action . '" for callback "' . $method . '" does not exist.', YD_ERROR );
             }
             $sub = $before ? 'before' : 'after';
             if ( ! is_array( $action ) ) {
@@ -478,12 +492,12 @@
             if ( $actions[$sub] != null ) {
                 foreach ( $actions[ $sub ] as $callback => $n ) {
                     if ( ! $this->hasMethod( $callback ) ) {
-                        trigger_error(  $this->getClassName() . ' - The ' . 
+                        trigger_error(  $this->getClassName() . ' - The ' .
                                         $action . ' callback method "' . $callback . '" is not defined.', YD_ERROR );
                     }
                     $res = call_user_func( array( & $this, $callback ), $action, $before, $success );
                     if ( $res !== true && $res !== null ) {
-                        return array( 
+                        return array(
                             'class'    => $this->getClassName(),
                             'callback' => $callback,
                             'action'   => $action,



From pclaerhout at mail.berlios.de  Wed Sep 13 12:20:07 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 12:20:07 +0200
Subject: [ydf-devel] r2124 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609131020.k8DAK7qA020561@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 12:20:07 +0200 (Wed, 13 Sep 2006)
New Revision: 2124

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
The browser languages are now always returned in lowercase.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-13 10:19:21 UTC (rev 2123)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-09-13 10:20:07 UTC (rev 2124)
@@ -195,7 +195,7 @@
          *
          *	@param $input	The array to convert.
          *	@param $key		The column to use as the key name.
-         *	@param $map		The array or string which indicates how values of the children arrays should be mapped in 
+         *	@param $map		The array or string which indicates how values of the children arrays should be mapped in
          *                  the parent array.
          *
          *	@returns		The array resulting from the mapping.
@@ -232,7 +232,7 @@
             // Return the new array
             return $output;
         }
-        
+
         /**
          *  This function will implode a 1-level array in a string.
          *
@@ -249,7 +249,7 @@
             foreach ( $input as $k => $v ) {
                 $return .= $separator . $k . $glue . $v;
             }
-            return substr( $return, 1 ); 
+            return substr( $return, 1 );
         }
 
         /**
@@ -624,21 +624,21 @@
             return $string;
         }
 
-        /** 
-         *   This function will encode all characters in a string to it's ASCII value. 
-         * 
-         *   @param $string   The original string to encode. 
-         * 
-         *   @returns   The encoded string. 
-         * 
-         *   @static 
-         */ 
-        function encodeToAscii( $string ) { 
-            $result = ''; 
-            for ( $i=0; $i < strlen( $string ); $i++ ) { 
-                $result .= "&#" . ord( substr( $string, $i, 1) ) . ';'; 
-            } 
-            return $result; 
+        /**
+         *   This function will encode all characters in a string to it's ASCII value.
+         *
+         *   @param $string   The original string to encode.
+         *
+         *   @returns   The encoded string.
+         *
+         *   @static
+         */
+        function encodeToAscii( $string ) {
+            $result = '';
+            for ( $i=0; $i < strlen( $string ); $i++ ) {
+                $result .= "&#" . ord( substr( $string, $i, 1) ) . ';';
+            }
+            return $result;
         }
 
         /**
@@ -710,29 +710,29 @@
 
         }
 
-        /** 
-         *   This function will compare two network ip addresses 
-         * 
-         *   @param $ip1      First ip 
-         * 
-         *   @param $ip2      Second ip 
-         * 
-         *   @returns    Returns < 0 if ip1 is less than ip2; > 0 if str1 is greater than ip2, and 0 if they are equal. 
-         * 
-         *   @static 
-         */ 
-        function ipcmp( $ip1, $ip2 ){ 
+        /**
+         *   This function will compare two network ip addresses
+         *
+         *   @param $ip1      First ip
+         *
+         *   @param $ip2      Second ip
+         *
+         *   @returns    Returns < 0 if ip1 is less than ip2; > 0 if str1 is greater than ip2, and 0 if they are equal.
+         *
+         *   @static
+         */
+        function ipcmp( $ip1, $ip2 ){
 
-            // get 4 elements from the network address 
-            $ip1 = explode(".", $ip1); 
-            $ip2 = explode(".", $ip2); 
+            // get 4 elements from the network address
+            $ip1 = explode(".", $ip1);
+            $ip2 = explode(".", $ip2);
 
-            // get an integer that represents the numeric value of the address 
-            $ip1 = $ip1[0]*256^3 + $ip1[1]*256^2 + $ip1[2]*256 + $ip1[3]; 
-            $ip2 = $ip2[0]*256^3 + $ip2[1]*256^2 + $ip2[2]*256 + $ip2[3]; 
+            // get an integer that represents the numeric value of the address
+            $ip1 = $ip1[0]*256^3 + $ip1[1]*256^2 + $ip1[2]*256 + $ip1[3];
+            $ip2 = $ip2[0]*256^3 + $ip2[1]*256^2 + $ip2[2]*256 + $ip2[3];
 
-            // return diference 
-            return $ip1 - $ip2; 
+            // return diference
+            return $ip1 - $ip2;
 
         }
 
@@ -753,7 +753,7 @@
 
             // Decode the HTML entities
             $trans = array_flip( get_html_translation_table( HTML_ENTITIES, ENT_NOQUOTES ) );
-            $data = strtr( $data, $trans ); 
+            $data = strtr( $data, $trans );
 
             // The characters to replace
             $chars = array(
@@ -983,7 +983,7 @@
             $browserLanguages = array_unique( $browserLanguages );
 
             // Return the browser languages
-            return array_values( $browserLanguages );
+            return array_map( 'strtolower', array_values( $browserLanguages ) );
 
         }
 



From pclaerhout at mail.berlios.de  Wed Sep 13 13:32:27 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 13:32:27 +0200
Subject: [ydf-devel] r2125 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609131132.k8DBWR4J000339@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 13:32:27 +0200 (Wed, 13 Sep 2006)
New Revision: 2125

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added initial support for cookies to YDRequest.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 10:20:07 UTC (rev 2124)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 11:32:27 UTC (rev 2125)
@@ -38,8 +38,11 @@
         /**
          *	This is the class constructor for the YDRequest class. This sets the default action to 'actionDefault' (but
          *	can be overridden later on).
+         *
+         *  @param  $cookiePath     (optional) The default cookie path. Defaults to '/'.
+         *  @param  $cookieLifeTime (optional) The default cookie life time. Defaults to 31536000 seconds (1 year).
          */
-        function YDRequest() {
+        function YDRequest( $cookiePath='/', $cookieLifeTime=null ) {
 
             // Initialize YDBase
             $this->YDBase();
@@ -53,6 +56,14 @@
 
             // this is for callbacks applicable to all actions
             $this->_callbacks->set( 'action',   array( 'before' => array(), 'after' => array() ) );
+
+            // The default cookie path
+            $this->cookiePath = $cookiePath;
+            if ( $cookieLifeTime == null ) {
+                $cookieLifeTime = time() + 31536000;
+            }
+            $this->cookieLifeTime = $cookieLifeTime;
+
         }
 
         /**
@@ -511,6 +522,52 @@
             return true;
         }
 
+        /**
+         *  This function gets the value of a specific cookie.
+         *
+         *  @param  $name       The name of the cookie.
+         *  @param  $default    (optional) The default value if the cookie is null or not set. Defaults to ''.
+         *  @param  $values     (optional) The allowed values as an array.
+         *
+         *  @returns    The value of the cookie or the default if the cookie is not set or not in values.
+         */
+        function getCookie( $name, $default='', $values=null ) {
+            if ( isset( $_COOKIE[$name] ) && ! empty( $_COOKIE[$name] ) ) {
+                if ( ! is_null( $values ) ) {
+                    if ( in_array( $_COOKIE[$name], $values ) ) {
+                        return $_COOKIE[$name];
+                    } else {
+                        return $default;
+                    }
+                } else {
+                    return $_COOKIE[$name];
+                }
+            } else {
+                return $default;
+            }
+        }
+
+        /**
+         *  This function sets the value for a specific cookie
+         *
+         *  @param  $name       The name of the cookie to set.
+         *  @param  $value      The value to set for the cookie.
+         */
+        function setCookie( $name, $value ) {
+            setcookie( $name, $value, $this->cookieLifeTime, $this->cookiePath );
+        }
+
+        /**
+         *  This function deletes a cookie value.
+         *
+         *  @param  $name       The name of the cookie to delete.
+         */
+        function deleteCookie( $name ) {
+            setcookie( $name, null, time() - 31536000, $this->cookiePath );
+            unset( $_COOKIE[$name] );
+        }
+
+
     }
 
 ?>



From pclaerhout at mail.berlios.de  Wed Sep 13 13:35:56 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 13:35:56 +0200
Subject: [ydf-devel] r2126 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609131135.k8DBZuWo000748@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 13:35:56 +0200 (Wed, 13 Sep 2006)
New Revision: 2126

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added YDRequest::getRequiredQueryStringParameter.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 11:32:27 UTC (rev 2125)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-13 11:35:56 UTC (rev 2126)
@@ -122,6 +122,26 @@
         }
 
         /**
+         *  Get the value of a query string variable. When the required parameter is not set, it will redirect to the
+         *  indicated action.
+         *
+         *  @param  $name               The name of the query string variable.
+         *  @param  $default            (optional) The default value if the query string variable is not existing.
+         *  @param  $values             (optional) The allowed values as an array.
+         *  @param  $action_if_fails    (optional) The action to redirect of if the parameter is invalid.
+         *
+         *  @returns    The value of the query string variable as a string.
+         */
+        function getRequiredQueryStringParameter( $name, $default, $values=null, $action_if_fails='default' ) {
+            $result = $this->getQueryStringParameter( $name, $default, $values );
+            if ( empty( $result ) ) {
+                $this->redirectToAction( $action_if_fails );
+            } else {
+                return $result;
+            }
+        }
+
+        /**
          *	This function will return the full URL to the current request, including hostname, port and request URI.
          *
          *  @param  $no_qs  (optional) If set to false, the query string will be omitted. Default is false.
@@ -222,6 +242,9 @@
          *					before redirecting. They will automatically get URL encoded.
          */
         function redirectToAction( $action='default', $params=array() ) {
+            if ( is_null( $action ) ) {
+                $action = 'default';
+            }
             if ( strpos( $action, 'action' ) === 0 ) {
                 $action = substr( $action, strlen( 'action' ) );
             }



From pclaerhout at mail.berlios.de  Wed Sep 13 17:25:20 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 17:25:20 +0200
Subject: [ydf-devel] r2127 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormRenderers
Message-ID: <200609131525.k8DFPKnW000338@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 17:25:19 +0200 (Wed, 13 Sep 2006)
New Revision: 2127

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
Log:
Added support for form legends and fieldsets.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-13 11:35:56 UTC (rev 2126)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-13 15:25:19 UTC (rev 2127)
@@ -63,6 +63,7 @@
             $this->_action = empty( $action ) ? $_SERVER['REQUEST_URI'] : $action;
             $this->_target = empty( $target ) ? '_self' : $target;
             $this->_attributes = $attributes;
+            $this->_legend = null;
 
             // The list of known elements, rules, filters and validators
             $this->_regElements = array();
@@ -192,6 +193,15 @@
         }
 
         /**
+         *  This function sets the legend for a form. This will generate a fieldset tag and legend tag in the HTML.
+         *
+         *  @param  $legend     The legend to set for the field.
+         */
+        function setLegend( $legend ) {
+            $this->_legend = $legend;
+        }
+
+        /**
          *  This function will set the HTML that is added before and after the element
          *  label to indicate that the element is required. This only has affect if
          *  you use the default toHtml function.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2006-09-13 11:35:56 UTC (rev 2126)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2006-09-13 15:25:19 UTC (rev 2127)
@@ -72,7 +72,18 @@
             $form['requirednote'] = $this->_form->_requiredNote;
             $form['endtag'] = '</form>';
             $form['name']   = $this->_form->_name;
-            
+
+            // Add the fieldset and legend tag if any
+            if ( ! empty( $this->_form->_legend ) ) {
+
+                // Add it to the start tag
+                $form['tag'] .= '<fieldset><legend>' . $this->_form->_legend . '</legend>';
+
+                // Add it to the end tag
+                $form['endtag'] = '</fieldset>' . $form['endtag'];
+
+            }
+
             // Add the errors
             $form['errors'] = $this->_form->_errors;
             $form['errors_unique_messages' ] = array_unique( array_values( $this->_form->_errors ) );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2006-09-13 11:35:56 UTC (rev 2126)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2006-09-13 15:25:19 UTC (rev 2127)
@@ -58,12 +58,15 @@
 
             // Start with the form element
             $html = $form['tag'] . YD_CRLF;
-            
+
             // Add form errors if any
             if ( isset( $form['errors']['__ALL__'] ) ) {
                 $html .= '<p>' . $this->_form->_htmlErrorStart . $form['errors']['__ALL__'] . $this->_form->_htmlErrorEnd . '</p>' . YD_CRLF;
             }
 
+            // Store the HTML end
+            $html_end = $form['endtag'];
+
             // Remove some things from the array
             unset( $form['attribs'] );
             unset( $form['tag'] );
@@ -71,7 +74,8 @@
             unset( $form['errors'] );
             unset( $form['errors_unique_messages'] );
             unset( $form['requirednote'] );
-            
+
+            // Remove the form name
             if ( ! is_array( $form['name'] ) ) {
                 unset( $form['name'] );
             }
@@ -133,7 +137,7 @@
             }
 
             // Close the form tag
-            $html .= '</form>';
+            $html .= $html_end;
 
             // Return the HTML
             return $html;

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2006-09-13 11:35:56 UTC (rev 2126)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2006-09-13 15:25:19 UTC (rev 2127)
@@ -60,7 +60,8 @@
             $xml['form'][0]['@']['method'] = $this->_form->_method;
             $xml['form'][0]['@']['action'] = $this->_form->_action;
             $xml['form'][0]['@']['target'] = $this->_form->_target;
-            
+            $xml['form'][0]['@']['legend'] = $this->_form->_legend;
+
             $form = & $xml['form'][0]['#'];
             $attr = & $form['attributes'][0]['#'];
             $elem = & $form['elements'][0]['#'];
@@ -351,7 +352,8 @@
             $f_method = $arr['form'][0]['@']['method'];
             $f_action = $arr['form'][0]['@']['action'];
             $f_target = $arr['form'][0]['@']['target'];
-            
+            $f_legend = $arr['form'][0]['@']['legend'];
+
             // References
             $form = & $arr['form'][0]['#'];
             $attr = & $form['attributes'][0]['#'];
@@ -377,7 +379,7 @@
             
             // YDForm object
             $f = new $class( $f_name, $f_method, $f_action, $f_target, $f_attr );
-            
+            $f->setLegend( $f_legend );
            
             // Elements
             if ( is_array( $elem ) ) {



From pclaerhout at mail.berlios.de  Wed Sep 13 18:15:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 13 Sep 2006 18:15:23 +0200
Subject: [ydf-devel] r2128 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers
Message-ID: <200609131615.k8DGFNO6008159@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-13 18:15:23 +0200 (Wed, 13 Sep 2006)
New Revision: 2128

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
Log:
Added the legend item to the form array and html output.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2006-09-13 15:25:19 UTC (rev 2127)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2006-09-13 16:15:23 UTC (rev 2128)
@@ -72,6 +72,7 @@
             $form['requirednote'] = $this->_form->_requiredNote;
             $form['endtag'] = '</form>';
             $form['name']   = $this->_form->_name;
+            $form['legend'] = $this->_form->_legend;
 
             // Add the fieldset and legend tag if any
             if ( ! empty( $this->_form->_legend ) ) {

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2006-09-13 15:25:19 UTC (rev 2127)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2006-09-13 16:15:23 UTC (rev 2128)
@@ -74,6 +74,7 @@
             unset( $form['errors'] );
             unset( $form['errors_unique_messages'] );
             unset( $form['requirednote'] );
+            unset( $form['legend'] );
 
             // Remove the form name
             if ( ! is_array( $form['name'] ) ) {



From ximian at mail.berlios.de  Thu Sep 14 10:44:11 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 10:44:11 +0200
Subject: [ydf-devel] r2129 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200609140844.k8E8iB1Y031802@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 10:43:52 +0200 (Thu, 14 Sep 2006)
New Revision: 2129

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
Log:
added alias support to YDCMPermission

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-13 16:15:23 UTC (rev 2128)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-14 08:43:52 UTC (rev 2129)
@@ -59,6 +59,9 @@
 
 			// init valid actions
 			$this->_actions = array();
+			
+			// init alias
+			$this->_actions_alias = array();
 		}
 
 
@@ -103,7 +106,7 @@
 
 				// cycle actions to compute translated string
 				foreach( $actions as $action => $info )
-					$arr_translated[ $class ][ t( "permission $class $action" ) ] = $info;
+					$arr_translated[ $class ][ t( "$class perm $action" ) ] = $info;
 			}
 			
 			return $arr_translated;
@@ -125,7 +128,7 @@
 			$this->resetAll();
 
 			// delete all permissions of correspondent userobjects
-			$this->where( 'permission_id IN ("' . implode( '","', $userobject_id ) . '")' );
+			$this->where( 'permission_id IN ("' . implode( '","', array_map( "intval", $userobject_id ) ) . '")' );
 
 			return ( $this->delete() > 0 );
 		}
@@ -168,6 +171,10 @@
          */
 		function registerAction( $class, $action ){
 
+			// check if class and action are registed
+			if ( $this->actionIsRegistered( $class, $action ) ) return false;
+
+			// add action to class
 			$this->_actions[ $class ][] = $action;
 
 			return true;
@@ -175,17 +182,104 @@
 
 
         /**
-         *  This function checks if a class+action is registered
+         *  This function registers a alias to a action
          *
+         *  @param     $alias    Action alias
          *  @param     $class    Class name
-         *  @param     $action   Action name
+         *  @param     $action   Action name (or another alias name)
          *
+         *  @returns   TRUE if added, FALSE if original class or action not valid
+         */
+		function registerAlias( $alias, $class, $action ){
+
+			// check if class exists
+			if ( ! isset( $this->_actions[ $class ] ) ) return false;
+
+			// check if action really exists and belong to the specified class
+			if ( in_array( $action, $this->_actions[ $class ] ) ){
+
+				// check if class is already created in alias array
+				if ( ! isset( $this->_actions_alias[ $class ] ) ) $this->_actions_alias[ $class ] = array();
+
+				// add alias
+				$this->_actions_alias[ $class ][ $action ][] = $alias;
+			
+				return true;
+
+			}else{
+
+				// check if $action is another alias. if yes, replace $action with original name
+				foreach( $this->_actions_alias[ $class ] as $_originalAction => $_alias )
+					if ( in_array( $action, $_alias ) ){
+				
+						// check if class is already created in alias array
+						if ( ! isset( $this->_actions_alias[ $class ] ) ) $this->_actions_alias[ $class ] = array();
+				
+						// add alias
+						$this->_actions_alias[ $class ][ $_originalAction ][] = $alias;
+					
+						return true;
+					}
+
+				return false;
+				}
+		}
+
+
+        /**
+         *  This function returns all registered alias
+         *
+         *  @param     $class    (Optional) Class name. default NULL to get alias from all classes
+         *
+         *  @returns   Associative array:  array( CLASS => array( ACTION => array( ALIAS, ALIAS, .. ) ), or array with actions and correspondent alias when class argument is defined
+         */
+		function getRegisteredAlias( $class = null ){
+
+			// check if we want actions from all classes
+			if ( is_null( $class ) ) return $this->_actions_alias;
+			
+			// check if class exists
+			if ( isset( $this->_actions_alias[ $class ] ) ) return $this->_actions_alias[ $class ];
+
+			return array();
+		}
+
+
+        /**
+         *  This function checks if a class+action is registered (searching alias too)
+         *
+         *  @param     $class    Class name
+         *  @param     $action   Action name ( or alias name)
+         *
          *  @returns   TRUE if registered, FALSE otherwise
          */
 		function actionIsRegistered( $class, $action ){
 
-			if ( isset( $this->_actions[ $class ] ) && in_array( $action, $this->_actions[ $class ] ) ) return true;
+			// check original action
+			if ( $this->getOriginalAction( $class, $action ) == false ) return false;
+			
+			return true;
+		}
 
+
+        /**
+         *  This function checks if a class+action is registered and returns the original action
+         *
+         *  @param     $class    Class name
+         *  @param     $action   Action name ( or alias name)
+         *
+         *  @returns   STRING name of real action, FALSE otherwise
+         */
+		function getOriginalAction( $class, $action ){
+
+			// check if is a registered action
+			if ( isset( $this->_actions[ $class ] ) && in_array( $action, $this->_actions[ $class ] ) ) return $action;
+
+			// check if is a registered alias
+			if ( isset( $this->_actions_alias[ $class ] ) )
+				foreach( $this->_actions_alias[ $class ] as $originalAction => $alias )
+					if ( in_array( $action, $alias ) ) return $originalAction;
+
 			return false;
 		}
 
@@ -202,7 +296,7 @@
 			// check if we want actions from all classes
 			if ( is_null( $class ) ) return $this->_actions;
 			
-			// check if action exists
+			// check if class exists
 			if ( isset( $this->_actions[ $class ] ) ) return $this->_actions[ $class ];
 
 			return array();
@@ -221,16 +315,18 @@
 		function can( $userobject_id, $class, $action ){
 
 			// check if class and action are registed
-			if ( ! isset( $this->_actions[ $class ] ) || ! in_array( $action, $this->_actions[ $class ] ) ) return false;
+			$action = $this->getOriginalAction( $class, $action );
 
+			if ( $action == false ) return false;
+
 			$this->resetAll();
-			
+
 			// try to get a row joined with userobject
 			$this->set( 'permission_id', $userobject_id );
 			$this->set( 'class', $class );
 			$this->set( 'action', $action );
 
-			return ( $this->find( 'ydcmuserobject' ) == 1 );
+			return ( $this->find( 'ydcmuserobject' ) >= 1 );
 		}
 
 }



From ximian at mail.berlios.de  Thu Sep 14 10:46:56 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 10:46:56 +0200
Subject: [ydf-devel] r2130 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage
Message-ID: <200609140846.k8E8kuq2032040@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 10:46:36 +0200 (Thu, 14 Sep 2006)
New Revision: 2130

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php
Log:
- fixed permission translations on YDCMPage

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-09-14 08:43:52 UTC (rev 2129)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-09-14 08:46:36 UTC (rev 2130)
@@ -1,7 +1,7 @@
 <?php
 // PERMISSIONS
-$GLOBALS['t']['ydcmpage_create'] = 'Create';
-$GLOBALS['t']['ydcmpage_delete'] = 'Delete';
+$GLOBALS['t']['ydcmpage perm create'] = 'Create';
+$GLOBALS['t']['ydcmpage perm delete'] = 'Delete';
 
 
 // PAGE FORM

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php	2006-09-14 08:43:52 UTC (rev 2129)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/pt.php	2006-09-14 08:46:36 UTC (rev 2130)
@@ -1,7 +1,7 @@
 <?php
 // PERMISSIONS
-$GLOBALS['t']['ydcmpage_create'] = 'Criar';
-$GLOBALS['t']['ydcmpage_delete'] = 'Eliminar';
+$GLOBALS['t']['ydcmpage perm create'] = 'Criar';
+$GLOBALS['t']['ydcmpage perm delete'] = 'Eliminar';
 
 
 // PAGE FORM



From ximian at mail.berlios.de  Thu Sep 14 11:10:42 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 11:10:42 +0200
Subject: [ydf-devel] r2131 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200609140910.k8E9Ag9Y001721@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 11:10:22 +0200 (Thu, 14 Sep 2006)
New Revision: 2131

Modified:
   YDFramework2.0/trunk/examples/cm/backend/permissions.php
Log:
updated permissions example to demonstrate 'alias' permissions

Modified: YDFramework2.0/trunk/examples/cm/backend/permissions.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-14 08:46:36 UTC (rev 2130)
+++ YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-14 09:10:22 UTC (rev 2131)
@@ -25,49 +25,88 @@
 			$this->perms->registerAction( 'YDCMPage',  'delete' );
 			$this->perms->registerAction( 'YDCMGroup', 'add' );
 			$this->perms->registerAction( 'YDCMGroup', 'edit' );
-        }
 
+            print(" We have registered the next permissions :                        <br>
+                    'YDCMPage',  'create'                                            <br>
+                    'YDCMPage',  'delete'                                            <br>
+                    'YDCMGroup', 'add'                                               <br>
+                    'YDCMGroup', 'edit'                                              <br><br>");
 
-        // Default action
-        function actionDefault() {
 
             print(" In our database we have the next permission system:              <br>
                     INSERT INTO `ydcmpermission` VALUES (2,'YDCMRootmenu','delete'); <br>
                     INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','delete');     <br>
                     INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','create');     <br>
                     INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','delete');     <br>
-                    INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','create');     ");
+                    INSERT INTO `ydcmpermission` VALUES (5,'YDCMPage','create');     <br><br>");
+        }
 
+
+        // Default action
+        function actionDefault() {
+
 			// check if userobject 2 can 'YDCMPage'+'delete'
-			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'delete' ), "$this->perms->can( 2, 'YDCMPage', 'delete' );  // check if userobject 2 can 'YDCMPage'+'delete'" );
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'delete' ), '$this->perms->can( 2, "YDCMPage", "delete" );  // check if userobject 2 can "YDCMPage"+"delete"' );
 
 			// check if userobject 5 can 'YDCMPage'+'add'
-			YDDebugUtil::dump( $this->perms->can( 5, 'YDCMPage', 'add' ), "$this->perms->can( 5, 'YDCMPage', 'add' );  // check if userobject 5 can 'YDCMPage'+'add'" );
+			YDDebugUtil::dump( $this->perms->can( 5, 'YDCMPage', 'add' ), '$this->perms->can( 5, "YDCMPage", "add" );  // check if userobject 5 can "YDCMPage"+"add"' );
 
 			// check if userobject 2 can 'YDCMRootmenu'+'delete'
-			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMRootmenu', 'delete' ), "$this->perms->can( 2, 'YDCMRootmenu', 'delete' );  // action is in DB but its NOT registered" );
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMRootmenu', 'delete' ), '$this->perms->can( 2, "YDCMRootmenu", "delete" );  // action is in DB but its NOT registered' );
 
 			// get permissions of userobject 2
-			YDDebugUtil::dump( $this->perms->getPermissions( 2 ), "$this->perms->getPermissions( 2 );" );
+			YDDebugUtil::dump( $this->perms->getPermissions( 2 ), '$this->perms->getPermissions( 2 );' );
 
 			// get translated permissions of userobject 5
-			YDDebugUtil::dump( $this->perms->getPermissions( 5, true ), "$this->perms->getPermissions( 5, true );  // translated permissions" );
+			YDDebugUtil::dump( $this->perms->getPermissions( 5, true ), '$this->perms->getPermissions( 5, true );  // translated permissions' );
 
 			// get registered system actions
-			YDDebugUtil::dump( $this->perms->getRegisteredActions(), "$this->perms->getRegisteredActions();  // get registered system actions" );
+			YDDebugUtil::dump( $this->perms->getRegisteredActions(), '$this->perms->getRegisteredActions();  // get registered system actions' );
 
 			// delete all actions of userobject 10
-			YDDebugUtil::dump( $this->perms->deletePermissions( 10 ), "$this->perms->deletePermissions( 10 );  // try to delete all permissions of userobject 10. userobject do NOT exist" );
+			YDDebugUtil::dump( $this->perms->deletePermissions( 10 ), '$this->perms->deletePermissions( 10 );  // try to delete all permissions of userobject 10. userobject do NOT exist' );
 
 			// add permission 'YDCMPage'+'create' to userobject 8
-			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'create' ), "$this->perms->addPermission( 8, 'YDCMPage', 'create' );  // add permission 'YDCMPage'+'create' to userobject 8" );
+			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'create' ), '$this->perms->addPermission( 8, "YDCMPage", "create" );  // add permission "YDCMPage"+"create" to userobject 8' );
 
 			// add permission 'YDCMPage'+'publish' to userobject 8
-			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'publish' ), "$this->perms->addPermission( 8, 'YDCMPage', 'publish' );  // 'YDCMPage'+'publish' is not registered" );
+			YDDebugUtil::dump( $this->perms->addPermission( 8, 'YDCMPage', 'publish' ), '$this->perms->addPermission( 8, "YDCMPage", "publish" );  // "YDCMPage"+"publish" is not registered' );
 		}
 
 
+		function actionAlias(){
+		
+            print(" Alias registered :                       <br>
+                    'createcontent' => 'YDCMPage', 'create'  <br>
+                    'justdelete'    => 'YDCMPage', 'delete'  <br><br>");
 
+			// register some alias
+			$this->perms->registerAlias( 'createcontent', 'YDCMPage', 'create' );
+			$this->perms->registerAlias( 'justdelete',    'YDCMPage', 'delete' );
+
+
+			// check if userobject 2 can 'YDCMPage'+'delete'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'delete' ), '$this->perms->can( 2, "YDCMPage", "delete" );  // check if userobject 2 can "YDCMPage"+"delete"' );
+
+			// check if userobject 2 can 'YDCMPage'+'justdelete'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'justdelete' ), '$this->perms->can( 2, "YDCMPage", "justdelete" );  // check if userobject 2 can "YDCMPage"+"justdelete"' );
+
+
+			// add a new alias that point to an alias :)
+            print(" Added new alias (points to a valid alias) :      <br>
+                    'mycustomdelete'    => 'YDCMPage', 'justdelete'  <br><br>");
+
+			$this->perms->registerAlias( 'mycustomdelete', 'YDCMPage', 'justdelete' );
+
+			// check if userobject 2 can 'YDCMPage'+'mycustomdelete'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'mycustomdelete' ), '$this->perms->can( 2, "YDCMPage", "mycustomdelete" );  // check if userobject 2 can "YDCMPage"+"mycustomdelete"' );
+
+
+			// get all registered alias
+			YDDebugUtil::dump( $this->perms->getRegisteredAlias(), '$this->perms->getRegisteredAlias();  // get all registered alias' );
+		}
+
+
     }
 
     // Process the request



From ximian at mail.berlios.de  Thu Sep 14 11:12:24 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 11:12:24 +0200
Subject: [ydf-devel] r2132 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200609140912.k8E9CO2o001892@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 11:12:07 +0200 (Thu, 14 Sep 2006)
New Revision: 2132

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
Log:
- user editing/creation now uses a selectimage form element for template (instead of a simple select)

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 09:10:22 UTC (rev 2131)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 09:12:07 UTC (rev 2132)
@@ -92,7 +92,7 @@
          *  @param $username  User username
          *  @param $password  User password (if password length is smaller than 32 we must md5 it, password form elements must have max 31)
          *
-         *  @returns    user_id if valid, false otherwise
+         *  @returns    ARRAY with user attributes, FALSE otherwise
          */
 		function valid( $username = '', $password = '' ){
 
@@ -122,9 +122,9 @@
 			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
 
 			// test if we get just one user
-			if ( $this->find( 'ydcmuserobject' ) == 1 ) return intval( $this->get( 'user_id' ) );
-
-			return false;
+			if ( $this->find( 'ydcmuserobject' ) != 1 ) return false;
+			
+			return $this->getValues();
 		}
 
 
@@ -174,8 +174,10 @@
 		 *
 		 * @param $id           User id to edit
 		 * @param $noneditable  (Optional) Array with form element names that are NOT editable (are spans).
+         *
+		 * @returns    YDForm object pointer         
          */
-		function addFormEdit( $id, $noneditable = array() ){
+		function & addFormEdit( $id, $noneditable = array() ){
 
 		 	return $this->_addFormDetails( $id, true, $noneditable );
 		}
@@ -185,8 +187,10 @@
          *  This method adds form elements for addind a new user
 		 *
 		 * @param $id    Group id of this new user
+         *
+		 * @returns    YDForm object pointer         
          */
-		function addFormNew( $id ){
+		function & addFormNew( $id ){
 
 		 	return $this->_addFormDetails( $id, false );
 		}
@@ -198,10 +202,11 @@
 		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
          *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
 		 * @param $edit         The edit parameter
+		 * @param $noneditable  Array with form element names that are NOT editable
          *
-		 * @param $noneditable  Array with form element names that are NOT editable
-         */
-		function _addFormDetails( $id, $edit, $noneditable = array() ){
+		 * @returns    YDForm object pointer         
+		 */
+		function & _addFormDetails( $id, $edit, $noneditable = array() ){
 
 			YDInclude( 'YDForm.php' );
 
@@ -251,8 +256,12 @@
 				$this->_form->addElement( 'select',    'lang_id',       t( 'ydcmuser label language' ), array(), $languages );
 
 				$templates = new YDCMTemplates();
-    	        $this->_form->addElement( 'select',    'template',      t( 'ydcmuser label template' ), array(), $templates->admin_templates() );
 
+				// get url to templates and set shot.png as filename
+				$attributes = array( 'border' => 1, 'src' => YDConfig::get( 'YDCMTEMPLATES_ADMIN_URL' ), 'ext' => '/shot.png' );
+
+    	        $this->_form->addElement( 'selectimage',    'template', t( 'ydcmuser label template' ), $attributes, $templates->admin_templates() );
+
 				$this->_form->addRule( 'name',        'maxlength',      t( 'ydcmuser mess name too big' ),  255 );
 				$this->_form->addRule( 'email',       'email',          t( 'ydcmuser mess email not valid' ) );
 				$this->_form->addRule( 'other',       'maxlength',      t( 'ydcmuser mess other too big' ), 5000 );
@@ -286,6 +295,8 @@
 					$this->_form->setDefault( 'login_end', time() + 7 * 24 * 3600 );
 			}
 
+
+			return $this->_form;
 		}
 
         /**
@@ -445,8 +456,10 @@
          * @param $oldpassword  (Optional) Flag the defines if we should include a box with old password confirmation.
          *                                 This box is used when the user wants to change its pass and not when we want to change another user pass
          *                                 TRUE: include box; FALSE: don't include
+         *
+         * @returns YDForm object pointer
          */
-		function addFormPassword( $oldpassword = true ){
+		function & addFormPassword( $oldpassword = true ){
 
 			YDInclude( 'YDForm.php' );
 
@@ -467,6 +480,8 @@
 
 			// add compare rule to new password and confirmation password
 			$this->_form->addCompareRule( array( 'new', 'new_confirm' ), 'equal', t('passwords dont match') );
+
+			return $this->_form;
 		}
 
 



From ximian at mail.berlios.de  Thu Sep 14 11:15:20 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 11:15:20 +0200
Subject: [ydf-devel] r2133 - in YDFramework2.0/trunk/examples/cm: .
	backend/templates/default backend/templates/green
	backend/templates/orange
Message-ID: <200609140915.k8E9FK9x002114@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 11:14:27 +0200 (Thu, 14 Sep 2006)
New Revision: 2133

Added:
   YDFramework2.0/trunk/examples/cm/backend/templates/default/shot.png
   YDFramework2.0/trunk/examples/cm/backend/templates/green/shot.png
   YDFramework2.0/trunk/examples/cm/backend/templates/orange/shot.png
Modified:
   YDFramework2.0/trunk/examples/cm/cm.php
Log:
- added YDConfig parameter to cm.php that defines the url path to template screenshots.

Added: YDFramework2.0/trunk/examples/cm/backend/templates/default/shot.png
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/cm/backend/templates/default/shot.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/cm/backend/templates/green/shot.png
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/cm/backend/templates/green/shot.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/cm/backend/templates/orange/shot.png
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/cm/backend/templates/orange/shot.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: YDFramework2.0/trunk/examples/cm/cm.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.php	2006-09-14 09:12:07 UTC (rev 2132)
+++ YDFramework2.0/trunk/examples/cm/cm.php	2006-09-14 09:14:27 UTC (rev 2133)
@@ -4,14 +4,17 @@
     include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
 
 	YDInclude( 'YDDatabase.php' );
+	YDInclude( 'YDUrl.php' );
 
-    // set YDDatabase instance connection
+    // BASIC CONFIGURATION: set YDDatabase instance connection
     YDDatabase::registerInstance( 'default', 'mysql', 'xpto', 'root', '', 'localhost' );
 
-	// set portal language. Currently you can user 'en' and 'pt'.
+    // BASIC CONFIGURATION: set portal language. Currently you can use 'en' and 'pt'.
 	YDLocale::set( 'en' );
 
+
 	// set admin template path
 	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', dirname( __FILE__ ) . '/backend/templates' );
 
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_URL', YDUrl::makeLinkAbsolute( './templates' ) );
 ?>



From pclaerhout at mail.berlios.de  Thu Sep 14 12:16:40 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 14 Sep 2006 12:16:40 +0200
Subject: [ydf-devel] r2134 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609141016.k8EAGe80012302@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-14 12:16:40 +0200 (Thu, 14 Sep 2006)
New Revision: 2134

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added support for session only cookies.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-14 09:14:27 UTC (rev 2133)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-14 10:16:40 UTC (rev 2134)
@@ -575,9 +575,12 @@
          *
          *  @param  $name       The name of the cookie to set.
          *  @param  $value      The value to set for the cookie.
+         *  @param  $sessionOnly    (optional) If set to true, the cookie is only set for the current session,
+         *                          otherwise, the default cookie lifetime is used.
          */
-        function setCookie( $name, $value ) {
-            setcookie( $name, $value, $this->cookieLifeTime, $this->cookiePath );
+        function setCookie( $name, $value, $sessionOnly=false ) {
+            $lifeTime = ( $sessionOnly ) ? 0 : $this->cookieLifeTime;
+            setcookie( $name, $value, $lifeTime, $this->cookiePath );
         }
 
         /**



From pclaerhout at mail.berlios.de  Thu Sep 14 12:24:48 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 14 Sep 2006 12:24:48 +0200
Subject: [ydf-devel] r2135 - YDFramework2.0/trunk/examples
Message-ID: <200609141024.k8EAOm3o013266@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-14 12:24:48 +0200 (Thu, 14 Sep 2006)
New Revision: 2135

Modified:
   YDFramework2.0/trunk/examples/database_tree.php
Log:
Updated the instructions to add a position field.

See also: [ Bug #8786 ] 'position' column required in database_tree.php

Modified: YDFramework2.0/trunk/examples/database_tree.php
===================================================================
--- YDFramework2.0/trunk/examples/database_tree.php	2006-09-14 10:16:40 UTC (rev 2134)
+++ YDFramework2.0/trunk/examples/database_tree.php	2006-09-14 10:24:48 UTC (rev 2135)
@@ -13,6 +13,7 @@
             nleft int(11) NOT NULL default '0',
             nright int(11) NOT NULL default '0',
             nlevel int(11) NOT NULL default '0',
+            position int(11) NOT NULL default '0',
             PRIMARY KEY  (id),
             KEY nested_tree_parent_id (parent_id),
             KEY nested_tree_nleft (nleft),
@@ -22,35 +23,35 @@
         // =============================================================================================================
 
         // ==== Default values for testing =============================================================================
-        INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1);
-        INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2);
-        INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2);
-        INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2);
-        INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3);
-        INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3);
-        INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3);
-        INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2);
-        INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3);
-        INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3);
-        INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3);
+        INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0);
+        INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0);
+        INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0);
+        INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0);
+        INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0);
+        INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0);
+        INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0);
+        INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0);
+        INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0);
+        INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0);
+        INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0);
         // =============================================================================================================
 
         // ==== Sample data dump =======================================================================================
-        +----+-----------+----------------------+-------+--------+--------+
-        | id | parent_id | title                | nleft | nright | nlevel |
-        +----+-----------+----------------------+-------+--------+--------+
-        |  1 |         0 | General Resources    |     1 |     22 |      1 |
-        |  2 |         1 | Code Paste           |     2 |      3 |      2 |
-        |  3 |         1 | Documentation        |     4 |      5 |      2 |
-        |  4 |         1 | Books & Publications |     6 |     13 |      2 |
-        |  5 |         4 | Apache               |     7 |      8 |      3 |
-        |  6 |         4 | PostgreSQL           |     9 |     10 |      3 |
-        |  7 |         4 | MySQL                |    11 |     12 |      3 |
-        |  8 |         1 | Links                |    14 |     21 |      2 |
-        |  9 |         8 | Databases            |    15 |     16 |      3 |
-        | 10 |         8 | Generators           |    17 |     18 |      3 |
-        | 11 |         8 | Portals              |    19 |     20 |      3 |
-        +----+-----------+----------------------+-------+--------+--------+
+        +----+-----------+----------------------+-------+--------+--------+----------+
+        | id | parent_id | title                | nleft | nright | nlevel | position |
+        +----+-----------+----------------------+-------+--------+--------+----------+
+        |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |
+        |  2 |         1 | Code Paste           |     2 |      3 |      2 |        0 |
+        |  3 |         1 | Documentation        |     4 |      5 |      2 |        0 |
+        |  4 |         1 | Books & Publications |     6 |     13 |      2 |        0 |
+        |  5 |         4 | Apache               |     7 |      8 |      3 |        0 |
+        |  6 |         4 | PostgreSQL           |     9 |     10 |      3 |        0 |
+        |  7 |         4 | MySQL                |    11 |     12 |      3 |        0 |
+        |  8 |         1 | Links                |    14 |     21 |      2 |        0 |
+        |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |
+        | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |
+        | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |
+        +----+-----------+----------------------+-------+--------+--------+----------+
         // =============================================================================================================
 
     */



From ximian at mail.berlios.de  Thu Sep 14 15:42:46 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 15:42:46 +0200
Subject: [ydf-devel] r2136 - YDFramework2.0/trunk/examples
Message-ID: <200609141342.k8EDgk8W023686@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 15:42:23 +0200 (Thu, 14 Sep 2006)
New Revision: 2136

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
- a better examples/index.tpl about YDCMComponent
- added YDPermission alias link in examples/index.tpl

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-09-14 10:24:48 UTC (rev 2135)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-09-14 13:42:23 UTC (rev 2136)
@@ -4,7 +4,6 @@
 <head>
 
     <title>{$YD_FW_NAMEVERS}</title>
-
     {literal}<style>
         td { border-bottom: 1px solid #FFCC00; }
         P,TD,LI,INPUT,SELECT,TEXTAREA{background-color:#FFE9A6;font:13px/1.3 Verdana}
@@ -715,22 +714,27 @@
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/functions.php">ajax/functions.php</a> </td>
         </tr>
         <tr>
-          <td colspan="2"><b>&nbsp;<br/>
-            YDCMComponent: Content Management</b></td>
-          <td><b>&nbsp;</b></td>
-        </tr>
+          <td colspan="3"><b>&nbsp;<br/>
+            YDCMComponent: Content Management</b><b>&nbsp;components</b></td>
+          </tr>
         <tr>
-          <td valign="top" rowspan="6">&nbsp;</td>
-          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/instructions.txt">Instructions (database and configuration) </a></td>
-          <td valign="top">&nbsp;</td>
-        </tr>
+          <td valign="top" rowspan="5">&nbsp;</td>
+          <td colspan="2" valign="top"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
+              <tr>
+                <td nowrap style="border-bottom: 0px">Instructions: </td>
+                <td style="border-bottom: 0px"><ol>
+                  <li>Create a mySQL database </li>
+                  <li>Create your database structure using <a href="{$YD_SELF_SCRIPT}?do=source&id=cm/cm.sql" target="_blank">this SQL file</a> <span style="font-size: 9px">(examples/cm/cm.sql)</span></li>
+                  <li>Edit database connection in <a href="{$YD_SELF_SCRIPT}?do=source&id=cm/cm.php" target="_blank">this configuration file</a> <span style="font-size: 9px">(examples/cm/cm.php)</span></li>
+                </ol></td>
+              </tr>
+            </table>            </td>
+          </tr>
         <tr>
-          <td colspan="2" valign="top">&nbsp;</td>
+          <td colspan="2" valign="top"><br>
+          <strong>Backend examples</strong></td>
         </tr>
         <tr>
-          <td colspan="2" valign="top"><strong>Backend examples</strong></td>
-        </tr>
-        <tr>
           <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php">User management ( how to get details )</a><br>
 &nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php?do=edit">User management ( edit a user )</a><br>
 &nbsp;&nbsp;&nbsp;<a href="cm/backend/userdetails.php?do=new">User management ( add a new user )</a><br/></td>
@@ -744,6 +748,7 @@
         </tr>
         <tr>
           <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php">Permissions ( register, check, add, delete )</a><br>
+            &nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php?do=alias">Permissions ( using alias )</a><br>
           </td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/permissions.php">cm/backend/permissions.php</a> </td>
           </tr>



From ximian at mail.berlios.de  Thu Sep 14 15:49:20 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 15:49:20 +0200
Subject: [ydf-devel] r2137 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200609141349.k8EDnKEk024462@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 15:49:02 +0200 (Thu, 14 Sep 2006)
New Revision: 2137

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
Log:
- a template screenshot extension can be now set as a YDConfig.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 13:42:23 UTC (rev 2136)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 13:49:02 UTC (rev 2137)
@@ -33,6 +33,8 @@
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUser/' );
 
+	YDConfig::set( 'YDCMTEMPLATES_ADMIN_EXT', '/shot.png', false );
+
 	// add YDF libs needed by this class
 	YDInclude( 'YDDatabaseObject.php' );
 	YDInclude( 'YDValidateRules.php' );
@@ -258,7 +260,7 @@
 				$templates = new YDCMTemplates();
 
 				// get url to templates and set shot.png as filename
-				$attributes = array( 'border' => 1, 'src' => YDConfig::get( 'YDCMTEMPLATES_ADMIN_URL' ), 'ext' => '/shot.png' );
+				$attributes = array( 'border' => 1, 'src' => YDConfig::get( 'YDCMTEMPLATES_ADMIN_URL' ), 'ext' => 	YDConfig::get( 'YDCMTEMPLATES_ADMIN_EXT' ) );
 
     	        $this->_form->addElement( 'selectimage',    'template', t( 'ydcmuser label template' ), $attributes, $templates->admin_templates() );
 



From pclaerhout at mail.berlios.de  Thu Sep 14 16:11:26 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 14 Sep 2006 16:11:26 +0200
Subject: [ydf-devel] r2138 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609141411.k8EEBQ2O028717@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-14 16:11:25 +0200 (Thu, 14 Sep 2006)
New Revision: 2138

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
$_SERVER['PATH_TRANSLATED'] is now only used for YD_SELF_FILE if it's a file. If not,  $_SERVER['SCRIPT_FILENAME'] is used instead.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-14 13:49:02 UTC (rev 2137)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-14 14:11:25 UTC (rev 2138)
@@ -67,7 +67,7 @@
 
     // File and URL constants
     @define( 'YD_SELF_SCRIPT', $_SERVER['PHP_SELF'] );
-    if ( isset( $_SERVER['PATH_TRANSLATED'] ) ) {
+    if ( isset( $_SERVER['PATH_TRANSLATED'] ) && is_file( $_SERVER['PATH_TRANSLATED'] ) ) {
         @define( 'YD_SELF_FILE', $_SERVER['PATH_TRANSLATED'] );
     } else {
         @define( 'YD_SELF_FILE', $_SERVER['SCRIPT_FILENAME'] );



From pclaerhout at mail.berlios.de  Thu Sep 14 16:14:29 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 14 Sep 2006 16:14:29 +0200
Subject: [ydf-devel] r2139 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609141414.k8EEETaU029356@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-14 16:14:28 +0200 (Thu, 14 Sep 2006)
New Revision: 2139

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
Log:
Disabled debugging in YDHttpClient as it was cluttering the output too much.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2006-09-14 14:11:25 UTC (rev 2138)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2006-09-14 14:14:28 UTC (rev 2139)
@@ -57,7 +57,7 @@
             } else {
                 $this->useGzip( false );
             }
-            $this->setDebug( YDConfig::get( 'YD_DEBUG' ) );
+            //$this->setDebug( YDConfig::get( 'YD_DEBUG' ) );
 
         }
 



From ximian at mail.berlios.de  Thu Sep 14 16:42:27 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 16:42:27 +0200
Subject: [ydf-devel] r2140 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200609141442.k8EEgRGM001411@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 16:42:05 +0200 (Thu, 14 Sep 2006)
New Revision: 2140

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
Log:
- new feature: YDCMPermission can accept always registered permissions.
This means that can be set permissions that return always TRUE.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-14 14:14:28 UTC (rev 2139)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-09-14 14:42:05 UTC (rev 2140)
@@ -62,6 +62,9 @@
 			
 			// init alias
 			$this->_actions_alias = array();
+			
+			// init always-valid actions
+			$this->_always_valid = array();
 		}
 
 
@@ -182,6 +185,45 @@
 
 
         /**
+         *  This function registers an always-valid action
+         *
+         *  @param     $class    Class name
+         *  @param     $action   Action name
+         *
+         *  @returns   TRUE if added, FALSE is already exists
+         */
+		function registerAlwaysValidAction( $class, $action ){
+
+			// check if class and action are registed
+			if ( $this->actionIsRegistered( $class, $action ) ) return false;
+
+			// add action to class
+			$this->_always_valid[ $class ][] = $action;
+
+			return true;
+		}
+
+
+        /**
+         *  This function returns all always valid actions
+         *
+         *  @param     $class    (Optional) Class name. default NULL to get alias from all classes
+         *
+         *  @returns   Associative array:  array( CLASS => array( ACTION => array( ALIAS, ALIAS, .. ) ), or array with actions and correspondent alias when class argument is defined
+         */
+		function getRegisterAlwaysValidActions( $class = null ){
+
+			// check if we want actions from all classes
+			if ( is_null( $class ) ) return $this->_always_valid;
+			
+			// check if class exists
+			if ( isset( $this->_always_valid[ $class ] ) ) return $this->_always_valid[ $class ];
+
+			return array();
+		}
+
+
+        /**
          *  This function registers a alias to a action
          *
          *  @param     $alias    Action alias
@@ -255,9 +297,12 @@
          */
 		function actionIsRegistered( $class, $action ){
 
-			// check original action
+			// check always valid action
+			if ( isset( $this->_always_valid[ $class ] ) && in_array( $action, $this->_always_valid ) ) return true;
+
+			// check original action ( searching original actions and alias )
 			if ( $this->getOriginalAction( $class, $action ) == false ) return false;
-			
+
 			return true;
 		}
 
@@ -314,6 +359,9 @@
          */
 		function can( $userobject_id, $class, $action ){
 
+			// check if class is an 'always registered'
+			if ( isset( $this->_always_valid[ $class ] ) && in_array( $action, $this->_always_valid[ $class ] ) ) return true;
+
 			// check if class and action are registed
 			$action = $this->getOriginalAction( $class, $action );
 



From ximian at mail.berlios.de  Thu Sep 14 16:43:32 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 16:43:32 +0200
Subject: [ydf-devel] r2141 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200609141443.k8EEhWcs001598@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 16:43:13 +0200 (Thu, 14 Sep 2006)
New Revision: 2141

Modified:
   YDFramework2.0/trunk/examples/cm/backend/permissions.php
Log:
- added 'always registered actions' example in examples/permissions.php file

Modified: YDFramework2.0/trunk/examples/cm/backend/permissions.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-14 14:42:05 UTC (rev 2140)
+++ YDFramework2.0/trunk/examples/cm/backend/permissions.php	2006-09-14 14:43:13 UTC (rev 2141)
@@ -107,6 +107,19 @@
 		}
 
 
+		function actionAlwaysRegistered(){
+
+            print(" Registered 'always valid' permissions    <br>
+                    'YDCMPage', 'closeit'                    <br><br>");
+
+			// register some always registered
+			$this->perms->registerAlwaysValidAction( 'YDCMPage', 'closeit' );
+
+			// check if userobject 2 can 'YDCMPage'+'closeit'
+			YDDebugUtil::dump( $this->perms->can( 2, 'YDCMPage', 'closeit' ), '$this->perms->can( 2, "YDCMPage", "closeit" );  // check if userobject 2 can "YDCMPage"+"closeit"' );
+
+		}
+
     }
 
     // Process the request



From ximian at mail.berlios.de  Thu Sep 14 16:46:08 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 16:46:08 +0200
Subject: [ydf-devel] r2142 - YDFramework2.0/trunk/examples
Message-ID: <200609141446.k8EEk8vd002075@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 16:45:48 +0200 (Thu, 14 Sep 2006)
New Revision: 2142

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
- updated examples/index.tpl for 'always registered' permissions

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-09-14 14:43:13 UTC (rev 2141)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-09-14 14:45:48 UTC (rev 2142)
@@ -749,6 +749,7 @@
         <tr>
           <td valign="top">&nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php">Permissions ( register, check, add, delete )</a><br>
             &nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php?do=alias">Permissions ( using alias )</a><br>
+            &nbsp;&nbsp;&nbsp;<a href="cm/backend/permissions.php?do=alwaysRegistered">Permissions ( always registered actions )</a><br>
           </td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=cm/backend/permissions.php">cm/backend/permissions.php</a> </td>
           </tr>



From ximian at mail.berlios.de  Thu Sep 14 18:31:37 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 18:31:37 +0200
Subject: [ydf-devel] r2143 - in
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent: .
	languages/YDCMUser
Message-ID: <200609141631.k8EGVbGQ025609@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 18:31:15 +0200 (Thu, 14 Sep 2006)
New Revision: 2143

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php
Log:
- no YDCMUser:
  * now displays the group selectbox if the group is not defined when creating a new user
  * it's not reguired to hardcore the group again when saving the editing form

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 14:45:48 UTC (rev 2142)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-09-14 16:31:15 UTC (rev 2143)
@@ -181,6 +181,8 @@
          */
 		function & addFormEdit( $id, $noneditable = array() ){
 
+			$this->editing_ID = $id;
+
 		 	return $this->_addFormDetails( $id, true, $noneditable );
 		}
 
@@ -188,27 +190,27 @@
         /**
          *  This method adds form elements for addind a new user
 		 *
-		 * @param $id    Group id of this new user
+		 * @param $id    (Optional) Predefined-Group_id of this new user
          *
 		 * @returns    YDForm object pointer         
          */
-		function & addFormNew( $id ){
+		function & addFormNew( $id = null ){
 
-		 	return $this->_addFormDetails( $id, false );
+		 	return $this->_addFormDetails( $id, false, array() );
 		}
 		 
 		
         /**
          *  Helper method for user management
 		 *
-		 * @param $id           If you will EDIT some user this is the user id to edit. On $edit (next argument) you must set TRUE
-         *                      If you will ADD a new user this is the parent id of the new user. On $edit (next argument) you must set FALSE
-		 * @param $edit         The edit parameter
+		 * @param $id           If you will EDIT some user this is the user id to edit.
+         *                      If you will ADD a new user this is the group id (parent_id) of the new user.
+		 * @param $edit         The edit parameter. TRUE if form is form editing, FALSE if form is for a new user creation
 		 * @param $noneditable  Array with form element names that are NOT editable
          *
 		 * @returns    YDForm object pointer         
 		 */
-		function & _addFormDetails( $id, $edit, $noneditable = array() ){
+		function & _addFormDetails( $id, $edit, $noneditable ){
 
 			YDInclude( 'YDForm.php' );
 
@@ -289,6 +291,14 @@
 
 			}else{
 
+				// if id argument is not set its because we want a select box (with groups) so choose
+				if ( is_null( $id ) ){
+				
+					// get groups from userobject
+					$obj = new YDCMUserobject();
+					$this->_form->addElement( 'select', 'group', t( 'ydcmuser label group' ), array(), $obj->getElements( 'YDCMGroup', 'reference' ) );
+				}					
+
 				// add submit button
 				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmuser label new' ) );
 
@@ -323,15 +333,17 @@
         /**
          *  This method updates user attributes
          *
-         *  @param $id           User id to save attributes
+         *  @param $id           (Optional) User id to force saving
          *  @param $formvalues   (Optional) Custom array with user attributes
          *
          *  @returns    YDResult object. OK      - form updated
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to update
          */
-		function saveFormEdit( $id, $formvalues = null ){
+		function saveFormEdit( $id = null, $formvalues = null ){
 
+			if ( is_null( $id ) ) $id = $this->editing_ID;
+
 			return $this->_saveFormDetails( $id, true, $formvalues );
 		}
 
@@ -339,14 +351,14 @@
         /**
          *  This method adds a new user
          *
-         *  @param $parent_id    Parent id of this new user
+         *  @param $parent_id    (Optional) Group id (parent_id) of this new user
          *  @param $formvalues   (Optional) Custom array with user attributes
          *
          *  @returns    YDResult object. OK      - form added
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to add
          */
-		function saveFormNew( $parent_id, $formvalues = null ){
+		function saveFormNew( $parent_id = null, $formvalues = null ){
 
 			return $this->_saveFormDetails( $parent_id, false, $formvalues );
 		}
@@ -410,15 +422,18 @@
 
 			}else{
 
+				// check if parent it is set in argument or was choosen in the group selectbox
+				if ( is_null( $id ) ) $id = $values[ 'group' ];
+
 				// create userobject node
 				$userobject = array();
 				$userobject['type']      = 'YDCMUser';
 				$userobject['reference'] = $values[ 'name' ];
 				$userobject['state']     = isset( $values[ 'state' ] ) ? $values[ 'state' ] : 0;
-				
-				// update userobject and get new id
+
+				// insert a new node in userobject and get the new id for user row creation
 				$uobj = new YDCMUserobject();
-				$res  = $uobj->addNode( $userobject, $id );
+				$res = $uobj->addNode( $userobject, intval( $id ) );
 
 				// create user row
 				$user = array();

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-14 14:45:48 UTC (rev 2142)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-09-14 16:31:15 UTC (rev 2143)
@@ -181,5 +181,27 @@
 		}
 
 
+        /**
+         *  This method returns an associative array 
+         *
+         *  @param $type       Node type
+         *  @param $attribute  (Optional) Attribute name or (array of attributes) to get only
+         *
+         *  @returns    Associative array
+         */
+		function getElements( $type, $attributes = array() ){
+
+			$this->resetAll();
+
+			// set user id
+			$this->set( 'type', $type );
+
+			// get all attributes
+			$this->find();
+
+			return $this->getResultsAsAssocArray( 'userobject_id', $attributes );
+		}
+
+
     }
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-09-14 14:45:48 UTC (rev 2142)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-09-14 16:31:15 UTC (rev 2143)
@@ -12,6 +12,7 @@
 $GLOBALS['t']['ydcmuser label name'] = 'Name';
 $GLOBALS['t']['ydcmuser label email'] = 'Email';
 $GLOBALS['t']['ydcmuser label other'] = 'Other';
+$GLOBALS['t']['ydcmuser label group'] = 'Group';
 $GLOBALS['t']['ydcmuser label language'] = 'Language';
 $GLOBALS['t']['ydcmuser label template'] = 'Template';
 $GLOBALS['t']['ydcmuser label state'] = 'Login';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php	2006-09-14 14:45:48 UTC (rev 2142)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/pt.php	2006-09-14 16:31:15 UTC (rev 2143)
@@ -12,6 +12,7 @@
 $GLOBALS['t']['ydcmuser label name'] = 'Nome';
 $GLOBALS['t']['ydcmuser label email'] = 'Email';
 $GLOBALS['t']['ydcmuser label other'] = 'Outras informa&ccedil;&otilde;es';
+$GLOBALS['t']['ydcmuser label group'] = 'Grupo';
 $GLOBALS['t']['ydcmuser label language'] = 'Idioma';
 $GLOBALS['t']['ydcmuser label template'] = 'Template';
 $GLOBALS['t']['ydcmuser label state'] = 'Login';



From ximian at mail.berlios.de  Thu Sep 14 18:33:08 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 14 Sep 2006 18:33:08 +0200
Subject: [ydf-devel] r2144 - YDFramework2.0/trunk/examples/cm/backend
Message-ID: <200609141633.k8EGX8VF030356@sheep.berlios.de>

Author: ximian
Date: 2006-09-14 18:32:56 +0200 (Thu, 14 Sep 2006)
New Revision: 2144

Modified:
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
Log:
- updated YDCM user example: creating and editing a user with YDCMUser is extremely simple now! Simpler is impossible :)

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-14 16:31:15 UTC (rev 2143)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-09-14 16:32:56 UTC (rev 2144)
@@ -21,7 +21,7 @@
         }
 
 
-        // Default action (that shows user details form with some editable fields)
+        // Default action (that shows user details)
         function actionDefault() {
 
 			// get user 6 
@@ -41,17 +41,14 @@
         // Edit user example
         function actionEdit() {
 
-			// add editing form defaults of userobject 6
-			$this->users->addFormEdit( 6 );
+			// create editing form of userobject 6
+			$form = & $this->users->addFormEdit( 6 );
 
-			// get form
-			$form = & $this->users->getForm();
-
 			// if form is not submitted just show it
 			if ( ! $form->isSubmitted() ) return $form->display();
 
-			// update user 6 with submitted information, magic isn't it ;)
-			$result = $this->users->saveFormEdit( 6 );
+			// update user with submitted information, magic isn't it ;)
+			$result = $this->users->saveFormEdit();
 
 			// print result message
 			if ( $result->ok ) print( 'OK: ' . $result->message );
@@ -62,20 +59,17 @@
         }
 
 
-		// this action will add a new sub-user of the root (super-administrator: id 100)
+		// this action will add a new user
 		function actionNew(){
 
-			// add form for adding a new user to group 2
-			$this->users->addFormNew( 2 );
+			// create form for adding a new user
+			$form = & $this->users->addFormNew();
 
-			// get form
-			$form = & $this->users->getForm();
-
 			// if form is not submitted just show it
 			if ( ! $form->isSubmitted() ) return $form->display();
 
-			// add user to group 2
-			$result = $this->users->saveFormNew( 2 );
+			// add user
+			$result = $this->users->saveFormNew();
 			
 			// print result message
 			if ( $result->ok ) print( 'OK: ' . $result->message );



From pclaerhout at mail.berlios.de  Fri Sep 15 15:44:12 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 15 Sep 2006 15:44:12 +0200
Subject: [ydf-devel] r2145 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609151344.k8FDiCAf000937@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-15 15:44:12 +0200 (Fri, 15 Sep 2006)
New Revision: 2145

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added an option to the functions that return the value of a query parameter to specify if the keys or values of the values array should be used.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-14 16:32:56 UTC (rev 2144)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-15 13:44:12 UTC (rev 2145)
@@ -85,15 +85,17 @@
         /**
          *  Get the value of a query string variable.
          *
-         *  @param  $name    The name of the query string variable.
-         *  @param  $default (optional) The default value if the query string variable is not existing.
-         *  @param  $values  (optional) The allowed values as an array.
+         *  @param  $name       The name of the query string variable.
+         *  @param  $default    (optional) The default value if the query string variable is not existing.
+         *  @param  $values     (optional) The allowed values as an array.
+         *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
          *
          *  @returns    The value of the query string variable as a string.
          */
-        function getQueryStringParameter( $name, $default='', $values=null ) {
+        function getQueryStringParameter( $name, $default='', $values=null, $use_keys=false ) {
             if ( isset( $_GET[$name] ) ) {
                 if ( ! is_null( $values ) ) {
+                    $values = $use_keys ? array_keys( $values ) : array_values( $values );;
                     if ( in_array( $_GET[$name], $values ) ) {
                         return $_GET[$name];
                     } else {
@@ -113,11 +115,12 @@
          *  @param  $name    The name of the query string variable.
          *  @param  $default (optional) The default value if the query string variable is not existing.
          *  @param  $values  (optional) The allowed values as an array.
+         *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
          *
          *  @returns    The value of the query string variable as an integer.
          */
-        function getQueryStringParameterAsInt( $name, $default=null, $values=null ) {
-            $value = $this->getQueryStringParameter( $name, $default, $values );
+        function getQueryStringParameterAsInt( $name, $default=null, $values=null, $use_keys=false ) {
+            $value = $this->getQueryStringParameter( $name, $default, $values, $use_keys );
             return is_numeric( $value ) ? intval( $value ) : $default;
         }
 
@@ -129,11 +132,12 @@
          *  @param  $default            (optional) The default value if the query string variable is not existing.
          *  @param  $values             (optional) The allowed values as an array.
          *  @param  $action_if_fails    (optional) The action to redirect of if the parameter is invalid.
+         *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
          *
          *  @returns    The value of the query string variable as a string.
          */
-        function getRequiredQueryStringParameter( $name, $default, $values=null, $action_if_fails='default' ) {
-            $result = $this->getQueryStringParameter( $name, $default, $values );
+        function getRequiredQueryStringParameter( $name, $default, $values=null, $action_if_fails='default', $use_keys=false ) {
+            $result = $this->getQueryStringParameter( $name, $default, $values, $use_keys );
             if ( empty( $result ) ) {
                 $this->redirectToAction( $action_if_fails );
             } else {



From pclaerhout at mail.berlios.de  Fri Sep 15 21:39:29 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 15 Sep 2006 21:39:29 +0200
Subject: [ydf-devel] r2146 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609151939.k8FJdTTi005260@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-15 21:39:29 +0200 (Fri, 15 Sep 2006)
New Revision: 2146

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
The YDLocale::set function no longer clears the $GLOBALS['t'] array if it exists already.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-15 13:44:12 UTC (rev 2145)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-15 19:39:29 UTC (rev 2146)
@@ -485,7 +485,9 @@
             YDConfig::set( YD_LOCALE_KEY, $locale );
 
             // initialize t array
-            $GLOBALS['t'] = array();
+            if ( ! isset( $GLOBALS['t'] ) ) {
+                $GLOBALS['t'] = array();
+            }
 
             // if directories array exist we must include all files
             if ( isset( $GLOBALS[ 'YD_LANGUAGES_DIRECTORIES' ] ) )



From pclaerhout at mail.berlios.de  Fri Sep 15 22:07:28 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 15 Sep 2006 22:07:28 +0200
Subject: [ydf-devel] r2147 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609152007.k8FK7SKI008117@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-15 22:07:28 +0200 (Fri, 15 Sep 2006)
New Revision: 2147

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Fixed a small bug in YDRecordSet where it would not correctly define the fields to indicate that we are in the first page of a recordset.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-15 19:39:29 UTC (rev 2146)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-15 20:07:28 UTC (rev 2147)
@@ -213,12 +213,12 @@
             $this->offset = $offset ? ( $this->pagesize * ( $this->page - 1 ) ) : 0;
             
             // Get the previous and next page
-            $this->pagePrevious = ( $this->page <= 1 ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? $this->totalPages : 1 ) : $this->page - 1;
+            $this->pagePrevious = ( $this->page <= 1 ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? $this->totalPages : 0 ) : $this->page - 1;
             $this->pageNext = ( $this->page >= $this->totalPages ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? 1 : $this->totalPages ) : $this->page + 1;
 
             // Indicate if we are on the last or first page
-            $this->isFirstPage = ( $this->pagePrevious == false ) ? true : false;
-            $this->isLastPage = ( $this->pageNext == false ) ? true : false;
+            $this->isFirstPage = ( $this->pagePrevious ) ? true : false;
+            $this->isLastPage = ( $this->pageNext ) ? true : false;
 
             // Add the list of pages as an array
             $this->pages = ( $this->totalPages <= 1 ) ? array( 1 ) : range( 1, $this->totalPages );



From pclaerhout at mail.berlios.de  Sat Sep 16 11:02:17 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 16 Sep 2006 11:02:17 +0200
Subject: [ydf-devel] r2148 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609160902.k8G92HYo001204@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-16 11:02:17 +0200 (Sat, 16 Sep 2006)
New Revision: 2148

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Fixed a small bug in YDForm where it would return an incorrect value for an element if the form type is a GET form. It was not returning the default value of an element if it was not specified in the $_GET varaiables.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-15 20:07:28 UTC (rev 2147)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-16 09:02:17 UTC (rev 2148)
@@ -633,6 +633,13 @@
                 }
             }
 
+            // Special treatment for GET forms
+            if ( $this->_method == 'get' ) {
+                if ( ! isset( $_GET[$name] ) && ! is_null( $element->_default ) ) {
+                    $value = $element->getDefault();
+                }
+            }
+
             // Special treatment for uploads
             if ( $type == 'file' ) {
                 if ( array_key_exists( $this->_name . '_' . $name, $_FILES ) ) {



From pclaerhout at mail.berlios.de  Sat Sep 16 18:54:40 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 16 Sep 2006 18:54:40 +0200
Subject: [ydf-devel] r2149 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609161654.k8GGseiV017752@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-16 18:54:39 +0200 (Sat, 16 Sep 2006)
New Revision: 2149

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Fixed my previous commit to that the right $_GET element would be taken.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-16 09:02:17 UTC (rev 2148)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-16 16:54:39 UTC (rev 2149)
@@ -635,7 +635,7 @@
 
             // Special treatment for GET forms
             if ( $this->_method == 'get' ) {
-                if ( ! isset( $_GET[$name] ) && ! is_null( $element->_default ) ) {
+                if ( ! isset( $_GET[$this->_name . '_' . $name] ) && ! is_null( $element->_default ) ) {
                     $value = $element->getDefault();
                 }
             }



From maximus_meridius79 at yahoo.com  Tue Sep 19 18:27:06 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Tue, 19 Sep 2006 09:27:06 -0700 (PDT)
Subject: [ydf-devel] YDAjax and drag-drop
Message-ID: <20060919162706.97682.qmail@web54007.mail.yahoo.com>

  Hi,

I found a modified version of moo.fx that includes a drag-drop effecthere:

http://clement.lavoillotte.info/devs/moofx/new/#

(I can't actually read that site since and couldn't find anyexplanation of the drag-drop that they had created)

This has an MIT-style license. I have used this to add drag-drop toYDAjax.

I have attached a tarball containing the following files:

./examples/ajax/drag.php
./examples/ajax/drag.tpl
./YDFramework2/addons/YDAjax/YDAjax.php
./YDFramework2/addons/YDAjax/js/prototype.lite.js_moo.fx.js_moo.fx.pack.js

The Javascript file is a revised version of the existing one providedwith YDAjax. I have added moo.fx.drag.js to the end of the file. I havealso used the original uncompressed moo.fx javascript files for thepurpose of aiding debugging (the javascript worked out of the box).

I have added a method "addDraggables" to the YDAjax class.

        /**
         *    This method adds a draggabble element
         *
         *    @param $id        The id to assign the draggable
         *  @param $html    The initial html for the draggable
         */        
        function & addDraggable( $id, $html = "", $class ="draggable", $parent = "" ) {

This creates a div element that is draggable with the specified CSS"$id". "$html" is for the div content. "$parent" is an optional CSS idthat can be used to add a draggable to an existing div container.Draggables created in this form are restricted to the container. Thecontainer can have a pixel-width or percentage-width.

Draggables can overlap. I am not sure how to modify the CSS orjavascript to prevent overlap. It would be nice if overlap could beoptionally turned off.

I have setup addDraggable so that it can add a draggable in a requestor in an ajax response.

I have created an example. A screenshot of the example is attached. The"Add a Popup" button will create a draggable via an ajax response. Theexample works in Firefox, IE, Opera and Safari (although it does notrefresh correctly in safari).

I would like to add a method to create a draggable form that behaves asa modal dialog (i.e. the form must be closed, cancelled or submitted inorder to continue).

Enjoy!

Regards,

Graeme



 		
---------------------------------
Do you Yahoo!?
 Get on board. You're invited to try the new Yahoo! Mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060919/de96bf22/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: drag.jpg
Type: image/jpeg
Size: 52455 bytes
Desc: 734960783-drag.jpg
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060919/de96bf22/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: draggable.tar.gz
Type: application/gzip
Size: 16002 bytes
Desc: 2383438492-draggable.tar.gz
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060919/de96bf22/attachment.bin>

From ximian at mail.berlios.de  Tue Sep 19 18:50:31 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 19 Sep 2006 18:50:31 +0200
Subject: [ydf-devel] r2150 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609191650.k8JGoVHC028076@sheep.berlios.de>

Author: ximian
Date: 2006-09-19 18:50:09 +0200 (Tue, 19 Sep 2006)
New Revision: 2150

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
- added new feature to disable form elements peacefully: YDForm::disable( $element, $customOptions )

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-16 16:54:39 UTC (rev 2149)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-09-19 16:50:09 UTC (rev 2150)
@@ -1117,12 +1117,25 @@
             if ( sizeof( $array ) == 0 ) { return ''; }
             $out = '';
             foreach ( $array as $key=>$value ) {
-                $out .= ' ' . strval( $key ) . '="' . str_replace( '&amp;', '&', htmlspecialchars( strval( $value ) ) ) . '"';
+                if ( is_null( $value ) ) $out .= ' disabled ';
+                else                     $out .= ' ' . strval( $key ) . '="' . str_replace( '&amp;', '&', htmlspecialchars( strval( $value ) ) ) . '"';
             }
             return $out;
         }
 
         /**
+         *  This function returns the default value of an element.
+         *
+         *  @param $name     The element name
+         *  @param $options  (Optional) Custom options (eg, used on checkboxgroup to specify internal element)
+         */
+        function disable( $name, $options = null ) {
+
+                $element = & $this->getElement( $name );
+                $element->disable( $options );
+        }
+
+        /**
          *  Function that will apply the actual filters to the named element.
          *
          *  @param  $name   The name of the field to apply the filter to.
@@ -1299,7 +1312,18 @@
                 $this->setAttribute( $k, $v );
         }
 
+
         /**
+         *  Function to disable this element
+         *
+         *  @param  $options    (Optional) Custom options
+         */
+        function disable( $options = null ) {
+            $this->setAttribute( 'disabled', null );
+        }
+
+
+        /**
          *  Function to delete an attribute of a form element
          *
          *  @param  $key    The name of the attribute



From ximian at mail.berlios.de  Tue Sep 19 19:10:10 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 19 Sep 2006 19:10:10 +0200
Subject: [ydf-devel] r2151 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200609191710.k8JHAA1c011292@sheep.berlios.de>

Author: ximian
Date: 2006-09-19 19:09:32 +0200 (Tue, 19 Sep 2006)
New Revision: 2151

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
Log:
- added support to checkboxgroup disable

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2006-09-19 16:50:09 UTC (rev 2150)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2006-09-19 17:09:32 UTC (rev 2151)
@@ -113,7 +113,31 @@
             }
         }
 
+
         /**
+         *	This function disables checkboxes
+         *
+         *	@param	$options	Value, Array of values to disable
+         */
+        function disable( $options ) {
+
+            // if null disable all elements
+            if ( is_null ( $options ) ){
+                foreach ( $this->_items as $k => $item )
+                    if ( isset( $this->_items[$k] ) ) $this->_items[$k]->disable();
+                return;
+            }
+
+            // check if options is array
+            if ( ! is_array( $options ) ) $options = array( $options );
+
+            // disable specific elements
+            foreach( $options as $k )
+                if ( isset( $this->_items[$k] ) ) $this->_items[$k]->disable();
+        }
+
+
+        /**
          *      This function returns the value of the element.
          *
          *      @returns        Value of this object.



From ximian at mail.berlios.de  Tue Sep 19 19:12:08 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 19 Sep 2006 19:12:08 +0200
Subject: [ydf-devel] r2152 - YDFramework2.0/trunk/examples
Message-ID: <200609191712.k8JHC8fU015180@sheep.berlios.de>

Author: ximian
Date: 2006-09-19 19:11:46 +0200 (Tue, 19 Sep 2006)
New Revision: 2152

Modified:
   YDFramework2.0/trunk/examples/form_checkboxgroup.php
Log:
- updated examples/form_checkboxgroup.php to demonstrate new YDForm::disable feature on these special elements

Modified: YDFramework2.0/trunk/examples/form_checkboxgroup.php
===================================================================
--- YDFramework2.0/trunk/examples/form_checkboxgroup.php	2006-09-19 17:09:32 UTC (rev 2151)
+++ YDFramework2.0/trunk/examples/form_checkboxgroup.php	2006-09-19 17:11:46 UTC (rev 2152)
@@ -36,6 +36,11 @@
             $form->addElement( 'checkboxgroup', 'choose_multiple11', 'Custom Separator "XXX" and LEFT',           array('sep' => 'l', 'separator' => '&nbsp;&nbsp;XXX&nbsp;&nbsp;'), array( 0 => 'choice 1', 1 => 'choice 2' ) );
             $form->addElement( 'checkboxgroup', 'choose_multiple12', 'Custom Separator "...", LEFT and VERTICAL',                   array('sep' => 'l', 'separator' => '...<br />'), array( 0 => 'choice 1', 1 => 'choice 2' ) );
 
+			// demonstrate disable on checkboxgroup
+            $form->disable( 'choose_multiple',  1 );
+            $form->disable( 'choose_multiple2', array( 0, 1 ) );
+            $form->disable( 'choose_multiple3' );
+
             // Add the submit button
             $form->addElement( 'submit', 'btnSubmit', 'submit' );
 



From pclaerhout at mail.berlios.de  Wed Sep 20 15:57:22 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 20 Sep 2006 15:57:22 +0200
Subject: [ydf-devel] r2153 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200609201357.k8KDvMhQ001039@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-20 15:57:21 +0200 (Wed, 20 Sep 2006)
New Revision: 2153

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Spam comments older than 15 days are now automatically deleted.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-19 17:11:46 UTC (rev 2152)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-09-20 13:57:21 UTC (rev 2153)
@@ -128,6 +128,10 @@
             // The array that will hold the image metadata
             $this->imagemetadata = null;
 
+            // Delete spam comments older than 15 days
+            $sql = 'DELETE FROM #_comments WHERE is_spam = 1 AND created < (unix_timestamp()-1296000)';
+            $this->db->executeSql( $sql );
+
         }
 
         // Get the schema version



From pclaerhout at mail.berlios.de  Wed Sep 20 16:02:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 20 Sep 2006 16:02:37 +0200
Subject: [ydf-devel] r2154 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200609201402.k8KE2bvl001541@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-20 16:02:36 +0200 (Wed, 20 Sep 2006)
New Revision: 2154

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
Log:
Added some missing translations.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-20 13:57:21 UTC (rev 2153)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-09-20 14:02:36 UTC (rev 2154)
@@ -298,6 +298,7 @@
 $GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
 $GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">get one here</a>)';
+$GLOBALS['t']['cfg_max_img_size'] = 'Maximum image size';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-20 13:57:21 UTC (rev 2153)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-09-20 14:02:36 UTC (rev 2154)
@@ -298,6 +298,7 @@
 $GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
 $GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
 $GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">hier te verkrijgen</a>)';
+$GLOBALS['t']['cfg_max_img_size'] = 'Maximale beeldgrootte';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';



From pclaerhout at mail.berlios.de  Wed Sep 20 16:04:14 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 20 Sep 2006 16:04:14 +0200
Subject: [ydf-devel] r2155 - YDFramework2.0/trunk/examples/weblog
Message-ID: <200609201404.k8KE4E1X001678@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-20 16:04:13 +0200 (Wed, 20 Sep 2006)
New Revision: 2155

Modified:
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Added a CSS class to the buttons in the skin.

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-09-20 14:02:36 UTC (rev 2154)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-09-20 14:04:13 UTC (rev 2155)
@@ -55,7 +55,7 @@
             $form->addElement( 'text', 'useremail', t( 'mail_not_published' ) );
             $form->addElement( 'text', 'userwebsite', t( 'website' ) );
             $form->addElement( 'textarea', 'comment', '' );
-            $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ) );
+            $form->addElement( 'submit', 'cmdSubmit', t( 'submit_comment' ), array( 'class' => 'button' ) );
             $form->addElement( 'hidden', 'item_id' );
 
             // Set the defaults



From pclaerhout at mail.berlios.de  Wed Sep 20 20:32:38 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 20 Sep 2006 20:32:38 +0200
Subject: [ydf-devel] r2156 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609201832.k8KIWcvb031315@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-20 20:32:37 +0200 (Wed, 20 Sep 2006)
New Revision: 2156

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Fixed a missing default argument from YDRequest::getRequiredQueryStringParameter.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-20 14:04:13 UTC (rev 2155)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-20 18:32:37 UTC (rev 2156)
@@ -136,7 +136,7 @@
          *
          *  @returns    The value of the query string variable as a string.
          */
-        function getRequiredQueryStringParameter( $name, $default, $values=null, $action_if_fails='default', $use_keys=false ) {
+        function getRequiredQueryStringParameter( $name, $default='', $values=null, $action_if_fails='default', $use_keys=false ) {
             $result = $this->getQueryStringParameter( $name, $default, $values, $use_keys );
             if ( empty( $result ) ) {
                 $this->redirectToAction( $action_if_fails );



From pieter at yellowduck.be  Thu Sep 21 10:37:42 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Thu, 21 Sep 2006 10:37:42 +0200
Subject: [ydf-devel] YDAjax and drag-drop
In-Reply-To: <20060919162706.97682.qmail@web54007.mail.yahoo.com>
References: <20060919162706.97682.qmail@web54007.mail.yahoo.com>
Message-ID: <4aef63030609210137q5bf33c2cx115190acbbe19e62@mail.gmail.com>

Francisco,

can you have a look at this?

thanks,


pieter

2006/9/19, maximus meridius <maximus_meridius79 at yahoo.com>:
>
> Hi,
>
> I found a modified version of moo.fx that includes a drag-drop effect
> here:
>
> http://clement.lavoillotte.info/devs/moofx/new/#
>
> (I can't actually read that site since and couldn't find any explanation
> of the drag-drop that they had created)
>
> This has an MIT-style license. I have used this to add drag-drop to
> YDAjax.
>
> I have attached a tarball containing the following files:
>
> ./examples/ajax/drag.php
> ./examples/ajax/drag.tpl
> ./YDFramework2/addons/YDAjax/YDAjax.php
> ./YDFramework2/addons/YDAjax/js/prototype.lite.js_moo.fx.js_moo.fx.pack.js
>
> The Javascript file is a revised version of the existing one provided with
> YDAjax. I have added moo.fx.drag.js to the end of the file. I have also
> used the original uncompressed moo.fx javascript files for the purpose of
> aiding debugging (the javascript worked out of the box).
>
> I have added a method "addDraggables" to the YDAjax class.
>
>         /**
>          *    This method adds a draggabble element
>          *
>          *    @param $id        The id to assign the draggable
>          *  @param $html    The initial html for the draggable
>          */
>         function & addDraggable( $id, $html = "", $class = "draggable",
> $parent = "" ) {
>
> This creates a div element that is draggable with the specified CSS "$id".
> "$html" is for the div content. "$parent" is an optional CSS id that can be
> used to add a draggable to an existing div container. Draggables created in
> this form are restricted to the container. The container can have a
> pixel-width or percentage-width.
>
> Draggables can overlap. I am not sure how to modify the CSS or javascript
> to prevent overlap. It would be nice if overlap could be optionally turned
> off.
>
> I have setup addDraggable so that it can add a draggable in a request or
> in an ajax response.
>
> I have created an example. A screenshot of the example is attached. The
> "Add a Popup" button will create a draggable via an ajax response. The
> example works in Firefox, IE, Opera and Safari (although it does not refresh
> correctly in safari).
>
> I would like to add a method to create a draggable form that behaves as a
> modal dialog (i.e. the form must be closed, cancelled or submitted in
> order to continue).
>
> Enjoy!
>
> Regards,
>
> Graeme
>
>
>  ------------------------------
> Do you Yahoo!?
> Get on board. You're invited<http://us.rd.yahoo.com/evt=40791/*http://advision.webevents.yahoo.com/mailbeta>to try the new Yahoo! Mail.
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>
>


-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060921/465668f8/attachment.html>

From pclaerhout at mail.berlios.de  Thu Sep 21 19:18:04 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 21 Sep 2006 19:18:04 +0200
Subject: [ydf-devel] r2157 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609211718.k8LHI4Ul014467@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-21 19:18:03 +0200 (Thu, 21 Sep 2006)
New Revision: 2157

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Fixed the isFirstPage and isLastPage of the recordset object.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-20 18:32:37 UTC (rev 2156)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-21 17:18:03 UTC (rev 2157)
@@ -211,14 +211,14 @@
             
             // Get the offset
             $this->offset = $offset ? ( $this->pagesize * ( $this->page - 1 ) ) : 0;
-            
+
             // Get the previous and next page
-            $this->pagePrevious = ( $this->page <= 1 ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? $this->totalPages : 0 ) : $this->page - 1;
-            $this->pageNext = ( $this->page >= $this->totalPages ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? 1 : $this->totalPages ) : $this->page + 1;
+            $this->pagePrevious = ( $this->page <= 1 ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? $this->totalPages : false ) : $this->page - 1;
+            $this->pageNext = ( $this->page >= $this->totalPages ) ? ( YDConfig::get( 'YD_DB_RS_CYCLENAVIGATION' ) ? 1 : false ) : $this->page + 1;
 
             // Indicate if we are on the last or first page
-            $this->isFirstPage = ( $this->pagePrevious ) ? true : false;
-            $this->isLastPage = ( $this->pageNext ) ? true : false;
+            $this->isFirstPage = ( $this->pagePrevious === false ) ? true : false;
+            $this->isLastPage = ( $this->pageNext === false ) ? true : false;
 
             // Add the list of pages as an array
             $this->pages = ( $this->totalPages <= 1 ) ? array( 1 ) : range( 1, $this->totalPages );



From francisco at fusemail.com  Thu Sep 21 21:36:38 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 21 Sep 2006 20:36:38 +0100
Subject: [ydf-devel] YDAjax and drag-drop
In-Reply-To: <4aef63030609210137q5bf33c2cx115190acbbe19e62@mail.gmail.com>
References: <20060919162706.97682.qmail@web54007.mail.yahoo.com>
	<4aef63030609210137q5bf33c2cx115190acbbe19e62@mail.gmail.com>
Message-ID: <4512E9C6.8000006@fusemail.com>

Hi Pieter

> can you have a look at this?

Sure i will. I didn't have the time for it yet.. Maybe tomorrow or next..


regards
Francisco A


From pclaerhout at mail.berlios.de  Fri Sep 22 13:59:19 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 22 Sep 2006 13:59:19 +0200
Subject: [ydf-devel] r2158 - in
	YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes:
	. HTMLSax3
Message-ID: <200609221159.k8MBxJfa027809@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-22 13:59:18 +0200 (Fri, 22 Sep 2006)
New Revision: 2158

Modified:
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php
   YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php
Log:
Updated some files of the safehtml 3rd party class.

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php	2006-09-21 17:18:03 UTC (rev 2157)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/Decorators.php	2006-09-22 11:59:18 UTC (rev 2158)
@@ -1,122 +1,363 @@
 <?php
+/* vim: set expandtab tabstop=4 shiftwidth=4: */
+//
+// +----------------------------------------------------------------------+
+// | PHP Version 4                                                        |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 1997-2002 The PHP Group                                |
+// +----------------------------------------------------------------------+
+// | This source file is subject to version 2.02 of the PHP license,      |
+// | that is bundled with this package in the file LICENSE, and is        |
+// | available at through the world-wide-web at                           |
+// | http://www.php.net/license/3_0.txt.                                  |
+// | If you did not receive a copy of the PHP license and are unable to   |
+// | obtain it through the world-wide-web, please send a note to          |
+// | license at php.net so we can mail you a copy immediately.               |
+// +----------------------------------------------------------------------+
+// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
+// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
+// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
+// +----------------------------------------------------------------------+
+//
+// $Id: Decorators.php,v 1.1 2004/06/02 14:09:19 hfuecks Exp $
+//
+/**
+* Decorators for dealing with parser options
+* @package XML_HTMLSax3
+* @version $Id: Decorators.php,v 1.1 2004/06/02 14:09:19 hfuecks Exp $
+* @see XML_HTMLSax3::set_option
+*/
+/**
+* Trims the contents of element data from whitespace at start and end
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Trim {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_Trim(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function trimData(&$parser, $data) {
-  $data = trim($data);
-  if ($data != '') {
-   $this->orig_obj->{$this->orig_method}($parser, $data);
-  }
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_Trim
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_Trim(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Trims the data
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function trimData(&$parser, $data) {
+        $data = trim($data);
+        if ($data != '') {
+            $this->orig_obj->{$this->orig_method}($parser, $data);
+        }
+    }
 }
+/**
+* Coverts tag names to upper case
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_CaseFolding {
- var $orig_obj;
- var $orig_open_method;
- var $orig_close_method;
- function XML_HTMLSax3_CaseFolding(&$orig_obj, $orig_open_method, $orig_close_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_open_method = $orig_open_method;
-  $this->orig_close_method = $orig_close_method;
- }
- function foldOpen(&$parser, $tag, $attrs=array(), $empty = FALSE) {
-  $this->orig_obj->{$this->orig_open_method}($parser, strtoupper($tag), $attrs, $empty);
- }
- function foldClose(&$parser, $tag, $empty = FALSE) {
-  $this->orig_obj->{$this->orig_close_method}($parser, strtoupper($tag), $empty);
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original open handler method
+    * @var string
+    * @access private
+    */
+    var $orig_open_method;
+    /**
+    * Original close handler method
+    * @var string
+    * @access private
+    */
+    var $orig_close_method;
+    /**
+    * Constructs XML_HTMLSax3_CaseFolding
+    * @param object handler object being decorated
+    * @param string original open handler method
+    * @param string original close handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_CaseFolding(&$orig_obj, $orig_open_method, $orig_close_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_open_method = $orig_open_method;
+        $this->orig_close_method = $orig_close_method;
+    }
+    /**
+    * Folds up open tag callbacks
+    * @param XML_HTMLSax3
+    * @param string tag name
+    * @param array tag attributes
+    * @access protected
+    */
+    function foldOpen(&$parser, $tag, $attrs=array(), $empty = FALSE) {
+        $this->orig_obj->{$this->orig_open_method}($parser, strtoupper($tag), $attrs, $empty);
+    }
+    /**
+    * Folds up close tag callbacks
+    * @param XML_HTMLSax3
+    * @param string tag name
+    * @access protected
+    */
+    function foldClose(&$parser, $tag, $empty = FALSE) {
+        $this->orig_obj->{$this->orig_close_method}($parser, strtoupper($tag), $empty);
+    }
 }
+/**
+* Breaks up data by linefeed characters, resulting in additional
+* calls to the data handler
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Linefeed {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_LineFeed(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function breakData(&$parser, $data) {
-  $data = explode("\n",$data);
-  foreach ( $data as $chunk ) {
-   $this->orig_obj->{$this->orig_method}($parser, $chunk);
-  }
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_LineFeed
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_LineFeed(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Breaks the data up by linefeeds
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function breakData(&$parser, $data) {
+        $data = explode("\n",$data);
+        foreach ( $data as $chunk ) {
+            $this->orig_obj->{$this->orig_method}($parser, $chunk);
+        }
+    }
 }
+/**
+* Breaks up data by tab characters, resulting in additional
+* calls to the data handler
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Tab {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_Tab(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function breakData(&$parser, $data) {
-  $data = explode("\t",$data);
-  foreach ( $data as $chunk ) {
-   $this->orig_obj->{$this->orig_method}($this, $chunk);
-  }
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_Tab
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_Tab(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Breaks the data up by linefeeds
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function breakData(&$parser, $data) {
+        $data = explode("\t",$data);
+        foreach ( $data as $chunk ) {
+            $this->orig_obj->{$this->orig_method}($this, $chunk);
+        }
+    }
 }
+/**
+* Breaks up data by XML entities and parses them with html_entity_decode(),
+* resulting in additional calls to the data handler<br />
+* Requires PHP 4.3.0+
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Entities_Parsed {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_Entities_Parsed(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function breakData(&$parser, $data) {
-  $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
-  foreach ( $data as $chunk ) {
-   $chunk = html_entity_decode($chunk,ENT_NOQUOTES);
-   $this->orig_obj->{$this->orig_method}($this, $chunk);
-  }
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_Entities_Parsed
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_Entities_Parsed(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Breaks the data up by XML entities
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function breakData(&$parser, $data) {
+        $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
+        foreach ( $data as $chunk ) {
+            $chunk = html_entity_decode($chunk,ENT_NOQUOTES);
+            $this->orig_obj->{$this->orig_method}($this, $chunk);
+        }
+    }
 }
+/**
+* Compatibility with older PHP versions
+*/
 if (version_compare(phpversion(), '4.3', '<') && !function_exists('html_entity_decode') ) {
- function html_entity_decode($str, $style=ENT_NOQUOTES) {
-  return strtr($str,
-   array_flip(get_html_translation_table(HTML_ENTITIES,$style)));
- }
+    function html_entity_decode($str, $style=ENT_NOQUOTES) {
+        return strtr($str,
+            array_flip(get_html_translation_table(HTML_ENTITIES,$style)));
+    }
 }
+/**
+* Breaks up data by XML entities but leaves them unparsed,
+* resulting in additional calls to the data handler<br />
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Entities_Unparsed {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_Entities_Unparsed(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function breakData(&$parser, $data) {
-  $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
-  foreach ( $data as $chunk ) {
-   $this->orig_obj->{$this->orig_method}($this, $chunk);
-  }
- }
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_Entities_Unparsed
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_Entities_Unparsed(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Breaks the data up by XML entities
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function breakData(&$parser, $data) {
+        $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
+        foreach ( $data as $chunk ) {
+            $this->orig_obj->{$this->orig_method}($this, $chunk);
+        }
+    }
 }
 
+/**
+* Strips the HTML comment markers or CDATA sections from an escape.
+* If XML_OPTIONS_FULL_ESCAPES is on, this decorator is not used.<br />
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_Escape_Stripper {
- var $orig_obj;
- var $orig_method;
- function XML_HTMLSax3_Escape_Stripper(&$orig_obj, $orig_method) {
-  $this->orig_obj =& $orig_obj;
-  $this->orig_method = $orig_method;
- }
- function strip(&$parser, $data) {
-  if ( substr($data,0,2) == '--' ) {
-   $patterns = array(
-    '/^\-\-/',    // Opening comment: --
-    '/\-\-$/',    // Closing comment: --
-   );
-   $data = preg_replace($patterns,'',$data);
+    /**
+    * Original handler object
+    * @var object
+    * @access private
+    */
+    var $orig_obj;
+    /**
+    * Original handler method
+    * @var string
+    * @access private
+    */
+    var $orig_method;
+    /**
+    * Constructs XML_HTMLSax3_Entities_Unparsed
+    * @param object handler object being decorated
+    * @param string original handler method
+    * @access protected
+    */
+    function XML_HTMLSax3_Escape_Stripper(&$orig_obj, $orig_method) {
+        $this->orig_obj =& $orig_obj;
+        $this->orig_method = $orig_method;
+    }
+    /**
+    * Breaks the data up by XML entities
+    * @param XML_HTMLSax3
+    * @param string element data
+    * @access protected
+    */
+    function strip(&$parser, $data) {
+        // Check for HTML comments first
+        if ( substr($data,0,2) == '--' ) {
+            $patterns = array(
+                '/^\-\-/',          // Opening comment: --
+                '/\-\-$/',          // Closing comment: --
+            );
+            $data = preg_replace($patterns,'',$data);
 
-  } else if ( substr($data,0,1) == '[' ) {
-   $patterns = array(
-    '/^\[.*CDATA.*\[/s', // Opening CDATA
-    '/\].*\]$/s',    // Closing CDATA
-    );
-   $data = preg_replace($patterns,'',$data);
-  }
+        // Check for XML CDATA sections (note: don't do both!)
+        } else if ( substr($data,0,1) == '[' ) {
+            $patterns = array(
+                '/^\[.*CDATA.*\[/s', // Opening CDATA
+                '/\].*\]$/s',       // Closing CDATA
+                );
+            $data = preg_replace($patterns,'',$data);
+        }
 
-  $this->orig_obj->{$this->orig_method}($this, $data);
- }
+        $this->orig_obj->{$this->orig_method}($this, $data);
+    }
 }
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php	2006-09-21 17:18:03 UTC (rev 2157)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3/States.php	2006-09-22 11:59:18 UTC (rev 2158)
@@ -1,4 +1,34 @@
 <?php
+/* vim: set expandtab tabstop=4 shiftwidth=4: */
+//
+// +----------------------------------------------------------------------+
+// | PHP Version 4                                                        |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 1997-2002 The PHP Group                                |
+// +----------------------------------------------------------------------+
+// | This source file is subject to version 2.02 of the PHP license,      |
+// | that is bundled with this package in the file LICENSE, and is        |
+// | available at through the world-wide-web at                           |
+// | http://www.php.net/license/3_0.txt.                                  |
+// | If you did not receive a copy of the PHP license and are unable to   |
+// | obtain it through the world-wide-web, please send a note to          |
+// | license at php.net so we can mail you a copy immediately.               |
+// +----------------------------------------------------------------------+
+// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
+// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
+// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
+// +----------------------------------------------------------------------+
+//
+// $Id: States.php,v 1.2 2004/06/02 14:22:40 hfuecks Exp $
+//
+/**
+* Parsing states.
+* @package XML_HTMLSax3
+* @version $Id: States.php,v 1.2 2004/06/02 14:22:40 hfuecks Exp $
+*/
+/**
+* Define parser states
+*/
 define('XML_HTMLSAX3_STATE_STOP', 0);
 define('XML_HTMLSAX3_STATE_START', 1);
 define('XML_HTMLSAX3_STATE_TAG', 2);
@@ -7,173 +37,251 @@
 define('XML_HTMLSAX3_STATE_ESCAPE', 6);
 define('XML_HTMLSAX3_STATE_JASP', 7);
 define('XML_HTMLSAX3_STATE_PI', 8);
+/**
+* StartingState searches for the start of any XML tag
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_StartingState  {
- function parse(&$context) {
-  $data = $context->scanUntilString('<');
-  if ($data != '') {
-   $context->handler_object_data->
-    {$context->handler_method_data}($context->htmlsax, $data);
-  }
-  $context->IgnoreCharacter();
-  return XML_HTMLSAX3_STATE_TAG;
- }
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_TAG
+    * @access protected
+    */
+    function parse(&$context) {
+        $data = $context->scanUntilString('<');
+        if ($data != '') {
+            $context->handler_object_data->
+                {$context->handler_method_data}($context->htmlsax, $data);
+        }
+        $context->IgnoreCharacter();
+        return XML_HTMLSAX3_STATE_TAG;
+    }
 }
+/**
+* Decides which state to move one from after StartingState
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_TagState {
- function parse(&$context) {
-  switch($context->ScanCharacter()) {
-  case '/':
-   return XML_HTMLSAX3_STATE_CLOSING_TAG;
-   break;
-  case '?':
-   return XML_HTMLSAX3_STATE_PI;
-   break;
-  case '%':
-   return XML_HTMLSAX3_STATE_JASP;
-   break;
-  case '!':
-   return XML_HTMLSAX3_STATE_ESCAPE;
-   break;
-  default:
-   $context->unscanCharacter();
-   return XML_HTMLSAX3_STATE_OPENING_TAG;
-  }
- }
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant the next state to move into
+    * @access protected
+    */
+    function parse(&$context) {
+        switch($context->ScanCharacter()) {
+        case '/':
+            return XML_HTMLSAX3_STATE_CLOSING_TAG;
+            break;
+        case '?':
+            return XML_HTMLSAX3_STATE_PI;
+            break;
+        case '%':
+            return XML_HTMLSAX3_STATE_JASP;
+            break;
+        case '!':
+            return XML_HTMLSAX3_STATE_ESCAPE;
+            break;
+        default:
+            $context->unscanCharacter();
+            return XML_HTMLSAX3_STATE_OPENING_TAG;
+        }
+    }
 }
+/**
+* Dealing with closing XML tags
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_ClosingTagState {
- function parse(&$context) {
-  $tag = $context->scanUntilCharacters('/>');
-  if ($tag != '') {
-   $char = $context->scanCharacter();
-   if ($char == '/') {
-    $char = $context->scanCharacter();
-    if ($char != '>') {
-     $context->unscanCharacter();
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_START
+    * @access protected
+    */
+    function parse(&$context) {
+        $tag = $context->scanUntilCharacters('/>');
+        if ($tag != '') {
+            $char = $context->scanCharacter();
+            if ($char == '/') {
+                $char = $context->scanCharacter();
+                if ($char != '>') {
+                    $context->unscanCharacter();
+                }
+            }
+            $context->handler_object_element->
+                {$context->handler_method_closing}($context->htmlsax, $tag, FALSE);
+        }
+        return XML_HTMLSAX3_STATE_START;
     }
-   }
-   $context->handler_object_element->
-    {$context->handler_method_closing}($context->htmlsax, $tag, FALSE);
-  }
-  return XML_HTMLSAX3_STATE_START;
- }
 }
+/**
+* Dealing with opening XML tags
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_OpeningTagState {
- function parseAttributes(&$context) {
-  $Attributes = array();
- 
-  $context->ignoreWhitespace();
-  $attributename = $context->scanUntilCharacters("=/> \n\r\t");
-  while ($attributename != '') {
-   $attributevalue = NULL;
-   $context->ignoreWhitespace();
-   $char = $context->scanCharacter();
-   if ($char == '=') {
-    $context->ignoreWhitespace();
-    $char = $context->ScanCharacter();
-    if ($char == '"') {
-     $attributevalue= $context->scanUntilString('"');
-     $context->IgnoreCharacter();
-    } else if ($char == "'") {
-     $attributevalue = $context->scanUntilString("'");
-     $context->IgnoreCharacter();
-    } else {
-     $context->unscanCharacter();
-     $attributevalue =
-      $context->scanUntilCharacters("> \n\r\t");
+    /**
+    * Handles attributes
+    * @param string attribute name
+    * @param string attribute value
+    * @return void
+    * @access protected
+    * @see XML_HTMLSax3_AttributeStartState
+    */
+    function parseAttributes(&$context) {
+        $Attributes = array();
+    
+        $context->ignoreWhitespace();
+        $attributename = $context->scanUntilCharacters("=/> \n\r\t");
+        while ($attributename != '') {
+            $attributevalue = NULL;
+            $context->ignoreWhitespace();
+            $char = $context->scanCharacter();
+            if ($char == '=') {
+                $context->ignoreWhitespace();
+                $char = $context->ScanCharacter();
+                if ($char == '"') {
+                    $attributevalue= $context->scanUntilString('"');
+                    $context->IgnoreCharacter();
+                } else if ($char == "'") {
+                    $attributevalue = $context->scanUntilString("'");
+                    $context->IgnoreCharacter();
+                } else {
+                    $context->unscanCharacter();
+                    $attributevalue =
+                        $context->scanUntilCharacters("> \n\r\t");
+                }
+            } else if ($char !== NULL) {
+                $attributevalue = NULL;
+                $context->unscanCharacter();
+            }
+            $Attributes[$attributename] = $attributevalue;
+            
+            $context->ignoreWhitespace();
+            $attributename = $context->scanUntilCharacters("=/> \n\r\t");
+        }
+        return $Attributes;
     }
-   } else if ($char !== NULL) {
-    $attributevalue = NULL;
-    $context->unscanCharacter();
-   }
-   $Attributes[$attributename] = $attributevalue;
-   
-   $context->ignoreWhitespace();
-   $attributename = $context->scanUntilCharacters("=/> \n\r\t");
-  }
-  return $Attributes;
- }
 
- function parse(&$context) {
-  $tag = $context->scanUntilCharacters("/> \n\r\t");
-  if ($tag != '') {
-   $this->attrs = array();
-   $Attributes = $this->parseAttributes($context);
-   $char = $context->scanCharacter();
-   if ($char == '/') {
-    $char = $context->scanCharacter();
-    if ($char != '>') {
-     $context->unscanCharacter();
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_START
+    * @access protected
+    */
+    function parse(&$context) {
+        $tag = $context->scanUntilCharacters("/> \n\r\t");
+        if ($tag != '') {
+            $this->attrs = array();
+            $Attributes = $this->parseAttributes($context);
+            $char = $context->scanCharacter();
+            if ($char == '/') {
+                $char = $context->scanCharacter();
+                if ($char != '>') {
+                    $context->unscanCharacter();
+                }
+                $context->handler_object_element->
+                    {$context->handler_method_opening}($context->htmlsax, $tag, 
+                    $Attributes, TRUE);
+                $context->handler_object_element->
+                    {$context->handler_method_closing}($context->htmlsax, $tag, 
+                    TRUE);
+            } else {
+                $context->handler_object_element->
+                    {$context->handler_method_opening}($context->htmlsax, $tag, 
+                    $Attributes, FALSE);
+            }
+        }
+        return XML_HTMLSAX3_STATE_START;
     }
-    $context->handler_object_element->
-     {$context->handler_method_opening}($context->htmlsax, $tag, 
-     $Attributes, TRUE);
-    $context->handler_object_element->
-     {$context->handler_method_closing}($context->htmlsax, $tag, 
-     TRUE);
-   } else {
-    $context->handler_object_element->
-     {$context->handler_method_opening}($context->htmlsax, $tag, 
-     $Attributes, FALSE);
-   }
-  }
-  return XML_HTMLSAX3_STATE_START;
- }
 }
 
+/**
+* Deals with XML escapes handling comments and CDATA correctly
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_EscapeState {
- function parse(&$context) {
-  $char = $context->ScanCharacter();
-  if ($char == '-') {
-   $char = $context->ScanCharacter();
-   if ($char == '-') {
-    $context->unscanCharacter();
-    $context->unscanCharacter();
-    $text = $context->scanUntilString('-->');
-    $text .= $context->scanCharacter();
-    $text .= $context->scanCharacter();
-   } else {
-    $context->unscanCharacter();
-    $text = $context->scanUntilString('>');
-   }
-  } else if ( $char == '[') {
-   $context->unscanCharacter();
-   $text = $context->scanUntilString(']>');
-   $text.= $context->scanCharacter();
-  } else {
-   $context->unscanCharacter();
-   $text = $context->scanUntilString('>');
-  }
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_START
+    * @access protected
+    */
+    function parse(&$context) {
+        $char = $context->ScanCharacter();
+        if ($char == '-') {
+            $char = $context->ScanCharacter();
+            if ($char == '-') {
+                $context->unscanCharacter();
+                $context->unscanCharacter();
+                $text = $context->scanUntilString('-->');
+                $text .= $context->scanCharacter();
+                $text .= $context->scanCharacter();
+            } else {
+                $context->unscanCharacter();
+                $text = $context->scanUntilString('>');
+            }
+        } else if ( $char == '[') {
+            $context->unscanCharacter();
+            $text = $context->scanUntilString(']>');
+            $text.= $context->scanCharacter();
+        } else {
+            $context->unscanCharacter();
+            $text = $context->scanUntilString('>');
+        }
 
-  $context->IgnoreCharacter();
-  if ($text != '') {
-   $context->handler_object_escape->
-   {$context->handler_method_escape}($context->htmlsax, $text);
-  }
-  return XML_HTMLSAX3_STATE_START;
- }
+        $context->IgnoreCharacter();
+        if ($text != '') {
+            $context->handler_object_escape->
+            {$context->handler_method_escape}($context->htmlsax, $text);
+        }
+        return XML_HTMLSAX3_STATE_START;
+    }
 }
+/**
+* Deals with JASP/ASP markup
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_JaspState {
- function parse(&$context) {
-  $text = $context->scanUntilString('%>');
-  if ($text != '') {
-   $context->handler_object_jasp->
-    {$context->handler_method_jasp}($context->htmlsax, $text);
-  }
-  $context->IgnoreCharacter();
-  $context->IgnoreCharacter();
-  return XML_HTMLSAX3_STATE_START;
- }
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_START
+    * @access protected
+    */
+    function parse(&$context) {
+        $text = $context->scanUntilString('%>');
+        if ($text != '') {
+            $context->handler_object_jasp->
+                {$context->handler_method_jasp}($context->htmlsax, $text);
+        }
+        $context->IgnoreCharacter();
+        $context->IgnoreCharacter();
+        return XML_HTMLSAX3_STATE_START;
+    }
 }
+/**
+* Deals with XML processing instructions
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_PiState {
- function parse(&$context) {
-  $target = $context->scanUntilCharacters(" \n\r\t");
-  $data = $context->scanUntilString('?>');
-  if ($data != '') {
-   $context->handler_object_pi->
-   {$context->handler_method_pi}($context->htmlsax, $target, $data);
-  }
-  $context->IgnoreCharacter();
-  $context->IgnoreCharacter();
-  return XML_HTMLSAX3_STATE_START;
- }
+    /**
+    * @param XML_HTMLSax3_StateParser subclass
+    * @return constant XML_HTMLSAX3_STATE_START
+    * @access protected
+    */
+    function parse(&$context) {
+        $target = $context->scanUntilCharacters(" \n\r\t");
+        $data = $context->scanUntilString('?>');
+        if ($data != '') {
+            $context->handler_object_pi->
+            {$context->handler_method_pi}($context->htmlsax, $target, $data);
+        }
+        $context->IgnoreCharacter();
+        $context->IgnoreCharacter();
+        return XML_HTMLSAX3_STATE_START;
+    }
 }
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php	2006-09-21 17:18:03 UTC (rev 2157)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/safehtml/classes/HTMLSax3.php	2006-09-22 11:59:18 UTC (rev 2158)
@@ -1,5 +1,9 @@
 <?php
+/* vim: set expandtab tabstop=4 shiftwidth=4: */
+//
 // +----------------------------------------------------------------------+
+// | PHP Version 4                                                        |
+// +----------------------------------------------------------------------+
 // | Copyright (c) 1997-2002 The PHP Group                                |
 // +----------------------------------------------------------------------+
 // | This source file is subject to version 2.02 of the PHP license,      |
@@ -15,278 +19,669 @@
 // | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
 // +----------------------------------------------------------------------+
 //
+// $Id: HTMLSax3.php,v 1.1 2004/06/02 14:09:19 hfuecks Exp $
+//
+/**
+* Main parser components
+* @package XML_HTMLSax3
+* @version $Id: HTMLSax3.php,v 1.1 2004/06/02 14:09:19 hfuecks Exp $
+*/
+/**
+* Required classes
+*/
 if (!defined('XML_HTMLSAX3')) {
- define('XML_HTMLSAX3', 'XML/');
+    define('XML_HTMLSAX3', 'XML/');
 }
 require_once(XML_HTMLSAX3 . 'HTMLSax3/States.php');
 require_once(XML_HTMLSAX3 . 'HTMLSax3/Decorators.php');
 
+/**
+* Base State Parser
+* @package XML_HTMLSax3
+* @access protected
+* @abstract
+*/
 class XML_HTMLSax3_StateParser {
- var $htmlsax;
- var $handler_object_element;
- var $handler_method_opening;
- var $handler_method_closing;
- var $handler_object_data;
- var $handler_method_data;
- var $handler_object_pi;
- var $handler_method_pi;
- var $handler_object_jasp;
- var $handler_method_jasp;
- var $handler_object_escape;
- var $handler_method_escape;
- var $handler_default;
- var $parser_options = array();
- var $rawtext;
- var $position;
- var $length;
- var $State = array();
+    /**
+    * Instance of user front end class to be passed to callbacks
+    * @var XML_HTMLSax3
+    * @access private
+    */
+    var $htmlsax;
+    /**
+    * User defined object for handling elements
+    * @var object
+    * @access private
+    */
+    var $handler_object_element;
+    /**
+    * User defined open tag handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_opening;
+    /**
+    * User defined close tag handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_closing;
+    /**
+    * User defined object for handling data in elements
+    * @var object
+    * @access private
+    */
+    var $handler_object_data;
+    /**
+    * User defined data handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_data;
+    /**
+    * User defined object for handling processing instructions
+    * @var object
+    * @access private
+    */
+    var $handler_object_pi;
+    /**
+    * User defined processing instruction handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_pi;
+    /**
+    * User defined object for handling JSP/ASP tags
+    * @var object
+    * @access private
+    */
+    var $handler_object_jasp;
+    /**
+    * User defined JSP/ASP handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_jasp;
+    /**
+    * User defined object for handling XML escapes
+    * @var object
+    * @access private
+    */
+    var $handler_object_escape;
+    /**
+    * User defined XML escape handler method
+    * @var string
+    * @access private
+    */
+    var $handler_method_escape;
+    /**
+    * User defined handler object or NullHandler
+    * @var object
+    * @access private
+    */
+    var $handler_default;
+    /**
+    * Parser options determining parsing behavior
+    * @var array
+    * @access private
+    */
+    var $parser_options = array();
+    /**
+    * XML document being parsed
+    * @var string
+    * @access private
+    */
+    var $rawtext;
+    /**
+    * Position in XML document relative to start (0)
+    * @var int
+    * @access private
+    */
+    var $position;
+    /**
+    * Length of the XML document in characters
+    * @var int
+    * @access private
+    */
+    var $length;
+    /**
+    * Array of state objects
+    * @var array
+    * @access private
+    */
+    var $State = array();
 
- function XML_HTMLSax3_StateParser (& $htmlsax) {
-  $this->htmlsax = & $htmlsax;
-  $this->State[XML_HTMLSAX3_STATE_START] =& new XML_HTMLSax3_StartingState();
+    /**
+    * Constructs XML_HTMLSax3_StateParser setting up states
+    * @var XML_HTMLSax3 instance of user front end class
+    * @access protected
+    */
+    function XML_HTMLSax3_StateParser (& $htmlsax) {
+        $this->htmlsax = & $htmlsax;
+        $this->State[XML_HTMLSAX3_STATE_START] =& new XML_HTMLSax3_StartingState();
 
-  $this->State[XML_HTMLSAX3_STATE_CLOSING_TAG] =& new XML_HTMLSax3_ClosingTagState();
-  $this->State[XML_HTMLSAX3_STATE_TAG] =& new XML_HTMLSax3_TagState();
-  $this->State[XML_HTMLSAX3_STATE_OPENING_TAG] =& new XML_HTMLSax3_OpeningTagState();
+        $this->State[XML_HTMLSAX3_STATE_CLOSING_TAG] =& new XML_HTMLSax3_ClosingTagState();
+        $this->State[XML_HTMLSAX3_STATE_TAG] =& new XML_HTMLSax3_TagState();
+        $this->State[XML_HTMLSAX3_STATE_OPENING_TAG] =& new XML_HTMLSax3_OpeningTagState();
 
-  $this->State[XML_HTMLSAX3_STATE_PI] =& new XML_HTMLSax3_PiState();
-  $this->State[XML_HTMLSAX3_STATE_JASP] =& new XML_HTMLSax3_JaspState();
-  $this->State[XML_HTMLSAX3_STATE_ESCAPE] =& new XML_HTMLSax3_EscapeState();
- }
+        $this->State[XML_HTMLSAX3_STATE_PI] =& new XML_HTMLSax3_PiState();
+        $this->State[XML_HTMLSAX3_STATE_JASP] =& new XML_HTMLSax3_JaspState();
+        $this->State[XML_HTMLSAX3_STATE_ESCAPE] =& new XML_HTMLSax3_EscapeState();
+    }
 
- function unscanCharacter() {
-  $this->position -= 1;
- }
+    /**
+    * Moves the position back one character
+    * @access protected
+    * @return void
+    */
+    function unscanCharacter() {
+        $this->position -= 1;
+    }
 
- function ignoreCharacter() {
-  $this->position += 1;
- }
+    /**
+    * Moves the position forward one character
+    * @access protected
+    * @return void
+    */
+    function ignoreCharacter() {
+        $this->position += 1;
+    }
 
- function scanCharacter() {
-  if ($this->position < $this->length) {
-   return $this->rawtext{$this->position++};
-  }
- }
+    /**
+    * Returns the next character from the XML document or void if at end
+    * @access protected
+    * @return mixed
+    */
+    function scanCharacter() {
+        if ($this->position < $this->length) {
+            return $this->rawtext{$this->position++};
+        }
+    }
 
- function scanUntilString($string) {
-  $start = $this->position;
-  $this->position = strpos($this->rawtext, $string, $start);
-  if ($this->position === FALSE) {
-   $this->position = $this->length;
-  }
-  return substr($this->rawtext, $start, $this->position - $start);
- }
+    /**
+    * Returns a string from the current position to the next occurance
+    * of the supplied string
+    * @param string string to search until
+    * @access protected
+    * @return string
+    */
+    function scanUntilString($string) {
+        $start = $this->position;
+        $this->position = strpos($this->rawtext, $string, $start);
+        if ($this->position === FALSE) {
+            $this->position = $this->length;
+        }
+        return substr($this->rawtext, $start, $this->position - $start);
+    }
 
- function scanUntilCharacters($string) {}
+    /**
+    * Returns a string from the current position until the first instance of
+    * one of the characters in the supplied string argument
+    * @param string string to search until
+    * @access protected
+    * @return string
+    * @abstract
+    */
+    function scanUntilCharacters($string) {}
 
- function ignoreWhitespace() {}
+    /**
+    * Moves the position forward past any whitespace characters
+    * @access protected
+    * @return void
+    * @abstract
+    */
+    function ignoreWhitespace() {}
 
- function parse($data) {
-  if ($this->parser_options['XML_OPTION_TRIM_DATA_NODES']==1) {
-   $decorator =& new XML_HTMLSax3_Trim(
-    $this->handler_object_data,
-    $this->handler_method_data);
-   $this->handler_object_data =& $decorator;
-   $this->handler_method_data = 'trimData';
-  }
-  if ($this->parser_options['XML_OPTION_CASE_FOLDING']==1) {
-   $open_decor =& new XML_HTMLSax3_CaseFolding(
-    $this->handler_object_element,
-    $this->handler_method_opening,
-    $this->handler_method_closing);
-   $this->handler_object_element =& $open_decor;
-   $this->handler_method_opening ='foldOpen';
-   $this->handler_method_closing ='foldClose';
-  }
-  if ($this->parser_options['XML_OPTION_LINEFEED_BREAK']==1) {
-   $decorator =& new XML_HTMLSax3_Linefeed(
-    $this->handler_object_data,
-    $this->handler_method_data);
-   $this->handler_object_data =& $decorator;
-   $this->handler_method_data = 'breakData';
-  }
-  if ($this->parser_options['XML_OPTION_TAB_BREAK']==1) {
-   $decorator =& new XML_HTMLSax3_Tab(
-    $this->handler_object_data,
-    $this->handler_method_data);
-   $this->handler_object_data =& $decorator;
-   $this->handler_method_data = 'breakData';
-  }
-  if ($this->parser_options['XML_OPTION_ENTITIES_UNPARSED']==1) {
-   $decorator =& new XML_HTMLSax3_Entities_Unparsed(
-    $this->handler_object_data,
-    $this->handler_method_data);
-   $this->handler_object_data =& $decorator;
-   $this->handler_method_data = 'breakData';
-  }
-  if ($this->parser_options['XML_OPTION_ENTITIES_PARSED']==1) {
-   $decorator =& new XML_HTMLSax3_Entities_Parsed(
-    $this->handler_object_data,
-    $this->handler_method_data);
-   $this->handler_object_data =& $decorator;
-   $this->handler_method_data = 'breakData';
-  }
-  // Note switched on by default
-  if ($this->parser_options['XML_OPTION_STRIP_ESCAPES']==1) {
-   $decorator =& new XML_HTMLSax3_Escape_Stripper(
-    $this->handler_object_escape,
-    $this->handler_method_escape);
-   $this->handler_object_escape =& $decorator;
-   $this->handler_method_escape = 'strip';
-  }
-  $this->rawtext = $data;
-  $this->length = strlen($data);
-  $this->position = 0;
-  $this->_parse();
- }
+    /**
+    * Begins the parsing operation, setting up any decorators, depending on
+    * parse options invoking _parse() to execute parsing
+    * @param string XML document to parse
+    * @access protected
+    * @return void
+    */
+    function parse($data) {
+        if ($this->parser_options['XML_OPTION_TRIM_DATA_NODES']==1) {
+            $decorator =& new XML_HTMLSax3_Trim(
+                $this->handler_object_data,
+                $this->handler_method_data);
+            $this->handler_object_data =& $decorator;
+            $this->handler_method_data = 'trimData';
+        }
+        if ($this->parser_options['XML_OPTION_CASE_FOLDING']==1) {
+            $open_decor =& new XML_HTMLSax3_CaseFolding(
+                $this->handler_object_element,
+                $this->handler_method_opening,
+                $this->handler_method_closing);
+            $this->handler_object_element =& $open_decor;
+            $this->handler_method_opening ='foldOpen';
+            $this->handler_method_closing ='foldClose';
+        }
+        if ($this->parser_options['XML_OPTION_LINEFEED_BREAK']==1) {
+            $decorator =& new XML_HTMLSax3_Linefeed(
+                $this->handler_object_data,
+                $this->handler_method_data);
+            $this->handler_object_data =& $decorator;
+            $this->handler_method_data = 'breakData';
+        }
+        if ($this->parser_options['XML_OPTION_TAB_BREAK']==1) {
+            $decorator =& new XML_HTMLSax3_Tab(
+                $this->handler_object_data,
+                $this->handler_method_data);
+            $this->handler_object_data =& $decorator;
+            $this->handler_method_data = 'breakData';
+        }
+        if ($this->parser_options['XML_OPTION_ENTITIES_UNPARSED']==1) {
+            $decorator =& new XML_HTMLSax3_Entities_Unparsed(
+                $this->handler_object_data,
+                $this->handler_method_data);
+            $this->handler_object_data =& $decorator;
+            $this->handler_method_data = 'breakData';
+        }
+        if ($this->parser_options['XML_OPTION_ENTITIES_PARSED']==1) {
+            $decorator =& new XML_HTMLSax3_Entities_Parsed(
+                $this->handler_object_data,
+                $this->handler_method_data);
+            $this->handler_object_data =& $decorator;
+            $this->handler_method_data = 'breakData';
+        }
+        // Note switched on by default
+        if ($this->parser_options['XML_OPTION_STRIP_ESCAPES']==1) {
+            $decorator =& new XML_HTMLSax3_Escape_Stripper(
+                $this->handler_object_escape,
+                $this->handler_method_escape);
+            $this->handler_object_escape =& $decorator;
+            $this->handler_method_escape = 'strip';
+        }
+        $this->rawtext = $data;
+        $this->length = strlen($data);
+        $this->position = 0;
+        $this->_parse();
+    }
 
- function _parse($state = XML_HTMLSAX3_STATE_START) {
-  do {
-   $state = $this->State[$state]->parse($this);
-  } while ($state != XML_HTMLSAX3_STATE_STOP &&
-     $this->position < $this->length);
- }
+    /**
+    * Performs the parsing itself, delegating calls to a specific parser
+    * state
+    * @param constant state object to parse with
+    * @access protected
+    * @return void
+    */
+    function _parse($state = XML_HTMLSAX3_STATE_START) {
+        do {
+            $state = $this->State[$state]->parse($this);
+        } while ($state != XML_HTMLSAX3_STATE_STOP &&
+                    $this->position < $this->length);
+    }
 }
 
+/**
+* Parser for PHP Versions below 4.3.0. Uses a slower parsing mechanism than
+* the equivalent PHP 4.3.0+  subclass of StateParser
+* @package XML_HTMLSax3
+* @access protected
+* @see XML_HTMLSax3_StateParser_Gtet430
+*/
 class XML_HTMLSax3_StateParser_Lt430 extends XML_HTMLSax3_StateParser {
- function XML_HTMLSax3_StateParser_Lt430(& $htmlsax) {
-  parent::XML_HTMLSax3_StateParser($htmlsax);
-  $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
-  $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
-  $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
-  $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
-  $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
-  $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
-  $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
- }
+    /**
+    * Constructs XML_HTMLSax3_StateParser_Lt430 defining available
+    * parser options
+    * @var XML_HTMLSax3 instance of user front end class
+    * @access protected
+    */
+    function XML_HTMLSax3_StateParser_Lt430(& $htmlsax) {
+        parent::XML_HTMLSax3_StateParser($htmlsax);
+        $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
+        $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
+        $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
+        $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
+        $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
+        $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
+        $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
+    }
 
- function scanUntilCharacters($string) {
-  $startpos = $this->position;
-  while ($this->position < $this->length && strpos($string, $this->rawtext{$this->position}) === FALSE) {
-   $this->position++;
-  }
-  return substr($this->rawtext, $startpos, $this->position - $startpos);
- }
+    /**
+    * Returns a string from the current position until the first instance of
+    * one of the characters in the supplied string argument
+    * @param string string to search until
+    * @access protected
+    * @return string
+    */
+    function scanUntilCharacters($string) {
+        $startpos = $this->position;
+        while ($this->position < $this->length && strpos($string, $this->rawtext{$this->position}) === FALSE) {
+            $this->position++;
+        }
+        return substr($this->rawtext, $startpos, $this->position - $startpos);
+    }
 
- function ignoreWhitespace() {
-  while ($this->position < $this->length && 
-   strpos(" \n\r\t", $this->rawtext{$this->position}) !== FALSE) {
-   $this->position++;
-  }
- }
+    /**
+    * Moves the position forward past any whitespace characters
+    * @access protected
+    * @return void
+    */
+    function ignoreWhitespace() {
+        while ($this->position < $this->length && 
+            strpos(" \n\r\t", $this->rawtext{$this->position}) !== FALSE) {
+            $this->position++;
+        }
+    }
 
- function parse($data) {
-  parent::parse($data);
- }
+    /**
+    * Begins the parsing operation, setting up the unparsed XML entities
+    * decorator if necessary then delegating further work to parent
+    * @param string XML document to parse
+    * @access protected
+    * @return void
+    */
+    function parse($data) {
+        parent::parse($data);
+    }
 }
 
+/**
+* Parser for PHP Versions equal to or greater than 4.3.0. Uses a faster
+* parsing mechanism than the equivalent PHP < 4.3.0 subclass of StateParser
+* @package XML_HTMLSax3
+* @access protected
+* @see XML_HTMLSax3_StateParser_Lt430
+*/
 class XML_HTMLSax3_StateParser_Gtet430 extends XML_HTMLSax3_StateParser {
- function XML_HTMLSax3_StateParser_Gtet430(& $htmlsax) {
-  parent::XML_HTMLSax3_StateParser($htmlsax);
-  $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
-  $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
-  $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
-  $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
-  $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
-  $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
-  $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
- }
- function scanUntilCharacters($string) {
-  $startpos = $this->position;
-  $length = strcspn($this->rawtext, $string, $startpos);
-  $this->position += $length;
-  return substr($this->rawtext, $startpos, $length);
- }
+    /**
+    * Constructs XML_HTMLSax3_StateParser_Gtet430 defining available
+    * parser options
+    * @var XML_HTMLSax3 instance of user front end class
+    * @access protected
+    */
+    function XML_HTMLSax3_StateParser_Gtet430(& $htmlsax) {
+        parent::XML_HTMLSax3_StateParser($htmlsax);
+        $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
+        $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
+        $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
+        $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
+        $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
+        $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
+        $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
+    }
+    /**
+    * Returns a string from the current position until the first instance of
+    * one of the characters in the supplied string argument.
+    * @param string string to search until
+    * @access protected
+    * @return string
+    */
+    function scanUntilCharacters($string) {
+        $startpos = $this->position;
+        $length = strcspn($this->rawtext, $string, $startpos);
+        $this->position += $length;
+        return substr($this->rawtext, $startpos, $length);
+    }
 
- function ignoreWhitespace() {
-  $this->position += strspn($this->rawtext, " \n\r\t", $this->position);
- }
+    /**
+    * Moves the position forward past any whitespace characters
+    * @access protected
+    * @return void
+    */
+    function ignoreWhitespace() {
+        $this->position += strspn($this->rawtext, " \n\r\t", $this->position);
+    }
 
- function parse($data) {
-  parent::parse($data);
- }
+    /**
+    * Begins the parsing operation, setting up the parsed and unparsed
+    * XML entity decorators if necessary then delegating further work
+    * to parent
+    * @param string XML document to parse
+    * @access protected
+    * @return void
+    */
+    function parse($data) {
+        parent::parse($data);
+    }
 }
 
+/**
+* Default NullHandler for methods which were not set by user
+* @package XML_HTMLSax3
+* @access protected
+*/
 class XML_HTMLSax3_NullHandler {
- function DoNothing() {
- }
+    /**
+    * Generic handler method which does nothing
+    * @access protected
+    * @return void
+    */
+    function DoNothing() {
+    }
 }
 
+/**
+* User interface class. All user calls should only be made to this class
+* @package XML_HTMLSax3
+* @access public
+*/
 class XML_HTMLSax3 {
- var $state_parser;
+    /**
+    * Instance of concrete subclass of XML_HTMLSax3_StateParser
+    * @var XML_HTMLSax3_StateParser
+    * @access private
+    */
+    var $state_parser;
 
- function XML_HTMLSax3() {
-  if (version_compare(phpversion(), '4.3', 'ge')) {
-   $this->state_parser =& new XML_HTMLSax3_StateParser_Gtet430($this);
-  } else {
-   $this->state_parser =& new XML_HTMLSax3_StateParser_Lt430($this);
-  }
-  $nullhandler =& new XML_HTMLSax3_NullHandler();
-  $this->set_object($nullhandler);
-  $this->set_element_handler('DoNothing', 'DoNothing');
-  $this->set_data_handler('DoNothing');
-  $this->set_pi_handler('DoNothing');
-  $this->set_jasp_handler('DoNothing');
-  $this->set_escape_handler('DoNothing');
- }
+    /**
+    * Constructs XML_HTMLSax3 selecting concrete StateParser subclass
+    * depending on PHP version being used as well as setting the default
+    * NullHandler for all callbacks<br />
+    * <b>Example:</b>
+    * <pre>
+    * $myHandler = & new MyHandler();
+    * $parser = new XML_HTMLSax3();
+    * $parser->set_object($myHandler);
+    * $parser->set_option('XML_OPTION_CASE_FOLDING');
+    * $parser->set_element_handler('myOpenHandler','myCloseHandler');
+    * $parser->set_data_handler('myDataHandler');
+    * $parser->parser($xml);
+    * </pre>
+    * @access public
+    */
+    function XML_HTMLSax3() {
+        if (version_compare(phpversion(), '4.3', 'ge')) {
+            $this->state_parser =& new XML_HTMLSax3_StateParser_Gtet430($this);
+        } else {
+            $this->state_parser =& new XML_HTMLSax3_StateParser_Lt430($this);
+        }
+        $nullhandler =& new XML_HTMLSax3_NullHandler();
+        $this->set_object($nullhandler);
+        $this->set_element_handler('DoNothing', 'DoNothing');
+        $this->set_data_handler('DoNothing');
+        $this->set_pi_handler('DoNothing');
+        $this->set_jasp_handler('DoNothing');
+        $this->set_escape_handler('DoNothing');
+    }
 
- function set_object(&$object) {
-  if ( is_object($object) ) {
-   $this->state_parser->handler_default =& $object;
-   return true;
-  } else {
-   require_once('PEAR.php');
-   PEAR::raiseError('XML_HTMLSax3::set_object requires '.
-    'an object instance');
-  }
- }
+    /**
+    * Sets the user defined handler object. Returns a PEAR Error
+    * if supplied argument is not an object.
+    * @param object handler object containing SAX callback methods
+    * @access public
+    * @return mixed
+    */
+    function set_object(&$object) {
+        if ( is_object($object) ) {
+            $this->state_parser->handler_default =& $object;
+            return true;
+        } else {
+            require_once('PEAR.php');
+            PEAR::raiseError('XML_HTMLSax3::set_object requires '.
+                'an object instance');
+        }
+    }
 
- function set_option($name, $value=1) {
-  if ( array_key_exists($name,$this->state_parser->parser_options) ) {
-   $this->state_parser->parser_options[$name] = $value;
-   return true;
-  } else {
-   require_once('PEAR.php');
-   PEAR::raiseError('XML_HTMLSax3::set_option('.$name.') illegal');
-  }
- }
+    /**
+    * Sets a parser option. By default all options are switched off.
+    * Returns a PEAR Error if option is invalid<br />
+    * <b>Available options:</b>
+    * <ul>
+    * <li>XML_OPTION_TRIM_DATA_NODES: trim whitespace off the beginning
+    * and end of data passed to the data handler</li>
+    * <li>XML_OPTION_LINEFEED_BREAK: linefeeds result in additional data
+    * handler calls</li>
+    * <li>XML_OPTION_TAB_BREAK: tabs result in additional data handler
+    * calls</li>
+    * <li>XML_OPTION_ENTITIES_UNPARSED: XML entities are returned as
+    * seperate data handler calls in unparsed form</li>
+    * <li>XML_OPTION_ENTITIES_PARSED: (PHP 4.3.0+ only) XML entities are
+    * returned as seperate data handler calls and are parsed with 
+    * PHP's html_entity_decode() function</li>
+    * <li>XML_OPTION_STRIP_ESCAPES: strips out the -- -- comment markers
+    * or CDATA markup inside an XML escape, if found.</li>
+    * </ul>
+    * To get HTMLSax to behave in the same way as the native PHP SAX parser,
+    * using it's default state, you need to switch on XML_OPTION_LINEFEED_BREAK,
+    * XML_OPTION_ENTITIES_PARSED and XML_OPTION_CASE_FOLDING
+    * @param string name of parser option
+    * @param int (optional) 1 to switch on, 0 for off
+    * @access public
+    * @return boolean
+    */
+    function set_option($name, $value=1) {
+        if ( array_key_exists($name,$this->state_parser->parser_options) ) {
+            $this->state_parser->parser_options[$name] = $value;
+            return true;
+        } else {
+            require_once('PEAR.php');
+            PEAR::raiseError('XML_HTMLSax3::set_option('.$name.') illegal');
+        }
+    }
 
- function set_data_handler($data_method) {
-  $this->state_parser->handler_object_data =& $this->state_parser->handler_default;
-  $this->state_parser->handler_method_data = $data_method;
- }
+    /**
+    * Sets the data handler method which deals with the contents of XML
+    * elements.<br />
+    * The handler method must accept two arguments, the first being an
+    * instance of XML_HTMLSax3 and the second being the contents of an
+    * XML element e.g.
+    * <pre>
+    * function myDataHander(& $parser,$data){}
+    * </pre>
+    * @param string name of method
+    * @access public
+    * @return void
+    * @see set_object
+    */
+    function set_data_handler($data_method) {
+        $this->state_parser->handler_object_data =& $this->state_parser->handler_default;
+        $this->state_parser->handler_method_data = $data_method;
+    }
 
- function set_element_handler($opening_method, $closing_method) {
-  $this->state_parser->handler_object_element =& $this->state_parser->handler_default;
-  $this->state_parser->handler_method_opening = $opening_method;
-  $this->state_parser->handler_method_closing = $closing_method;
- }
+    /**
+    * Sets the open and close tag handlers
+    * <br />The open handler method must accept three arguments; the parser,
+    * the tag name and an array of attributes e.g.
+    * <pre>
+    * function myOpenHander(& $parser,$tagname,$attrs=array()){}
+    * </pre>
+    * The close handler method must accept two arguments; the parser and
+    * the tag name e.g.
+    * <pre>
+    * function myCloseHander(& $parser,$tagname){}
+    * </pre>
+    * @param string name of open method
+    * @param string name of close method
+    * @access public
+    * @return void
+    * @see set_object
+    */
+    function set_element_handler($opening_method, $closing_method) {
+        $this->state_parser->handler_object_element =& $this->state_parser->handler_default;
+        $this->state_parser->handler_method_opening = $opening_method;
+        $this->state_parser->handler_method_closing = $closing_method;
+    }
 
- function set_pi_handler($pi_method) {
-  $this->state_parser->handler_object_pi =& $this->state_parser->handler_default;
-  $this->state_parser->handler_method_pi = $pi_method;
- }
+    /**
+    * Sets the processing instruction handler method e.g. for PHP open
+    * and close tags<br />
+    * The handler method must accept three arguments; the parser, the
+    * PI target and data inside the PI
+    * <pre>
+    * function myPIHander(& $parser,$target, $data){}
+    * </pre>
+    * @param string name of method
+    * @access public
+    * @return void
+    * @see set_object
+    */
+    function set_pi_handler($pi_method) {
+        $this->state_parser->handler_object_pi =& $this->state_parser->handler_default;
+        $this->state_parser->handler_method_pi = $pi_method;
+    }
 
- function set_escape_handler($escape_method) {
-  $this->state_parser->handler_object_escape =& $this->state_parser->handler_default;
-  $this->state_parser->handler_method_escape = $escape_method;
- }
+    /**
+    * Sets the XML escape handler method e.g. for comments and doctype
+    * declarations<br />
+    * The handler method must accept two arguments; the parser and the
+    * contents of the escaped section
+    * <pre>
+    * function myEscapeHander(& $parser, $data){}
+    * </pre>
+    * @param string name of method
+    * @access public
+    * @return void
+    * @see set_object
+    */
+    function set_escape_handler($escape_method) {
+        $this->state_parser->handler_object_escape =& $this->state_parser->handler_default;
+        $this->state_parser->handler_method_escape = $escape_method;
+    }
 
- function set_jasp_handler ($jasp_method) {
-  $this->state_parser->handler_object_jasp =& $this->state_parser->handler_default;
-  $this->state_parser->handler_method_jasp = $jasp_method;
- }
+    /**
+    * Sets the JSP/ASP markup handler<br />
+    * The handler method must accept two arguments; the parser and
+    * body of the JASP tag
+    * <pre>
+    * function myJaspHander(& $parser, $data){}
+    * </pre>
+    * @param string name of method
+    * @access public
+    * @return void
+    * @see set_object
+    */
+    function set_jasp_handler ($jasp_method) {
+        $this->state_parser->handler_object_jasp =& $this->state_parser->handler_default;
+        $this->state_parser->handler_method_jasp = $jasp_method;
+    }
 
- function get_current_position() {
-  return $this->state_parser->position;
- }
+    /**
+    * Returns the current string position of the "cursor" inside the XML
+    * document
+    * <br />Intended for use from within a user defined handler called
+    * via the $parser reference e.g.
+    * <pre>
+    * function myDataHandler(& $parser,$data) {
+    *     echo( 'Current position: '.$parser->get_current_position() );
+    * }
+    * </pre>
+    * @access public
+    * @return int
+    * @see get_length
+    */
+    function get_current_position() {
+        return $this->state_parser->position;
+    }
 
- function get_length() {
-  return $this->state_parser->length;
- }
+    /**
+    * Returns the string length of the XML document being parsed
+    * @access public
+    * @return int
+    */
+    function get_length() {
+        return $this->state_parser->length;
+    }
 
- function parse($data) {
-  $this->state_parser->parse($data);
- }
+    /**
+    * Start parsing some XML
+    * @param string XML document
+    * @access public
+    * @return void
+    */
+    function parse($data) {
+        $this->state_parser->parse($data);
+    }
 }
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Fri Sep 22 14:38:36 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 22 Sep 2006 14:38:36 +0200
Subject: [ydf-devel] r2159 -
	YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator
Message-ID: <200609221238.k8MCca29031895@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-22 14:38:35 +0200 (Fri, 22 Sep 2006)
New Revision: 2159

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
Log:
Fixed a bug in YDFeedCreator where it wasn't properly encoding the item body.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-09-22 11:59:18 UTC (rev 2158)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2006-09-22 12:38:35 UTC (rev 2159)
@@ -145,7 +145,7 @@
 
             $item = array(
                 'title' => YDStringUtil::encodeString( $title ), 'link' => $link,
-                'description' => $desc, 'guid' => $guid,
+                'description' => YDStringUtil::encodeString( $desc ), 'guid' => $guid,
                 'enclosure' => $enclosure, 'enclosure_size' => $enclosure_size,
                 'enclosure_type' => $enclosure_type, 'comments' => $commentlink
             );



From pclaerhout at mail.berlios.de  Sat Sep 23 17:04:39 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 23 Sep 2006 17:04:39 +0200
Subject: [ydf-devel] r2160 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609231504.k8NF4dsH032330@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-23 17:04:39 +0200 (Sat, 23 Sep 2006)
New Revision: 2160

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Added a YDRecordSet::getBrowseBar function that takes care of intelligently building page lists for recordsets.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-22 12:38:35 UTC (rev 2159)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-23 15:04:39 UTC (rev 2160)
@@ -32,6 +32,8 @@
     // Constants
     define( 'YD_DB_FETCH_ASSOC', 1 );
     define( 'YD_DB_FETCH_NUM', 2 );
+    define( 'YD_BROWSEBAR_FULL', 3 );
+    define( 'YD_BROWSEBAR_SHORT', 4 );
 
     // Configure the default for this class
     YDConfig::set( 'YD_DB_FETCHTYPE', YD_DB_FETCH_ASSOC, false );
@@ -222,7 +224,53 @@
 
             // Add the list of pages as an array
             $this->pages = ( $this->totalPages <= 1 ) ? array( 1 ) : range( 1, $this->totalPages );
-            
+
+            // Get subset of the pages a la phpBB (ideal for large page lists
+            $this->pagesShort = $this->pages;
+            if ( sizeof( $this->pages ) > 10 ) {
+
+                // Get the first 3 pages
+                $this->pagesShort = range( 1, 3 );
+
+                // Get the current page, the previous one and the next one
+                if ( $this->pagePrevious !== false && ! in_array( $this->pagePrevious, $this->pagesShort ) ) {
+                    array_push( $this->pagesShort, $this->pagePrevious );
+                }
+                if ( ! in_array( $this->page, $this->pagesShort ) ) {
+                    array_push( $this->pagesShort, $this->page );
+                }
+                if ( $this->pageNext !== false && ! in_array( $this->pageNext, $this->pagesShort ) ) {
+                    array_push( $this->pagesShort, $this->pageNext );
+                }
+
+                // Get the last 3 pages
+                $this->pagesShort = array_merge( $this->pagesShort, range( $this->totalPages-2, $this->totalPages ) );
+
+                // Get the unique values
+                $this->pagesShort = array_unique( $this->pagesShort );
+
+                // Sort the list
+                sort( $this->pagesShort );
+
+                // Add the holes
+                $pagesShort = $this->pagesShort;
+                $counter = 1;
+                foreach ( $this->pagesShort as $key=>$page ) {
+                    $next = next( $this->pagesShort );
+                    if ( $next !== false && ( $page + 1 ) != $next ) {
+                        array_splice(
+                            $pagesShort,
+                            $key+$counter,
+                            count( $pagesShort ),
+                            array_merge( array( false ), array_slice( $pagesShort, $key+$counter ) )
+                        );
+                        $counter++;
+                    }
+                }
+                $this->pagesShort = $pagesShort;
+
+            }
+
             // Get the subset of the records we need
             $this->set = array_slice( $this->records, $this->offset, $this->pagesize );
 
@@ -439,7 +487,6 @@
             return $this->set;
         }
 
-
         /**
          *  Sets fields names
          *
@@ -449,7 +496,6 @@
             return $this->gr_fields = $fields;
         }
 
-
         /**
          *  Gets fields names
          */
@@ -457,7 +503,6 @@
             return ( isset( $this->gr_fields ) ? $this->gr_fields : array() );
         }
 
-
         /**
          *  Set current field name
          *
@@ -466,10 +511,9 @@
          */
         function setCurrentField( $field, $sortdirection ) {
             $this->gr_currentField = $field;
-			$this->sortdirection   = $sortdirection;
+            $this->sortdirection   = $sortdirection;
         }
 
-
         /**
          *  Get current field name
          */
@@ -477,7 +521,6 @@
             return ( isset( $this->gr_currentField ) ? $this->gr_currentField : array() );
         }
 
-
         /**
          *  Get sort direction
          *
@@ -485,13 +528,101 @@
          *
          */
         function getSortdirection( $reverse = false ) {
+            if ( $reverse ) {
+                return ( strtoupper( $this->sortdirection ) == 'ASC' ? 'DESC' : 'ASC' );
+            } else {
+                return $this->sortdirection;
+            }
+        }
 
-			if ( $reverse ) return ( strtoupper( $this->sortdirection ) == 'ASC' ? 'DESC' : 'ASC' );
+        /**
+         *  This function gives a prerendered browsing bar for the recordset.
+         *
+         *  @param  $previousLabel  (optional) Label for the previous link. Defaults to "previous".
+         *  @param  $nextLabel      (optional) Label for the next link. Defaults to "next".
+         *  @param  $style          (optional) Style of the browse bar. This can be either YD_BROWSEBAR_FULL or
+         *                          YD_BROWSEBAR_FULL. The full one shows all page numbers, the short one doesn't.
+         *  @param  $currentLink    (optional) Boolean indicating if you should be able to click on the link for the
+         *                          current page or not.
+         *
+         *  @returns    The browsebar as formatted HTML.
+         */
+        function getBrowseBar(
+            $previousLabel='previous', $nextLabel='next', $style=YD_BROWSEBAR_SHORT, $currentLink=false
+        ) {
 
-			return $this->sortdirection;
+//            {if $users->totalPages > 1}
+//                <tr><td colspan="5">
+//                {if $users->page != 1}
+//                    <a href="{$users->getPreviousUrl()}">{t w="previous"}</a>
+//                {else}
+//                    {t w="previous"}
+//                {/if}
+//                {foreach from=$users->pages item="page"}
+//                    {if $page == $users->page}
+//                        {$page}
+//                    {else}
+//                        <a href="{$users->getPageUrl($page)}">{$page}</a>
+//                    {/if}
+//                {/foreach}
+//                {if $users->page != $users->totalPages}
+//                    <a href="{$users->getNextUrl()}">{t w="next"}</a>
+//                {else}
+//                    {t w="next"}
+//                {/if}
+//                </td></tr>
+//            {/if}
+
+            // Capture the HTML output
+            $html = '';
+
+            // If no pages, return an empty string
+            if ( $this->totalPages <= 1 ) {
+                return $html;
+            }
+
+            // Get the correct currentLink value
+            $currentLink = ( $currentLink === false ) ? false : true;
+
+            // Get the list of pages we need to use
+            $pages = ( $style == YD_BROWSEBAR_SHORT ) ? $this->pagesShort : $this->pages;
+
+            // Get the previous link if any
+            if ( $this->page != 1 ) {
+                $html .= sprintf( '<a href="%s">%s</a> ', $this->getPreviousUrl(), $previousLabel );
+            } else {
+                $html .= sprintf( '%s ', $previousLabel );
+            }
+
+            // Loop over the pages
+            foreach ( $pages as $page ) {
+                if ( $page !== false ) {
+                    if ( $page == $this->page ) {
+                        if ( $currentLink ) {
+                            $html .= sprintf( '<a href="%s"><b>%s</b></a> ', $this->getPageUrl( $page ), $page );
+                        } else {
+                            $html .= sprintf( '<b>%s</b> ', $page );
+                        }
+                    } else {
+                        $html .= sprintf( '<a href="%s">%s</a> ', $this->getPageUrl( $page ), $page );
+                    }
+                } else {
+                    $html .= '... ';
+                }
+            }
+
+            // Get the next link if any
+            if ( $this->page != $this->totalPages ) {
+                $html .= sprintf( '<a href="%s">%s</a> ', $this->getNextUrl(), $nextLabel );
+            } else {
+                $html .= sprintf( '%s ', $nextLabel );
+            }
+
+            // Return the HTML
+            return $html;
+
         }
 
-
     }
 
 



From pclaerhout at mail.berlios.de  Sat Sep 23 17:14:02 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 23 Sep 2006 17:14:02 +0200
Subject: [ydf-devel] r2161 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609231514.k8NFE2ft000619@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-23 17:14:02 +0200 (Sat, 23 Sep 2006)
New Revision: 2161

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Added an option to add an all link and cleaned up some old commented code.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-23 15:04:39 UTC (rev 2160)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-23 15:14:02 UTC (rev 2161)
@@ -548,31 +548,9 @@
          *  @returns    The browsebar as formatted HTML.
          */
         function getBrowseBar(
-            $previousLabel='previous', $nextLabel='next', $style=YD_BROWSEBAR_SHORT, $currentLink=false
+            $previousLabel='previous', $nextLabel='next', $style=YD_BROWSEBAR_SHORT, $currentLink=false, $allLink=null
         ) {
 
-//            {if $users->totalPages > 1}
-//                <tr><td colspan="5">
-//                {if $users->page != 1}
-//                    <a href="{$users->getPreviousUrl()}">{t w="previous"}</a>
-//                {else}
-//                    {t w="previous"}
-//                {/if}
-//                {foreach from=$users->pages item="page"}
-//                    {if $page == $users->page}
-//                        {$page}
-//                    {else}
-//                        <a href="{$users->getPageUrl($page)}">{$page}</a>
-//                    {/if}
-//                {/foreach}
-//                {if $users->page != $users->totalPages}
-//                    <a href="{$users->getNextUrl()}">{t w="next"}</a>
-//                {else}
-//                    {t w="next"}
-//                {/if}
-//                </td></tr>
-//            {/if}
-
             // Capture the HTML output
             $html = '';
 
@@ -611,6 +589,15 @@
                 }
             }
 
+            // Add an all link if need
+            if ( ! empty( $allLink ) ) {
+                $url = $this->url;
+                $url->deleteQueryVar( $this->pagevar );
+                $url->deleteQueryVar( $this->sizevar );
+                $url->setQueryVar( 'show', 'all' );
+                $html .= sprintf( '<a href="%s">%s</a> ', $url->getUri(), $allLink );
+            }
+
             // Get the next link if any
             if ( $this->page != $this->totalPages ) {
                 $html .= sprintf( '<a href="%s">%s</a> ', $this->getNextUrl(), $nextLabel );



From maximus_meridius79 at yahoo.com  Sun Sep 24 04:00:44 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Sat, 23 Sep 2006 19:00:44 -0700 (PDT)
Subject: [ydf-devel] Add new method YDAjax::getActualID( $id )
Message-ID: <20060924020044.5677.qmail@web54010.mail.yahoo.com>

  Hi,

I propose the addition of a simple method to YDAjax that gets theactual DOM id of an element. A parameter $id is passed. If the $idparameter is a form element then the $id returned is DOM id of theelement, otherwise the original id is returned.

        /**
         * This method gets the actual DOM id of an element by firstseeing if it is a form element.
         *
         *    @param $id        Form element name or a generic idstring.
         */
         function getActualId( $id ) {
         
            // try and get a form containing this element
            $form = $this->__getForm( $id );

            // if $id is really a form element
            if ( !is_null( $form ) ){

                // if is a form element, get element
                $elem = & $form->getElement( $id );
                
            }
            
            return ( is_null( $form ) ) ? $id : $form->getName() .'_' . $id;
         }


This method can be used to obtain the actual id of an element and isuseful for adding Javascript for the element to the response.

e.g.

$actual_id = $this->ajax->getActualId( $id );
$timeout_js = 'setTimeout( \'clearNodeById("' . $actual_id . '")\', ' .$timeout . ' );';
$this->ajax->addScript( $timeout_js );

Regards,

Graeme


 		
---------------------------------
How low will we go? Check out Yahoo! Messenger?s low  PC-to-Phone call rates.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060923/1f29d3c5/attachment.html>

From pieter at yellowduck.be  Mon Sep 25 10:55:42 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Mon, 25 Sep 2006 10:55:42 +0200
Subject: [ydf-devel] Add new method YDAjax::getActualID( $id )
In-Reply-To: <20060924020044.5677.qmail@web54010.mail.yahoo.com>
References: <20060924020044.5677.qmail@web54010.mail.yahoo.com>
Message-ID: <4aef63030609250155k4194f3f9ha9e439ce4712ad95@mail.gmail.com>

Francisco, can you have a look at this?

Maximus, can you log this as a feature request on berlios.de?

thanks,


pieter

2006/9/24, maximus meridius <maximus_meridius79 at yahoo.com>:
>
> Hi,
>
> I propose the addition of a simple method to YDAjax that gets the actual
> DOM id of an element. A parameter $id is passed. If the $id parameter is a
> form element then the $id returned is DOM id of the element, otherwise the
> original id is returned.
>
>         /**
>          * This method gets the actual DOM id of an element by first
> seeing if it is a form element.
>          *
>          *    @param $id        Form element name or a generic id string.
>          */
>          function getActualId( $id ) {
>
>             // try and get a form containing this element
>             $form = $this->__getForm( $id );
>
>             // if $id is really a form element
>             if ( !is_null( $form ) ){
>
>                 // if is a form element, get element
>                 $elem = & $form->getElement( $id );
>
>             }
>
>             return ( is_null( $form ) ) ? $id : $form->getName() . '_' .
> $id;
>          }
>
>
> This method can be used to obtain the actual id of an element and is
> useful for adding Javascript for the element to the response.
>
> e.g.
>
> $actual_id = $this->ajax->getActualId( $id );
> $timeout_js = 'setTimeout( \'clearNodeById("' . $actual_id . '")\', ' .
> $timeout . ' );';
> $this->ajax->addScript( $timeout_js );
>
> Regards,
>
> Graeme
>
>  ------------------------------
> How low will we go? Check out Yahoo! Messenger's low PC-to-Phone call
> rates.
> <http://us.rd.yahoo.com/mail_us/taglines/postman8/*http://us.rd.yahoo.com/evt=39663/*http://voice.yahoo.com>
>
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>


-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060925/a340fc9a/attachment.html>

From pclaerhout at mail.berlios.de  Mon Sep 25 13:22:32 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 25 Sep 2006 13:22:32 +0200
Subject: [ydf-devel] r2162 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609251122.k8PBMWei024202@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-25 13:22:32 +0200 (Mon, 25 Sep 2006)
New Revision: 2162

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Changed the default values for previous and next in YDRecordSet::getBrowseBar.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-23 15:14:02 UTC (rev 2161)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-25 11:22:32 UTC (rev 2162)
@@ -538,8 +538,8 @@
         /**
          *  This function gives a prerendered browsing bar for the recordset.
          *
-         *  @param  $previousLabel  (optional) Label for the previous link. Defaults to "previous".
-         *  @param  $nextLabel      (optional) Label for the next link. Defaults to "next".
+         *  @param  $previousLabel  (optional) Label for the previous link. Defaults to "&laquo;".
+         *  @param  $nextLabel      (optional) Label for the next link. Defaults to "&raquo;".
          *  @param  $style          (optional) Style of the browse bar. This can be either YD_BROWSEBAR_FULL or
          *                          YD_BROWSEBAR_FULL. The full one shows all page numbers, the short one doesn't.
          *  @param  $currentLink    (optional) Boolean indicating if you should be able to click on the link for the
@@ -548,7 +548,7 @@
          *  @returns    The browsebar as formatted HTML.
          */
         function getBrowseBar(
-            $previousLabel='previous', $nextLabel='next', $style=YD_BROWSEBAR_SHORT, $currentLink=false, $allLink=null
+            $previousLabel='&laquo;', $nextLabel='&raquo;', $style=YD_BROWSEBAR_SHORT, $currentLink=false, $allLink=null
         ) {
 
             // Capture the HTML output



From pclaerhout at mail.berlios.de  Mon Sep 25 13:32:11 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 25 Sep 2006 13:32:11 +0200
Subject: [ydf-devel] r2163 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609251132.k8PBWBhI024808@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-25 13:32:11 +0200 (Mon, 25 Sep 2006)
New Revision: 2163

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
   YDFramework2.0/trunk/examples/weblog/manage/images.tpl
   YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items.tpl
   YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
   YDFramework2.0/trunk/examples/weblog/manage/links.tpl
   YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
Log:
Used the new browser bars in the weblog admin.

Modified: YDFramework2.0/trunk/examples/weblog/manage/categories.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/categories.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $categories->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="3">
-                    <p class="subline">
-                    {if ! $categories->isFirstPage}
-                        <a href="{$categories->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$categories->pages item="page"}
-                        {if $page == $categories->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$categories->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $categories->isLastPage}
-                        <a href="{$categories->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     {$form.tag}
         <table width="700" cellspacing="0" cellpadding="0" border="0">
             <tr>
@@ -65,7 +35,7 @@
                 <th class="adminRowR" width="20%">{t w="number_of_items"}</th>
                 <th class="adminRowR" width="35%">{t w="actions"}</th>
             </tr>
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="3">{$categories->getBrowseBar()}</td></tr>
             {foreach from=$categories->set item="category"}
                 <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                     <td class="adminRowL">{$category.title}</td>
@@ -78,7 +48,7 @@
                     </td>
                 </tr>
             {/foreach}
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="3">{$categories->getBrowseBar()}</td></tr>
             <tr>
                 <td class="adminRowLNB" colspan="3">
                     <p class="subline">{t w="total"}: {$categories->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -21,36 +21,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $comments->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="4">
-                    <p class="subline">
-                    {if ! $comments->isFirstPage}
-                        <a href="{$comments->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$comments->pages item="page"}
-                        {if $page == $comments->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$comments->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $comments->isLastPage}
-                        <a href="{$comments->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     {if $item}
         <tr>
@@ -83,7 +53,7 @@
             <th class="adminRowL" width="30%">{t w="comment"}</th>
             <th class="adminRowR" width="18%">{t w="actions"}</th>
         </tr>
-        {$browsebar}
+        <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
         {foreach from=$comments->set item="comment"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
                 <td class="adminRowL">
@@ -126,7 +96,7 @@
                 </td>
             </tr>
         {/foreach}
-        {$browsebar}
+        <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
         <tr>
             <td class="adminRowLNB" colspan="4">
                 <p class="subline">{t w="total"}: {$comments->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/images.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/images.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/images.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $images->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="7">
-                    <p class="subline">
-                    {if ! $images->isFirstPage}
-                        <a href="{$images->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$images->pages item="page"}
-                        {if $page == $images->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$images->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $images->isLastPage}
-                        <a href="{$images->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     {$form.tag}
         {$form.action.html}
         <table width="700" cellspacing="0" cellpadding="0" border="0">
@@ -70,7 +40,7 @@
                 <th class="adminRowL" width="14%">{t w="dimensions"}</th>
                 <th class="adminRowR" width="10%">{t w="actions"}</th>
             </tr>
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="7">{$images->getBrowseBar()}</td></tr>
             {foreach from=$images->set item="image"}
                 <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                     <td class="adminRowL" valign="top">{$image->getLastModified()|date:'%Y/%m/%d %H:%M'}</td>
@@ -89,7 +59,7 @@
                     </td>
                 </tr>
             {/foreach}
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="7">{$images->getBrowseBar()}</td></tr>
             <tr>
                 <td class="adminRowLNB" colspan="7">
                     <p class="subline">{t w="total"}: {$images->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -39,36 +39,6 @@
 
     <p class="title">{t w="h_contents"} &raquo; {t w="select_image"}</p>
 
-    {capture assign="browsebar"}
-        {if $images->pages}
-            <tr>
-                <td class="adminRowR" colspan="5" style="border-top: 1px solid #DDDDDD;">
-                    <p class="subline">
-                    {if ! $images->isFirstPage}
-                        <a href="{$images->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$images->pages item="page"}
-                        {if $page == $images->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$images->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $images->isLastPage}
-                        <a href="{$images->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     {$form.tag}
         {$form.action.html}
         <table width="100%" cellspacing="0" cellpadding="0" border="0">
@@ -80,7 +50,7 @@
                 <td class="adminRowR" colspan="1">{$form._cmdSubmit.html}</td>
             </tr>
         {if $images->set}
-            {$browsebar}
+            <tr><td colspan="5">{$images->getBrowseBar()}</td></tr>
             {foreach from=$images->set item="image_row"}
             <tr>
                 {foreach from=$image_row item="image"}
@@ -109,7 +79,7 @@
                 {/foreach}
             </tr>
             {/foreach}
-            {$browsebar}
+            <tr><td colspan="5">{$images->getBrowseBar()}</td></tr>
             <tr>
                 <td class="adminRowLNB" colspan="5">
                     <p class="subline">{t w="total"}: {$images->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/items.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $items->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="4">
-                    <p class="subline">
-                    {if ! $items->isFirstPage}
-                        <a href="{$items->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$items->pages item="page"}
-                        {if $page == $items->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$items->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $items->isLastPage}
-                        <a href="{$items->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
         <th colspan="3" class="adminRowLG">
@@ -69,7 +39,7 @@
             <th class="adminRowL" width="26%">{t w="title"}</th>
             <th class="adminRowR" width="22%">{t w="actions"}</th>
         </tr>
-        {$browsebar}
+        <tr><td class="adminRowR" colspan="4">{$items->getBrowseBar()}</td></tr>
         {foreach from=$items->set item="item"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $item.is_draft eq '1'}style="color: gray"{/if}>
                 <td class="adminRowL">
@@ -103,7 +73,7 @@
                 </td>
             </tr>
         {/foreach}
-        {$browsebar}
+        <tr><td class="adminRowR" colspan="4">{$items->getBrowseBar()}</td></tr>
         <tr>
             <td class="adminRowLNB" colspan="4">
                 <p class="subline">{t w="total"}: {$items->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/items_gallery.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $images->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="7">
-                    <p class="subline">
-                    {if ! $images->isFirstPage}
-                        <a href="{$images->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$images->pages item="page"}
-                        {if $page == $images->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$images->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $images->isLastPage}
-                        <a href="{$images->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
         <th class="adminRowLG" colspan="7">
@@ -96,7 +66,7 @@
                 <th class="adminRowL" width="14%">{t w="dimensions"}</th>
                 <th class="adminRowR" width="10%">{t w="actions"}</th>
             </tr>
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="7">{$images->getBrowseBar()}</td></tr>
             {foreach from=$images->set item="image"}
                 <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                     <td class="adminRowL" valign="top">{$image->getLastModified()|date:'%Y/%m/%d %H:%M'}</td>
@@ -127,7 +97,7 @@
                     </td>
                 </tr>
             {/foreach}
-            {$browsebar}
+            <tr><td class="adminRowR" colspan="7">{$images->getBrowseBar()}</td></tr>
             <tr>
                 <td class="adminRowLNB" colspan="5">
                     <p class="subline">{t w="total"}: {$images->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/links.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/links.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $links->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="4">
-                    <p class="subline">
-                    {if ! $links->isFirstPage}
-                        <a href="{$links->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$links->pages item="page"}
-                        {if $page == $links->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$links->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $links->isLastPage}
-                        <a href="{$links->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
         <th colspan="3" class="adminRowLG">&raquo; {t w="a_links"}</th>
@@ -64,6 +34,7 @@
             <th class="adminRowR" width="10%">{t w="num_visits"}</th>
             <th class="adminRowR" width="20%">{t w="actions"}</th>
         </tr>
+        <tr><td class="adminRowR" colspan="4">{$links->getBrowseBar()}</td></tr>
         {foreach from=$links->set item="link"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                 <td class="adminRowL">{$link.title}</td>
@@ -76,6 +47,7 @@
                 </td>
             </tr>
         {/foreach}
+        <tr><td class="adminRowR" colspan="4">{$links->getBrowseBar()}</td></tr>
         <tr>
             <td class="adminRowLNB" colspan="4">
                 <p class="subline">{t w="total"}: {$links->totalRows}</p>

Modified: YDFramework2.0/trunk/examples/weblog/manage/pages.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-09-25 11:22:32 UTC (rev 2162)
+++ YDFramework2.0/trunk/examples/weblog/manage/pages.tpl	2006-09-25 11:32:11 UTC (rev 2163)
@@ -19,36 +19,6 @@
 
 {if $YD_ACTION == 'default'}
 
-    {capture assign="browsebar"}
-        {if $pages->totalPages > 1}
-            <tr>
-                <td class="adminRowR" colspan="4">
-                    <p class="subline">
-                    {if ! $pages->isFirstPage}
-                        <a href="{$pages->getPreviousUrl()}" class="subline">&laquo;</a>
-                    {else}
-                        &laquo;
-                    {/if}
-                    |
-                    {foreach from=$pages->pages item="page"}
-                        {if $page == $pages->page}
-                            <b>{$page}</b>
-                        {else}
-                            <a href="{$pages->getPageUrl($page)}" class="subline">{$page}</a>
-                        {/if}
-                    {/foreach}
-                    |
-                    {if ! $pages->isLastPage}
-                        <a href="{$pages->getNextUrl()}" class="subline">&raquo;</a>
-                    {else}
-                        &raquo;
-                    {/if}
-                    </p>
-                </td>
-            </tr>
-        {/if}
-    {/capture}
-
     <table width="700" cellspacing="0" cellpadding="0" border="0">
     <tr>
         <th colspan="3" class="adminRowLG">&raquo; {t w="a_pages"}</th>
@@ -64,6 +34,7 @@
             <th class="adminRowL" width="30%">{t w="title"}</th>
             <th class="adminRowR" width="18%">{t w="actions"}</th>
         </tr>
+        <tr><td class="adminRowR" colspan="4">{$pages->getBrowseBar()}</td></tr>
         {foreach from=$pages->set item="page"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $page.is_draft eq '1'}style="color: gray"{/if}>
                 <td class="adminRowL">
@@ -91,6 +62,7 @@
                 </td>
             </tr>
         {/foreach}
+        <tr><td class="adminRowR" colspan="4">{$pages->getBrowseBar()}</td></tr>
         <tr>
             <td class="adminRowLNB" colspan="4">
                 <p class="subline">{t w="total"}: {$pages->totalRows}</p>



From pclaerhout at mail.berlios.de  Mon Sep 25 13:35:29 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 25 Sep 2006 13:35:29 +0200
Subject: [ydf-devel] r2164 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200609251135.k8PBZTEF025102@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-25 13:35:29 +0200 (Mon, 25 Sep 2006)
New Revision: 2164

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl
Log:
Fixed some layout issues with the new browse bars.

Modified: YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl	2006-09-25 11:32:11 UTC (rev 2163)
+++ YDFramework2.0/trunk/examples/weblog/manage/images_selector.tpl	2006-09-25 11:35:29 UTC (rev 2164)
@@ -50,7 +50,7 @@
                 <td class="adminRowR" colspan="1">{$form._cmdSubmit.html}</td>
             </tr>
         {if $images->set}
-            <tr><td colspan="5">{$images->getBrowseBar()}</td></tr>
+            <tr><td class="adminRowR" colspan="5">{$images->getBrowseBar()}</td></tr>
             {foreach from=$images->set item="image_row"}
             <tr>
                 {foreach from=$image_row item="image"}
@@ -79,7 +79,7 @@
                 {/foreach}
             </tr>
             {/foreach}
-            <tr><td colspan="5">{$images->getBrowseBar()}</td></tr>
+            <tr><td class="adminRowR" colspan="5">{$images->getBrowseBar()}</td></tr>
             <tr>
                 <td class="adminRowLNB" colspan="5">
                     <p class="subline">{t w="total"}: {$images->totalRows}</p>



From pclaerhout at mail.berlios.de  Mon Sep 25 21:48:54 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 25 Sep 2006 21:48:54 +0200
Subject: [ydf-devel] r2165 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609251948.k8PJmsw0011616@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-25 21:48:54 +0200 (Mon, 25 Sep 2006)
New Revision: 2165

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
YDDatabase::_logSql now only keeps track of the sql statements if YD_DEBUG is 1 or 2.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-25 11:35:29 UTC (rev 2164)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-09-25 19:48:54 UTC (rev 2165)
@@ -1418,7 +1418,7 @@
 
         /**
          *  This function will log the SQL statement to the debug log and keep track of the number of queries that were
-         *  executed.
+         *  executed. This will only happen if YD_DEBUG equals 1 or 2
          *
          *  @param $sql The SQL statement to log.
          *
@@ -1426,34 +1426,39 @@
          */
         function _logSql( $sql ) {
 
-            // Split the SQL in different lines
-            $sql = str_ireplace( 'SELECT', 'SELECT', $sql );
-            $sql = str_ireplace( 'UPDATE', 'UPDATE', $sql );
-            $sql = str_ireplace( 'DELETE', 'DELETE', $sql );
-            $sql = str_ireplace( 'INSERT', 'INSERT', $sql );
-            $sql = str_ireplace( 'FROM', YD_CRLF . 'FROM', $sql );
-            $sql = str_ireplace( 'INTO', YD_CRLF . 'INTO', $sql );
-            $sql = str_ireplace( 'VALUES', YD_CRLF . 'VALUES', $sql );
-            $sql = str_ireplace( 'LEFT JOIN', YD_CRLF . 'LEFT JOIN', $sql );
-            $sql = str_ireplace( 'RIGHT JOIN', YD_CRLF . 'RIGHT JOIN', $sql );
-            $sql = str_ireplace( 'INNER JOIN', YD_CRLF . 'INNER JOIN', $sql );
-            $sql = str_ireplace( 'WHERE', YD_CRLF . 'WHERE', $sql );
-            $sql = str_ireplace( 'ORDER BY', YD_CRLF . 'ORDER BY', $sql );
-            $sql = str_ireplace( 'GROUP BY', YD_CRLF . 'GROUP BY', $sql );
-            $sql = str_ireplace( 'LIMIT', YD_CRLF . 'LIMIT', $sql );
+            // Show debugging info if needed
+            if ( YDConfig::get( 'YD_DEBUG' ) == 1 || YDConfig::get( 'YD_DEBUG' ) == 2 ) {
 
-            // Get the backtrace
-            $trace = debug_backtrace();
+                // Split the SQL in different lines
+                $sql = str_ireplace( 'SELECT', 'SELECT', $sql );
+                $sql = str_ireplace( 'UPDATE', 'UPDATE', $sql );
+                $sql = str_ireplace( 'DELETE', 'DELETE', $sql );
+                $sql = str_ireplace( 'INSERT', 'INSERT', $sql );
+                $sql = str_ireplace( 'FROM', YD_CRLF . 'FROM', $sql );
+                $sql = str_ireplace( 'INTO', YD_CRLF . 'INTO', $sql );
+                $sql = str_ireplace( 'VALUES', YD_CRLF . 'VALUES', $sql );
+                $sql = str_ireplace( 'LEFT JOIN', YD_CRLF . 'LEFT JOIN', $sql );
+                $sql = str_ireplace( 'RIGHT JOIN', YD_CRLF . 'RIGHT JOIN', $sql );
+                $sql = str_ireplace( 'INNER JOIN', YD_CRLF . 'INNER JOIN', $sql );
+                $sql = str_ireplace( 'WHERE', YD_CRLF . 'WHERE', $sql );
+                $sql = str_ireplace( 'ORDER BY', YD_CRLF . 'ORDER BY', $sql );
+                $sql = str_ireplace( 'GROUP BY', YD_CRLF . 'GROUP BY', $sql );
+                $sql = str_ireplace( 'LIMIT', YD_CRLF . 'LIMIT', $sql );
 
-            // Format the SQL
-            $sql_final = '';
-            foreach ( explode( YD_CRLF, $sql ) as $line ) {
-                $sql_final .= '[' . $trace[2]['file'] . ':' . $trace[2]['line'] . '] ' . $line . YD_CRLF;
+                // Get the backtrace
+                $trace = debug_backtrace();
+
+                // Format the SQL
+                $sql_final = '';
+                foreach ( explode( YD_CRLF, $sql ) as $line ) {
+                    $sql_final .= '[' . $trace[2]['file'] . ':' . $trace[2]['line'] . '] ' . $line . YD_CRLF;
+                }
+
+                // Add it to the query log
+                array_push( $GLOBALS['YD_SQL_QUERY'], $sql_final );
+
             }
 
-            // Add it to the query log
-            array_push( $GLOBALS['YD_SQL_QUERY'], $sql_final );
-
         }
 
         /**



From rene at reneschmidt.de  Wed Sep 27 16:24:22 2006
From: rene at reneschmidt.de (Rene Schmidt)
Date: Wed, 27 Sep 2006 16:24:22 +0200
Subject: [ydf-devel] question on YDDatabaseObject::fetch()
Message-ID: <1159367062.5140.28.camel@callisto>

Hello there,

there is this line in YDDatabaseObject::fetch():

$res = array_shift( $this->_results );

It deletes the first element in the array. Why is this being done? I
don't understand that.

The  SQL statement that gets generated in my project yields n records as
it should, where after calling fetch() method getResults() yields only
n-1 records, which is plain wrong. Deleting the line makes fetch() work
as I intend.

Any clues?
-- 
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce 
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/



From rene at reneschmidt.de  Wed Sep 27 16:39:17 2006
From: rene at reneschmidt.de (Rene Schmidt)
Date: Wed, 27 Sep 2006 16:39:17 +0200
Subject: [ydf-devel] Proposal on YDDatabaseObject::find()
Message-ID: <1159367957.5140.43.camel@callisto>

Hello it's me again :)

I have a proposal to make for method YDDatabaseObject::find()

The current version of this method is very cumbersome to subclass.
Fetching the arguments with get_func_args() is what's causing troubles.
You cannot subclass properly:

class my_class extends YDDatabaseObject {

  // won't work
  function myfind() {
    // do things
    // blabla
    $args = get_func_args();
    return parent::find($args);
  }

  // won't work
  function myfind() {
    // do things
    // blabla
    return parent::find(get_func_args());
  }

  // won't work properly, e.g. when there are more than two arguments
  function myfind($arg1,$arg2) {
    // do things
    // blabla
    return parent::find($arg1,$arg2);
  }

}

class YDDatabaseobject {

  function find() {
    $args = get_func_args();
    // and so on
  }
}

Furthermore, method definition (and API doc) does not mention there are
optional arguments for this method which wasted some of my life time
because I mostly only look at the API doc.

My proposal is to define an associative array argument for find() where
one can put as many arguments as he wishes. The method would be
subclassable also.

Your opinion?
-- 
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce 
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/



From muitocomplicado at gmail.com  Wed Sep 27 18:00:10 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Wed, 27 Sep 2006 13:00:10 -0300
Subject: [ydf-devel] question on YDDatabaseObject::fetch()
In-Reply-To: <1159367062.5140.28.camel@callisto>
References: <1159367062.5140.28.camel@callisto>
Message-ID: <12260be20609270900p2f29bc26v4421037984816bc7@mail.gmail.com>

The idea is to use fetch() or getResults() but not both. fetch() always
populate the object with the first result of the results array. So when
there is no more results, fetch() returns false. For example:

$db->find();

while ( $db->fetch() ) {
  $arr = $db->getValues();
  // do something
}

If you are using fetch() to know if there are results, use count() instead.

-db


On 9/27/06, Rene Schmidt <rene at reneschmidt.de> wrote:
>
> Hello there,
>
> there is this line in YDDatabaseObject::fetch():
>
> $res = array_shift( $this->_results );
>
> It deletes the first element in the array. Why is this being done? I
> don't understand that.
>
> The  SQL statement that gets generated in my project yields n records as
> it should, where after calling fetch() method getResults() yields only
> n-1 records, which is plain wrong. Deleting the line makes fetch() work
> as I intend.
>
> Any clues?
> --
> Rene Schmidt
> Berater f?r Web-Entwicklung und eCommerce
> Lange Str. 15, 21614 Buxtehude
> Tel. 04161.558363 - http://www.reneschmidt.de/
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060927/399642e1/attachment.html>

From muitocomplicado at gmail.com  Wed Sep 27 18:08:40 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Wed, 27 Sep 2006 13:08:40 -0300
Subject: [ydf-devel] Proposal on YDDatabaseObject::find()
In-Reply-To: <1159367957.5140.43.camel@callisto>
References: <1159367957.5140.43.camel@callisto>
Message-ID: <12260be20609270908q220d6cb3o5ad0a5468d489d64@mail.gmail.com>

I understand. It's really not easy to subclass using variable function
arguments.

The problem in changing this behavior right now, is that it's going to break
a lot of code.

But in the next version of YDDatabaseObject, the find() method will be a
little different.

You could try using eval() to create your find() arguments. It's not
perfect, but I think it will work.

$args = get_func_args();
eval( "return parent::find( '" . implode( "', '", $args ) . "' );" );

-db

On 9/27/06, Rene Schmidt <rene at reneschmidt.de> wrote:
>
> Hello it's me again :)
>
> I have a proposal to make for method YDDatabaseObject::find()
>
> The current version of this method is very cumbersome to subclass.
> Fetching the arguments with get_func_args() is what's causing troubles.
> You cannot subclass properly:
>
> class my_class extends YDDatabaseObject {
>
>   // won't work
>   function myfind() {
>     // do things
>     // blabla
>     $args = get_func_args();
>     return parent::find($args);
>   }
>
>   // won't work
>   function myfind() {
>     // do things
>     // blabla
>     return parent::find(get_func_args());
>   }
>
>   // won't work properly, e.g. when there are more than two arguments
>   function myfind($arg1,$arg2) {
>     // do things
>     // blabla
>     return parent::find($arg1,$arg2);
>   }
>
> }
>
> class YDDatabaseobject {
>
>   function find() {
>     $args = get_func_args();
>     // and so on
>   }
> }
>
> Furthermore, method definition (and API doc) does not mention there are
> optional arguments for this method which wasted some of my life time
> because I mostly only look at the API doc.
>
> My proposal is to define an associative array argument for find() where
> one can put as many arguments as he wishes. The method would be
> subclassable also.
>
> Your opinion?
> --
> Rene Schmidt
> Berater f?r Web-Entwicklung und eCommerce
> Lange Str. 15, 21614 Buxtehude
> Tel. 04161.558363 - http://www.reneschmidt.de/
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060927/abd536ee/attachment.html>

From rene at reneschmidt.de  Wed Sep 27 19:48:35 2006
From: rene at reneschmidt.de (Rene Schmidt)
Date: Wed, 27 Sep 2006 19:48:35 +0200
Subject: [ydf-devel] question on YDDatabaseObject::fetch()
In-Reply-To: <12260be20609270900p2f29bc26v4421037984816bc7@mail.gmail.com>
References: <1159367062.5140.28.camel@callisto>
	<12260be20609270900p2f29bc26v4421037984816bc7@mail.gmail.com>
Message-ID: <1159379316.5140.50.camel@callisto>

Am Mittwoch, den 27.09.2006, 13:00 -0300 schrieb David Bittencourt:
> The idea is to use fetch() or getResults() but not both. fetch() 

Thank you, using fetch() unnecessarily was my problem... :)

Did I say YDDatabaseObject is a very nice addon to YDF... This is what I
was missing in YDF after reviewing some MVC frameworks.

-- 
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce 
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 191 bytes
Desc: Dies ist ein digital signierter Nachrichtenteil
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20060927/295c5fdc/attachment.pgp>

From pclaerhout at mail.berlios.de  Wed Sep 27 20:20:54 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 27 Sep 2006 20:20:54 +0200
Subject: [ydf-devel] r2166 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609271820.k8RIKssB021548@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-27 20:20:53 +0200 (Wed, 27 Sep 2006)
New Revision: 2166

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Added YDRequest::getRequiredQueryStringParameterAsInt.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-25 19:48:54 UTC (rev 2165)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-09-27 18:20:53 UTC (rev 2166)
@@ -146,6 +146,23 @@
         }
 
         /**
+         *  Get the value of a query string variable. When the required parameter is not set, it will redirect to the
+         *  indicated action.
+         *
+         *  @param  $name               The name of the query string variable.
+         *  @param  $default            (optional) The default value if the query string variable is not existing.
+         *  @param  $values             (optional) The allowed values as an array.
+         *  @param  $action_if_fails    (optional) The action to redirect of if the parameter is invalid.
+         *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
+         *
+         *  @returns    The value of the query string variable as a integer.
+         */
+        function getRequiredQueryStringParameterAsInt( $name, $default='', $values=null, $action_if_fails='default', $use_keys=false ) {
+            $value = $this->getRequiredQueryStringParameter( $name, $default, $values, $use_keys );
+            return is_numeric( $value ) ? intval( $value ) : $default;
+        }
+
+        /**
          *	This function will return the full URL to the current request, including hostname, port and request URI.
          *
          *  @param  $no_qs  (optional) If set to false, the query string will be omitted. Default is false.



From pclaerhout at mail.berlios.de  Wed Sep 27 20:48:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 27 Sep 2006 20:48:23 +0200
Subject: [ydf-devel] r2167 - in YDFramework2.0/trunk/YDFramework2: .
	YDClasses
Message-ID: <200609271848.k8RImNLR024619@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-27 20:48:23 +0200 (Wed, 27 Sep 2006)
New Revision: 2167

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Added support for parameters to the t function and template function.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-27 18:20:53 UTC (rev 2166)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-27 18:48:23 UTC (rev 2167)
@@ -501,11 +501,32 @@
      *  @returns    The named translation.
      */
     function YDTemplate_function_t( $params ) {
-        if ( @ $params['lower'] == 'yes' ) {
-            return isset( $params['w'] ) ? strtolower( t( $params['w'] ) ) : '';
+
+        // Check if the word is specified
+        if ( isset( $params['w'] ) ) {
+
+            // Get the word and lowercase setting
+            $word = $params['w'];
+            $lower = ( @ $params['lower'] == 'yes' ) ? true : false;
+
+            // Remove unneeded parameters
+            unset( $params['lower'] );
+            unset( $params['w'] );
+
+            // Get the translated word
+            $word = t( $word, $params );
+
+            // Return it
+            return ( $lower === true ) ? strtolower( $word ) : $word;
+
+        // No word specified
         } else {
-            return isset( $params['w'] ) ? t( $params['w'] ) : '';
+
+            // Return an empty string
+            return '';
+
         }
+
     }
 
     /**

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-27 18:20:53 UTC (rev 2166)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-27 18:48:23 UTC (rev 2167)
@@ -263,12 +263,14 @@
      *
      *  @returns    The translated string.
      */
-    function t( $t ) {
+    function t( $t, $params=array() ) {
         if ( empty( $t ) ) {
             return '';
         }
         $t = strtolower( $t );
-        return ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
+        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
+        array_unshift( $params, $out );
+        return call_user_func_array( 'sprintf', $params );
     }
 
     /**



From pclaerhout at mail.berlios.de  Wed Sep 27 21:03:10 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 27 Sep 2006 21:03:10 +0200
Subject: [ydf-devel] r2168 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200609271903.k8RJ3APf026526@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-27 21:03:10 +0200 (Wed, 27 Sep 2006)
New Revision: 2168

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Fixed an error in the t function where sprintf was trying to replace % it shouldn't.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-27 18:48:23 UTC (rev 2167)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2006-09-27 19:03:10 UTC (rev 2168)
@@ -268,7 +268,7 @@
             return '';
         }
         $t = strtolower( $t );
-        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%$t%" );
+        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "<font color=\"red\">%%$t%%</font>" );
         array_unshift( $params, $out );
         return call_user_func_array( 'sprintf', $params );
     }



From pclaerhout at mail.berlios.de  Fri Sep 29 14:01:50 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 29 Sep 2006 14:01:50 +0200
Subject: [ydf-devel] r2169 -
	YDFramework2.0/trunk/YDFramework2/addons/YDBBCode
Message-ID: <200609291201.k8TC1obE002409@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-29 14:01:49 +0200 (Fri, 29 Sep 2006)
New Revision: 2169

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
Log:
Added support for quotes and doublequotes (not finished yet).

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-09-27 19:03:10 UTC (rev 2168)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2006-09-29 12:01:49 UTC (rev 2169)
@@ -67,6 +67,9 @@
             $this->addRule( "/\[img=([^<> \n]+?)\](.+?)\[\/img\]/i", '<a href="\\1"><img border="0" src="\\2" alt="\\2" /></a>' );
             $this->addRule( "/\[img\]([^<> \n]+?)\[\/img\]/i", '<img border="0" src="\\1" alt="\\1" />' );
             $this->addRule( "/\[color=([^<> \n]+?)\](.+?)\[\/color\]/i", '<font color="\\1">\\2</font>' );
+            $this->addRule( "/\[quote](.+?)\[\/quote\]/msi", '<blockquote>\\1</blockquote>' );
+            $this->addRule( "/\[quote=\"([^<> \n]+?)\"\](.+?)\[\/quote\]/msi", '<blockquote><b>\\1</b><br/>\\2</blockquote>' );
+            $this->addRule( "/\[quote=([^<> \n]+?)\](.+?)\[\/quote\]/msi", '<blockquote><b>\\1</b><br/>\\2</blockquote>' );
 
             // Attributes to convert links
             $this->_convertLinks = array(



From pclaerhout at mail.berlios.de  Fri Sep 29 14:02:32 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 29 Sep 2006 14:02:32 +0200
Subject: [ydf-devel] r2170 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200609291202.k8TC2W7O002480@sheep.berlios.de>

Author: pclaerhout
Date: 2006-09-29 14:02:32 +0200 (Fri, 29 Sep 2006)
New Revision: 2170

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
The bbcode template modifier now correctly converts links to a href combo's.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-29 12:01:49 UTC (rev 2169)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2006-09-29 12:02:32 UTC (rev 2170)
@@ -539,7 +539,7 @@
     function YDTemplate_modifier_bbcode( $text ) {
         YDInclude( 'YDBBCode.php' );
         $cls = new YDBBCode();
-        return $cls->toHtml( $text, true, false, false, YDRequest::getCurrentUrl() );
+        return $cls->toHtml( $text, true, false, true, YDRequest::getCurrentUrl() );
     }
 
     /**



