From ximian at mail.berlios.de  Wed Nov  1 02:10:00 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Wed, 1 Nov 2006 02:10:00 +0100
Subject: [ydf-devel] r2195 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611010110.kA11A0p2019016@sheep.berlios.de>

Author: ximian
Date: 2006-11-01 02:09:59 +0100 (Wed, 01 Nov 2006)
New Revision: 2195

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
- new method YDForm::getElements that returns all form elements

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-10-30 23:56:59 UTC (rev 2194)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-11-01 01:09:59 UTC (rev 2195)
@@ -474,8 +474,19 @@
             return $element;
 
         }
-        
+
+
         /**
+         *  This function returns all form elements
+         *
+         *  @returns    An array with form elements
+         */
+        function getElements() {
+            return $this->_elements;
+        }
+
+
+        /**
          *  Checks if a form element name is already defined.
          *
          *  @param  $name    The element name



From ximian at mail.berlios.de  Wed Nov  1 02:11:29 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Wed, 1 Nov 2006 02:11:29 +0100
Subject: [ydf-devel] r2196 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200611010111.kA11BTLq019379@sheep.berlios.de>

Author: ximian
Date: 2006-11-01 02:11:28 +0100 (Wed, 01 Nov 2006)
New Revision: 2196

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
Log:
- on checkboxgroup:
  * NEW FEATURE: 'select all' will not be displayed if we have less than 2 items enabled

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2006-11-01 01:09:59 UTC (rev 2195)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2006-11-01 01:11:28 UTC (rev 2196)
@@ -221,17 +221,21 @@
                 if ( $this->_position == 'right' ) $output[] = $item->toHtml() . '&nbsp;<label for="' . $item->_attributes['id'] . '">' . $item->_label . '</label>';
                 else                               $output[] = '<label for="' . $item->_attributes['id'] . '">' . $item->_label . '</label>&nbsp;' . $item->toHtml();
 
+			// check if we have more than one item enabled, otherwise the 'select all' will not be displayed
+			$checkboxesEnabled = 0;
+			foreach( $this->_items as $item ){
+				if ( $item->isDisabled() == false ){
+					$checkboxesEnabled ++;
+					if ( $checkboxesEnabled == 2 ) break; 
+				}
+			}
+
 			// init the 'select all' html
 			$selall_html = '';
 
-			// if all checkboxes are disabled, the 'select all' will not be displayed
-			$allCheckboxesDisabled = true;
-			foreach( $this->_items as $item )
-				if ( $item->isDisabled() == false ){ $allCheckboxesDisabled = false; break; }
+			// check if: user wants a 'select all', we have more than one item in checkboxgroup, we have more than one item enabled
+			if ( $this->_addSelectAll && count( $this->_items ) > 1 && $checkboxesEnabled > 1 ){ 
 
-			// check if we have more than one element and a 'select all' button is defined
-			if ( $allCheckboxesDisabled == false && count( $this->_items ) > 1 && $this->_addSelectAll ){ 
-
 				// compute button code
 				$selall = new YDFormElement_Checkbox( $this->_form, $this->getAttribute( 'id' ) . 'sall' );
 				$selall->setAttribute( 'onclick', 'for (var i=0;i<document.forms[\''. $this->_form . '\'].elements.length;i++) if (document.forms[\''. $this->_form . '\'].elements[i].type==\'checkbox\' && !document.forms[\''. $this->_form . '\'].elements[i].disabled && /' . $this->_name . '\[[a-zA-Z0-9]+\]/.test( document.forms[\''. $this->_form . '\'].elements[i].name ) ) document.forms[\''. $this->_form . '\'].elements[i].checked = this.checked;' );



From maximus_meridius79 at yahoo.com  Wed Nov  1 05:29:50 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Tue, 31 Oct 2006 20:29:50 -0800 (PST)
Subject: [ydf-devel] Query builder
Message-ID: <20061101042950.7294.qmail@web54002.mail.yahoo.com>

Hi Francisco,

The filter is useful for inserts if you want to set
default values for 
fields where this is no defined by the SQL schema.
This is the 
implementation I have put into the updated version of
YDDatabaseTree 
(see attachment to previous e-mail in
YDDatabaseTree2::addNode method).  
This is useful in the absence of views. An "equals"
filter is all that 
would be used for an insert so I suppose it is really
a default rather 
than a filter. YDDatabaseObject doesn't seem to
explicitly provide 
defaults that wouldn't be cleared by a reset. Perhaps
some default 
method like the YDDatabaseTree2::setAddDefaults method
I created would 
be useful in YDDatabaseObject.
> My primary intention was for selects and to be used
with YDDatabaseObject
> only.
>
> so, filters can be:
>
> - a "is" value in range.  eg,  COLOR  is   <select>
>   some value in a pre-defined select box
>
> - a "is one or more".  eg,  COLOR  is  <multi
select>
>   some value(s) in a pre-defined "multiple select"
or "checkboxgroup"
>
> - a "like" value.  eg,  COLOR  contains  <text>
>   a value that is like some string inserted in a
text box
>
> - a "is" value.  eg,  PRICE  is  <text>
>   a value that is equal to some "text"
>
> - a "between".  eg,  PRICE is between  <text1> and
<text2>
>  a value that is between 2 text box values
>   
Another nice feature would be to filter a field based
on a regular 
expression to form an advanced "like".

Regards,

Graeme



 
____________________________________________________________________________________
Want to start your own business? Learn how on Yahoo! Small Business 
(http://smallbusiness.yahoo.com) 



From maximus_meridius79 at yahoo.com  Sun Nov  5 07:51:57 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Sat, 4 Nov 2006 22:51:57 -0800 (PST)
Subject: [ydf-devel] xajax 0.5 beta
Message-ID: <20061105065157.40608.qmail@web54009.mail.yahoo.com>

  Hi all,

I was looking at the xajax site and noticed that there is a beta ofxajax 0.5 available and is something to keep an eye on.

The release notes are in the download at http://prdownloads.sourceforge.net/xajax/xajax_0.5_beta1.zip?download

A major change is the addition of a plugin layer which will be usefulfor integrating custom functionality.

The changes are quite significant and it is described in the readme asan early beta. There is a compatibility layer for old versions thatwill eventually be phased out.

Regards,

Graeme


--------------050603040901000502090005--
 
---------------------------------
We have the perfect Group for you. Check out the handy changes to Yahoo! Groups.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061104/c486f713/attachment.html>

From francisco at fusemail.com  Sun Nov  5 17:24:34 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 05 Nov 2006 16:24:34 +0000
Subject: [ydf-devel] xajax 0.5 beta
In-Reply-To: <20061105065157.40608.qmail@web54009.mail.yahoo.com>
References: <20061105065157.40608.qmail@web54009.mail.yahoo.com>
Message-ID: <454E1042.2040705@fusemail.com>

Hi Graeme

I have already read the release notes and yes, there are lots of changes.
Maybe we should upgrade the xajax used in YDAjax with the _stable_ xajax 
release..

What do you think?


regards
Francisco A


> I was looking at the xajax site and noticed that there is a beta of 
> xajax 0.5 available and is something to keep an eye on.
> 
> The release notes are in the download at 
> http://prdownloads.sourceforge.net/xajax/xajax_0.5_beta1.zip?download
> 
> A major change is the addition of a plugin layer which will be useful 
> for integrating custom functionality.
> 
> The changes are quite significant and it is described in the readme as 
> an early beta. There is a compatibility layer for old versions that will 
> eventually be phased out.



From francisco at fusemail.com  Sun Nov  5 17:58:54 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 05 Nov 2006 16:58:54 +0000
Subject: [ydf-devel] YDDatabaseTree2  :)
Message-ID: <454E184E.7050006@fusemail.com>

Hi all

I have created a new YDDatabaseTree. This is not a YDDatabaseTree 
extension but a new tree management implementation with a different 
algorithm.

The main difference is.. speed! and position support!  ;)

Let's see the differences in more details:


Columns used:
	- on YDDT:  id, parent, nleft, nright, nlevel
	- on YDDT2; id, parent,       lineage,  level, position

	on YDDT2, the control part is done with 'lineage' instead of
	          'nleft' and 'nright'


Qty of queries:

on selects:
	- all algorithms only use 1 or 2 sql queries to get results.

on adding a node in a table with 1000 nodes already:
	- YDDT uses more than 1000 queries
	  (because it needs to rebuild the table)
	- YDDT2 uses 2 sql queries

on moving a node in a table with 1000 nodes already
	- YDDT: uses more than 1000 queries
	        don't have support for position
	- YDDT2 uses 4 sql queries (with position support)

on deleting a node in a table with 100 nodes already:
	- YDDT uses more than 1000 queries
	  (because it needs to rebuild the table)
	- YDDT2 uses 2 sql queries
	  (and, if table type InnoDB, children are deleted automaticaly)

So, where is the magic.. basically YDDT2 uses what i called the 
'lineage' instead of 'nleft' and 'nright'. Lineage is the id path to the 
node.
Eg, imagine a tree like:

.
+- A
|
+- B
|  +- C
|     +- X


The lineages are:

.
+- A  lineage: //
|
+- B  lineage: //
|  +- C  lineage: //B/
|     +- X  lineage: //B/C/


Lineage always start with '//', then contains all parent id nodes 
separated by '/' and has an '/' in the end.


This means that each node info is only dependent of the parent, i mean, 
the only "rebuild" that is need on node operations is to update some 
lineage's (but not all like in YDDT).. and in opposition to YDDT, this 
simple "rebuild" can be done in just 1 sql query in YDDT2.

I will put this new class in YDF in next days (maybe tomorrow).

To be a perfect class, i think the YDDT2 should be done using 
YDDatabaseObject (currently it uses the common YDDatabase methods).
The problem is that i don't know how to do some things using 
YDDatabaseObject.. maybe db can help me here..

Db, how can i:
- unregister a key?
- unregister a field?
- currently in a UPDATE, i can set values like:
	$dbo->resetValues();
	$dbo->set( 'xpto', 3 );
	$dbo->update();

	but.. how can i define expressions?
	On YDDT2 i have this sql:
	UPDATE *table* SET REPLACE(...) WHERE ...

	Can i (??) do something like:
	$dbo->resetValues();
	$dbo->set( 'REPLACE(...)' );
	$dbo->where( ... )
	$dbo->update();

	if not, how can i do this?


Anyway, what do you think?


regards
Francisco A



From maximus_meridius79 at yahoo.com  Mon Nov  6 11:21:40 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 6 Nov 2006 02:21:40 -0800 (PST)
Subject: [ydf-devel] xajax 0.5 beta
Message-ID: <20061106102140.23218.qmail@web54003.mail.yahoo.com>

  Hi Francisco,

I agree that we should wait until 0.5 stabilises.

The plugins will hopefully make it more straightforward to develop anajax datagrid for YDAjax that can source its data fromYDDatabaseObject, etc.

On another note I noticed that moo.fx has just been updated andreleased as moo.fx2 ( http://moofx.mad4milk.net/). moo.fx can now use prototype.lite, prototype or mootools to addeven more choice. There is the warning that moo.fx2 is incompatiblewith the old moo.fx and that some scripts may break. The old moo.fx isfound at http://moofx.mad4milk.net/old/.

Regards,

Graeme

Francisco Azevedo wrote:  
Hi GraemeI have already read the release notes and yes, there are lots of changes.Maybe we should upgrade the xajax used in YDAjax with the _stable_ xajax release..What do you think?regardsFrancisco A  
      
I was looking at the xajax site and noticed that there is a beta of xajax 0.5 available and is something to keep an eye on.The release notes are in the download at http://prdownloads.sourceforge.net/xajax/xajax_0.5_beta1.zip?downloadA major change is the addition of a plugin layer which will be useful for integrating custom functionality.The changes are quite significant and it is described in the readme as an early beta. There is a compatibility layer for old versions that will eventually be phased out.    
    
_______________________________________________YDFramework-devel mailing listYDFramework-devel at lists.berlios.dehttps://lists.berlios.de/mailman/listinfo/ydframework-devel  


 
---------------------------------
Access over 1 million songs - Yahoo! Music Unlimited Try it today.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061106/d4ed792f/attachment.html>

From maximus_meridius79 at yahoo.com  Mon Nov  6 12:01:28 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 6 Nov 2006 03:01:28 -0800 (PST)
Subject: [ydf-devel] YDDatabaseTree2 :)
Message-ID: <20061106110128.58681.qmail@web54008.mail.yahoo.com>

Hi Francisco,

It's a good change to make a new YDDatabaseTree based
on 
YDDatabaseObject. I didn't attempt it with my version
of YDDatabaseTree2 
since I am very much a novice with YDDatabaseObject.

The implementation you propose would allow a scenario
where multiple 
module or users data (i.e. in subtrees) are stored in
a single tree 
table with less risk of a rebuild corrupting data
amongst subtrees. 
Subtrees / branches specific to a user could then be
stored in a subtree 
with a root node based on their user id or some
combination of fields.

I look forward to seeing the new class.

Thanks,

Graeme

Francisco Azevedo wrote:
> Hi all
>
> I have created a new YDDatabaseTree. This is not a
YDDatabaseTree 
> extension but a new tree management implementation
with a different 
> algorithm.
>
> The main difference is.. speed! and position
support!  ;)
>
> Let's see the differences in more details:
>
>
> Columns used:
> 	- on YDDT:  id, parent, nleft, nright, nlevel
> 	- on YDDT2; id, parent,       lineage,  level,
position
>
> 	on YDDT2, the control part is done with 'lineage'
instead of
> 	          'nleft' and 'nright'
>
>
> Qty of queries:
>
> on selects:
> 	- all algorithms only use 1 or 2 sql queries to get
results.
>
> on adding a node in a table with 1000 nodes already:
> 	- YDDT uses more than 1000 queries
> 	  (because it needs to rebuild the table)
> 	- YDDT2 uses 2 sql queries
>
> on moving a node in a table with 1000 nodes already
> 	- YDDT: uses more than 1000 queries
> 	        don't have support for position
> 	- YDDT2 uses 4 sql queries (with position support)
>
> on deleting a node in a table with 100 nodes
already:
> 	- YDDT uses more than 1000 queries
> 	  (because it needs to rebuild the table)
> 	- YDDT2 uses 2 sql queries
> 	  (and, if table type InnoDB, children are deleted
automaticaly)
>
> So, where is the magic.. basically YDDT2 uses what i
called the 
> 'lineage' instead of 'nleft' and 'nright'. Lineage
is the id path to the 
> node.
> Eg, imagine a tree like:
>
> .
> +- A
> |
> +- B
> |  +- C
> |     +- X
>
>
> The lineages are:
>
> .
> +- A  lineage: //
> |
> +- B  lineage: //
> |  +- C  lineage: //B/
> |     +- X  lineage: //B/C/
>
>
> Lineage always start with '//', then contains all
parent id nodes 
> separated by '/' and has an '/' in the end.
>
>
> This means that each node info is only dependent of
the parent, i mean, 
> the only "rebuild" that is need on node operations
is to update some 
> lineage's (but not all like in YDDT).. and in
opposition to YDDT, this 
> simple "rebuild" can be done in just 1 sql query in
YDDT2.
>
> I will put this new class in YDF in next days (maybe
tomorrow).
>
> To be a perfect class, i think the YDDT2 should be
done using 
> YDDatabaseObject (currently it uses the common
YDDatabase methods).
> The problem is that i don't know how to do some
things using 
> YDDatabaseObject.. maybe db can help me here..
>
> Db, how can i:
> - unregister a key?
> - unregister a field?
> - currently in a UPDATE, i can set values like:
> 	$dbo->resetValues();
> 	$dbo->set( 'xpto', 3 );
> 	$dbo->update();
>
> 	but.. how can i define expressions?
> 	On YDDT2 i have this sql:
> 	UPDATE *table* SET REPLACE(...) WHERE ...
>
> 	Can i (??) do something like:
> 	$dbo->resetValues();
> 	$dbo->set( 'REPLACE(...)' );
> 	$dbo->where( ... )
> 	$dbo->update();
>
> 	if not, how can i do this?
>
>
> Anyway, what do you think?
>
>
> regards
> Francisco A
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
>
https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>   



 
____________________________________________________________________________________
Low, Low, Low Rates! Check out Yahoo! Messenger's cheap PC-to-Phone call rates 
(http://voice.yahoo.com)



From muitocomplicado at gmail.com  Mon Nov  6 20:35:33 2006
From: muitocomplicado at gmail.com (David Bittencourt)
Date: Mon, 6 Nov 2006 16:35:33 -0300
Subject: [ydf-devel] YDDatabaseTree2 :)
In-Reply-To: <454E184E.7050006@fusemail.com>
References: <454E184E.7050006@fusemail.com>
Message-ID: <12260be20611061135i6ba47ecdgef41599b0ffc799e@mail.gmail.com>

There's no method to unregister a key/field, but you could just unset the
field name from the $_fields array. All keys and fields are on the same
array.

unset( $this->_fields['field_name'] );

If you think is good to have an unregister method, just add it to YDDOBJ.

You can't do UPDATE *table* SET REPLACE(...) WHERE ...

You can only update values of registered fields, and fields can't be
expressions. This REPLACE thing is a sub-query, right? Just note that only
from MySQL 4.1 up you can use them. I still use MySQL 4.0 in some projects.
But if you think it's a good requirement because of the performance boost,
then people can always use YDDT if needed.

Well, you could try to add support for expressions in values like the way we
do in SELECTs. Just add it to YDDatabaseQuery. YDDatabaseObject uses it to
build all the queries. If you make it work in YDDQ, then I see no problem in
adding to YDDOBJ. Even if we don't build a hole new interface for expression
values in YDDOBJ, you can always use the $_query object directly and use
YDDQ methods.

-db




On 11/5/06, Francisco Azevedo <francisco at fusemail.com> wrote:
>
>
> Db, how can i:
> - unregister a key?
> - unregister a field?
> - currently in a UPDATE, i can set values like:
>         $dbo->resetValues();
>         $dbo->set( 'xpto', 3 );
>         $dbo->update();
>
>         but.. how can i define expressions?
>         On YDDT2 i have this sql:
>         UPDATE *table* SET REPLACE(...) WHERE ...
>
>         Can i (??) do something like:
>         $dbo->resetValues();
>         $dbo->set( 'REPLACE(...)' );
>         $dbo->where( ... )
>         $dbo->update();
>
>         if not, how can i do this?
>
>
> Anyway, what do you think?
>
>
> regards
> Francisco A
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061106/7ebb77dd/attachment.html>

From francisco at fusemail.com  Mon Nov  6 22:09:39 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 06 Nov 2006 21:09:39 +0000
Subject: [ydf-devel] YDDatabaseTree2 :)
In-Reply-To: <12260be20611061135i6ba47ecdgef41599b0ffc799e@mail.gmail.com>
References: <454E184E.7050006@fusemail.com>
	<12260be20611061135i6ba47ecdgef41599b0ffc799e@mail.gmail.com>
Message-ID: <454FA493.3020103@fusemail.com>

Hi David

> There's no method to unregister a key/field, but you could just unset 
> the field name from the $_fields array. All keys and fields are on the 
> same array.
> 
> unset( $this->_fields['field_name'] );

Ok... simple :)


> If you think is good to have an unregister method, just add it to YDDOBJ.

Ok.. :)


> You can't do UPDATE *table* SET REPLACE(...) WHERE ...
> 
> You can only update values of registered fields, and fields can't be 
> expressions. This REPLACE thing is a sub-query, right? Just note that 
> only from MySQL 4.1 up you can use them. I still use MySQL 4.0 in some 
> projects. But if you think it's a good requirement because of the 
> performance boost, then people can always use YDDT if needed.
> 
> Well, you could try to add support for expressions in values like the 
> way we do in SELECTs. Just add it to YDDatabaseQuery. YDDatabaseObject 
> uses it to build all the queries. If you make it work in YDDQ, then I 
> see no problem in adding to YDDOBJ. Even if we don't build a hole new 
> interface for expression values in YDDOBJ, you can always use the 
> $_query object directly and use YDDQ methods.


Db, i don't have any idea on how to do that.

Btw, akaik, a sub-query is something like a SELECT ... IN SELECT ... 
but this is a simple function (like COUNT(), SUM().. REPLACE() ) and can 
be only used on SELECTs or UPDATEs.

The REPLACE is the "rebuild" magic here when moving nodes.. so it's very 
important.


What to you think to create a new simple method to add UPDATE functions?


regards
Francisco A


From maximus_meridius79 at yahoo.com  Thu Nov  9 15:24:16 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 9 Nov 2006 06:24:16 -0800 (PST)
Subject: [ydf-devel] Adding ajax grid support to YDDatabaseObject
Message-ID: <20061109142416.27647.qmail@web54004.mail.yahoo.com>

  Hi all,

I am proposing to add basic ajax grids support. The rationale is to useYDDatabaseObject to provide direct access to the database data beneaththe grid in a convenient form rather than working with intermediatearrays.

This is the approach that I am working on:
  
   new methods are being added to YDDatabaseObject, since thiswill allow existing code to more readily use grids
      
   rendering of the grid is derived from YDDatabaseObject limit,offset and other criteria  
   database columns to be included in the grid are registered.This is achieved by calling a method with similar parameters toYDForm::addElement that defined the characteristics of the underlyingform elements that will edit individual cells. This is how this looks:
    
              // define defaults for the grid cells 
            $this->setGridCellTemplate( 'id', 'hidden' );
            $this->setGridCellTemplate( 'name', 'text', 'Name' );
            $this->setGridCellTemplate( 'email', 'text', 'E-mail' );
            $this->setGridCellTemplate( 'country', 'select','Country', array(), array( 1 => 'Brazil', 2=>'Columbia',3=>'Australia' ) );
            $this->setGridCellTemplate( 'birthday', 'dateselect','Birthday' );
      
   the user will interact with the grid by clicking on a cell toactivate editing of the cell. When the focus of the cell is lost, thechanged cell will be saved. I will need to see how well this will workin practice. "span" form elements are used for non-interactive formelements
      
   it should provide automatic support for paging through thedata by setting up the events and methods to handle it.
      
   it should allow display modifier callbacks to be defined tothat control the rendering of cell contents where the default databaseformat is not suitable, e.g.
      // defines modifiers that control the display ofspecified fields in the grid
$this->registerGridCellDisplayModifier( 'birthday','modifierFormatDate' );
          
   default event processing will be automatically setup for thegrid  
   grid should support YDForm rules  
   grid should support filtering (this will use YDDatabaseObjectcriteria)  
   grid should support sorting by one or more fields
      
   the grid is rendered by specifying the set of pre-definedgrid cells that should be included in the rendering, e.g.
      $this->template->assign( 'grid',$user->getGrid( array( 'id', 'name', 'email', 'country', 'birthday') ) );
          
   the grid should provide a mechanism for inserting new rows(popup a modal form or edit in row) and deleting rows
  
So far I have setup and basic rendering of the grid implemented. Mynext step is to work on the ajax event setup and processing for cellediting.

Does this seem a sensible way to go about it? Any suggestions?

Thanks,

Graeme

 
---------------------------------
Everyone is raving about the all-new Yahoo! Mail beta.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061109/b4c3e1ee/attachment.html>

From ximian at mail.berlios.de  Tue Nov 14 22:32:25 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Tue, 14 Nov 2006 22:32:25 +0100
Subject: [ydf-devel] r2197 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611142132.kAELWPdJ004749@sheep.berlios.de>

Author: ximian
Date: 2006-11-14 22:32:24 +0100 (Tue, 14 Nov 2006)
New Revision: 2197

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
Log:
- added YDDatabaseTree2 .. a new YDDatabaseTree implementation
  NOTE: YDDatabaseTree2 has NOT the same API as YDDatabaseTree!



Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-01 01:11:28 UTC (rev 2196)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-14 21:32:24 UTC (rev 2197)
@@ -0,0 +1,597 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
+
+    /**
+     *  This class implements a database tree
+
+	    CREATE TABLE nested_tree (
+            id int NOT NULL auto_increment,
+            parent_id int NULL,
+			lineage varchar(255) NOT NULL default '//',
+            level int NOT NULL default '1',
+            position int NOT NULL default '1',
+            title varchar(255) NOT NULL default '',
+            PRIMARY KEY (id),
+			FOREIGN KEY (parent_id)
+                REFERENCES nested_tree(id)
+                     ON DELETE CASCADE
+                     ON UPDATE CASCADE
+        );
+
+
+        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
+        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
+     */
+
+    class YDDatabaseTree2 extends YDBase {
+
+        /**
+         *  Constructor. Set the database table name and necessary field names
+         *
+         *  @param $table          Name of the tree database table
+         *  @param $db             (optional) The YDDatabase instance name or object pointing to the database
+         *  @param $idField        (optional) Name of the primary key ID field. Default is id.
+         *  @param $parentField    (optional) Name of the parent ID field. Default is parent_id.
+         *  @param $sortField      (optional) Name of the field to sort data.
+         */
+        function YDDatabaseTree2( $table, $db='default', $idField='id', $parentField='parent_id', $sortField='parent_id ASC, position ASC' ) {
+
+            $this->db = YDDatabase::getNamedInstance( $db );
+
+            $this->table = $table;
+            $this->fields = array( 'id' => $idField, 'parent' => $parentField, 'lineage' => 'lineage', 'level' => 'level', 'position' => 'position' );
+			$this->sortField = $sortField;
+        }
+
+
+        /*
+         *  Function to convert an object to a node array
+         *
+         *  @param $node    The node to convert to a node array.
+         *
+         *  @return The node as a node array.
+         */
+        function _toNodeArray( $node ) {
+            $arr = array();
+
+            foreach ( $this->fields as $f )
+                if ( isset( $node[ $f ] ) ) $arr[ $f ] = $node[ $f ];
+
+            return $arr;
+        }
+
+
+        /**
+         *  A utility function to return an array of the fields that need to be selected in SQL select queries.
+         *
+         *  @returns array   An indexed array of fields to select
+         *
+         *  @internal
+         */
+        function _getFields() {
+            return array_values( $this->fields );
+        }
+
+
+        /**
+         *  Get the fields joined as single string.
+         *
+         *  @returns A single string with the fields joined as a string
+         *
+         *  @internal
+         */
+        function _getFieldsAsString() {
+            return join( ',', $this->_getFields() );
+        }
+
+
+        /**
+         *  Add a field to the list of fields to will get returned by this class.
+         *
+         *  @param  $name   The name of the field that should be added.
+         */
+        function addField( $name ) {
+            if ( ! in_array( $name, $this->fields ) ) {
+                $this->fields[ $name ] = $name;
+            }
+        }
+
+
+        /**
+         *  Add a number of fields to the list of fields to will get returned by this class.
+         *
+         *  @param  $names   The name of the field that should be added.
+         */
+        function addFields( $names ) {
+            if ( is_array( $names ) ) {
+                foreach ( $names as $name ) {
+                    $this->addField( $name );
+                }
+            }
+        }
+
+
+        /**
+         *  Returns the level based on the lineage
+         *
+         *  @returns  level int value
+         */
+        function _getLevel( $lineage ) {
+			return substr_count( $lineage, '/' ) - 1;
+        }
+
+
+        /**
+         *  Set the sort field.
+         *
+         *  @param $sortField      (optional) Name of the field to sort data. Default is title.
+         */
+        function setSortField( $sortField='title' ) {
+            $this->sortField = $sortField;
+        }
+
+
+        /**
+         *  Returns orberby sql clause
+         *
+         *  @returns orderBy sql
+         */
+        function _getOrder() {
+            return ' order by ' . $this->sortField;
+        }
+
+
+        /**
+         *  Fetch the node data for the node identified by $id.
+         *
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   The unique field to select on. Defaults to null, which means that the ID field specified
+         *                  when the object was instantiated will be used.
+         *
+         *  @returns An object containing the node's data, or false if node not found
+         */
+        function getNode( $id, $field = 'id' ) {
+
+            // Get the name of the field
+			if ( ! isset( $this->fields[ $field ] ) ) trigger_error( 'YDDatabaseTree::getNode, Field ' . $field . ' is not set!', YD_ERROR );
+
+			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $id ;
+
+            // Execute the query and return the record
+            return $this->db->getRecord( $query );
+        }
+
+
+        /**
+         *  Fetch the descendants of a node. To get all elements use getTreeElements
+         *
+         *  @param $id              The ID of the node to fetch descendant data for. 
+         *  @param $includeSelf     (optional) Whether or not to include the passed node in the the results. 
+         *  @param $specificPart    (optional) Return array should be not-associative (using a specific key to filter)
+         *
+         *  @returns The descendants of the passed now
+         */
+        function getDescendants( $id, $includeSelf=false, $specificPart=null ) {
+
+            // get just children
+			if ( $includeSelf == false ){
+
+				// get elements where lineage has expression  /$id/
+				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"' . $this->_getOrder();
+
+			}else{
+
+				// get elements where lineage has expression  /$id/ or id is $id
+				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
+			}
+
+            // check if we want a specific column
+            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
+
+			return $this->db->getRecords( $query );
+		}
+
+
+        /**
+         *  Fetch all elements of a tree
+         *
+         *  @param $specificPart    (optional) Return array should be not-associative (using a specific key to filter)
+         *
+         *  @returns The descendants of the passed now
+         */
+        function getTreeElements( $specificPart=null ) {
+
+			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' != 1' . $this->_getOrder();
+
+            // check if we want a specific column
+            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
+
+			return $this->db->getRecords( $query );
+		}
+
+
+        /**
+         *  Fetch the children of a node, or if no node is specified, fetch the top level items.
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *
+         *  @returns The children of the passed node
+         */
+        function getChildren( $id, $includeSelf = false, $specificPart = null ){
+
+            // get just children
+			if ( $includeSelf == false ){
+
+				// get elements where parent is $id
+				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id ) . $this->_getOrder();
+
+			}else{
+
+				// get elements where parent is $id or id is $id
+				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id ) . ' OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
+			}
+
+            // check if we want a specific column
+            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
+
+			return $this->db->getRecords( $query );
+        }
+
+
+        /**
+         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
+         *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
+         *  array).
+         *
+         *  @param $id             (optional) The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *
+         *  @returns An array of each node to passed node
+         */
+        function getPath( $id, $includeSelf=false ) {
+
+            // Get the ID field
+            $idField = $this->fields['id'];
+
+            // Get the node lineage
+            $node = $this->getNode( $id ) ;
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			// compute parents of this node. delete first '//' and implode
+			$nodes = array_map( 'intval', explode('/', substr( $node[ $this->fields[ 'lineage' ] ], 2 ) ) );
+
+			// delete current id from nodes to get only parents
+			array_pop( $nodes );
+
+            if ( $includeSelf == false ) {
+
+				// get all elements that have an id that belongs to $nodes
+                $query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' IN ("' . implode( '","', $nodes ) . '")' . $this->_getOrder();
+
+            }else{
+
+				// get all elements that have an id that belongs to $nodes or is $id
+                $query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' IN ("' . implode( '","', $nodes ) . '") OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
+            }
+
+			return $this->db->getRecords( $query );
+        }
+
+
+        /**
+         *  Check if one node descends from another node. If either node is not found, then false is returned.
+         *
+         *  @param $descendant_id  The node that potentially descends
+         *  @param $ancestor_id    The node that is potentially descended from
+         *
+         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
+         */
+        function isDescendantOf( $descendant_id, $ancestor_id ) {
+
+			// count elements where id is $descendant_id and lineage has expression /$ancestor_id/
+			$query = 'SELECT count(*) as is_descendant FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $descendant_id ) . ' AND ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' . $this->_getOrder();
+
+            // Execute the query and get the record
+            $record = $this->db->getRecord( $query );
+
+            // Return the result
+            return $record[ 'is_descendant' ] == 1;
+        }
+
+
+        /**
+         *  Check if one node is a child of another node. If either node is not found, then false is returned.
+         *
+         * @param $child_id       The node that is possibly a child
+         * @param $parent_id      The node that is possibly a parent
+         *
+         * @returns True if $child_id is a child of $parent_id, false otherwise
+         */
+        function isChildOf( $child_id, $parent_id ) {
+
+
+			// count elements where id is $child_id and parent_id is $parent_id
+			$query = 'SELECT count(*) as is_child FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $child_id ) . ' AND ' . $this->fields['parent'] . ' = ' . intval( $parent_id );
+
+            // Execute the query and get the record
+            $record = $this->db->getRecord( $query );
+
+            // Return the result
+            return $record[ 'is_child' ] == 1;
+        }
+
+
+        /**
+         *  Find the number of descendants a node has
+         *
+         *  @param $id     The ID of the node to search for.
+         *
+         *  @returns The number of descendants the node has
+         */
+        function numDescendants( $id ) {
+
+			$query = 'SELECT count(*) as num_descendants FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"';
+
+            // Execute the query and get the record
+            $record = $this->db->getRecord( $query );
+
+            // Return the result
+            return $record[ 'num_descendants' ];
+        }
+
+
+        /**
+         *  Find the number of children a node has
+         *
+         *  @param $id     The ID of the node to search for. Pass 0 to count the first level items
+         *
+         *  @returns The number of descendants the node has, or -1 if the node isn't found.
+         */
+        function numChildren( $id ) {
+
+			$query = 'SELECT count(*) as num_children FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id );
+
+            // Execute the query and get the record
+            $record = $this->db->getRecord( $query );
+
+            // Return the result
+            return $record[ 'num_children' ];
+        }
+
+
+        /**
+         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. 
+         *
+         * @param $id   The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the family
+         */
+        function getImmediateFamily( $id ) {
+
+            // Get the node parent
+            $node = $this->getNode( $id );
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
+			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . $node[ $this->fields['parent'] ] . ' OR ' . $this->fields['id'] . ' = ' . $node[ $this->fields['parent'] ] . ' OR ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"' . $this->_getOrder();
+
+            // Execute the query and get the record
+            return $this->db->getRecords( $query );
+        }
+
+
+        /**
+         *  Fetch the tree data, nesting within each node references to the node's children
+         *
+         *  @returns The tree with the node's child data
+         */
+        function getTreeWithChildren() {
+        }
+
+
+        /**
+         *  This function adds a node to the database.
+         *
+         *  @param $values      The field values of the node. Do NOT define parent_id here!
+         *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child
+         *  @param $position    (optional) Node position. If not set, node will be added at the end position
+         *
+         *  @returns    The ID of the newly inserted node.
+         */
+        function addNode( $values, $parent_id = 1, $position = null ) {
+
+			// override parent in $values
+			$values[ $this->fields['parent'] ] = $parent_id;
+
+            // Check if we want to add a root child
+            if ( $parent_id == 1 ) { 
+
+				// compute lineage and level
+				$lineage = '//';
+			}else{
+
+				// get lineage from parent and compute its lineage
+				$parent_node = $this->getNode( $parent_id );
+				$lineage     = $parent_node[ $this->fields['lineage'] ] . $parent_id . '/';
+			}
+
+			$values[ $this->fields['lineage'] ] = $lineage;
+			$values[ $this->fields['level'] ]   = $this->_getLevel( $lineage );
+
+			// compute position. If passed in arg we check if really can be that value, otherwise get the total of brothers and place node at the end
+			$total_brothers = $this->numChildren( $parent_id );
+
+			if ( is_numeric( $position ) && intval( $position ) > 0 && intval( $position ) < 1 + $total_brothers ){
+				$values[ $this->fields['position'] ] = intval( $position );
+			}else{
+				$values[ $this->fields['position'] ] = 1 + $total_brothers;
+			}
+
+			// increment position of nodes that have the same parent AND have position bigger than $position
+			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' + 1 WHERE ' . $this->fields['parent'] . ' = ' . intval( $parent_id ) . ' AND ' .  $this->fields['position'] . ' > ' . $values[ $this->fields['position'] ] );
+
+			// insert node
+			$this->db->executeInsert( $this->table, $values );
+
+			return $this->db->getLastInsertID();
+        }
+
+
+        /**
+         *  This function updates a node in the database.
+         *
+         *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
+         *  @param $id          (optional) The ID of the node to update.
+         *
+         *  @returns    Total of lines affected
+         */
+        function updateNode( $values, $id ) {
+
+            // Convert the values from an ojbect to an array
+            $values = $this->_toNodeArray( $values );
+
+			// delete reserved fields. Any update on these could corrupt all information ;)
+			if ( isset( $values[ $this->fields['id'] ] ) )			unset( $values[ $this->fields['id'] ] );
+			if ( isset( $values[ $this->fields['parent'] ] ) )		unset( $values[ $this->fields['parent'] ] );
+			if ( isset( $values[ $this->fields['lineage'] ] ) )		unset( $values[ $this->fields['lineage'] ] );
+			if ( isset( $values[ $this->fields['level'] ] ) )		unset( $values[ $this->fields['level'] ] );
+			if ( isset( $values[ $this->fields['position'] ] ) )	unset( $values[ $this->fields['position'] ] );
+
+            // Perform the insert
+            return $this->db->executeUpdate( $this->table, $values, $this->fields['id'] . ' = ' . intval( $id ) );
+        }
+
+
+        /**
+         *  Delete the node and it's children.
+         *
+         *  @param $id             The ID of the node to delete.
+         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
+         *
+         *  @returns    Total of lines affected
+         */
+        function deleteNode( $id, $deleteAll = true ) {
+
+            // delete nodes
+			if ( $deleteAll ){
+
+	            // get the node details before delete
+	            $node = $this->getNode( $id );
+
+				// delete id. we must update brothers positions of this id
+	            $res = $this->db->executeSql( 'DELETE FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $id ) );
+
+				// update positions. decrease position of nodes with same parent when position id bigger than $node[position]
+				$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' - 1 WHERE ' . $this->fields['parent'] . ' = ' . $node[ $this->fields['parent'] ] . ' AND ' . $this->fields['position'] . ' > ' . $node[ $this->fields['position'] ] );
+
+			// delete children of $id
+			}else{
+
+				// delete children of $id. we don't need to update position because all children will be deleted
+	            $res = $this->db->executeSql( 'DELETE FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' .  intval( $id ) );
+			}
+
+			return $res;
+        }
+
+
+        /**
+         *  Move a node to a different parent node.
+         *
+         *  @param  $id         	The ID of the node to move-
+         *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
+         *  @param  $position   	(optional) The new position.
+         */
+        function moveNode( $id, $new_parent_id = null, $position = null ) {
+
+            // get old node details before move
+            $old_node      = $this->getNode( $id );
+            $old_parent_id = $old_node[ $this->fields['parent'] ];
+            $old_position  = $old_node[ $this->fields['position'] ];
+            $old_lineage   = $old_node[ $this->fields['lineage'] ];
+
+			// compute new parent id
+			if ( ! is_numeric( $new_parent_id ) ) $new_parent_id = $old_node[ $this->fields['parent'] ];
+
+			// if position not set, we will move node to the end of the new parent
+			$total_new_brothers = $this->numChildren( $new_parent_id );
+
+			if ( is_numeric( $position ) && intval( $position ) > 0 && intval( $position ) < 1 + $total_new_brothers ){
+				$new_position = intval( $position );
+			}else{
+				$new_position = 1 + $total_new_brothers;
+			}
+
+			// get information of old and new parents
+            $old_parent_node     = $this->getNode( $old_parent_id );
+            $new_parent_node     = $this->getNode( $new_parent_id );
+			$new_lineage         = $new_parent_node[ $this->fields['lineage'] ] . $new_parent_id . '/';
+
+			// compute node to add
+			$values[ $this->fields['parent'] ] = $new_parent_id;
+			$values[ $this->fields['lineage'] ]   = $new_lineage;
+			$values[ $this->fields['level'] ]     = $this->_getLevel( $new_lineage );
+			$values[ $this->fields['position'] ]  = $new_position;
+
+			// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
+			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' + 1 WHERE ' . $this->fields['parent'] . ' = ' . $new_parent_id . ' AND ' . $this->fields['position'] . ' > ' . $new_position );
+
+			// decrease positions of old brothers that have position bigger than this node position
+			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' - 1 WHERE ' . $this->fields['parent'] . ' = ' . $old_parent_id . ' AND ' . $this->fields['position'] . ' > ' . $old_position );
+
+			// update node
+            $res = $this->db->executeUpdate( $this->table, $values, $this->fields['id'] . ' = ' . $id );
+
+			// update lineage of all descendants of this node.
+			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET REPLACE(' . $this->fields['lineage'] . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
+
+			return $res;
+        }
+
+
+    }
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Tue Nov 14 22:33:13 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Tue, 14 Nov 2006 22:33:13 +0100
Subject: [ydf-devel] r2198 - in
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent: .
	languages languages/YDCMGroup languages/YDCMPage languages/YDCMUser
Message-ID: <200611142133.kAELXD3x004793@sheep.berlios.de>

Author: ximian
Date: 2006-11-14 22:33:11 +0100 (Tue, 14 Nov 2006)
New Revision: 2198

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
Log:
- on YDCM:
   * ported to YDDatabaseTree2
   * merged permission system in group management

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -89,20 +89,22 @@
 
 
         /**
-         *  This method deletes a group
+         *  This method deletes a user (and all children) or just the children
          *
-         *  @param $group_id       Group id
+         *  @param $group_id       Userobject id
+         *  @param $mode           (Optional) 0: delete group_id and ALL children
+         *                                    1: delete ALL children of group_id only
          *
-         *  @returns    delete()
+         *  @returns    YDResult object. OK      - user deleted
+		 *                               WARNING - no deletes where made
          */
-		function deleteUser( $group_id ){
+		function deleteGroup( $group_id, $mode = 0 ){
 		
-			// reset stuff
-			$this->resetAll();
+			$obj = new YDCMUserobject();
 			
-			$this->set( 'group_id', intval( $group_id ) );
-			
-			return $this->delete();
+			// delete user and get result
+			if ( $obj->deleteNode( $group_id, $mode ) ) return YDResult::ok( t('ydcmgroup mess delete ok') );
+			else                                        return YDResult::fatal( t('ydcmgroup mess delete empty') );
 		}
 
 
@@ -111,20 +113,26 @@
 		 *
 		 * @param $group_id     Group id to edit
          */
-		function addFormEdit( $group_id ){
+		function & addFormEdit( $group_id, $permObj = null ){
 
-		 	return $this->_addFormDetails( $group_id, true );
+			// get editing id to be used when saving
+			$this->editing_ID = $group_id;
+
+		 	return $this->_addFormDetails( $group_id, true, $permObj );
 		}
 
 
         /**
          *  This method adds form elements for addind a new group
 		 *
-		 * @param $parent_group_id    (Optional) Parent id
+		 * @param $parent_group_id    Parent id (a user id)
          */
-		function addFormNew( $parent_group_id = null ){
+		function & addFormNew( $user_id, $permObj = null ){
 
-		 	return $this->_addFormDetails( $parent_group_id, false );
+			// get editing id to be used when saving
+			$this->editing_ID = $user_id;
+
+		 	return $this->_addFormDetails( $user_id, false, $permObj );
 		}
 		 
 		
@@ -136,7 +144,7 @@
          *
 		 * @param $edit         TRUE: We are editing a group, FALSE: we are creating a group
          */
-		function & _addFormDetails( $id, $edit ){
+		function & _addFormDetails( $id, $edit, $permObj ){
 
 			YDInclude( 'YDForm.php' );
 
@@ -152,22 +160,48 @@
 			$this->_form->addFormRule( array( & $this, '_checkgroup' ), array( $edit, $id ) );
 
 
-			// if we are not editing a group, just add a submit button and return
-			if ( ! $edit ){
+			// if we adding a group, just add a submit button
+			if ( $edit == false ){
 				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label new' ) );
-				return $this->_form;
+
+			// otherwise, if we are editing a group, we must add defaults and a submit button too
+			}else{
+
+				$defaults = $this->getGroup( $id );
+				$this->_form->setDefaults( $defaults );
+
+				// state default is 'ydcmuserobject_state' because it's on userobject table
+				$this->_form->setDefault( 'state', $defaults[ 'ydcmuserobject_state' ] );
+
+				// add submit button
+				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label save' ) );
 			}
+			
+			// check if we are using the permission engine. if not, just return the form
+			if ( is_null( $permObj ) ) return $this->_form;
 
-			// if we are editing, set defaults and add a submit button
-			$defaults = $this->getGroup( $id );
-			$this->_form->setDefaults( $defaults );
+			// include permission engine
+			YDInclude( 'YDCMPermission.php' );
 
-			// state default is 'ydcmuserobject_state' because it's on userobject table
-			$this->_form->setDefault( 'state', $defaults[ 'ydcmuserobject_state' ] );
+			// set YDPermission object form name the same name as group form
+			$permObj->setFormName( $this->_form->getName() );
 
-			// add submit button
-			$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label save' ) );
-			
+			// get form with all checkboxgroups
+			if ( $edit ) $perms_form = & $permObj->addFormEdit( $id );
+			else         $perms_form = & $permObj->addFormNew( $id );
+
+			// get all checkboxgroups html code
+			$perms_code = '';
+			foreach( $perms_form->getElements() as $name => $obj )
+				if ( $obj->getType() == 'checkboxgroup' ) $perms_code .= $obj->toFullHTML( '<br>', '', '<br><br>' );
+
+			// create a span and insert all checkboxgroups inside
+			$el = &	$this->_form->addElement( 'span', 'permissions', t( 'permissions' ) );
+			$el->setValue( $perms_code );
+
+			// get editing YDPermission object to be used when saving
+			$this->editing_PERMOBJ = & $permObj;
+
 			return $this->_form;
 		}
 
@@ -194,32 +228,30 @@
         /**
          *  This method updates group attributes
          *
-         *  @param $id           Group id to save attributes
          *  @param $formvalues   (Optional) Custom array with attributes
          *
          *  @returns    YDResult object. OK      - form updated
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to update
          */
-		function saveFormEdit( $id, $formvalues = null ){
+		function saveFormEdit( $formvalues = null ){
 
-			return $this->_saveFormDetails( $id, true, $formvalues );
+			return $this->_saveFormDetails( $this->editing_ID, true, $formvalues );
 		}
 
 
         /**
          *  This method adds a new group
          *
-         *  @param $parent_id    (Optional) Parent id of this new group
          *  @param $formvalues   (Optional) Custom array with attributes
          *
          *  @returns    YDResult object. OK      - form added
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to add
          */
-		function saveFormNew( $parent_id = null, $formvalues = null ){
+		function saveFormNew( $formvalues = null ){
 
-			return $this->_saveFormDetails( $parent_id, false, $formvalues );
+			return $this->_saveFormDetails( $this->editing_ID, false, $formvalues );
 		}
 
 
@@ -264,8 +296,11 @@
 				$this->setValues( $group );
 				$this->where( 'group_id = '. $id ); 
 
-				// updated and sum lines afected to userobject lines afected
+				// update and sum lines afected to userobject
 				$res += $this->update();
+
+				// if we are using the permission system, update and sum lines afected in permission table
+				if ( isset( $this->editing_PERMOBJ ) ) $res += $this->editing_PERMOBJ->saveFormEdit( $id, $formvalues );
 				
 				// check update from node update and from group update
 				if ( $res > 0 ) return YDResult::ok( t( 'ydcmgroup mess details updated' ), $res );
@@ -288,6 +323,9 @@
 				$uobj = new YDCMUserobject();
 				$res  = $uobj->addNode( $userobject, intval( $id ) );
 
+				// if we are using the permission system, add permissions and sum lines afected in permission table
+				if ( isset( $this->editing_PERMOBJ ) ) $res += $this->editing_PERMOBJ->saveFormNew( $id, $formvalues );
+
 				// create user row
 				$group = array();
 				$group[ 'group_id' ]    = $res;

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -439,44 +439,71 @@
          *
          *  @param     $name    Form name
          */
-		function setForm( $name ){
+		function setFormName( $name ){
 
 			$this->_form_name = $name;
 		}
 
 
+
         /**
-         *  This function returns an associative array with checkboxgroups
+         *  This method adds form elements for permission editing
+		 *
+		 * @param $id           Group id to edit
          *
-         *  @returns   Associative array:  array( CLASS => checkboxgroup )
+		 * @returns    YDForm object pointer         
          */
-		function & addFormEdit( $group_id ){
+		function & addFormEdit( $id ){
 
 			// store edition id (used later when saving details)
-			$this->_editing_id = $group_id;
+			$this->editing_ID = $id;
 
-			// get current permissions of this group
-			$perms = $this->getPermissions( $group_id );
+		 	return $this->_addFormDetails( $id, true );
+		}
 
-			// check if we need to create a new form, or use some
-			if ( ! isset( $this->_form ) ){
-	
-				YDInclude( 'YDForm.php' );
 
-				// init form
-				$this->_form = new YDForm( $this->_form_name );
-			}
+        /**
+         *  This method adds form elements for addind a new permission system
+		 *
+		 * @param $id    User id of this new group
+         *
+		 * @returns    YDForm object pointer         
+         */
+		function & addFormNew( $id ){
 
+		 	return $this->_addFormDetails( $id, false );
+		}
+
+
+        /**
+         *  This function returns an associative array with checkboxgroups
+         *
+		 * @param $id    	User id (when adding new group), Group id (when editing group)
+		 * @param $edit   	We are adding or editing
+		 *
+		 * @returns    YDForm object pointer         
+         */
+		function & _addFormDetails( $id, $edit ){
+
+			// init form
+			$this->_form = new YDForm( $this->_form_name );
+
 			// if this group is not a root group we must get the parent group permissions to check the ones we can use
 			$userobject = new YDCMUserobject();
 			$groups     = $userobject->getElements( array( 'ydcmgroup', 'ydcmuser' ) );
-			$parent_id  = $groups[ $group_id ][ 'parent_id' ];
+			$parent_id  = $groups[ $id ][ 'parent_id' ];
 
+			// when adding a new group, parent of $id is the master group. when editing a group, parent is a user.. so the master group is the parent of the parent
+			if ( $edit == true ) $parent_id = $groups[ $parent_id ][ 'parent_id' ];
+
 			// if parent of this group is root, parentgroup permissions are ALL (read: null), otherwise we must get permissions of that parent
 			if ( $parent_id == 1 ) $parentgroup_perms = null;
-			else                   $parentgroup_perms = $this->getPermissions( $groups[ $parent_id ][ 'parent_id' ] );
+			else                   $parentgroup_perms = $this->getPermissions( $parent_id );
 
-			// init form default array
+			// if we are editing, we must get the current group permissions
+			if ( $edit == true ) $perms = $this->getPermissions( $id );
+
+			// init form defaults array
 			$form_defaults = array();
 
 			// get all possible actions to compute checkboxgroups for each class
@@ -499,7 +526,8 @@
 					// if parentgroup is the root (id 1) or the parent group has the correspondent action, this action must be set based on current group db values
 					if ( is_null( $parentgroup_perms ) || isset( $parentgroup_perms[ $class ][ $action ] ) ){
 						
-						if ( isset( $perms[ $class ][ $action ] ) ) $form_defaults[ 'pclass_' . $class ][ $action ] = 1;
+						// if we are editing and the current group has this permission we must check it. if we are adding just uncheck it
+						if ( $edit && isset( $perms[ $class ][ $action ] ) ) $form_defaults[ 'pclass_' . $class ][ $action ] = 1;
 
 					// otherwise the action must be unset and disabled (because, if the parent group cannot do something, this group cannot do too)
 					}else{
@@ -514,7 +542,7 @@
 				$checkboxgroup->setAttribute( 'class', 'ydcmpermission_checkbox' );
 				$checkboxgroup->setLabelAttribute( 'class', 'ydcmpermission_checkbox_label' );
 
-				// disable some checkboxgroup elements
+				// disable checkboxgroup options that are not valid for this group
 				if ( ! empty( $chk_disable ) ) $this->_form->disable( 'pclass_' . $class, $chk_disable );
 			}
 
@@ -528,29 +556,72 @@
 		}
 
 
-		function saveFormEdit( $formvalues = null ){
+
+
+        /**
+         *  This method updates group permissions
+         *
+         *  @param $group_id     (Optional) Group id to update
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    INT: total of rows affected
+         */
+		function saveFormEdit( $group_id = null, $formvalues = null ){
 		
-			$group_id = $this->_editing_id;
-		
-			// check form validation
-			if ( !$this->_form->validate( $formvalues ) )
-				return YDResult::warning( t( 'form errors' ), $this->_form->getErrors() );
+			if ( is_null( $group_id ) ) $group_id = $this->editing_ID;
 
+			return $this->_saveFormDetails( $group_id, true, $formvalues );
+		}
+
+
+        /**
+         *  This method adds a new permission system
+         *
+         *  @param $user_id      (Optional) Parent of this permission system. Must be a user id
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    INT: total of rows affected
+         */
+		function saveFormNew( $user_id = null, $formvalues = null ){
+
+			return $this->_saveFormDetails( $user_id, false, $formvalues );
+		}
+
+
+
+        /**
+         *  This method adds/saves a permission system
+         *
+         *  @param $id           If we are editing, $id is the group id. If we are adding, $id is the user id
+         *  @param $edit         Boolean flag that defines if we are editing $id or adding to $id
+         *  @param $formvalues   (Optional) Custom array with user attributes
+         *
+         *  @returns    INT: total of rows affected
+         */
+		function _saveFormDetails( $id, $edit, $formvalues = null ){
+
+			// validate with custom values
+			if ( ! is_null( $formvalues ) ) $this->_form->validate( $formvalues );
+
 			// get form values EXCLUDING spans
 			$values = $this->_form->getValues();
 
-			// get current group permissions
-			$perms = $this->getPermissions( $group_id );
-
 			// if this group is not a root group we must get the parent group permissions to check the ones we can use
 			$userobject = new YDCMUserobject();
 			$groups     = $userobject->getElements( array( 'ydcmgroup', 'ydcmuser' ) );
-			$parent_id  = $groups[ $group_id ][ 'parent_id' ];
+			$parent_id  = $groups[ $id ][ 'parent_id' ];
 
+			// when adding a new group, parent of $id is the master group. when editing a group, parent is a user.. so the master group is the parent of the parent
+			if ( $edit == true ) $parent_id = $groups[ $parent_id ][ 'parent_id' ];
+
 			// if parent of this group is root, parentgroup permissions are ALL (read: null), otherwise we must get permissions of that parent
 			if ( $parent_id == 1 ) $parentgroup_perms = null;
-			else                   $parentgroup_perms = $this->getPermissions( $groups[ $parent_id ][ 'parent_id' ] );
+			else                   $parentgroup_perms = $this->getPermissions( $parent_id );
 
+			// if we are editing, we must get the current group permissions. if we are adding, current permissions are empty
+			if ( $edit == true ) $perms = $this->getPermissions( $id );
+			else                 $perms = array();
+
 			$actions_to_add = array();
 			$actions_to_del = array();
 
@@ -561,12 +632,13 @@
 					// if action is selected by the user AND
 					// this is a root group OR the action belogs to the parent group
 					// we can add it
-					if ( isset( $values[ 'pclass_' . $class ][ $action ] ) && $values[ 'pclass_' . $class ][ $action ] == 1 ){
+					if ( isset( $values[ 'pclass_' . $class ][ $action ] ) && ( $values[ 'pclass_' . $class ][ $action ] == 1 || $values[ 'pclass_' . $class ][ $action ] == 'on' ) ){
 
+
 						// check if action is valid:
 						// if parent group is a root a group OR the parent group has this action
 						if ( is_null( $parentgroup_perms ) || isset( $parentgroup_perms[ $class ][ $action ] ) ){
-						
+
 							// if action is valid we must check if we must add it or the user already has it
 							if ( ! isset( $perms[ $class ][ $action ] ) ) $actions_to_add[] = array( $class, $action );
 							
@@ -583,26 +655,31 @@
 			}
 
 
-			// delete actions			
+			$rows_deleted = 0;
+
+			// delete actions and count rows affected
 			foreach( $actions_to_del as $ac ){
 				$this->resetValues();
-				$this->set( 'permission_id', $group_id );
+				$this->set( 'permission_id', $id );
 				$this->set( 'class', $ac[0] );
 				$this->set( 'action', $ac[1] );
-				$this->delete();
+				$rows_deleted += $this->delete();
 			}
 
-			// add actions
+			$rows_added = 0;
+
+			// add actions and count total of action added
 			foreach( $actions_to_add as $ac ){
 				$this->resetValues();
-				$this->set( 'permission_id', $group_id );
+				$this->set( 'permission_id', $id );
 				$this->set( 'class', $ac[0] );
 				$this->set( 'action', $ac[1] );
 				$this->insert();
+				$rows_added ++;
 			}
 
 			// TODO: currently YDDatabaseObject don't have a mechanism to control the above deletes and inserts
-			return YDResult::ok( t('ydcmpermission mess permissions updated') );
+			return $rows_deleted + $rows_added;
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -153,21 +153,20 @@
         /**
          *  This method deletes a user (and all children) or just the children
          *
-         *  @param $user_id        User id
-         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes user id and children, FALSE deletes children only
+         *  @param $userobject_id  Userobject id
+         *  @param $mode           (Optional) 0: delete user_id and ALL children
+         *                                    1: delete ALL children of user_id only
          *
-         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
+         *  @returns    YDResult object. OK      - user deleted
+		 *                               WARNING - no deletes where made
          */
-		function deleteUser( $user_id, $includeParent = true ){
+		function deleteUser( $user_id, $mode = 0 ){
 		
-			// get ids to delete
-			$ids = $this->tree->getDescendants( intval( $user_id ), $includeParent, false, null, null, 'user_id' );
-
-			// delete all permissions of this users
-			$this->perm->deletePermissions( $ids );
-
-			// delete node from users table
-			$this->tree->deleteNode( $user_id, $includeParent );
+			$obj = new YDCMUserobject();
+			
+			// delete user and get result
+			if ( $obj->deleteNode( $user_id, $mode ) ) return YDResult::ok( t('ydcmuser mess delete ok') );
+			else                                       return YDResult::fatal( t('ydcmuser mess delete empty') );
 		}
 
 
@@ -196,6 +195,8 @@
          */
 		function & addFormNew( $id = null ){
 
+			$this->editing_ID = $id;
+
 		 	return $this->_addFormDetails( $id, false, array() );
 		}
 		 
@@ -228,9 +229,11 @@
 				$this->_form->addFormRule( array( & $this, '_checkuser' ), array( $edit, $id ) );
 			}
 
-			// add password box for new users or editing users
-			if ( ! $edit || ( $edit && ! in_array( 'password', $noneditable ) ) )
-				$this->_form->addElement( 'password', 'password', t( 'ydcmuser label password' ) );				
+			// add password box for new users
+			if ( $edit == false ){
+				$this->_form->addElement( 'password', 'password', t( 'ydcmuser label password' ) );
+				$this->_form->addElement( 'password', 'password2', t( 'ydcmuser label password2' ) );
+			}
 
 			// add state
 			if ( in_array( 'state', $noneditable ) ){
@@ -253,7 +256,7 @@
 			}else{
 				$this->_form->addElement( 'text',      'name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
 				$this->_form->addElement( 'text',      'email',         t( 'ydcmuser label email' ) );
-				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 4, 'cols' => 30) );
+				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 90, 'style' => 'display:none') );
 
 				$languages = new YDCMLanguages();
 				$languages = $languages->active();
@@ -333,34 +336,30 @@
         /**
          *  This method updates user attributes
          *
-         *  @param $id           (Optional) User id to force saving
          *  @param $formvalues   (Optional) Custom array with user attributes
          *
          *  @returns    YDResult object. OK      - form updated
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to update
          */
-		function saveFormEdit( $id = null, $formvalues = null ){
+		function saveFormEdit( $formvalues = null ){
 
-			if ( is_null( $id ) ) $id = $this->editing_ID;
-
-			return $this->_saveFormDetails( $id, true, $formvalues );
+			return $this->_saveFormDetails( $this->editing_ID, true, $formvalues );
 		}
 
 
         /**
          *  This method adds a new user
          *
-         *  @param $parent_id    (Optional) Group id (parent_id) of this new user
          *  @param $formvalues   (Optional) Custom array with user attributes
          *
          *  @returns    YDResult object. OK      - form added
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to add
          */
-		function saveFormNew( $parent_id = null, $formvalues = null ){
+		function saveFormNew( $formvalues = null ){
 
-			return $this->_saveFormDetails( $parent_id, false, $formvalues );
+			return $this->_saveFormDetails( $this->editing_ID, false, $formvalues );
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -29,7 +29,7 @@
 
 	// add YD libs
 //	YDInclude( 'YDForm.php' );
-	YDInclude( 'YDDatabaseTree.php' );
+	YDInclude( 'YDDatabaseTree2.php' );
 //	YDInclude( 'YDDatabaseObject.php' );
 	// add YDCM libs
 //	YDInclude( 'YDCMPermissions.php' );
@@ -56,19 +56,20 @@
 
 			// register custom fields
 			$this->registerField( 'parent_id' );
-			$this->registerField( 'nleft' );
-			$this->registerField( 'nright' );
-			$this->registerField( 'nlevel' );
+//			$this->registerField( 'nleft' );
+//			$this->registerField( 'nright' );
+//			$this->registerField( 'nlevel' );
+			$this->registerField( 'lineage' );
 			$this->registerField( 'position' );
 			$this->registerField( 'type' );			
 			$this->registerField( 'reference' );			
 			$this->registerField( 'state' );
 
 			// create tree object
-			$this->tree = new YDDatabaseTree( 'default', 'YDCMUserobject', 'userobject_id', 'parent_id', 'parent_id' );
+			$this->tree = new YDDatabaseTree2( 'YDCMUserobject', 'default', 'userobject_id', 'parent_id' );
 
 			// add tree fields
-			$this->tree->addField( 'parent_id' );
+//			$this->tree->addField( 'parent_id' );
 			$this->tree->addField( 'type' );
 			$this->tree->addField( 'reference' );			
 			$this->tree->addField( 'state' );			
@@ -85,7 +86,8 @@
          */
 		function getTreeElements( $parent_id, $includeNode = true ){
 
-			return $this->tree->getDescendants( $parent_id, $includeNode );
+//			return $this->tree->getDescendants( $parent_id, $includeNode );
+			return $this->tree->getTreeElements();
 		}
 
 
@@ -107,14 +109,18 @@
          *  This method deletes a userobject (and all children) or just the children
          *
          *  @param $userobject_id  Userobject id
-         *  @param $includeParent  (Optional) Boolean TRUE (default) deletes userobject id and children, FALSE deletes children only
+         *  @param $mode           (Optional) 0: delete userobject_id and ALL children
+         *                                    1: delete ALL children of userobject_id only
          *
-         *  @returns    TRUE if deleted, ARRAY with form errors otherwise
+         *  @returns    total of lines affected
          */
-		function deleteUser( $userobject_id, $includeParent = true ){
+		function deleteNode( $userobject_id, $mode = 0 ){
 		
-			// delete node from users table
-			$this->tree->deleteNode( $userobject_id, $includeParent );
+			// delete userobject_id an children
+			if ( $mode == 0 ) return $this->tree->deleteNode( $userobject_id, true );
+
+			// delete userobject_id children
+			return $this->tree->deleteNode( $userobject_id, false );
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMGroup/en.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -1,11 +1,17 @@
 <?php
 
+$GLOBALS['t']['ydcmgroup'] = 'Group management';
+
 // PERMISSIONS
+$GLOBALS['t']['ydcmgroup perm'] = 'User groups management';
+$GLOBALS['t']['ydcmgroup perm add']        = 'Add new group';
 $GLOBALS['t']['ydcmgroup perm properties'] = 'See properties';
 $GLOBALS['t']['ydcmgroup perm create']     = 'Create';
 $GLOBALS['t']['ydcmgroup perm delete']     = 'Delete';
 $GLOBALS['t']['ydcmgroup perm edit']       = 'Edit';
 
+$GLOBALS['t']['ydcmgroup children only']       = 'Children only';
+$GLOBALS['t']['ydcmgroup group and children']  = 'Group and children';
 
 // FORM LABELS
 $GLOBALS['t']['ydcmgroup label name']        = 'Name';
@@ -22,4 +28,8 @@
 $GLOBALS['t']['ydcmgroup mess created']              = 'New group created';
 $GLOBALS['t']['ydcmgroup mess impossible to create'] = 'Impossible to create group';
 
+// OTHER MESSAGES
+$GLOBALS['t']['ydcmgroup mess delete ok']    = 'Group deleted';
+$GLOBALS['t']['ydcmgroup mess delete empty'] = 'No deletes were made';
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMPage/en.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -1,6 +1,7 @@
 <?php
 // PERMISSIONS
-$GLOBALS['t']['ydcmpage perm create'] = 'Create';
+$GLOBALS['t']['ydcmpage perm'] = 'Page management';
+$GLOBALS['t']['ydcmpage perm create'] = 'Create page';
 $GLOBALS['t']['ydcmpage perm delete'] = 'Delete';
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/YDCMUser/en.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -1,14 +1,18 @@
 <?php
 
+$GLOBALS['t']['ydcmuser'] = 'User management';
+
 // PERMISSIONS
+$GLOBALS['t']['ydcmuser perm'] = 'User management';
 $GLOBALS['t']['ydcmuser perm properties'] = 'See properties';
-$GLOBALS['t']['ydcmuser perm create']     = 'Create';
+$GLOBALS['t']['ydcmuser perm create']     = 'Add user';
 $GLOBALS['t']['ydcmuser perm delete']     = 'Delete';
 $GLOBALS['t']['ydcmuser perm edit']       = 'Edit';
 
 // FORM LABELS
 $GLOBALS['t']['ydcmuser label username'] = 'Username';
 $GLOBALS['t']['ydcmuser label password'] = 'Password';
+$GLOBALS['t']['ydcmuser label password2'] = 'Confirm password';
 $GLOBALS['t']['ydcmuser label name'] = 'Name';
 $GLOBALS['t']['ydcmuser label email'] = 'Email';
 $GLOBALS['t']['ydcmuser label other'] = 'Other';
@@ -32,7 +36,7 @@
 // FORM RULES/ERRORS/MESSAGES
 $GLOBALS['t']['ydcmuser mess username exists'] = 'Username already exists';
 $GLOBALS['t']['ydcmuser mess updated'] = 'User details updated';
-$GLOBALS['t']['ydcmuser mess impossible to update'] = 'Was not possible to update user';
+$GLOBALS['t']['ydcmuser mess impossible to update'] = 'No updates were made';
 $GLOBALS['t']['ydcmuser mess created'] = 'New user created';
 $GLOBALS['t']['ydcmuser mess impossible to create'] = 'Was not possible to create user';
 $GLOBALS['t']['ydcmuser mess email not valid'] = 'Email is not valid';
@@ -43,12 +47,20 @@
 $GLOBALS['t']['ydcmuser mess passwords too big'] = 'All passwords must not exceed 31 characters';
 $GLOBALS['t']['ydcmuser mess passwords not alphanumeric'] = 'All passwords must be alphanumeric';
 $GLOBALS['t']['ydcmuser mess password updated'] = 'User password updated';
-$GLOBALS['t']['ydcmuser mess password not updated'] = 'User password not updated';
+$GLOBALS['t']['ydcmuser mess password not updated'] = 'No updates were made';
 
-// OTHER
-$GLOBALS['t']['ydcmuser administrator and move children up'] = 'Administrator and move children up';
+// OTHER MESSAGES
+$GLOBALS['t']['ydcmuser mess delete ok'] = 'User deleted';
+$GLOBALS['t']['ydcmuser mess delete empty'] = 'No deletes were made';
+
 $GLOBALS['t']['ydcmuser administrator and children'] = 'Administrator and children';
 $GLOBALS['t']['ydcmuser children only'] = 'Children only';
 $GLOBALS['t']['ydcmuser add group'] = 'Add group';
 $GLOBALS['t']['ydcmuser change password'] = 'Change password';
+$GLOBALS['t']['ydcmuser personal details'] = 'Personal details';
+$GLOBALS['t']['ydcmuser access'] = 'Access';
+$GLOBALS['t']['ydcmuser reset logins'] = 'reset';
+
+$GLOBALS['t']['ydcmuser passwords management'] = 'Password management';
+$GLOBALS['t']['ydcmuser passwords'] = 'Passwords';
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-11-14 21:32:24 UTC (rev 2197)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-11-14 21:33:11 UTC (rev 2198)
@@ -29,7 +29,6 @@
 $GLOBALS['t']['state'] = 'State';
 $GLOBALS['t']['add'] = 'Add';
 $GLOBALS['t']['add component'] = 'Add component';
-$GLOBALS['t']['add user'] = 'Add user';
 $GLOBALS['t']['move'] = 'Move';
 $GLOBALS['t']['move up'] = 'Move up';
 $GLOBALS['t']['move down'] = 'Move down';
@@ -41,7 +40,10 @@
 $GLOBALS['t']['visitors'] = 'Visitors';
 $GLOBALS['t']['administrator'] = 'Administrator';
 $GLOBALS['t']['administrators'] = 'Administrators';
+$GLOBALS['t']['group'] = 'Group';
+$GLOBALS['t']['groups'] = 'Groups';
 
+
 $GLOBALS['t']['published'] = 'Published';
 $GLOBALS['t']['not published'] = 'Not published';
 $GLOBALS['t']['schedule'] = 'Schedule';



From ximian at mail.berlios.de  Tue Nov 14 22:35:43 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Tue, 14 Nov 2006 22:35:43 +0100
Subject: [ydf-devel] r2199 - YDFramework2.0/trunk/examples/cm
Message-ID: <200611142135.kAELZhX7005072@sheep.berlios.de>

Author: ximian
Date: 2006-11-14 22:35:42 +0100 (Tue, 14 Nov 2006)
New Revision: 2199

Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
   YDFramework2.0/trunk/examples/cm/cm.sql
Log:
YDCM db scheme updated to YDDatabaseTree2

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-11-14 21:33:11 UTC (rev 2198)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-11-14 21:35:42 UTC (rev 2199)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="356" YPos="7" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="xpto" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="134" YPos="0" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="xpto" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -267,7 +267,7 @@
 <REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 </REGIONS>
 <TABLES>
-<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
+<TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
 <COLUMNS>
 <COLUMN ID="1732" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -319,7 +319,7 @@
 <RELATION_END ID="1704" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,0,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag!
 `,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPage\!
 a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 0!
 0:00:00\
a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`n!
 left`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
+<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,1,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag!
 `,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPage\!
 a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 0!
 0:00:00\
a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`n!
 left`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
 <COLUMNS>
 <COLUMN ID="1191" ColName="content_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
 <OPTIONSELECTED>
@@ -418,7 +418,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="480" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
+<TABLE ID="1163" Tablename="YDCMLink" PrevTableName="content_language" XPos="1480" YPos="480" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="7" >
 <COLUMNS>
 <COLUMN ID="1733" ColName="component_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -442,7 +442,7 @@
 <RELATION_END ID="1706" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="520" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="520" YPos="540" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
 <COLUMNS>
 <COLUMN ID="1219" ColName="language_id" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
 <OPTIONSELECTED>
@@ -485,7 +485,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="680" YPos="920" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
+<TABLE ID="1167" Tablename="YDCMStatistics_searches" PrevTableName="site_searches" XPos="680" YPos="920" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="11" >
 <COLUMNS>
 <COLUMN ID="1231" ColName="search_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement id">
 <OPTIONSELECTED>
@@ -511,7 +511,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1168" Tablename="YDCMUserobject" PrevTableName="users" XPos="780" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmuserobject` VALUES (1,0,  1,24,1,1, \aYDCMRoot\a, \a\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (2,1,  2,21,2,1, \aYDCMGroup\a, \aAdministrators\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (3,1,22,23,2,1, \aYDCMVisitor\a, \aVisitors\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (4,2,  3,20,3,1, \aYDCMUser\a,   \aadmin\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (5,4,  4,11,4,1, \aYDCMGroup\a, \amini admins\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (6,5,  5,  6,5,1, \aYDCMUser\a,   \apieter\a,1);\nINSERT INTO `ydcmuserobject` VALUES (7,5,  7,  8,5,1, \aYDCMUser\a,   \adavid\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (8,4,12, 17,4,1, \aYDCMGroup\a, \aspecial admins\a, 1 );\nINSERT INTO `ydcmuserobject` VALUES (9,  8,13, 14,5,1, \aYDCMUser\a,  \alimpeza\a, 1);\nINSERT INTO `ydc!
 muserobject` VALUES (10,8,15, 16,5,1, \aYDCMUser\a,  \ameireles\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (11,5,9,   10,5,1, \aYDCMUser\a,  \amarc\a,1);\nINSERT INTO `ydcmuserobject` VALUES (12,4,18, 19,4,1, \aYDCMGroup\a,   \aextra\a,1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
+<TABLE ID="1168" Tablename="YDCMUserobject" PrevTableName="users" XPos="780" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmuserobject` VALUES (  1,null,  \a\a,            0, 1, \aYDCMRoot\a,    \a\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  2,   1,  \a//\a,          1, 1, \aYDCMGroup\a,  \aAdministrators\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  3,   1,  \a//\a,          1, 2, \aYDCMVisitor\a, \aVisitors\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  4,   2,  \a//2/\a,       2, 1, \aYDCMUser\a,    \aadmin\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  5,   4,  \a//2/4/\a,    3, 1, \aYDCMGroup\a,  \amini admins\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  6,   5,  \a//2/4/5/\a, 4, 1, \aYDCMUser\a,     \apieter\a,1);\nINSERT INTO `ydcmuserobject` VALUES (  7,   5,  \a//2/4/5/\a, 4, 2, \aYDCMUser\a,     \adavid\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (  8,   4,  \a//2/4/\a,    3, 2, \aY!
 DCMGroup\a,   \aspecial admins\a, 1 );\nINSERT INTO `ydcmuserobject` VALUES (  9,   8,  \a//2/4/8/\a, 4, 1, \aYDCMUser\a,     \alimpeza\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (10,   8,  \a//2/4/8/\a, 4, 2, \aYDCMUser\a,     \ameireles\a, 1);\nINSERT INTO `ydcmuserobject` VALUES (11,   5,  \a//2/4/5/\a, 4, 3, \aYDCMUser\a,     \amarc\a,1);\nINSERT INTO `ydcmuserobject` VALUES (12,   4,  \a//2/4/\a,    3, 3, \aYDCMGroup\a,   \aextra\a,1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="12" >
 <COLUMNS>
 <COLUMN ID="1238" ColName="userobject_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="autoincrement user id">
 <OPTIONSELECTED>
@@ -519,28 +519,21 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1793" ColName="parent_id" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1793" ColName="parent_id" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1240" ColName="nleft" PrevColName="" Pos="3" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nleft">
-<OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1241" ColName="nright" PrevColName="" Pos="4" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nright">
+<COLUMN ID="1240" ColName="lineage" PrevColName="nleft" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\a//\a" Comments="node lineage">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1242" ColName="nlevel" PrevColName="" Pos="5" idDatatype="5" DatatypeParams="" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="optional nlevel">
+<COLUMN ID="2012" ColName="level" PrevColName="" Pos="7" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
 <COLUMN ID="1769" ColName="position" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="need for YDDatabaseTree but not used here">
@@ -571,9 +564,13 @@
 <RELATION_START ID="1436" />
 <RELATION_START ID="1410" />
 <RELATION_START ID="1861" />
-<RELATION_START ID="1867" />
-<RELATION_START ID="1870" />
+<RELATION_START ID="1984" />
+<RELATION_START ID="1989" />
+<RELATION_START ID="2009" />
 </RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="2009" />
+</RELATIONS_END>
 <INDICES>
 <INDEX ID="1279" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
 <INDEXCOLUMNS>
@@ -582,7 +579,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,4,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\!
 a,NULL,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\n!
 RowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments=!
 "" Colla
psed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
+<TABLE ID="1367" Tablename="YDCMHelpdesk_posts" PrevTableName="Table_11" XPos="1480" YPos="980" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,\a1\a,\a1\a,4,\a\a,\a\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\a,NULL,0,\a\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,NULL,NULL,\a0000-00-00 00:00:00\!
 a,NULL,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\nINSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,\a1\a,\a1\a,4,\asub\a,\atext\a,\a2006-07-05 15:50:33\a,0,\arep local\a,\a2006-07-05 15:50:33\a,\a0\a,0,\aass local\a,\a2006-07-05 15:50:33\a,\a0\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\n!
 RowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments=!
 "" Colla
psed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="20" >
 <COLUMNS>
 <COLUMN ID="1581" ColName="post_id" PrevColName="" Pos="13" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -680,7 +677,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1780" YPos="980" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
+<TABLE ID="1401" Tablename="YDCMHelpdesk_response" PrevTableName="Table_14" XPos="1760" YPos="980" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="26" >
 <COLUMNS>
 <COLUMN ID="1403" ColName="response_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -721,7 +718,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="460" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
+<TABLE ID="1430" Tablename="YDCMLocks" PrevTableName="Table_15" XPos="460" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="27" >
 <COLUMNS>
 <COLUMN ID="1578" ColName="lock_id" PrevColName="" Pos="2" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="lock ID">
 <OPTIONSELECTED>
@@ -758,7 +755,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="680" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="680" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
 <COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -818,7 +815,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="680" YPos="1020" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
+<TABLE ID="1626" Tablename="YDCMStatistics_downloads" PrevTableName="Table_21" XPos="680" YPos="1020" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" >
 <COLUMNS>
 <COLUMN ID="1631" ColName="download_is" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -844,7 +841,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a);\!
 nINSERT INTO `ydcmcomp` VALUES (10,11,\aen\a,\aPortals\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
+<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a);\!
 nINSERT INTO `ydcmcomp` VALUES (10,11,\aen\a,\aPortals\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
 <COLUMNS>
 <COLUMN ID="1680" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -897,9 +894,9 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1771" Tablename="YDCMPermission" PrevTableName="Table_14" XPos="1100" YPos="560" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermissions` VALUES (2,\aYDCMRootmenu\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (2,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (2,\aYDCMPage\a,\acreate\a);\nINSERT INTO `ydcmpermissions` VALUES (5,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermissions` VALUES (5,\aYDCMPage\a,\acreate\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1771" Tablename="YDCMPermission" PrevTableName="Table_14" XPos="1100" YPos="260" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpermission` VALUES (2,\aYDCMRootmenu\a,\adelete\a);\nINSERT INTO `ydcmpermission` VALUES (2,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermission` VALUES (2,\aYDCMPage\a,\acreate\a);\nINSERT INTO `ydcmpermission` VALUES (5,\aYDCMPage\a,\adelete\a);\nINSERT INTO `ydcmpermission` VALUES (5,\aYDCMPage\a,\acreate\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
-<COLUMN ID="1969" ColName="permission_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1994" ColName="permission_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -917,12 +914,12 @@
 </COLUMN>
 </COLUMNS>
 <RELATIONS_END>
-<RELATION_END ID="1870" />
+<RELATION_END ID="1984" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1800" Tablename="YDCMGroup" PrevTableName="Table_15" XPos="1100" YPos="180" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmgroup` VALUES (  2, \aAdministrators\a, \aCan do everything\a);\nINSERT INTO `ydcmgroup` VALUES (  3, \aVisitors\a, \aCan do nothing\a);\nINSERT INTO `ydcmgroup` VALUES (  5, \aMini admins\a, \aHave Admin user as leader\a);\nINSERT INTO `ydcmgroup` VALUES (  8, \aSpecial group\a, \aJust another group\a);\nINSERT INTO `ydcmgroup` VALUES (12, \aExtra group\a, \aAn empty group\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" >
+<TABLE ID="1800" Tablename="YDCMGroup" PrevTableName="Table_15" XPos="1100" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmgroup` VALUES (  2, \aAdministrators\a, \aCan do everything\a);\nINSERT INTO `ydcmgroup` VALUES (  3, \aVisitors\a, \aCan do nothing\a);\nINSERT INTO `ydcmgroup` VALUES (  5, \aMini admins\a, \aHave Admin user as leader\a);\nINSERT INTO `ydcmgroup` VALUES (  8, \aSpecial group\a, \aJust another group\a);\nINSERT INTO `ydcmgroup` VALUES (12, \aExtra group\a, \aAn empty group\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" >
 <COLUMNS>
-<COLUMN ID="1967" ColName="group_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<COLUMN ID="1993" ColName="group_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -940,10 +937,10 @@
 </COLUMN>
 </COLUMNS>
 <RELATIONS_END>
-<RELATION_END ID="1867" />
+<RELATION_END ID="1989" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1842" Tablename="YDCMUser" PrevTableName="Table_16" XPos="1100" YPos="280" TableType="0" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO YDCMUser VALUES ( 4, \aadmin\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aAdmin name\a,\aemail at host.com\a,\aother info\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 6, \apieter\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aPieter C\a,\apieter at ydf.org\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 7, \adavid\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aDavid B\a,\adavid at mt.gmail.com\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES ( 9, \alimpeza\a, \a21232f297a57a5a7438!
 94a0e4a801fc3\a,\aLimpeza Park\a,\alp at lp.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES (10, \ameireles\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aMeireles dos Santos\a,\amlres at mlres.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES (11, \afrancisco\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aFrancisco A\a,\afa at mant.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
+<TABLE ID="1842" Tablename="YDCMUser" PrevTableName="Table_16" XPos="1100" YPos="400" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO YDCMUser VALUES ( 4, \aadmin\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aAdmin name\a,\aemail at host.com\a,\aother info\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 6, \apieter\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aPieter C\a,\apieter at ydf.org\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES ( 7, \adavid\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aDavid B\a,\adavid at mt.gmail.com\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES ( 9, \alimpeza\a, \a21232f297a57a5a7438!
 94a0e4a801fc3\a,\aLimpeza Park\a,\alp at lp.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a); \nINSERT INTO YDCMUser VALUES (10, \ameireles\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aMeireles dos Santos\a,\amlres at mlres.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\nINSERT INTO YDCMUser VALUES (11, \afrancisco\a, \a21232f297a57a5a743894a0e4a801fc3\a,\aFrancisco A\a,\afa at mant.xpto\a,\ainfo\a,\aen\a,\adefault\a,\a1970-01-01 00:00:00\a,\a1970-01-01 00:00:00\a,0,\a2006-08-15 16:34:08\a,\a2006-08-15 16:35:51\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" >
 <COLUMNS>
 <COLUMN ID="1965" ColName="user_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -1026,10 +1023,11 @@
 <RELATION ID="1706" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1163" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
 <RELATION ID="1709" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1537" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="-4" StartIntervalOffsetX="-2" StartIntervalOffsetY="-53" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 <RELATION ID="1712" RelationName="component_id" Kind="2" SrcTable="1678" DestTable="1367" FKFields="component_id=component_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="1" CaptionOffsetY="1" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="36" />
-<RELATION ID="1861" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1842" FKFields="userobject_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="4" CaptionOffsetY="26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
-<RELATION ID="1867" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1800" FKFields="userobject_id=group_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
-<RELATION ID="1870" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="userobject_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="1861" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1842" FKFields="userobject_id=user_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="4" CaptionOffsetY="26" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" />
 <RELATION ID="1877" RelationName="language_id" Kind="5" SrcTable="1165" DestTable="1842" FKFields="language_id=lang_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
+<RELATION ID="1984" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="userobject_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+<RELATION ID="1989" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1800" FKFields="userobject_id=group_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
+<RELATION ID="2009" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="userobject_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-5" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 </RELATIONS>
 <NOTES>
 </NOTES>

Modified: YDFramework2.0/trunk/examples/cm/cm.sql
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.sql	2006-11-14 21:33:11 UTC (rev 2198)
+++ YDFramework2.0/trunk/examples/cm/cm.sql	2006-11-14 21:35:42 UTC (rev 2199)
@@ -5,7 +5,8 @@
   visitors_default TINYINT(1) NOT NULL DEFAULT 0,
   admin_default TINYINT(1) NOT NULL DEFAULT 0,
   PRIMARY KEY(language_id)
-);
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('en','English',1,1,1);
 INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('pt','Portugu?s',1,0,0);
@@ -28,9 +29,10 @@
   candrag TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
   candrop TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
   PRIMARY KEY(content_id)
-);
+)
+TYPE=InnoDB;
 
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,0,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,1,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
 INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
@@ -48,40 +50,46 @@
   date DATETIME NULL,
   filename VARCHAR(255) NULL,
   PRIMARY KEY(download_is)
-);
+)
+TYPE=InnoDB;
 
 CREATE TABLE YDCMStatistics_searches (
   search_id INTEGER(10) NOT NULL AUTO_INCREMENT,
   date DATETIME NOT NULL,
   word VARCHAR(255) NOT NULL,
   PRIMARY KEY(search_id)
-);
+)
+TYPE=InnoDB;
 
 CREATE TABLE YDCMUserobject (
   userobject_id INTEGER(10) NOT NULL AUTO_INCREMENT,
-  parent_id INTEGER UNSIGNED NOT NULL,
-  nleft INTEGER NOT NULL,
-  nright INTEGER NOT NULL,
-  nlevel INTEGER NOT NULL,
+  parent_id INTEGER(10) NULL,
+  lineage VARCHAR(255) NOT NULL DEFAULT '//',
+  level INTEGER UNSIGNED NULL,
   position INTEGER UNSIGNED NULL DEFAULT 1,
   type  VARCHAR(100) NOT NULL DEFAULT 'YDCMUser',
   reference VARCHAR(100) NULL,
   state TINYINT(1) NOT NULL,
-  PRIMARY KEY(userobject_id)
-);
+  PRIMARY KEY(userobject_id),
+  FOREIGN KEY(parent_id)
+    REFERENCES YDCMUserobject(userobject_id)
+      ON DELETE CASCADE
+      ON UPDATE CASCADE
+)
+TYPE=InnoDB;
 
-INSERT INTO `ydcmuserobject` VALUES (1,0,  1,24,1,1, 'YDCMRoot', '', 1);
-INSERT INTO `ydcmuserobject` VALUES (2,1,  2,21,2,1, 'YDCMGroup', 'Administrators', 1);
-INSERT INTO `ydcmuserobject` VALUES (3,1,22,23,2,1, 'YDCMVisitor', 'Visitors', 1);
-INSERT INTO `ydcmuserobject` VALUES (4,2,  3,20,3,1, 'YDCMUser',   'admin', 1);
-INSERT INTO `ydcmuserobject` VALUES (5,4,  4,11,4,1, 'YDCMGroup', 'mini admins', 1);
-INSERT INTO `ydcmuserobject` VALUES (6,5,  5,  6,5,1, 'YDCMUser',   'pieter',1);
-INSERT INTO `ydcmuserobject` VALUES (7,5,  7,  8,5,1, 'YDCMUser',   'david', 1);
-INSERT INTO `ydcmuserobject` VALUES (8,4,12, 17,4,1, 'YDCMGroup', 'special admins', 1 );
-INSERT INTO `ydcmuserobject` VALUES (9,  8,13, 14,5,1, 'YDCMUser',  'limpeza', 1);
-INSERT INTO `ydcmuserobject` VALUES (10,8,15, 16,5,1, 'YDCMUser',  'meireles', 1);
-INSERT INTO `ydcmuserobject` VALUES (11,5,9,   10,5,1, 'YDCMUser',  'marc',1);
-INSERT INTO `ydcmuserobject` VALUES (12,4,18, 19,4,1, 'YDCMGroup',   'extra',1);
+INSERT INTO `ydcmuserobject` VALUES (  1,null,  '',            0, 1, 'YDCMRoot',    '', 1);
+INSERT INTO `ydcmuserobject` VALUES (  2,   1,  '//',          1, 1, 'YDCMGroup',  'Administrators', 1);
+INSERT INTO `ydcmuserobject` VALUES (  3,   1,  '//',          1, 2, 'YDCMVisitor', 'Visitors', 1);
+INSERT INTO `ydcmuserobject` VALUES (  4,   2,  '//2/',       2, 1, 'YDCMUser',    'admin', 1);
+INSERT INTO `ydcmuserobject` VALUES (  5,   4,  '//2/4/',    3, 1, 'YDCMGroup',  'mini admins', 1);
+INSERT INTO `ydcmuserobject` VALUES (  6,   5,  '//2/4/5/', 4, 1, 'YDCMUser',     'pieter',1);
+INSERT INTO `ydcmuserobject` VALUES (  7,   5,  '//2/4/5/', 4, 2, 'YDCMUser',     'david', 1);
+INSERT INTO `ydcmuserobject` VALUES (  8,   4,  '//2/4/',    3, 2, 'YDCMGroup',   'special admins', 1 );
+INSERT INTO `ydcmuserobject` VALUES (  9,   8,  '//2/4/8/', 4, 1, 'YDCMUser',     'limpeza', 1);
+INSERT INTO `ydcmuserobject` VALUES (10,   8,  '//2/4/8/', 4, 2, 'YDCMUser',     'meireles', 1);
+INSERT INTO `ydcmuserobject` VALUES (11,   5,  '//2/4/5/', 4, 3, 'YDCMUser',     'marc',1);
+INSERT INTO `ydcmuserobject` VALUES (12,   4,  '//2/4/',    3, 3, 'YDCMGroup',   'extra',1);
 
 
 CREATE TABLE YDCMPermission (
@@ -90,9 +98,10 @@
   action VARCHAR(255) NOT NULL DEFAULT '',
   FOREIGN KEY(permission_id)
     REFERENCES YDCMUserobject(userobject_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION
-);
+      ON DELETE CASCADE
+      ON UPDATE CASCADE
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmpermission` VALUES (2,'YDCMRootmenu','delete');
 INSERT INTO `ydcmpermission` VALUES (2,'YDCMPage','delete');
@@ -107,9 +116,10 @@
   description VARCHAR(255) NULL DEFAULT '',
   FOREIGN KEY(group_id)
     REFERENCES YDCMUserobject(userobject_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION
-);
+      ON DELETE CASCADE
+      ON UPDATE CASCADE
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmgroup` VALUES (  2, 'Administrators', 'Can do everything');
 INSERT INTO `ydcmgroup` VALUES (  3, 'Visitors', 'Can do nothing');
@@ -134,13 +144,14 @@
   login_counter INTEGER UNSIGNED NULL DEFAULT 0,
   FOREIGN KEY(user_id)
     REFERENCES YDCMUserobject(userobject_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION,
+      ON DELETE CASCADE
+      ON UPDATE CASCADE,
   FOREIGN KEY(lang_id)
     REFERENCES YDCMLanguages(language_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 INSERT INTO YDCMUser VALUES ( 4, 'admin', '21232f297a57a5a743894a0e4a801fc3','Admin name','email at host.com','other info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
 INSERT INTO YDCMUser VALUES ( 6, 'pieter', '21232f297a57a5a743894a0e4a801fc3','Pieter C','pieter at ydf.org','info','en','default','1970-01-01 00:00:00','1970-01-01 00:00:00',0,'2006-08-15 16:34:08','2006-08-15 16:35:51');
@@ -166,7 +177,8 @@
     REFERENCES YDCMLanguages(language_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmcomp` VALUES (1,5,'en','Apache friends',1,'0000-00-00 00:00:00');
 INSERT INTO `ydcmcomp` VALUES (2,6,'en','PostGre en',1,'0000-00-00 00:00:00');
@@ -198,7 +210,8 @@
     REFERENCES YDCMTree(content_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 CREATE TABLE YDCMPage (
   component_id INTEGER UNSIGNED NOT NULL,
@@ -214,7 +227,8 @@
     REFERENCES YDCMComp(component_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,'Apache html all lang','Apache xhtml all lang',0,'',0,'','');
 INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,'PostgreSQL en html','PostgreSQL en xhtml',0,'',0,'','');
@@ -244,7 +258,8 @@
     REFERENCES YDCMComp(component_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 CREATE TABLE YDCMLink (
   component_id INTEGER UNSIGNED NOT NULL,
@@ -254,7 +269,8 @@
     REFERENCES YDCMComp(component_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 CREATE TABLE YDCMHelpdesk_posts (
   post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
@@ -282,7 +298,8 @@
     REFERENCES YDCMComp(component_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',4,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
 INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',4,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
@@ -305,6 +322,7 @@
     REFERENCES YDCMUserobject(userobject_id)
       ON DELETE NO ACTION
       ON UPDATE NO ACTION
-);
+)
+TYPE=InnoDB;
 
 



From ximian at mail.berlios.de  Wed Nov 15 21:47:36 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 15 Nov 2006 21:47:36 +0100
Subject: [ydf-devel] r2200 - in
	YDFramework2.0/trunk/YDFramework2/addons/YDAjax: . editors
Message-ID: <200611152047.kAFKlaPH011807@sheep.berlios.de>

Author: ximian
Date: 2006-11-15 21:47:10 +0100 (Wed, 15 Nov 2006)
New Revision: 2200

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
on YDAjax:
  * new feature: support for wysiwyg editors on responses (fckeditor only now)

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-14 21:35:42 UTC (rev 2199)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-15 20:47:10 UTC (rev 2200)
@@ -68,7 +68,7 @@
 
             // Setup the module
             $this->_author = 'Francisco Azevedo';
-            $this->_version = '2.84';
+            $this->_version = '2.9';
             $this->_copyright = '(c) Copyright 2002-2006 Francisco Azevedo';
             $this->_description = 'This class makes ajax easy for YDF developers';
 
@@ -108,6 +108,10 @@
 
 			// we are not on response
 			$this->onResponse = false;
+			
+			// init wysiwyg editors
+			$this->wysiwyg_forms = array();
+			$this->wysiwyg_ids   = array();
 		}
 
 	
@@ -404,7 +408,15 @@
 		}
 
 
-
+        /**
+         *	This method will compute the JS needed to execute the ajax call
+         *
+         *	@param $formElementName		Form element name
+         *	@param $serverFunction		Server function call
+         *	@param $arguments			Arguments that the call will sent
+         *	@param $options				Custom options
+         *	@param $effects				Custom effects
+         */	
 		function computeFunction( $formElementName, $serverFunction, $arguments = null, $options = null, $effects = null ){ 
 
 			// register function in xajax if not on reponse
@@ -491,8 +503,9 @@
 
 			return $functionName;
 		}
+
 		
-
+		
         /**
          *	This method adds an effect to a response
          *
@@ -532,7 +545,13 @@
 		}
 
 
-		// internal method. compute js arguments string 
+        /**
+         *	This method will get function arguments and parse them
+         *  Function arguments can be simple integers, strings, variables, form elements and complete forms
+         *
+         *	@param $arguments		Arguments
+         *	@param $options			Custom options
+         */	
 		function _computeFunctionArguments( $arguments, $options ){
 			
 			// if there are not arguments return empty string
@@ -548,50 +567,107 @@
 			// cycle arguments to create js function to get values
 			foreach ( $arguments as $arg ){
 
-				// if is a string and it's a harcoded form name (eg: 'form xpto', where 'xpto' is a form name)
-				if ( is_string( $arg ) && ereg ( "^form (.*)$", $arg, $res ) ) { $args[] = "xajax.getFormValues('" . $res[1] . "')"; continue; }
-
-				// if is a string and it's a form name, we want the form values
-				if ( is_string( $arg ) && $this->__isForm( $arg ) ) { $args[] = "xajax.getFormValues('" . $arg . "')"; continue; }
-
 				// if argument is numeric just add it and continue
 				if ( is_numeric( $arg ) ) { $args[] = $arg; continue; }
-					
-				// get the form of this argument
-				$form = $this->__getForm( $arg );
 
-				// if there's a form defined it's because the argument is a form element
-				if ( !is_null( $form ) ){
-						
+				// if is a javascript variable, just add it
+				if ( ereg ( "^var (.*)$", $arg, $res ) ){ $args[] = $res[1]; continue; }
+				
+				// check if is a hardcoded form name
+				if ( ereg ( "^form (.*)$", $arg, $res ) ) { $args[] = $this->__getJSFormElements( $res[1] ); continue; }
+
+				// check if is a form name
+				if ( $this->__isForm( $arg ) ){ $args[] = $this->__getJSFormElements( $arg ); continue; }
+				
+				// check if is a form element name
+				if ( !is_null( $form = $this->__getForm( $arg ) ) ){
+				
 					// get element object
 					$elem = & $form->getElement( $arg );
 					
-					// invoke the custom js to get the value
-					$js = $elem->getJS( $options );					
-
-					// compute javascript function name
-					$jsfunction = $this->prefix . 'get' . $elem->getName();
-
-					// add javascript function code to custom js (to be included in template head)
-					if ( !$this->onResponse ) $this->customjs[$jsfunction . '()' ] = $js;
-					else                      $this->response->addScript( $jsfunction . '=function(){' . $js . '}' );
+					// get js function name to execute
+					$args[] = $this->__getJSFormElement( $elem, $options );
 					
-					// add function name to arguments list
-					$args[] = $jsfunction . '()';
-					
 					continue;
-				}
+				 }
 
-				// if it's not a form element just parse the argument string
-				// if argument is in format 'var ?' where ? is a string, it's a js variable. otherwise is a simple string
-				if ( ereg ( "^var (.*)$", $arg, $res ) ) $args[] = $res[1];
-				else                                     $args[] = "'" . htmlentities( $arg ) . "'";
+				// otherwise is a js static string
+				$args[] = "'" . htmlentities( $arg ) . "'";
 			}
 
 			// convert arguments (we don't want " and ' on code)
 			return implode( ",", $args );
 		}
 
+
+       /**
+         *	This is a helper method to compute all JS that is needed to get all elements of a form
+         *
+         *	@param $formName			Form name
+         */		
+		function __getJSFormElements( $formName ){
+
+			$js = '';
+
+			// check if form has wysiwyg editors
+			if ( isset( $this->wysiwyg_forms[ $formName ] ) ){
+
+				// include editor lib
+				require_once( dirname( __FILE__ ) . '/editors/YDAjaxEditor.php' );
+
+				// wysiwyg editors require to copy their html to a textarea before submit
+				foreach( $this->wysiwyg_forms[ $formName ] as $formElementID )
+					$js .= YDAjaxEditor::JScopy( $formElementID );
+			}
+	
+			// now return form values
+			$js .= "return xajax.getFormValues('" . $formName . "');";
+
+			// compute js function name
+			$jsfunction = $this->prefix . 'getForm' . $formName;
+
+			// add javascript function code to custom js (to be included in template head)
+			if ( !$this->onResponse ) $this->customjs[$jsfunction . '()' ] = $js;
+			else                      $this->response->addScript( $jsfunction . '=function(){' . $js . '}' );
+					
+			// add function name to arguments list
+			return $jsfunction . '()';
+		}
+
+
+       /**
+         *	This is a helper method to compute all JS that is needed to get a form element
+         *
+         *	@param $formElement			Form element object
+         */		
+		function __getJSFormElement( $formElement, $options ){
+
+			$js = '';
+
+			// check if this element is a wysiwyg editor
+			if ( in_array( $formElement->getAttribute( 'id' ), $this->wysiwyg_ids ) ){
+
+				// include editor lib
+				require_once( dirname( __FILE__ ) . '/editors/YDAjaxEditor.php' );
+
+				// wysiwyg editor require to copy their html to a textarea before submit
+				$js .= YDAjaxEditor::JScopy( $formElement->getAttribute( 'id' ) );
+			}
+
+			// add JS return value
+			$js .= $formElement->getJS( $options );					
+
+			// compute javascript function name
+			$jsfunction = $this->prefix . 'get' . $formElement->getName();
+
+			// add javascript function code to custom js (to be included in template head)
+			if ( !$this->onResponse ) $this->customjs[$jsfunction . '()' ] = $js;
+			else                      $this->response->addScript( $jsfunction . '=function(){' . $js . '}' );
+					
+			// add function name to arguments list
+			return $jsfunction . '()';
+		}
+
 		
         /**
          *	This method adds confirmation to a element event
@@ -820,11 +896,52 @@
 		}
 
 
+
         /**
+         *	This method adds wysiwyg support to an form element
+         *
+         *	@param $formElementName		Form element name or a simple html id
+         */	
+		function addEditorSupport( $formElementName ){
+		
+			// get form from element name
+			$form = $this->__getForm( $formElementName );
+
+			// if element is NOT a form element just add it
+			if ( is_null( $form ) ){
+				$this->wysiwyg_ids[] = $formElementName;
+				return;
+			}
+
+			// if is a form element, get element
+			$elem = & $form->getElement( $formElementName );
+
+			// add editor as editor
+			$this->wysiwyg_forms[ $form->getName() ][] = $elem->getAttribute( 'id' );
+		}
+
+
+        /**
          *	This method will process all results added in a response
          */	
 		function processResults(){
 
+			// include support for wysiwyg editors
+			if ( ! empty( $this->wysiwyg_ids ) || ! empty( $this->wysiwyg_forms ) ){
+
+				require_once( dirname( __FILE__ ) . '/editors/YDAjaxEditor.php' );
+
+				// add suport for wysiwyg editors applyed to IDs
+				foreach( $this->wysiwyg_ids as $htmlID )
+					$this->response->addScript( YDAjaxEditor::JSinit( $htmlID ) );
+
+				// add support for wysiwyg editors applyed to form elements
+				// foreach form, cycle all wysiwyg elements to compute their initialization
+				foreach( $this->wysiwyg_forms as $formName => $formElements )
+					foreach( $formElements as $formElementID )
+						$this->response->addScript( YDAjaxEditor::JSinit( $formElementID ) );
+			}
+
 			// return XML to client browser
 			return $this->response->getXML();
 		}

Added: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php	2006-11-14 21:35:42 UTC (rev 2199)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php	2006-11-15 20:47:10 UTC (rev 2200)
@@ -0,0 +1,93 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    /**
+     *  This config defines the url path to fckeditor.js (excluding filename). Eg: "/web/fckeditor/"
+     *  Default: "/fckeditor/"
+     */
+    YDConfig::set( 'YD_AJAXEDITOR_FCKEDITOR_Url', "/fckeditor/", false );
+
+
+    /**
+     *  This config defines the editor skin name
+     *  Default: "office2003"
+     */
+    YDConfig::set( 'YD_AJAXEDITOR_FCKEDITOR_Skin', "silver", false );
+
+
+    /**
+     *  This config defines if the toolbar should start expanded
+     *  Default: true
+     */
+    YDConfig::set( 'YD_AJAXEDITOR_FCKEDITOR_ToolbarStartExpanded', true, false );
+
+
+
+    /**
+     *  Class definition for the YDAjaxEditor.
+     */
+    class YDAjaxEditor{
+
+        /**
+         *	This is the method returns the JS initialization of the editor
+         *
+         */
+        function JSinit( $htmlID ){
+		
+			// start by creating an FCKeditor object
+			$js  = "oFCKeditor = new FCKeditor( '" . $htmlID ."' );";
+			
+			// set the editor path
+			$js .= "oFCKeditor.BasePath = '" . YDConfig::get( 'YD_AJAXEDITOR_FCKEDITOR_Url' ) . "';";
+			
+			// set editor skin path
+			$js .= "oFCKeditor.Config['SkinPath'] = oFCKeditor.BasePath + 'editor/skins/" . YDConfig::get( 'YD_AJAXEDITOR_FCKEDITOR_Skin' ) . "/';";
+
+			// set toobar expanded on start
+			$js .= YDConfig::get( 'YD_AJAXEDITOR_FCKEDITOR_ToolbarStartExpanded' ) ? "oFCKeditor.Config['ToolbarStartExpanded'] = true;" : "oFCKeditor.Config['ToolbarStartExpanded'] = false;";
+
+			// on fckeditor we add a replace method (that will replace the textarea)
+			$js .= "oFCKeditor.ReplaceTextarea();";
+
+			return $js;
+		}
+
+	
+
+        /**
+         *	This is the method returns the JS mechanism of content copy from editor to textarea
+         */
+		function JScopy( $htmlID ){
+
+			return "document.getElementById('" . $htmlID . "').value = FCKeditorAPI.GetInstance('" . $htmlID . "').GetXHTML(true);";
+		}
+
+	}
+
+?>



From ximian at mail.berlios.de  Wed Nov 15 22:07:16 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 15 Nov 2006 22:07:16 +0100
Subject: [ydf-devel] r2201 - in YDFramework2.0/trunk/YDFramework2/addons:
	YDAjax YDCMComponent
Message-ID: <200611152107.kAFL7GTq013746@sheep.berlios.de>

Author: ximian
Date: 2006-11-15 22:06:43 +0100 (Wed, 15 Nov 2006)
New Revision: 2201

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
Log:
- fixed a glitch on FF. 
  If a textarea will be a wysiwyg we are now hiding it before wysiwyg initialization

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-15 20:47:10 UTC (rev 2200)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-15 21:06:43 UTC (rev 2201)
@@ -916,6 +916,9 @@
 			// if is a form element, get element
 			$elem = & $form->getElement( $formElementName );
 
+			// hide form element. On some browsers we get a glitch.
+			$elem->setAttribute( 'style', 'display:none' );
+
 			// add editor as editor
 			$this->wysiwyg_forms[ $form->getName() ][] = $elem->getAttribute( 'id' );
 		}

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-15 20:47:10 UTC (rev 2200)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-15 21:06:43 UTC (rev 2201)
@@ -256,7 +256,7 @@
 			}else{
 				$this->_form->addElement( 'text',      'name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
 				$this->_form->addElement( 'text',      'email',         t( 'ydcmuser label email' ) );
-				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 90, 'style' => 'display:none') );
+				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 90) );
 
 				$languages = new YDCMLanguages();
 				$languages = $languages->active();



From ximian at mail.berlios.de  Wed Nov 15 22:09:05 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 15 Nov 2006 22:09:05 +0100
Subject: [ydf-devel] r2202 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200611152109.kAFL95Rw013812@sheep.berlios.de>

Author: ximian
Date: 2006-11-15 22:08:42 +0100 (Wed, 15 Nov 2006)
New Revision: 2202

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
Log:
some cleanups on YDCMTemplates

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-11-15 21:06:43 UTC (rev 2201)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-11-15 21:08:42 UTC (rev 2202)
@@ -26,7 +26,6 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-	YDInclude( 'YDFileSystem.php' );
 
 	// set admin template directory (without template name directory)
 	YDConfig::set( 'YDCMTEMPLATES_ADMIN_PATH', YD_SELF_DIR, false );
@@ -47,16 +46,7 @@
 	// this is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
     class YDCMTemplates {
 
-        function YDCMTemplates() {
-        
-			$this->admin_path        = YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' );
-			$this->admin_template    = YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' );
-			$this->visitors_path     = YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' );
-			$this->visitors_template = YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' );
-			$this->template_pack     = YDConfig::get( 'YDCMTEMPLATES_PACK' );
-		}
 
-
         /**
          *  This function returns all possible templates for administration side
          *
@@ -64,7 +54,7 @@
          */
 		function admin_templates(){
 		
-			return $this->__getFiles( $this->admin_path );
+			return YDCMTemplates::__getFiles( YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' ) );
 		}
 
 
@@ -75,7 +65,7 @@
          */
 		function admin_template(){
 		
-			return $this->admin_template;
+			return YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' );
 		}
 
 
@@ -88,7 +78,7 @@
          */
 		function admin_complete( $subdir = '' ){
 		
-			return $this->admin_path . '/' . $this->admin_template . '/' . $subdir;
+			return YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' ) . '/' . YDConfig::get( 'YDCMTEMPLATES_ADMIN_TEMPLATE' ) . '/' . $subdir;
 		}
 
 
@@ -99,7 +89,7 @@
          */
 		function template_pack(){
 		
-			return $this->template_pack;
+			return YDConfig::get( 'YDCMTEMPLATES_PACK' );
 		}
 
 
@@ -110,7 +100,7 @@
          */
 		function visitors_templates(){
 		
-			return $this->__getFiles( $this->visitors_path );
+			return YDCMTemplates::__getFiles( YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' ) );
 		}
 
 
@@ -121,7 +111,7 @@
          */
 		function visitors_template(){
 		
-			return $this->visitors_template;
+			return YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' );
 		}
 
 
@@ -134,7 +124,7 @@
          */
 		function visitors_complete( $subdir = '' ){
 		
-			return $this->visitors_path . '/' . $this->visitors_template . '/' . $subdir;
+			return YDConfig::get( 'YDCMTEMPLATES_VISITORS_PATH' ) . '/' . YDConfig::get( 'YDCMTEMPLATES_VISITORS_TEMPLATE' ) . '/' . $subdir;
 		}
 
 
@@ -144,7 +134,9 @@
          *  @returns    Array of filenames, eg: array( 'default' => 'Default', 'orange' => ... )
          */
 		function __getFiles( $dir ){
-		
+
+			YDInclude( 'YDFileSystem.php' );
+
 			// init directories
 			$directories = array();
 



From ximian at mail.berlios.de  Wed Nov 15 23:15:44 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 15 Nov 2006 23:15:44 +0100
Subject: [ydf-devel] r2203 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200611152215.kAFMFiNN018552@sheep.berlios.de>

Author: ximian
Date: 2006-11-15 23:15:21 +0100 (Wed, 15 Nov 2006)
New Revision: 2203

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
Log:
- small fixes on YDCMGroup when adding a new group

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-11-15 21:08:42 UTC (rev 2202)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2006-11-15 22:15:21 UTC (rev 2203)
@@ -154,7 +154,6 @@
 			// add elements
 			$this->_form->addElement( 'text',     'name',        t( 'ydcmgroup label name' ) );
 			$this->_form->addElement( 'textarea', 'description', t( 'ydcmgroup label description' ), array( 'rows' => 4, 'cols' => 40 ) );
-			$this->_form->addElement( 'select',   'state',       t( 'ydcmgroup label state' ), array(), array( 0 => t( 'Blocked' ), 1 => t( 'Active' ) ) );
 
 			// add rules
 			$this->_form->addFormRule( array( & $this, '_checkgroup' ), array( $edit, $id ) );
@@ -170,9 +169,6 @@
 				$defaults = $this->getGroup( $id );
 				$this->_form->setDefaults( $defaults );
 
-				// state default is 'ydcmuserobject_state' because it's on userobject table
-				$this->_form->setDefault( 'state', $defaults[ 'ydcmuserobject_state' ] );
-
 				// add submit button
 				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmgroup label save' ) );
 			}
@@ -280,7 +276,7 @@
 				$userobject = array();
 				$userobject['type']  = 'YDCMGroup';
 				$userobject['reference'] = $values[ 'name' ];
-				$userobject['state']     = $values[ 'state' ];
+				$userobject['state']     = 1;
 
 				// update userobject
 				$uobj = new YDCMUserobject();
@@ -312,7 +308,7 @@
 				$userobject = array();
 				$userobject['type']      = 'YDCMGroup';
 				$userobject['reference'] = $values[ 'name' ];
-				$userobject['state']     = $values[ 'state' ];
+				$userobject['state']     = 1;
 
 				// check default parent id
 				if ( is_null( $id ) ) $id = 1;
@@ -320,15 +316,18 @@
 				// TODO: check if group is valid (and, eg, is not a user node)
 
 				// update userobject and get new id
-				$uobj = new YDCMUserobject();
-				$res  = $uobj->addNode( $userobject, intval( $id ) );
+				$uobj   = new YDCMUserobject();
+				$nodeID = $uobj->addNode( $userobject, intval( $id ) );
 
+				// init result count
+				$res = $nodeID;
+
 				// if we are using the permission system, add permissions and sum lines afected in permission table
-				if ( isset( $this->editing_PERMOBJ ) ) $res += $this->editing_PERMOBJ->saveFormNew( $id, $formvalues );
+				if ( isset( $this->editing_PERMOBJ ) ) $res += $this->editing_PERMOBJ->saveFormNew( $id, $nodeID, $formvalues );
 
 				// create user row
 				$group = array();
-				$group[ 'group_id' ]    = $res;
+				$group[ 'group_id' ]    = intval( $nodeID );
 				$group[ 'name' ]        = $values[ 'name' ];
 				$group[ 'description' ] = $values[ 'description' ];
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-11-15 21:08:42 UTC (rev 2202)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2006-11-15 22:15:21 UTC (rev 2203)
@@ -577,14 +577,15 @@
         /**
          *  This method adds a new permission system
          *
-         *  @param $user_id      (Optional) Parent of this permission system. Must be a user id
+         *  @param $user_id      Parent of this permission system. Must be a user id
+         *  @param $group_id     Group id of this permissions system
          *  @param $formvalues   (Optional) Custom array with user attributes
          *
          *  @returns    INT: total of rows affected
          */
-		function saveFormNew( $user_id = null, $formvalues = null ){
+		function saveFormNew( $user_id, $group_id, $formvalues = null ){
 
-			return $this->_saveFormDetails( $user_id, false, $formvalues );
+			return $this->_saveFormDetails( $user_id, false, $formvalues, $group_id );
 		}
 
 
@@ -595,10 +596,11 @@
          *  @param $id           If we are editing, $id is the group id. If we are adding, $id is the user id
          *  @param $edit         Boolean flag that defines if we are editing $id or adding to $id
          *  @param $formvalues   (Optional) Custom array with user attributes
+         *  @param $group_id     Node id used when inserting permissions. nodeID is the node where permissions are applyed
          *
          *  @returns    INT: total of rows affected
          */
-		function _saveFormDetails( $id, $edit, $formvalues = null ){
+		function _saveFormDetails( $id, $edit, $formvalues = null, $group_id = 0 ){
 
 			// validate with custom values
 			if ( ! is_null( $formvalues ) ) $this->_form->validate( $formvalues );
@@ -654,6 +656,8 @@
 				}
 			}
 
+			// if we are adding permissions we must add to group_id recently created (not to parent)
+			if ( $edit == false ) $id = $group_id;
 
 			$rows_deleted = 0;
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-15 21:08:42 UTC (rev 2202)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-15 22:15:21 UTC (rev 2203)
@@ -256,7 +256,7 @@
 			}else{
 				$this->_form->addElement( 'text',      'name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
 				$this->_form->addElement( 'text',      'email',         t( 'ydcmuser label email' ) );
-				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 90) );
+				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 40) );
 
 				$languages = new YDCMLanguages();
 				$languages = $languages->active();



From maximus_meridius79 at yahoo.com  Thu Nov 16 13:44:18 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 16 Nov 2006 04:44:18 -0800 (PST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <20061116124418.22599.qmail@web54008.mail.yahoo.com>

  Hi,

The new YDDatabaseTree2 is a cool8-)  new implementation of database trees! 

There is a bug in the select statement for YDDatabaseTree2::getNode. Ithink the code needs to include appropriate quote characters so thatstring fields can be used in addition to numeric id fields. Stringfields cause the db instance to raise an error.

This is what I think the line that builds the select statement shouldbe to enable use of string fields:

            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . " = '" . $id . "'";


Alternatively:

if ( !is_string( $id ) ) {

	$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $id ;
} else {
    $query = 'SELECT ' .$this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE '. $this->fields[ $field ] . " = '" . $id ."'";
}

I have also written a findNode method which allows for the tree to besearch based on a number of equality criteria ( field / value pairs).

        /**
         *  Find the node data for the node matching the criteria.
         *
         *  @param $criteria      Array of field/value pairs.
         *
         *  @returns An object containing the node's data, or false ifnode not found
         */
        function findNode( $criteria ) {
        
            // critera should be an array of field/value pairs
            if ( ! is_array( $criteria ) ) trigger_error('YDDatabaseTree::findNode, Criteria should be an array!', YD_ERROR );
        
            $fields = array_keys( $criteria );
            
            $where = '';
            foreach ( $criteria as $field => $value ) {
                        
                // Check the name of the field
                if ( ! isset( $this->fields[ $field ] ) )trigger_error( 'YDDatabaseTree::getNode, Field ' . $field . ' is notset!', YD_ERROR );
                
                if ( !is_string( $criteria[$field] ) ) {
                    $condition = $this->fields[ $field ] . ' = ' .$value ;
                } else {
                    $condition = $this->fields[ $field ] . " = '" .$value . "'";
                }
                
                if ( $where == '' ) {
                    $where .= $condition ;
                } else {
                    $where .= $where . ' AND ' . $condition;
                }
            }
            
            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $where ;
                        
            // Execute the query and return the record
            return $this->db->getRecord( $query );
        }


This is sample usage:

$url_tree_root = $this->_tree->findNode( array( 'realm' =>'abc', 'url' => '/index.php' ) );

Also another simple method which gives more control of the where clause:

        /**
         *  Find the node data by applying a custom where clause.
         *
         *  @param $where      Where clause.
         *
         *  @returns An object containing the node's data, or false ifnode not found
         */

        function findNodeWhere( $where ) {
        
            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $where;
                        
            // Execute the query and return the record
            return $this->db->getRecord( $query );
        }


Regards,

Graeme


 
---------------------------------
Sponsored Link

Mortgage rates near 39yr lows. $420,000 Mortgage for $1,399/mo - Calculate new house payment
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061116/3d38eac5/attachment.html>

From maximus_meridius79 at yahoo.com  Thu Nov 16 13:45:07 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 16 Nov 2006 04:45:07 -0800 (PST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <20061116124508.87418.qmail@web54004.mail.yahoo.com>

  Hi,

The new YDDatabaseTree2 is a cool8-)  new implementation of database trees! 

There is a bug in the select statement for YDDatabaseTree2::getNode. Ithink the code needs to include appropriate quote characters so thatstring fields can be used in addition to numeric id fields. Stringfields cause the db instance to raise an error.

This is what I think the line that builds the select statement shouldbe to enable use of string fields:

            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . " = '" . $id . "'";


Alternatively:

if ( !is_string( $id ) ) {

	$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $id ;
} else {
    $query = 'SELECT ' .$this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE '. $this->fields[ $field ] . " = '" . $id ."'";
}

I have also written a findNode method which allows for the tree to besearch based on a number of equality criteria ( field / value pairs).

        /**
         *  Find the node data for the node matching the criteria.
         *
         *  @param $criteria      Array of field/value pairs.
         *
         *  @returns An object containing the node's data, or false ifnode not found
         */
        function findNode( $criteria ) {
        
            // critera should be an array of field/value pairs
            if ( ! is_array( $criteria ) ) trigger_error('YDDatabaseTree::findNode, Criteria should be an array!', YD_ERROR );
        
            $fields = array_keys( $criteria );
            
            $where = '';
            foreach ( $criteria as $field => $value ) {
                        
                // Check the name of the field
                if ( ! isset( $this->fields[ $field ] ) )trigger_error( 'YDDatabaseTree::getNode, Field ' . $field . ' is notset!', YD_ERROR );
                
                if ( !is_string( $criteria[$field] ) ) {
                    $condition = $this->fields[ $field ] . ' = ' .$value ;
                } else {
                    $condition = $this->fields[ $field ] . " = '" .$value . "'";
                }
                
                if ( $where == '' ) {
                    $where .= $condition ;
                } else {
                    $where .= $where . ' AND ' . $condition;
                }
            }
            
            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $where ;
                        
            // Execute the query and return the record
            return $this->db->getRecord( $query );
        }


This is sample usage:

$url_tree_root = $this->_tree->findNode( array( 'realm' =>'abc', 'url' => '/index.php' ) );

Also another simple method which gives more control of the where clause:

        /**
         *  Find the node data by applying a custom where clause.
         *
         *  @param $where      Where clause.
         *
         *  @returns An object containing the node's data, or false ifnode not found
         */

        function findNodeWhere( $where ) {
        
            $query = 'SELECT ' . $this->_getFieldsAsString() . 'FROM ' . $this->table . ' WHERE ' . $where;
                        
            // Execute the query and return the record
            return $this->db->getRecord( $query );
        }


Regards,

Graeme


 
---------------------------------
Sponsored Link

   Mortgage rates as low as 4.625% - $150,000 loan for $579 a month. Intro-*Terms
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061116/2ebb95a3/attachment.html>

From maximus_meridius79 at yahoo.com  Thu Nov 16 17:40:45 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 16 Nov 2006 08:40:45 -0800 (PST)
Subject: [ydf-devel] Is YDDatabaseTree2::moveNode working?
Message-ID: <20061116164045.29870.qmail@web54009.mail.yahoo.com>

  Hi Francisco,

Is the new YDDatabaseTree2::moveNode complete?

I am trying to move nodes in the tree and I get SQL errors in the logssuch as:

PHP Fatal error:  [1064] You have an error in your SQL syntax; checkthe manual that corresponds to your MySQL server version for the rightsyntax to use near 'REPLACE(lineage,"//15//27/","//15/30//27/")' 

The syntax of the lineage in the generated statement doesn't lookright.   

Is the correct method for changing the position of a node in the samebranch of the tree. Are these the right steps?:

1. calculate the node's new position $new_pos and remember its parent$parent
2. temporarily move the node to a new parent (moveNode)
3. move the node back to $parent and set its position $new_pos(moveNode)

Thanks,

Graeme

 
---------------------------------
Sponsored Link

$420,000 Mortgage for $1,399/month -   Think You Pay Too Much For Your Mortgage? Find Out!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061116/ffcd2e37/attachment.html>

From ximian at mail.berlios.de  Thu Nov 16 17:48:31 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 16 Nov 2006 17:48:31 +0100
Subject: [ydf-devel] r2204 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611161648.kAGGmVWQ016235@sheep.berlios.de>

Author: ximian
Date: 2006-11-16 17:48:20 +0100 (Thu, 16 Nov 2006)
New Revision: 2204

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
Log:
- fixed escape on YDDatabaseTree2::getNode

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-15 22:15:21 UTC (rev 2203)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-16 16:48:20 UTC (rev 2204)
@@ -183,7 +183,7 @@
          *  Fetch the node data for the node identified by $id.
          *
          *  @param $id      The ID of the node to fetch.
-         *  @param $field   The unique field to select on. Defaults to null, which means that the ID field specified
+         *  @param $field   The unique field to select on. Defaults to id, which means that the ID field specified
          *                  when the object was instantiated will be used.
          *
          *  @returns An object containing the node's data, or false if node not found
@@ -193,7 +193,7 @@
             // Get the name of the field
 			if ( ! isset( $this->fields[ $field ] ) ) trigger_error( 'YDDatabaseTree::getNode, Field ' . $field . ' is not set!', YD_ERROR );
 
-			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $id ;
+			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $this->db->escapeSql( $id );
 
             // Execute the query and return the record
             return $this->db->getRecord( $query );



From ximian at mail.berlios.de  Thu Nov 16 17:49:38 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 16 Nov 2006 17:49:38 +0100
Subject: [ydf-devel] r2205 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611161649.kAGGncqK016295@sheep.berlios.de>

Author: ximian
Date: 2006-11-16 17:49:29 +0100 (Thu, 16 Nov 2006)
New Revision: 2205

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
- added new static method YDArrayUtil::getGMT that returns a simple array with gmts

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-11-16 16:48:20 UTC (rev 2204)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2006-11-16 16:49:29 UTC (rev 2205)
@@ -266,6 +266,22 @@
             }
         }
 
+
+        /**
+         *  This function will return a array with gmts.
+         *
+         *  @returns	Array: array( -23 => '-23', ..., 0 => '0', ..., 23 => '+23' );
+         *  @static
+         */
+		function getGMT(){
+
+			$gmts = array();
+			for($i = -23; $i <= 23; $i++) 
+				if ($i < 1 ) $gmts[$i] =      strval($i);
+				else		 $gmts[$i] = '+'. strval($i);
+			return $gmts;
+		}
+
     }
 
     /**



From francisco at fusemail.com  Thu Nov 16 18:02:25 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 16 Nov 2006 17:02:25 +0000
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
In-Reply-To: <20061116124418.22599.qmail@web54008.mail.yahoo.com>
References: <20061116124418.22599.qmail@web54008.mail.yahoo.com>
Message-ID: <455C99A1.7010403@fusemail.com>

Hi Graeme

> The new YDDatabaseTree2 is a cool 8-) new implementation of database trees!
> 
> There is a bug in the select statement for YDDatabaseTree2::getNode. I 
> think the code needs to include appropriate quote characters so that 
> string fields can be used in addition to numeric id fields. String 
> fields cause the db instance to raise an error.

Fixed.

> I have also written a findNode method which allows for the tree to be 
> search based on a number of equality criteria ( field / value pairs).
> 
>         /**
>          *  Find the node data for the node matching the criteria.
>          *
>          *  @param $criteria      Array of field/value pairs.
>          *
>          *  @returns An object containing the node's data, or false if 
> node not found
>          */
>         function findNode( $criteria ) {


The method sounds good but i would prefer to include it in 
YDDatabaseTree3 (the YDDatabaseObject version of YDDatabaseTree2).
This way we could implement getNodes and _getNodes as:

function _getNodes(){

	$this->find();
	return $this->getValues();
}


function getNodes(){
	$this->resetValues();
	return $this->_getNodes();
}


Then, if you want to use getNode you only need to invoke it.. but you 
can easily extend it in your code:


	$dbTree3 = new YDDatabaseTree3( ... );
	$dbTree3->set( 'realm', 'abc' );
	$dbTree3->set( 'url', '/index.php' );

	$node = $dbTree3->_getNodes();
	
	// _getNode() and not getNode()!!
	// otherwise your previous sets would be ignored

This has Huge capabilities because you can use all YDDatabaseObject 
features to extend the method!
Eg:
   - Imagine you want to set limits.. you only need to:

	$dbTree3 = new YDDatabaseTree3( ... );
	$dbTree3->set( 'realm', 'abc' );
	$dbTree3->set( 'url', '/index.php' );
	$dbTree3->limit( 3 );

	$node = $dbTree3->_getNodes();

   - Imagine you want to create LIKES:

	$dbTree3 = new YDDatabaseTree3( ... );
	$dbTree3->where( "'realm LIKE 'ab%'" );
	$dbTree3->set( 'url', '/index.php' );
	$dbTree3->limit( 3 );

	$node = $dbTree3->_getNodes();

	This will retrive the first 3 elements where realm starts
	with ab and url is /index.php


What do you think?

regards
Francisco A



From francisco at fusemail.com  Thu Nov 16 18:21:41 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 16 Nov 2006 17:21:41 +0000
Subject: [ydf-devel] Is YDDatabaseTree2::moveNode working?
In-Reply-To: <20061116164045.29870.qmail@web54009.mail.yahoo.com>
References: <20061116164045.29870.qmail@web54009.mail.yahoo.com>
Message-ID: <455C9E25.2010300@fusemail.com>

Hi Graeme

What is you mySQL version?

> Is the new YDDatabaseTree2::moveNode complete?
> 
> I am trying to move nodes in the tree and I get SQL errors in the logs 
> such as:
> 
> PHP Fatal error:  [1064] You have an error in your SQL syntax; check the 
> manual that corresponds to your MySQL server version for the right 
> syntax to use near 'REPLACE(lineage,"//15//27/","//15/30//27/")'
> 
> The syntax of the lineage in the generated statement doesn't look right.  
> 
> Is the correct method for changing the position of a node in the same 
> branch of the tree. Are these the right steps?:
> 
> 1. calculate the node's new position $new_pos and remember its parent 
> $parent
> 2. temporarily move the node to a new parent (moveNode)
> 3. move the node back to $parent and set its position $new_pos (moveNode)



From ximian at mail.berlios.de  Thu Nov 16 18:30:07 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 16 Nov 2006 18:30:07 +0100
Subject: [ydf-devel] r2206 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611161730.kAGHU7Zn020278@sheep.berlios.de>

Author: ximian
Date: 2006-11-16 18:29:56 +0100 (Thu, 16 Nov 2006)
New Revision: 2206

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
Log:
- fixed replace on moving nodes in YDDatabaseTree2 (experiment)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-16 16:49:29 UTC (rev 2205)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2006-11-16 17:29:56 UTC (rev 2206)
@@ -586,7 +586,7 @@
             $res = $this->db->executeUpdate( $this->table, $values, $this->fields['id'] . ' = ' . $id );
 
 			// update lineage of all descendants of this node.
-			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET REPLACE(' . $this->fields['lineage'] . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
+			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['lineage'] . ' = REPLACE(' . $this->fields['lineage'] . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
 
 			return $res;
         }



From francisco at fusemail.com  Thu Nov 16 18:30:53 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 16 Nov 2006 17:30:53 +0000
Subject: [ydf-devel] Is YDDatabaseTree2::moveNode working?
In-Reply-To: <20061116164045.29870.qmail@web54009.mail.yahoo.com>
References: <20061116164045.29870.qmail@web54009.mail.yahoo.com>
Message-ID: <455CA04D.4010208@fusemail.com>

Hi Graeme

Can you try again using b2206

> Is the new YDDatabaseTree2::moveNode complete?




From ximian at mail.berlios.de  Fri Nov 17 00:27:58 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 00:27:58 +0100
Subject: [ydf-devel] r2207 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611162327.kAGNRwnx028147@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 00:27:38 +0100 (Fri, 17 Nov 2006)
New Revision: 2207

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
- new class YDDatabaseTree3: the lineage tree algorithm implemented as a YDDatabaseObject extension

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-16 17:29:56 UTC (rev 2206)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-16 23:27:38 UTC (rev 2207)
@@ -0,0 +1,653 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// add YDF libs needed by this class
+	YDInclude( 'YDDatabaseObject.php' );
+
+
+    /** Database scheme example
+		
+	    CREATE TABLE nested_tree (
+            id int NOT NULL auto_increment,
+            parent_id int NULL,
+			lineage varchar(255) NOT NULL default '//',
+            level int NOT NULL default '1',
+            position int NOT NULL default '1',
+            title varchar(255) NOT NULL default '',
+            PRIMARY KEY (id),
+			FOREIGN KEY (parent_id)
+                REFERENCES nested_tree(id)
+                     ON DELETE CASCADE
+                     ON UPDATE CASCADE
+        )TYPE=InnoDB;
+
+		Note: root node must have ID 1, PARENT null and LINEAGE '' !
+
+        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
+        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
+     */
+
+    /**
+     *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject
+     */
+    class YDDatabaseTree3 extends YDDatabaseObject {
+    
+        function YDDatabaseTree3( $table, $db = 'default', $idField = 'id', $parentField = 'parent_id', $lineageField = 'lineage', $levelField = 'level', $positionField = 'position' ) {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database
+            $this->registerDatabase( $db );
+
+			// register table
+            $this->registerTable( $table );
+
+			// register reserved fields
+			$this->registerKey( $idField, true );
+			$this->registerField( $parentField );
+			$this->registerField( $lineageField );
+			$this->registerField( $levelField );
+			$this->registerField( $positionField );
+
+			// save field names for future use
+			$this->__id       = $idField;
+			$this->__parent   = $parentField;
+			$this->__lineage  = $lineageField;
+			$this->__level    = $levelField;
+			$this->__position = $positionField;
+		}
+
+
+        /**
+         *  Returns the node level based on the lineage string
+         *
+         *  @returns  level int value
+         */
+        function _getLevel( $lineage ) {
+			return substr_count( $lineage, '/' ) - 1;
+        }
+
+
+        /**
+         *  Fetch the node data for the node identified by $id.
+         *
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   (Optional) The unique field to select on. Defaults to id, which means that the ID field specified
+         *                  when the object was instantiated will be used.
+         *
+         *  @returns An object containing the node's data, or false if node not found
+         */
+        function getNode( $id, $field = null ) {
+
+			$this->resetValues();
+
+			// if field not defined, field is id
+			if ( is_null( $field ) ) $field = $this->__id;
+	
+			// set field
+			$this->set( $field, $id );
+
+            // get node
+            return $this->_getNode();
+        }
+
+
+        /**
+         *  Helper method to fetch a node.
+         *
+         *  @returns An object containing the node's data, or false if node not found
+         */
+        function _getNode() {
+
+			// check results
+			if ( $this->find() == 0 ) return false;
+
+            // Execute the query and return the record
+            return $this->getValues();
+        }
+
+
+        /**
+         *  Fetch the descendants of a node. NOTE: To get all elements use getTreeElements()
+         *
+         *  @param $id              The ID of the node to fetch descendant data for. 
+         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *
+         *  @returns The descendants of the passed now
+         */
+        function getDescendants( $id, $includeSelf = false ) {
+
+			$this->resetValues();
+
+			return $this->_getDescendants( $id, $includeSelf );
+		}
+
+
+        /**
+         *  Helper to fetch the descendants of a node
+         *
+         *  @param $id              The ID of the node to fetch descendant data for. 
+         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *
+         *  @returns The descendants of id
+         */
+        function _getDescendants( $id, $includeSelf = false ) {
+
+            // get just children
+			if ( $includeSelf == false ) $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			else                         $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->__id . ' = ' . intval( $id ) );
+
+			// find nodes
+			$this->find();
+
+			// return all nodes
+			return $this->getResults();
+		}
+
+
+        /**
+         *  Fetch all elements of a tree
+         *
+         *  @returns All tree nodes
+         */
+        function getTreeElements() {
+
+			$this->resetValues();
+
+			return $this->_getTreeElements();
+		}
+
+
+        /**
+         *  Helper to fetch all elements of a tree
+         *
+         *  @returns All tree nodes
+         */
+        function _getTreeElements() {
+
+			// get all elements except root
+			$this->where( $this->__id . ' > 1' );
+
+			// find elements
+			$this->find();
+
+			// return all nodes
+			return $this->getResults();
+		}
+
+
+        /**
+         *  Fetch the children of a node, or if no node is specified, fetch the top level items.
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *
+         *  @returns The children of the passed id
+         */
+        function getChildren( $id, $includeSelf = false ){
+
+			$this->resetValues();
+			
+			return $this->_getChildren( $id, $includeSelf );
+        }
+
+
+        /**
+         *  Helper to fetch the children of a node, or if no node is specified, fetch the top level items.
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *
+         *  @returns The children of the passed id
+         */
+        function _getChildren( $id, $includeSelf = false ){
+
+            // get just children
+			if ( $includeSelf == false ) $this->where( $this->__parent . ' = ' . intval( $id ) );
+			else                         $this->where( $this->__parent . ' = ' . intval( $id ) . ' OR ' . $this->__parent . ' = ' . intval( $id ) );
+
+			$this->find();
+
+			return $this->getResults();
+        }
+
+
+        /**
+         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
+         *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
+         *  array).
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *
+         *  @returns An array of each node to passed node
+         */
+        function getPath( $id, $includeSelf=false ) {
+
+			$this->resetValues();
+
+			return $this->_getPath( $id, $includeSelf );
+        }
+
+
+        /**
+         *  Helper to fetch the path to a node. 
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *
+         *  @returns An array of each node to passed node
+         */
+        function _getPath( $id, $includeSelf = false ) {
+
+            // Get the node
+            $node = $this->getNode( $id ) ;
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
+			$nodes = implode( '","', array_map( 'intval', explode('/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) ) );
+
+            if ( $includeSelf == false ) $this->where( $this->__id . ' IN ("' . implode( '","', $nodes ) . '")' );
+			else                         $this->where( $this->__id . ' IN ("' . implode( '","', $nodes ) . '") OR ' . $this->__id . ' = ' . intval( $id ) );
+
+			$this->find();
+
+			return $this->getResults();
+        }
+
+
+        /**
+         *  Check if one node descends from another node. If either node is not found, then false is returned.
+         *
+         *  @param $descendant_id  The node that potentially descends
+         *  @param $ancestor_id    The node that is potentially descended from
+         *
+         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
+         */
+        function isDescendantOf( $descendant_id, $ancestor_id ) {
+
+			$this->resetValues();
+			
+			return _isDescendantOf( $descendant_id, $ancestor_id );
+        }
+
+
+        /**
+         *  Helper to check if one node descends from another node.
+         *
+         *  @param $descendant_id  The node that potentially descends
+         *  @param $ancestor_id    The node that is potentially descended from
+         *
+         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
+         */
+        function _isDescendantOf( $descendant_id, $ancestor_id ) {
+
+			// id must be the descendant
+			$this->set( $this->__id, intval( $descendant_id ) );
+
+			// check if descendant has the ancestor in lineage ;)
+			$this->where( $this->__lineage . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' );
+		
+			// get total of rows
+			return ( $this->find() == 1 );
+        }
+
+
+        /**
+         *  Check if one node is a child of another node. If either node is not found, then false is returned.
+         *
+         * @param $child_id       The node that is possibly a child
+         * @param $parent_id      The node that is possibly a parent
+         *
+         * @returns True if $child_id is a child of $parent_id, false otherwise
+         */
+        function isChildOf( $child_id, $parent_id ) {
+
+			$this->resetValues();
+
+			// check if there is a id that equals $child_id
+			$this->set( $this->__id, intval( $child_id ) );
+
+			// check if there is a parent that equals $parent_id
+			$this->set( $this->__parent, intval( $parent_id ) );
+
+			// get total of rows
+			return ( $this->find() == 1 );
+        }
+
+
+        /**
+         *  Find the number of descendants a node has
+         *
+         *  @param $id     The ID of the node to search for.
+         *
+         *  @returns The number of descendants the node has
+         */
+        function numDescendants( $id ) {
+
+			$this->resetValues();
+
+			return $this->_numDescendants( $id );
+        }
+
+
+        /**
+         *  Helper to find the number of descendants a node has
+         *
+         *  @param $id     The ID of the node to search for.
+         *
+         *  @returns The number of descendants the node has
+         */
+        function _numDescendants( $id ) {
+
+			// register a custom select
+			$this->registerSelect( 'num_descendants', 'COUNT(*)' );
+			
+			// search all nodes that contains this id in lineage
+			$this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+
+			// find them
+			$this->find();
+			
+			// get total
+			$total = $this->get( 'num_descendants' );
+
+			// unregister select. otherwise could be used on by other method
+			$this->unregisterSelect( 'num_descendants' );
+
+			return $total;
+        }
+
+
+        /**
+         *  Find the number of children a node has
+         *
+         *  @param $id     The ID of the node to search for. Pass 0 to count the first level items
+         *
+         *  @returns The number of descendants the node has, or -1 if the node isn't found.
+         */
+        function numChildren( $id ) {
+
+			$this->resetValues();
+
+			// search all nodes that contains this id in lineage
+			$this->set( $this->__parent, intval( $id ) );
+
+			// find them
+			return $this->find();
+        }
+
+
+        /**
+         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. 
+         *
+         * @param $id   The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the family
+         */
+        function getImmediateFamily( $id ) {
+
+            // Get the node parent
+            $node = $this->getNode( $id );
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			$this->resetValues();
+
+			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
+			$this->where( $this->__parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+
+			$this->find();
+
+            // Execute the query and get the record
+            return $this->getRecords();
+        }
+
+
+        /**
+         *  This function adds a node to the database.
+         *
+         *  @param $values      The field values of the node. Do NOT define parent_id here!
+         *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child (its parent will be 1)
+         *  @param $position    (optional) Node position. If not set, node will be added at the end position
+         *
+         *  @returns    The ID of the newly inserted node.
+         */
+        function addNode( $values, $parent_id = 1, $position = null ) {
+
+            // compute linege. to do that we must check if we want to add node to root
+            if ( $parent_id == 1 ) { 
+
+				// compute lineage
+				$lineage = '//';
+			}else{
+
+				// get parent lineage and compute node lineage
+				$parent_node = $this->getNode( $parent_id );
+				$lineage     = $parent_node[ $this->__lineage ] . $parent_id . '/';
+			}
+
+			// get how much brothers we will have
+			$total_brothers = $this->numChildren( $parent_id );
+
+			// compute position. If passed in arg we check if really can be that value, otherwise place node at the end
+			if ( !is_numeric( $position ) || intval( $position ) < 1 || intval( $position ) > $total_brothers + 1 )
+				$position = $total_brothers + 1;
+
+			// create an empty position. To do this we must increment position of nodes that have the same parent AND have position equal or bigger than $position
+			$this->resetValues();
+
+			// position field must increment
+			$this->set( $this->__position, $this->__position . ' + 1' );
+
+			// only on new brothers with higher or equal position
+			$this->where( $this->__parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__position . ' >= ' . intval( $position ) );
+
+			// lets update.
+			$this->update();
+
+			// reset any previous value to create insert
+			$this->resetValues();
+
+			// apply custom values
+			$this->setValues( $values );
+
+			// override reserved fields
+			$this->set( $this->__parent,   $parent_id );
+			$this->set( $this->__lineage,  $lineage );
+			$this->set( $this->__level,    $this->_getLevel( $lineage ) );
+			$this->set( $this->__position, $position );
+
+			return $this->insert();
+        }
+
+
+        /**
+         *  This function updates a node fields ( that are NOT RESERVED only )
+         *
+         *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
+         *  @param $id          (optional) The ID of the node to update.
+         *
+         *  @returns    Total of lines affected
+         */
+        function updateNode( $values, $id ) {
+
+			$this->resetValues();
+
+			// get reserved field names
+			$parent   = $this->__parent;
+			$lineage  = $this->__lineage;
+			$level    = $this->__level;
+			$position = $this->__position;
+
+			// apply custom values
+			$this->setValues( $values );
+			
+			// overwrite id
+			$this->set( $this->__id, intval( $id ) );
+
+			// unset reserved fields
+			unset( $this->$parent );
+			unset( $this->$lineage );
+			unset( $this->$level );
+			unset( $this->$position );
+
+			return $this->update();
+        }
+
+
+        /**
+         *  Delete the node and it's children. NOTE: Make shure your table is in InnoDB !
+         *
+         *  @param $id             The ID of the node to delete.
+         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
+         *
+         *  @returns    Total of lines affected
+         */
+        function deleteNode( $id, $deleteAll = true ) {
+
+            // if we want to delete $id (and all children) we must update positions in all $id brothers after delete
+			if ( $deleteAll ){
+
+	            // get node details before delete. we must know the position
+	            $node = $this->getNode( $id );
+
+				$this->resetValues();
+
+				$this->set( $this->__id, intval( $id ) );
+
+				// if delete didn't affect any rows we don't need to update brothers
+				$total = $this->delete();
+				
+				if ( $total == 0 ) return 0;
+
+				$this->resetValues();
+
+				// decrease positions
+				$this->set( $this->__position, $this->__position . ' - 1' );
+
+				// in all elements with same parent AND position bigger than our
+				$this->where( $this->__parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__position . ' > ' . intval( $node[ $this->__position ] ) );
+
+				$this->update();
+				
+				return $total;
+			}
+
+			// here we want do delete child only
+			$this->resetValues();
+
+			$this->set( $this->__parent, intval( $id ) );
+
+			return $this->delete();
+        }
+
+
+        /**
+         *  Move a node to a different parent node.
+         *
+         *  @param  $id         	The ID of the node to move
+         *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
+         *  @param  $position   	(optional) The new position.
+         */
+        function moveNode( $id, $new_parent_id = null, $new_position = null ) {
+
+            // get old node details before move
+            $old_node      = $this->getNode( $id );
+            $old_parent_id = $old_node[ $this->__parent ];
+            $old_position  = $old_node[ $this->__position ];
+            $old_lineage   = $old_node[ $this->__lineage ];
+
+			// compute new parent id
+			if ( ! is_numeric( $new_parent_id ) ) $new_parent_id = $old_parent_id;
+
+			// if position not set, we will move node to the end of the new parent
+			$total_new_brothers = $this->numChildren( $new_parent_id );
+
+			// if custom position is not valid add node at end
+			if ( ! is_numeric( $new_position ) || intval( $new_position ) < 1 || intval( $new_position ) > $total_new_brothers + 1 )
+				$new_position = 1 + $total_new_brothers;
+
+			// get information of old parent
+            $old_parent_node = $this->getNode( $old_parent_id );
+
+			// get information of new parent if diferent than old parent
+			if ( $new_parent_id == $old_parent_id ) $new_parent_node = $old_parent_node;
+            else                                    $new_parent_node = $this->getNode( $new_parent_id );
+
+			// if new parent is diferent than old parent we must update their child positions
+			if ( $new_parent_id != $old_parent_id ){
+
+				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
+				$this->resetValues();
+				$this->set( $this->__position, $this->__position . ' + 1' );
+				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' > ' . $new_position );
+				$this->update();
+
+				// decrease positions of old brothers that have position bigger than this node position
+				$this->resetValues();
+				$this->set( $this->__position, $this->__position . ' - 1' );
+				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
+				$this->update();
+			}
+	
+			// update node
+			$this->resetValues();
+			$this->set( $this->__id,       intval( $id ) );
+			$this->set( $this->__parent,   intval( $new_parent_id ) );
+			$this->set( $this->__lineage,  $new_parent_node[ $this->__lineage ] . $new_parent_id . '/' );
+			$this->set( $this->__level,    $this->_getLevel( $new_lineage ) );
+			$this->set( $this->__position, intval( $new_position ) );
+			$res = $this->update();
+			
+			// update lineages of node descendants ;)
+			if ( $new_parent_id != $old_parent_id ){
+				$this->resetValues();
+				$this->set( $this->__linage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
+				$this->update();
+			}
+
+			return $res;
+        }
+
+
+
+    }
+?>
\ No newline at end of file



From maximus_meridius79 at yahoo.com  Fri Nov 17 12:14:27 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Fri, 17 Nov 2006 03:14:27 -0800 (PST)
Subject: [ydf-devel] Is YDDatabaseTree2::moveNode working?
Message-ID: <20061117111427.58056.qmail@web54010.mail.yahoo.com>

Hi Francisco,

The mysql version I am using is 5.0.22. PHP version is
5.1.4. This is on 
a Fedora Core 5 box.

Regards,

Graeme

Francisco Azevedo wrote:
> Hi Graeme
>
> What is you mySQL version?
>   



 
____________________________________________________________________________________
Sponsored Link

Online degrees - find the right program to advance your career.
Www.nextag.com


From maximus_meridius79 at yahoo.com  Fri Nov 17 16:03:49 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Fri, 17 Nov 2006 07:03:49 -0800 (PST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <20061117150349.8758.qmail@web54006.mail.yahoo.com>

  Hi Francisco,

Thanks for fixing getNode. There are bugs in YDDatabaseTree2::moveNodeand YDDatabaseTree2::addNode which I will explain at the bottom of thisreply.

Francisco Azevedo wrote:      
There is a bug in the select statement for YDDatabaseTree2::getNode. I think the code needs to include appropriate quote characters so that string fields can be used in addition to numeric id fields. String fields cause the db instance to raise an error.    
    
Fixed.  

Thanks!
      
I have also written a findNode method which allows for the tree to be search based on a number of equality criteria ( field / value pairs).        /**         *  Find the node data for the node matching the criteria.         *         *  @param $criteria      Array of field/value pairs.         *         *  @returns An object containing the node's data, or false if node not found         */        function findNode( $criteria ) {    
    
The method sounds good but i would prefer to include it in YDDatabaseTree3 (the YDDatabaseObject version of YDDatabaseTree2).This way we could implement getNodes and _getNodes as:  
<code and explanation snipped>
  
What do you think?  
Your suggestion is great. I can add the find methods I suggested to anextension class rather than modifying YDDatabaseTree2.

As mentioned above, there are bugs in YDDatabaseTree2::moveNode andYDDatabaseTree2::addNode. I think the bugs will also be present inYDDatabaseTree3 since the logic is basically  the same.

For moveNode, positions can be duplicated if the position of a node ismoved within the current parent. For addNode the database can also endup with duplicated positions within the current parent.

I have attached a modified version of YDDatabaseTree2containing my fixes.

I was thinking that the following methods would make use of the treeclasses more flexible:
  
   positionDecrementNode( $id, $lock_branch = true ) -decrease the position of the specified node within the current branch.If lock_branch is set to false and the node's current position is 1then the node will move up to the position one less than the parent'sposition in the parent level.  
   positionIncrementNode( $id, $lock_branch = true ) -increase the position of the specified node within the current branch.If lock_branch is set to false and the node's current position is thehighest in the current branchthen the node will move up to the position one greater than theparent's position in the parent level.  
   levelPromoteNode( $id ) - reduce the level of thespecified node by 1 and the position will be set to the position of theparent node plus one.  
   levelDemoteNode( $id ) - increase the level of thespecified node by making the node a child of its brother node (thebrother node with position one less than the subject node's originalposition).
  
Regards,

Graeme


 
---------------------------------
Sponsored Link

Mortgage rates near 39yr lows. $310,000 Mortgage for $999/mo -  Calculate new house payment
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061117/30abb39a/attachment.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061117/30abb39a/attachment-0001.html>

From ximian at mail.berlios.de  Fri Nov 17 19:07:54 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 19:07:54 +0100
Subject: [ydf-devel] r2208 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171807.kAHI7srd031019@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 19:07:35 +0100 (Fri, 17 Nov 2006)
New Revision: 2208

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
- another fix on YDDatabaseTree3::moveNode

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-16 23:27:38 UTC (rev 2207)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 18:07:35 UTC (rev 2208)
@@ -612,13 +612,14 @@
 			if ( $new_parent_id == $old_parent_id ) $new_parent_node = $old_parent_node;
             else                                    $new_parent_node = $this->getNode( $new_parent_id );
 
-			// if new parent is diferent than old parent we must update their child positions
-			if ( $new_parent_id != $old_parent_id ){
 
+			// only update positions if new parent and old parent are not the same OR if (they are same but) positions are not changed
+			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
+
 				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
 				$this->resetValues();
 				$this->set( $this->__position, $this->__position . ' + 1' );
-				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' > ' . $new_position );
+				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' >= ' . $new_position );
 				$this->update();
 
 				// decrease positions of old brothers that have position bigger than this node position
@@ -627,7 +628,7 @@
 				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
 				$this->update();
 			}
-	
+
 			// update node
 			$this->resetValues();
 			$this->set( $this->__id,       intval( $id ) );



From francisco at fusemail.com  Fri Nov 17 19:10:00 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Fri, 17 Nov 2006 12:10:00 -0600 (CST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <1163787000.v2.fusewebmail-15630@f>

Hi Graeme

> As mentioned above, there are bugs in YDDatabaseTree2::moveNode and
> YDDatabaseTree2::addNode. I think the bugs will also be present in
> YDDatabaseTree3 since the logic is basically  the same.
>
> For moveNode, positions can be duplicated if the position of a node is
> moved within the current parent. For addNode the database can also end
> up with duplicated positions within the current parent.

Well, some fixes (related to addNode) were already done.. but in current
YDDatabaseTree3 (shame on me.. i didn't update YDDT2).


> I have *attached *a modified version of YDDatabaseTree2 containing my
fixes.

Graeme, i saw your fixes but i think we could have some problems too.
I have fixed YDDatabaseTree3::moveNode.

One think i would like to tell too is that i would prefer to delete 
YDDatabaseTree2 and use YDDatabaseTree3 since they use the same algorithm
but YDDatabaseTree3 is far the best implementation.

So, please use YDDatabaseTree3 :)

> I was thinking that the following methods would make use of the tree
> classes more flexible:

That's cool. Let's see...

>     * *positionDecrementNode( $id, $lock_branch = true )* - decrease the
>       position of the specified node within the current branch. If
>       lock_branch is set to false and the node's current position is 1
>       then the node will move up to the position one less than the
>       parent's position in the parent level.

Yes, but i'm confused. :)
Afaik, all your methods are difference forms of move, right?

So, with a original tree like:

.
+- A
|
+- B
|  +- X
|  +- Y
|  |  +- G
|  +- L
|
+- C
   +- D

So, positionDecrementNode( X, false ) will result in:

.
+- A
|
+- X
+- B
|  +- Y
|  |  +- G
|  +- L
|
+- C
   +- D


>     * *positionIncrementNode( $id, $lock_branch = true )* - increase the
>       position of the specified node within the current branch. If
>       lock_branch is set to false and the node's current position is the
>       highest in the current branch then the node will move up to the
>       position one greater than the parent's position in the parent level.


So, with a original tree like:

.
+- A
|
+- B
|  +- X
|  +- Y
|  |  +- G
|  +- L
|
+- C
   +- D

So, positionIncrementNode( G, false ) will result in:

.
+- A
|
+- B
|  +- X
|  +- Y
|  +- G
|  +- L
|
+- C
   +- D


.. this sounds very strange to me.. but ok.

>     * *levelPromoteNode( $id )* - reduce the level of the specified node
>       by 1 and the position will be set to the position of the parent
>       node plus one.

So, with a original tree like:

.
+- A
|
+- B
|  +- X
|  +- Y
|  |  +- G
|  +- L
|
+- C
   +- D

So, levelPromoteNode( X ) will result in:


.
+- A
|
+- B
|  +- Y
|  |  +- G
|  +- L
|
+- X
|
+- C
   +- D

but.. should the position be PARENT - one ..(instead of +) ?


>     * *levelDemoteNode( $id )* - increase the level of the specified
>       node by making the node a child of its brother node (the brother
>       node with position one less than the subject node's original
>       position).

So, with a original tree like:

.
+- A
|
+- B
|  +- X
|  +- Y
|  |  +- G
|  +- L
|
+- C
   +- D

So, levelDemoteNode( Y ) will result in:

.
+- A
|
+- B
|  +- X
|  |  +- Y
|  |     +- G
|  +- L
|
+- C
   +- D


Graeme, my personal opinion is that these methods have "strange" results
in some contexts and all can be done using the moveNode with some tests
before.. but should we implement them in YDDT3?

Btw, please test YDDT3 moveNode and addNode.

What do you think?
Francisco A



From ximian at mail.berlios.de  Fri Nov 17 19:37:54 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 19:37:54 +0100
Subject: [ydf-devel] r2209 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171837.kAHIbs7E019151@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 19:37:35 +0100 (Fri, 17 Nov 2006)
New Revision: 2209

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
- added new method YDDatabaseTree3::_getTreeElementsAsAssocArray
  * returns nodes as an associative array

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 18:07:35 UTC (rev 2208)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 18:37:35 UTC (rev 2209)
@@ -213,6 +213,30 @@
 
 
         /**
+         *  Helper to fetch all elements of a tree as an assocArray
+         *
+         *  @param $columns             (Optional) Columns to retrieve. Default: add columns
+         *  @param $key                 (Optional) Key to use. Default: current table key
+         *
+         *  @returns All tree nodes
+         */
+        function _getTreeElementsAsAssocArray( $columns = array(), $key = null ) {
+
+			// get all elements except root
+			$this->where( $this->__id . ' > 1' );
+
+			// find elements
+			$this->find();
+
+			// compute key
+			if ( is_null( $key ) ) $key = $this->__id;
+
+			// return all nodes
+			return $this->getResultsAsAssocArray( $key, $columns );
+		}
+
+
+        /**
          *  Fetch the children of a node, or if no node is specified, fetch the top level items.
          *
          *  @param $id             The ID of the node to fetch child data for.



From ximian at mail.berlios.de  Fri Nov 17 19:58:29 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 19:58:29 +0100
Subject: [ydf-devel] r2210 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171858.kAHIwTb1021017@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 19:58:11 +0100 (Fri, 17 Nov 2006)
New Revision: 2210

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
- added new method YDDatabase::escapeSqlArray that converts an array to a escaped string

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 18:37:35 UTC (rev 2209)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 18:58:11 UTC (rev 2210)
@@ -1183,7 +1183,21 @@
             return $string;
         }
 
+
         /**
+         *  This function will escape all array elements with the quotes appropriate for the database backend.
+         *
+         *  @param $array  The array to escape. Eg: array( 1, null, 'hi' ) will result in string: "1, null, 'hi'"
+         *
+         *  @returns    The escaped string surrounded by quotes.
+         */
+        function escapeSqlArray( $arr ) {
+
+			return implode( ',', array_map( array( 'YDDatabaseDriver', 'escapeSql' ), $arr ) );
+		}
+
+
+        /**
          *  Function to prepare an SQL statement with parameters. The parameters start counting from 1.
          
          *  This works as follows:



From ximian at mail.berlios.de  Fri Nov 17 20:01:05 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 20:01:05 +0100
Subject: [ydf-devel] r2211 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171901.kAHJ1597021277@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 20:00:48 +0100 (Fri, 17 Nov 2006)
New Revision: 2211

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
- simple tag fix on previous YDDatabase::escapeSqlArray

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 18:58:11 UTC (rev 2210)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 19:00:48 UTC (rev 2211)
@@ -1187,7 +1187,7 @@
         /**
          *  This function will escape all array elements with the quotes appropriate for the database backend.
          *
-         *  @param $array  The array to escape. Eg: array( 1, null, 'hi' ) will result in string: "1, null, 'hi'"
+         *  @param $arr  The array to escape. Eg: array( 1, null, 'hi' ) will result in string: "1, null, 'hi'"
          *
          *  @returns    The escaped string surrounded by quotes.
          */



From ximian at mail.berlios.de  Fri Nov 17 20:02:31 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 20:02:31 +0100
Subject: [ydf-devel] r2212 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171902.kAHJ2Vpq021343@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 20:02:14 +0100 (Fri, 17 Nov 2006)
New Revision: 2212

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
- added new YDDatabaseTree3::escapeSql and YDDatabaseTree3::escapeSqlArray 
  (based on YDDatabase methods)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 19:00:48 UTC (rev 2211)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 19:02:14 UTC (rev 2212)
@@ -95,6 +95,33 @@
 
 
         /**
+         *  This function will escape a string so that it's safe to include it in an SQL statement and will surround it
+         *  with the quotes appropriate for the database backend.
+         *
+         *  @param $string  The string to escape.
+         *
+         *  @returns    The escaped string surrounded by quotes.
+         */
+        function escapeSql( $string ){
+
+			return $this->_db->escapeSql( $string );
+        }
+
+
+        /**
+         *  This function will escape all array elements with the quotes appropriate for the database backend.
+         *
+         *  @param $array  The array to escape. Eg: array( 1, null, 'hi' ) will result in "1, null, 'hi'"
+         *
+         *  @returns    The escaped string surrounded by quotes.
+         */
+        function escapeSqlArray( $arr ) {
+
+			return $this->_db->escapeSqlArray( $arr );
+		}
+
+
+        /**
          *  Returns the node level based on the lineage string
          *
          *  @returns  level int value



From ximian at mail.berlios.de  Fri Nov 17 20:44:57 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 17 Nov 2006 20:44:57 +0100
Subject: [ydf-devel] r2213 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611171944.kAHJivel025284@sheep.berlios.de>

Author: ximian
Date: 2006-11-17 20:44:39 +0100 (Fri, 17 Nov 2006)
New Revision: 2213

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
  * simple cleanups
  * added default order by

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 19:02:14 UTC (rev 2212)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-17 19:44:39 UTC (rev 2213)
@@ -27,7 +27,7 @@
     }
 
 	// add YDF libs needed by this class
-	YDInclude( 'YDDatabaseObject.php' );
+	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
 
 
     /** Database scheme example
@@ -91,6 +91,9 @@
 			$this->__lineage  = $lineageField;
 			$this->__level    = $levelField;
 			$this->__position = $positionField;
+
+			// define a generic tree order
+			$this->order( $this->__parent . ' ASC,' . $this->__position .' ASC' );
 		}
 
 
@@ -111,7 +114,7 @@
         /**
          *  This function will escape all array elements with the quotes appropriate for the database backend.
          *
-         *  @param $array  The array to escape. Eg: array( 1, null, 'hi' ) will result in "1, null, 'hi'"
+         *  @param $arr  The array to escape. Eg: array( 1, null, 'hi' ) will result in "1, null, 'hi'"
          *
          *  @returns    The escaped string surrounded by quotes.
          */



From ximian at mail.berlios.de  Sat Nov 18 00:25:07 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 18 Nov 2006 00:25:07 +0100
Subject: [ydf-devel] r2214 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611172325.kAHNP7kC026422@sheep.berlios.de>

Author: ximian
Date: 2006-11-18 00:24:47 +0100 (Sat, 18 Nov 2006)
New Revision: 2214

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
fix: on YDDatabase, escapeSqlArray cannot invoke escapeSql statically.


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 19:44:39 UTC (rev 2213)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-17 23:24:47 UTC (rev 2214)
@@ -1193,7 +1193,7 @@
          */
         function escapeSqlArray( $arr ) {
 
-			return implode( ',', array_map( array( 'YDDatabaseDriver', 'escapeSql' ), $arr ) );
+			return implode( ',', array_map( array( &$this, 'escapeSql' ), $arr ) );
 		}
 
 



From maximus_meridius79 at yahoo.com  Sat Nov 18 15:29:53 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Sat, 18 Nov 2006 06:29:53 -0800 (PST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <20061118142953.31695.qmail@web54002.mail.yahoo.com>

    Francisco Azevedo wrote:
  
Well, some fixes (related to addNode) were already done.. but in currentYDDatabaseTree3 (shame on me.. i didn't update YDDT2).
Ok.
  
Graeme, i saw your fixes but i think we could have some problems too.I have fixed YDDatabaseTree3::moveNode.One think i would like to tell too is that i would prefer to delete YDDatabaseTree2 and use YDDatabaseTree3 since they use the same algorithmbut YDDatabaseTree3 is far the best implementation.So, please use YDDatabaseTree3 :)  
I am switching my code to YDDatabaseTree3 (build 2214). I have had alook at the code and suggest some improvements and have identified somebugs.
  
   suggestion: move the methods escapeSql and escapeSqlArray toYDDatabaseObject since they would be useful there too.  
   suggestion: there needs to be a method like the oldYDDatabaseTree that gets the tree as a traversed tree (I have had anattempt to implement this in the attached code, however it is not veryefficient). The method is YDDatabaseTree3::getTraversedTree()
    
   bug in build 2214: line 668 of YDDatabaseTree3.php - need to addstatement????:
$new_lineage         = $new_parent_node[ $this->__lineage ] .$new_parent_id . '/';
    
   bug in build 2214: line 698 of YDDatabaseTree3.php -$this->_linage should be $this->lineage  
   bug in build 2214: moveNode doesn't work for moving position of anode in the same parent or moving a node to a new parent.
  
I have copied the original test harness for database trees and createda new one called database_tree3.php. This uses YDDatabaseTree3 and hassome methods for testing moveNode. This is attached.

There are still more problems with YDDatabaseTree3::moveNode. I haven'tbeen able to get it to work. The code results in positions of elementsbeing set to 0 which isn't right. I have attached a HTML file so youcan see node 362 (originally position 5) that now has position 0 afterI moved node 363 which was at position 6.
      
    * *positionDecrementNode( $id, $lock_branch = true )* - decrease the      position of the specified node within the current branch. If      lock_branch is set to false and the node's current position is 1      then the node will move up to the position one less than the      parent's position in the parent level.    
    
Yes, but i'm confused. :)Afaik, all your methods are difference forms of move, right?  
Yes
  
So, with a original tree like:.+- A|+- B|  +- X|  +- Y|  |  +- G|  +- L|+- C   +- DSo, positionDecrementNode( X, false ) will result in:.+- A|+- X+- B|  +- Y|  |  +- G|  +- L|+- C   +- D  
Yes
  

      
    * *positionIncrementNode( $id, $lock_branch = true )* - increase the      position of the specified node within the current branch. If      lock_branch is set to false and the node's current position is the      highest in the current branch then the node will move up to the      position one greater than the parent's position in the parent level.    
    
So, with a original tree like:.+- A|+- B|  +- X|  +- Y|  |  +- G|  +- L|+- C   +- DSo, positionIncrementNode( G, false ) will result in:.+- A|+- B|  +- X|  +- Y|  +- G|  +- L|+- C   +- D  
Yes
  
.. this sounds very strange to me.. but ok.  
      
    * *levelPromoteNode( $id )* - reduce the level of the specified node      by 1 and the position will be set to the position of the parent      node plus one.    
    
So, with a original tree like:.+- A|+- B|  +- X|  +- Y|  |  +- G|  +- L|+- C   +- DSo, levelPromoteNode( X ) will result in:.+- A|+- B|  +- Y|  |  +- G|  +- L|+- X|+- C   +- D  
Yes
  
but.. should the position be PARENT - one ..(instead of +) ?  
No. I think it is correct the way you have "drawn" it.
  

      
    * *levelDemoteNode( $id )* - increase the level of the specified      node by making the node a child of its brother node (the brother      node with position one less than the subject node's original      position).    
    
So, with a original tree like:.+- A|+- B|  +- X|  +- Y|  |  +- G|  +- L|+- C   +- DSo, levelDemoteNode( Y ) will result in:.+- A|+- B|  +- X|  |  +- Y|  |     +- G|  +- L|+- C   +- DGraeme, my personal opinion is that these methods have "strange" resultsin some contexts and all can be done using the moveNode with some testsbefore.. but should we implement them in YDDT3?  
These would only be implemented in YDDT3. Without these methods,position has to be manually calculated when moving a node from onebranch to the next. The simplicity of the parameter list means you onlyneed to know the id of the node you are moving and the direction youwant to move it (up, down, promote, demote). I can see these would beuseful in managing hierarchical blog categories, permission groups orstructured list data like multi-level menus.

  
Btw, please test YDDT3 moveNode and addNode.  

Using the test harness, I am quite satisfied that addNode is workingquite well. moveNode still needs more work. One thing that you need toclarify in the comments for moveNode is whether moveNode is designedfor moving a node and all its children or whether it should only beused to move leaf nodes.

Regards,

Graeme


 
---------------------------------
Sponsored Link

   Mortgage rates as low as 4.625% - $150,000 loan for $579 a month. Intro-*Terms
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061118/69e9313a/attachment.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061118/69e9313a/attachment-0001.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061118/69e9313a/attachment-0002.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061118/69e9313a/attachment-0003.html>

From maximus_meridius79 at yahoo.com  Sat Nov 18 15:40:14 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Sat, 18 Nov 2006 06:40:14 -0800 (PST)
Subject: [ydf-devel] YDAjax and mootools
Message-ID: <20061118144014.2031.qmail@web54008.mail.yahoo.com>

  Hi,

Does anyone have any suggestions or comments on YDLayers that I created? It is working quite well for creating modal lightbox style forms andpopups within the page.

My e-mail to this list on 30 October has a screenshot.

Note that these both require:
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2791&group_id=3988(add YDAjax::isOnResponse )
http://developer.berlios.de/feature/?func=detailfeature&feature_id=2824&group_id=3988(add YDTemplate::addJavascriptUrl )

Thanks,

Graeme

maximus meridius wrote:    Hi,
  
I have created a new class called YDLayer to work alongside YDAjax forcreating dynamic layers. This is to keep the complexity outside ofYDAjax rather than my earlier attempt to add draggables. The mootoolsjavascript library is used for this instead of moofx. 
  
There is an attached screenshot for the example.
  
Layers have the following characteristics:
      
   layers can be optionally modal (this relies on special css"#overlay" - see the example)
        
   layers can be optionally dragged    
   layers can have a title    
   mutliple layers can be instantiated    
   layers have a html id automatically assigned and a close linkgenerated
        
   layers can be dynamically opened or closed
        
   layers can be dynamically closed in response
        
   layers can be centered    
   layers can be used to contain a form    
   layers can be inserted and hence contained in parent elements (this is currently buggy in browsers such as explorer ). The dragging isbuggy since the positioning is wrong.
      
The layer code works in IE6, IE7, Firefox, Safari and Opera. Safari hasissues with the wrong mouse cursors being displayed.
  
A tarball with the following code is attached:
  
./js/mootools.svn.compressed.83.js
./js/mootools.svn.83.js
./js/ydtools.js
./examples/index.php
./examples/ajax/layer.php
./examples/ajax/layer.tpl
./YDFramework2/YDClasses/YDTemplate.php
./YDFramework2/addons/YDAjax/YDAjax.php
./YDFramework2/addons/YDAjax/YDLayer.php
./examples/ajax/close-icon.png
  
This is some of the rationale in the way I constructed it:
      
   I added a new method to the smarty version of YDTemplate toprovide for linked javascript in addition to javascript embedded in thetemplate head. The reason for this is that the compressed mootoolslibrary is approximately 24kilobytes. Linking the javascript in thismanner allows it to be cached. There was a corresponding change toYDTemplate::__assignHeadCode. I have submitted a feature request forthe change to YDTemplate since this is a generally useful change.
        
   I designed YDLayer so that layers could be dynamically added inthe request or the response. The new example demonstrates this. Thisrequired the addition of the YDAjax::isOnResponse method. I havesubmitted a feature request for the addition of YDAjax::isOnResponsewhich is also generally useful in putting together functionality basedon YDAjax.    
   The example layer.php contains a methodsetup_thetestform_layer()which shows how to associate server-side processing via manual setup ofan onclick event that uses xajax.getFormValues.
        
   Rather than attaching javascript to form elements such asbuttonsfor closing the form, I decided that it is more appropriate to close alayer programmatically via the php response processing function. Thisis achieved by passing the received form values (which include theautomatically assigned hidden layer id) to a close method. The closemethod searches for this id in the form values and generates javascriptto close the layer. The example layer.php shows how to do this in the"defaultOne" method.    
   .layer-title and .layer-close are css classes that can be usedtocontrol the appearance of the layer title and close link.    
   YDLayer::setHtmlClass and YDLayer::setHtmlId can be used tooverride the html class and html id of the layer. These should becalled before YDLayer::render(). YDLayer::render() is generally thelast call which will add the layer into the results or request.    
   Initially I thought that the class should be called YDWindowbutI think YDLayer is more generic for the purposes it could be used for.
      
Any feedback is appreciated ...
  
Enjoy!
  
Regards,
  
Graeme
  
  
maximus meridius wrote:      
Hi,I have modified YDAjax and YDAjaxEffects classes touse the new mootools javascript framework from http://mootools.net/ .The effects are more complex to setup internally butthere is much greater power and flexibility in mootools. Mootools is20kb compressed whilst moo.fx is 8kb compressed.A tarball is attached.-rwxrw-r--  39011 2006-10-19 01:22./YDFramework2/addons/YDAjax/YDAjax.php-rwxr--r--   43422 2006-10-18 21:35 ./YDFramework2/addons/YDAjax/js/mootools.svn.76.js-rwxr--r--  24000 2006-10-19 01:05 ./YDFramework2/addons/YDAjax/js/mootools.svn.compressed.76.jsThis uses a configuration variable "YD_AJAX_MOOTOOLS"to enable mootools instead of moo.fx. The change to YDAjax.php is quiteminor. I changed YDAjax.php so that the effects interface is compatibleand hence the existing effects example "examples/ajax/image2.php"works without change. For an improved implementation and due to thesize of the mootools javascript file it would be better to link toits javascript rather than
 embedding it directly. YDTemplate wouldneed to be modified to do this.I have not implemented "fadesize". I have also nottested "hide", "show" and focus, however these don't rely on the effectslibrary.The mootools is build 76 from the svn repository atmootools. I have included compressed and uncompressed versions of thejavascript since the uncompressed file contains the license information(MIT style license).Regards,Graeme  
    
 
  
---------------------------------
Everyone is raving about the all-new Yahoo! Mail.  

---------------------------------
_______________________________________________YDFramework-devel mailing listYDFramework-devel at lists.berlios.dehttps://lists.berlios.de/mailman/listinfo/ydframework-devel  


 
---------------------------------
Sponsored Link

Mortgage rates near 39yr lows. $310,000 Mortgage for $999/mo -  Calculate new house payment
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061118/ae461a94/attachment.html>

From ximian at mail.berlios.de  Sat Nov 18 23:26:58 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 18 Nov 2006 23:26:58 +0100
Subject: [ydf-devel] r2215 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200611182226.kAIMQwO4028926@sheep.berlios.de>

Author: ximian
Date: 2006-11-18 23:26:48 +0100 (Sat, 18 Nov 2006)
New Revision: 2215

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
added new methods: YDDatabaseObject::escapeSql and YDDatabaseObject::escapeSqlArray

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-11-17 23:24:47 UTC (rev 2214)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-11-18 22:26:48 UTC (rev 2215)
@@ -168,7 +168,35 @@
 
         }
 
+
         /**
+         *  This function will escape a string so that it's safe to include it in an SQL statement and will surround it
+         *  with the quotes appropriate for the database backend.
+         *
+         *  @param $string  The string to escape.
+         *
+         *  @returns    The escaped string surrounded by quotes.
+         */
+        function escapeSql( $string ){
+
+			return $this->_db->escapeSql( $string );
+        }
+
+
+        /**
+         *  This function will escape all array elements with the quotes appropriate for the database backend.
+         *
+         *  @param $arr  The array to escape. Eg: array( 1, null, 'hi' ) will result in "1, null, 'hi'"
+         *
+         *  @returns    The escaped string surrounded by quotes.
+         */
+        function escapeSqlArray( $arr ) {
+
+			return $this->_db->escapeSqlArray( $arr );
+		}
+
+
+        /**
          *  This function register the database connection.
          *
          *  @param $db  The YDDatabase object pointing to the database or the named instance.



From ximian at mail.berlios.de  Sat Nov 18 23:29:20 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 18 Nov 2006 23:29:20 +0100
Subject: [ydf-devel] r2216 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611182229.kAIMTKvG029040@sheep.berlios.de>

Author: ximian
Date: 2006-11-18 23:29:08 +0100 (Sat, 18 Nov 2006)
New Revision: 2216

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
lots of cleanups and some fixes on YDDatabaseTree3

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-18 22:26:48 UTC (rev 2215)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-18 22:29:08 UTC (rev 2216)
@@ -80,7 +80,7 @@
 
 			// register reserved fields
 			$this->registerKey( $idField, true );
-			$this->registerField( $parentField );
+			$this->registerKey( $parentField );
 			$this->registerField( $lineageField );
 			$this->registerField( $levelField );
 			$this->registerField( $positionField );
@@ -93,34 +93,27 @@
 			$this->__position = $positionField;
 
 			// define a generic tree order
-			$this->order( $this->__parent . ' ASC,' . $this->__position .' ASC' );
+			$this->setOrder( $this->__parent . ' ASC, ' . $this->__position . ' ASC' );
 		}
 
 
         /**
-         *  This function will escape a string so that it's safe to include it in an SQL statement and will surround it
-         *  with the quotes appropriate for the database backend.
+         *  This function defines the order used in all SELECTS
          *
-         *  @param $string  The string to escape.
-         *
-         *  @returns    The escaped string surrounded by quotes.
+         *  @param $string  The sql order string.
          */
-        function escapeSql( $string ){
+        function setOrder( $sql ){
 
-			return $this->_db->escapeSql( $string );
+			return $this->_tree_order = $sql;
         }
 
 
         /**
-         *  This function will escape all array elements with the quotes appropriate for the database backend.
-         *
-         *  @param $arr  The array to escape. Eg: array( 1, null, 'hi' ) will result in "1, null, 'hi'"
-         *
-         *  @returns    The escaped string surrounded by quotes.
+         *  This function will overide the YDDatabaseObject to reset object but init order
          */
-        function escapeSqlArray( $arr ) {
-
-			return $this->_db->escapeSqlArray( $arr );
+		function reset(){
+			parent::reset();
+			$this->order( $this->_tree_order );
 		}
 
 
@@ -145,7 +138,7 @@
          */
         function getNode( $id, $field = null ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			// if field not defined, field is id
 			if ( is_null( $field ) ) $field = $this->__id;
@@ -183,8 +176,11 @@
          */
         function getDescendants( $id, $includeSelf = false ) {
 
-			$this->resetValues();
+			// check if we want an invalid id (like 0 or 1)
+			if ( $id < 2 ) return $this->getTreeElements();
 
+			$this->reset();
+
 			return $this->_getDescendants( $id, $includeSelf );
 		}
 
@@ -218,7 +214,7 @@
          */
         function getTreeElements() {
 
-			$this->resetValues();
+			$this->reset();
 
 			return $this->_getTreeElements();
 		}
@@ -275,7 +271,7 @@
          */
         function getChildren( $id, $includeSelf = false ){
 
-			$this->resetValues();
+			$this->reset();
 			
 			return $this->_getChildren( $id, $includeSelf );
         }
@@ -312,7 +308,7 @@
          */
         function getPath( $id, $includeSelf=false ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			return $this->_getPath( $id, $includeSelf );
         }
@@ -331,14 +327,17 @@
             // Get the node
             $node = $this->getNode( $id ) ;
 
+			// reset values of previous getNode()
+			$this->reset();
+
             // No node, return empty array
             if ( ! $node ) return array();
 
 			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
-			$nodes = implode( '","', array_map( 'intval', explode('/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) ) );
+			$nodes = array_map( 'intval', explode( '/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) );
 
-            if ( $includeSelf == false ) $this->where( $this->__id . ' IN ("' . implode( '","', $nodes ) . '")' );
-			else                         $this->where( $this->__id . ' IN ("' . implode( '","', $nodes ) . '") OR ' . $this->__id . ' = ' . intval( $id ) );
+            if ( $includeSelf == false ) $this->where( $this->getTable() . '.' . $this->__id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
+			else                         $this->where( $this->getTable() . '.' . $this->__id . ' IN (' . $this->escapeSqlArray( $nodes ) . ') OR ' . $this->__id . ' = ' . intval( $id ) );
 
 			$this->find();
 
@@ -356,9 +355,12 @@
          */
         function isDescendantOf( $descendant_id, $ancestor_id ) {
 
-			$this->resetValues();
+			// if ancertor is root, element is descendant if exist
+			if ( $ancestor_id == 1 ) return ( $this->getNode( $descendant_id ) != false );
+
+			$this->reset();
 			
-			return _isDescendantOf( $descendant_id, $ancestor_id );
+			return $this->_isDescendantOf( $descendant_id, $ancestor_id );
         }
 
 
@@ -393,7 +395,7 @@
          */
         function isChildOf( $child_id, $parent_id ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			// check if there is a id that equals $child_id
 			$this->set( $this->__id, intval( $child_id ) );
@@ -415,7 +417,7 @@
          */
         function numDescendants( $id ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			return $this->_numDescendants( $id );
         }
@@ -430,22 +432,11 @@
          */
         function _numDescendants( $id ) {
 
-			// register a custom select
-			$this->registerSelect( 'num_descendants', 'COUNT(*)' );
-			
-			// search all nodes that contains this id in lineage
-			$this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			// search all nodes that contains this id in lineage. if node is root, count all nodes
+			if ( $id > 1 ) $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
 
 			// find them
-			$this->find();
-			
-			// get total
-			$total = $this->get( 'num_descendants' );
-
-			// unregister select. otherwise could be used on by other method
-			$this->unregisterSelect( 'num_descendants' );
-
-			return $total;
+			return $this->find();
         }
 
 
@@ -458,7 +449,7 @@
          */
         function numChildren( $id ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			// search all nodes that contains this id in lineage
 			$this->set( $this->__parent, intval( $id ) );
@@ -483,7 +474,7 @@
             // No node, return empty array
             if ( ! $node ) return array();
 
-			$this->resetValues();
+			$this->reset();
 
 			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
 			$this->where( $this->__parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
@@ -491,7 +482,7 @@
 			$this->find();
 
             // Execute the query and get the record
-            return $this->getRecords();
+            return $this->getResults();
         }
 
 
@@ -526,7 +517,7 @@
 				$position = $total_brothers + 1;
 
 			// create an empty position. To do this we must increment position of nodes that have the same parent AND have position equal or bigger than $position
-			$this->resetValues();
+			$this->reset();
 
 			// position field must increment
 			$this->set( $this->__position, $this->__position . ' + 1' );
@@ -538,7 +529,7 @@
 			$this->update();
 
 			// reset any previous value to create insert
-			$this->resetValues();
+			$this->reset();
 
 			// apply custom values
 			$this->setValues( $values );
@@ -563,7 +554,7 @@
          */
         function updateNode( $values, $id ) {
 
-			$this->resetValues();
+			$this->reset();
 
 			// get reserved field names
 			$parent   = $this->__parent;
@@ -603,7 +594,7 @@
 	            // get node details before delete. we must know the position
 	            $node = $this->getNode( $id );
 
-				$this->resetValues();
+				$this->reset();
 
 				$this->set( $this->__id, intval( $id ) );
 
@@ -612,7 +603,7 @@
 				
 				if ( $total == 0 ) return 0;
 
-				$this->resetValues();
+				$this->reset();
 
 				// decrease positions
 				$this->set( $this->__position, $this->__position . ' - 1' );
@@ -626,7 +617,7 @@
 			}
 
 			// here we want do delete child only
-			$this->resetValues();
+			$this->reset();
 
 			$this->set( $this->__parent, intval( $id ) );
 
@@ -671,20 +662,20 @@
 			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
 
 				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
-				$this->resetValues();
+				$this->reset();
 				$this->set( $this->__position, $this->__position . ' + 1' );
 				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' >= ' . $new_position );
 				$this->update();
 
 				// decrease positions of old brothers that have position bigger than this node position
-				$this->resetValues();
+				$this->reset();
 				$this->set( $this->__position, $this->__position . ' - 1' );
 				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
 				$this->update();
 			}
 
 			// update node
-			$this->resetValues();
+			$this->reset();
 			$this->set( $this->__id,       intval( $id ) );
 			$this->set( $this->__parent,   intval( $new_parent_id ) );
 			$this->set( $this->__lineage,  $new_parent_node[ $this->__lineage ] . $new_parent_id . '/' );
@@ -694,7 +685,7 @@
 			
 			// update lineages of node descendants ;)
 			if ( $new_parent_id != $old_parent_id ){
-				$this->resetValues();
+				$this->reset();
 				$this->set( $this->__linage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
 				$this->update();
 			}



From ximian at mail.berlios.de  Sat Nov 18 23:34:31 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 18 Nov 2006 23:34:31 +0100
Subject: [ydf-devel] r2217 - YDFramework2.0/trunk/examples
Message-ID: <200611182234.kAIMYVdq029412@sheep.berlios.de>

Author: ximian
Date: 2006-11-18 23:34:19 +0100 (Sat, 18 Nov 2006)
New Revision: 2217

Added:
   YDFramework2.0/trunk/examples/database_tree3.php
Log:
- added new YDDatabaseTree3 test example: database_tree3.php

Added: YDFramework2.0/trunk/examples/database_tree3.php
===================================================================
--- YDFramework2.0/trunk/examples/database_tree3.php	2006-11-18 22:29:08 UTC (rev 2216)
+++ YDFramework2.0/trunk/examples/database_tree3.php	2006-11-18 22:34:19 UTC (rev 2217)
@@ -0,0 +1,213 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    /*
+
+	    CREATE TABLE nested_tree (
+            id int NOT NULL auto_increment,
+            parent_id int NULL,
+			lineage varchar(255) NOT NULL default '//',
+            level int NOT NULL default '1',
+            position int NOT NULL default '1',
+            title varchar(255) NOT NULL default '',
+            PRIMARY KEY (id),
+			FOREIGN KEY (parent_id)
+                REFERENCES nested_tree(id)
+                     ON DELETE CASCADE
+                     ON UPDATE CASCADE
+        )TYPE=InnoDB;
+
+		Note: root node must have ID 1, PARENT null and LINEAGE '' !
+
+        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
+        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
+
+        // ==== Sample data dump =======================================================================================
+		+----+-----------+---------+-------+----------+----------------------+
+		| id | parent_id | lineage | level | position | title                |
+		+----+-----------+---------+-------+----------+----------------------+
+		|  1 |      NULL |         |     0 |        1 |                      |
+		|  2 |         1 | //      |     1 |        1 | General Resources    |
+		|  3 |         2 | //2/    |     2 |        1 | Code Paste           |
+		|  4 |         2 | //2/    |     2 |        2 | Documentation        |
+		|  5 |         2 | //2/    |     2 |        3 | Books & Publications |
+		|  6 |         5 | //2/5/  |     3 |        1 | Apache               |
+		|  7 |         5 | //2/5/  |     3 |        2 | PostgreSQL           |
+		|  8 |         5 | //2/5/  |     3 |        3 | MySQL                |
+		|  9 |         2 | //2/    |     2 |        4 | Links                |
+		| 10 |         9 | //2/9/  |     3 |        1 | Databases            |
+		| 11 |         9 | //2/9/  |     3 |        2 | Generators           |
+		| 12 |         9 | //2/9/  |     3 |        3 | Portals              |
+		+----+-----------+---------+-------+----------+----------------------+
+
+        // =============================================================================================================
+
+    */
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDDatabaseTree3.php' );
+
+	YDConfig::set( 'YD_DEBUG', 2 );
+
+    // Class definition
+    class database_tree3 extends YDRequest {
+
+        // Class constructor
+        function database_tree3() {
+
+            // Call the parent
+            $this->YDRequest();
+
+            // Get the database connection
+            $db = YDDatabase::getInstance( 'mysql', 'tree_test', 'root', '', 'localhost' );
+
+            // Get the tree instance
+            $this->tree = new YDDatabaseTree3( 'nested_tree', $db );
+			
+			// register extra column
+			$this->tree->registerField( 'title', true );
+
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Show the link to the sitemap action
+            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example">Sitemap</a>' );
+
+            // Get a reference to the tree
+            $tree = & $this->tree;
+
+            // Get a single node
+            YDDebugUtil::dump( $tree->getNode( 2 ), '$tree->getNode( 2 )' );
+
+            // Get the children of a single node
+            YDDebugUtil::dump( $tree->getChildren( 2 ), '$tree->getChildren( 2 )' );
+            YDDebugUtil::dump( $tree->getChildren( 4 ), '$tree->getChildren( 4 )' );
+
+            // Get the descendants of a single node
+            YDDebugUtil::dump( $tree->getDescendants( 4, true ), '$tree->getDescendants( 4, true )' );
+            YDDebugUtil::dump( $tree->getDescendants( 0, true ), '$tree->getDescendants( 0, true )' );
+
+            // Get the path to a node
+            YDDebugUtil::dump( $tree->getPath( 5 ), '$tree->getPath( 5 )' );
+            YDDebugUtil::dump( $tree->getPath( 5, true ), '$tree->getPath( 5, true )' );
+
+            // Check if descendant
+            YDDebugUtil::dump( $tree->isDescendantOf( 9, 1 ), '$tree->isDescendantOf( 9, 1 )' );
+            YDDebugUtil::dump( $tree->isDescendantOf( 9999, 1 ), '$tree->isDescendantOf( 9999, 1 )' );
+            YDDebugUtil::dump( $tree->isDescendantOf( 10, 2 ), '$tree->isDescendantOf( 10, 2 )' );
+
+            // Check if child of
+            YDDebugUtil::dump( $tree->isChildOf( 9, 8 ), '$tree->isChildOf( 9, 8 )' );
+            YDDebugUtil::dump( $tree->isChildOf( 9, 2 ), '$tree->isChildOf( 9, 2 )' );
+
+            // Number of descendants
+            YDDebugUtil::dump( $tree->numDescendants( 9 ), '$tree->numDescendants( 9 )' );
+            YDDebugUtil::dump( $tree->numDescendants( 4 ), '$tree->numDescendants( 4 )' );
+            YDDebugUtil::dump( $tree->numDescendants( 1 ), '$tree->numDescendants( 1 )' );
+
+            // Number of children
+            YDDebugUtil::dump( $tree->numChildren( 9 ), '$tree->numChildren( 9 )' );
+            YDDebugUtil::dump( $tree->numChildren( 4 ), '$tree->numChildren( 4 )' );
+            YDDebugUtil::dump( $tree->numChildren( 1 ), '$tree->numChildren( 1 )' );
+
+            // Get the node's immediate family
+            YDDebugUtil::dump( $tree->getImmediateFamily( 4 ), '$tree->getImmediateFamily( 4 )' );
+
+        }
+		
+        // Add a number of nodes
+        function actionAdd() {
+
+            // Get the node ID
+            $id = ( isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
+        
+            // Add an item
+            $values = array( 'title' => 'New Node - ' . time() );
+            
+			$this->tree->addNode( $values, $id );
+
+            $this->actionExample( true );
+        }
+
+
+        // Delete a node and it's subnodes
+        function actionDelete() {
+
+            // Get a reference to the tree
+            $tree = & $this->tree;
+
+            // Delete a node
+            $tree->deleteNode( $_GET['id'] );
+            
+            // Redirect to the sitemap
+            $this->actionExample( true );
+
+        }
+
+        // Real life example
+        function actionExample( $root = false) {
+
+  			YDConfig::set( 'YD_DEBUG', 0 );
+  
+            // Get node ID
+            $id = ( $root == false && isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
+
+            // compute path
+            echo( '<p><b>Path:</b> ROOT &raquo; ' );
+            foreach ( $this->tree->getPath( $id ) as $path_item ) {
+                echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $path_item['id'] . '">' . $path_item['title'] . '</a> &raquo; ' );
+            }
+
+			// compute node name
+            $node = $this->tree->getNode( $id );
+            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $node['id'] . '">' . $node['title'] . '</a>' );
+            echo( '</p>' );
+
+            // Show the item
+            echo( '<p><b>' . $node['title'] . '</b></p> ' );
+
+            // Show the children in a table
+			echo( '<table><tr><td><b>Children:</b></td><td>actions</td></tr>' );
+            foreach ( $this->tree->getChildren( $id ) as $child ) {
+				echo( '<tr><td>' );
+
+					// show child action
+                	echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $child['id'] . '">' . $child['title'] . '</a>&nbsp;&nbsp;&nbsp;' );
+				echo( '</td><td>' );
+
+					// delete action
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&id='  . $child['id'] . '">Delete (' . $child['title'] . ')</a><br/>' );
+				echo( '</td></tr>' );
+            }
+  
+  			// add node action
+			echo( '<tr><td></td><td>' );
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ')</a><br/>' );
+			echo( '</td></tr>' );
+
+            echo( '</table>' );
+        }
+
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>



From francisco at fusemail.com  Sat Nov 18 23:40:07 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sat, 18 Nov 2006 22:40:07 +0000
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
In-Reply-To: <20061118142953.31695.qmail@web54002.mail.yahoo.com>
References: <20061118142953.31695.qmail@web54002.mail.yahoo.com>
Message-ID: <455F8BC7.1000708@fusemail.com>

Hi Graeme

 > I am switching my code to YDDatabaseTree3 (build 2214). I have had a
 > look at the code and suggest some improvements and have identified some
 > bugs.
 >
 >     * suggestion: move the methods escapeSql and escapeSqlArray to
 >       YDDatabaseObject since they would be useful there too.

Sounds good. YDDatabaseObject will have those and YDDatabaseTree3 too 
(because is an YDDO extension).

 >     * suggestion: there needs to be a method like the old YDDatabaseTree
 >       that gets the tree as a traversed tree (I have had an attempt to
 >       implement this in the attached code, however it is not very
 >       efficient). The method is YDDatabaseTree3::getTraversedTree()


Please create an example on what should getTraversedTree() return.


 >     * bug in build 2214: line 668 of YDDatabaseTree3.php - need to add
 >       statement????:
 >       $new_lineage         = $new_parent_node[ $this->__lineage ] .
 >       $new_parent_id . '/';

Please update to latest build (on latest release that is done in the 
update (search lines below that)).

 >     * bug in build 2214: line 698 of YDDatabaseTree3.php -
 >       $this->_linage should be $this->lineage

Please update to latest build


 >     * bug in build 2214: moveNode doesn't work for moving position of a
 >       node in the same parent or moving a node to a new parent.
 >
 > I have copied the original test harness for database trees and created a
 > new one called database_tree3.php. This uses YDDatabaseTree3 and has
 > some methods for testing moveNode. This is attached.

I have created a simple test based on your test file. (it's not possible 
to move nodes yet.. only see, delete and add.. i will add that feature).

======================

WARNING !!! :D   YOUR initial db scheme in NOT correct.
You have:

+----+-----------+---------+-------+----------+----------------------+
| id | parent_id | lineage | level | position | title                |
+----+-----------+---------+-------+----------+----------------------+
|  1 |      NULL |         |     0 |        1 |                      |
|  2 |         1 | //      |     1 |        1 | General Resources    |
|  3 |         2 | //2/    |     2 |        1 | Code Paste           |
|  4 |         2 | //2/    |     2 |        2 | Documentation        |
|  5 |         2 | //2/    |     2 |        3 | Books & Publications |
|  6 |         5 | //2/5/  |     3 |        1 | Apache               |
|  7 |         5 | //2/5/  |     3 |        2 | PostgreSQL           |
|  8 |         5 | //2/4/  |     3 |        3 | MySQL                |
|  9 |         2 | //2/    |     2 |        1 | Links                |
| 10 |         9 | //2/9/  |     3 |        1 | Databases            |
| 11 |         9 | //2/10/ |     3 |        1 | Generators           |
| 12 |         9 | //2/10/ |     3 |        2 | Portals              |
+----+-----------+---------+-------+----------+----------------------+


But it should be


+----+-----------+---------+-------+----------+----------------------+
| id | parent_id | lineage | level | position | title                |
+----+-----------+---------+-------+----------+----------------------+
|  1 |      NULL |         |     0 |        1 |                      |
|  2 |         1 | //      |     1 |        1 | General Resources    |
|  3 |         2 | //2/    |     2 |        1 | Code Paste           |
|  4 |         2 | //2/    |     2 |        2 | Documentation        |
|  5 |         2 | //2/    |     2 |        3 | Books & Publications |
|  6 |         5 | //2/5/  |     3 |        1 | Apache               |
|  7 |         5 | //2/5/  |     3 |        2 | PostgreSQL           |
|  8 |         5 | //2/5/  |     3 |        3 | MySQL                |
|  9 |         2 | //2/    |     2 |        4 | Links                |
| 10 |         9 | //2/9/  |     3 |        1 | Databases            |
| 11 |         9 | //2/9/  |     3 |        2 | Generators           |
| 12 |         9 | //2/9/  |     3 |        3 | Portals              |
+----+-----------+---------+-------+----------+----------------------+

INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General 
Resources');
INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 
'Documentation');
INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & 
Publications');
INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');



======================

You should never use getDescendants( 0 ) or getDescendants( 1 ) !
To get all tree elements use getTreeElements().

NOTE: On latest build i had added a internal check in getDescendants()


Please use build 2217.

regards
Francisco A



From ximian at mail.berlios.de  Sun Nov 19 20:49:09 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sun, 19 Nov 2006 20:49:09 +0100
Subject: [ydf-devel] r2218 - in YDFramework2.0/trunk/examples: . ajax
Message-ID: <200611191949.kAJJn9Ge028990@sheep.berlios.de>

Author: ximian
Date: 2006-11-19 20:48:54 +0100 (Sun, 19 Nov 2006)
New Revision: 2218

Added:
   YDFramework2.0/trunk/examples/ajax/form_runtime.php
Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
- added new YDAjax example:
  * "How to add extra form elements to an existing form in a response"
  * examples index updated too

Added: YDFramework2.0/trunk/examples/ajax/form_runtime.php
===================================================================
--- YDFramework2.0/trunk/examples/ajax/form_runtime.php	2006-11-18 22:34:19 UTC (rev 2217)
+++ YDFramework2.0/trunk/examples/ajax/form_runtime.php	2006-11-19 19:48:54 UTC (rev 2218)
@@ -0,0 +1,117 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDForm.php' );
+    YDInclude( 'YDAjax.php' );
+
+
+    // Class definition
+    class form_runtime extends YDRequest {
+
+        function form_runtime() {
+
+			$this->YDRequest();
+			$this->tpl = new YDTemplate();
+        }
+
+
+        // Default action
+        function actionDefault() {
+
+			$this->form = new YDForm( 'myform' );
+
+			// create form elements
+			$this->form->addElement( 'text',     'myname',     'Name' );
+			$this->form->addElement( 'text',     'mybill',     'Billing address' );
+			$this->form->addElement( 'checkbox', 'ship',       'Shipping address is not billing address' );
+			$this->form->addElement( 'span',     'shipform',   '' );
+			$this->form->addElement( 'button',   'mybutton',   'Send form details' );
+
+			// create form rules
+			$this->form->addRule( 'myname', 'required', 'Name is required' );
+			$this->form->addRule( 'mybill', 'required', 'Billing address is required' );
+
+			// create ajax object
+			$this->ajax = new YDAjax( $this->tpl );
+			$this->ajax->addForm( $this->form );
+
+			// add event to button (to send form details)
+			$this->ajax->addEvent( 'mybutton', array( & $this, 'processform' ), $this->form->getName() );
+
+			// add event to checkbox to compute shipping address form extra elements
+			$this->ajax->addEvent( 'ship', array( & $this, 'sendShipForm' ), 'ship' );
+
+			// process all events
+			$this->ajax->processEvents();
+
+			// assign title, form and display template
+			$this->tpl->assign( 'title', 'YDAjax form submition' );
+			$this->tpl->assign( 'form',  $this->form->toHTML() );
+			$this->tpl->display( 'general' );
+        }
+
+
+		// process form call invoked by ajax
+		function processform( $formvalues ){
+
+			// if form is not valid, send errors to client side using an alert
+			if ( ! $this->form->validate( $formvalues ) )
+				return YDAjax::message( $this->form->getErrors( true, "\n* ", "* " ) );
+
+			// if checkbox is ON we must add extra fields and validate them
+			if ( $this->form->getValue( 'ship' ) ){
+				
+				// add extra fields
+				$this->_computeExtra();
+				
+				// validate again
+				if ( ! $this->form->validate( $formvalues ) )
+ 					return YDAjax::message( $this->form->getErrors( true, "\n* ", "* " ) );
+			}
+
+			// return OK message
+			return YDAjax::message( "Thanks! \nHere goes what i got:\n\n" . var_export( $this->form->getValues(), true ) );
+		}
+
+
+		// Helper method to compute extra fields
+		function _computeExtra(){
+		
+			// lets's add some elements..
+			$this->form->addElement( 'text', 'sendname', 'Shipping name' );
+			$this->form->addElement( 'text', 'sendaddr', 'Shipping address' );
+
+			// add rules too
+			$this->form->addRule( 'sendaddr', 'required', "You want to send to a different addr that is empty?!" );
+			
+			// we need to get the html of these new elements
+			$arr = $this->form->toarray();
+			$extraHTML  = '';
+			$extraHTML .= $arr[ 'sendname' ][ 'label_html' ] . '<br />' . $arr[ 'sendname' ][ 'html' ] . '<br /><br />';
+			$extraHTML .= $arr[ 'sendaddr' ][ 'label_html' ] . '<br />' . $arr[ 'sendaddr' ][ 'html' ] . '<br /><br />';
+
+			return $extraHTML;
+		}
+
+
+		// send shipping address form (based on checkbox value)
+		function sendShipForm( $chk ){
+		
+			// test if checkbox is ON
+			if ( $chk ) $this->ajax->addResult( 'shipform', $this->_computeExtra() );
+			else        $this->ajax->addResult( 'shipform', '' );
+
+			return $this->ajax->processResults();
+		}
+
+   }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-11-18 22:34:19 UTC (rev 2217)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-11-19 19:48:54 UTC (rev 2218)
@@ -574,7 +574,7 @@
           <td><b>&nbsp;</b></td>
         </tr>
         <tr>
-          <td valign="top" rowspan="19">&nbsp;</td>
+          <td valign="top" rowspan="20">&nbsp;</td>
           <td valign="top"><a href="ajax/version.php">Simple ajax example</a><br/>          </td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/version.php">ajax/version.php</a> </td>
         </tr>
@@ -611,6 +611,11 @@
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/persistent_store.php">ajax/persistent_store.php</a> </td>
         </tr>
         <tr>
+          <td valign="top"><a href="ajax/form_runtime.php">Adding extra form elements in a response </a><br/>
+          </td>
+          <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/form_runtime.php">ajax/form_runtime.php</a> </td>
+          </tr>
+        <tr>
           <td valign="top"><a href="ajax/list_options.php">Adding elements to a select box dynamically </a><br/></td>
           <td valign="top"><a href="{$YD_SELF_SCRIPT}?do=source&id=ajax/list_options.php">ajax/list_options.php</a> </td>
         </tr>



From pclaerhout at mail.berlios.de  Sun Nov 19 21:52:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 19 Nov 2006 21:52:37 +0100
Subject: [ydf-devel] r2219 -
	YDFramework2.0/trunk/examples/weblog/include/languages
Message-ID: <200611192052.kAJKqbkC001521@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-19 21:52:37 +0100 (Sun, 19 Nov 2006)
New Revision: 2219

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_de.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_ptb.php
Log:
Fixed an escape problem in some of the messages.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_de.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_de.php	2006-11-19 19:48:54 UTC (rev 2218)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_de.php	2006-11-19 20:52:37 UTC (rev 2219)
@@ -1,7 +1,7 @@
 <?php
-// (c) Rene Schmidt, please retain copyright
-// GFDL license
-// Version 0.1 - first version, incomplete
+// (c) Rene Schmidt, please retain copyright
+// GFDL license
+// Version 0.1 - first version, incomplete
 
 // General stuff
 $GLOBALS['t']['not_found'] = 'Nicht gefunden';
@@ -343,7 +343,7 @@
 $GLOBALS['t']['gz_compress'] = 'Datenbank-Sicherung mit GZip komprimieren';
 $GLOBALS['t']['backup'] = 'Sicherung';
 $GLOBALS['t']['err_bck_name'] = 'Dateiname f&uuml;r Datenbank-Sicherung wird ben&ouml;tigt';
-$GLOBALS['t']['bck_name_comment'] = 'Use "%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
+$GLOBALS['t']['bck_name_comment'] = 'Use "%%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
 $GLOBALS['t']['bck_type'] = 'Sicherungstyp';
 $GLOBALS['t']['bck_full'] = 'Komplette Sicherung (Struktur und Daten)';
 $GLOBALS['t']['bck_structure_only'] = 'Nur Struktur';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-19 19:48:54 UTC (rev 2218)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-19 20:52:37 UTC (rev 2219)
@@ -340,7 +340,7 @@
 $GLOBALS['t']['gz_compress'] = 'Compress backup using GZip compression';
 $GLOBALS['t']['backup'] = 'Backup';
 $GLOBALS['t']['err_bck_name'] = 'Database backup filename is required';
-$GLOBALS['t']['bck_name_comment'] = 'Use "%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
+$GLOBALS['t']['bck_name_comment'] = 'Use "%%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
 $GLOBALS['t']['bck_type'] = 'Backup type';
 $GLOBALS['t']['bck_full'] = 'Full backup (structure and data)';
 $GLOBALS['t']['bck_structure_only'] = 'Structure only';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-11-19 19:48:54 UTC (rev 2218)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_fr.php	2006-11-19 20:52:37 UTC (rev 2219)
@@ -325,7 +325,7 @@
 $GLOBALS['t']['gz_compress'] = 'Compresser la sauvegarde avec GZip';
 $GLOBALS['t']['backup'] = 'Sauvegarder';
 $GLOBALS['t']['err_bck_name'] = 'Le nom du fichier de sauvegarde est requis';
-$GLOBALS['t']['bck_name_comment'] = 'Vous pouvez utiliser "%DBNAME" pour obtenir le nom de la base et <a href="http://www.php.net/strftime" target="_blank">toute option de la fonction strftime</a> pour sp&eacute;cifier une date. L\'extension sera automatiquement ajout&eacute;e. Tout autre texte sera pr&eacute;serv&eacute;.';
+$GLOBALS['t']['bck_name_comment'] = 'Vous pouvez utiliser "%%DBNAME" pour obtenir le nom de la base et <a href="http://www.php.net/strftime" target="_blank">toute option de la fonction strftime</a> pour sp&eacute;cifier une date. L\'extension sera automatiquement ajout&eacute;e. Tout autre texte sera pr&eacute;serv&eacute;.';
 $GLOBALS['t']['bck_type'] = 'Type de sauvegarde';
 $GLOBALS['t']['bck_full'] = 'Sauvegarde Compl&egrave;te (structure et donn&eacute;es)';
 $GLOBALS['t']['bck_structure_only'] = 'Structure seule';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-19 19:48:54 UTC (rev 2218)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-19 20:52:37 UTC (rev 2219)
@@ -340,7 +340,7 @@
 $GLOBALS['t']['gz_compress'] = 'Comprimeer backup met GZip compressie';
 $GLOBALS['t']['backup'] = 'Backup';
 $GLOBALS['t']['err_bck_name'] = 'Databank backup bestandsnaam is vereist';
-$GLOBALS['t']['bck_name_comment'] = 'Gebruik "%DBNAME" voor de databank naam en <a href="http://www.php.net/strftime" target="_blank">gelijk welke strftime optie</a> voor de tijdsaanduiding. De extensie wordt automatisch toegevoegd. Alle andere tekst wordt behouden.';
+$GLOBALS['t']['bck_name_comment'] = 'Gebruik "%%DBNAME" voor de databank naam en <a href="http://www.php.net/strftime" target="_blank">gelijk welke strftime optie</a> voor de tijdsaanduiding. De extensie wordt automatisch toegevoegd. Alle andere tekst wordt behouden.';
 $GLOBALS['t']['bck_type'] = 'Backup type';
 $GLOBALS['t']['bck_full'] = 'Volledige backup (structuur en data)';
 $GLOBALS['t']['bck_structure_only'] = 'Enkel de structuur';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_ptb.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_ptb.php	2006-11-19 19:48:54 UTC (rev 2218)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_ptb.php	2006-11-19 20:52:37 UTC (rev 2219)
@@ -299,7 +299,7 @@
 $GLOBALS['t']['gz_compress'] = 'Compactar o backup utilizando a compress&atilde;o GZip';
 $GLOBALS['t']['backup'] = 'Backup';
 $GLOBALS['t']['err_bck_name'] = 'Preencha o nome do arquivo de Backup';
-$GLOBALS['t']['bck_name_comment'] = 'Utilize &quot;%DBNAME&quot; para o nome do banco e <a href="http://www.php.net/strftime" target="_blank">qualquer op&ccedil;&atilde;o strftime</a> para especificar a data. A extens&atilde;o ser&aacute; automaticamente preenchida. Qualquer outro texto ser&aacute; preservado.';
+$GLOBALS['t']['bck_name_comment'] = 'Utilize &quot;%%DBNAME&quot; para o nome do banco e <a href="http://www.php.net/strftime" target="_blank">qualquer op&ccedil;&atilde;o strftime</a> para especificar a data. A extens&atilde;o ser&aacute; automaticamente preenchida. Qualquer outro texto ser&aacute; preservado.';
 $GLOBALS['t']['bck_type'] = 'Tipo do Backup';
 $GLOBALS['t']['bck_full'] = 'Backup completo (estrutura e dados)';
 $GLOBALS['t']['bck_structure_only'] = 'Somente a Estrutura';



From pclaerhout at mail.berlios.de  Mon Nov 20 11:07:16 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Nov 2006 11:07:16 +0100
Subject: [ydf-devel] r2220 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200611201007.kAKA7GRe009361@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-20 11:07:15 +0100 (Mon, 20 Nov 2006)
New Revision: 2220

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Spam comments are now deleted after 7 instead of 15 days.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-19 20:52:37 UTC (rev 2219)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 10:07:15 UTC (rev 2220)
@@ -128,8 +128,8 @@
             // The array that will hold the image metadata
             $this->imagemetadata = null;
 
-            // Delete spam comments older than 15 days
-            $sql = 'DELETE FROM #_comments WHERE is_spam = 1 AND created < (unix_timestamp()-1296000)';
+            // Delete spam comments older than 7 days
+            $sql = 'DELETE FROM #_comments WHERE is_spam = 1 AND created < (unix_timestamp()-604800)';
             $this->db->executeSql( $sql );
 
         }



From maximus_meridius79 at yahoo.com  Mon Nov 20 14:11:02 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Mon, 20 Nov 2006 05:11:02 -0800 (PST)
Subject: [ydf-devel] Bug in YDDatabaseTree2::getNode for string fields
Message-ID: <20061120131103.68288.qmail@web54007.mail.yahoo.com>

Francisco Azevedo wrote:
> Hi Graeme
>
>  > I am switching my code to YDDatabaseTree3 (build
2214). I have had a
>  > look at the code and suggest some improvements
and have identified some
>  > bugs.
>  >
>  >     * suggestion: move the methods escapeSql and
escapeSqlArray to
>  >       YDDatabaseObject since they would be useful
there too.
>
> Sounds good. YDDatabaseObject will have those and
YDDatabaseTree3 too 
> (because is an YDDO extension).
>
>  >     * suggestion: there needs to be a method like
the old YDDatabaseTree
>  >       that gets the tree as a traversed tree (I
have had an attempt to
>  >       implement this in the attached code,
however it is not very
>  >       efficient). The method is
YDDatabaseTree3::getTraversedTree()
>
>
> Please create an example on what should
getTraversedTree() return.
>   

The code was in my last e-mail regaring YDDT3 (inside 
YDDatabaseTree3.php). There the additional methods:

        /**
         *  Helper function to get traversal of tree.
         *
         * @param $id   (optional) The ID of the node
to fetch child 
data for.
         *
         * @returns An array of each node in the tree
         */
        function _getTraversedTree( $id = 1 ) {
       
            $key_match = false;
           
            foreach ( $this->_tree_data_keys as $key )
{
                if ( $this->_tree_data[$key]['id'] ==
$id ) {
                    $key_match = true;
                    $ref = & $this->_tree_data[$key];
                    break;
                }
            }
           
            if ( $key_match ) {
                $result = array( $ref );
            } else {
                $result = array();
            }
           
            $children = $this->getChildren ( $id, true
);
           
            foreach ( $children as $child ) {         
 
                $child_ids = $this->getTraversedTree(
$child['id'] );    
           
                $result = array_merge( $result,
$child_ids );
            }
                       
            return $result;
        }
       
        /**
         *  Fetch an array of tree nodes containing a
traversal of the 
tree.
         *
         * @param $id   (optional) The ID of the node
to fetch child 
data for.
         *
         * @returns An array of each node in the tree
         */
        function getTraversedTree( $id = 1 ) {
       
            $this->_tree_data =
$this->getTreeElements();
            $this->_tree_data_keys = array_keys(
$this->_tree_data );
       
            return $this->_getTraversedTree( $id );
        }


Branches are processed in order (lowest position to
highest position) at 
each level. This recursively applies to sub-branches
(in lowest position 
to highest position of the branch. It's
A dump of the test data resulting from calling the
databasetree3 
traversal method looks like this.

array (
  0 => 
  array (
    'id' => '2',
    'parent_id' => '1',
    'lineage' => '//',
    'level' => '1',
    'position' => '1',
    'title' => 'General 
Resources',
  ),
  1 => 
  array (
    'id' => '3',
    'parent_id' => '2',
    'lineage' => '//2/',
    'level' => '2',
    'position' => '1',
    'title' => 'Code Paste',
  ),
  2 => 
  array (
    'id' => '4',
    'parent_id' => '2',
    'lineage' => '//2/',
    'level' => '2',
    'position' => '2',
    'title' => 'Documentation',
  ),
  3 => 
  array (
    'id' => '5',
    'parent_id' => '2',
    'lineage' => '//2/',
    'level' => '2',
    'position' => '3',
    'title' => 'Books & 
Publications',
  ),
  4 => 
  array (
    'id' => '6',
    'parent_id' => '5',
    'lineage' => '//2/5/',
    'level' => '3',
    'position' => '1',
    'title' => 'Apache',
  ),
  5 => 
  array (
    'id' => '7',
    'parent_id' => '5',
    'lineage' => '//2/5/',
    'level' => '3',
    'position' => '2',
    'title' => 'PostgreSQL',
  ),
  6 => 
  array (
    'id' => '8',
    'parent_id' => '5',
    'lineage' => '//2/5/',
    'level' => '3',
    'position' => '3',
    'title' => 'MySQL',
  ),
  7 => 
  array (
    'id' => '9',
    'parent_id' => '2',
    'lineage' => '//2/',
    'level' => '2',
    'position' => '4',
    'title' => 'Links',
  ),
  8 => 
  array (
    'id' => '10',
    'parent_id' => '9',
    'lineage' => '//2/9/',
    'level' => '3',
    'position' => '1',
    'title' => 'Databases',
  ),
  9 => 
  array (
    'id' => '11',
    'parent_id' => '9',
    'lineage' => '//2/9/',
    'level' => '3',
    'position' => '2',
    'title' => 'Generators',
  ),
  10 => 
  array (
    'id' => '12',
    'parent_id' => '9',
    'lineage' => '//2/9/',
    'level' => '3',
    'position' => '3',
    'title' => 'Portals',
  ),
)


>
>  >     * bug in build 2214: line 668 of
YDDatabaseTree3.php - need to add
>  >       statement????:
>  >       $new_lineage         = $new_parent_node[
$this->__lineage ] .
>  >       $new_parent_id . '/';
>
> Please update to latest build (on latest release
that is done in the 
> update (search lines below that)).
>   
Trying that now.
>  >     * bug in build 2214: line 698 of
YDDatabaseTree3.php -
>  >       $this->_linage should be $this->lineage
>
> Please update to latest build
>   

This bug still exists on line 689 of YDDatbaseTree3
(line 689). 
Incorrect spelling is used "__linage"  instead of
"__lineage"
>
>  >     * bug in build 2214: moveNode doesn't work
for moving position of a
>  >       node in the same parent or moving a node to
a new parent.
>  >
>  > I have copied the original test harness for
database trees and created a
>  > new one called database_tree3.php. This uses
YDDatabaseTree3 and has
>  > some methods for testing moveNode. This is
attached.
>
> I have created a simple test based on your test
file. (it's not possible 
> to move nodes yet.. only see, delete and add.. i
will add that feature).
>   

I will try it out.

Regards,

Graeme



 
____________________________________________________________________________________
Do you Yahoo!?
Everyone is raving about the all-new Yahoo! Mail beta.
http://new.mail.yahoo.com


From ximian at mail.berlios.de  Mon Nov 20 20:03:51 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:03:51 +0100
Subject: [ydf-devel] r2221 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611201903.kAKJ3pYL014284@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:03:34 +0100 (Mon, 20 Nov 2006)
New Revision: 2221

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
  * fixed a typo
  * fixed sql insert examples

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-20 10:07:15 UTC (rev 2220)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-20 19:03:34 UTC (rev 2221)
@@ -55,11 +55,11 @@
         INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
         INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
         INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-        INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
-        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
         INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-        INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
-        INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
      */
 
     /**
@@ -686,7 +686,7 @@
 			// update lineages of node descendants ;)
 			if ( $new_parent_id != $old_parent_id ){
 				$this->reset();
-				$this->set( $this->__linage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
+				$this->set( $this->__lineage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
 				$this->update();
 			}
 



From ximian at mail.berlios.de  Mon Nov 20 20:05:55 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:05:55 +0100
Subject: [ydf-devel] r2222 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200611201905.kAKJ5taw014604@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:05:37 +0100 (Mon, 20 Nov 2006)
New Revision: 2222

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
Log:
- default checkbox js event is now onclick, otherwise IE will only execute the event on checkbox blur.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2006-11-20 19:03:34 UTC (rev 2221)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2006-11-20 19:05:37 UTC (rev 2222)
@@ -148,7 +148,7 @@
          */
         function getJSEvent(){ 
 
-            return 'onchange';
+            return 'onclick';
         }
 
 



From pclaerhout at mail.berlios.de  Mon Nov 20 20:06:37 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Nov 2006 20:06:37 +0100
Subject: [ydf-devel] r2223 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDAkismet examples
Message-ID: <200611201906.kAKJ6bPq014757@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-20 20:06:37 +0100 (Mon, 20 Nov 2006)
New Revision: 2223

Added:
   YDFramework2.0/trunk/examples/akismet.php
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added the functions submitSpam and submitHam to YDAkismet.
Also added an example for YDAkismet.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-11-20 19:05:37 UTC (rev 2222)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2006-11-20 19:06:37 UTC (rev 2223)
@@ -70,7 +70,71 @@
          *              value is returned.
          */
         function checkComment( $comment, $author, $email='', $url='', $user_ip='', $user_agent='', $referrer='' ) {
+            return $this->doCall(
+                '/1.1/comment-check', $comment, $author, $email, $url, $user_ip, $user_agent, $referrer
+            );
+        }
 
+        /**
+         *  This call is for submitting comments that weren't marked as spam but should have been.
+         *
+         *  @param  $comment    The contents of the comment.
+         *  @param  $author     The name of the author of the comment.
+         *  @param  $email      (optional) The email address of the author of the comment.
+         *  @param  $url        (optional) The url of the website of the author of the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_agent (optional) The user agent of the person who submitted the comment.
+         *  @param  $referrer   (optional) The HTTP referrer of the person who submitted the comment.
+         *
+         *  @returns    True if the comment is spam, false if the comment is not spam. If something went wrong, a null
+         *              value is returned.
+         */
+        function submitSpam( $comment, $author, $email='', $url='', $user_ip='', $user_agent='', $referrer='' ) {
+            return $this->doCall(
+                '/1.1/submit-spam', $comment, $author, $email, $url, $user_ip, $user_agent, $referrer
+            );
+        }
+
+        /**
+         *  This call is intended for the marking of false positives, things that were incorrectly marked as spam.
+         *
+         *  @param  $comment    The contents of the comment.
+         *  @param  $author     The name of the author of the comment.
+         *  @param  $email      (optional) The email address of the author of the comment.
+         *  @param  $url        (optional) The url of the website of the author of the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_agent (optional) The user agent of the person who submitted the comment.
+         *  @param  $referrer   (optional) The HTTP referrer of the person who submitted the comment.
+         *
+         *  @returns    True if the comment is spam, false if the comment is not spam. If something went wrong, a null
+         *              value is returned.
+         */
+        function submitHam( $comment, $author, $email='', $url='', $user_ip='', $user_agent='', $referrer='' ) {
+            return $this->doCall(
+                '/1.1/submit-ham', $comment, $author, $email, $url, $user_ip, $user_agent, $referrer
+            );
+        }
+
+        /**
+         *  This function performs the actual call.
+         *
+         *  @param  $url    The URL to post to
+         *  @param  $comment    The contents of the comment.
+         *  @param  $author     The name of the author of the comment.
+         *  @param  $email      (optional) The email address of the author of the comment.
+         *  @param  $url        (optional) The url of the website of the author of the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_ip    (optional) The IP address of the person who submitted the comment.
+         *  @param  $user_agent (optional) The user agent of the person who submitted the comment.
+         *  @param  $referrer   (optional) The HTTP referrer of the person who submitted the comment.
+         *
+         *  @returns    True if the comment is spam, false if the comment is not spam. If something went wrong, a null
+         *              value is returned.
+         */
+        function doCall( $url, $comment, $author, $email='', $url='', $user_ip='', $user_agent='', $referrer='' ) {
+
             // Do the request
             $result = $this->doRequest(
                 'rest.akismet.com', '/1.1/verify-key', array( 'key' => $this->api_key, 'blog' => $this->blog_url )

Added: YDFramework2.0/trunk/examples/akismet.php
===================================================================
--- YDFramework2.0/trunk/examples/akismet.php	2006-11-20 19:05:37 UTC (rev 2222)
+++ YDFramework2.0/trunk/examples/akismet.php	2006-11-20 19:06:37 UTC (rev 2223)
@@ -0,0 +1,52 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDAkismet.php' );
+
+    // Class definition
+    class akismet extends YDRequest {
+
+        // Class constructor
+        function akismet() {
+            $this->YDRequest();
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // The comments to check
+            $comments = array(
+                array(
+                    'comment' => 'Fuck%XXKEVDJX!!http://porn.z0rder.com/anal-porn.htm [url= http://porn.z0rder.com/anal-porn.htm ]http://porn.z0rder.com/anal-porn.htm[/url]',
+                    'author'  => 'PCNFZUII',
+                ),
+                array(
+                    'comment' => 'Een commentaar',
+                    'author'  => 'Pieter Claerhout',
+                ),
+            );
+
+            // Create a new client
+            $akismet = new YDAkismet( 'http://www.yellowduck.be/', 'd60025a2e94e' );
+
+            // Check the comments
+            foreach ( $comments as $key => $comment ) {
+
+                // Check the comment
+                $result = $akismet->checkComment( $comment['comment'], $comment['author'] );
+                YDDebugUtil::dump( $result, 'comment-' . $key );
+
+            }
+
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2006-11-20 19:05:37 UTC (rev 2222)
+++ YDFramework2.0/trunk/examples/index.tpl	2006-11-20 19:06:37 UTC (rev 2223)
@@ -729,7 +729,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="15" valign="top">&nbsp;</td>
+            <td rowspan="16" valign="top">&nbsp;</td>
             <td valign="top"><a href="constants.php">YDFramework2 constants</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=constants.php">constants.php</a>
@@ -796,6 +796,12 @@
                 <br/>
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=xul.tpl">xul.tpl</a>            </td>
         </tr>
+        <tr>
+            <td valign="top"><a href="akismet.php">Using YDAkismet</a></td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=akismet.php">akismet.php</a>
+            </td>
+        </tr>
         </table>
 
     {/if}



From ximian at mail.berlios.de  Mon Nov 20 20:07:09 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:07:09 +0100
Subject: [ydf-devel] r2224 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200611201907.kAKJ79rH014850@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:06:53 +0100 (Mon, 20 Nov 2006)
New Revision: 2224

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
- YDAjax support for events applyed on responses.. experimental

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-20 19:06:37 UTC (rev 2223)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-20 19:06:53 UTC (rev 2224)
@@ -398,13 +398,18 @@
 			// if previous atribute don't have ';' in the end we should add it
 			if (strlen( $previous ) > 0 && $previous[ strlen( $previous ) - 1 ] != ';' ) $previous .= ';';
 
-			if ( in_array( 'replace', $options ) )
-				return $formElement->setAttribute( $event, $functionName );
+			if ( in_array( 'replace', $options ) ){
+				if ( !$this->onResponse ) return $formElement->setAttribute( $event, $functionName );
+				else                      return $this->addScript( $formElement->setJS( $functionName, $event, $options ) );
+			}
 
-			if ( in_array( 'prepend', $options ) )
-				return $formElement->setAttribute( $event, $functionName . $previous );
+			if ( in_array( 'prepend', $options ) ){
+				if ( !$this->onResponse ) return $formElement->setAttribute( $event, $functionName . $previous );
+				else	  				  return $this->addScript( $formElement->setJS( $functionName . $previous, $event, $options ) );
+			}
 			
-			$formElement->setAttribute( $event, $previous . $functionName );
+			if ( !$this->onResponse ) $formElement->setAttribute( $event, $previous . $functionName );
+			else                      $this->addScript( $formElement->setJS( $previous . $functionName, $event, $options ) );
 		}
 
 



From ximian at mail.berlios.de  Mon Nov 20 20:10:40 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:10:40 +0100
Subject: [ydf-devel] r2225 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200611201910.kAKJAei8015400@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:10:14 +0100 (Mon, 20 Nov 2006)
New Revision: 2225

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
Log:
- initial port of YDCMTree to be a YDDatabaseTree3 extension

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2006-11-20 19:06:53 UTC (rev 2224)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2006-11-20 19:10:14 UTC (rev 2225)
@@ -27,24 +27,18 @@
     }
 
 
-    class YDCMTree extends YDDatabaseObject {
+	// add YD libs
+	YDInclude( 'YDDatabaseTree3.php' );
+
+	// userobject class
+    class YDCMTree extends YDDatabaseTree3 {
     
         function YDCMTree() {
-        
-			// init component as non default
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
 
-			// register table for this component
-            $this->registerTable( 'YDCMTree' );
+			// init parent object
+			$this->YDDatabaseTree3( 'YDCMTree', 'default', 'content_id', 'parent_id', 'lineage', 'level', 'position' );
 
-            // register custom key
-            $this->registerKey( 'content_id', true );
-
-			// register fields	
-			$this->registerField( 'parent_id' );
+			// add custom tree fields
 			$this->registerField( 'type' );
 			$this->registerField( 'state' );
 			$this->registerField( 'reference' );
@@ -54,9 +48,9 @@
 			$this->registerField( 'published_date_end' );			
 			$this->registerField( 'candrag' );
 			$this->registerField( 'candrop' );
-			$this->registerField( 'nleft' );
-			$this->registerField( 'nright' );
 
+			// define tree order
+			$this->order( 'parent_id ASC, position ASC' );
 		}
 
 



From ximian at mail.berlios.de  Mon Nov 20 20:11:58 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:11:58 +0100
Subject: [ydf-devel] r2226 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200611201911.kAKJBwiv015522@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:11:35 +0100 (Mon, 20 Nov 2006)
New Revision: 2226

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
Log:
- initial port of YDCMUserobject to be a YDDatabaseTree3 extension

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-11-20 19:10:14 UTC (rev 2225)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2006-11-20 19:11:35 UTC (rev 2226)
@@ -28,133 +28,27 @@
 
 
 	// add YD libs
-//	YDInclude( 'YDForm.php' );
-	YDInclude( 'YDDatabaseTree2.php' );
-//	YDInclude( 'YDDatabaseObject.php' );
-	// add YDCM libs
-//	YDInclude( 'YDCMPermissions.php' );
+	YDInclude( 'YDDatabaseTree3.php' );
 
-	// add local translation directory
-//	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMUsers/' );
-
-
-    class YDCMUserobject extends YDDatabaseObject {
+	// userobject class
+    class YDCMUserobject extends YDDatabaseTree3 {
     
         function YDCMUserobject() {
-        
-			// init DB object
-            $this->YDDatabaseObject();
 
-			// register database as default
-            $this->registerDatabase();
+			// init parent object
+			$this->YDDatabaseTree3( 'YDCMUserobject', 'default', 'userobject_id', 'parent_id', 'lineage', 'level', 'position' );
 
-			// register table for this component
-            $this->registerTable( 'YDCMUserobject' );
-
-            // register custom key
-            $this->registerKey( 'userobject_id', true );
-
-			// register custom fields
-			$this->registerField( 'parent_id' );
-//			$this->registerField( 'nleft' );
-//			$this->registerField( 'nright' );
-//			$this->registerField( 'nlevel' );
-			$this->registerField( 'lineage' );
-			$this->registerField( 'position' );
-			$this->registerField( 'type' );			
+			// add custom tree fields
+			$this->registerField( 'type' );
 			$this->registerField( 'reference' );			
 			$this->registerField( 'state' );
 
-			// create tree object
-			$this->tree = new YDDatabaseTree2( 'YDCMUserobject', 'default', 'userobject_id', 'parent_id' );
-
-			// add tree fields
-//			$this->tree->addField( 'parent_id' );
-			$this->tree->addField( 'type' );
-			$this->tree->addField( 'reference' );			
-			$this->tree->addField( 'state' );			
+			// define tree order
+			$this->order( 'parent_id ASC, position ASC' );
 		}
 
 
         /**
-         *  This method returns all sub users of a userobject
-         *
-         *  @param  $parent_id      Parent id
-         *  @param  $includeNode    (optional) Includes the node or not. Defaults to true.
-         *
-         *  @returns    Array with user and children nodes
-         */
-		function getTreeElements( $parent_id, $includeNode = true ){
-
-//			return $this->tree->getDescendants( $parent_id, $includeNode );
-			return $this->tree->getTreeElements();
-		}
-
-
-        /**
-         *  This method checks if a userobject is descendant of another
-         *
-         *  @param      $userobject_id User id to test if id descendant
-         *  @param      $parent_id     Parent id
-         *
-         *  @returns    boolean. TRUE if is descendant, FALSE if not descendant
-         */
-		function isDescendantOf( $userobject_id, $parent_id ){
-
-			return $this->tree->isDescendantOf( intval( $userobject_id ), intval( $parent_id ) );
-		}
-
-
-        /**
-         *  This method deletes a userobject (and all children) or just the children
-         *
-         *  @param $userobject_id  Userobject id
-         *  @param $mode           (Optional) 0: delete userobject_id and ALL children
-         *                                    1: delete ALL children of userobject_id only
-         *
-         *  @returns    total of lines affected
-         */
-		function deleteNode( $userobject_id, $mode = 0 ){
-		
-			// delete userobject_id an children
-			if ( $mode == 0 ) return $this->tree->deleteNode( $userobject_id, true );
-
-			// delete userobject_id children
-			return $this->tree->deleteNode( $userobject_id, false );
-		}
-
-
-        /**
-         *  This method adds a userobject
-         *
-         *  @param $values     Array with values
-         *  @param $parent_id  Parent id
-         *
-         *  @returns    node id
-         */
-		function addNode( $values, $parent_id ){
-		
-			// add node
-			return $this->tree->addNode( $values, $parent_id );
-		}
-
-
-        /**
-         *  This method updates a userobject
-         *
-         *  @param $values  Array with values
-         *  @param $id      Userobject id
-         *
-         *  @returns    $values
-         */
-		function updateNode( $values, $id ){
-		
-			// update node
-			return $this->tree->updateNode( $values, $id );
-		}
-
-
-        /**
          *  This method moves all direct children of a node up
          *
          *  @param $userobject_id  Userobject id
@@ -164,7 +58,7 @@
 		function moveChildrenUp( $userobject_id ){
 		
 			// reset possible old stuff
-			$this->resetAll();
+			$this->resetValues();
 
 			// get parent_id of this userobject
 			$this->set( 'userobject_id', intval( $userobject_id ) );
@@ -176,7 +70,7 @@
 			$parent_id = $this->get( 'parent_id ' );
 
 			// reset all previous class values
-			$this->resetAll();
+			$this->resetValues();
 
 			// update all children to new parent_id
 			$this->set( 'parent_id', intval( $parent_id ) );
@@ -188,7 +82,7 @@
 
 
         /**
-         *  This method returns an associative array 
+         *  This method returns an associative array of nodes that belogs to a specific type
          *
          *  @param $type       Node type (or array of types)
          *  @param $attribute  (Optional) Attribute name or (array of attributes) to get only
@@ -197,15 +91,16 @@
          */
 		function getElements( $type, $attributes = array() ){
 
-			$this->resetAll();
+			// reset previous settings
+			$this->resetValues();
 
 			// set user id
-			$this->where( 'type IN ("' . implode( '","', $type ) . '")' );
+			$this->where( 'type IN (' . $this->_db->escapeSqlArray( $type ) . ')' );
 
 			// get all attributes
 			$this->find();
 
-			return $this->getResultsAsAssocArray( 'userobject_id', $attributes );
+			return $this->_getTreeElementsAsAssocArray( $attributes );
 		}
 
 



From ximian at mail.berlios.de  Mon Nov 20 20:13:45 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:13:45 +0100
Subject: [ydf-devel] r2227 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200611201913.kAKJDjxC015679@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:13:13 +0100 (Mon, 20 Nov 2006)
New Revision: 2227

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
Log:
- some cleanups on usermanagement YDCMUser and YDCMTemplates

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-11-20 19:11:35 UTC (rev 2226)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2006-11-20 19:13:13 UTC (rev 2227)
@@ -52,9 +52,12 @@
          *
          *  @returns    Associative array of templates, eg: array( 'Default' => 'Default', 'orange' => ... )
          */
-		function admin_templates(){
+		function getNames( $path = null ){
 		
-			return YDCMTemplates::__getFiles( YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' ) );
+			// if path not set we will search the default admin path
+			if ( is_null( $path ) ) $path = YDConfig::get( 'YDCMTEMPLATES_ADMIN_PATH' );
+		
+			return YDCMTemplates::__getFiles( $path );
 		}
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-20 19:11:35 UTC (rev 2226)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2006-11-20 19:13:13 UTC (rev 2227)
@@ -154,19 +154,18 @@
          *  This method deletes a user (and all children) or just the children
          *
          *  @param $userobject_id  Userobject id
-         *  @param $mode           (Optional) 0: delete user_id and ALL children
-         *                                    1: delete ALL children of user_id only
+         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
          *
          *  @returns    YDResult object. OK      - user deleted
 		 *                               WARNING - no deletes where made
          */
-		function deleteUser( $user_id, $mode = 0 ){
+		function deleteUser( $user_id, $deleteAll ){
 		
 			$obj = new YDCMUserobject();
 			
 			// delete user and get result
-			if ( $obj->deleteNode( $user_id, $mode ) ) return YDResult::ok( t('ydcmuser mess delete ok') );
-			else                                       return YDResult::fatal( t('ydcmuser mess delete empty') );
+			if ( $obj->deleteNode( $user_id, $deleteAll ) ) return YDResult::ok( t('ydcmuser mess delete ok') );
+			else                                            return YDResult::fatal( t('ydcmuser mess delete empty') );
 		}
 
 
@@ -262,18 +261,18 @@
 				$languages = $languages->active();
 				$this->_form->addElement( 'select',    'lang_id',       t( 'ydcmuser label language' ), array(), $languages );
 
-				$templates = new YDCMTemplates();
+				$templates = YDCMTemplates::getNames();
 
 				// get url to templates and set shot.png as filename
 				$attributes = array( 'border' => 1, 'src' => YDConfig::get( 'YDCMTEMPLATES_ADMIN_URL' ), 'ext' => 	YDConfig::get( 'YDCMTEMPLATES_ADMIN_EXT' ) );
 
-    	        $this->_form->addElement( 'selectimage',    'template', t( 'ydcmuser label template' ), $attributes, $templates->admin_templates() );
+    	        $this->_form->addElement( 'selectimage',    'template', t( 'ydcmuser label template' ), $attributes, $templates );
 
 				$this->_form->addRule( 'name',        'maxlength',      t( 'ydcmuser mess name too big' ),  255 );
 				$this->_form->addRule( 'email',       'email',          t( 'ydcmuser mess email not valid' ) );
 				$this->_form->addRule( 'other',       'maxlength',      t( 'ydcmuser mess other too big' ), 5000 );
 				$this->_form->addRule( 'language_id', 'in_array',       t( 'ydcmuser mess language not valid' ), array_keys( $languages ) );
-				$this->_form->addRule( 'template',    'in_array',       t( 'ydcmuser mess template not valid' ), array_keys( $templates->admin_templates() ) );
+				$this->_form->addRule( 'template',    'in_array',       t( 'ydcmuser mess template not valid' ), array_keys( $templates ) );
 			}
 
 			// add access information when editing
@@ -454,7 +453,7 @@
 				$user[ 'login_current' ] = YDStringUtil::formatDate( 0, 'datetimesql' );
 
 				// reset object
-				$this->resetAll();
+				$this->resetValues();
 
 				$this->setValues( $user );
 



From ximian at mail.berlios.de  Mon Nov 20 20:15:10 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:15:10 +0100
Subject: [ydf-devel] r2228 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages
Message-ID: <200611201915.kAKJFADq015844@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:14:51 +0100 (Mon, 20 Nov 2006)
New Revision: 2228

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
Log:
- added new english translation words

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-11-20 19:13:13 UTC (rev 2227)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/languages/en.php	2006-11-20 19:14:51 UTC (rev 2228)
@@ -19,6 +19,7 @@
 $GLOBALS['t']['schedule'] = 'Schedule';
 $GLOBALS['t']['permissions'] = 'Permissions';
 $GLOBALS['t']['delete'] = 'Delete';
+$GLOBALS['t']['default'] = 'Default';
 $GLOBALS['t']['toggle state'] = 'Toggle state';
 $GLOBALS['t']['public'] = 'Public';
 $GLOBALS['t']['private'] = 'Private';
@@ -35,7 +36,26 @@
 $GLOBALS['t']['edit'] = 'Edit';
 $GLOBALS['t']['properties'] = 'Properties';
 $GLOBALS['t']['please wait'] = 'Please wait';
+$GLOBALS['t']['online'] = 'Online';
+$GLOBALS['t']['offline'] = 'Offline';
+$GLOBALS['t']['offline message'] = 'Offline message';
+$GLOBALS['t']['gmt'] = 'GMT';
+$GLOBALS['t']['portal name'] = 'Portal name';
 
+// email parameters
+$GLOBALS['t']['email configuration'] = 'Email configuration';
+$GLOBALS['t']['email sender'] = 'Sender';
+$GLOBALS['t']['email host'] = 'Hostname';
+$GLOBALS['t']['email username'] = 'Username';
+$GLOBALS['t']['email password'] = 'Password';
+$GLOBALS['t']['email priority'] = 'Priority';
+$GLOBALS['t']['email helo'] = 'Helo';
+
+// languages
+$GLOBALS['t']['languages portal'] = 'Portal languages';
+$GLOBALS['t']['languages admin'] = 'Administration languages';
+
+
 $GLOBALS['t']['visitor'] = 'Visitor';
 $GLOBALS['t']['visitors'] = 'Visitors';
 $GLOBALS['t']['administrator'] = 'Administrator';



From ximian at mail.berlios.de  Mon Nov 20 20:17:35 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 20 Nov 2006 20:17:35 +0100
Subject: [ydf-devel] r2229 - YDFramework2.0/trunk/examples/cm
Message-ID: <200611201917.kAKJHZf7016097@sheep.berlios.de>

Author: ximian
Date: 2006-11-20 20:17:20 +0100 (Mon, 20 Nov 2006)
New Revision: 2229

Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
   YDFramework2.0/trunk/examples/cm/cm.sql
Log:
- update YDCM db scheme and sql export

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-11-20 19:14:51 UTC (rev 2228)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-11-20 19:17:20 UTC (rev 2229)
@@ -1,7 +1,7 @@
 <?xml version="1.0" standalone="yes" ?>
 <DBMODEL Version="4.0">
 <SETTINGS>
-<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="134" YPos="0" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="xpto" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
+<GLOBALSETTINGS ModelName="YDCM scheme" IDModel="0" IDVersion="0" VersionStr="1.0.0.0" Comments="" UseVersionHistroy="1" AutoIncVersion="1" DatabaseType="MySQL" ZoomFac="74.00" XPos="21" YPos="57" DefaultDataType="5" DefaultTablePrefix="0" DefSaveDBConn="" DefSyncDBConn="xpto" DefQueryDBConn="" Printer="" HPageCount="4.0" PageAspectRatio="1.440892512336408" PageOrientation="1" PageFormat="A4 (210x297 mm, 8.26x11.7 inches)" SelectedPages="" UsePositionGrid="1" PositionGridX="20" PositionGridY="20" TableNameInRefs="0" DefaultTableType="0" ActivateRefDefForNewRelations="1" FKPrefix="" FKPostfix="" CreateFKRefDefIndex="0" DBQuoteCharacter="`" CreateSQLforLinkedObjects="0" DefModelFont="Tahoma" CanvasWidth="4096" CanvasHeight="2842" />
 <DATATYPEGROUPS>
 <DATATYPEGROUP Name="Numeric Types" Icon="1" />
 <DATATYPEGROUP Name="Date and Time Types" Icon="2" />
@@ -258,13 +258,13 @@
 </SETTINGS>
 <METADATA>
 <REGIONS>
+<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
+<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
+<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="580" Height="220" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
+<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
+<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
+<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
 <REGION ID="1621" RegionName="MASTER COMPONENT ( content management )" XPos="140" YPos="120" Width="620" Height="720" RegionColor="3" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1620" RegionName="Link component ( YDCMLink )" XPos="1460" YPos="440" Width="260" Height="140" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="50" />
-<REGION ID="1619" RegionName="Page component ( YDCMPage )" XPos="1460" YPos="120" Width="260" Height="260" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="49" />
-<REGION ID="1615" RegionName="Helpdesk component ( YDCMHelpdesk )" XPos="1460" YPos="940" Width="520" Height="380" RegionColor="5" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" />
-<REGION ID="1613" RegionName="Guestbook component ( YDCMGuestbook )" XPos="1460" YPos="640" Width="260" Height="240" RegionColor="1" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="45" />
-<REGION ID="1635" RegionName="Portal Statistics ( YDCMStatistics )" XPos="660" YPos="880" Width="280" Height="220" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="51" />
-<REGION ID="1789" RegionName="MASTER COMPONENT ( user management )" XPos="760" YPos="120" Width="580" Height="720" RegionColor="2" TablePrefix="0" TableType="0" OverwriteTablePrefix="0" OverwriteTableType="0" Comments="" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
 </REGIONS>
 <TABLES>
 <TABLE ID="1160" Tablename="YDCMPage" PrevTableName="component_page" XPos="1480" YPos="160" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (1,1,\aApache html all lang\a,\aApache xhtml all lang\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (2,1,\aPostgreSQL en html\a,\aPostgreSQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (3,1,\aPostgreSQL pt html\a,\aPostgreSQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (4!
 ,1,\amySQL en html\a,\amySQL en xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (5,1,\amySQL pt html\a,\amySQL pt xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (6,1,\aDatabases html\a,\aDatabases xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (7,1,\aBases de dados html\a,\aBases de dados xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (8,1,\aGenerators html\a,\aGenerators xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`templat!
 e_pack`,`template`,`metatags`,`description`,`keywords`) VALUES!
  (9,1,\a
Geradores html\a,\aGeradores xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (10,1,\aPortals html\a,\aPortals xhtml\a,0,\a\a,0,\a\a,\a\a);\nINSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,\aPortais html\a,\aPortais xhtml\a,0,\a\a,0,\a\a,\a\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="4" >
@@ -319,7 +319,7 @@
 <RELATION_END ID="1704" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,1,1,22,1,1,\aYDCMRoot\a,\a\a,7,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,\aYDCMRootmenu\a,\amenu Code Paste\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag!
 `,`candrop`) VALUES (3,1,4,5,2,1,\aYDCMRootmenu\a,\amenu Documentation\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,\aYDCMRootmenu\a,\amenu Books\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,\aYDCMPage\a,\aApache\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,\aYDCMPage\!
 a,\aPostegreSQL\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 0!
 0:00:00\
a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,\aYDCMPage\a,\amysql\a,0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,\aYDCMRootmenu\a,\alinks\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,\aYDCMPage\a,\adatabases\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`n!
 left`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,\aYDCMPage\a,\agenerators\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,\aYDCMPage\a,\aportals\a,1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
+<TABLE ID="1162" Tablename="YDCMTree" PrevTableName="content" XPos="160" YPos="180" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmtree` VALUES (  1,null,   \a\a,              0, 1, \aYDCMRoot\a,         \a\a,                               1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,0,0);\nINSERT INTO `ydcmtree` VALUES (  2,    1,  \a//\a,            1, 2, \aYDCMRootmenu\a, \amenu Code Paste\a,      1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  3,    1,  \a//\a,            1, 3, \aYDCMRootmenu\a, \amenu Documentation\a, 1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  4,    1,  \a//\a,            1, 4, \aYDCMRootmenu\a, \amenu Books\a,              1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  5,    4,  \a//4/\a,         2, 1, \aYDCMPage\a,         \aApache\a, !
                     1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  6,    4,  \a//4/\a,         2, 2, \aYDCMPage\a,         \aPostegreSQL\a,             1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  7,    4,  \a//4/\a,         2, 3, \aYDCMPage\a,         \amysql\a,                       0,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  8,    1,  \a//\a,            1, 5, \aYDCMRootmenu\a,  \alinks\a,                        1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  9,    8,  \a//1/8/\a,      3, 1, \aYDCMPage\a,          \adatabases\a,                1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSERT INTO `ydcmtree` VALUES (  10,  8,  \a//1/8/\a,      3, 2, \aYDCMPage\a,          \agenerators\a,               1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\nINSE!
 RT INTO `ydcmtree` VALUES (  11, 10, \a//1/8/10/\a,  4, 1, \aY!
 DCMPage\
a,          \aportals\a,                    1,1,1,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,1,1);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="6" >
 <COLUMNS>
 <COLUMN ID="1191" ColName="content_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="(10)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="Autoincrement id">
 <OPTIONSELECTED>
@@ -327,25 +327,18 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1799" ColName="parent_id" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1799" ColName="parent_id" PrevColName="" Pos="14" idDatatype="5" DatatypeParams="(10)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
 <OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1418" ColName="nleft" PrevColName="" Pos="18" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
-<OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1419" ColName="nright" PrevColName="" Pos="19" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
+<COLUMN ID="1419" ColName="lineage" PrevColName="nright" Pos="19" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="\a//\a" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
-<OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1420" ColName="nlevel" PrevColName="" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
+<COLUMN ID="1420" ColName="level" PrevColName="nlevel" Pos="20" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="0" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="0" />
 <OPTIONSELECT Value="0" />
@@ -409,7 +402,11 @@
 <RELATIONS_START>
 <RELATION_START ID="1437" />
 <RELATION_START ID="1692" />
+<RELATION_START ID="2036" />
 </RELATIONS_START>
+<RELATIONS_END>
+<RELATION_END ID="2036" />
+</RELATIONS_END>
 <INDICES>
 <INDEX ID="1210" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
 <INDEXCOLUMNS>
@@ -442,7 +439,7 @@
 <RELATION_END ID="1706" />
 </RELATIONS_END>
 </TABLE>
-<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="520" YPos="540" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
+<TABLE ID="1165" Tablename="YDCMLanguages" PrevTableName="languages" XPos="780" YPos="520" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\aen\a,\aEnglish\a,1,1,1);\nINSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES (\apt\a,\aPortugu\234s\a,1,0,0);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="9" >
 <COLUMNS>
 <COLUMN ID="1219" ColName="language_id" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="0" Prec="0" PrimaryKey="1" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="language code">
 <OPTIONSELECTED>
@@ -755,9 +752,9 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1537" Tablename="YDCMGuestbook_posts" PrevTableName="Table_23" XPos="1480" YPos="680" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
+<TABLE ID="1537" Tablename="YDCMGuestbook" PrevTableName="Table_23" XPos="1480" YPos="680" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="37" >
 <COLUMNS>
-<COLUMN ID="1539" ColName="post_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<COLUMN ID="1539" ColName="guestbook_id" PrevColName="post_id" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
 <OPTIONSELECT Value="1" />
 <OPTIONSELECT Value="0" />
@@ -769,41 +766,14 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1542" ColName="date" PrevColName="" Pos="2" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="post date">
+<COLUMN ID="1542" ColName="guestbook_datecreation" PrevColName="date" Pos="2" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="post date">
 <OPTIONSELECTED>
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1543" ColName="name" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster username">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1544" ColName="email" PrevColName="" Pos="4" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="poster email">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1545" ColName="message" PrevColName="" Pos="5" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1546" ColName="active" PrevColName="" Pos="6" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="post is active and can be seen after creation. 1 yes, 0 no">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1663" ColName="website" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1664" ColName="ip" PrevColName="" Pos="8" idDatatype="20" DatatypeParams="(15)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
 </COLUMNS>
+<RELATIONS_START>
+<RELATION_START ID="2019" />
+</RELATIONS_START>
 <RELATIONS_END>
 <RELATION_END ID="1709" />
 </RELATIONS_END>
@@ -841,7 +811,7 @@
 </INDEX>
 </INDICES>
 </TABLE>
-<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` VALUES (1,5,\aen\a,\aApache friends\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (2,6,\aen\a,\aPostGre en\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (3,6,\apt\a,\aPostGre pt\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (4,7,\aen\a,\amySql howto\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (5,7,\apt\a,\aajuda mySql\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (6,9,\aen\a,\aDatabases we use\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (7,9,\apt\a,\aBases de dados\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (8,10,\aen\a,\aGenerators help\a,1,\a2000-01-01 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (9,10,\apt\a,\aAjuda sobre geradores\a,1,\a2002-02-02 00:00:00\a);\!
 nINSERT INTO `ydcmcomp` VALUES (10,11,\aen\a,\aPortals\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (11,11,\apt\a,\aPortais\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (12,8,\aen\a,\aMenu Links\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (13,8,\apt\a,\aO meu menu de atalhos\a,1,\a0000-00-00 00:00:00\a);\nINSERT INTO `ydcmcomp` VALUES (14,10,\aen\a,\aGener\a,0,\a3002-02-02 00:00:00\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
+<TABLE ID="1678" Tablename="YDCMComp" PrevTableName="Table_17" XPos="160" YPos="520" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="INSERT INTO `ydcmcomp` VALUES (1,     5,\aen\a,\aApache friends\a);\nINSERT INTO `ydcmcomp` VALUES (2,     6,\aen\a,\aPostGre en\a);\nINSERT INTO `ydcmcomp` VALUES (3,     6,\apt\a,\aPostGre pt\a);\nINSERT INTO `ydcmcomp` VALUES (4,     7,\aen\a,\amySql howto\a);\nINSERT INTO `ydcmcomp` VALUES (5,     7,\apt\a,\aajuda mySql\a);\nINSERT INTO `ydcmcomp` VALUES (6,     9,\aen\a,\aDatabases we use\a);\nINSERT INTO `ydcmcomp` VALUES (7,     9,\apt\a,\aBases de dados\a);\nINSERT INTO `ydcmcomp` VALUES (8,   10,\aen\a,\aGenerators help\a);\nINSERT INTO `ydcmcomp` VALUES (9,   10,\apt\a,\aAjuda sobre geradores\a);\nINSERT INTO `ydcmcomp` VALUES (10, 11,\aen\a,\aPortals\a);\nINSERT INTO `ydcmcomp` VALUES (11, 11,\apt\a,\aPortais\a);\nINSERT INTO `ydcmcomp` VALUES (12,  8,\aen\a,\aMenu Links\a);\nINSERT IN!
 TO `ydcmcomp` VALUES (13,  8,\apt\a,\aO meu menu de atalhos\a);\nINSERT INTO `ydcmcomp` VALUES (14, 10,\aen\a,\aGener\a);\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="46" >
 <COLUMNS>
 <COLUMN ID="1680" ColName="component_id" PrevColName="" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
 <OPTIONSELECTED>
@@ -865,16 +835,6 @@
 <OPTIONSELECT Value="0" />
 </OPTIONSELECTED>
 </COLUMN>
-<COLUMN ID="1683" ColName="version_default" PrevColName="" Pos="2" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="1" Comments="This is the default version">
-<OPTIONSELECTED>
-<OPTIONSELECT Value="1" />
-<OPTIONSELECT Value="0" />
-</OPTIONSELECTED>
-</COLUMN>
-<COLUMN ID="1737" ColName="version_date" PrevColName="" Pos="5" idDatatype="15" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="Version created in this date">
-<OPTIONSELECTED>
-</OPTIONSELECTED>
-</COLUMN>
 </COLUMNS>
 <RELATIONS_START>
 <RELATION_START ID="1704" />
@@ -1010,6 +970,62 @@
 <RELATION_END ID="1877" />
 </RELATIONS_END>
 </TABLE>
+<TABLE ID="2014" Tablename="YDCMGuestbook_posts" PrevTableName="Table_16" XPos="1820" YPos="680" TableType="1" TablePrefix="0" nmTable="0" Temporary="0" UseStandardInserts="0" StandardInserts="\n" TableOptions="DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n" Comments="" Collapsed="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="40" >
+<COLUMNS>
+<COLUMN ID="2017" ColName="post_id" PrevColName="idYDCMGuestbook_posts" Pos="0" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="1" NotNull="1" AutoInc="1" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2020" ColName="guestbook_id" PrevColName="" Pos="1" idDatatype="5" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="1" AutoInc="0" IsForeignKey="1" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2023" ColName="post_name" PrevColName="" Pos="2" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2024" ColName="post_email" PrevColName="" Pos="3" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2025" ColName="post_message" PrevColName="" Pos="4" idDatatype="28" DatatypeParams="" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2026" ColName="post_active" PrevColName="" Pos="5" idDatatype="1" DatatypeParams="(1)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="1" />
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2027" ColName="post_website" PrevColName="" Pos="6" idDatatype="20" DatatypeParams="(255)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+<COLUMN ID="2028" ColName="ip" PrevColName="" Pos="7" idDatatype="20" DatatypeParams="(5)" Width="-1" Prec="-1" PrimaryKey="0" NotNull="0" AutoInc="0" IsForeignKey="0" DefaultValue="" Comments="">
+<OPTIONSELECTED>
+<OPTIONSELECT Value="0" />
+</OPTIONSELECTED>
+</COLUMN>
+</COLUMNS>
+<RELATIONS_END>
+<RELATION_END ID="2019" />
+</RELATIONS_END>
+<INDICES>
+<INDEX ID="2018" IndexName="PRIMARY" IndexKind="0" FKRefDef_Obj_id="-1">
+<INDEXCOLUMNS>
+<INDEXCOLUMN idColumn="2017" LengthParam="0" />
+</INDEXCOLUMNS>
+</INDEX>
+</INDICES>
+</TABLE>
 </TABLES>
 <RELATIONS>
 <RELATION ID="1383" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1367" FKFields="userobject_id=userobject_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="4" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="8" StartIntervalOffsetY="-23" EndIntervalOffsetX="5" EndIntervalOffsetY="-4" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="1" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="21" />
@@ -1028,6 +1044,8 @@
 <RELATION ID="1984" RelationName="userobject_id" Kind="2" SrcTable="1168" DestTable="1771" FKFields="userobject_id=permission_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
 <RELATION ID="1989" RelationName="userobject_id" Kind="5" SrcTable="1168" DestTable="1800" FKFields="userobject_id=group_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="38" />
 <RELATION ID="2009" RelationName="parent_id" Kind="5" SrcTable="1168" DestTable="1168" FKFields="userobject_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="-5" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="39" />
+<RELATION ID="2019" RelationName="guestbook_id" Kind="2" SrcTable="1537" DestTable="2014" FKFields="guestbook_id=guestbook_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=3\nOnUpdate=3\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="41" />
+<RELATION ID="2036" RelationName="parent_id" Kind="5" SrcTable="1162" DestTable="1162" FKFields="content_id=parent_id\n" FKFieldsComments="\n" relDirection="2" MidOffset="0" OptionalStart="0" OptionalEnd="0" CaptionOffsetX="0" CaptionOffsetY="0" StartIntervalOffsetX="0" StartIntervalOffsetY="0" EndIntervalOffsetX="0" EndIntervalOffsetY="0" CreateRefDef="1" Invisible="0" RefDef="Matching=0\nOnDelete=1\nOnUpdate=1\n" Comments="" FKRefDefIndex_Obj_id="-1" Splitted="0" IsLinkedObject="0" IDLinkedModel="-1" Obj_id_Linked="-1" OrderPos="42" />
 </RELATIONS>
 <NOTES>
 </NOTES>

Modified: YDFramework2.0/trunk/examples/cm/cm.sql
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.sql	2006-11-20 19:14:51 UTC (rev 2228)
+++ YDFramework2.0/trunk/examples/cm/cm.sql	2006-11-20 19:17:20 UTC (rev 2229)
@@ -1,3 +1,11 @@
+CREATE TABLE YDCMStatistics_downloads (
+  download_is INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  date DATETIME NULL,
+  filename VARCHAR(255) NULL,
+  PRIMARY KEY(download_is)
+)
+TYPE=InnoDB;
+
 CREATE TABLE YDCMLanguages (
   language_id VARCHAR(255) NOT NULL,
   name VARCHAR(50) NOT NULL,
@@ -12,47 +20,6 @@
 INSERT INTO `ydcmlanguages` (`language_id`,`name`,`active`,`visitors_default`,`admin_default`) VALUES ('pt','Portugu?s',1,0,0);
 
 
-CREATE TABLE YDCMTree (
-  content_id INTEGER(10) NOT NULL AUTO_INCREMENT,
-  parent_id INTEGER UNSIGNED NULL,
-  nleft INTEGER NOT NULL DEFAULT 0,
-  nright INTEGER NOT NULL DEFAULT 0,
-  nlevel INTEGER NOT NULL DEFAULT 0,
-  position INTEGER(10) NULL DEFAULT 1,
-  type VARCHAR(20) NOT NULL,
-  reference VARCHAR(100) NOT NULL,
-  state TINYINT(1) NOT NULL,
-  access TINYINT(2) NOT NULL DEFAULT 1,
-  searcheable TINYINT(1) NOT NULL,
-  published_date_start DATETIME NOT NULL,
-  published_date_end DATETIME NOT NULL,
-  candrag TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
-  candrop TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
-  PRIMARY KEY(content_id)
-)
-TYPE=InnoDB;
-
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (1,1,1,22,1,1,'YDCMRoot','',7,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (2,1,2,3,2,1,'YDCMRootmenu','menu Code Paste',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (3,1,4,5,2,1,'YDCMRootmenu','menu Documentation',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (4,1,6,13,2,1,'YDCMRootmenu','menu Books',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (5,4,7,8,3,1,'YDCMPage','Apache',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (6,4,9,10,3,1,'YDCMPage','PostegreSQL',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (7,4,11,12,3,1,'YDCMPage','mysql',0,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (8,1,14,21,2,1,'YDCMRootmenu','links',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (9,8,15,16,3,1,'YDCMPage','databases',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (10,8,17,18,3,1,'YDCMPage','generators',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-INSERT INTO `ydcmtree` (`content_id`,`parent_id`,`nleft`,`nright`,`nlevel`,`position`,`type`,`reference`,`state`,`access`,`searcheable`,`published_date_start`,`published_date_end`,`candrag`,`candrop`) VALUES (11,8,19,20,3,1,'YDCMPage','portals',1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
-
-
-CREATE TABLE YDCMStatistics_downloads (
-  download_is INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  date DATETIME NULL,
-  filename VARCHAR(255) NULL,
-  PRIMARY KEY(download_is)
-)
-TYPE=InnoDB;
-
 CREATE TABLE YDCMStatistics_searches (
   search_id INTEGER(10) NOT NULL AUTO_INCREMENT,
   date DATETIME NOT NULL,
@@ -92,6 +59,42 @@
 INSERT INTO `ydcmuserobject` VALUES (12,   4,  '//2/4/',    3, 3, 'YDCMGroup',   'extra',1);
 
 
+CREATE TABLE YDCMTree (
+  content_id INTEGER(10) NOT NULL AUTO_INCREMENT,
+  parent_id INTEGER(10) NULL,
+  lineage VARCHAR(255) NOT NULL DEFAULT '//',
+  level INTEGER NOT NULL DEFAULT 0,
+  position INTEGER(10) NULL DEFAULT 1,
+  type VARCHAR(20) NOT NULL,
+  reference VARCHAR(100) NOT NULL,
+  state TINYINT(1) NOT NULL,
+  access TINYINT(2) NOT NULL DEFAULT 1,
+  searcheable TINYINT(1) NOT NULL,
+  published_date_start DATETIME NOT NULL,
+  published_date_end DATETIME NOT NULL,
+  candrag TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
+  candrop TINYINT(1) UNSIGNED NOT NULL DEFAULT 0,
+  PRIMARY KEY(content_id),
+  FOREIGN KEY(parent_id)
+    REFERENCES YDCMTree(content_id)
+      ON DELETE CASCADE
+      ON UPDATE CASCADE
+)
+TYPE=InnoDB;
+
+INSERT INTO `ydcmtree` VALUES (  1,null,   '',              0, 1, 'YDCMRoot',         '',                               1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',0,0);
+INSERT INTO `ydcmtree` VALUES (  2,    1,  '//',            1, 2, 'YDCMRootmenu', 'menu Code Paste',      1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  3,    1,  '//',            1, 3, 'YDCMRootmenu', 'menu Documentation', 1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  4,    1,  '//',            1, 4, 'YDCMRootmenu', 'menu Books',              1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  5,    4,  '//4/',         2, 1, 'YDCMPage',         'Apache',                     1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  6,    4,  '//4/',         2, 2, 'YDCMPage',         'PostegreSQL',             1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  7,    4,  '//4/',         2, 3, 'YDCMPage',         'mysql',                       0,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  8,    1,  '//',            1, 5, 'YDCMRootmenu',  'links',                        1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  9,    8,  '//1/8/',      3, 1, 'YDCMPage',          'databases',                1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  10,  8,  '//1/8/',      3, 2, 'YDCMPage',          'generators',               1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+INSERT INTO `ydcmtree` VALUES (  11, 10, '//1/8/10/',  4, 1, 'YDCMPage',          'portals',                    1,1,1,'0000-00-00 00:00:00','0000-00-00 00:00:00',1,1);
+
+
 CREATE TABLE YDCMPermission (
   permission_id INTEGER(10) NOT NULL,
   class VARCHAR(255) NOT NULL,
@@ -166,8 +169,6 @@
   content_id INTEGER(10) NOT NULL,
   language_id VARCHAR(255) NULL,
   title VARCHAR(255) NULL,
-  version_default TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
-  version_date DATETIME NOT NULL,
   PRIMARY KEY(component_id),
   FOREIGN KEY(content_id)
     REFERENCES YDCMTree(content_id)
@@ -180,20 +181,20 @@
 )
 TYPE=InnoDB;
 
-INSERT INTO `ydcmcomp` VALUES (1,5,'en','Apache friends',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (2,6,'en','PostGre en',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (3,6,'pt','PostGre pt',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (4,7,'en','mySql howto',1,'2000-01-01 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (5,7,'pt','ajuda mySql',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (6,9,'en','Databases we use',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (7,9,'pt','Bases de dados',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (8,10,'en','Generators help',1,'2000-01-01 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (9,10,'pt','Ajuda sobre geradores',1,'2002-02-02 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (10,11,'en','Portals',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (11,11,'pt','Portais',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (12,8,'en','Menu Links',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (13,8,'pt','O meu menu de atalhos',1,'0000-00-00 00:00:00');
-INSERT INTO `ydcmcomp` VALUES (14,10,'en','Gener',0,'3002-02-02 00:00:00');
+INSERT INTO `ydcmcomp` VALUES (1,     5,'en','Apache friends');
+INSERT INTO `ydcmcomp` VALUES (2,     6,'en','PostGre en');
+INSERT INTO `ydcmcomp` VALUES (3,     6,'pt','PostGre pt');
+INSERT INTO `ydcmcomp` VALUES (4,     7,'en','mySql howto');
+INSERT INTO `ydcmcomp` VALUES (5,     7,'pt','ajuda mySql');
+INSERT INTO `ydcmcomp` VALUES (6,     9,'en','Databases we use');
+INSERT INTO `ydcmcomp` VALUES (7,     9,'pt','Bases de dados');
+INSERT INTO `ydcmcomp` VALUES (8,   10,'en','Generators help');
+INSERT INTO `ydcmcomp` VALUES (9,   10,'pt','Ajuda sobre geradores');
+INSERT INTO `ydcmcomp` VALUES (10, 11,'en','Portals');
+INSERT INTO `ydcmcomp` VALUES (11, 11,'pt','Portais');
+INSERT INTO `ydcmcomp` VALUES (12,  8,'en','Menu Links');
+INSERT INTO `ydcmcomp` VALUES (13,  8,'pt','O meu menu de atalhos');
+INSERT INTO `ydcmcomp` VALUES (14, 10,'en','Gener');
 
 
 CREATE TABLE YDCMLocks (
@@ -213,6 +214,59 @@
 )
 TYPE=InnoDB;
 
+CREATE TABLE YDCMHelpdesk_posts (
+  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  userobject_id INTEGER(10) NOT NULL,
+  component_id INTEGER UNSIGNED NOT NULL,
+  state_id VARCHAR(255) NULL,
+  urgency_id VARCHAR(255) NULL,
+  subject TEXT NULL,
+  text TEXT NULL,
+  creation_date DATETIME NOT NULL,
+  reportedby_user TINYINT(1) UNSIGNED NULL,
+  reportedby_local VARCHAR(255) NULL,
+  reportedby_date DATETIME NOT NULL,
+  reportedby_type VARCHAR(255) NULL,
+  assignedto_user TINYINT(1) UNSIGNED NULL,
+  assignedto_local VARCHAR(255) NULL,
+  assignedto_date DATETIME NOT NULL,
+  assignedto_type VARCHAR(255) NULL,
+  PRIMARY KEY(post_id),
+  FOREIGN KEY(userobject_id)
+    REFERENCES YDCMUserobject(userobject_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(component_id)
+    REFERENCES YDCMComp(component_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+)
+TYPE=InnoDB;
+
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',4,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',4,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
+
+
+CREATE TABLE YDCMHelpdesk_response (
+  response_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  userobject_id INTEGER(10) NOT NULL,
+  post_id INTEGER UNSIGNED NOT NULL,
+  date DATETIME NULL,
+  description TEXT NULL,
+  PRIMARY KEY(response_id),
+  FOREIGN KEY(post_id)
+    REFERENCES YDCMHelpdesk_posts(post_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION,
+  FOREIGN KEY(userobject_id)
+    REFERENCES YDCMUserobject(userobject_id)
+      ON DELETE NO ACTION
+      ON UPDATE NO ACTION
+)
+TYPE=InnoDB;
+
 CREATE TABLE YDCMPage (
   component_id INTEGER UNSIGNED NOT NULL,
   current_version TINYINT(1) NULL,
@@ -243,24 +297,6 @@
 INSERT INTO `ydcmpage` (`component_id`,`current_version`,`html`,`xhtml`,`template_pack`,`template`,`metatags`,`description`,`keywords`) VALUES (11,1,'Portais html','Portais xhtml',0,'',0,'','');
 
 
-CREATE TABLE YDCMGuestbook_posts (
-  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  component_id INTEGER UNSIGNED NOT NULL,
-  date DATETIME NOT NULL,
-  name VARCHAR(255) NOT NULL,
-  email VARCHAR(255) NULL,
-  message TEXT NOT NULL,
-  active TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
-  website VARCHAR(255) NULL,
-  ip VARCHAR(15) NULL,
-  PRIMARY KEY(post_id),
-  FOREIGN KEY(component_id)
-    REFERENCES YDCMComp(component_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION
-)
-TYPE=InnoDB;
-
 CREATE TABLE YDCMLink (
   component_id INTEGER UNSIGNED NOT NULL,
   url VARCHAR(255) NOT NULL,
@@ -272,28 +308,11 @@
 )
 TYPE=InnoDB;
 
-CREATE TABLE YDCMHelpdesk_posts (
-  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  userobject_id INTEGER(10) NOT NULL,
+CREATE TABLE YDCMGuestbook (
+  guestbook_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
   component_id INTEGER UNSIGNED NOT NULL,
-  state_id VARCHAR(255) NULL,
-  urgency_id VARCHAR(255) NULL,
-  subject TEXT NULL,
-  text TEXT NULL,
-  creation_date DATETIME NOT NULL,
-  reportedby_user TINYINT(1) UNSIGNED NULL,
-  reportedby_local VARCHAR(255) NULL,
-  reportedby_date DATETIME NOT NULL,
-  reportedby_type VARCHAR(255) NULL,
-  assignedto_user TINYINT(1) UNSIGNED NULL,
-  assignedto_local VARCHAR(255) NULL,
-  assignedto_date DATETIME NOT NULL,
-  assignedto_type VARCHAR(255) NULL,
-  PRIMARY KEY(post_id),
-  FOREIGN KEY(userobject_id)
-    REFERENCES YDCMUserobject(userobject_id)
-      ON DELETE NO ACTION
-      ON UPDATE NO ACTION,
+  guestbook_datecreation DATETIME NOT NULL,
+  PRIMARY KEY(guestbook_id),
   FOREIGN KEY(component_id)
     REFERENCES YDCMComp(component_id)
       ON DELETE NO ACTION
@@ -301,26 +320,19 @@
 )
 TYPE=InnoDB;
 
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (1,1,'1','1',4,'','','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (2,1,'1','1',4,'sub','text','2006-07-05 15:50:33',NULL,NULL,'0000-00-00 00:00:00',NULL,0,'ass local','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (3,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
-INSERT INTO `ydcmhelpdesk_posts` (`post_id`,`component_id`,`state_id`,`urgency_id`,`userobject_id`,`subject`,`text`,`creation_date`,`reportedby_user`,`reportedby_local`,`reportedby_date`,`reportedby_type`,`assignedto_user`,`assignedto_local`,`assignedto_date`,`assignedto_type`) VALUES (4,1,'1','1',4,'sub','text','2006-07-05 15:50:33',0,'rep local','2006-07-05 15:50:33','0',0,'ass local','2006-07-05 15:50:33','0');
-
-
-CREATE TABLE YDCMHelpdesk_response (
-  response_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
-  userobject_id INTEGER(10) NOT NULL,
-  post_id INTEGER UNSIGNED NOT NULL,
-  date DATETIME NULL,
-  description TEXT NULL,
-  PRIMARY KEY(response_id),
-  FOREIGN KEY(post_id)
-    REFERENCES YDCMHelpdesk_posts(post_id)
+CREATE TABLE YDCMGuestbook_posts (
+  post_id INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
+  guestbook_id INTEGER UNSIGNED NOT NULL,
+  post_name VARCHAR(255) NULL,
+  post_email VARCHAR(255) NULL,
+  post_message TEXT NULL,
+  post_active TINYINT(1) UNSIGNED NULL,
+  post_website VARCHAR(255) NULL,
+  ip VARCHAR(5) NULL,
+  PRIMARY KEY(post_id),
+  FOREIGN KEY(guestbook_id)
+    REFERENCES YDCMGuestbook(guestbook_id)
       ON DELETE NO ACTION
-      ON UPDATE NO ACTION,
-  FOREIGN KEY(userobject_id)
-    REFERENCES YDCMUserobject(userobject_id)
-      ON DELETE NO ACTION
       ON UPDATE NO ACTION
 )
 TYPE=InnoDB;



From pclaerhout at mail.berlios.de  Mon Nov 20 20:25:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Nov 2006 20:25:23 +0100
Subject: [ydf-devel] r2230 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200611201925.kAKJPNw0016817@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-20 20:25:23 +0100 (Mon, 20 Nov 2006)
New Revision: 2230

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
Updated the comments management interface to show a better view of the spam comments.
Included the new YDAkismet::submitHam and YDAkismet::submitSpam functions.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 19:17:20 UTC (rev 2229)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 19:25:23 UTC (rev 2230)
@@ -132,6 +132,25 @@
             $sql = 'DELETE FROM #_comments WHERE is_spam = 1 AND created < (unix_timestamp()-604800)';
             $this->db->executeSql( $sql );
 
+            // Check against akismet if a key is there
+            if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
+
+                // Include the YDAkismet addon
+                include_once( YD_DIR_HOME_ADD . '/YDAkismet/YDAkismet.php' );
+
+                // Get the URL of the weblog
+                $weblog_url = dirname( YDRequest::getCurrentUrl( true ) ) . '/';
+
+                // Initialize YDAkismet
+                $this->akismet = new YDAkismet( $weblog_url, YDConfig::get( 'akismet_key', '' ) );
+
+            } else {
+
+                // No akismet
+                $this->akismet = null;
+
+            }
+
         }
 
         // Get the schema version
@@ -541,17 +560,8 @@
             // Check against akismet if a key is there
             if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
 
-                // Include the YDAkismet addon
-                include_once( YD_DIR_HOME_ADD . '/YDAkismet/YDAkismet.php' );
-
-                // Get the URL of the weblog
-                $weblog_url = dirname( YDRequest::getCurrentUrl( true ) ) . '/';
-
-                // Initialize YDAkismet
-                $akismet = new YDAkismet( $weblog_url, YDConfig::get( 'akismet_key', '' ) );
-
                 // Check if it's spam or not
-                $result = $akismet->checkComment(
+                $result = $this->akismet->checkComment(
                     $values['comment'], $values['username'], $values['useremail'], $values['userwebsite'],
                     $values['userip'], $values['useragent']
                 );
@@ -603,22 +613,50 @@
 
         // Update a comment and mark it as spam
         function updateCommentAsSpam( $comment_id ) {
+
+            // Update the comment
             $comment = $this->getCommentById( $comment_id );
             $comment['is_spam'] = 1;
             unset( $comment['item_title'] );
             $this->updateComment( $comment );
             $sql = 'UPDATE #_items SET num_comments = num_comments-1 WHERE id = ' . $this->str( $comment['item_id'] );
             $this->db->executeSql( $sql );
+
+            // Check against akismet if a key is there
+            if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
+
+                // Submit as spam
+                $this->akismet->submitSpam(
+                    $comment['comment'], $comment['username'], $comment['useremail'], $comment['userwebsite'],
+                    $comment['userip'], $comment['useragent']
+                );
+
+            }
+
         }
 
         // Update a comment and unmark it as spam
         function updateCommentAsNotSpam( $comment_id ) {
+
+            // Update the comment
             $comment = $this->getCommentById( $comment_id );
             $comment['is_spam'] = 0;
             unset( $comment['item_title'] );
             $this->updateComment( $comment );
             $sql = 'UPDATE #_items SET num_comments = num_comments+1 WHERE id = ' . $this->str( $comment['item_id'] );
             $this->db->executeSql( $sql );
+
+            // Check against akismet if a key is there
+            if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
+
+                // Submit as ham
+                $this->akismet->submitHam(
+                    $comment['comment'], $comment['username'], $comment['useremail'], $comment['userwebsite'],
+                    $comment['userip'], $comment['useragent']
+                );
+
+            }
+
         }
 
         // Delete a comment

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 19:17:20 UTC (rev 2229)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 19:25:23 UTC (rev 2230)
@@ -256,6 +256,8 @@
 $GLOBALS['t']['mark_as_spam'] = 'mark as spam';
 $GLOBALS['t']['mark_as_not_spam'] = 'mark as not spam';
 $GLOBALS['t']['is_spam'] = 'Spam comment';
+$GLOBALS['t']['ip_number'] = 'IP number';
+$GLOBALS['t']['spam_delete_desc'] = 'Spam comments are automatically deleted after 7 days.';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Settings';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 19:17:20 UTC (rev 2229)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 19:25:23 UTC (rev 2230)
@@ -256,6 +256,8 @@
 $GLOBALS['t']['mark_as_spam'] = 'markeer als spam';
 $GLOBALS['t']['mark_as_not_spam'] = 'markeer als niet spam';
 $GLOBALS['t']['is_spam'] = 'Spam commentaar';
+$GLOBALS['t']['ip_number'] = 'IP nummer';
+$GLOBALS['t']['spam_delete_desc'] = 'Spam commentaren worden automatisch verwijderd na 7 dagen.';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Instellingen';

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-20 19:17:20 UTC (rev 2229)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-20 19:25:23 UTC (rev 2230)
@@ -47,61 +47,103 @@
         </th>
     </tr>
     {if $comments->set}
-        <tr>
-            <th class="adminRowL" width="17%">{t w="date"}</th>
-            <th class="adminRowL" width="15%">{t w="author"}</th>
-            <th class="adminRowL" width="30%">{t w="comment"}</th>
-            <th class="adminRowR" width="18%">{t w="actions"}</th>
-        </tr>
-        <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-        {foreach from=$comments->set item="comment"}
-            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
-                <td class="adminRowL">
-                    {if $comment.item_is_draft eq '1'}<i>{/if}
-                    {$comment.created|date:'%Y/%m/%d %H:%M'}
-                    {if $comment.item_is_draft eq '1'}</i>{/if}
-                </td>
-                <td class="adminRowL">
-                    {if $comment.item_is_draft eq '1'}<i>{/if}
-                    {$comment.username}
-                    {if $comment.item_is_draft eq '1'}</i>{/if}
-                </td>
-                <td class="adminRowL">
-                    {*{if $comment.item_is_draft eq '1'}<i>{/if}
-                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
-                    {if $comment.item_title}
+        {if $filter == 'no_spam'}
+            <tr>
+                <th class="adminRowL" width="17%">{t w="date"}</th>
+                <th class="adminRowL" width="15%">{t w="author"}</th>
+                <th class="adminRowL" width="30%">{t w="comment"}</th>
+                <th class="adminRowR" width="18%">{t w="actions"}</th>
+            </tr>
+            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
+            {foreach from=$comments->set item="comment"}
+                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
+                    <td class="adminRowL">
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        {$comment.created|date:'%Y/%m/%d %H:%M'}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowL">
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        {$comment.username}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowL">
+                        {*{if $comment.item_is_draft eq '1'}<i>{/if}
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
+                        {if $comment.item_title}
+                            <br/>
+                            {t w="item"}: {$comment.item_title}
+                        {/if}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}*}
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
                         <br/>
-                        {t w="item"}: {$comment.item_title}
-                    {/if}
-                    {if $comment.item_is_draft eq '1'}</i>{/if}*}
-                    {if $comment.item_is_draft eq '1'}<i>{/if}
-                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
-                    <br/>
-                    {$comment.comment|bbcode|strip_tags|truncate}
-                    {if $comment.item_is_draft eq '1'}</i>{/if}
+                        {$comment.comment|bbcode|strip_tags|truncate}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowR">
+                        <a href="../item.php?id={$comment.item_id}#comment-{$comment.id}" target="_blank">{t w="view"}</a>
+                        |
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
+                        |
+                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
+                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
+                        <br/>
+                        {if $comment.is_spam}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
+                        {else}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
+                        {/if}
+                    </td>
+                </tr>
+            {/foreach}
+            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
+            <tr>
+                <td class="adminRowLNB" colspan="4">
+                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
                 </td>
-                <td class="adminRowR">
-                    <a href="../item.php?id={$comment.item_id}#comment-{$comment.id}" target="_blank">{t w="view"}</a>
-                    |
-                    <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
-                    |
-                    <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
-                     onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
-                    <br/>
-                    {if $comment.is_spam}
-                        <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
-                    {else}
-                        <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
-                    {/if}
+            </tr>
+        {else}
+            <tr><td class="adminRowL" colspan="4"><i>{t w="spam_delete_desc"}</i></td></tr>
+            <tr>
+                <th class="adminRowL" width="17%">{t w="date"}</th>
+                <th class="adminRowL" width="15%">{t w="author"}</th>
+                <th class="adminRowL" width="15%">{t w="ip_number"}</th>
+                <th class="adminRowR" width="33%">{t w="actions"}</th>
+            </tr>
+            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
+            {foreach from=$comments->set item="comment"}
+                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
+                    <td class="adminRowL">
+                        {$comment.created|date:'%Y/%m/%d %H:%M'}
+                    </td>
+                    <td class="adminRowL">
+                        {$comment.username}
+                    </td>
+                    <td class="adminRowL">
+                        {$comment.userip}
+                    </td>
+                    <td class="adminRowR">
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
+                        |
+                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
+                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
+                        |
+                        {if $comment.is_spam}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
+                        {else}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
+                        {/if}
+                    </td>
+                </tr>
+            {/foreach}
+            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
+            <tr>
+                <td class="adminRowLNB" colspan="4">
+                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
                 </td>
             </tr>
-        {/foreach}
-        <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-        <tr>
-            <td class="adminRowLNB" colspan="4">
-                <p class="subline">{t w="total"}: {$comments->totalRows}</p>
-            </td>
-        </tr>
+        {/if}
     {else}
         <tr>
             <td class="adminRowL" colspan="7">{t w="no_comments_found"}</td>



From pclaerhout at mail.berlios.de  Mon Nov 20 20:52:07 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Nov 2006 20:52:07 +0100
Subject: [ydf-devel] r2231 - in YDFramework2.0/trunk/examples/weblog: .
	include include/languages manage
Message-ID: <200611201952.kAKJq7ag020040@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-20 20:52:06 +0100 (Mon, 20 Nov 2006)
New Revision: 2231

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/config.tpl
Log:
Changed the comment mechanism to allow only 1 comment each 10 seconds for each individual IP number. This should reduce the number of spam messages that actually get to the system.

I mainly did this because yellowduck.be is suffering quite heavily from comment spam and it's affecting the used bandwidth. By just spawning a small error message in case of a spam attack, this should now be better.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 19:52:06 UTC (rev 2231)
@@ -132,6 +132,13 @@
             $sql = 'DELETE FROM #_comments WHERE is_spam = 1 AND created < (unix_timestamp()-604800)';
             $this->db->executeSql( $sql );
 
+            // Delete the old IP numbers from spam check
+            $comment_interval = YDConfig::get( 'comment_interval', 10 );
+            if ( $comment_interval != '' && is_numeric( $comment_interval ) ) {
+                $sql = 'DELETE FROM #_spamcheck WHERE lastvisit < (unix_timestamp()-' . $comment_interval . ')';
+                $this->db->executeSql( $sql );
+            }
+
             // Check against akismet if a key is there
             if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
 
@@ -188,7 +195,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 6;
+            $current_schema = 7;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -250,6 +257,19 @@
                     );
                 }
 
+                // Create the spamcheck table
+                if ( ! $this->dbmeta->tableExists( '#_spamcheck' ) ) {
+                    $this->db->executeSql(
+                          'CREATE TABLE #_spamcheck ('
+                        . '  id int(11) NOT NULL auto_increment,'
+                        . '  userip varchar(20) default NULL,'
+                        . '  lastvisit int(11) default NULL,'
+                        . '  PRIMARY KEY  (id),'
+                        . '  UNIQUE KEY userip (userip)'
+                        . ')'
+                    );
+                }
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 
@@ -903,6 +923,24 @@
             $this->db->executeSql( $sql );
         }
 
+        // Check if we are in the spam_check table, which means we have a spam attack
+        function inSpamAttack() {
+            $comment_interval = YDConfig::get( 'comment_interval', 10 );
+            if ( $comment_interval != '' && is_numeric( $comment_interval ) ) {
+                $sql = 'SELECT * FROM #_spamcheck WHERE userip = ' . $this->str( $_SERVER['REMOTE_ADDR'] );
+                return $this->db->getRecord( $sql );
+            }
+        }
+
+        // Mark ourselves in the spam check table
+        function spamCheckMark() {
+            $comment_interval = YDConfig::get( 'comment_interval', 10 );
+            if ( $comment_interval != '' && is_numeric( $comment_interval ) ) {
+                $values = array( 'userip' => $_SERVER['REMOTE_ADDR'], 'lastvisit' => time() );
+                $this->db->executeInsert( '#_spamcheck', $values );
+            }
+        }
+
         // Function to resize an uploaded image. Takes a YDFSImage object as it's argument
         function resizeUploadedImage( $image ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 19:52:06 UTC (rev 2231)
@@ -301,6 +301,8 @@
 $GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
 $GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">get one here</a>)';
 $GLOBALS['t']['cfg_max_img_size'] = 'Maximum image size';
+$GLOBALS['t']['cfg_comment_interval'] = 'Comment interval in seconds';
+$GLOBALS['t']['err_comment_interval_num'] = 'Comment interval should be numeric';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Title';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 19:52:06 UTC (rev 2231)
@@ -301,6 +301,8 @@
 $GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
 $GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">hier te verkrijgen</a>)';
 $GLOBALS['t']['cfg_max_img_size'] = 'Maximale beeldgrootte';
+$GLOBALS['t']['cfg_comment_interval'] = 'Commentaar interval in seconden';
+$GLOBALS['t']['err_comment_interval_num'] = 'Commentaar interval moet een getal zijn';
 
 // manage/item.tpl
 $GLOBALS['t']['item_title'] = 'Item Titel';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-11-20 19:52:06 UTC (rev 2231)
@@ -82,6 +82,13 @@
             // Process the form
             if ( $form->validate() === true ) {
 
+                // Post request, so check comment interval
+                if ( $this->weblog->inSpamAttack() ) {
+                    die( '<b>ERROR:</b> Comment interval exceeded. Refusing request.' );
+                } else {
+                    $this->weblog->spamCheckMark();
+                }
+
                 // Get the form values
                 $values = $form->getValues();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2006-11-20 19:52:06 UTC (rev 2231)
@@ -98,6 +98,7 @@
 
             $form->addElement( 'textarea', 'blocked_ips', t( 'cfg_blocked_ips' ), array( 'class' => 'tfMNoMCE' ) );
             $form->addElement( 'text', 'akismet_key', t( 'cfg_akismet_key' ), array( 'class' => 'tfM' ) );
+            $form->addElement( 'text', 'comment_interval', t( 'cfg_comment_interval' ), array( 'class' => 'tfM' ) );
 
             $form->addElement( 'submit', '_cmdSubmit', t('OK'), array( 'class' => 'button' ) );
 
@@ -113,6 +114,7 @@
             $form->addRule( 'weblog_entries_fp', 'numeric', t( 'err_weblog_entries_fp_num' ) );
             $form->addRule( 'max_syndicated_items', 'required', t( 'err_max_syndicated_items' ) );
             $form->addRule( 'max_syndicated_items', 'numeric', t( 'err_max_syndicated_items_num' ) );
+            $form->addRule( 'comment_interval', 'numeric', t( 'err_comment_interval_num' ) );
 
             // Add the filters
             $form->addFilters( 
@@ -174,6 +176,7 @@
             $config['akismet_key']          = YDConfig::get( 'akismet_key',          '' );
             $config['max_img_size_x']       = YDConfig::get( 'max_img_size_x',       '' );
             $config['max_img_size_y']       = YDConfig::get( 'max_img_size_y',       '' );
+            $config['comment_interval']     = YDConfig::get( 'comment_interval',     10 );
 
             // Return the configuration
             return $config;

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-11-20 19:25:23 UTC (rev 2230)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.tpl	2006-11-20 19:52:06 UTC (rev 2231)
@@ -144,6 +144,10 @@
             <td class="adminRowL">{t w="cfg_akismet_key"}</td>
             <td class="adminRowL">{$config.akismet_key|default:'-'}</td>
         </tr>
+        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+            <td class="adminRowL">{t w="cfg_comment_interval"}</td>
+            <td class="adminRowL">{$config.comment_interval|default:'-'}</td>
+        </tr>
     </table>
     <p><input type="button" class="button" onClick="window.location='{$YD_SELF_SCRIPT}?do=edit';" value="{t w="change_config"}" />
 {/if}
@@ -286,6 +290,10 @@
                 <td class="adminRowL">{$form.akismet_key.label_html}</td>
                 <td class="adminRowL">{$form.akismet_key.html}</td>
             </tr>
+            <tr>
+                <td class="adminRowL">{$form.comment_interval.label_html}</td>
+                <td class="adminRowL">{$form.comment_interval.html}</td>
+            </tr>
         </table>
         <p>{$form._cmdSubmit.html}</p>
     {$form.endtag}



From francisco at fusemail.com  Mon Nov 20 21:01:04 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 20 Nov 2006 20:01:04 +0000
Subject: [ydf-devel] Akismet feedback
Message-ID: <45620980.1010503@fusemail.com>

Hi Pieter,

I have tested you akismet example and i must say this system is an 
excellent idea. The only problem i see here is speed (and the need to 
wait for that extra connection).

Anyway, the example demonstrates how akismet marks spam but i have 
tested the first emails in my spam box.. and akismet did not detect them 
  correctly (i says "not spam".. but it's wrong).

$comments = array(
	array(
		'comment' => "Looking for information and found it at this great 
site...\r\n\r\nwelcom\r\ncard credit us\r\nbest card credit\r\nairline 
tickets\r\nnew orleans hote\r\nbad-credit-card-uk\r\naffiliate 
program\r\nair flight in canada\r\nremoval spyware\r\nhome 
mortgage\r\nmedical insurance\r\nmortgage calculator\r\nus airway 
airline\r\nhome equity",
		'author'  => 'PCNFZUII',
	),
	array(
		'comment' => "Wazzzup All. Don\\\'t delete please! \r\nacne treatment 
\r\nproactive acne treatment \r\nbest acne treatment \r\nacne scar 
treatment \r\nnatural acne treatment \r\nacne home treatment \r\nadult 
acne treatment \r\nacne treatment product \r\nacne skin care treatment 
product \r\nacne treatment skin care \r\nThanks.",
		'author'  => 'someone',
	),
);


Maybe we have a long way go in the spam protection. :(


Francisco A


From francisco at fusemail.com  Mon Nov 20 21:06:15 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 20 Nov 2006 20:06:15 +0000
Subject: [ydf-devel] Akismet feedback
In-Reply-To: <45620980.1010503@fusemail.com>
References: <45620980.1010503@fusemail.com>
Message-ID: <45620AB7.6060201@fusemail.com>

Btw, what happens if the akismet server is down?

The comment will not be added?

regards
Francisco A



From pclaerhout at mail.berlios.de  Mon Nov 20 21:08:45 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 20 Nov 2006 21:08:45 +0100
Subject: [ydf-devel] r2232 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200611202008.kAKK8jAW022499@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-20 21:08:45 +0100 (Mon, 20 Nov 2006)
New Revision: 2232

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
Added an option to delete all spam messages.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 19:52:06 UTC (rev 2231)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-20 20:08:45 UTC (rev 2232)
@@ -941,6 +941,12 @@
             }
         }
 
+        // Delete the spam comments
+        function emptySpam() {
+            $sql = 'DELETE FROM #_comments WHERE is_spam = 1';
+            $this->db->executeSql( $sql );
+        }
+
         // Function to resize an uploaded image. Takes a YDFSImage object as it's argument
         function resizeUploadedImage( $image ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 19:52:06 UTC (rev 2231)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-20 20:08:45 UTC (rev 2232)
@@ -251,6 +251,7 @@
 $GLOBALS['t']['change_comment_desc'] = 'Change comment';
 $GLOBALS['t']['mail'] = 'Email';
 $GLOBALS['t']['no_comments_found'] = 'No comments were found';
+$GLOBALS['t']['no_spam_comments_found'] = 'No spam comments were found';
 $GLOBALS['t']['posted_from'] = 'Posted from IP address';
 $GLOBALS['t']['a_comments_spam'] = 'Spam comments';
 $GLOBALS['t']['mark_as_spam'] = 'mark as spam';
@@ -258,6 +259,8 @@
 $GLOBALS['t']['is_spam'] = 'Spam comment';
 $GLOBALS['t']['ip_number'] = 'IP number';
 $GLOBALS['t']['spam_delete_desc'] = 'Spam comments are automatically deleted after 7 days.';
+$GLOBALS['t']['confirm_empty_spam'] = 'Are you sure you want to delete all spam comments?';
+$GLOBALS['t']['empty_spam_now'] = 'Delete all spam comments now.';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Settings';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 19:52:06 UTC (rev 2231)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-20 20:08:45 UTC (rev 2232)
@@ -251,6 +251,7 @@
 $GLOBALS['t']['change_comment_desc'] = 'Wijzig commentaar';
 $GLOBALS['t']['mail'] = 'Email';
 $GLOBALS['t']['no_comments_found'] = 'Er werden geen commentaren gevonden';
+$GLOBALS['t']['no_spam_comments_found'] = 'Er werden geen spam commentaren gevonden';
 $GLOBALS['t']['posted_from'] = 'Gepost van het IP adres';
 $GLOBALS['t']['a_comments_spam'] = 'Spam commentaren';
 $GLOBALS['t']['mark_as_spam'] = 'markeer als spam';
@@ -258,6 +259,8 @@
 $GLOBALS['t']['is_spam'] = 'Spam commentaar';
 $GLOBALS['t']['ip_number'] = 'IP nummer';
 $GLOBALS['t']['spam_delete_desc'] = 'Spam commentaren worden automatisch verwijderd na 7 dagen.';
+$GLOBALS['t']['confirm_empty_spam'] = 'Bent u zeker dat u alle spam commentaren wil verwijderen?';
+$GLOBALS['t']['empty_spam_now'] = 'Verwijder nu alle spam commentaren.';
 
 // manage/config.tpl
 $GLOBALS['t']['cfg_db_settings'] = 'Database Instellingen';

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-11-20 19:52:06 UTC (rev 2231)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.php	2006-11-20 20:08:45 UTC (rev 2232)
@@ -175,6 +175,12 @@
             $this->redirectToAction();
         }
 
+        // Empty the spam
+        function actionEmptySpam() {
+            $this->weblog->emptySpam();
+            $this->redirect( YD_SELF_SCRIPT . '?filter=spam' );
+        }
+
     }
 
     // Process the request

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-20 19:52:06 UTC (rev 2231)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-20 20:08:45 UTC (rev 2232)
@@ -104,7 +104,10 @@
                 </td>
             </tr>
         {else}
-            <tr><td class="adminRowL" colspan="4"><i>{t w="spam_delete_desc"}</i></td></tr>
+            <tr><td class="adminRowL" colspan="4">
+                <i>{t w="spam_delete_desc"}. <a href="{$YD_SELF_SCRIPT}?do=emptySpam"
+                 onClick="return confirm( '{t w="confirm_empty_spam"}' );">{t w="empty_spam_now"}</a></i>
+            </td></tr>
             <tr>
                 <th class="adminRowL" width="17%">{t w="date"}</th>
                 <th class="adminRowL" width="15%">{t w="author"}</th>
@@ -146,7 +149,13 @@
         {/if}
     {else}
         <tr>
-            <td class="adminRowL" colspan="7">{t w="no_comments_found"}</td>
+            <td class="adminRowL" colspan="7">
+                {if $filter == 'no_spam'}
+                    {t w="no_comments_found"}
+                {else}
+                    {t w="no_spam_comments_found"}
+                {/if}
+            </td>
         </tr>
     {/if}
 



From pieter at yellowduck.be  Mon Nov 20 21:12:34 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Mon, 20 Nov 2006 21:12:34 +0100
Subject: [ydf-devel] Akismet feedback
In-Reply-To: <45620AB7.6060201@fusemail.com>
References: <45620980.1010503@fusemail.com> <45620AB7.6060201@fusemail.com>
Message-ID: <4aef63030611201212r974c55fhc0c4b4de6be03fde@mail.gmail.com>

The comment will be added if the server is down.

I'm running it already for a long time on yellowduck.be, and it's catching
all spam messages so far, without a glitch. In the last few weeks, it marked
already 900 spam comments.

For that reason, I prefer the wait, as otherwise, it's almost impossible to
keep up with this crap.

PS: more info on www.akismet.com

cheers,


pieter

2006/11/20, Francisco Azevedo <francisco at fusemail.com>:
>
> Btw, what happens if the akismet server is down?
>
> The comment will not be added?
>
> regards
> Francisco A
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061120/a302880e/attachment.html>

From pclaerhout at mail.berlios.de  Tue Nov 21 09:05:23 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Nov 2006 09:05:23 +0100
Subject: [ydf-devel] r2233 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200611210805.kAL85N8f029979@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-21 09:05:22 +0100 (Tue, 21 Nov 2006)
New Revision: 2233

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
Added the seconds to the timestamp in the spam comments view.

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-20 20:08:45 UTC (rev 2232)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-21 08:05:22 UTC (rev 2233)
@@ -109,16 +109,16 @@
                  onClick="return confirm( '{t w="confirm_empty_spam"}' );">{t w="empty_spam_now"}</a></i>
             </td></tr>
             <tr>
-                <th class="adminRowL" width="17%">{t w="date"}</th>
+                <th class="adminRowL" width="20%">{t w="date"}</th>
                 <th class="adminRowL" width="15%">{t w="author"}</th>
-                <th class="adminRowL" width="15%">{t w="ip_number"}</th>
+                <th class="adminRowL" width="12%">{t w="ip_number"}</th>
                 <th class="adminRowR" width="33%">{t w="actions"}</th>
             </tr>
             <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
             {foreach from=$comments->set item="comment"}
                 <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
                     <td class="adminRowL">
-                        {$comment.created|date:'%Y/%m/%d %H:%M'}
+                        {$comment.created|date:'%Y/%m/%d %H:%M:%S'}
                     </td>
                     <td class="adminRowL">
                         {$comment.username}



From pclaerhout at mail.berlios.de  Tue Nov 21 13:32:36 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Nov 2006 13:32:36 +0100
Subject: [ydf-devel] r2234 - in YDFramework2.0/trunk/examples/weblog:
	include/languages manage
Message-ID: <200611211232.kALCWaF5002843@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-21 13:32:35 +0100 (Tue, 21 Nov 2006)
New Revision: 2234

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
The comments now have a weight which is the number of characters in the body of the comment. Turns out that a lot of spam comments have a body size of more than 2048 characters (2Kb), whereas normal comments don't tend to have this and are most of the time smaller.

I might add a maxlen filter to the body of the comment to prevent comment spam even further.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-21 08:05:22 UTC (rev 2233)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-21 12:32:35 UTC (rev 2234)
@@ -1,368 +1,369 @@
-<?php
-
-// General stuff
-$GLOBALS['t']['not_found'] = 'Not Found';
-$GLOBALS['t']['sorry_not_there'] = 'Sorry, but you are looking for something that isn\'t here.';
-$GLOBALS['t']['sorry_not_found'] = 'Sorry, but you are looking for something that isn\'t here.';
-$GLOBALS['t']['no_items_found'] = 'Sorry, but you are looking for something that isn\'t here.';
-$GLOBALS['t']['by'] = 'by';
-$GLOBALS['t']['required'] = 'required';
-$GLOBALS['t']['login'] = 'Login';
-$GLOBALS['t']['actions'] = 'Actions';
-$GLOBALS['t']['save'] = 'Save';
-$GLOBALS['t']['edit'] = 'edit';
-$GLOBALS['t']['delete'] = 'delete';
-$GLOBALS['t']['previous'] = 'previous';
-$GLOBALS['t']['next'] = 'next';
-$GLOBALS['t']['total'] = 'total';
-$GLOBALS['t']['of'] = 'of';
-$GLOBALS['t']['at'] = 'at';
-$GLOBALS['t']['title'] = 'Title';
-$GLOBALS['t']['install_warning'] = 'You need to remove the install.php and install.tpl files for security reasons!';
-$GLOBALS['t']['home'] = 'Home';
-$GLOBALS['t']['view'] = 'view';
-$GLOBALS['t']['author'] = 'Author';
-$GLOBALS['t']['more'] = 'more';
-$GLOBALS['t']['err_general'] = 'An error occured';
-$GLOBALS['t']['back'] = 'Go back';
-$GLOBALS['t']['yes'] = 'yes';
-$GLOBALS['t']['no'] = 'no';
-$GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
-$GLOBALS['t']['rows'] = 'row(s)';
-$GLOBALS['t']['tables'] = 'Tables';
-$GLOBALS['t']['related_items'] = 'Related items to';
-
-// __std_header.tpl
-$GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';
-
-// __std_footer.tpl
-$GLOBALS['t']['or'] = 'or';
-$GLOBALS['t']['powered_by'] = 'This weblog is powered by the';
-$GLOBALS['t']['syndicate_as'] = 'Syndicate this weblog as ';
-$GLOBALS['t']['syndicate_comments_as'] = 'Comments as ';
-$GLOBALS['t']['syndicate_gallery_as'] = 'Galleries as ';
-$GLOBALS['t']['design_by'] = 'Design by Michael Heilemann.';
-
-// __std_sidebar.tpl
-$GLOBALS['t']['weblogs'] = 'Weblogs';
-$GLOBALS['t']['weblog'] = 'Weblog';
-$GLOBALS['t']['pages'] = 'Pages';
-$GLOBALS['t']['page'] = 'Page';
-$GLOBALS['t']['archives'] = 'Archives';
-$GLOBALS['t']['archives_gallery'] = 'Photo Galleries';
-$GLOBALS['t']['categories'] = 'Categories';
-$GLOBALS['t']['view_posts_filed_under'] = 'View all posts filed under';
-$GLOBALS['t']['links'] = 'Links';
-$GLOBALS['t']['link_to'] = 'Link to';
-$GLOBALS['t']['admin'] = 'Admin';
-
-// archive.tpl
-
-// category.tpl
-$GLOBALS['t']['archive_for_the'] = 'Archive for the';
-$GLOBALS['t']['category'] = 'Category';
-
-// index.tpl
-$GLOBALS['t']['posted_in'] = 'posted in';
-$GLOBALS['t']['older_items'] = 'Older posts';
-
-// item.tpl
-$GLOBALS['t']['older_post'] = 'older post';
-$GLOBALS['t']['newer_post'] = 'newer post';
-$GLOBALS['t']['posted_under'] = 'This entry was posted on';
-$GLOBALS['t']['filed_under'] = 'and is filed under';
-$GLOBALS['t']['can_leave_comment'] = 'You can <a href="#respond">leave a comment</a>';
-$GLOBALS['t']['trackback'] = 'trackback';
-$GLOBALS['t']['from_your_site'] = 'from your own site.';
-$GLOBALS['t']['to'] = 'to';
-$GLOBALS['t']['says'] = 'says';
-$GLOBALS['t']['leave_comment'] = 'Leave a comment';
-$GLOBALS['t']['error_comment'] = 'There was a problem adding your comment';
-$GLOBALS['t']['name'] = 'Name';
-$GLOBALS['t']['mail_not_published'] = 'Email (will not be published)';
-$GLOBALS['t']['website'] = 'Website';
-$GLOBALS['t']['submit_comment'] = 'Submit comment';
-$GLOBALS['t']['ta_enter_url'] = 'Enter the url';
-$GLOBALS['t']['ta_enter_email'] = 'Enter the email address';
-$GLOBALS['t']['ta_enter_image'] = 'Enter the full url of the image';
-$GLOBALS['t']['err_name'] = 'Name is missing';
-$GLOBALS['t']['err_name_email'] = 'Name should not be an email address';
-$GLOBALS['t']['err_email'] = 'Email is missing or invalid';
-$GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
-$GLOBALS['t']['err_comment'] = 'Comment is required';
-$GLOBALS['t']['with'] = 'for';
-$GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
-$GLOBALS['t']['spam'] = 'Spam';
-$GLOBALS['t']['no_spam'] = 'No spam';
-$GLOBALS['t']['choose_no_spam'] = 'Choose "no spam" here';
-$GLOBALS['t']['err_userspam'] = 'Detected a spam attack';
-
-// comment_email.tpl
-$GLOBALS['t']['new_comment'] = 'New comment';
-$GLOBALS['t']['item_title'] = 'Item title';
-$GLOBALS['t']['wrote'] = 'wrote';
-
-// item_email.tpl
-$GLOBALS['t']['new_item'] = 'New item';
-
-// page.tpl
-$GLOBALS['t']['created_on'] = 'Created on';
-$GLOBALS['t']['last_modified_on'] = 'Last modified on';
-
-// Comments
-$GLOBALS['t']['no_comments_yet'] = 'No comments yet';
-$GLOBALS['t']['comment'] = 'Comment';
-$GLOBALS['t']['comments'] = 'Comments';
-$GLOBALS['t']['err_name_length'] = 'Name cannot be longer than 35 characters';
-
-// manage/__mng_header.tpl
-$GLOBALS['t']['confirm_delete'] = 'Are you sure you want to delete:';
-$GLOBALS['t']['logoff'] = 'logoff';
-$GLOBALS['t']['view_site'] = 'view site';
-$GLOBALS['t']['user'] = 'user';
-$GLOBALS['t']['server'] = 'Server';
-$GLOBALS['t']['h_shortcuts'] = 'Shortcuts';
-$GLOBALS['t']['a_admin_home'] = 'Admin home';
-$GLOBALS['t']['a_view_site'] = 'View site';
-$GLOBALS['t']['h_contents'] = 'Contents';
-$GLOBALS['t']['a_weblogs'] = 'Weblogs';
-$GLOBALS['t']['a_items'] = 'Items';
-$GLOBALS['t']['a_comments'] = 'Comments';
-$GLOBALS['t']['a_links'] = 'Links';
-$GLOBALS['t']['a_pages'] = 'Pages';
-$GLOBALS['t']['a_images'] = 'Images';
-$GLOBALS['t']['a_categories'] = 'Categories';
-$GLOBALS['t']['h_global_settings'] = 'Global Settings';
-$GLOBALS['t']['a_users'] = 'Users';
-$GLOBALS['t']['a_settings'] = 'Settings';
-$GLOBALS['t']['h_maintenance'] = 'Maintenance';
-$GLOBALS['t']['a_cleanup_cache'] = 'Cache files';
-$GLOBALS['t']['a_server_info'] = 'Server info';
-$GLOBALS['t']['h_statistics'] = 'Statistics';
-$GLOBALS['t']['a_statistics'] = 'Statistics';
-$GLOBALS['t']['h_logoff'] = 'Logoff';
-$GLOBALS['t']['a_logoff'] = 'Logoff';
-
-// manage/login.tpl
-$GLOBALS['t']['username'] = 'User';
-$GLOBALS['t']['password'] = 'Password';
-$GLOBALS['t']['msg_login'] = 'Please enter your username and password';
-$GLOBALS['t']['err_login'] = 'There was a problem logging you in';
-$GLOBALS['t']['err_username'] = 'Username is missing';
-$GLOBALS['t']['err_password'] = 'Password is missing or incorrect';
-$GLOBALS['t']['err_login_all'] = 'Username and/or password are incorrect';
-
-// manage/cache.tpl
-$GLOBALS['t']['cleanup'] = 'Cleanup';
-$GLOBALS['t']['cleanup_cache'] = 'Cleanup cache files';
-$GLOBALS['t']['cache_cleaned_up'] = 'Cache files are cleaned up!';
-
-// manage/serverinfo.tpl
-$GLOBALS['t']['system'] = 'System';
-$GLOBALS['t']['server_name'] = 'Server Name';
-$GLOBALS['t']['server_address'] = 'Server Address';
-$GLOBALS['t']['server_port'] = 'Server Port';
-$GLOBALS['t']['server_software'] = 'Server Software';
-$GLOBALS['t']['operating_system'] = 'Operating System';
-$GLOBALS['t']['version'] = 'version';
-$GLOBALS['t']['loaded_modules'] = 'Loaded modules';
-$GLOBALS['t']['server_api'] = 'Server API';
-$GLOBALS['t']['registered_streams'] = 'Registered PHP streams';
-$GLOBALS['t']['include_path'] = 'Include Path';
-$GLOBALS['t']['full_php_info'] = 'Full PHP information';
-
-// manage/stats.tpl
-$GLOBALS['t']['general_stats'] = 'General statistics';
-$GLOBALS['t']['installed_since'] = 'Installed since';
-$GLOBALS['t']['num_days_online'] = 'Number of days online';
-$GLOBALS['t']['days'] = 'day(s)';
-$GLOBALS['t']['hits'] = 'hit(s)';
-$GLOBALS['t']['no_bots'] = ' (without automatic bots)';
-$GLOBALS['t']['total_hits'] = 'Total number of hits';
-$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
-$GLOBALS['t']['avg_hits_per_day'] = 'Average number of hits per day';
-$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
-$GLOBALS['t']['total_average_stats'] = 'Totals and averages';
-$GLOBALS['t']['hits_last_6_months'] = 'Hits last 6 months';
-$GLOBALS['t']['all_months'] = 'All months';
-$GLOBALS['t']['hits_last_7_days'] = 'Hits last 7 days';
-$GLOBALS['t']['all_days'] = 'All days';
-$GLOBALS['t']['nothing_found'] = 'Nothing found';
-$GLOBALS['t']['top_10_urls'] = 'The 10 most visited URLs';
-$GLOBALS['t']['all_urls'] = 'All URLs';
-$GLOBALS['t']['web_browsers'] = 'Web browsers';
-$GLOBALS['t']['operating_systems'] = 'Operating systems';
-$GLOBALS['t']['other'] = 'Other';
-$GLOBALS['t']['totalitems'] = 'Total number of items';
-$GLOBALS['t']['totalcomments'] = 'Total number of comments';
-$GLOBALS['t']['items'] = 'item(s)';
-$GLOBALS['t']['top_10_commenters'] = 'The 10 most active commenters';
-$GLOBALS['t']['all_commenters'] = 'All commenters';
-$GLOBALS['t']['reset_stats'] = 'Reset all statistics';
-
-// manage/users.tpl
-$GLOBALS['t']['useremail'] = 'Email address';
-$GLOBALS['t']['created'] = 'Created on';
-$GLOBALS['t']['add_user'] = 'Add new user';
-$GLOBALS['t']['req_useremail'] = 'Email address is missing or invalid';
-$GLOBALS['t']['req_loginpass'] = 'Password is required';
-$GLOBALS['t']['user_dup'] = 'User already exists';
-$GLOBALS['t']['change_user_desc'] = 'Changing user:';
-
-// manage/images.tpl
-$GLOBALS['t']['upload_image'] = 'Upload image';
-$GLOBALS['t']['ok'] = 'OK';
-$GLOBALS['t']['size'] = 'Size';
-$GLOBALS['t']['type'] = 'Type';
-$GLOBALS['t']['dimensions'] = 'Dimensions';
-$GLOBALS['t']['no_images_found'] = 'No images were found';
-
-// manage/categories.tpl
-$GLOBALS['t']['add_category'] = 'Add category';
-$GLOBALS['t']['number_of_items'] = 'Number of items';
-$GLOBALS['t']['change_category_desc'] = 'Edit category';
-$GLOBALS['t']['err_category_title'] = 'Category name is required';
-$GLOBALS['t']['err_unique_category'] = 'Category exists already';
-$GLOBALS['t']['no_categories_found'] = 'No categories were found';
-
-// manage/links.tpl
-$GLOBALS['t']['link_title'] = 'Link Title';
-$GLOBALS['t']['link_url'] = 'Link URL';
-$GLOBALS['t']['add_link'] = 'Add link';
-$GLOBALS['t']['err_link_title'] = 'Link title is required';
-$GLOBALS['t']['err_link_url'] = 'Link URL is required';
-$GLOBALS['t']['err_unique_link'] = 'Link URL exists already';
-$GLOBALS['t']['change_link_desc'] = 'Change link';
-$GLOBALS['t']['no_links_found'] = 'No links were found';
-$GLOBALS['t']['num_visits'] = 'Visits';
-
-// manage/pages.tpl
-$GLOBALS['t']['add_page'] = 'Add page';
-$GLOBALS['t']['page_title'] = 'Page title';
-$GLOBALS['t']['page_body'] = 'Page body';
-$GLOBALS['t']['change_page_desc'] = 'Change page';
-$GLOBALS['t']['err_page_title'] = 'Page title is required';
-$GLOBALS['t']['err_page_body'] = 'Page body is required';
-$GLOBALS['t']['no_pages_found'] = 'No pages were found';
-
-// manage/comments.tpl
-$GLOBALS['t']['date'] = 'Date';
-$GLOBALS['t']['parent'] = 'Parent Item';
-$GLOBALS['t']['change_comment_desc'] = 'Change comment';
-$GLOBALS['t']['mail'] = 'Email';
-$GLOBALS['t']['no_comments_found'] = 'No comments were found';
-$GLOBALS['t']['no_spam_comments_found'] = 'No spam comments were found';
-$GLOBALS['t']['posted_from'] = 'Posted from IP address';
-$GLOBALS['t']['a_comments_spam'] = 'Spam comments';
-$GLOBALS['t']['mark_as_spam'] = 'mark as spam';
-$GLOBALS['t']['mark_as_not_spam'] = 'mark as not spam';
-$GLOBALS['t']['is_spam'] = 'Spam comment';
-$GLOBALS['t']['ip_number'] = 'IP number';
-$GLOBALS['t']['spam_delete_desc'] = 'Spam comments are automatically deleted after 7 days.';
-$GLOBALS['t']['confirm_empty_spam'] = 'Are you sure you want to delete all spam comments?';
-$GLOBALS['t']['empty_spam_now'] = 'Delete all spam comments now.';
-
-// manage/config.tpl
-$GLOBALS['t']['cfg_db_settings'] = 'Database Settings';
-$GLOBALS['t']['cfg_db_host'] = 'Database Hostname';
-$GLOBALS['t']['cfg_db_name'] = 'Database Name';
-$GLOBALS['t']['cfg_db_user'] = 'Database Username';
-$GLOBALS['t']['cfg_db_pass'] = 'Database Password';
-$GLOBALS['t']['cfg_weblog_settings'] = 'Weblog Settings';
-$GLOBALS['t']['cfg_weblog_title'] = 'Weblog Title';
-$GLOBALS['t']['cfg_weblog_description'] = 'Weblog Description';
-$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Number of items on the front page';
-$GLOBALS['t']['cfg_weblog_skin'] = 'Weblog skin';
-$GLOBALS['t']['cfg_weblog_language'] = 'Weblog Language';
-$GLOBALS['t']['cfg_weblog_date_format'] = 'Date format';
-$GLOBALS['t']['cfg_notification'] = 'Notification Settings';
-$GLOBALS['t']['cfg_notification_email_comment'] = 'Email new comments';
-$GLOBALS['t']['cfg_notification_email_item'] = 'Email new items to site authors';
-$GLOBALS['t']['cfg_rss'] = 'Syndication Settings';
-$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Number of syndicated items';
-$GLOBALS['t']['err_db_host'] = 'Database Hostname is required';
-$GLOBALS['t']['err_db_name'] = 'Database Name is required';
-$GLOBALS['t']['err_db_user'] = 'Database Username is required';
-$GLOBALS['t']['err_weblog_title'] = 'Weblog Title is required';
-$GLOBALS['t']['err_weblog_entries_fp'] = 'Number of entries on the front page is required';
-$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Number of entries on the front page should be numeric';
-$GLOBALS['t']['err_max_syndicated_items'] = 'Number of syndicated items is required';
-$GLOBALS['t']['err_max_syndicated_items_num'] = 'Number of syndicated items should be numeric';
-$GLOBALS['t']['change_config'] = 'Change';
-$GLOBALS['t']['cfg_db_prefix'] = 'Database table prefix';
-$GLOBALS['t']['cfg_cache'] = 'Caching';
-$GLOBALS['t']['cfg_use_cache_comment'] = 'Cache public pages';
-$GLOBALS['t']['cfg_friendly_urls'] = 'Friendly URLs';
-$GLOBALS['t']['cfg_spam_protection'] = 'Spam protection';
-$GLOBALS['t']['cfg_auto_close_items'] = 'Do not allow comment after x days';
-$GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
-$GLOBALS['t']['cfg_include_debug_info'] = 'Show debugging information';
-$GLOBALS['t']['cfg_default_item_settings'] = 'Default values for new items';
-$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
-$GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
-$GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
-$GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
-$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">get one here</a>)';
-$GLOBALS['t']['cfg_max_img_size'] = 'Maximum image size';
-$GLOBALS['t']['cfg_comment_interval'] = 'Comment interval in seconds';
-$GLOBALS['t']['err_comment_interval_num'] = 'Comment interval should be numeric';
-
-// manage/item.tpl
-$GLOBALS['t']['item_title'] = 'Item Title';
-$GLOBALS['t']['item_body'] = 'Item Body';
-$GLOBALS['t']['item_body_more'] = 'Item Body (extended)';
-$GLOBALS['t']['select_image'] = 'Select Image';
-$GLOBALS['t']['view'] = 'view';
-$GLOBALS['t']['add_item'] = 'Add Item';
-$GLOBALS['t']['change_item_desc'] = 'Change Item';
-$GLOBALS['t']['err_item_title'] = 'Item title is required';
-$GLOBALS['t']['err_item_body'] = 'Item body is required';
-$GLOBALS['t']['gallery'] = 'Photos';
-$GLOBALS['t']['allow_comments'] = 'Allow comments';
-$GLOBALS['t']['auto_close_item'] = 'Automatically close item ';
-if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
-    $GLOBALS['t']['auto_close_item'] .= 'after ' . YDConfig::get( 'auto_close_items', '' ) . ' days';
-}
-$GLOBALS['t']['is_draft'] = 'Draft (do not publish)';
-$GLOBALS['t']['draft'] = 'draft';
-$GLOBALS['t']['closed'] = 'closed';
-$GLOBALS['t']['active_items'] = 'active items';
-$GLOBALS['t']['drafts_items'] = 'drafts';
-$GLOBALS['t']['closed_items'] = 'closed items';
-
-// item_gallery.tpl
-$GLOBALS['t']['no_images_yet'] = 'No images yet';
-$GLOBALS['t']['image'] = 'image';
-$GLOBALS['t']['images'] = 'images';
-$GLOBALS['t']['item'] = 'Item';
-$GLOBALS['t']['edit_meta'] = 'metadata';
-
-// manage/index.tpl
-$GLOBALS['t']['latest_items'] = 'Latest items';
-$GLOBALS['t']['overview'] = 'Overview';
-
-// manage/dbbackup.tpl
-$GLOBALS['t']['a_db_backup'] = 'Database backup';
-$GLOBALS['t']['bck_name'] = 'Database backup filename';
-$GLOBALS['t']['gz_compress'] = 'Compress backup using GZip compression';
-$GLOBALS['t']['backup'] = 'Backup';
-$GLOBALS['t']['err_bck_name'] = 'Database backup filename is required';
-$GLOBALS['t']['bck_name_comment'] = 'Use "%%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
-$GLOBALS['t']['bck_type'] = 'Backup type';
-$GLOBALS['t']['bck_full'] = 'Full backup (structure and data)';
-$GLOBALS['t']['bck_structure_only'] = 'Structure only';
-$GLOBALS['t']['bck_data_only'] = 'Data only';
-
-// manage/version_info.tpl
-$GLOBALS['t']['h_diagtools'] = 'Tools';
-$GLOBALS['t']['a_version_info'] = 'Auto Update';
-$GLOBALS['t']['version_check'] = 'Check Version';
-$GLOBALS['t']['installed_version'] = 'Installed version';
-$GLOBALS['t']['development_version'] = 'Development version';
-$GLOBALS['t']['msg_correct_version'] = 'There are no newer versions available';
-$GLOBALS['t']['msg_install_update'] = 'Newer versions are available';
-$GLOBALS['t']['development_changelog'] = 'Development Changelog';
-$GLOBALS['t']['schema_version'] = 'Database schema version';
-$GLOBALS['t']['installed_on'] = 'installed on';
-
-?>
+<?php
+
+// General stuff
+$GLOBALS['t']['not_found'] = 'Not Found';
+$GLOBALS['t']['sorry_not_there'] = 'Sorry, but you are looking for something that isn\'t here.';
+$GLOBALS['t']['sorry_not_found'] = 'Sorry, but you are looking for something that isn\'t here.';
+$GLOBALS['t']['no_items_found'] = 'Sorry, but you are looking for something that isn\'t here.';
+$GLOBALS['t']['by'] = 'by';
+$GLOBALS['t']['required'] = 'required';
+$GLOBALS['t']['login'] = 'Login';
+$GLOBALS['t']['actions'] = 'Actions';
+$GLOBALS['t']['save'] = 'Save';
+$GLOBALS['t']['edit'] = 'edit';
+$GLOBALS['t']['delete'] = 'delete';
+$GLOBALS['t']['previous'] = 'previous';
+$GLOBALS['t']['next'] = 'next';
+$GLOBALS['t']['total'] = 'total';
+$GLOBALS['t']['of'] = 'of';
+$GLOBALS['t']['at'] = 'at';
+$GLOBALS['t']['title'] = 'Title';
+$GLOBALS['t']['install_warning'] = 'You need to remove the install.php and install.tpl files for security reasons!';
+$GLOBALS['t']['home'] = 'Home';
+$GLOBALS['t']['view'] = 'view';
+$GLOBALS['t']['author'] = 'Author';
+$GLOBALS['t']['more'] = 'more';
+$GLOBALS['t']['err_general'] = 'An error occured';
+$GLOBALS['t']['back'] = 'Go back';
+$GLOBALS['t']['yes'] = 'yes';
+$GLOBALS['t']['no'] = 'no';
+$GLOBALS['t']['confirm_action'] = 'Are you sure you want to perform the following action?';
+$GLOBALS['t']['rows'] = 'row(s)';
+$GLOBALS['t']['tables'] = 'Tables';
+$GLOBALS['t']['related_items'] = 'Related items to';
+
+// __std_header.tpl
+$GLOBALS['t']['another_powered_by'] = 'Just another weblog powered by the ' . YD_FW_NAME . '!';
+
+// __std_footer.tpl
+$GLOBALS['t']['or'] = 'or';
+$GLOBALS['t']['powered_by'] = 'This weblog is powered by the';
+$GLOBALS['t']['syndicate_as'] = 'Syndicate this weblog as ';
+$GLOBALS['t']['syndicate_comments_as'] = 'Comments as ';
+$GLOBALS['t']['syndicate_gallery_as'] = 'Galleries as ';
+$GLOBALS['t']['design_by'] = 'Design by Michael Heilemann.';
+
+// __std_sidebar.tpl
+$GLOBALS['t']['weblogs'] = 'Weblogs';
+$GLOBALS['t']['weblog'] = 'Weblog';
+$GLOBALS['t']['pages'] = 'Pages';
+$GLOBALS['t']['page'] = 'Page';
+$GLOBALS['t']['archives'] = 'Archives';
+$GLOBALS['t']['archives_gallery'] = 'Photo Galleries';
+$GLOBALS['t']['categories'] = 'Categories';
+$GLOBALS['t']['view_posts_filed_under'] = 'View all posts filed under';
+$GLOBALS['t']['links'] = 'Links';
+$GLOBALS['t']['link_to'] = 'Link to';
+$GLOBALS['t']['admin'] = 'Admin';
+
+// archive.tpl
+
+// category.tpl
+$GLOBALS['t']['archive_for_the'] = 'Archive for the';
+$GLOBALS['t']['category'] = 'Category';
+
+// index.tpl
+$GLOBALS['t']['posted_in'] = 'posted in';
+$GLOBALS['t']['older_items'] = 'Older posts';
+
+// item.tpl
+$GLOBALS['t']['older_post'] = 'older post';
+$GLOBALS['t']['newer_post'] = 'newer post';
+$GLOBALS['t']['posted_under'] = 'This entry was posted on';
+$GLOBALS['t']['filed_under'] = 'and is filed under';
+$GLOBALS['t']['can_leave_comment'] = 'You can <a href="#respond">leave a comment</a>';
+$GLOBALS['t']['trackback'] = 'trackback';
+$GLOBALS['t']['from_your_site'] = 'from your own site.';
+$GLOBALS['t']['to'] = 'to';
+$GLOBALS['t']['says'] = 'says';
+$GLOBALS['t']['leave_comment'] = 'Leave a comment';
+$GLOBALS['t']['error_comment'] = 'There was a problem adding your comment';
+$GLOBALS['t']['name'] = 'Name';
+$GLOBALS['t']['mail_not_published'] = 'Email (will not be published)';
+$GLOBALS['t']['website'] = 'Website';
+$GLOBALS['t']['submit_comment'] = 'Submit comment';
+$GLOBALS['t']['ta_enter_url'] = 'Enter the url';
+$GLOBALS['t']['ta_enter_email'] = 'Enter the email address';
+$GLOBALS['t']['ta_enter_image'] = 'Enter the full url of the image';
+$GLOBALS['t']['err_name'] = 'Name is missing';
+$GLOBALS['t']['err_name_email'] = 'Name should not be an email address';
+$GLOBALS['t']['err_email'] = 'Email is missing or invalid';
+$GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
+$GLOBALS['t']['err_comment'] = 'Comment is required';
+$GLOBALS['t']['with'] = 'for';
+$GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
+$GLOBALS['t']['spam'] = 'Spam';
+$GLOBALS['t']['no_spam'] = 'No spam';
+$GLOBALS['t']['choose_no_spam'] = 'Choose "no spam" here';
+$GLOBALS['t']['err_userspam'] = 'Detected a spam attack';
+
+// comment_email.tpl
+$GLOBALS['t']['new_comment'] = 'New comment';
+$GLOBALS['t']['item_title'] = 'Item title';
+$GLOBALS['t']['wrote'] = 'wrote';
+
+// item_email.tpl
+$GLOBALS['t']['new_item'] = 'New item';
+
+// page.tpl
+$GLOBALS['t']['created_on'] = 'Created on';
+$GLOBALS['t']['last_modified_on'] = 'Last modified on';
+
+// Comments
+$GLOBALS['t']['no_comments_yet'] = 'No comments yet';
+$GLOBALS['t']['comment'] = 'Comment';
+$GLOBALS['t']['comments'] = 'Comments';
+$GLOBALS['t']['err_name_length'] = 'Name cannot be longer than 35 characters';
+
+// manage/__mng_header.tpl
+$GLOBALS['t']['confirm_delete'] = 'Are you sure you want to delete:';
+$GLOBALS['t']['logoff'] = 'logoff';
+$GLOBALS['t']['view_site'] = 'view site';
+$GLOBALS['t']['user'] = 'user';
+$GLOBALS['t']['server'] = 'Server';
+$GLOBALS['t']['h_shortcuts'] = 'Shortcuts';
+$GLOBALS['t']['a_admin_home'] = 'Admin home';
+$GLOBALS['t']['a_view_site'] = 'View site';
+$GLOBALS['t']['h_contents'] = 'Contents';
+$GLOBALS['t']['a_weblogs'] = 'Weblogs';
+$GLOBALS['t']['a_items'] = 'Items';
+$GLOBALS['t']['a_comments'] = 'Comments';
+$GLOBALS['t']['a_links'] = 'Links';
+$GLOBALS['t']['a_pages'] = 'Pages';
+$GLOBALS['t']['a_images'] = 'Images';
+$GLOBALS['t']['a_categories'] = 'Categories';
+$GLOBALS['t']['h_global_settings'] = 'Global Settings';
+$GLOBALS['t']['a_users'] = 'Users';
+$GLOBALS['t']['a_settings'] = 'Settings';
+$GLOBALS['t']['h_maintenance'] = 'Maintenance';
+$GLOBALS['t']['a_cleanup_cache'] = 'Cache files';
+$GLOBALS['t']['a_server_info'] = 'Server info';
+$GLOBALS['t']['h_statistics'] = 'Statistics';
+$GLOBALS['t']['a_statistics'] = 'Statistics';
+$GLOBALS['t']['h_logoff'] = 'Logoff';
+$GLOBALS['t']['a_logoff'] = 'Logoff';
+
+// manage/login.tpl
+$GLOBALS['t']['username'] = 'User';
+$GLOBALS['t']['password'] = 'Password';
+$GLOBALS['t']['msg_login'] = 'Please enter your username and password';
+$GLOBALS['t']['err_login'] = 'There was a problem logging you in';
+$GLOBALS['t']['err_username'] = 'Username is missing';
+$GLOBALS['t']['err_password'] = 'Password is missing or incorrect';
+$GLOBALS['t']['err_login_all'] = 'Username and/or password are incorrect';
+
+// manage/cache.tpl
+$GLOBALS['t']['cleanup'] = 'Cleanup';
+$GLOBALS['t']['cleanup_cache'] = 'Cleanup cache files';
+$GLOBALS['t']['cache_cleaned_up'] = 'Cache files are cleaned up!';
+
+// manage/serverinfo.tpl
+$GLOBALS['t']['system'] = 'System';
+$GLOBALS['t']['server_name'] = 'Server Name';
+$GLOBALS['t']['server_address'] = 'Server Address';
+$GLOBALS['t']['server_port'] = 'Server Port';
+$GLOBALS['t']['server_software'] = 'Server Software';
+$GLOBALS['t']['operating_system'] = 'Operating System';
+$GLOBALS['t']['version'] = 'version';
+$GLOBALS['t']['loaded_modules'] = 'Loaded modules';
+$GLOBALS['t']['server_api'] = 'Server API';
+$GLOBALS['t']['registered_streams'] = 'Registered PHP streams';
+$GLOBALS['t']['include_path'] = 'Include Path';
+$GLOBALS['t']['full_php_info'] = 'Full PHP information';
+
+// manage/stats.tpl
+$GLOBALS['t']['general_stats'] = 'General statistics';
+$GLOBALS['t']['installed_since'] = 'Installed since';
+$GLOBALS['t']['num_days_online'] = 'Number of days online';
+$GLOBALS['t']['days'] = 'day(s)';
+$GLOBALS['t']['hits'] = 'hit(s)';
+$GLOBALS['t']['no_bots'] = ' (without automatic bots)';
+$GLOBALS['t']['total_hits'] = 'Total number of hits';
+$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['avg_hits_per_day'] = 'Average number of hits per day';
+$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['total_average_stats'] = 'Totals and averages';
+$GLOBALS['t']['hits_last_6_months'] = 'Hits last 6 months';
+$GLOBALS['t']['all_months'] = 'All months';
+$GLOBALS['t']['hits_last_7_days'] = 'Hits last 7 days';
+$GLOBALS['t']['all_days'] = 'All days';
+$GLOBALS['t']['nothing_found'] = 'Nothing found';
+$GLOBALS['t']['top_10_urls'] = 'The 10 most visited URLs';
+$GLOBALS['t']['all_urls'] = 'All URLs';
+$GLOBALS['t']['web_browsers'] = 'Web browsers';
+$GLOBALS['t']['operating_systems'] = 'Operating systems';
+$GLOBALS['t']['other'] = 'Other';
+$GLOBALS['t']['totalitems'] = 'Total number of items';
+$GLOBALS['t']['totalcomments'] = 'Total number of comments';
+$GLOBALS['t']['items'] = 'item(s)';
+$GLOBALS['t']['top_10_commenters'] = 'The 10 most active commenters';
+$GLOBALS['t']['all_commenters'] = 'All commenters';
+$GLOBALS['t']['reset_stats'] = 'Reset all statistics';
+
+// manage/users.tpl
+$GLOBALS['t']['useremail'] = 'Email address';
+$GLOBALS['t']['created'] = 'Created on';
+$GLOBALS['t']['add_user'] = 'Add new user';
+$GLOBALS['t']['req_useremail'] = 'Email address is missing or invalid';
+$GLOBALS['t']['req_loginpass'] = 'Password is required';
+$GLOBALS['t']['user_dup'] = 'User already exists';
+$GLOBALS['t']['change_user_desc'] = 'Changing user:';
+
+// manage/images.tpl
+$GLOBALS['t']['upload_image'] = 'Upload image';
+$GLOBALS['t']['ok'] = 'OK';
+$GLOBALS['t']['size'] = 'Size';
+$GLOBALS['t']['type'] = 'Type';
+$GLOBALS['t']['dimensions'] = 'Dimensions';
+$GLOBALS['t']['no_images_found'] = 'No images were found';
+
+// manage/categories.tpl
+$GLOBALS['t']['add_category'] = 'Add category';
+$GLOBALS['t']['number_of_items'] = 'Number of items';
+$GLOBALS['t']['change_category_desc'] = 'Edit category';
+$GLOBALS['t']['err_category_title'] = 'Category name is required';
+$GLOBALS['t']['err_unique_category'] = 'Category exists already';
+$GLOBALS['t']['no_categories_found'] = 'No categories were found';
+
+// manage/links.tpl
+$GLOBALS['t']['link_title'] = 'Link Title';
+$GLOBALS['t']['link_url'] = 'Link URL';
+$GLOBALS['t']['add_link'] = 'Add link';
+$GLOBALS['t']['err_link_title'] = 'Link title is required';
+$GLOBALS['t']['err_link_url'] = 'Link URL is required';
+$GLOBALS['t']['err_unique_link'] = 'Link URL exists already';
+$GLOBALS['t']['change_link_desc'] = 'Change link';
+$GLOBALS['t']['no_links_found'] = 'No links were found';
+$GLOBALS['t']['num_visits'] = 'Visits';
+
+// manage/pages.tpl
+$GLOBALS['t']['add_page'] = 'Add page';
+$GLOBALS['t']['page_title'] = 'Page title';
+$GLOBALS['t']['page_body'] = 'Page body';
+$GLOBALS['t']['change_page_desc'] = 'Change page';
+$GLOBALS['t']['err_page_title'] = 'Page title is required';
+$GLOBALS['t']['err_page_body'] = 'Page body is required';
+$GLOBALS['t']['no_pages_found'] = 'No pages were found';
+
+// manage/comments.tpl
+$GLOBALS['t']['date'] = 'Date';
+$GLOBALS['t']['parent'] = 'Parent Item';
+$GLOBALS['t']['change_comment_desc'] = 'Change comment';
+$GLOBALS['t']['mail'] = 'Email';
+$GLOBALS['t']['no_comments_found'] = 'No comments were found';
+$GLOBALS['t']['no_spam_comments_found'] = 'No spam comments were found';
+$GLOBALS['t']['posted_from'] = 'Posted from IP address';
+$GLOBALS['t']['a_comments_spam'] = 'Spam comments';
+$GLOBALS['t']['mark_as_spam'] = 'spam';
+$GLOBALS['t']['mark_as_not_spam'] = 'not spam';
+$GLOBALS['t']['is_spam'] = 'Spam comment';
+$GLOBALS['t']['ip_number'] = 'IP number';
+$GLOBALS['t']['spam_delete_desc'] = 'Spam comments are automatically deleted after 7 days.';
+$GLOBALS['t']['confirm_empty_spam'] = 'Are you sure you want to delete all spam comments?';
+$GLOBALS['t']['empty_spam_now'] = 'Delete all spam comments now.';
+$GLOBALS['t']['weight'] = 'Weight';
+
+// manage/config.tpl
+$GLOBALS['t']['cfg_db_settings'] = 'Database Settings';
+$GLOBALS['t']['cfg_db_host'] = 'Database Hostname';
+$GLOBALS['t']['cfg_db_name'] = 'Database Name';
+$GLOBALS['t']['cfg_db_user'] = 'Database Username';
+$GLOBALS['t']['cfg_db_pass'] = 'Database Password';
+$GLOBALS['t']['cfg_weblog_settings'] = 'Weblog Settings';
+$GLOBALS['t']['cfg_weblog_title'] = 'Weblog Title';
+$GLOBALS['t']['cfg_weblog_description'] = 'Weblog Description';
+$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Number of items on the front page';
+$GLOBALS['t']['cfg_weblog_skin'] = 'Weblog skin';
+$GLOBALS['t']['cfg_weblog_language'] = 'Weblog Language';
+$GLOBALS['t']['cfg_weblog_date_format'] = 'Date format';
+$GLOBALS['t']['cfg_notification'] = 'Notification Settings';
+$GLOBALS['t']['cfg_notification_email_comment'] = 'Email new comments';
+$GLOBALS['t']['cfg_notification_email_item'] = 'Email new items to site authors';
+$GLOBALS['t']['cfg_rss'] = 'Syndication Settings';
+$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Number of syndicated items';
+$GLOBALS['t']['err_db_host'] = 'Database Hostname is required';
+$GLOBALS['t']['err_db_name'] = 'Database Name is required';
+$GLOBALS['t']['err_db_user'] = 'Database Username is required';
+$GLOBALS['t']['err_weblog_title'] = 'Weblog Title is required';
+$GLOBALS['t']['err_weblog_entries_fp'] = 'Number of entries on the front page is required';
+$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Number of entries on the front page should be numeric';
+$GLOBALS['t']['err_max_syndicated_items'] = 'Number of syndicated items is required';
+$GLOBALS['t']['err_max_syndicated_items_num'] = 'Number of syndicated items should be numeric';
+$GLOBALS['t']['change_config'] = 'Change';
+$GLOBALS['t']['cfg_db_prefix'] = 'Database table prefix';
+$GLOBALS['t']['cfg_cache'] = 'Caching';
+$GLOBALS['t']['cfg_use_cache_comment'] = 'Cache public pages';
+$GLOBALS['t']['cfg_friendly_urls'] = 'Friendly URLs';
+$GLOBALS['t']['cfg_spam_protection'] = 'Spam protection';
+$GLOBALS['t']['cfg_auto_close_items'] = 'Do not allow comment after x days';
+$GLOBALS['t']['err_auto_close_items'] = 'Do not allow comment after x days should be numeric';
+$GLOBALS['t']['cfg_include_debug_info'] = 'Show debugging information';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Default values for new items';
+$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
+$GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
+$GLOBALS['t']['cfg_keep_stats'] = 'Track statistics';
+$GLOBALS['t']['cfg_blocked_ips'] = 'Blocked IP addresses separated by comma\'s. An asterix can be used as a wildcard.';
+$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">get one here</a>)';
+$GLOBALS['t']['cfg_max_img_size'] = 'Maximum image size';
+$GLOBALS['t']['cfg_comment_interval'] = 'Comment interval in seconds';
+$GLOBALS['t']['err_comment_interval_num'] = 'Comment interval should be numeric';
+
+// manage/item.tpl
+$GLOBALS['t']['item_title'] = 'Item Title';
+$GLOBALS['t']['item_body'] = 'Item Body';
+$GLOBALS['t']['item_body_more'] = 'Item Body (extended)';
+$GLOBALS['t']['select_image'] = 'Select Image';
+$GLOBALS['t']['view'] = 'view';
+$GLOBALS['t']['add_item'] = 'Add Item';
+$GLOBALS['t']['change_item_desc'] = 'Change Item';
+$GLOBALS['t']['err_item_title'] = 'Item title is required';
+$GLOBALS['t']['err_item_body'] = 'Item body is required';
+$GLOBALS['t']['gallery'] = 'Photos';
+$GLOBALS['t']['allow_comments'] = 'Allow comments';
+$GLOBALS['t']['auto_close_item'] = 'Automatically close item ';
+if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
+    $GLOBALS['t']['auto_close_item'] .= 'after ' . YDConfig::get( 'auto_close_items', '' ) . ' days';
+}
+$GLOBALS['t']['is_draft'] = 'Draft (do not publish)';
+$GLOBALS['t']['draft'] = 'draft';
+$GLOBALS['t']['closed'] = 'closed';
+$GLOBALS['t']['active_items'] = 'active items';
+$GLOBALS['t']['drafts_items'] = 'drafts';
+$GLOBALS['t']['closed_items'] = 'closed items';
+
+// item_gallery.tpl
+$GLOBALS['t']['no_images_yet'] = 'No images yet';
+$GLOBALS['t']['image'] = 'image';
+$GLOBALS['t']['images'] = 'images';
+$GLOBALS['t']['item'] = 'Item';
+$GLOBALS['t']['edit_meta'] = 'metadata';
+
+// manage/index.tpl
+$GLOBALS['t']['latest_items'] = 'Latest items';
+$GLOBALS['t']['overview'] = 'Overview';
+
+// manage/dbbackup.tpl
+$GLOBALS['t']['a_db_backup'] = 'Database backup';
+$GLOBALS['t']['bck_name'] = 'Database backup filename';
+$GLOBALS['t']['gz_compress'] = 'Compress backup using GZip compression';
+$GLOBALS['t']['backup'] = 'Backup';
+$GLOBALS['t']['err_bck_name'] = 'Database backup filename is required';
+$GLOBALS['t']['bck_name_comment'] = 'Use "%%DBNAME" for database name and <a href="http://www.php.net/strftime" target="_blank">any strftime options</a> for time specification. The extension will be automagically added. Any other text will be preserved.';
+$GLOBALS['t']['bck_type'] = 'Backup type';
+$GLOBALS['t']['bck_full'] = 'Full backup (structure and data)';
+$GLOBALS['t']['bck_structure_only'] = 'Structure only';
+$GLOBALS['t']['bck_data_only'] = 'Data only';
+
+// manage/version_info.tpl
+$GLOBALS['t']['h_diagtools'] = 'Tools';
+$GLOBALS['t']['a_version_info'] = 'Auto Update';
+$GLOBALS['t']['version_check'] = 'Check Version';
+$GLOBALS['t']['installed_version'] = 'Installed version';
+$GLOBALS['t']['development_version'] = 'Development version';
+$GLOBALS['t']['msg_correct_version'] = 'There are no newer versions available';
+$GLOBALS['t']['msg_install_update'] = 'Newer versions are available';
+$GLOBALS['t']['development_changelog'] = 'Development Changelog';
+$GLOBALS['t']['schema_version'] = 'Database schema version';
+$GLOBALS['t']['installed_on'] = 'installed on';
+
+?>

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-21 08:05:22 UTC (rev 2233)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-21 12:32:35 UTC (rev 2234)
@@ -1,368 +1,369 @@
-<?php
-
-// General stuff
-$GLOBALS['t']['not_found'] = 'Niets gevonden';
-$GLOBALS['t']['sorry_not_there'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
-$GLOBALS['t']['sorry_not_found'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
-$GLOBALS['t']['no_items_found'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
-$GLOBALS['t']['by'] = 'door';
-$GLOBALS['t']['required'] = 'vereist';
-$GLOBALS['t']['login'] = 'Aanmelden';
-$GLOBALS['t']['actions'] = 'Acties';
-$GLOBALS['t']['save'] = 'Bewaar';
-$GLOBALS['t']['edit'] = 'wijzig';
-$GLOBALS['t']['delete'] = 'verwijder';
-$GLOBALS['t']['previous'] = 'vorige';
-$GLOBALS['t']['next'] = 'volgende';
-$GLOBALS['t']['total'] = 'totaal';
-$GLOBALS['t']['of'] = 'van';
-$GLOBALS['t']['at'] = 'op';
-$GLOBALS['t']['title'] = 'Titel';
-$GLOBALS['t']['install_warning'] = 'Je moet de install.php en install.tpl bestanden verwijderen voor veiligheidsredenen!';
-$GLOBALS['t']['home'] = 'Home';
-$GLOBALS['t']['view'] = 'toon';
-$GLOBALS['t']['author'] = 'Auteur';
-$GLOBALS['t']['more'] = 'meer';
-$GLOBALS['t']['err_general'] = 'Er is een probleem';
-$GLOBALS['t']['back'] = 'Ga terug';
-$GLOBALS['t']['yes'] = 'ja';
-$GLOBALS['t']['no'] = 'nee';
-$GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
-$GLOBALS['t']['rows'] = 'rij(en)';
-$GLOBALS['t']['tables'] = 'Tabellen';
-$GLOBALS['t']['related_items'] = 'Gerelateerde items aan';
-
-// __std_header.tpl
-$GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';
-
-// __std_footer.tpl
-$GLOBALS['t']['or'] = 'of';
-$GLOBALS['t']['powered_by'] = 'Deze weblog is aangedreven door het';
-$GLOBALS['t']['syndicate_as'] = 'Syndiceer deze weblog als ';
-$GLOBALS['t']['syndicate_comments_as'] = 'Commentaren als ';
-$GLOBALS['t']['syndicate_gallery_as'] = 'Foto albums als ';
-$GLOBALS['t']['design_by'] = 'Design door Michael Heilemann.';
-
-// __std_sidebar.tpl
-$GLOBALS['t']['weblogs'] = 'Weblogs';
-$GLOBALS['t']['weblog'] = 'Weblog';
-$GLOBALS['t']['pages'] = 'Pagina\'s';
-$GLOBALS['t']['page'] = 'Pagina';
-$GLOBALS['t']['archives'] = 'Archieven';
-$GLOBALS['t']['archives_gallery'] = 'Foto albums';
-$GLOBALS['t']['categories'] = 'Categorie&euml;n';
-$GLOBALS['t']['view_posts_filed_under'] = 'Toon alle posts gecatalogeerd onder';
-$GLOBALS['t']['links'] = 'Links';
-$GLOBALS['t']['link_to'] = 'Link naar';
-$GLOBALS['t']['admin'] = 'Admin';
-
-// archive.tpl
-
-// category.tpl
-$GLOBALS['t']['archive_for_the'] = 'Archief voor de ';
-$GLOBALS['t']['category'] = 'Categorie';
-
-// index.tpl
-$GLOBALS['t']['posted_in'] = 'gepost in';
-$GLOBALS['t']['older_items'] = 'Oudere posts';
-
-// item.tpl
-$GLOBALS['t']['older_post'] = 'oudere post';
-$GLOBALS['t']['newer_post'] = 'nieuwere post';
-$GLOBALS['t']['posted_under'] = 'Dit artikel werd gepost op';
-$GLOBALS['t']['filed_under'] = 'en is gecatalogeerd onder';
-$GLOBALS['t']['can_leave_comment'] = 'Je kan <a href="#respond">een commentaar nalaten</a>';
-$GLOBALS['t']['trackback'] = 'trackback';
-$GLOBALS['t']['from_your_site'] = 'van je eigen site.';
-$GLOBALS['t']['to'] = 'op';
-$GLOBALS['t']['says'] = 'zegt';
-$GLOBALS['t']['leave_comment'] = 'Laat een commentaar na';
-$GLOBALS['t']['error_comment'] = 'Er was een probleem om je commentaar toe te voegen';
-$GLOBALS['t']['name'] = 'Naam';
-$GLOBALS['t']['mail_not_published'] = 'Mail (wordt niet gepubliceerd)';
-$GLOBALS['t']['website'] = 'Website';
-$GLOBALS['t']['submit_comment'] = 'Voeg commentaar toe';
-$GLOBALS['t']['ta_enter_url'] = 'Geef de URL in';
-$GLOBALS['t']['ta_enter_email'] = 'Geef het email adres in';
-$GLOBALS['t']['ta_enter_image'] = 'Geef de volledige URL naar het beeld in';
-$GLOBALS['t']['err_name'] = 'Naam is niet ingegeven';
-$GLOBALS['t']['err_name_email'] = 'Naam mag geen email adres zijn';
-$GLOBALS['t']['err_email'] = 'Email is niet ingegeven of niet correct';
-$GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
-$GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
-$GLOBALS['t']['with'] = 'bij';
-$GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
-$GLOBALS['t']['spam'] = 'Spam';
-$GLOBALS['t']['no_spam'] = 'Geen spam';
-$GLOBALS['t']['choose_no_spam'] = 'Kies hier "geen spam"';
-$GLOBALS['t']['err_userspam'] = 'Detecteerde een spam aanval';
-
-// comment_email.tpl
-$GLOBALS['t']['new_comment'] = 'Nieuw commentaar';
-$GLOBALS['t']['item_title'] = 'Item titel';
-$GLOBALS['t']['wrote'] = 'schreef';
-
-// item_email.tpl
-$GLOBALS['t']['new_item'] = 'Nieuw item';
-
-// page.tpl
-$GLOBALS['t']['created_on'] = 'Aangemaakt op';
-$GLOBALS['t']['last_modified_on'] = 'Laatst aangepast op';
-
-// Comments
-$GLOBALS['t']['no_comments_yet'] = 'Nog geen commentaren';
-$GLOBALS['t']['comment'] = 'Commentaar';
-$GLOBALS['t']['comments'] = 'Commentaren';
-$GLOBALS['t']['err_name_length'] = 'Naam kan niet langer zijn dan 35 karakters';
-
-// manage/__mng_header.tpl
-$GLOBALS['t']['confirm_delete'] = 'Bent u zeker dat u het volgende wil verwijderen:';
-$GLOBALS['t']['logoff'] = 'afmelden';
-$GLOBALS['t']['view_site'] = 'toon site';
-$GLOBALS['t']['user'] = 'gebruiker';
-$GLOBALS['t']['server'] = 'Server';
-$GLOBALS['t']['h_shortcuts'] = 'Snelkoppelingen';
-$GLOBALS['t']['a_admin_home'] = 'Admin home';
-$GLOBALS['t']['a_view_site'] = 'Toon site';
-$GLOBALS['t']['h_contents'] = 'Inhoud';
-$GLOBALS['t']['a_weblogs'] = 'Weblogs';
-$GLOBALS['t']['a_items'] = 'Items';
-$GLOBALS['t']['a_comments'] = 'Commentaren';
-$GLOBALS['t']['a_links'] = 'Links';
-$GLOBALS['t']['a_pages'] = 'Pagina\'s';
-$GLOBALS['t']['a_images'] = 'Beelden';
-$GLOBALS['t']['a_categories'] = 'Categorie&euml;n';
-$GLOBALS['t']['h_global_settings'] = 'Algemene instellingen';
-$GLOBALS['t']['a_users'] = 'Gebruikers';
-$GLOBALS['t']['a_settings'] = 'Instellingen';
-$GLOBALS['t']['h_maintenance'] = 'Onderhoud';
-$GLOBALS['t']['a_cleanup_cache'] = 'Cache bestanden';
-$GLOBALS['t']['a_server_info'] = 'Server info';
-$GLOBALS['t']['h_statistics'] = 'Statistieken';
-$GLOBALS['t']['a_statistics'] = 'Statistieken';
-$GLOBALS['t']['h_logoff'] = 'Afmelden';
-$GLOBALS['t']['a_logoff'] = 'Afmelden';
-
-// manage/login.tpl
-$GLOBALS['t']['username'] = 'Gebruiker';
-$GLOBALS['t']['password'] = 'Paswoord';
-$GLOBALS['t']['msg_login'] = 'Gelieve je gebruikersnaam en paswoord in te geven';
-$GLOBALS['t']['err_login'] = 'Er was een probleem om je aan te melden';
-$GLOBALS['t']['err_username'] = 'Gebruikersnaam is niet ingegeven';
-$GLOBALS['t']['err_password'] = 'Paswoord is niet ingegeven of foutief';
-$GLOBALS['t']['err_login_all'] = 'Gebruikersnaam en/of paswoord zijn foutief';
-
-// manage/cache.tpl
-$GLOBALS['t']['cleanup'] = 'Verwijder';
-$GLOBALS['t']['cleanup_cache'] = 'Verwijder cache bestanden';
-$GLOBALS['t']['cache_cleaned_up'] = 'De cache bestanden zijn verwijderd!';
-
-// manage/serverinfo.tpl
-$GLOBALS['t']['system'] = 'System';
-$GLOBALS['t']['server_name'] = 'Server Naam';
-$GLOBALS['t']['server_address'] = 'Server Adres';
-$GLOBALS['t']['server_port'] = 'Server Poort';
-$GLOBALS['t']['server_software'] = 'Server Software';
-$GLOBALS['t']['operating_system'] = 'Besturingssysteem';
-$GLOBALS['t']['version'] = 'versie';
-$GLOBALS['t']['loaded_modules'] = 'Geladen modules';
-$GLOBALS['t']['server_api'] = 'Server API';
-$GLOBALS['t']['registered_streams'] = 'Geregistreerde PHP streams';
-$GLOBALS['t']['include_path'] = 'Include Path';
-$GLOBALS['t']['full_php_info'] = 'Volledige PHP informatie';
-
-// manage/stats.tpl
-$GLOBALS['t']['general_stats'] = 'Algemene Statistieken';
-$GLOBALS['t']['installed_since'] = 'Ge&iuml;nstalleerd sinds';
-$GLOBALS['t']['num_days_online'] = 'Aantal dagen online';
-$GLOBALS['t']['days'] = 'dag(en)';
-$GLOBALS['t']['hits'] = 'hit(s)';
-$GLOBALS['t']['no_bots'] = ' (zonder automatic bots)';
-$GLOBALS['t']['total_hits'] = 'Totaal aantal hits';
-$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
-$GLOBALS['t']['avg_hits_per_day'] = 'Gemiddeld aantal hits per dag';
-$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
-$GLOBALS['t']['hits_last_6_months'] = 'Hits van de laatste 6 maanden';
-$GLOBALS['t']['total_average_stats'] = 'Totalen en gemiddelden';
-$GLOBALS['t']['all_months'] = 'Alle maanden';
-$GLOBALS['t']['hits_last_7_days'] = 'Hits laatste 7 dagen';
-$GLOBALS['t']['all_days'] = 'Alle dagen';
-$GLOBALS['t']['nothing_found'] = 'Niets gevonden';
-$GLOBALS['t']['top_10_urls'] = 'De 10 meest bekeken URLs';
-$GLOBALS['t']['all_urls'] = 'Alle URLs';
-$GLOBALS['t']['web_browsers'] = 'Web browsers';
-$GLOBALS['t']['operating_systems'] = 'Besturingssystemen';
-$GLOBALS['t']['other'] = 'Andere';
-$GLOBALS['t']['totalitems'] = 'Totaal aantal items';
-$GLOBALS['t']['totalcomments'] = 'Totaal aantal commentaren';
-$GLOBALS['t']['items'] = 'item(s)';
-$GLOBALS['t']['top_10_commenters'] = 'De 10 meest actieve commentators';
-$GLOBALS['t']['all_commenters'] = 'Alle commentators';
-$GLOBALS['t']['reset_stats'] = 'Reset alle statistieken';
-
-// manage/users.tpl
-$GLOBALS['t']['useremail'] = 'Email adres';
-$GLOBALS['t']['created'] = 'Aangemaakt op';
-$GLOBALS['t']['add_user'] = 'Voeg nieuwe gebruiker toe';
-$GLOBALS['t']['req_useremail'] = 'Email address ontbreekt of is incorrect';
-$GLOBALS['t']['req_loginpass'] = 'Paswoord is vereist';
-$GLOBALS['t']['user_dup'] = 'Gebruiker bestaat al';
-$GLOBALS['t']['change_user_desc'] = 'Wijzig gebruiker:';
-
-// manage/images.tpl
-$GLOBALS['t']['upload_image'] = 'Upload beeld';
-$GLOBALS['t']['ok'] = 'OK';
-$GLOBALS['t']['size'] = 'Grootte';
-$GLOBALS['t']['type'] = 'Type';
-$GLOBALS['t']['dimensions'] = 'Afmetingen';
-$GLOBALS['t']['no_images_found'] = 'Er werden geen beelden gevonden';
-
-// manage/categories.tpl
-$GLOBALS['t']['add_category'] = 'Voeg categorie toe';
-$GLOBALS['t']['number_of_items'] = 'Aantal items';
-$GLOBALS['t']['change_category_desc'] = 'Wijzig categorie';
-$GLOBALS['t']['err_category_title'] = 'Naam van de categorie ontbreekt';
-$GLOBALS['t']['err_unique_category'] = 'Categorie bestaat al';
-$GLOBALS['t']['no_categories_found'] = 'Er werden geen categorie&euml;n gevonden';
-
-// manage/links.tpl
-$GLOBALS['t']['link_title'] = 'Link Titel';
-$GLOBALS['t']['link_url'] = 'Link URL';
-$GLOBALS['t']['add_link'] = 'Voeg link toe';
-$GLOBALS['t']['err_link_title'] = 'Titel van de link is vereist';
-$GLOBALS['t']['err_link_url'] = 'URL van de link is vereist';
-$GLOBALS['t']['err_unique_link'] = 'Link URL bestaat al';
-$GLOBALS['t']['change_link_desc'] = 'Wijzig link';
-$GLOBALS['t']['no_links_found'] = 'Er werden geen links gevonden';
-$GLOBALS['t']['num_visits'] = 'Visits';
-
-// manage/pages.tpl
-$GLOBALS['t']['add_page'] = 'Voeg pagina toe';
-$GLOBALS['t']['page_title'] = 'Pagina titel';
-$GLOBALS['t']['page_body'] = 'Pagina inhoud';
-$GLOBALS['t']['change_page_desc'] = 'Wijzig pagina';
-$GLOBALS['t']['err_page_title'] = 'Pagina titel is vereist';
-$GLOBALS['t']['err_page_body'] = 'Pagina inhoud is vereist';
-$GLOBALS['t']['no_pages_found'] = 'Er werden geen pagina\'s gevonden';
-
-// manage/comments.tpl
-$GLOBALS['t']['date'] = 'Datum';
-$GLOBALS['t']['parent'] = 'Bovenliggend Item';
-$GLOBALS['t']['change_comment_desc'] = 'Wijzig commentaar';
-$GLOBALS['t']['mail'] = 'Email';
-$GLOBALS['t']['no_comments_found'] = 'Er werden geen commentaren gevonden';
-$GLOBALS['t']['no_spam_comments_found'] = 'Er werden geen spam commentaren gevonden';
-$GLOBALS['t']['posted_from'] = 'Gepost van het IP adres';
-$GLOBALS['t']['a_comments_spam'] = 'Spam commentaren';
-$GLOBALS['t']['mark_as_spam'] = 'markeer als spam';
-$GLOBALS['t']['mark_as_not_spam'] = 'markeer als niet spam';
-$GLOBALS['t']['is_spam'] = 'Spam commentaar';
-$GLOBALS['t']['ip_number'] = 'IP nummer';
-$GLOBALS['t']['spam_delete_desc'] = 'Spam commentaren worden automatisch verwijderd na 7 dagen.';
-$GLOBALS['t']['confirm_empty_spam'] = 'Bent u zeker dat u alle spam commentaren wil verwijderen?';
-$GLOBALS['t']['empty_spam_now'] = 'Verwijder nu alle spam commentaren.';
-
-// manage/config.tpl
-$GLOBALS['t']['cfg_db_settings'] = 'Database Instellingen';
-$GLOBALS['t']['cfg_db_host'] = 'Database Hostnaam';
-$GLOBALS['t']['cfg_db_name'] = 'Database Naam';
-$GLOBALS['t']['cfg_db_user'] = 'Database Gebruiker';
-$GLOBALS['t']['cfg_db_pass'] = 'Database Paswoord';
-$GLOBALS['t']['cfg_weblog_settings'] = 'Weblog Instellingen';
-$GLOBALS['t']['cfg_weblog_title'] = 'Weblog Titel';
-$GLOBALS['t']['cfg_weblog_description'] = 'Weblog Beschrijving';
-$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Aantal items op de voorpagina';
-$GLOBALS['t']['cfg_weblog_skin'] = 'Weblog skin';
-$GLOBALS['t']['cfg_weblog_language'] = 'Weblog Taal';
-$GLOBALS['t']['cfg_weblog_date_format'] = 'Datum formaat';
-$GLOBALS['t']['cfg_notification'] = 'Notificatie Instellingen';
-$GLOBALS['t']['cfg_notification_email_comment'] = 'Email nieuwe commentaren';
-$GLOBALS['t']['cfg_notification_email_item'] = 'Email niewe items naar de site auteurs';
-$GLOBALS['t']['cfg_rss'] = 'Syndicatie Instellingen';
-$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Aantal gesyndiceerde items';
-$GLOBALS['t']['err_db_host'] = 'Database Hostnaam is vereist';
-$GLOBALS['t']['err_db_name'] = 'Database Naam is vereist';
-$GLOBALS['t']['err_db_user'] = 'Database Gebruiker is vereist';
-$GLOBALS['t']['err_weblog_title'] = 'Weblog Titel is vereist';
-$GLOBALS['t']['err_weblog_entries_fp'] = 'Aantal items op de voorpagina is vereist';
-$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Aantal items op de voorpagina moet een getal zijn';
-$GLOBALS['t']['err_max_syndicated_items'] = 'Aantal gesyndiceerde items is vereist';
-$GLOBALS['t']['err_max_syndicated_items_num'] = 'Aantal gesyndiceerde items moet een getal zijn';
-$GLOBALS['t']['change_config'] = 'Wijzig';
-$GLOBALS['t']['cfg_db_prefix'] = 'Database tabel prefix';
-$GLOBALS['t']['cfg_cache'] = 'Caching';
-$GLOBALS['t']['cfg_use_cache_comment'] = 'Cache publieke pagina\'s';
-$GLOBALS['t']['cfg_friendly_urls'] = 'Vriendelijke URLs';
-$GLOBALS['t']['cfg_spam_protection'] = 'Beveiliging tegen spam';
-$GLOBALS['t']['cfg_auto_close_items'] = 'Laat geen commentaren toe na x dagen';
-$GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
-$GLOBALS['t']['cfg_include_debug_info'] = 'Toon debugging informatie';
-$GLOBALS['t']['cfg_default_item_settings'] = 'Standaard waardes voor nieuwe posts';
-$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
-$GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
-$GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
-$GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
-$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">hier te verkrijgen</a>)';
-$GLOBALS['t']['cfg_max_img_size'] = 'Maximale beeldgrootte';
-$GLOBALS['t']['cfg_comment_interval'] = 'Commentaar interval in seconden';
-$GLOBALS['t']['err_comment_interval_num'] = 'Commentaar interval moet een getal zijn';
-
-// manage/item.tpl
-$GLOBALS['t']['item_title'] = 'Item Titel';
-$GLOBALS['t']['item_body'] = 'Item Inhoud';
-$GLOBALS['t']['item_body_more'] = 'Item Inhoud (uitgebreid)';
-$GLOBALS['t']['select_image'] = 'Selecteer Beeld';
-$GLOBALS['t']['view'] = 'toon';
-$GLOBALS['t']['add_item'] = 'Voeg item toe';
-$GLOBALS['t']['change_item_desc'] = 'Wijzig Item';
-$GLOBALS['t']['err_item_title'] = 'Item titel is vereist';
-$GLOBALS['t']['err_item_body'] = 'Item inhoud is vereist';
-$GLOBALS['t']['gallery'] = 'Foto\'s';
-$GLOBALS['t']['allow_comments'] = 'Laat commentaren toe';
-$GLOBALS['t']['auto_close_item'] = 'Sluit item automatisch ';
-if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
-    $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
-}
-$GLOBALS['t']['is_draft'] = 'Concept (niet publiceren)';
-$GLOBALS['t']['draft'] = 'concept';
-$GLOBALS['t']['closed'] = 'gesloten';
-$GLOBALS['t']['active_items'] = 'actieve items';
-$GLOBALS['t']['drafts_items'] = 'concepten';
-$GLOBALS['t']['closed_items'] = 'gesloten items';
-
-// item_gallery.tpl
-$GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';
-$GLOBALS['t']['image'] = 'foto';
-$GLOBALS['t']['images'] = 'foto\'s';
-$GLOBALS['t']['item'] = 'Item';
-$GLOBALS['t']['edit_meta'] = 'informatie';
-
-// manage/index.tpl
-$GLOBALS['t']['latest_items'] = 'Laatste items';
-$GLOBALS['t']['overview'] = 'Overzicht';
-
-// manage/dbbackup.tpl
-$GLOBALS['t']['a_db_backup'] = 'Databank backup';
-$GLOBALS['t']['bck_name'] = 'Databank backup bestandsnaam';
-$GLOBALS['t']['gz_compress'] = 'Comprimeer backup met GZip compressie';
-$GLOBALS['t']['backup'] = 'Backup';
-$GLOBALS['t']['err_bck_name'] = 'Databank backup bestandsnaam is vereist';
-$GLOBALS['t']['bck_name_comment'] = 'Gebruik "%%DBNAME" voor de databank naam en <a href="http://www.php.net/strftime" target="_blank">gelijk welke strftime optie</a> voor de tijdsaanduiding. De extensie wordt automatisch toegevoegd. Alle andere tekst wordt behouden.';
-$GLOBALS['t']['bck_type'] = 'Backup type';
-$GLOBALS['t']['bck_full'] = 'Volledige backup (structuur en data)';
-$GLOBALS['t']['bck_structure_only'] = 'Enkel de structuur';
-$GLOBALS['t']['bck_data_only'] = 'Enkel de data';
-
-// manage/version_info.tpl
-$GLOBALS['t']['h_diagtools'] = 'Tools';
-$GLOBALS['t']['a_version_info'] = 'Auto Update';
-$GLOBALS['t']['version_check'] = 'Controleer Versie';
-$GLOBALS['t']['installed_version'] = 'Ge&iuml;nstalleerde versie';
-$GLOBALS['t']['development_version'] = 'Ontwikkel versie';
-$GLOBALS['t']['msg_correct_version'] = 'Er zijn geen nieuwere versies beschikbaar';
-$GLOBALS['t']['msg_install_update'] = 'Er zijn nieuwe versies beschikbaar';
-$GLOBALS['t']['development_changelog'] = 'Ontwikkel Logboek';
-$GLOBALS['t']['schema_version'] = 'Database schema versie';
-$GLOBALS['t']['installed_on'] = 'ge&iuml;nstalleerd op';
-
-?>
+<?php
+
+// General stuff
+$GLOBALS['t']['not_found'] = 'Niets gevonden';
+$GLOBALS['t']['sorry_not_there'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
+$GLOBALS['t']['sorry_not_found'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
+$GLOBALS['t']['no_items_found'] = 'Sorry, maar je bent iets aan het zoeken dat er niet is.';
+$GLOBALS['t']['by'] = 'door';
+$GLOBALS['t']['required'] = 'vereist';
+$GLOBALS['t']['login'] = 'Aanmelden';
+$GLOBALS['t']['actions'] = 'Acties';
+$GLOBALS['t']['save'] = 'Bewaar';
+$GLOBALS['t']['edit'] = 'wijzig';
+$GLOBALS['t']['delete'] = 'verwijder';
+$GLOBALS['t']['previous'] = 'vorige';
+$GLOBALS['t']['next'] = 'volgende';
+$GLOBALS['t']['total'] = 'totaal';
+$GLOBALS['t']['of'] = 'van';
+$GLOBALS['t']['at'] = 'op';
+$GLOBALS['t']['title'] = 'Titel';
+$GLOBALS['t']['install_warning'] = 'Je moet de install.php en install.tpl bestanden verwijderen voor veiligheidsredenen!';
+$GLOBALS['t']['home'] = 'Home';
+$GLOBALS['t']['view'] = 'toon';
+$GLOBALS['t']['author'] = 'Auteur';
+$GLOBALS['t']['more'] = 'meer';
+$GLOBALS['t']['err_general'] = 'Er is een probleem';
+$GLOBALS['t']['back'] = 'Ga terug';
+$GLOBALS['t']['yes'] = 'ja';
+$GLOBALS['t']['no'] = 'nee';
+$GLOBALS['t']['confirm_action'] = 'Bent u zeker dat u de volgende actie wil uitvoeren?';
+$GLOBALS['t']['rows'] = 'rij(en)';
+$GLOBALS['t']['tables'] = 'Tabellen';
+$GLOBALS['t']['related_items'] = 'Gerelateerde items aan';
+
+// __std_header.tpl
+$GLOBALS['t']['another_powered_by'] = 'Weer een weblog aangedreven door het ' . YD_FW_NAME . '!';
+
+// __std_footer.tpl
+$GLOBALS['t']['or'] = 'of';
+$GLOBALS['t']['powered_by'] = 'Deze weblog is aangedreven door het';
+$GLOBALS['t']['syndicate_as'] = 'Syndiceer deze weblog als ';
+$GLOBALS['t']['syndicate_comments_as'] = 'Commentaren als ';
+$GLOBALS['t']['syndicate_gallery_as'] = 'Foto albums als ';
+$GLOBALS['t']['design_by'] = 'Design door Michael Heilemann.';
+
+// __std_sidebar.tpl
+$GLOBALS['t']['weblogs'] = 'Weblogs';
+$GLOBALS['t']['weblog'] = 'Weblog';
+$GLOBALS['t']['pages'] = 'Pagina\'s';
+$GLOBALS['t']['page'] = 'Pagina';
+$GLOBALS['t']['archives'] = 'Archieven';
+$GLOBALS['t']['archives_gallery'] = 'Foto albums';
+$GLOBALS['t']['categories'] = 'Categorie&euml;n';
+$GLOBALS['t']['view_posts_filed_under'] = 'Toon alle posts gecatalogeerd onder';
+$GLOBALS['t']['links'] = 'Links';
+$GLOBALS['t']['link_to'] = 'Link naar';
+$GLOBALS['t']['admin'] = 'Admin';
+
+// archive.tpl
+
+// category.tpl
+$GLOBALS['t']['archive_for_the'] = 'Archief voor de ';
+$GLOBALS['t']['category'] = 'Categorie';
+
+// index.tpl
+$GLOBALS['t']['posted_in'] = 'gepost in';
+$GLOBALS['t']['older_items'] = 'Oudere posts';
+
+// item.tpl
+$GLOBALS['t']['older_post'] = 'oudere post';
+$GLOBALS['t']['newer_post'] = 'nieuwere post';
+$GLOBALS['t']['posted_under'] = 'Dit artikel werd gepost op';
+$GLOBALS['t']['filed_under'] = 'en is gecatalogeerd onder';
+$GLOBALS['t']['can_leave_comment'] = 'Je kan <a href="#respond">een commentaar nalaten</a>';
+$GLOBALS['t']['trackback'] = 'trackback';
+$GLOBALS['t']['from_your_site'] = 'van je eigen site.';
+$GLOBALS['t']['to'] = 'op';
+$GLOBALS['t']['says'] = 'zegt';
+$GLOBALS['t']['leave_comment'] = 'Laat een commentaar na';
+$GLOBALS['t']['error_comment'] = 'Er was een probleem om je commentaar toe te voegen';
+$GLOBALS['t']['name'] = 'Naam';
+$GLOBALS['t']['mail_not_published'] = 'Mail (wordt niet gepubliceerd)';
+$GLOBALS['t']['website'] = 'Website';
+$GLOBALS['t']['submit_comment'] = 'Voeg commentaar toe';
+$GLOBALS['t']['ta_enter_url'] = 'Geef de URL in';
+$GLOBALS['t']['ta_enter_email'] = 'Geef het email adres in';
+$GLOBALS['t']['ta_enter_image'] = 'Geef de volledige URL naar het beeld in';
+$GLOBALS['t']['err_name'] = 'Naam is niet ingegeven';
+$GLOBALS['t']['err_name_email'] = 'Naam mag geen email adres zijn';
+$GLOBALS['t']['err_email'] = 'Email is niet ingegeven of niet correct';
+$GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
+$GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
+$GLOBALS['t']['with'] = 'bij';
+$GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
+$GLOBALS['t']['spam'] = 'Spam';
+$GLOBALS['t']['no_spam'] = 'Geen spam';
+$GLOBALS['t']['choose_no_spam'] = 'Kies hier "geen spam"';
+$GLOBALS['t']['err_userspam'] = 'Detecteerde een spam aanval';
+
+// comment_email.tpl
+$GLOBALS['t']['new_comment'] = 'Nieuw commentaar';
+$GLOBALS['t']['item_title'] = 'Item titel';
+$GLOBALS['t']['wrote'] = 'schreef';
+
+// item_email.tpl
+$GLOBALS['t']['new_item'] = 'Nieuw item';
+
+// page.tpl
+$GLOBALS['t']['created_on'] = 'Aangemaakt op';
+$GLOBALS['t']['last_modified_on'] = 'Laatst aangepast op';
+
+// Comments
+$GLOBALS['t']['no_comments_yet'] = 'Nog geen commentaren';
+$GLOBALS['t']['comment'] = 'Commentaar';
+$GLOBALS['t']['comments'] = 'Commentaren';
+$GLOBALS['t']['err_name_length'] = 'Naam kan niet langer zijn dan 35 karakters';
+
+// manage/__mng_header.tpl
+$GLOBALS['t']['confirm_delete'] = 'Bent u zeker dat u het volgende wil verwijderen:';
+$GLOBALS['t']['logoff'] = 'afmelden';
+$GLOBALS['t']['view_site'] = 'toon site';
+$GLOBALS['t']['user'] = 'gebruiker';
+$GLOBALS['t']['server'] = 'Server';
+$GLOBALS['t']['h_shortcuts'] = 'Snelkoppelingen';
+$GLOBALS['t']['a_admin_home'] = 'Admin home';
+$GLOBALS['t']['a_view_site'] = 'Toon site';
+$GLOBALS['t']['h_contents'] = 'Inhoud';
+$GLOBALS['t']['a_weblogs'] = 'Weblogs';
+$GLOBALS['t']['a_items'] = 'Items';
+$GLOBALS['t']['a_comments'] = 'Commentaren';
+$GLOBALS['t']['a_links'] = 'Links';
+$GLOBALS['t']['a_pages'] = 'Pagina\'s';
+$GLOBALS['t']['a_images'] = 'Beelden';
+$GLOBALS['t']['a_categories'] = 'Categorie&euml;n';
+$GLOBALS['t']['h_global_settings'] = 'Algemene instellingen';
+$GLOBALS['t']['a_users'] = 'Gebruikers';
+$GLOBALS['t']['a_settings'] = 'Instellingen';
+$GLOBALS['t']['h_maintenance'] = 'Onderhoud';
+$GLOBALS['t']['a_cleanup_cache'] = 'Cache bestanden';
+$GLOBALS['t']['a_server_info'] = 'Server info';
+$GLOBALS['t']['h_statistics'] = 'Statistieken';
+$GLOBALS['t']['a_statistics'] = 'Statistieken';
+$GLOBALS['t']['h_logoff'] = 'Afmelden';
+$GLOBALS['t']['a_logoff'] = 'Afmelden';
+
+// manage/login.tpl
+$GLOBALS['t']['username'] = 'Gebruiker';
+$GLOBALS['t']['password'] = 'Paswoord';
+$GLOBALS['t']['msg_login'] = 'Gelieve je gebruikersnaam en paswoord in te geven';
+$GLOBALS['t']['err_login'] = 'Er was een probleem om je aan te melden';
+$GLOBALS['t']['err_username'] = 'Gebruikersnaam is niet ingegeven';
+$GLOBALS['t']['err_password'] = 'Paswoord is niet ingegeven of foutief';
+$GLOBALS['t']['err_login_all'] = 'Gebruikersnaam en/of paswoord zijn foutief';
+
+// manage/cache.tpl
+$GLOBALS['t']['cleanup'] = 'Verwijder';
+$GLOBALS['t']['cleanup_cache'] = 'Verwijder cache bestanden';
+$GLOBALS['t']['cache_cleaned_up'] = 'De cache bestanden zijn verwijderd!';
+
+// manage/serverinfo.tpl
+$GLOBALS['t']['system'] = 'System';
+$GLOBALS['t']['server_name'] = 'Server Naam';
+$GLOBALS['t']['server_address'] = 'Server Adres';
+$GLOBALS['t']['server_port'] = 'Server Poort';
+$GLOBALS['t']['server_software'] = 'Server Software';
+$GLOBALS['t']['operating_system'] = 'Besturingssysteem';
+$GLOBALS['t']['version'] = 'versie';
+$GLOBALS['t']['loaded_modules'] = 'Geladen modules';
+$GLOBALS['t']['server_api'] = 'Server API';
+$GLOBALS['t']['registered_streams'] = 'Geregistreerde PHP streams';
+$GLOBALS['t']['include_path'] = 'Include Path';
+$GLOBALS['t']['full_php_info'] = 'Volledige PHP informatie';
+
+// manage/stats.tpl
+$GLOBALS['t']['general_stats'] = 'Algemene Statistieken';
+$GLOBALS['t']['installed_since'] = 'Ge&iuml;nstalleerd sinds';
+$GLOBALS['t']['num_days_online'] = 'Aantal dagen online';
+$GLOBALS['t']['days'] = 'dag(en)';
+$GLOBALS['t']['hits'] = 'hit(s)';
+$GLOBALS['t']['no_bots'] = ' (zonder automatic bots)';
+$GLOBALS['t']['total_hits'] = 'Totaal aantal hits';
+$GLOBALS['t']['total_hits_no_bots'] = $GLOBALS['t']['total_hits'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['avg_hits_per_day'] = 'Gemiddeld aantal hits per dag';
+$GLOBALS['t']['avg_hits_per_day_no_bots'] = $GLOBALS['t']['avg_hits_per_day'] . $GLOBALS['t']['no_bots'];
+$GLOBALS['t']['hits_last_6_months'] = 'Hits van de laatste 6 maanden';
+$GLOBALS['t']['total_average_stats'] = 'Totalen en gemiddelden';
+$GLOBALS['t']['all_months'] = 'Alle maanden';
+$GLOBALS['t']['hits_last_7_days'] = 'Hits laatste 7 dagen';
+$GLOBALS['t']['all_days'] = 'Alle dagen';
+$GLOBALS['t']['nothing_found'] = 'Niets gevonden';
+$GLOBALS['t']['top_10_urls'] = 'De 10 meest bekeken URLs';
+$GLOBALS['t']['all_urls'] = 'Alle URLs';
+$GLOBALS['t']['web_browsers'] = 'Web browsers';
+$GLOBALS['t']['operating_systems'] = 'Besturingssystemen';
+$GLOBALS['t']['other'] = 'Andere';
+$GLOBALS['t']['totalitems'] = 'Totaal aantal items';
+$GLOBALS['t']['totalcomments'] = 'Totaal aantal commentaren';
+$GLOBALS['t']['items'] = 'item(s)';
+$GLOBALS['t']['top_10_commenters'] = 'De 10 meest actieve commentators';
+$GLOBALS['t']['all_commenters'] = 'Alle commentators';
+$GLOBALS['t']['reset_stats'] = 'Reset alle statistieken';
+
+// manage/users.tpl
+$GLOBALS['t']['useremail'] = 'Email adres';
+$GLOBALS['t']['created'] = 'Aangemaakt op';
+$GLOBALS['t']['add_user'] = 'Voeg nieuwe gebruiker toe';
+$GLOBALS['t']['req_useremail'] = 'Email address ontbreekt of is incorrect';
+$GLOBALS['t']['req_loginpass'] = 'Paswoord is vereist';
+$GLOBALS['t']['user_dup'] = 'Gebruiker bestaat al';
+$GLOBALS['t']['change_user_desc'] = 'Wijzig gebruiker:';
+
+// manage/images.tpl
+$GLOBALS['t']['upload_image'] = 'Upload beeld';
+$GLOBALS['t']['ok'] = 'OK';
+$GLOBALS['t']['size'] = 'Grootte';
+$GLOBALS['t']['type'] = 'Type';
+$GLOBALS['t']['dimensions'] = 'Afmetingen';
+$GLOBALS['t']['no_images_found'] = 'Er werden geen beelden gevonden';
+
+// manage/categories.tpl
+$GLOBALS['t']['add_category'] = 'Voeg categorie toe';
+$GLOBALS['t']['number_of_items'] = 'Aantal items';
+$GLOBALS['t']['change_category_desc'] = 'Wijzig categorie';
+$GLOBALS['t']['err_category_title'] = 'Naam van de categorie ontbreekt';
+$GLOBALS['t']['err_unique_category'] = 'Categorie bestaat al';
+$GLOBALS['t']['no_categories_found'] = 'Er werden geen categorie&euml;n gevonden';
+
+// manage/links.tpl
+$GLOBALS['t']['link_title'] = 'Link Titel';
+$GLOBALS['t']['link_url'] = 'Link URL';
+$GLOBALS['t']['add_link'] = 'Voeg link toe';
+$GLOBALS['t']['err_link_title'] = 'Titel van de link is vereist';
+$GLOBALS['t']['err_link_url'] = 'URL van de link is vereist';
+$GLOBALS['t']['err_unique_link'] = 'Link URL bestaat al';
+$GLOBALS['t']['change_link_desc'] = 'Wijzig link';
+$GLOBALS['t']['no_links_found'] = 'Er werden geen links gevonden';
+$GLOBALS['t']['num_visits'] = 'Visits';
+
+// manage/pages.tpl
+$GLOBALS['t']['add_page'] = 'Voeg pagina toe';
+$GLOBALS['t']['page_title'] = 'Pagina titel';
+$GLOBALS['t']['page_body'] = 'Pagina inhoud';
+$GLOBALS['t']['change_page_desc'] = 'Wijzig pagina';
+$GLOBALS['t']['err_page_title'] = 'Pagina titel is vereist';
+$GLOBALS['t']['err_page_body'] = 'Pagina inhoud is vereist';
+$GLOBALS['t']['no_pages_found'] = 'Er werden geen pagina\'s gevonden';
+
+// manage/comments.tpl
+$GLOBALS['t']['date'] = 'Datum';
+$GLOBALS['t']['parent'] = 'Bovenliggend Item';
+$GLOBALS['t']['change_comment_desc'] = 'Wijzig commentaar';
+$GLOBALS['t']['mail'] = 'Email';
+$GLOBALS['t']['no_comments_found'] = 'Er werden geen commentaren gevonden';
+$GLOBALS['t']['no_spam_comments_found'] = 'Er werden geen spam commentaren gevonden';
+$GLOBALS['t']['posted_from'] = 'Gepost van het IP adres';
+$GLOBALS['t']['a_comments_spam'] = 'Spam commentaren';
+$GLOBALS['t']['mark_as_spam'] = 'spam';
+$GLOBALS['t']['mark_as_not_spam'] = 'niet spam';
+$GLOBALS['t']['is_spam'] = 'Spam commentaar';
+$GLOBALS['t']['ip_number'] = 'IP nummer';
+$GLOBALS['t']['spam_delete_desc'] = 'Spam commentaren worden automatisch verwijderd na 7 dagen.';
+$GLOBALS['t']['confirm_empty_spam'] = 'Bent u zeker dat u alle spam commentaren wil verwijderen?';
+$GLOBALS['t']['empty_spam_now'] = 'Verwijder nu alle spam commentaren.';
+$GLOBALS['t']['weight'] = 'Gewicht';
+
+// manage/config.tpl
+$GLOBALS['t']['cfg_db_settings'] = 'Database Instellingen';
+$GLOBALS['t']['cfg_db_host'] = 'Database Hostnaam';
+$GLOBALS['t']['cfg_db_name'] = 'Database Naam';
+$GLOBALS['t']['cfg_db_user'] = 'Database Gebruiker';
+$GLOBALS['t']['cfg_db_pass'] = 'Database Paswoord';
+$GLOBALS['t']['cfg_weblog_settings'] = 'Weblog Instellingen';
+$GLOBALS['t']['cfg_weblog_title'] = 'Weblog Titel';
+$GLOBALS['t']['cfg_weblog_description'] = 'Weblog Beschrijving';
+$GLOBALS['t']['cfg_weblog_entries_fp'] = 'Aantal items op de voorpagina';
+$GLOBALS['t']['cfg_weblog_skin'] = 'Weblog skin';
+$GLOBALS['t']['cfg_weblog_language'] = 'Weblog Taal';
+$GLOBALS['t']['cfg_weblog_date_format'] = 'Datum formaat';
+$GLOBALS['t']['cfg_notification'] = 'Notificatie Instellingen';
+$GLOBALS['t']['cfg_notification_email_comment'] = 'Email nieuwe commentaren';
+$GLOBALS['t']['cfg_notification_email_item'] = 'Email niewe items naar de site auteurs';
+$GLOBALS['t']['cfg_rss'] = 'Syndicatie Instellingen';
+$GLOBALS['t']['cfg_rss_max_syndicated_items'] = 'Aantal gesyndiceerde items';
+$GLOBALS['t']['err_db_host'] = 'Database Hostnaam is vereist';
+$GLOBALS['t']['err_db_name'] = 'Database Naam is vereist';
+$GLOBALS['t']['err_db_user'] = 'Database Gebruiker is vereist';
+$GLOBALS['t']['err_weblog_title'] = 'Weblog Titel is vereist';
+$GLOBALS['t']['err_weblog_entries_fp'] = 'Aantal items op de voorpagina is vereist';
+$GLOBALS['t']['err_weblog_entries_fp_num'] = 'Aantal items op de voorpagina moet een getal zijn';
+$GLOBALS['t']['err_max_syndicated_items'] = 'Aantal gesyndiceerde items is vereist';
+$GLOBALS['t']['err_max_syndicated_items_num'] = 'Aantal gesyndiceerde items moet een getal zijn';
+$GLOBALS['t']['change_config'] = 'Wijzig';
+$GLOBALS['t']['cfg_db_prefix'] = 'Database tabel prefix';
+$GLOBALS['t']['cfg_cache'] = 'Caching';
+$GLOBALS['t']['cfg_use_cache_comment'] = 'Cache publieke pagina\'s';
+$GLOBALS['t']['cfg_friendly_urls'] = 'Vriendelijke URLs';
+$GLOBALS['t']['cfg_spam_protection'] = 'Beveiliging tegen spam';
+$GLOBALS['t']['cfg_auto_close_items'] = 'Laat geen commentaren toe na x dagen';
+$GLOBALS['t']['err_auto_close_items'] = 'Laat geen commentaren toe na x dagen moet een getal zijn';
+$GLOBALS['t']['cfg_include_debug_info'] = 'Toon debugging informatie';
+$GLOBALS['t']['cfg_default_item_settings'] = 'Standaard waardes voor nieuwe posts';
+$GLOBALS['t']['cfg_weblog_google_analytics'] = '<a href="http://www.google.com/analytics/" target="_blank">Google Analytics</a> Account';
+$GLOBALS['t']['cfg_google_analytics'] = 'Google Analytics';
+$GLOBALS['t']['cfg_keep_stats'] = 'Houdt statistieken bij';
+$GLOBALS['t']['cfg_blocked_ips'] = 'Geblokkeerde IP adressen gescheiden door comma\'s. Je kan een sterretje gebruiken als wildcard.';
+$GLOBALS['t']['cfg_akismet_key'] = 'Akismet API key (<a href="http://wordpress.com/signup/" target="_blank">hier te verkrijgen</a>)';
+$GLOBALS['t']['cfg_max_img_size'] = 'Maximale beeldgrootte';
+$GLOBALS['t']['cfg_comment_interval'] = 'Commentaar interval in seconden';
+$GLOBALS['t']['err_comment_interval_num'] = 'Commentaar interval moet een getal zijn';
+
+// manage/item.tpl
+$GLOBALS['t']['item_title'] = 'Item Titel';
+$GLOBALS['t']['item_body'] = 'Item Inhoud';
+$GLOBALS['t']['item_body_more'] = 'Item Inhoud (uitgebreid)';
+$GLOBALS['t']['select_image'] = 'Selecteer Beeld';
+$GLOBALS['t']['view'] = 'toon';
+$GLOBALS['t']['add_item'] = 'Voeg item toe';
+$GLOBALS['t']['change_item_desc'] = 'Wijzig Item';
+$GLOBALS['t']['err_item_title'] = 'Item titel is vereist';
+$GLOBALS['t']['err_item_body'] = 'Item inhoud is vereist';
+$GLOBALS['t']['gallery'] = 'Foto\'s';
+$GLOBALS['t']['allow_comments'] = 'Laat commentaren toe';
+$GLOBALS['t']['auto_close_item'] = 'Sluit item automatisch ';
+if ( YDConfig::get( 'auto_close_items', '' ) != '' ) {
+    $GLOBALS['t']['auto_close_item'] .= 'na ' . YDConfig::get( 'auto_close_items', '' ) . ' dagen';
+}
+$GLOBALS['t']['is_draft'] = 'Concept (niet publiceren)';
+$GLOBALS['t']['draft'] = 'concept';
+$GLOBALS['t']['closed'] = 'gesloten';
+$GLOBALS['t']['active_items'] = 'actieve items';
+$GLOBALS['t']['drafts_items'] = 'concepten';
+$GLOBALS['t']['closed_items'] = 'gesloten items';
+
+// item_gallery.tpl
+$GLOBALS['t']['no_images_yet'] = 'Nog geen foto\'s';
+$GLOBALS['t']['image'] = 'foto';
+$GLOBALS['t']['images'] = 'foto\'s';
+$GLOBALS['t']['item'] = 'Item';
+$GLOBALS['t']['edit_meta'] = 'informatie';
+
+// manage/index.tpl
+$GLOBALS['t']['latest_items'] = 'Laatste items';
+$GLOBALS['t']['overview'] = 'Overzicht';
+
+// manage/dbbackup.tpl
+$GLOBALS['t']['a_db_backup'] = 'Databank backup';
+$GLOBALS['t']['bck_name'] = 'Databank backup bestandsnaam';
+$GLOBALS['t']['gz_compress'] = 'Comprimeer backup met GZip compressie';
+$GLOBALS['t']['backup'] = 'Backup';
+$GLOBALS['t']['err_bck_name'] = 'Databank backup bestandsnaam is vereist';
+$GLOBALS['t']['bck_name_comment'] = 'Gebruik "%%DBNAME" voor de databank naam en <a href="http://www.php.net/strftime" target="_blank">gelijk welke strftime optie</a> voor de tijdsaanduiding. De extensie wordt automatisch toegevoegd. Alle andere tekst wordt behouden.';
+$GLOBALS['t']['bck_type'] = 'Backup type';
+$GLOBALS['t']['bck_full'] = 'Volledige backup (structuur en data)';
+$GLOBALS['t']['bck_structure_only'] = 'Enkel de structuur';
+$GLOBALS['t']['bck_data_only'] = 'Enkel de data';
+
+// manage/version_info.tpl
+$GLOBALS['t']['h_diagtools'] = 'Tools';
+$GLOBALS['t']['a_version_info'] = 'Auto Update';
+$GLOBALS['t']['version_check'] = 'Controleer Versie';
+$GLOBALS['t']['installed_version'] = 'Ge&iuml;nstalleerde versie';
+$GLOBALS['t']['development_version'] = 'Ontwikkel versie';
+$GLOBALS['t']['msg_correct_version'] = 'Er zijn geen nieuwere versies beschikbaar';
+$GLOBALS['t']['msg_install_update'] = 'Er zijn nieuwe versies beschikbaar';
+$GLOBALS['t']['development_changelog'] = 'Ontwikkel Logboek';
+$GLOBALS['t']['schema_version'] = 'Database schema versie';
+$GLOBALS['t']['installed_on'] = 'ge&iuml;nstalleerd op';
+
+?>

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-21 08:05:22 UTC (rev 2233)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2006-11-21 12:32:35 UTC (rev 2234)
@@ -1,236 +1,242 @@
-{include file="__mng_header.tpl"}
-
-<p class="title">{t w="h_contents"} &raquo; {t w="a_comments"}
-{if $item}&raquo; {$item.title}{/if}
-</p>
-
-{if $form.errors}
-    <p><table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowELG">{t w="err_general"}</th>
-        </tr>
-        <tr>
-            <td class="adminRowEL">
-                {foreach from=$form.errors item="error"}
-                    {$error}<br/>
-                {/foreach}
-            </td>
-        </tr>
-    </table></p>
-{/if}
-
-{if $YD_ACTION == 'default'}
-
-    <table width="700" cellspacing="0" cellpadding="0" border="0">
-    {if $item}
-        <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; <a href="items.php?do=edit&id={$item.id}" style="font-weight: bold">{t w="change_item_desc"}</a>
-                ({$item.title})
-                &nbsp;
-                <a href="../item.php?id={$item.id}" target="_blank"><img src="images/more_details.gif" border="0" /></a>
-            </th>
-        </tr>
-
-        <tr><td colspan="7">&nbsp;</td></tr>
-    {/if}
-    <tr>
-        <th class="adminRowLG" colspan="7">
-            {if $item}
-                &raquo; {t w="a_comments"}
-            {else}
-                &raquo; <a href="{$YD_SELF_SCRIPT}">
-                    {if $filter == 'no_spam'}<b>{/if}{t w="a_comments"}{if $filter == 'no_spam'}</b>{/if}</a>
-                | <a href="{$YD_SELF_SCRIPT}?filter=spam">
-                    {if $filter == 'spam'}<b>{/if}{t w="a_comments_spam"}{if $filter == 'spam'}</b>{/if}</a>
-            {/if}
-        </th>
-    </tr>
-    {if $comments->set}
-        {if $filter == 'no_spam'}
-            <tr>
-                <th class="adminRowL" width="17%">{t w="date"}</th>
-                <th class="adminRowL" width="15%">{t w="author"}</th>
-                <th class="adminRowL" width="30%">{t w="comment"}</th>
-                <th class="adminRowR" width="18%">{t w="actions"}</th>
-            </tr>
-            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-            {foreach from=$comments->set item="comment"}
-                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
-                    <td class="adminRowL">
-                        {if $comment.item_is_draft eq '1'}<i>{/if}
-                        {$comment.created|date:'%Y/%m/%d %H:%M'}
-                        {if $comment.item_is_draft eq '1'}</i>{/if}
-                    </td>
-                    <td class="adminRowL">
-                        {if $comment.item_is_draft eq '1'}<i>{/if}
-                        {$comment.username}
-                        {if $comment.item_is_draft eq '1'}</i>{/if}
-                    </td>
-                    <td class="adminRowL">
-                        {*{if $comment.item_is_draft eq '1'}<i>{/if}
-                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
-                        {if $comment.item_title}
-                            <br/>
-                            {t w="item"}: {$comment.item_title}
-                        {/if}
-                        {if $comment.item_is_draft eq '1'}</i>{/if}*}
-                        {if $comment.item_is_draft eq '1'}<i>{/if}
-                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
-                        <br/>
-                        {$comment.comment|bbcode|strip_tags|truncate}
-                        {if $comment.item_is_draft eq '1'}</i>{/if}
-                    </td>
-                    <td class="adminRowR">
-                        <a href="../item.php?id={$comment.item_id}#comment-{$comment.id}" target="_blank">{t w="view"}</a>
-                        |
-                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
-                        |
-                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
-                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
-                        <br/>
-                        {if $comment.is_spam}
-                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
-                        {else}
-                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
-                        {/if}
-                    </td>
-                </tr>
-            {/foreach}
-            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-            <tr>
-                <td class="adminRowLNB" colspan="4">
-                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
-                </td>
-            </tr>
-        {else}
-            <tr><td class="adminRowL" colspan="4">
-                <i>{t w="spam_delete_desc"}. <a href="{$YD_SELF_SCRIPT}?do=emptySpam"
-                 onClick="return confirm( '{t w="confirm_empty_spam"}' );">{t w="empty_spam_now"}</a></i>
-            </td></tr>
-            <tr>
-                <th class="adminRowL" width="20%">{t w="date"}</th>
-                <th class="adminRowL" width="15%">{t w="author"}</th>
-                <th class="adminRowL" width="12%">{t w="ip_number"}</th>
-                <th class="adminRowR" width="33%">{t w="actions"}</th>
-            </tr>
-            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-            {foreach from=$comments->set item="comment"}
-                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
-                    <td class="adminRowL">
-                        {$comment.created|date:'%Y/%m/%d %H:%M:%S'}
-                    </td>
-                    <td class="adminRowL">
-                        {$comment.username}
-                    </td>
-                    <td class="adminRowL">
-                        {$comment.userip}
-                    </td>
-                    <td class="adminRowR">
-                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
-                        |
-                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
-                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
-                        |
-                        {if $comment.is_spam}
-                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
-                        {else}
-                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
-                        {/if}
-                    </td>
-                </tr>
-            {/foreach}
-            <tr><td class="adminRowR" colspan="4">{$comments->getBrowseBar()}</td></tr>
-            <tr>
-                <td class="adminRowLNB" colspan="4">
-                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
-                </td>
-            </tr>
-        {/if}
-    {else}
-        <tr>
-            <td class="adminRowL" colspan="7">
-                {if $filter == 'no_spam'}
-                    {t w="no_comments_found"}
-                {else}
-                    {t w="no_spam_comments_found"}
-                {/if}
-            </td>
-        </tr>
-    {/if}
-
-    {if $item}
-        <tr><td colspan="7">&nbsp;</td></tr>
-        <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; <a href="items_gallery.php?id={$item.id}" style="font-weight: bold;">{t w="gallery"}</a>
-                ({$item|@text_num_images:true})
-            </th>
-        </tr>
-    {/if}
-    </table>
-
-{/if}
-
-{if $YD_ACTION == 'edit'}
-    {$form.tag}
-        <table width="700" cellspacing="0" cellpadding="0" border="0">
-            <tr>
-                <th class="adminRowLG">&raquo; {t w="change_comment_desc"}</th>
-                <th class="adminRowLGR">&raquo; <a href="{$YD_SELF_SCRIPT}"><b>{t w="back"}</b></a></th>
-            </tr>
-            <tr>
-                <td class="adminRowL" width="300">{t w="item"}</td>
-                <td class="adminRowL" width="400"><a href="items.php?do=edit&id={$comment.item_id}"><b>{$comment.item_title}</b></a></td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{t w="posted_from"}</td>
-                <td class="adminRowL">{$comment.userip}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL" width="300">User Agent</td>
-                <td class="adminRowL" width="400">{$comment.useragent|default:'-'}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL">Request URI</td>
-                <td class="adminRowL">{$comment.userrequrl|default:'-'}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{$form.username.label_html}</td>
-                <td class="adminRowC">{$form.username.html}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{$form.useremail.label_html}</td>
-                <td class="adminRowC">{$form.useremail.html}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{$form.userwebsite.label_html}</td>
-                <td class="adminRowC">{$form.userwebsite.html}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL" colspan="2">
-                    {$form.comment.label_html}
-                    <br/>
-                    {$form.comment.html}
-                </td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{$form.created.label_html}</td>
-                <td class="adminRowL">{$form.created.html}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL">{$form.is_spam.label_html}</td>
-                <td class="adminRowL">{$form.is_spam.html}</td>
-            </tr>
-            <tr>
-                <td class="adminRowL" colspan="2" style="border: 0px;">
-                    {$form._cmdSubmit.html}
-                    {$form._cmdDelete.html}
-                </td>
-            </tr>
-        </table>
-        {$form.id.html}
-    {$form.endtag}
-{/if}
-
-{include file="__mng_footer.tpl"}
+{include file="__mng_header.tpl"}
+
+<p class="title">{t w="h_contents"} &raquo; {t w="a_comments"}
+{if $item}&raquo; {$item.title}{/if}
+</p>
+
+{if $form.errors}
+    <p><table width="700" cellspacing="0" cellpadding="0" border="0">
+        <tr>
+            <th class="adminRowELG">{t w="err_general"}</th>
+        </tr>
+        <tr>
+            <td class="adminRowEL">
+                {foreach from=$form.errors item="error"}
+                    {$error}<br/>
+                {/foreach}
+            </td>
+        </tr>
+    </table></p>
+{/if}
+
+{if $YD_ACTION == 'default'}
+
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+    {if $item}
+        <tr>
+            <th class="adminRowLG" colspan="7">
+                &raquo; <a href="items.php?do=edit&id={$item.id}" style="font-weight: bold">{t w="change_item_desc"}</a>
+                ({$item.title})
+                &nbsp;
+                <a href="../item.php?id={$item.id}" target="_blank"><img src="images/more_details.gif" border="0" /></a>
+            </th>
+        </tr>
+
+        <tr><td colspan="7">&nbsp;</td></tr>
+    {/if}
+    <tr>
+        <th class="adminRowLG" colspan="8">
+            {if $item}
+                &raquo; {t w="a_comments"}
+            {else}
+                &raquo; <a href="{$YD_SELF_SCRIPT}">
+                    {if $filter == 'no_spam'}<b>{/if}{t w="a_comments"}{if $filter == 'no_spam'}</b>{/if}</a>
+                | <a href="{$YD_SELF_SCRIPT}?filter=spam">
+                    {if $filter == 'spam'}<b>{/if}{t w="a_comments_spam"}{if $filter == 'spam'}</b>{/if}</a>
+            {/if}
+        </th>
+    </tr>
+    {if $comments->set}
+        {if $filter == 'no_spam'}
+            <tr>
+                <th class="adminRowL" width="17%">{t w="date"}</th>
+                <th class="adminRowL" width="15%">{t w="author"}</th>
+                <th class="adminRowL" width="33%">{t w="comment"}</th>
+                <th class="adminRowR" width="15%">{t w="actions"}</th>
+            </tr>
+            <tr><td class="adminRowR" colspan="5">{$comments->getBrowseBar()}</td></tr>
+            {foreach from=$comments->set item="comment"}
+                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
+                    <td class="adminRowL">
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        {$comment.created|date:'%Y/%m/%d %H:%M'}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowL">
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        {$comment.username}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowL">
+                        {*{if $comment.item_is_draft eq '1'}<i>{/if}
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
+                        {if $comment.item_title}
+                            <br/>
+                            {t w="item"}: {$comment.item_title}
+                        {/if}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}*}
+                        {if $comment.item_is_draft eq '1'}<i>{/if}
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
+                        <br/>
+                        {$comment.comment|bbcode|strip_tags|truncate}
+                        {if $comment.item_is_draft eq '1'}</i>{/if}
+                    </td>
+                    <td class="adminRowR">
+                        <a href="../item.php?id={$comment.item_id}#comment-{$comment.id}" target="_blank">{t w="view"}</a>
+                        |
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
+                        <br/>
+                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
+                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
+                        |
+                        {if $comment.is_spam}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
+                        {else}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
+                        {/if}
+                        <br/>
+                        {t w="weight"}: {$comment.comment|strlen}
+                    </td>
+                </tr>
+            {/foreach}
+            <tr><td class="adminRowR" colspan="5">{$comments->getBrowseBar()}</td></tr>
+            <tr>
+                <td class="adminRowLNB" colspan="5">
+                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
+                </td>
+            </tr>
+        {else}
+            <tr><td class="adminRowL" colspan="5">
+                <i>{t w="spam_delete_desc"}. <a href="{$YD_SELF_SCRIPT}?do=emptySpam"
+                 onClick="return confirm( '{t w="confirm_empty_spam"}' );">{t w="empty_spam_now"}</a></i>
+            </td></tr>
+            <tr>
+                <th class="adminRowL" width="25%">{t w="date"}</th>
+                <th class="adminRowL" width="15%">{t w="weight"}</th>
+                <th class="adminRowL" width="15%">{t w="author"}</th>
+                <th class="adminRowL" width="15%">{t w="ip_number"}</th>
+                <th class="adminRowR" width="30%">{t w="actions"}</th>
+            </tr>
+            <tr><td class="adminRowR" colspan="5">{$comments->getBrowseBar()}</td></tr>
+            {foreach from=$comments->set item="comment"}
+                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);" {if $comment.item_is_draft eq '1'}style="color: gray"{/if}>
+                    <td class="adminRowL">
+                        {$comment.created|date:'%Y/%m/%d %H:%M:%S'}
+                    </td>
+                    <td class="adminRowL">
+                        {$comment.comment|strlen}
+                    </td>
+                    <td class="adminRowL">
+                        {$comment.username}
+                    </td>
+                    <td class="adminRowL">
+                        {$comment.userip}
+                    </td>
+                    <td class="adminRowR">
+                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{t w="edit"}</a>
+                        |
+                        <a href="{$YD_SELF_SCRIPT}?do=delete&id={$comment.id}"
+                         onClick="return YDConfirmDelete( '{$comment.comment|bbcode|strip_tags|strip|truncate|addslashes}' );">{t w="delete"}</a>
+                        |
+                        {if $comment.is_spam}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_not_spam&id={$comment.id}">{t w="mark_as_not_spam"}</a>
+                        {else}
+                            <a href="{$YD_SELF_SCRIPT}?do=mark_as_spam&id={$comment.id}">{t w="mark_as_spam"}</a>
+                        {/if}
+                    </td>
+                </tr>
+            {/foreach}
+            <tr><td class="adminRowR" colspan="5">{$comments->getBrowseBar()}</td></tr>
+            <tr>
+                <td class="adminRowLNB" colspan="5">
+                    <p class="subline">{t w="total"}: {$comments->totalRows}</p>
+                </td>
+            </tr>
+        {/if}
+    {else}
+        <tr>
+            <td class="adminRowL" colspan="7">
+                {if $filter == 'no_spam'}
+                    {t w="no_comments_found"}
+                {else}
+                    {t w="no_spam_comments_found"}
+                {/if}
+            </td>
+        </tr>
+    {/if}
+
+    {if $item}
+        <tr><td colspan="7">&nbsp;</td></tr>
+        <tr>
+            <th class="adminRowLG" colspan="7">
+                &raquo; <a href="items_gallery.php?id={$item.id}" style="font-weight: bold;">{t w="gallery"}</a>
+                ({$item|@text_num_images:true})
+            </th>
+        </tr>
+    {/if}
+    </table>
+
+{/if}
+
+{if $YD_ACTION == 'edit'}
+    {$form.tag}
+        <table width="700" cellspacing="0" cellpadding="0" border="0">
+            <tr>
+                <th class="adminRowLG">&raquo; {t w="change_comment_desc"}</th>
+                <th class="adminRowLGR">&raquo; <a href="{$YD_SELF_SCRIPT}"><b>{t w="back"}</b></a></th>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">{t w="item"}</td>
+                <td class="adminRowL" width="400"><a href="items.php?do=edit&id={$comment.item_id}"><b>{$comment.item_title}</b></a></td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="posted_from"}</td>
+                <td class="adminRowL">{$comment.userip}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL" width="300">User Agent</td>
+                <td class="adminRowL" width="400">{$comment.useragent|default:'-'}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">Request URI</td>
+                <td class="adminRowL">{$comment.userrequrl|default:'-'}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{$form.username.label_html}</td>
+                <td class="adminRowC">{$form.username.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{$form.useremail.label_html}</td>
+                <td class="adminRowC">{$form.useremail.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{$form.userwebsite.label_html}</td>
+                <td class="adminRowC">{$form.userwebsite.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL" colspan="2">
+                    {$form.comment.label_html}
+                    <br/>
+                    {$form.comment.html}
+                </td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{$form.created.label_html}</td>
+                <td class="adminRowL">{$form.created.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{$form.is_spam.label_html}</td>
+                <td class="adminRowL">{$form.is_spam.html}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL" colspan="2" style="border: 0px;">
+                    {$form._cmdSubmit.html}
+                    {$form._cmdDelete.html}
+                </td>
+            </tr>
+        </table>
+        {$form.id.html}
+    {$form.endtag}
+{/if}
+
+{include file="__mng_footer.tpl"}



From pclaerhout at mail.berlios.de  Tue Nov 21 13:44:57 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 21 Nov 2006 13:44:57 +0100
Subject: [ydf-devel] r2235 - in YDFramework2.0/trunk/examples/weblog: .
	include/languages
Message-ID: <200611211244.kALCiv57004330@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-21 13:44:57 +0100 (Tue, 21 Nov 2006)
New Revision: 2235

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
The comment body can now not be any longer than 2048 characters.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-21 12:32:35 UTC (rev 2234)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-21 12:44:57 UTC (rev 2235)
@@ -90,6 +90,7 @@
 $GLOBALS['t']['err_email'] = 'Email is missing or invalid';
 $GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
 $GLOBALS['t']['err_comment'] = 'Comment is required';
+$GLOBALS['t']['err_comment_length'] = 'Comment is cannot be more than 2048 characters';
 $GLOBALS['t']['with'] = 'for';
 $GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
 $GLOBALS['t']['spam'] = 'Spam';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-21 12:32:35 UTC (rev 2234)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-21 12:44:57 UTC (rev 2235)
@@ -90,6 +90,7 @@
 $GLOBALS['t']['err_email'] = 'Email is niet ingegeven of niet correct';
 $GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
+$GLOBALS['t']['err_comment_length'] = 'Commentaar kan niet meer dan 2048 karakters bevatten';
 $GLOBALS['t']['with'] = 'bij';
 $GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
 $GLOBALS['t']['spam'] = 'Spam';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-11-21 12:32:35 UTC (rev 2234)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-11-21 12:44:57 UTC (rev 2235)
@@ -74,6 +74,7 @@
             $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
             $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
             $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
+            $form->addRule( 'comment',     'maxlength', t( 'err_comment_length' ), 2048 );
 
             // Add the filters
             $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );



From francisco at fusemail.com  Tue Nov 21 16:16:41 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 21 Nov 2006 15:16:41 +0000
Subject: [ydf-devel] Propose for a YD language repository
Message-ID: <45631859.4020401@fusemail.com>

Hi Pieter, Hi all

In our applications, it's common to have the option for more than one 
language. This requires that we have translation files with translated 
strings, eg, YDWeblog has translation files and my simple application 
(based on the YDCM draft) too.

I propose to have a YDF repository of translated strings.
The good on this is that that, in our applications, we can use that 
strings (we don't need to reinvent the wheel every time) and these 
strings can be automatically translated/updated (because we have 
contributors in different languages).

Apart from that, i propose to define a common way for those strings. 
Here goes my ideas:

  - create a YDF directory for translations (eg: YDFramework2/translations)

  - create a subdirectory for each context.
Eg, for strings related to users, create a 
YDFramework2/translations/users/ directory. For generic strings (eg: 
'add', 'delete') create a generic directory 
YDFramework2/translations/generic/

  - for each language we have a file inside each directory. Eg, if we 
have english and portuguese we would have in users translation directory 
these files:
YDFramework2/translations/users/en.php
YDFramework2/translations/users/pt.php
or
YDFramework2/translations/users/language_en.php
YDFramework2/translations/users/language_pt.php

  - inside each file we could have a structure to define:
* permissions
* labels
* return messages (that can be ok messages, error or form errors)

I propose that a string should start by the context name, then type and 
then name.
Eg, in users,
permissions could be:
  $GLOBALS['t']['users perm edit'] = ...
  $GLOBALS['t']['users perm delete'] = ...

labels could be:
  $GLOBALS['t']['users label username'] = ...
  $GLOBALS['t']['users label email'] = ...

messages could be:
  $GLOBALS['t']['users mess deleteok'] = ...
  $GLOBALS['t']['users mess emailnotvalid'] = ...


This can be a huge help for all developers, they only need to use the 
directory they want ( first defining the current language with 
YDLocale::set() and then including the directory with 
YDLocale::addDirectory() ), and if a string is missing, it can be added 
and translated to other languages in a short time.
Of course, in this initial phase, the port can be time consuming, but i 
think its a good practice.


What do you think?

regards
Francisco A


From maximus_meridius79 at yahoo.com  Tue Nov 21 17:00:08 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Tue, 21 Nov 2006 08:00:08 -0800 (PST)
Subject: [ydf-devel] YDDatabaseTree3::moveNode fixed and
	YDDatabaseTree3::getTraversedTree
Message-ID: <20061121160008.92482.qmail@web54010.mail.yahoo.com>

  Hi Francisco,

I have found the cause of some of the problems with moveNode. TheYDDatabaseObject::set method does not work for expressions . This wascausing the  positions to  be updated  to the value 0. In moveNode, Ihave changed the queries so that they are hand-coded SQL executed viathe YDDatabaseObject::executeSQL() method. moveNode works for movingnodes within the current parent.

There is a remaining problem withnodesmoved to another parent. The child nodes of the moved node are notupdated with the correct lineage ... but is that the way it is supposedto work or should the leaf nodes be moved one by one?

I have modified the test harness toinclude the sitemap method that displays the complete tree. I had toturn off debug so that the redirects would work.

Updated code is attached.

Regards,

Graeme



 
---------------------------------
Sponsored Link

Want a degree but can't afford to quit? Online degrees from top schools - in as fast as 1 year
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061121/49c9bd8d/attachment.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061121/49c9bd8d/attachment-0001.html>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061121/49c9bd8d/attachment-0002.html>

From pieter at yellowduck.be  Tue Nov 21 20:46:03 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 21 Nov 2006 20:46:03 +0100
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <45631859.4020401@fusemail.com>
References: <45631859.4020401@fusemail.com>
Message-ID: <4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>

I'm not to keen on a solution like this, as different applications might
want to use different terminology for different purposes. Another thing I
find less good in this approach is that we will end up with tons of includes
that will slow down the application.

pieter

2006/11/21, Francisco Azevedo <francisco at fusemail.com>:
>
> Hi Pieter, Hi all
>
> In our applications, it's common to have the option for more than one
> language. This requires that we have translation files with translated
> strings, eg, YDWeblog has translation files and my simple application
> (based on the YDCM draft) too.
>
> I propose to have a YDF repository of translated strings.
> The good on this is that that, in our applications, we can use that
> strings (we don't need to reinvent the wheel every time) and these
> strings can be automatically translated/updated (because we have
> contributors in different languages).
>
> Apart from that, i propose to define a common way for those strings.
> Here goes my ideas:
>
> - create a YDF directory for translations (eg: YDFramework2/translations)
>
> - create a subdirectory for each context.
> Eg, for strings related to users, create a
> YDFramework2/translations/users/ directory. For generic strings (eg:
> 'add', 'delete') create a generic directory
> YDFramework2/translations/generic/
>
> - for each language we have a file inside each directory. Eg, if we
> have english and portuguese we would have in users translation directory
> these files:
> YDFramework2/translations/users/en.php
> YDFramework2/translations/users/pt.php
> or
> YDFramework2/translations/users/language_en.php
> YDFramework2/translations/users/language_pt.php
>
> - inside each file we could have a structure to define:
> * permissions
> * labels
> * return messages (that can be ok messages, error or form errors)
>
> I propose that a string should start by the context name, then type and
> then name.
> Eg, in users,
> permissions could be:
> $GLOBALS['t']['users perm edit'] = ...
> $GLOBALS['t']['users perm delete'] = ...
>
> labels could be:
> $GLOBALS['t']['users label username'] = ...
> $GLOBALS['t']['users label email'] = ...
>
> messages could be:
> $GLOBALS['t']['users mess deleteok'] = ...
> $GLOBALS['t']['users mess emailnotvalid'] = ...
>
>
> This can be a huge help for all developers, they only need to use the
> directory they want ( first defining the current language with
> YDLocale::set() and then including the directory with
> YDLocale::addDirectory() ), and if a string is missing, it can be added
> and translated to other languages in a short time.
> Of course, in this initial phase, the port can be time consuming, but i
> think its a good practice.
>
>
> What do you think?
>
> regards
> Francisco A
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061121/67770f60/attachment.html>

From francisco at fusemail.com  Tue Nov 21 23:43:14 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 21 Nov 2006 22:43:14 +0000
Subject: [ydf-devel] YDDatabaseObject changes
Message-ID: <45638102.7020209@fusemail.com>

Hi db,

I made simple changes/impruvements in YDDatabaseObject and YDDatabaseQuery:

on YDDatabaseObject::update()
it's now possible to define fields that should not be escaped.

on YDDatabaseQuery::set,
reserved values (that should not be quoted) are not escaped too. 
Otherwise expressions will be escaped and shouldn't.

What do you think?

regards
Francisco A


From ximian at mail.berlios.de  Tue Nov 21 23:46:08 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 21 Nov 2006 23:46:08 +0100
Subject: [ydf-devel] r2236 - in YDFramework2.0/trunk/YDFramework2/addons:
	YDDatabaseObject YDDatabaseQuery
Message-ID: <200611212246.kALMk83c025909@sheep.berlios.de>

Author: ximian
Date: 2006-11-21 23:45:41 +0100 (Tue, 21 Nov 2006)
New Revision: 2236

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
Log:
on YDDatabaseObject::update()
it's now possible to define fields that should not be escaped.

on YDDatabaseQuery::set,
reserved values (that should not be quoted) are not escaped too. 
Otherwise expressions will be escaped and shouldn't.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-11-21 12:44:57 UTC (rev 2235)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2006-11-21 22:45:41 UTC (rev 2236)
@@ -1043,10 +1043,12 @@
          *
          *  @param $values_noquote  (optional) Associative array that defines values that
          *                          will not be quoted as strings, e.g. NOW().
+         *  @param $fields_noquote  (optional) Field or array of fields that
+         *                          will not be quoted as strings.
          *
          *  @returns  The number of rows affected.
          */
-        function update( $values_noquote=array() ) {
+        function update( $values_noquote=array(), $fields_noquote=array() ) {
 
             // before update callbacks
             $res = $this->_executeCallbacks( 'update', true );
@@ -1078,7 +1080,16 @@
                                 Your UPDATE query has no conditions and will not be executed.', YD_NOTICE );
                 return;
             }
-            
+
+            if ( ! is_array( $fields_noquote ) ) $fields_noquote = array( $fields_noquote );
+            foreach( $fields_noquote as $field_key ){
+                if ( isset( $values[ $field_key ] ) ){
+                    $values_noquote[ $field_key ] = $values[ $field_key ];
+                }else if ( isset( $keys[ $field_key ] ) ){
+                    $values_noquote[ $field_key ] = $keys[ $field_key ];
+                }
+            }
+
             $this->_query->update();
             $this->_query->table( $this->getTable() );
             $this->_query->set( $values );

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-11-21 12:44:57 UTC (rev 2235)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2006-11-21 22:45:41 UTC (rev 2236)
@@ -772,7 +772,7 @@
                 if ( $this->filter_noquote && substr( $key, 0, 1 ) == '_' ) {
                     continue;
                 }
-                $update[ $this->reserved( $key ) ] = $this->reserved( $key ) . " = " . $this->escape( $value );
+                $update[ $this->reserved( $key ) ] = $this->reserved( $key ) . " = " . $value;
             }
             return ' SET ' . implode( ', ', array_values( $update ) );
         }



From ximian at mail.berlios.de  Tue Nov 21 23:51:04 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 21 Nov 2006 23:51:04 +0100
Subject: [ydf-devel] r2237 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611212251.kALMp4l3026411@sheep.berlios.de>

Author: ximian
Date: 2006-11-21 23:50:45 +0100 (Tue, 21 Nov 2006)
New Revision: 2237

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
 - FIXED: moveNode, deleteNode and addNode.. Now it's really fixed! I think :)
 - added YDDatabaseTree3::getTraversedTree (by Graeme)

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-21 22:45:41 UTC (rev 2236)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2006-11-21 22:50:45 UTC (rev 2237)
@@ -80,7 +80,7 @@
 
 			// register reserved fields
 			$this->registerKey( $idField, true );
-			$this->registerKey( $parentField );
+			$this->registerField( $parentField );
 			$this->registerField( $lineageField );
 			$this->registerField( $levelField );
 			$this->registerField( $positionField );
@@ -401,7 +401,7 @@
 			$this->set( $this->__id, intval( $child_id ) );
 
 			// check if there is a parent that equals $parent_id
-			$this->set( $this->__parent, intval( $parent_id ) );
+			$this->where( $this->__parent . ' = ' . intval( $parent_id ) );
 
 			// get total of rows
 			return ( $this->find() == 1 );
@@ -452,7 +452,7 @@
 			$this->reset();
 
 			// search all nodes that contains this id in lineage
-			$this->set( $this->__parent, intval( $id ) );
+			$this->where( $this->__parent . ' = ' . intval( $id ) );
 
 			// find them
 			return $this->find();
@@ -516,17 +516,20 @@
 			if ( !is_numeric( $position ) || intval( $position ) < 1 || intval( $position ) > $total_brothers + 1 )
 				$position = $total_brothers + 1;
 
-			// create an empty position. To do this we must increment position of nodes that have the same parent AND have position equal or bigger than $position
-			$this->reset();
+			// create an empty position. To do this, if node is not added in the end, we must increment position of nodes that have the same parent and equal or bigger position 
+			if ( $position != $total_brothers + 1 ){
+	
+				$this->reset();
 
-			// position field must increment
-			$this->set( $this->__position, $this->__position . ' + 1' );
+				// position field must increment
+				$this->set( $this->__position, $this->__position . ' + 1' );
 
-			// only on new brothers with higher or equal position
-			$this->where( $this->__parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__position . ' >= ' . intval( $position ) );
+				// only on new brothers with higher or equal position
+				$this->where( $this->__parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__position . ' >= ' . intval( $position ) );
 
-			// lets update.
-			$this->update();
+				// lets update.
+				$this->update( array(), $this->__position );
+			}
 
 			// reset any previous value to create insert
 			$this->reset();
@@ -611,7 +614,7 @@
 				// in all elements with same parent AND position bigger than our
 				$this->where( $this->__parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__position . ' > ' . intval( $node[ $this->__position ] ) );
 
-				$this->update();
+				$this->update( array(), $this->__position );
 				
 				return $total;
 			}
@@ -619,7 +622,8 @@
 			// here we want do delete child only
 			$this->reset();
 
-			$this->set( $this->__parent, intval( $id ) );
+			// we only need to delete children. Children of children will be deleted when mysql is InnoDB
+			$this->where( $this->__parent . ' = ' . intval( $id ) );
 
 			return $this->delete();
         }
@@ -661,24 +665,28 @@
 			// only update positions if new parent and old parent are not the same OR if (they are same but) positions are not changed
 			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
 
+				// decrease positions of old brothers that have position bigger than this node position
+				$this->reset();
+				$this->set( $this->__position, $this->__position . ' - 1' );
+				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
+				$this->update( array(), $this->__position );
+
 				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
 				$this->reset();
 				$this->set( $this->__position, $this->__position . ' + 1' );
 				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' >= ' . $new_position );
-				$this->update();
-
-				// decrease positions of old brothers that have position bigger than this node position
-				$this->reset();
-				$this->set( $this->__position, $this->__position . ' - 1' );
-				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
-				$this->update();
+				$this->update( array(), $this->__position );
 			}
 
+			// compute lineage
+			if ( $new_parent_id == 1 ) $new_lineage = '//';
+			else                       $new_lineage = $new_parent_node[ $this->__lineage ] . $new_parent_id . '/';
+
 			// update node
 			$this->reset();
 			$this->set( $this->__id,       intval( $id ) );
 			$this->set( $this->__parent,   intval( $new_parent_id ) );
-			$this->set( $this->__lineage,  $new_parent_node[ $this->__lineage ] . $new_parent_id . '/' );
+			$this->set( $this->__lineage,  $new_lineage );
 			$this->set( $this->__level,    $this->_getLevel( $new_lineage ) );
 			$this->set( $this->__position, intval( $new_position ) );
 			$res = $this->update();
@@ -686,14 +694,66 @@
 			// update lineages of node descendants ;)
 			if ( $new_parent_id != $old_parent_id ){
 				$this->reset();
-				$this->set( $this->__lineage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
-				$this->update();
+				$this->set( $this->__lineage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . $id . '/","' . $new_lineage . $id . '/")' );
+				$this->where( $this->__id . ' > 1 ' );
+				$this->update( array(), $this->__lineage );
 			}
 
 			return $res;
         }
 
 
+        /**
+         *  Fetch an array of tree nodes containing a traversal of the tree. 
+         *
+         * @param $id   (optional) The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the tree
+         */
+		function getTraversedTree( $id = 1 ) {
+		
+			$this->_tree_data = $this->getTreeElements();
+			$this->_tree_data_keys = array_keys( $this->_tree_data );
+		
+			return $this->_getTraversedTree( $id );
+		}
 
+
+        /**
+         *  Helper function to get traversal of tree. 
+         *
+         * @param $id   (optional) The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the tree
+         */
+		function _getTraversedTree( $id = 1 ) {
+		
+			$key_match = false;
+			
+			foreach ( $this->_tree_data_keys as $key ) {
+				if ( $this->_tree_data[$key]['id'] == $id ) {
+					$key_match = true;
+					$ref = & $this->_tree_data[$key];
+					break;
+				}
+			}
+			
+			if ( $key_match ) {
+				$result = array( $ref );
+			} else {
+				$result = array();
+			}
+			
+			$children = $this->getChildren ( $id, true );
+			
+			foreach ( $children as $child ) {			
+				$child_ids = $this->getTraversedTree( $child['id'] );				
+				$result = array_merge( $result, $child_ids );
+			}
+						
+			return $result;
+		}
+		
+
     }
 ?>
\ No newline at end of file



From jose at psabs.com.br  Tue Nov 21 23:52:40 2006
From: jose at psabs.com.br (Jose Carlos Medeiros)
Date: Tue, 21 Nov 2006 20:52:40 -0200
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
References: <45631859.4020401@fusemail.com>
	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
Message-ID: <abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>

Hi,

Why not use Gettext and maybe a compendium file ?
I think its more easy to manage and more easy to translators.


Regards
Jose Carlos

2006/11/21, Pieter Claerhout <pieter at yellowduck.be>:
> I'm not to keen on a solution like this, as different applications might
> want to use different terminology for different purposes. Another thing I
> find less good in this approach is that we will end up with tons of includes
> that will slow down the application.
>
> pieter
>
> 2006/11/21, Francisco Azevedo <francisco at fusemail.com>:
> > Hi Pieter, Hi all
> >
> > In our applications, it's common to have the option for more than one
> > language. This requires that we have translation files with translated
> > strings, eg, YDWeblog has translation files and my simple application
> > (based on the YDCM draft) too.
> >
> > I propose to have a YDF repository of translated strings.
> > The good on this is that that, in our applications, we can use that
> > strings (we don't need to reinvent the wheel every time) and these
> > strings can be automatically translated/updated (because we have
> > contributors in different languages).
> >
> > Apart from that, i propose to define a common way for those strings.
> > Here goes my ideas:
> >
> > - create a YDF directory for translations (eg: YDFramework2/translations)
> >
> > - create a subdirectory for each context.
> > Eg, for strings related to users, create a
> > YDFramework2/translations/users/ directory. For generic
> strings (eg:
> > 'add', 'delete') create a generic directory
> > YDFramework2/translations/generic/
> >
> > - for each language we have a file inside each directory. Eg, if we
> > have english and portuguese we would have in users translation directory
> > these files:
> > YDFramework2/translations/users/en.php
> > YDFramework2/translations/users/pt.php
> > or
> > YDFramework2/translations/users/language_en.php
> > YDFramework2/translations/users/language_pt.php
> >
> > - inside each file we could have a structure to define:
> > * permissions
> > * labels
> > * return messages (that can be ok messages, error or form errors)
> >
> > I propose that a string should start by the context name, then type and
> > then name.
> > Eg, in users,
> > permissions could be:
> > $GLOBALS['t']['users perm edit'] = ...
> > $GLOBALS['t']['users perm delete'] = ...
> >
> > labels could be:
> > $GLOBALS['t']['users label username'] = ...
> > $GLOBALS['t']['users label email'] = ...
> >
> > messages could be:
> > $GLOBALS['t']['users mess deleteok'] = ...
> > $GLOBALS['t']['users mess emailnotvalid'] = ...
> >
> >
> > This can be a huge help for all developers, they only need to use the
> > directory they want ( first defining the current language with
> > YDLocale::set() and then including the directory with
> > YDLocale::addDirectory() ), and if a string is missing, it can be added
> > and translated to other languages in a short time.
> > Of course, in this initial phase, the port can be time consuming, but i
> > think its a good practice.
> >
> >
> > What do you think?
> >
> > regards
> > Francisco A
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> >
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
>
>  --
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>


-- 
[]'s
Jos? Carlos

From francisco at fusemail.com  Wed Nov 22 00:13:28 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 21 Nov 2006 23:13:28 +0000
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>
References: <45631859.4020401@fusemail.com>	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
	<abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>
Message-ID: <45638818.909@fusemail.com>

Hi

> Why not use Gettext and maybe a compendium file ?

"To use [Gettext] you must download and install the GNU gettext 
package". Afaik, gettext support is not present in a trivial/common host.
So, like a said before.. i prefer to have a application 50ms slower and 
100% compatible than a 1ms slower but 50% compatible.

my 0.02

regards
Francisco



From francisco at fusemail.com  Wed Nov 22 01:01:32 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Tue, 21 Nov 2006 18:01:32 -0600 (CST)
Subject: [ydf-devel] Propose for a YD language repository
Message-ID: <1164153692.v2.fusewebmail-15630@f>

Hi

> I'm not to keen on a solution like this, as different applications might
> want to use different terminology for different purposes. Another thing
> I find less good in this approach is that we will end up with tons of
> includes that will slow down the application.

Yes, different applications use different terminology.. but all use
common strings.. 'add', 'delete', 'success in operation'.. and currently
we *must* reinvent the wheel every time!

I really don't see why not a common repository with translated strings
ready to use.. if you think your application has a purpose that have
nothing to do with those strings you are free to use your own
translation strategy, if not, what's the problem in reading those files?

All i'm proposing is.. an option. Currently, we have no options.. we
must create our strings every time.. just that.

About one file or segmented files.. yes.. more than one file requires
more includes and it's slower.. but it's easier to maintain i think.


Francisco A




From ximian at mail.berlios.de  Wed Nov 22 02:28:28 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 22 Nov 2006 02:28:28 +0100
Subject: [ydf-devel] r2238 - YDFramework2.0/trunk/examples
Message-ID: <200611220128.kAM1SSFQ018382@sheep.berlios.de>

Author: ximian
Date: 2006-11-22 02:28:13 +0100 (Wed, 22 Nov 2006)
New Revision: 2238

Modified:
   YDFramework2.0/trunk/examples/database_tree3.php
Log:
updated YDDatabaseTree3 example

Modified: YDFramework2.0/trunk/examples/database_tree3.php
===================================================================
--- YDFramework2.0/trunk/examples/database_tree3.php	2006-11-21 22:50:45 UTC (rev 2237)
+++ YDFramework2.0/trunk/examples/database_tree3.php	2006-11-22 01:28:13 UTC (rev 2238)
@@ -87,7 +87,7 @@
         function actionDefault() {
 
             // Show the link to the sitemap action
-            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example">Sitemap</a>' );
+            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=1">Sitemap</a>' );
 
             // Get a reference to the tree
             $tree = & $this->tree;
@@ -136,40 +136,76 @@
 
             // Get the node ID
             $id = ( isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
-        
+
             // Add an item
             $values = array( 'title' => 'New Node - ' . time() );
             
-			$this->tree->addNode( $values, $id );
+			if ( isset( $_GET['position'] ) ) $this->tree->addNode( $values, $id, $_GET['position'] );
+			else                              $this->tree->addNode( $values, $id );
 
-            $this->actionExample( true );
+            $this->actionExample( $id );
         }
 
 
+        // Move node
+        function actionMove() {
+
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // get parent of this node
+			$node = $this->tree->getNode( $_GET['id'] );
+
+			// the delete debug is what we want
+  			YDConfig::set( 'YD_DEBUG', 2 );
+
+			if ( isset( $_GET['newparent'] ) ) $newparent = $_GET['newparent']; 
+			else                               $newparent = null;
+
+            // Move node
+			$this->tree->moveNode( $_GET['id'], $newparent, $_GET['position'] );
+
+			// show parent tree
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // Redirect to the sitemap
+            $this->actionExample( $node[ 'parent_id' ] );
+        }
+
+
         // Delete a node and it's subnodes
         function actionDelete() {
 
-            // Get a reference to the tree
-            $tree = & $this->tree;
+  			YDConfig::set( 'YD_DEBUG', 0 );
 
+            // get parent of this node
+			$node = $this->tree->getNode( $_GET['id'] );
+
+			// the delete debug is what we want
+  			YDConfig::set( 'YD_DEBUG', 2 );
+
             // Delete a node
-            $tree->deleteNode( $_GET['id'] );
-            
+            if ( isset( $_GET['nodeandchildren'] ) ) $this->tree->deleteNode( $_GET['id'], true );
+			else                                     $this->tree->deleteNode( $_GET['id'], false );
+
+			// show parent tree
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
             // Redirect to the sitemap
-            $this->actionExample( true );
-
+            $this->actionExample( $node[ 'parent_id' ] );
         }
 
+
         // Real life example
-        function actionExample( $root = false) {
+        function actionExample( $id = false ) {
 
   			YDConfig::set( 'YD_DEBUG', 0 );
   
             // Get node ID
-            $id = ( $root == false && isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
+			if ( $id == false ) $id = $_GET['id'];
 
-            // compute path
-            echo( '<p><b>Path:</b> ROOT &raquo; ' );
+            // compute root link
+            echo( '<p><b>Path:</b> <a href="' . YD_SELF_SCRIPT . '?do=example&id=1">ROOT</a> &raquo; ' );
+
             foreach ( $this->tree->getPath( $id ) as $path_item ) {
                 echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $path_item['id'] . '">' . $path_item['title'] . '</a> &raquo; ' );
             }
@@ -179,26 +215,37 @@
             echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $node['id'] . '">' . $node['title'] . '</a>' );
             echo( '</p>' );
 
-            // Show the item
-            echo( '<p><b>' . $node['title'] . '</b></p> ' );
-
             // Show the children in a table
 			echo( '<table><tr><td><b>Children:</b></td><td>actions</td></tr>' );
-            foreach ( $this->tree->getChildren( $id ) as $child ) {
+			$children = $this->tree->getChildren( $id );
+            foreach ( $children as $child ) {
 				echo( '<tr><td>' );
 
 					// show child action
                 	echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $child['id'] . '">' . $child['title'] . '</a>&nbsp;&nbsp;&nbsp;' );
 				echo( '</td><td>' );
 
-					// delete action
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&id='  . $child['id'] . '">Delete (' . $child['title'] . ')</a><br/>' );
+					// delete action element and nodes
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&nodeandchildren=1&id='  . $child['id'] . '">Delete ' . $child['title'] . ' and subnodes</a> | ' );
+
+					// delete action nodes only
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&id='  . $child['id'] . '">Delete nodes of ' . $child['title'] . ' </a> | ' );
+
+					// move up
+					if ( $child['position'] != 1 )
+		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] - 1) . '">Move up</a> | ' );
+
+					// move down
+					if ( $child['position'] != count( $children ) )
+		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] + 1) . '">Move down</a>' );
+
 				echo( '</td></tr>' );
             }
   
   			// add node action
 			echo( '<tr><td></td><td>' );
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ')</a><br/>' );
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at bottom</a> | ' );
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&position=1&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at top</a>' );
 			echo( '</td></tr>' );
 
             echo( '</table>' );



From jose at psabs.com.br  Wed Nov 22 03:35:18 2006
From: jose at psabs.com.br (Jose Carlos Medeiros)
Date: Wed, 22 Nov 2006 00:35:18 -0200
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <45638818.909@fusemail.com>
References: <45631859.4020401@fusemail.com>
	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
	<abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>
	<45638818.909@fusemail.com>
Message-ID: <abc57ff50611211835n776c4aadw9522b749bf46be35@mail.gmail.com>

Hi,

Well, we can install php-gettext or use this project
http://upgradephp.berlios.de/

This solve problem with gettext suport.

Gettext isnt a wheel reinventing.  and to create new translations is
very easy,  there was at least 3 editor to it.
My mother can translate one program with gettext suport but with
strings php in a file, is more difficult.

But you are right,  each project has your own way to keep translations.

Im just getting my opinion, because sometimes I translate projects
(despite my bad english :) ,   and its more , more easy translate
project with gettext than others.

Regards,
Jose Carlos

2006/11/21, Francisco Azevedo <francisco at fusemail.com>:
> Hi
>
> > Why not use Gettext and maybe a compendium file ?
>
> "To use [Gettext] you must download and install the GNU gettext
> package". Afaik, gettext support is not present in a trivial/common host.
> So, like a said before.. i prefer to have a application 50ms slower and
> 100% compatible than a 1ms slower but 50% compatible.
>
> my 0.02
>
> regards
> Francisco
>
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>


-- 
[]'s
Jos? Carlos

From maximus_meridius79 at yahoo.com  Wed Nov 22 13:57:24 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Wed, 22 Nov 2006 04:57:24 -0800 (PST)
Subject: [ydf-devel] Proposed changes to YDTemplate and YDAjax
Message-ID: <20061122125724.96181.qmail@web62506.mail.re1.yahoo.com>

  Hi Pieter & Francisco,

I've got some suggestions for changes toYDTemplate and YDAjax:
  
   Add a method YDTemplate::addJavascriptUrl to enable linkedjavascript to be added to the template head. This provides forperformance improvements because it allows the xajax core javascript,the accompanying effects library and any javascript file to be cached.
    http://developer.berlios.de/feature/?func=detailfeature&feature_id=2824&group_id=3988
    
    
    
      
   Allow code using YDAjax to determine ajax response state (i.e.whether current processing is in the context of a request or aresponse).
    http://developer.berlios.de/feature/?func=detailfeature&feature_id=2791&group_id=3988
    
      
   Modify YDAjax to use a new effects library to replace the oldmoofx library used by YDAjax ( http://moofx.mad4milk.net/old/). Some thought needs to be put into the best way to go. There are twochoices:
  
   moofx2 at http://moofx.mad4milk.net/. This is a rearchitected implementation of moofx that providesadditional functionality in it's lightweight 3kb implementation.
    
   mootools at http://mootools.net/. This has been developed by the same author as moofx but has much morefunctionality in a 25kb implementation. You can see some of thefunctionality described at http://mootools.net/download/release.
  
Both options provide a richer set of effects and there areplenty of good examples around for using them.
  
My suggestion is to provide 3 alternative implementations ofYDAjaxEffects. The default would be to use the current effects library,however config variable could be used to select moofx2 or mootools.
  
My YDLayer code uses a YDAjaxEffects implementation based on mootoolsthat is backwardly compatible with the original YDAjaxEffects . Myearlier e-mail describes this https://lists.berlios.de/pipermail/ydframework-devel/2006-October/000717.html.
What is your opinion of these proposed changes?

Thanks,

Graeme

  

 
---------------------------------
Sponsored Link

Mortgage rates near 39yr lows. $510,000 Mortgage for $1,698/mo -   Calculate new house payment
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061122/77b7b5a8/attachment.html>

From maximus_meridius79 at yahoo.com  Wed Nov 22 17:30:37 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Wed, 22 Nov 2006 08:30:37 -0800 (PST)
Subject: [ydf-devel] Add YDDatabaseTree3::seedTree() method and changes to
	YDDatabaseObject
Message-ID: <20061122163037.16516.qmail@web62506.mail.re1.yahoo.com>

  Hi Francisco & David,

I have a suggestion for a new method to add to YDDatabaseTree3 thatwill seed the tree. "Seeding" the tree is the process of creating thenull record with ID 1 that is essential for correct operation ofYDDatabaseTree3 trees.

This method should be used with caution since it could potentiallydestroy a tree and hence the method I created will only seed the treeif the table is empty (or the operation is not forced).

Seeding the tree also requires that the auto-increment index is resetto 1. The implementation I have used should work for MySQL >= 4.1.2( http://dev.mysql.com/doc/refman/4.1/en/alter-table.html). I am not sure if this is valid for other databases.

This is the new seed method:

        /**
         *  This function can be used to seed the tree by creating thespecial null parent node
         *
         *  Use with care!!!!
         */

        function seedTree( $force = false ) {
        
            $this->reset();
            $this->__id = 1;
            
            // count number of rows in result
            $count = $this->find();
            
            // only seed the tree if it does not have a seed
            if ( $count == 0 || $force ) {
            
                if ( $count > 0 ) {
                
                    $this->_db->executeSql( 'TRUNCATE TABLE ' .$this->_table );
                    
                }
            
                $this->_db->executeSql( 'ALTER TABLE ' .$this->_table . ' AUTO_INCREMENT = 1' );
            
                $this->reset();
        
                // create the seed row
                $this->set( $this->__id,          1 );
                $this->set( $this->__parent,   null );
                $this->set( $this->__lineage,  '' );
                $this->set( $this->__level,    0 );
                $this->set( $this->__position, 1 );                       

                return $this->insert();
            }
        }

Resetting auto-increments and other parameters might be a usefulfacility in YDDatabaseObject. Can anyone see any benefit in puttingthis functionality into YDDatabaseObject? I can imagine that drop(),truncate() methods being useful and I don't know how easy it is to makethese operations and parameter settings portable among databaseplatforms.

The alternative is to continue using executeSql for these types ofoperations. 

Regards,

Graeme

 
---------------------------------
Sponsored Link

Mortgage rates near 39yr lows. $420,000 Mortgage for $1,399/mo - Calculate new house payment
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061122/c1f6325b/attachment.html>

From ximian at mail.berlios.de  Wed Nov 22 17:31:33 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 22 Nov 2006 17:31:33 +0100
Subject: [ydf-devel] r2239 - YDFramework2.0/trunk/YDFramework2/addons/YDAjax
Message-ID: <200611221631.kAMGVXsU023295@sheep.berlios.de>

Author: ximian
Date: 2006-11-22 17:31:24 +0100 (Wed, 22 Nov 2006)
New Revision: 2239

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
- added YDAjax::isOnResponse that returns the YDAjax response state

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-22 01:28:13 UTC (rev 2238)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2006-11-22 16:31:24 UTC (rev 2239)
@@ -318,6 +318,14 @@
 
 
         /**
+         *	@returns  Boolean that defines the YDAjax state
+         */		
+		function isOnResponse() {
+			return $this->onResponse;
+		}
+
+
+        /**
          * This method gets the actual DOM id of an element by first seeing if it is a form element.
          *
          *  @param $id        Form element name or a generic id string.



From francisco at fusemail.com  Wed Nov 22 17:31:47 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 22 Nov 2006 16:31:47 +0000
Subject: [ydf-devel] Proposed changes to YDTemplate and YDAjax
In-Reply-To: <20061122125724.96181.qmail@web62506.mail.re1.yahoo.com>
References: <20061122125724.96181.qmail@web62506.mail.re1.yahoo.com>
Message-ID: <45647B73.3040900@fusemail.com>

Hi Graeme


> I've got some suggestions for changes to YDTemplate and YDAjax:
> 
>    1. Add a method YDTemplate::addJavascriptUrl to enable linked
>       javascript to be added to the template head. This provides for
>       performance improvements because it allows the xajax core
>       javascript, the accompanying effects library and any javascript
>       file to be cached.
>       http://developer.berlios.de/feature/?func=detailfeature&feature_id=2824&group_id=3988

When i start the YDAjax creation i got your problem too. I have make 
YDAjax output all js because i wanted to demonstrated that, with YDAjax, 
all that you need is a template! .. and it works ;)
Of course that, for an advanced usage it's usefull to add other js 
files/libs and to do that we need to say where is the js file.

I propose to do that in a different way: defining in YDAjax to not 
output the js header code related to xajax/effects. This way you can use 
your own lib (and include the js path in you template file).

>    2. Allow code using YDAjax to determine ajax response state (i.e.
>       whether current processing is in the context of a request or a
>       response).
>       http://developer.berlios.de/feature/?func=detailfeature&feature_id=2791&group_id=3988

Done.

>    3. Modify YDAjax to use a new effects library to replace the old
>       moofx library used by YDAjax ( http://moofx.mad4milk.net/old/ ).
>       Some thought needs to be put into the best way to go. There are
>       two choices:
> 
>     * moofx2 at http://moofx.mad4milk.net/ . This is a rearchitected
>       implementation of moofx that provides additional functionality in
>       it's lightweight 3kb implementation.
>     * mootools at http://mootools.net/ . This has been developed by the
>       same author as moofx but has much more functionality in a 25kb
>       implementation. You can see some of the functionality described at
>       http://mootools.net/download/release .
> 
>     Both options provide a richer set of effects and there are plenty of
>     good examples around for using them.
> 
>     My suggestion is to provide 3 alternative implementations of
>     YDAjaxEffects. The default would be to use the current effects
>     library, however config variable could be used to select moofx2 or
>     mootools.
> 
>     My YDLayer code uses a YDAjaxEffects implementation based on
>     mootools that is backwardly compatible with the original
>     YDAjaxEffects . My earlier e-mail describes this
>     https://lists.berlios.de/pipermail/ydframework-devel/2006-October/000717.html
>     .

YAjax is now complex and has more than the ajax logic on it. I think its 
better to segment it and put the effects and confirmations in another 
file. Otherwise it will be harder and harder to maintain.

regards
Francisco A


From francisco at fusemail.com  Wed Nov 22 17:41:30 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 22 Nov 2006 16:41:30 +0000
Subject: [ydf-devel] Add YDDatabaseTree3::seedTree() method and changes
 to	YDDatabaseObject
In-Reply-To: <20061122163037.16516.qmail@web62506.mail.re1.yahoo.com>
References: <20061122163037.16516.qmail@web62506.mail.re1.yahoo.com>
Message-ID: <45647DBA.9080203@fusemail.com>

Hi Graeme


I really don't see why you need to clean the table and start by the 
beginning.

Please don't forget YDDTree3 rule number one: Never touch the root node.

regards
Francisco A


From francisco at fusemail.com  Wed Nov 22 19:12:07 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 22 Nov 2006 18:12:07 +0000
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <abc57ff50611211835n776c4aadw9522b749bf46be35@mail.gmail.com>
References: <45631859.4020401@fusemail.com>	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>	<abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>	<45638818.909@fusemail.com>
	<abc57ff50611211835n776c4aadw9522b749bf46be35@mail.gmail.com>
Message-ID: <456492F7.9070604@fusemail.com>

Hi

> Well, we can install php-gettext or use this project
> http://upgradephp.berlios.de/
> 
> This solve problem with gettext suport.

I have installed upgradephp to get in more detail how it works i seems 
good. There are lots of functions ported and that's great.

Gettext is ported too, and this means that:

? Speed won't suffer on up-to-date servers, because functions are
   only emulated/deifned if they are missing (all function_exists
   checks are built-in; you don't have to care).

? Emulated functions sometimes run slower than the native variant
   would, but it generally shouldn't be slower than any workaround
   you used for the [advanced but not widely available] functions
   until now.

Excellent.. remember that we have some workaround created already. This 
way we don't need to care.


? If you yourself want to use a PHP application or projects, which
   depends on features not available on your server and so breaks.

My support worry is not a problem anymore.


How to use? Simpler is impossible

   if (PHP_VERSION < "4.3.0") { include("upgrade.php"); }


and we get the HUGE list with MORE THAN 150 functions !!!
including:

? stripos
? strripos
? str_ireplace
..
? array_key_exists
? array_intersect_assoc
? array_diff_assoc
..
? is_a
..
? gettext
? bindtextdomain
..


> Gettext isnt a wheel reinventing.  and to create new translations is
> very easy,  there was at least 3 editor to it.
> My mother can translate one program with gettext suport but with
> strings php in a file, is more difficult.
> 
> But you are right,  each project has your own way to keep translations.
> 
> Im just getting my opinion, because sometimes I translate projects
> (despite my bad english :) ,   and its more , more easy translate
> project with gettext than others.

Sure.
I have downloaded poEdit (the gettext editor for windows) and i must say 
this makes translations a piece of cake for 2 reasons:

1- it includes all gettext command line tools internally.

2- i only need to define the YDF directory and it scans all php files 
for translation strings and computes all new strings and deprecated strings!

This makes the developer life much more easy.. The developer only need 
to worry about the code and it don't need to worry about creating or 
even maintaining the translation files! poEditor does that for you.

I must admit that we should give a try on this.

What do you think?

Francisco A


From francisco at fusemail.com  Wed Nov 22 19:20:46 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Wed, 22 Nov 2006 18:20:46 +0000
Subject: [ydf-devel] YDDatabaseTree3::moveNode fixed
	and	YDDatabaseTree3::getTraversedTree
In-Reply-To: <20061121160008.92482.qmail@web54010.mail.yahoo.com>
References: <20061121160008.92482.qmail@web54010.mail.yahoo.com>
Message-ID: <456494FE.2060603@fusemail.com>

Hi Graeme

> I have found the cause of some of the problems with moveNode. The 
> YDDatabaseObject::set method does not work for expressions . This was 
> causing the  positions to  be updated  to the value 0. In moveNode, I 
> have changed the queries so that they are hand-coded SQL executed via 
> the YDDatabaseObject::executeSQL() method. moveNode works for moving 
> nodes within the current parent.
> 
> There is a remaining problem with nodes moved to another parent. The 
> child nodes of the moved node are not updated with the correct lineage 

Can you check b2239? I hope all bugs are fixed now.


Francisco A


From pieter at yellowduck.be  Wed Nov 22 20:33:58 2006
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Wed, 22 Nov 2006 20:33:58 +0100
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <456492F7.9070604@fusemail.com>
References: <45631859.4020401@fusemail.com>
	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
	<abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>
	<45638818.909@fusemail.com>
	<abc57ff50611211835n776c4aadw9522b749bf46be35@mail.gmail.com>
	<456492F7.9070604@fusemail.com>
Message-ID: <4aef63030611221133m332ac48fq1ac4e8dddabfb632@mail.gmail.com>

If it makes life easier, yes, we should start looking into it.

Can someone provide a simple example that shows how this works?

pieter

2006/11/22, Francisco Azevedo <francisco at fusemail.com>:
>
> Hi
>
> > Well, we can install php-gettext or use this project
> > http://upgradephp.berlios.de/
> >
> > This solve problem with gettext suport.
>
> I have installed upgradephp to get in more detail how it works i seems
> good. There are lots of functions ported and that's great.
>
> Gettext is ported too, and this means that:
>
> ? Speed won't suffer on up-to-date servers, because functions are
>   only emulated/deifned if they are missing (all function_exists
>   checks are built-in; you don't have to care).
>
> ? Emulated functions sometimes run slower than the native variant
>   would, but it generally shouldn't be slower than any workaround
>   you used for the [advanced but not widely available] functions
>   until now.
>
> Excellent.. remember that we have some workaround created already. This
> way we don't need to care.
>
>
> ? If you yourself want to use a PHP application or projects, which
>   depends on features not available on your server and so breaks.
>
> My support worry is not a problem anymore.
>
>
> How to use? Simpler is impossible
>
>   if (PHP_VERSION < "4.3.0") { include("upgrade.php"); }
>
>
> and we get the HUGE list with MORE THAN 150 functions !!!
> including:
>
> ? stripos
> ? strripos
> ? str_ireplace
> ..
> ? array_key_exists
> ? array_intersect_assoc
> ? array_diff_assoc
> ..
> ? is_a
> ..
> ? gettext
> ? bindtextdomain
> ..
>
>
> > Gettext isnt a wheel reinventing.  and to create new translations is
> > very easy,  there was at least 3 editor to it.
> > My mother can translate one program with gettext suport but with
> > strings php in a file, is more difficult.
> >
> > But you are right,  each project has your own way to keep translations.
> >
> > Im just getting my opinion, because sometimes I translate projects
> > (despite my bad english :) ,   and its more , more easy translate
> > project with gettext than others.
>
> Sure.
> I have downloaded poEdit (the gettext editor for windows) and i must say
> this makes translations a piece of cake for 2 reasons:
>
> 1- it includes all gettext command line tools internally.
>
> 2- i only need to define the YDF directory and it scans all php files
> for translation strings and computes all new strings and deprecated
> strings!
>
> This makes the developer life much more easy.. The developer only need
> to worry about the code and it don't need to worry about creating or
> even maintaining the translation files! poEditor does that for you.
>
> I must admit that we should give a try on this.
>
> What do you think?
>
> Francisco A
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>



-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061122/41bf094b/attachment.html>

From jose at psabs.com.br  Thu Nov 23 01:55:54 2006
From: jose at psabs.com.br (Jose Carlos Medeiros)
Date: Wed, 22 Nov 2006 22:55:54 -0200
Subject: [ydf-devel] Propose for a YD language repository
In-Reply-To: <4aef63030611221133m332ac48fq1ac4e8dddabfb632@mail.gmail.com>
References: <45631859.4020401@fusemail.com>
	<4aef63030611211146j6ecdd17qba6c72c69c7c07a1@mail.gmail.com>
	<abc57ff50611211452w76d856edwa303b155abe074e1@mail.gmail.com>
	<45638818.909@fusemail.com>
	<abc57ff50611211835n776c4aadw9522b749bf46be35@mail.gmail.com>
	<456492F7.9070604@fusemail.com>
	<4aef63030611221133m332ac48fq1ac4e8dddabfb632@mail.gmail.com>
Message-ID: <abc57ff50611221655l7d47c216qba4002250c5b8903@mail.gmail.com>

Gettext make life very easy :)

If anyone are doing it, I can create a example.

But its very easy,,  we put  3 lines in php setting what translation
file to use.  and all strings that need translation we put :
instead
echo "test";
we put
echo _("test");

There was others 2 or 3 functions,  one to verbals strings,

after we need to run one program,  xgettext  with some param ,
this program take all strings marked  and create a .pot file.

translator copy this file as xx_xx.po ,, ex.  pt_BR.po   , translate
file and send to you .

done,   we need one more translation :)

To update is very easy too.   We continue to editing software and
creating new strings with _("")
there was one program that update all translations putting new strings
in all .po files.

if one of these string arent translated , _() print original string.
and if is translated  print translated string.

This link,,  better example it
http://www.aota.net/forums/showthread.php?threadid=10615
or
http://www.onlamp.com/pub/a/php/2002/06/13/php.html

and this project will help
http://elonen.iki.fi/code/pophorator/

Regards,
Jose Carlos

2006/11/22, Pieter Claerhout <pieter at yellowduck.be>:
> If it makes life easier, yes, we should start looking into it.
>
> Can someone provide a simple example that shows how this works?
>
> pieter
>
> 2006/11/22, Francisco Azevedo <francisco at fusemail.com>:
> > Hi
> >
> > > Well, we can install php-gettext or use this project
> > > http://upgradephp.berlios.de/
> > >
> > > This solve problem with gettext suport.
> >
> > I have installed upgradephp to get in more detail how it works i seems
> > good. There are lots of functions ported and that's great.
> >
> > Gettext is ported too, and this means that:
> >
> > ? Speed won't suffer on up-to-date servers, because functions are
> >   only emulated/deifned if they are missing (all function_exists
> >   checks are built-in; you don't have to care).
> >
> > ? Emulated functions sometimes run slower than the native variant
> >   would, but it generally shouldn't be slower than any workaround
> >   you used for the [advanced but not widely available] functions
> >   until now.
> >
> > Excellent.. remember that we have some workaround created already. This
> > way we don't need to care.
> >
> >
> > ? If you yourself want to use a PHP application or projects, which
> >   depends on features not available on your server and so breaks.
> >
> > My support worry is not a problem anymore.
> >
> >
> > How to use? Simpler is impossible
> >
> >   if (PHP_VERSION < "4.3.0") { include("upgrade.php"); }
> >
> >
> > and we get the HUGE list with MORE THAN 150 functions !!!
> > including:
> >
> > ? stripos
> > ? strripos
> > ? str_ireplace
> > ..
> > ? array_key_exists
> > ? array_intersect_assoc
> > ? array_diff_assoc
> > ..
> > ? is_a
> > ..
> > ? gettext
> > ? bindtextdomain
> > ..
> >
> >
> > > Gettext isnt a wheel reinventing.  and to create new translations is
> > > very easy,  there was at least 3 editor to it.
> > > My mother can translate one program with gettext suport but with
> > > strings php in a file, is more difficult.
> > >
> > > But you are right,  each project has your own way to keep translations.
> > >
> > > Im just getting my opinion, because sometimes I translate projects
> > > (despite my bad english :) ,   and its more , more easy translate
> > > project with gettext than others.
> >
> > Sure.
> > I have downloaded poEdit (the gettext editor for windows) and i must say
> > this makes translations a piece of cake for 2 reasons:
> >
> > 1- it includes all gettext command line tools internally.
> >
> > 2- i only need to define the YDF directory and it scans all php files
> > for translation strings and computes all new strings and deprecated
> strings!
> >
> > This makes the developer life much more easy.. The developer only need
> > to worry about the code and it don't need to worry about creating or
> > even maintaining the translation files! poEditor does that for you.
> >
> > I must admit that we should give a try on this.
> >
> > What do you think?
> >
> > Francisco A
> > _______________________________________________
> > YDFramework-devel mailing list
> > YDFramework-devel at lists.berlios.de
> >
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
> >
>
>
>
>  --
>
> pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
> _______________________________________________
> YDFramework-devel mailing list
> YDFramework-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/ydframework-devel
>
>
>


-- 
[]'s
Jos? Carlos

From maximus_meridius79 at yahoo.com  Thu Nov 23 13:09:19 2006
From: maximus_meridius79 at yahoo.com (maximus meridius)
Date: Thu, 23 Nov 2006 04:09:19 -0800 (PST)
Subject: [ydf-devel] Proposed changes to YDTemplate and YDAjax
Message-ID: <20061123120920.27590.qmail@web62501.mail.re1.yahoo.com>

  Francisco Azevedo wrote:      
I've got some suggestions for changes to YDTemplate and YDAjax:   1. Add a method YDTemplate::addJavascriptUrl to enable linked      javascript to be added to the template head. This provides for      performance improvements because it allows the xajax core      javascript, the accompanying effects library and any javascript      file to be cached.      http://developer.berlios.de/feature/?func=detailfeature&feature_id=2824&group_id=3988    
    
When i start the YDAjax creation i got your problem too. I have make YDAjax output all js because i wanted to demonstrated that, with YDAjax, all that you need is a template! .. and it works ;)Of course that, for an advanced usage it's usefull to add other js files/libs and to do that we need to say where is the js file.I propose to do that in a different way: defining in YDAjax to not output the js header code related to xajax/effects. This way you can use your own lib (and include the js path in you template file).  
So will this also disable the default YDAjaxEffects class?
  

      
   2. Allow code using YDAjax to determine ajax response state (i.e.      whether current processing is in the context of a request or a      response).      http://developer.berlios.de/feature/?func=detailfeature&feature_id=2791&group_id=3988    
    
Done.  
Thanks.
  

      
   3. Modify YDAjax to use a new effects library to replace the old      moofx library used by YDAjax ( http://moofx.mad4milk.net/old/ ).      Some thought needs to be put into the best way to go. There are      two choices:    * moofx2 at http://moofx.mad4milk.net/ . This is a rearchitected      implementation of moofx that provides additional functionality in      it's lightweight 3kb implementation.    * mootools at http://mootools.net/ . This has been developed by the      same author as moofx but has much more functionality in a 25kb      implementation. You can see some of the functionality described at      http://mootools.net/download/release .    Both options provide a richer set of effects and there are plenty of    good examples around for using them.    My suggestion is to provide 3 alternative implementations of    YDAjaxEffects. The default would be to use the current effects    library, however config variable could be used to select moofx2 or    mootools.   
 My YDLayer code uses a YDAjaxEffects implementation based on    mootools that is backwardly compatible with the original    YDAjaxEffects . My earlier e-mail describes this    https://lists.berlios.de/pipermail/ydframework-devel/2006-October/000717.html    .    
    
YAjax is now complex and has more than the ajax logic on it. I think its better to segment it and put the effects and confirmations in another file. Otherwise it will be harder and harder to maintain.  
This is a good suggestion to make effects separate to YDAjax. You justneed to maintain backward compatibility.

Regards,

Graeme

 
---------------------------------
Cheap Talk? Check out Yahoo! Messenger's low PC-to-Phone call rates.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061123/323d9aea/attachment.html>

From francisco at fusemail.com  Thu Nov 23 17:15:51 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 23 Nov 2006 10:15:51 -0600 (CST)
Subject: [ydf-devel] Propose for a YD language repository
Message-ID: <1164298551.v2.fusewebmail-15630@f>

Hi

> But its very easy,,  we put  3 lines in php setting what translation
> file to use.  and all strings that need translation we put :
> instead
> echo "test";
> we put
> echo _("test");
>
> There was others 2 or 3 functions,  one to verbals strings,
>
> after we need to run one program,  xgettext  with some param ,
> this program take all strings marked  and create a .pot file.
>
> translator copy this file as xx_xx.po ,, ex.  pt_BR.po   , translate
> file and send to you .
>
> done,   we need one more translation :)
>
> To update is very easy too.   We continue to editing software and
> creating new strings with _("")
> there was one program that update all translations putting new strings
> in all .po files.
>
> if one of these string arent translated , _() print original string.
> and if is translated  print translated string.

Basically, to use gettext we need to:

- define the current language code and directory where the translation
files reside (using gettext functions).

- use function
  _('String to be translated');

  instead of

  $_GLOBALS['t']['string_trans'] = 'String to be translated';
  t('string_trans');

- Then opEditor can do the rest:
  * scans all *.php files for _() functions to get the strings
  * updates its own translation files
  * mark all new strings in yellow
  * delete all strings that are not used anymore
  * exports the translation file to a .mo used by gettext


regards
Francisco A


From francisco at fusemail.com  Thu Nov 23 17:19:41 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Thu, 23 Nov 2006 10:19:41 -0600 (CST)
Subject: [ydf-devel] Proposed changes to YDTemplate and YDAjax
Message-ID: <1164298781.v2.fusewebmail-15630@f>

>> YAjax is now complex and has more than the ajax logic on it. I think its
>> better to segment it and put the effects and confirmations in another
>> file. Otherwise it will be harder and harder to maintain.
>>
> This is a good suggestion to make effects separate to YDAjax. You just
> need to maintain backward compatibility.


I don't know if that will be possible but let's see. Effects are not my
priority in this moment.


Francisco A


From pclaerhout at mail.berlios.de  Thu Nov 23 21:04:54 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 23 Nov 2006 21:04:54 +0100
Subject: [ydf-devel] r2240 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples/weblog examples/weblog/include
	examples/weblog/include/languages
Message-ID: <200611232004.kANK4sCO001901@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-23 21:04:54 +0100 (Thu, 23 Nov 2006)
New Revision: 2240

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Added a form rule that prevents people from adding more than 1 hyperlink to a comment (as another item in my ongoing quest to combat comment spam).

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -171,6 +171,7 @@
             $this->registerRule( 'maxlength_escape', array( 'YDValidateRules', 'maxlength_escape' ), 'YDValidateRules.php' );
             $this->registerRule( 'rangelength_escape', array( 'YDValidateRules', 'rangelength_escape' ), 'YDValidateRules.php' );
             $this->registerRule( 'httpurl', array( 'YDValidateRules', 'httpurl' ), 'YDValidateRules.php' );
+            $this->registerRule( 'maxhyperlinks', array( 'YDValidateRules', 'maxhyperlinks' ), 'YDValidateRules.php' );
 
             // Add the filters
             $this->registerFilter( 'trim', 'trim' );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -358,6 +358,27 @@
         }
 
         /**
+         *	This function returns true if the variable is containing less hyperlinks than indicated, otherwise, it
+         *	returns false.
+         *
+         *	@param $val		The value to test.
+         *	@param $opts	The maximum amount of hyperlinks that are allowed.
+         */
+        function maxhyperlinks( $val, $opts ) {
+            $count = intval( $opts );
+            $count1 = preg_match_all( "/href=/i", $val, $matches1 );
+            $count2 = preg_match_all( "/\[url=/i", $val, $matches2 );
+            if ( ( $count1 + $count2 ) > $count ) {
+                return false;
+            }
+            $count = preg_match_all( "/http\:\/\//i", $val, $matches );
+            if ( ( $count ) > $count ) {
+                return false;
+            }
+            return true;
+        }
+
+        /**
          *	This rule checks if a string contains the maximum specified words or not.
          *
          *	@param $val		The value to test.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -595,19 +595,6 @@
 
             }
 
-            // Check the amount of hyperlinks in the comments. More than 1 is marked as spam.
-            $count1 = preg_match_all( "/href=/i", $values['comment'], $matches1 );
-            $count2 = preg_match_all( "/\[url=/i", $values['comment'], $matches2 );
-            if ( ( $count1 + $count2 ) > 1 ) {
-                $values['is_spam'] = '1';
-            }
-
-            // Only 2 http links are allowed
-            $count = preg_match_all( "/http\:\/\//i", $values['comment'], $matches );
-            if ( ( $count ) > 1 ) {
-                $values['is_spam'] = '1';
-            }
-
             // Add the comment
             $result = $this->_executeInsert( '#_comments', $values );
             $comment_id = $this->db->getLastInsertID();

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -90,7 +90,8 @@
 $GLOBALS['t']['err_email'] = 'Email is missing or invalid';
 $GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
 $GLOBALS['t']['err_comment'] = 'Comment is required';
-$GLOBALS['t']['err_comment_length'] = 'Comment is cannot be more than 2048 characters';
+$GLOBALS['t']['err_comment_length'] = 'Comment cannot be more than 2048 characters';
+$GLOBALS['t']['err_comment_links'] = 'Comment cannot contain more than 1 hyperlink';
 $GLOBALS['t']['with'] = 'for';
 $GLOBALS['t']['item_closed'] = 'This item does not allow comments.';
 $GLOBALS['t']['spam'] = 'Spam';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -91,6 +91,7 @@
 $GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
 $GLOBALS['t']['err_comment_length'] = 'Commentaar kan niet meer dan 2048 karakters bevatten';
+$GLOBALS['t']['err_comment_links'] = 'Commentaar kan niet meer dan 1 hyperlink bevatten';
 $GLOBALS['t']['with'] = 'bij';
 $GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';
 $GLOBALS['t']['spam'] = 'Spam';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-11-22 16:31:24 UTC (rev 2239)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-11-23 20:04:54 UTC (rev 2240)
@@ -67,14 +67,15 @@
             $form->setDefaults( $defaults );
 
             // Set the rules
-            $form->addRule( 'username',    'required',  t( 'err_name' ) );
-            $form->addRule( 'username',    'not_email', t( 'err_name_email' ) );
-            $form->addRule( 'username',    'maxlength', t( 'err_name_length' ), 35 );
-            $form->addRule( 'useremail',   'email',     t( 'err_email' ) );
-            $form->addRule( 'useremail',   'required',  t( 'err_email' ) );
-            $form->addRule( 'userwebsite', 'httpurl',   t( 'err_website' ) );
-            $form->addRule( 'comment',     'required',  t( 'err_comment' ) );
-            $form->addRule( 'comment',     'maxlength', t( 'err_comment_length' ), 2048 );
+            $form->addRule( 'username',    'required',      t( 'err_name' ) );
+            $form->addRule( 'username',    'not_email',     t( 'err_name_email' ) );
+            $form->addRule( 'username',    'maxlength',     t( 'err_name_length' ), 35 );
+            $form->addRule( 'useremail',   'email',         t( 'err_email' ) );
+            $form->addRule( 'useremail',   'required',      t( 'err_email' ) );
+            $form->addRule( 'userwebsite', 'httpurl',       t( 'err_website' ) );
+            $form->addRule( 'comment',     'required',      t( 'err_comment' ) );
+            $form->addRule( 'comment',     'maxlength',     t( 'err_comment_length' ), 2048 );
+            $form->addRule( 'comment',     'maxhyperlinks', t( 'err_comment_links' ), 1 );
 
             // Add the filters
             $form->addFilters( array( 'username', 'useremail', 'userwebsite' ), 'strip_html' );



From rene at reneschmidt.de  Sun Nov 26 13:13:59 2006
From: rene at reneschmidt.de (Rene Schmidt)
Date: Sun, 26 Nov 2006 13:13:59 +0100
Subject: [ydf-devel] Small bug in YDUrl
Message-ID: <45698507.4070704@reneschmidt.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

there is a small bug in YDUrl::getPassword(). It wants to return an
attribute named "password", but it's name is "pass" so it would return
only "". You may want to fix that :)

Just change

        function getPassword() {
            return $this->getNamedPart( 'password' );
        }

into

        function getPassword() {
            return $this->getNamedPart( 'pass' );
        }

- --
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFFaYUGa8BQAFpXn2cRAq7KAJ9DX9QconxVkHjBXGHYlgWmHz6Y8gCdEfD3
/Iux6H/dnWx49iD9ywGLzcY=
=IG1u
-----END PGP SIGNATURE-----


From rene at reneschmidt.de  Sun Nov 26 16:14:44 2006
From: rene at reneschmidt.de (Rene Schmidt)
Date: Sun, 26 Nov 2006 16:14:44 +0100
Subject: [ydf-devel] Adding DSN support to YDDatabase
Message-ID: <4569AF64.7020906@reneschmidt.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

other database abstraction layers such als PEAR::DB support DSN strings
for defining database access information such as

"mysql://user:password at host/database"

When using both YDF and PEAR:DB (e.g. GoogleMapsAPI by Monte Ohrt) one
has to define the same access data two times, ydf-style and as DSN.
Cumbersome.

See attached file for adding DSN support to YDDatabase, feel free to add
that tiny code snippet to YDF's code base, thank you.
- --
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.3 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFFaa9ja8BQAFpXn2cRAgtsAJ9JCANLdL7DqJOg8OaTO3Gfsad5EACgz/pq
eTK0UykUW42H4DMR5K3qEYI=
=Sb3L
-----END PGP SIGNATURE-----
-------------- next part --------------
A non-text attachment was scrubbed...
Name: YDRSDatabase.php
Type: application/x-php
Size: 727 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20061126/c6746cec/attachment.bin>

From ximian at mail.berlios.de  Sun Nov 26 18:53:29 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Sun, 26 Nov 2006 18:53:29 +0100
Subject: [ydf-devel] r2241 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611261753.kAQHrTcs029744@sheep.berlios.de>

Author: ximian
Date: 2006-11-26 18:53:21 +0100 (Sun, 26 Nov 2006)
New Revision: 2241

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
Log:
- fixed typo when getting password in YDUrl::getPassword ( by Rene Schmidt )

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2006-11-23 20:04:54 UTC (rev 2240)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2006-11-26 17:53:21 UTC (rev 2241)
@@ -195,7 +195,7 @@
          *	@returns	The password part of the URL.
          */
         function getPassword() {
-            return $this->getNamedPart( 'password' );
+            return $this->getNamedPart( 'pass' );
         }
 
         /**



From francisco at fusemail.com  Sun Nov 26 18:55:25 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 26 Nov 2006 11:55:25 -0600 (CST)
Subject: [ydf-devel] Small bug in YDUrl
Message-ID: <1164563725.v2.fusewebmail-15630@f>

Hi Rene

> there is a small bug in YDUrl::getPassword(). It wants to return an
> attribute named "password", but it's name is "pass" so it would return
> only "". You may want to fix that :)


Fixed on b 2241. Thanks.


Francisco A


From ximian at mail.berlios.de  Sun Nov 26 19:15:03 2006
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Sun, 26 Nov 2006 19:15:03 +0100
Subject: [ydf-devel] r2242 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611261815.kAQIF3ii010804@sheep.berlios.de>

Author: ximian
Date: 2006-11-26 19:15:02 +0100 (Sun, 26 Nov 2006)
New Revision: 2242

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
- added support for DSN strings in YDDatabase::registerInstance
  Now it's possible to register an instance as YDDatabase::registerInstance( 'default', 'mysql://user:password at host/database' );

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-26 17:53:21 UTC (rev 2241)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2006-11-26 18:15:02 UTC (rev 2242)
@@ -622,19 +622,30 @@
          *  This function registers a named database instance.
          *
          *  @param $name    The name of the database instance.
-         *  @param $driver  Name of the database driver or array containing drivername, file name and class name.
-         *  @param $db      Database name to use for the connection.
+         *  @param $driver  Name of the database driver, DNS string or array containing drivername, file name and class name.
+         *  @param $db      (optional) Database name to use for the connection. If empty, we are using a DSN string in driver.
          *  @param $user    (optional) User name to use for the connection.
          *  @param $pass    (optional) Password to use for the connection.
          *  @param $host    (optional) Host name to use for the connection.
          *
          *  @static
          */
-        function registerInstance( $name, $driver, $db, $user='', $pass='', $host='' ) {
+        function registerInstance( $name, $driver, $db='', $user='', $pass='', $host='' ) {
 
             // Check if the global array exists
             YDDatabase::_initNamedInstances();
 
+			// Check if we are using a DSN string, e.g. "mysql://user:password at host/database"
+			if ( $db == '' ){
+
+				$dsn    = new YDUrl( $driver );
+				$driver = $dsn->getScheme();
+				$db     = substr( $dsn->getPath(), 1 );
+				$user   = $dsn->getUser();
+				$pass   = $dsn->getPassword();
+				$host   = $dsn->getHost();
+			}
+
             // Register the instance
             $GLOBALS['YD_DB_INSTANCES'][ strtolower( $name ) ] = array( $driver, $db, $user, $pass, $host );
 



From francisco at fusemail.com  Sun Nov 26 19:19:56 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 26 Nov 2006 12:19:56 -0600 (CST)
Subject: [ydf-devel] Adding DSN support to YDDatabase
Message-ID: <1164565196.v2.fusewebmail-15630@f>

Hi

> other database abstraction layers such als PEAR::DB support DSN strings
> for defining database access information such as
>
> "mysql://user:password at host/database"
>
> When using both YDF and PEAR:DB (e.g. GoogleMapsAPI by Monte Ohrt) one
> has to define the same access data two times, ydf-style and as DSN.
> Cumbersome.
>
> See attached file for adding DSN support to YDDatabase, feel free to add
> that tiny code snippet to YDF's code base, thank you.


Added support inside YDDatabase::registerInstance so that we don't need
another class for it:

YDDatabase::registerInstance( 'default',
'mysql://user:password at host/database' );


Francisco A



From francisco at fusemail.com  Mon Nov 27 00:42:15 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Sun, 26 Nov 2006 17:42:15 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject bug
Message-ID: <1164584535.v2.fusewebmail-15630@f>

Hi db,

Look to this example.
2 tables: company and users

companies

+----+-------------+
| id | name        |
+----+-------------+
|  1 | CarsAndCars |
|  2 | WeRepairIt  |
|  3 | Carseller   |
|  4 | RepairOK    |
+----+-------------+

users

+----+-------------+------------+----------------+-------------+
| id | name        |car         | company_shop   | company_rep |
+----+-------------+------------+----------------+-------------+
|  1 | Francisco   | Fiat       |       1        |        2    |
|  2 | Pieter      | Ferrari    |       3        |        4    |
+----+-------------+------------+----------------+-------------+


The problem is that when i create the users YDObject extension i cannot
register the second relation:

$rel = & $this->registerRelation( 'company_shop', false, 'companies' );
$rel->setLocalKey( 'company_shop' );
$rel->setForeignKey( 'id' );

$rel = & $this->registerRelation( 'company_rep', false, 'companies' );
$rel->setLocalKey( 'company_rep' );
$rel->setForeignKey( 'id' );


It says 'companies' is already in use. Of course is in use but i want to
get all details of repair companies too when finding users:

// get info of 'Francisco'
$this->set( 'id', 1 );
$this->findAll();


Maybe this is a bug?


regards
Francisco A


From pclaerhout at mail.berlios.de  Mon Nov 27 16:00:07 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Nov 2006 16:00:07 +0100
Subject: [ydf-devel] r2243 - in YDFramework2.0/trunk/examples/weblog: .
	include/languages
Message-ID: <200611271500.kARF07NB014928@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-27 16:00:07 +0100 (Mon, 27 Nov 2006)
New Revision: 2243

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/item.php
Log:
Changed the maximum length of comments to 1500 instead of 2048.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-26 18:15:02 UTC (rev 2242)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-11-27 15:00:07 UTC (rev 2243)
@@ -90,7 +90,7 @@
 $GLOBALS['t']['err_email'] = 'Email is missing or invalid';
 $GLOBALS['t']['err_website'] = 'The website specified is not a valid URL';
 $GLOBALS['t']['err_comment'] = 'Comment is required';
-$GLOBALS['t']['err_comment_length'] = 'Comment cannot be more than 2048 characters';
+$GLOBALS['t']['err_comment_length'] = 'Comment cannot be more than 1500 characters';
 $GLOBALS['t']['err_comment_links'] = 'Comment cannot contain more than 1 hyperlink';
 $GLOBALS['t']['with'] = 'for';
 $GLOBALS['t']['item_closed'] = 'This item does not allow comments.';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-26 18:15:02 UTC (rev 2242)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-11-27 15:00:07 UTC (rev 2243)
@@ -90,7 +90,7 @@
 $GLOBALS['t']['err_email'] = 'Email is niet ingegeven of niet correct';
 $GLOBALS['t']['err_website'] = 'De website is geen geldige URL';
 $GLOBALS['t']['err_comment'] = 'Een commentaar is vereist';
-$GLOBALS['t']['err_comment_length'] = 'Commentaar kan niet meer dan 2048 karakters bevatten';
+$GLOBALS['t']['err_comment_length'] = 'Commentaar kan niet meer dan 1500 karakters bevatten';
 $GLOBALS['t']['err_comment_links'] = 'Commentaar kan niet meer dan 1 hyperlink bevatten';
 $GLOBALS['t']['with'] = 'bij';
 $GLOBALS['t']['item_closed'] = 'Dit item laat geen commentaren toe.';

Modified: YDFramework2.0/trunk/examples/weblog/item.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/item.php	2006-11-26 18:15:02 UTC (rev 2242)
+++ YDFramework2.0/trunk/examples/weblog/item.php	2006-11-27 15:00:07 UTC (rev 2243)
@@ -74,7 +74,7 @@
             $form->addRule( 'useremail',   'required',      t( 'err_email' ) );
             $form->addRule( 'userwebsite', 'httpurl',       t( 'err_website' ) );
             $form->addRule( 'comment',     'required',      t( 'err_comment' ) );
-            $form->addRule( 'comment',     'maxlength',     t( 'err_comment_length' ), 2048 );
+            $form->addRule( 'comment',     'maxlength',     t( 'err_comment_length' ), 1500 );
             $form->addRule( 'comment',     'maxhyperlinks', t( 'err_comment_links' ), 1 );
 
             // Add the filters



From pclaerhout at mail.berlios.de  Mon Nov 27 17:11:30 2006
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 27 Nov 2006 17:11:30 +0100
Subject: [ydf-devel] r2244 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611271611.kARGBUBB012796@sheep.berlios.de>

Author: pclaerhout
Date: 2006-11-27 17:11:30 +0100 (Mon, 27 Nov 2006)
New Revision: 2244

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
Log:
Fixed a small bugs in YDValidateRules::maxhyperlinks.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-11-27 15:00:07 UTC (rev 2243)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2006-11-27 16:11:30 UTC (rev 2244)
@@ -371,8 +371,8 @@
             if ( ( $count1 + $count2 ) > $count ) {
                 return false;
             }
-            $count = preg_match_all( "/http\:\/\//i", $val, $matches );
-            if ( ( $count ) > $count ) {
+            $count3 = preg_match_all( "/http\:\/\//i", $val, $matches );
+            if ( ( $count3 ) > $count ) {
                 return false;
             }
             return true;



From francisco at fusemail.com  Mon Nov 27 21:43:04 2006
From: francisco at fusemail.com (Francisco Azevedo)
Date: Mon, 27 Nov 2006 14:43:04 -0600 (CST)
Subject: [ydf-devel] YDDatabaseObject bug
Message-ID: <1164660184.v2.fusewebmail-15630@f>

> The problem is that when i create the users YDObject extension i cannot
> register the second relation:
>
> $rel = & $this->registerRelation( 'company_shop', false, 'companies' );
> $rel->setLocalKey( 'company_shop' );
> $rel->setForeignKey( 'id' );
>
> $rel = & $this->registerRelation( 'company_rep', false, 'companies' );
> $rel->setLocalKey( 'company_rep' );
> $rel->setForeignKey( 'id' );
>
>
> It says 'companies' is already in use. Of course is in use but i want to
> get all details of repair companies too when finding users:


That's because i didn't use setForeignVar().


$rel = & $this->registerRelation( 'company_shop', false, 'companies' );
$rel->setLocalKey( 'company_shop' );
$rel->setForeignKey( 'id' );
$rel->setForeignVar( 'shop' );

$rel = & $this->registerRelation( 'company_rep', false, 'companies' );
$rel->setLocalKey( 'company_rep' );
$rel->setForeignKey( 'id' );
$rel->setForeignVar( 'repair' );


Francisco A


From ximian at mail.berlios.de  Wed Nov 29 19:39:52 2006
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 29 Nov 2006 19:39:52 +0100
Subject: [ydf-devel] r2245 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200611291839.kATIdq8Q015331@sheep.berlios.de>

Author: ximian
Date: 2006-11-29 19:39:46 +0100 (Wed, 29 Nov 2006)
New Revision: 2245

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
- fixed typo in YDRequest

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-11-27 16:11:30 UTC (rev 2244)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2006-11-29 18:39:46 UTC (rev 2245)
@@ -165,7 +165,7 @@
         /**
          *	This function will return the full URL to the current request, including hostname, port and request URI.
          *
-         *  @param  $no_qs  (optional) If set to false, the query string will be omitted. Default is false.
+         *  @param  $no_qs  (optional) If set to true, the query string will be omitted. Default is false.
          *  @param  $use_ip (optional) If set to true, the IP address of the server will be used instead of the
          *                  hostname. Default is false.
          *



