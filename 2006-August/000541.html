<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: . backend
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ydframework-devel/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r2034%20-%20in%20YDFramework2.0/trunk/examples/cm%3A%20.%20backend&In-Reply-To=%3C200608221539.k7MFdgRR001834%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000540.html">
   <LINK REL="Next"  HREF="000542.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: . backend</H1>
    <B>ximian at mail.berlios.de</B> 
    <A HREF="mailto:ydframework-devel%40lists.berlios.de?Subject=Re%3A%20%5Bydf-devel%5D%20r2034%20-%20in%20YDFramework2.0/trunk/examples/cm%3A%20.%20backend&In-Reply-To=%3C200608221539.k7MFdgRR001834%40sheep.berlios.de%3E"
       TITLE="[ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: . backend">ximian at mail.berlios.de
       </A><BR>
    <I>Tue Aug 22 17:39:42 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000540.html">[ydf-devel] r2033 -	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
</A></li>
        <LI>Next message: <A HREF="000542.html">[ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: .	backend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#541">[ date ]</a>
              <a href="thread.html#541">[ thread ]</a>
              <a href="subject.html#541">[ subject ]</a>
              <a href="author.html#541">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ximian
Date: 2006-08-22 17:38:40 +0200 (Tue, 22 Aug 2006)
New Revision: 2034

Modified:
   YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
   YDFramework2.0/trunk/examples/cm/backend/userdetails.php
   YDFramework2.0/trunk/examples/cm/cm.php
Log:
updated userdetails cm example and db scheme for new YDCMUsers version

Modified: YDFramework2.0/trunk/examples/cm/DBDesigner4.xml
===================================================================
--- YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/DBDesigner4.xml	2006-08-22 15:38:40 UTC (rev 2034)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot; ?&gt;
 &lt;DBMODEL Version=&quot;4.0&quot;&gt;
 &lt;SETTINGS&gt;
-&lt;GLOBALSETTINGS ModelName=&quot;YDCM scheme&quot; IDModel=&quot;0&quot; IDVersion=&quot;0&quot; VersionStr=&quot;1.0.0.0&quot; Comments=&quot;&quot; UseVersionHistroy=&quot;1&quot; AutoIncVersion=&quot;1&quot; DatabaseType=&quot;MySQL&quot; ZoomFac=&quot;74.00&quot; XPos=&quot;119&quot; YPos=&quot;31&quot; DefaultDataType=&quot;5&quot; DefaultTablePrefix=&quot;0&quot; DefSaveDBConn=&quot;&quot; DefSyncDBConn=&quot;&quot; DefQueryDBConn=&quot;&quot; Printer=&quot;&quot; HPageCount=&quot;4.0&quot; PageAspectRatio=&quot;1.440892512336408&quot; PageOrientation=&quot;1&quot; PageFormat=&quot;A4 (210x297 mm, 8.26x11.7 inches)&quot; SelectedPages=&quot;&quot; UsePositionGrid=&quot;1&quot; PositionGridX=&quot;20&quot; PositionGridY=&quot;20&quot; TableNameInRefs=&quot;0&quot; DefaultTableType=&quot;0&quot; ActivateRefDefForNewRelations=&quot;1&quot; FKPrefix=&quot;&quot; FKPostfix=&quot;&quot; CreateFKRefDefIndex=&quot;0&quot; DBQuoteCharacter=&quot;`&quot; CreateSQLforLinkedObjects=&quot;0&quot; DefModelFont=&quot;Tahoma&quot; CanvasWidth=&quot;4096&quot; CanvasHeight=&quot;2842&quot; /&gt;
+&lt;GLOBALSETTINGS ModelName=&quot;YDCM scheme&quot; IDModel=&quot;0&quot; IDVersion=&quot;0&quot; VersionStr=&quot;1.0.0.0&quot; Comments=&quot;&quot; UseVersionHistroy=&quot;1&quot; AutoIncVersion=&quot;1&quot; DatabaseType=&quot;MySQL&quot; ZoomFac=&quot;74.00&quot; XPos=&quot;102&quot; YPos=&quot;31&quot; DefaultDataType=&quot;5&quot; DefaultTablePrefix=&quot;0&quot; DefSaveDBConn=&quot;&quot; DefSyncDBConn=&quot;&quot; DefQueryDBConn=&quot;&quot; Printer=&quot;&quot; HPageCount=&quot;4.0&quot; PageAspectRatio=&quot;1.440892512336408&quot; PageOrientation=&quot;1&quot; PageFormat=&quot;A4 (210x297 mm, 8.26x11.7 inches)&quot; SelectedPages=&quot;&quot; UsePositionGrid=&quot;1&quot; PositionGridX=&quot;20&quot; PositionGridY=&quot;20&quot; TableNameInRefs=&quot;0&quot; DefaultTableType=&quot;0&quot; ActivateRefDefForNewRelations=&quot;1&quot; FKPrefix=&quot;&quot; FKPostfix=&quot;&quot; CreateFKRefDefIndex=&quot;0&quot; DBQuoteCharacter=&quot;`&quot; CreateSQLforLinkedObjects=&quot;0&quot; DefModelFont=&quot;Tahoma&quot; CanvasWidth=&quot;4096&quot; CanvasHeight=&quot;2842&quot; /&gt;
 &lt;DATATYPEGROUPS&gt;
 &lt;DATATYPEGROUP Name=&quot;Numeric Types&quot; Icon=&quot;1&quot; /&gt;
 &lt;DATATYPEGROUP Name=&quot;Date and Time Types&quot; Icon=&quot;2&quot; /&gt;
@@ -1027,7 +1027,7 @@
 &lt;/INDEX&gt;
 &lt;/INDICES&gt;
 &lt;/TABLE&gt;
-&lt;TABLE ID=&quot;1771&quot; Tablename=&quot;YDCMPermissions&quot; PrevTableName=&quot;Table_14&quot; XPos=&quot;800&quot; YPos=&quot;620&quot; TableType=&quot;0&quot; TablePrefix=&quot;0&quot; nmTable=&quot;0&quot; Temporary=&quot;0&quot; UseStandardInserts=&quot;0&quot; StandardInserts=&quot;INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (118,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`da!
 te_end`,`user_id`) VALUES (120,\aYDCMPage\a,\apublish\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`object_id`,`schedule`,`date_start`,`date_end`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,NULL,0,\a0000-00-00 00:00:00\a,\a0000-00-00 00:00:00\a,101);\n&quot; TableOptions=&quot;DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n&quot; Comments=&quot;&quot; Collapsed=&quot;0&quot; IsLinkedObject=&quot;0&quot; IDLinkedModel=&quot;-1&quot; Obj_id_Linked=&quot;-1&quot; OrderPos=&quot;37&quot; &gt;
+&lt;TABLE ID=&quot;1771&quot; Tablename=&quot;YDCMPermissions&quot; PrevTableName=&quot;Table_14&quot; XPos=&quot;800&quot; YPos=&quot;620&quot; TableType=&quot;0&quot; TablePrefix=&quot;0&quot; nmTable=&quot;0&quot; Temporary=&quot;0&quot; UseStandardInserts=&quot;0&quot; StandardInserts=&quot;INSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (117,\aYDCMRootmenu\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (118,\aYDCMPage\a,\adelete\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (119,\aYDCMPage\a,\acreate\a,100);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (120,\aYDCMPage\a,\adelete\a,101);\nINSERT INTO `ydcmpermissions` (`permission_id`,`object`,`object_action`,`user_id`) VALUES (121,\aYDCMPage\a,\acreate\a,101);\n&quot; TableOptions=&quot;DelayKeyTblUpdates=0\nPackKeys=0\nRowChecksum=0\nRowFormat=0\nUseRaid=0\nRaidType=0\n&quot; Comments=&quot;&quot; Collapsed=&quot;0&quot; IsLinkedObject=&quot;0&quot; IDLinkedModel=&quot;-1&quot;!
  Obj_id_Linked=&quot;-1&quot; OrderPos=&quot;37&quot; &gt;
 &lt;COLUMNS&gt;
 &lt;COLUMN ID=&quot;1781&quot; ColName=&quot;permission_id&quot; PrevColName=&quot;&quot; Pos=&quot;7&quot; idDatatype=&quot;5&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;1&quot; NotNull=&quot;1&quot; AutoInc=&quot;1&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
 &lt;OPTIONSELECTED&gt;
@@ -1051,26 +1051,6 @@
 &lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
 &lt;/OPTIONSELECTED&gt;
 &lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1777&quot; ColName=&quot;object_id&quot; PrevColName=&quot;&quot; Pos=&quot;3&quot; idDatatype=&quot;5&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;0&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
-&lt;OPTIONSELECTED&gt;
-&lt;OPTIONSELECT Value=&quot;1&quot; /&gt;
-&lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
-&lt;/OPTIONSELECTED&gt;
-&lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1778&quot; ColName=&quot;schedule&quot; PrevColName=&quot;&quot; Pos=&quot;4&quot; idDatatype=&quot;1&quot; DatatypeParams=&quot;(1)&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;0&quot; Comments=&quot;This permission has start and date time&quot;&gt;
-&lt;OPTIONSELECTED&gt;
-&lt;OPTIONSELECT Value=&quot;1&quot; /&gt;
-&lt;OPTIONSELECT Value=&quot;0&quot; /&gt;
-&lt;/OPTIONSELECTED&gt;
-&lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1779&quot; ColName=&quot;date_start&quot; PrevColName=&quot;&quot; Pos=&quot;5&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
-&lt;OPTIONSELECTED&gt;
-&lt;/OPTIONSELECTED&gt;
-&lt;/COLUMN&gt;
-&lt;COLUMN ID=&quot;1780&quot; ColName=&quot;date_end&quot; PrevColName=&quot;&quot; Pos=&quot;6&quot; idDatatype=&quot;15&quot; DatatypeParams=&quot;&quot; Width=&quot;-1&quot; Prec=&quot;-1&quot; PrimaryKey=&quot;0&quot; NotNull=&quot;1&quot; AutoInc=&quot;0&quot; IsForeignKey=&quot;0&quot; DefaultValue=&quot;&quot; Comments=&quot;&quot;&gt;
-&lt;OPTIONSELECTED&gt;
-&lt;/OPTIONSELECTED&gt;
-&lt;/COLUMN&gt;
 &lt;/COLUMNS&gt;
 &lt;RELATIONS_START&gt;
 &lt;RELATION_START ID=&quot;1785&quot; /&gt;

Modified: YDFramework2.0/trunk/examples/cm/backend/userdetails.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/backend/userdetails.php	2006-08-22 15:38:40 UTC (rev 2034)
@@ -17,57 +17,62 @@
 
 
         // Default action (that shows user details form with some editable fields)
-		// User should only update his details eg name, email
         function actionDefault() {
 
-			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
-			$this-&gt;users-&gt;addFormDetails( false, false, false, true );
+			// get user id 101 details and display them
+			YDDebugUtil::dump( $this-&gt;users-&gt;getUser( 101, true ) );
+        }
 
-			// get info of user id 100
-			$defaults = $this-&gt;users-&gt;getUser( 100 );
 
-			// get user form (filled with previous defaults)
-			$form = $this-&gt;users-&gt;getForm( $defaults );
+        // Edit user example
+        function actionEdit() {
 
-			// show form :)
-			$form-&gt;display();
-        }
+			// add form of user 101. User cannot edit username, cannot see password, cannot see login details, can edit user details, cannot see access info, cannot see permissions
+			$this-&gt;users-&gt;addFormEdit( 101, false, null, null, true, null, true );
 
+			// get user form and add a custom submit button
+			$form = &amp; $this-&gt;users-&gt;getForm();
 
-        // Change details example
-        function actionChangeDetails() {
+			// if form is not submitted just show it
+			if ( ! $form-&gt;isSubmitted() ) return $form-&gt;display();
 
-			// add form. User cannot edit username, cannot see password, cannot edit login details, can edit user details
-			$this-&gt;users-&gt;addFormDetails( false, false, false, true );
+			// update user 101 with submitted information, magic isn't it ;) 100 is our id (created user, for loggin)
+			$result = $this-&gt;users-&gt;saveFormEdit( 101, 100 );
 
-			// get form filled with details from user id 100
-			$defaults = $this-&gt;users-&gt;getUser( 100 );
+			// check if result is a array (form error messages)
+			if( is_array( $result ) ) return $form-&gt;display();
 
-			// get user details form with a submit button
-			$form = $this-&gt;users-&gt;getForm( $defaults );
-			$form-&gt;addElement( 'submit', '_cmdSubmit', 'Submit' );
+			// if update was sucessfull, show ok message in current language
+			if ( $result == 1 ) return print( t( 'user details updated' ) );
 
-			// if we have submitted the form, update user
-			if ( $form-&gt;isSubmitted() ){
+			// if form is valid but details are not changed (because are same as the db ones)
+			if ( $result == 0 ) return print( t( 'user not updated' ) );
+        }
 
-				// update user 100 with submitted information, magic isn't it ;)
-				$result = $this-&gt;users-&gt;changeUserForm( 100 );
 
-				// check if result is a array (form error messages)
-				if( is_array( $result ) ) return print( implode( '&lt;br&gt;', $result ) );
+		// this action will add a new sub-user of the root (super-administrator: id 100)
+		function actionNew(){
 
-				// if update was sucessfull, show ok message in current language
-				if ( $result == 1 ) return print( t( 'user details updated' ) );
+			// add element as child of user 100. User can edit username, can edit password, can edit login details, can edit user details, cannot see access info, can edit permissions
+			$this-&gt;users-&gt;addFormNew( 100, true, true, true, true, null, true );
 
-				// if form is valid but details are not changed (because are same as the db ones)
-				if ( $result == 0 ) return print( t( 'user not updated' ) );
-			}
+			// get form and add a custom submition button
+			$form = &amp; $this-&gt;users-&gt;getForm();
 
-			// show form :)
-			$form-&gt;display();
-        }
+			// if form is not submitted just show it
+			if ( ! $form-&gt;isSubmitted() ) return $form-&gt;display();
 
+			// add user ( 1st argument 100: parent of new user is 100; 2nd arg 100: we (user id that is creating this element) have id 100
+			$result = $this-&gt;users-&gt;saveFormNew( 100, 100 );
+			
+			// check if result has form errors
+			if ( is_array( $result ) ) return $form-&gt;display();
 
+			// if creation is sucessfull, show ok message in current language
+			print( t( 'user added' ) );
+		}
+
+
     }
 
     // Process the request

Modified: YDFramework2.0/trunk/examples/cm/cm.php
===================================================================
--- YDFramework2.0/trunk/examples/cm/cm.php	2006-08-22 15:33:32 UTC (rev 2033)
+++ YDFramework2.0/trunk/examples/cm/cm.php	2006-08-22 15:38:40 UTC (rev 2034)
@@ -10,7 +10,7 @@
     YDInclude( 'YDCMComponent.php' );
 
     // set YDDatabase instance connection
-    YDDatabase::registerInstance( 'default', 'mysql', 'tppp', 'root', '', 'localhost' );
+    YDDatabase::registerInstance( 'default', 'mysql', 'ph', 'root', '', 'localhost' );
 
 	// set portal language. Currently you can user 'en' and 'pt'.
 	YDLocale::set( 'en' );


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000540.html">[ydf-devel] r2033 -	YDFramework2.0/trunk/YDFramework2/YDClasses/YDCMComponent
</A></li>
	<LI>Next message: <A HREF="000542.html">[ydf-devel] r2034 - in YDFramework2.0/trunk/examples/cm: .	backend
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#541">[ date ]</a>
              <a href="thread.html#541">[ thread ]</a>
              <a href="subject.html#541">[ subject ]</a>
              <a href="author.html#541">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ydframework-devel">More information about the YDFramework-devel
mailing list</a><br>
</body></html>
