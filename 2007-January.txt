From pclaerhout at mail.berlios.de  Tue Jan  2 13:53:13 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 2 Jan 2007 13:53:13 +0100
Subject: [ydf-devel] r2292 - in YDFramework2.0/trunk/examples/weblog:
	include/languages manage
Message-ID: <200701021253.l02CrDMr006148@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-02 13:53:12 +0100 (Tue, 02 Jan 2007)
New Revision: 2292

Modified:
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
Log:
Added a link to the concepts in the sidebar.

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2006-12-31 13:13:38 UTC (rev 2291)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-02 12:53:12 UTC (rev 2292)
@@ -132,6 +132,7 @@
 $GLOBALS['t']['h_contents'] = 'Contents';
 $GLOBALS['t']['a_weblogs'] = 'Weblogs';
 $GLOBALS['t']['a_items'] = 'Items';
+$GLOBALS['t']['a_concepts'] = 'Concepts';
 $GLOBALS['t']['a_comments'] = 'Comments';
 $GLOBALS['t']['a_links'] = 'Links';
 $GLOBALS['t']['a_pages'] = 'Pages';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2006-12-31 13:13:38 UTC (rev 2291)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-02 12:53:12 UTC (rev 2292)
@@ -132,6 +132,7 @@
 $GLOBALS['t']['h_contents'] = 'Inhoud';
 $GLOBALS['t']['a_weblogs'] = 'Weblogs';
 $GLOBALS['t']['a_items'] = 'Items';
+$GLOBALS['t']['a_concepts'] = 'Concepten';
 $GLOBALS['t']['a_comments'] = 'Commentaren';
 $GLOBALS['t']['a_links'] = 'Links';
 $GLOBALS['t']['a_pages'] = 'Pagina\'s';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2006-12-31 13:13:38 UTC (rev 2291)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2007-01-02 12:53:12 UTC (rev 2292)
@@ -114,8 +114,9 @@
                     <td class="adminRowL">
                         <b>{t w="h_contents"}</b><br/>
                         &raquo; <a href="items.php">{t w="a_items"}</a><br/>
+                        &nbsp;&nbsp;&nbsp;&nbsp;&raquo; <a href="items.php?filter=drafts">{t w="a_concepts"}</a><br/>
                         &raquo; <a href="comments.php">{t w="a_comments"}</a><br/>
-                        &raquo; <a href="comments.php?filter=spam">{t w="a_comments_spam"}</a><br/>
+                        &nbsp;&nbsp;&nbsp;&nbsp;&raquo; <a href="comments.php?filter=spam">{t w="a_comments_spam"}</a><br/>
                         &raquo; <a href="pages.php">{t w="a_pages"}</a><br/>
                         &raquo; <a href="links.php">{t w="a_links"}</a><br/>
                         &raquo; <a href="images.php">{t w="a_images"}</a><br/>



From pclaerhout at mail.berlios.de  Tue Jan  2 14:22:32 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 2 Jan 2007 14:22:32 +0100
Subject: [ydf-devel] r2293 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200701021322.l02DMWDc008734@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-02 14:22:31 +0100 (Tue, 02 Jan 2007)
New Revision: 2293

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
Log:
You can now see the details for the HTTP Post Requests in Bad Behavior.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-02 12:53:12 UTC (rev 2292)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-02 13:22:31 UTC (rev 2293)
@@ -979,6 +979,12 @@
             return $this->db->getRecords( "SELECT * FROM " . $settings['log_table'] . " WHERE `key` NOT LIKE '00000000' ORDER BY DATE DESC" );
         }
 
+        // Get the bad behavior request by it's id
+        function getBadBehaviorRequestById( $id ) {
+            $settings = bb2_read_settings();
+            return $this->db->getRecord( "SELECT * FROM " . $settings['log_table'] . " WHERE id = " . $this->str( $id ) );
+        }
+
         // Get the bad behavior post requests
         function getBadBehaviorPostRequests() {
             $settings = bb2_read_settings();

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-02 12:53:12 UTC (rev 2292)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-02 13:22:31 UTC (rev 2293)
@@ -385,5 +385,12 @@
 $GLOBALS['t']['ip'] = 'IP';
 $GLOBALS['t']['request_method'] = 'Method';
 $GLOBALS['t']['url'] = 'URL';
+$GLOBALS['t']['request_details'] = 'Request Details';
+$GLOBALS['t']['id'] = 'ID';
+$GLOBALS['t']['server_protocol'] = 'Server Protocol';
+$GLOBALS['t']['http_headers'] = 'HTTP Headers';
+$GLOBALS['t']['user_agent'] = 'User Agent';
+$GLOBALS['t']['request_entity'] = 'Request Entity';
+$GLOBALS['t']['key'] = 'Key';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-02 12:53:12 UTC (rev 2292)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-02 13:22:31 UTC (rev 2293)
@@ -385,5 +385,12 @@
 $GLOBALS['t']['ip'] = 'IP';
 $GLOBALS['t']['request_method'] = 'Methode';
 $GLOBALS['t']['url'] = 'URL';
+$GLOBALS['t']['request_details'] = 'Details request';
+$GLOBALS['t']['id'] = 'ID';
+$GLOBALS['t']['server_protocol'] = 'Server Protocol';
+$GLOBALS['t']['http_headers'] = 'HTTP Headers';
+$GLOBALS['t']['user_agent'] = 'User Agent';
+$GLOBALS['t']['request_entity'] = 'Request Entiteit';
+$GLOBALS['t']['key'] = 'Code';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-02 12:53:12 UTC (rev 2292)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-02 13:22:31 UTC (rev 2293)
@@ -14,21 +14,41 @@
         // Default action
         function actionDefault() {
 
-            // Get the count and number of requests
-            $requests_count = $this->weblog->getBadBehaviorRequestsCount();
-            //$requests = $this->weblog->getBadBehaviorRequests();
-            $requests = $this->weblog->getBadBehaviorPostRequests();
+            // Get the ID from the query string
+            $id = $this->getIdFromQS();
 
-            // Get the pagesize and current page from the URL
-            $page = @ $_GET['page'];
+            // If there is nothing, show the list
+            if ( $id == -1 ) {
 
-            // Create the YDRecordSet object
-            $requests = new YDRecordSet( $requests, $page, YDConfig::get( 'YD_DB_DEFAULTPAGESIZE', 20 ) );
+                // Get the count and number of requests
+                $requests_count = $this->weblog->getBadBehaviorRequestsCount();
+                $requests = $this->weblog->getBadBehaviorPostRequests();
 
-            // Assign it to the template
-            $this->tpl->assign( 'requests_count', $requests_count );
-            $this->tpl->assign( 'requests', $requests );
+                // Get the pagesize and current page from the URL
+                $page = @ $_GET['page'];
 
+                // Create the YDRecordSet object
+                $requests = new YDRecordSet( $requests, $page, YDConfig::get( 'YD_DB_DEFAULTPAGESIZE', 20 ) );
+
+                // Assign it to the template
+                $this->tpl->assign( 'requests_count', $requests_count );
+                $this->tpl->assign( 'requests', $requests );
+
+            } else {
+
+                // Get the request data
+                $request = $this->weblog->getBadBehaviorRequestById( $id );
+
+                // Redirect if nothing found
+                if ( ! $request ) {
+                    $this->redirectToAction();
+                }
+
+                // Add it to the template
+                $this->tpl->assign( 'request', $request );
+
+            }
+
             // Display the template
             $this->display();
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-02 12:53:12 UTC (rev 2292)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-02 13:22:31 UTC (rev 2293)
@@ -5,40 +5,93 @@
 {if $YD_ACTION == 'default'}
 
     <table width="700" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowLG" colspan="7">
-                &raquo; {t w="total_bad_requests_stopped"}
-            </th>
-        </tr>
-        <tr><td colspan="7" class="adminRowL">{$requests_count} {t w="requests"}</td></tr>
-        {if $requests->set}
-            <tr><td colspan="7">&nbsp;</td></tr>
+        {if $requests}
             <tr>
                 <th class="adminRowLG" colspan="7">
-                    &raquo; {t w="post_requests"}
+                    &raquo; {t w="total_bad_requests_stopped"}
                 </th>
             </tr>
+            <tr><td colspan="7" class="adminRowL">{$requests_count} {t w="requests"}</td></tr>
+            {if $requests->set}
+                <tr><td colspan="7">&nbsp;</td></tr>
+                <tr>
+                    <th class="adminRowLG" colspan="7">
+                        &raquo; {t w="post_requests"}
+                    </th>
+                </tr>
+                <tr>
+                    <th class="adminRowL">{t w="date"}</th>
+                    <th class="adminRowL">{t w="ip"}</th>
+                    <th class="adminRowL">{t w="request_method"}</th>
+                    <th class="adminRowL">{t w="url"}</th>
+                    <th class="adminRowR">{t w="actions"}</th>
+                </tr>
+                <tr><td class="adminRowR" colspan="5">{$requests->getBrowseBar()}</td></tr>
+                {foreach from=$requests->set item="request"}
+                    <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+                        <td class="adminRowL">{$request.date}</td>
+                        <td class="adminRowL">{$request.ip}</td>
+                        <td class="adminRowL">{$request.request_method}</td>
+                        <td class="adminRowL">{$request.request_uri}</td>
+                        <td class="adminRowR"><a href="{$YD_SELF_SCRIPT}?id={$request.id}">{t w="view"}</a></td>
+                    </tr>
+                {/foreach}
+                <tr><td class="adminRowR" colspan="5">{$requests->getBrowseBar()}</td></tr>
+                <tr>
+                    <td class="adminRowLNB" colspan="5">
+                        <p class="subline">{t w="total"}: {$requests->totalRows}</p>
+                    </td>
+                </tr>
+            {/if}
+        {else}
             <tr>
-                <th class="adminRowL">{t w="date"}</th>
-                <th class="adminRowL">{t w="ip"}</th>
-                <th class="adminRowL">{t w="request_method"}</th>
-                <th class="adminRowL">{t w="url"}</th>
+                <th class="adminRowLG">
+                    &raquo; {t w="request_details"}: {$request.id}
+                </th>
+                <th class="adminRowLGR">
+                    &raquo; <a href="{$YD_SELF_SCRIPT}"><b>{t w="back"}</b></a>
+                </th>
             </tr>
-            <tr><td class="adminRowR" colspan="5">{$requests->getBrowseBar()}</td></tr>
-            {foreach from=$requests->set item="request"}
-                <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-                    <td class="adminRowL">{$request.date}</td>
-                    <td class="adminRowL">{$request.ip}</td>
-                    <td class="adminRowL">{$request.request_method}</td>
-                    <td class="adminRowL">{$request.request_uri}</td>
-                </tr>
-            {/foreach}
-            <tr><td class="adminRowR" colspan="5">{$requests->getBrowseBar()}</td></tr>
             <tr>
-                <td class="adminRowLNB" colspan="5">
-                    <p class="subline">{t w="total"}: {$requests->totalRows}</p>
-                </td>
+                <td class="adminRowL" width="250">{t w="id"}</td>
+                <td class="adminRowL" width="450">{$request.id}</td>
             </tr>
+            <tr>
+                <td class="adminRowL">{t w="ip"}</td>
+                <td class="adminRowL">{$request.ip}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="date"}</td>
+                <td class="adminRowL">{$request.date}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="request_method"}</td>
+                <td class="adminRowL">{$request.request_method}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="url"}</td>
+                <td class="adminRowL">{$request.request_uri}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="server_protocol"}</td>
+                <td class="adminRowL">{$request.server_protocol}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="http_headers"}</td>
+                <td class="adminRowL">{$request.http_headers|nl2br}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="user_agent"}</td>
+                <td class="adminRowL">{$request.user_agent}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="request_entity"}</td>
+                <td class="adminRowL">{$request.request_entity|nl2br}</td>
+            </tr>
+            <tr>
+                <td class="adminRowL">{t w="key"}</td>
+                <td class="adminRowL">{$request.key}</td>
+            </tr>
         {/if}
     </table>
 



From pclaerhout at mail.berlios.de  Wed Jan  3 13:50:04 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 3 Jan 2007 13:50:04 +0100
Subject: [ydf-devel] r2294 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701031250.l03Co4pY014860@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-03 13:50:04 +0100 (Wed, 03 Jan 2007)
New Revision: 2294

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Added the toXml function in YDArrayUtil.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-02 13:22:31 UTC (rev 2293)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-03 12:50:04 UTC (rev 2294)
@@ -307,47 +307,74 @@
          *                                  'full'   returns: array( -11 => '(GMT -11:00) Nome, Midway Island, Samoa', -10 => ...
          *  @static
          */
-		function getGMT( $format = null ){
+        function getGMT( $format = null ){
+            $gmts = array(
+                '-11'   => array( '(GMT -11:00)', 'Nome, Midway Island, Samoa' ),
+                '-10'   => array( '(GMT -10:00)', 'Hawaii' ),
+                 '-9'   => array( '(GMT  -9:00)', 'Alaska' ),
+                 '-8'   => array( '(GMT  -8:00)', 'Pacific Time' ),
+                 '-7'   => array( '(GMT  -7:00)', 'Mountain Time' ),
+                 '-6'   => array( '(GMT  -6:00)', 'Central Time, Mexico City' ),
+                 '-5'   => array( '(GMT  -5:00)', 'Eastern Time, Bogota, Lima, Quito' ),
+                 '-4'   => array( '(GMT  -4:00)', 'Atlantic Time, Caracas, La Paz' ),
+                 '-3.5' => array( '(GMT  -3:30)', 'Newfoundland' ),
+                 '-3'   => array( '(GMT  -3:00)', 'Brazil, Buenos Aires, Georgetown, Falkland Is.' ),
+                 '-2'   => array( '(GMT  -2:00)', 'Mid-Atlantic, Ascention Is., St Helena' ),
+                 '-1'   => array( '(GMT  -1:00)', 'Azores, Cape Verde Islands' ),
+                  '0'   => array( '(GMT   0:00)', 'Casablanca, Dublin, Edinburgh, London, Lisbon, Monrovia' ),
+                  '1'   => array( '(GMT  +1:00)', 'Berlin, Brussels, Copenhagen, Madrid, Paris, Rome' ),
+                  '2'   => array( '(GMT  +2:00)', 'Kaliningrad, South Africa, Warsaw' ),
+                  '3'   => array( '(GMT  +3:00)', 'Baghdad, Riyadh, Moscow, Nairobi' ),
+                  '2.5' => array( '(GMT  +3:30)', 'Tehran' ),
+                  '4'   => array( '(GMT  +4:00)', 'Abu Dhabi, Baku, Muscat, Tbilisi' ),
+                  '4.5' => array( '(GMT  +4:30)', 'Kabul' ),
+                  '5'   => array( '(GMT  +5:00)', 'Islamabad, Karachi, Tashkent' ),
+                  '5.5' => array( '(GMT  +5:30)', 'Bombay, Calcutta, Madras, New Delhi' ),
+                  '6'   => array( '(GMT  +6:00)', 'Almaty, Colombo, Dhaka' ),
+                  '7'   => array( '(GMT  +7:00)', 'Bangkok, Hanoi, Jakarta' ),
+                  '8'   => array( '(GMT  +8:00)', 'Beijing, Hong Kong, Perth, Singapore, Taipei' ),
+                  '9'   => array( '(GMT  +9:00)', 'Osaka, Sapporo, Seoul, Tokyo, Yakutsk' ),
+                  '9.5' => array( '(GMT  +9:30)', 'Adelaide, Darwin' ),
+                 '10'   => array( '(GMT +10:00)', 'Melbourne, Papua New Guinea, Sydney, Vladivostok' ),
+                 '11'   => array( '(GMT +11:00)', 'Magadan, New Caledonia, Solomon Islands' ),
+                 '12'   => array( '(GMT +12:00)', 'Auckland, Wellington, Fiji, Marshall Island' )
+            );
+            if ( is_null( $format ) ) {
+                return $gmts;
+            }
+            foreach( $gmts as $t => $arr ){
+                if ( $format == 'simple' ) $gmts[ $t ] = $arr[ 0 ];
+                else                       $gmts[ $t ] = $arr[ 0 ] . ' ' . $arr[ 1 ];
+            }
+            return $gmts;
+        }
 
-			$gmts = array(	'-11'   => array( '(GMT -11:00)', 'Nome, Midway Island, Samoa' ),
-							'-10'   => array( '(GMT -10:00)', 'Hawaii' ),
-							 '-9'   => array( '(GMT  -9:00)', 'Alaska' ),
-							 '-8'   => array( '(GMT  -8:00)', 'Pacific Time' ),
-							 '-7'   => array( '(GMT  -7:00)', 'Mountain Time' ),
-							 '-6'   => array( '(GMT  -6:00)', 'Central Time, Mexico City' ),
-							 '-5'   => array( '(GMT  -5:00)', 'Eastern Time, Bogota, Lima, Quito' ),
-							 '-4'   => array( '(GMT  -4:00)', 'Atlantic Time, Caracas, La Paz' ),
-							 '-3.5' => array( '(GMT  -3:30)', 'Newfoundland' ),
-							 '-3'   => array( '(GMT  -3:00)', 'Brazil, Buenos Aires, Georgetown, Falkland Is.' ),
-							 '-2'   => array( '(GMT  -2:00)', 'Mid-Atlantic, Ascention Is., St Helena' ),
-							 '-1'   => array( '(GMT  -1:00)', 'Azores, Cape Verde Islands' ),
-							  '0'   => array( '(GMT   0:00)', 'Casablanca, Dublin, Edinburgh, London, Lisbon, Monrovia' ),
-							  '1'   => array( '(GMT  +1:00)', 'Berlin, Brussels, Copenhagen, Madrid, Paris, Rome' ),
-							  '2'   => array( '(GMT  +2:00)', 'Kaliningrad, South Africa, Warsaw' ),
-							  '3'   => array( '(GMT  +3:00)', 'Baghdad, Riyadh, Moscow, Nairobi' ),
-							  '2.5' => array( '(GMT  +3:30)', 'Tehran' ),
-							  '4'   => array( '(GMT  +4:00)', 'Abu Dhabi, Baku, Muscat, Tbilisi' ),
-							  '4.5' => array( '(GMT  +4:30)', 'Kabul' ),
-							  '5'   => array( '(GMT  +5:00)', 'Islamabad, Karachi, Tashkent' ),
-						      '5.5' => array( '(GMT  +5:30)', 'Bombay, Calcutta, Madras, New Delhi' ),
-							  '6'   => array( '(GMT  +6:00)', 'Almaty, Colombo, Dhaka' ),
-							  '7'   => array( '(GMT  +7:00)', 'Bangkok, Hanoi, Jakarta' ),
-							  '8'   => array( '(GMT  +8:00)', 'Beijing, Hong Kong, Perth, Singapore, Taipei' ),
-							  '9'   => array( '(GMT  +9:00)', 'Osaka, Sapporo, Seoul, Tokyo, Yakutsk' ),
-							  '9.5' => array( '(GMT  +9:30)', 'Adelaide, Darwin' ),
-							 '10'   => array( '(GMT +10:00)', 'Melbourne, Papua New Guinea, Sydney, Vladivostok' ),
-							 '11'   => array( '(GMT +11:00)', 'Magadan, New Caledonia, Solomon Islands' ),
-							 '12'   => array( '(GMT +12:00)', 'Auckland, Wellington, Fiji, Marshall Island' ) );
-			
-			if ( is_null( $format ) ) return $gmts;
+        /**
+         *  This function will convert a database result array to XML
+         *
+         *  @param $array      The input array.
+         *
+         *  @returns       The array as an XML string.
+         *
+         *  @static
+         */
+        function toXml( $array ) {
+            $out = '';
+            foreach ( $array as $record ) {
+                $out .= sprintf( '<row>' );
+                foreach ( $record as $key=>$val ) {
+                    if ( is_numeric( $val ) ) {
+                        $out .= sprintf( '<%s>%s</%s>', $key, $val, $key );
+                    } else {
+                        $out .= sprintf( '<%s><![CDATA[%s]]></%s>', $key, $val, $key );
+                    }
+                }
+                $out .= sprintf( '</row>' );
+            }
+            $out = sprintf( '<root>%s</root>', $out );
+            return '<?xml version="1.0" encoding="utf-8"?>' . $out;
+        }
 
-			foreach( $gmts as $t => $arr ){
-				if ( $format == 'simple' ) $gmts[ $t ] = $arr[ 0 ];
-				else                       $gmts[ $t ] = $arr[ 0 ] . ' ' . $arr[ 1 ];
-			}
-
-			return $gmts;
-		}
     }
 
     /**



From pclaerhout at mail.berlios.de  Wed Jan  3 13:51:23 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 3 Jan 2007 13:51:23 +0100
Subject: [ydf-devel] r2295 - in YDFramework2.0/trunk/examples: . adobe_spry
Message-ID: <200701031251.l03CpN1F015065@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-03 13:51:22 +0100 (Wed, 03 Jan 2007)
New Revision: 2295

Added:
   YDFramework2.0/trunk/examples/adobe_spry/
   YDFramework2.0/trunk/examples/adobe_spry/SpryData.js
   YDFramework2.0/trunk/examples/adobe_spry/index.php
   YDFramework2.0/trunk/examples/adobe_spry/index.tpl
   YDFramework2.0/trunk/examples/adobe_spry/xpath.js
Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
Added an example on how to use Adobe Spry with the Yellow Duck Framework.

Added: YDFramework2.0/trunk/examples/adobe_spry/SpryData.js
===================================================================
--- YDFramework2.0/trunk/examples/adobe_spry/SpryData.js	2007-01-03 12:50:04 UTC (rev 2294)
+++ YDFramework2.0/trunk/examples/adobe_spry/SpryData.js	2007-01-03 12:51:22 UTC (rev 2295)
@@ -0,0 +1,3832 @@
+/* SpryData.js - Revision: Spry Preview Release 1.4 */
+
+// Copyright (c) 2006. Adobe Systems Incorporated.
+// All rights reserved.
+//
+// Redistribution and use in source and binary forms, with or without
+// modification, are permitted provided that the following conditions are met:
+//
+//   * Redistributions of source code must retain the above copyright notice,
+//     this list of conditions and the following disclaimer.
+//   * Redistributions in binary form must reproduce the above copyright notice,
+//     this list of conditions and the following disclaimer in the documentation
+//     and/or other materials provided with the distribution.
+//   * Neither the name of Adobe Systems Incorporated nor the names of its
+//     contributors may be used to endorse or promote products derived from this
+//     software without specific prior written permission.
+//
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+// AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+// ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
+// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+// INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+// CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+// ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+// POSSIBILITY OF SUCH DAMAGE.
+
+var Spry; if (!Spry) Spry = {};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Utils
+//
+//////////////////////////////////////////////////////////////////////
+
+if (!Spry.Utils) Spry.Utils = {};
+
+Spry.Utils.msProgIDs = ["MSXML2.XMLHTTP.5.0", "MSXML2.XMLHTTP.4.0", "MSXML2.XMLHTTP.3.0", "MSXML2.XMLHTTP", "Microsoft.XMLHTTP"];
+
+Spry.Utils.createXMLHttpRequest = function()
+{
+	var req = null;
+	try
+	{
+		if (window.XMLHttpRequest)
+			req = new XMLHttpRequest();
+		else if (window.ActiveXObject)
+		{
+			while (!req && Spry.Utils.msProgIDs.length)
+			{
+				try { req = new ActiveXObject(Spry.Utils.msProgIDs[0]); } catch (e) { req = null; }
+				if (!req)
+					Spry.Utils.msProgIDs.splice(0, 1);
+			}
+		}
+	}
+	catch (e) { req = null;	}
+
+	if (!req)
+		Spry.Debug.reportError("Failed to create an XMLHttpRequest object!" );
+
+	return req;
+};
+
+Spry.Utils.loadURL = function(method, url, async, callback, opts)
+{
+	var req = new Spry.Utils.loadURL.Request();
+	req.method = method;
+	req.url = url;
+	req.async = async;
+	req.successCallback = callback;
+	Spry.Utils.setOptions(req, opts);
+	
+	try
+	{
+		req.xhRequest = Spry.Utils.createXMLHttpRequest();
+		if (!req.xhRequest)
+			return null;
+
+		if (req.async)
+			req.xhRequest.onreadystatechange = function() { Spry.Utils.loadURL.callback(req); };
+
+		req.xhRequest.open(req.method, req.url, req.async, req.username, req.password);
+		
+		if (req.headers)
+		{
+			for (var name in req.headers)
+				req.xhRequest.setRequestHeader(name, req.headers[name]);
+		}
+
+		req.xhRequest.send(req.postData);
+
+		if (!req.async)
+			Spry.Utils.loadURL.callback(req);
+	}
+	catch(e) { req = null; Spry.Debug.reportError("Exception caught while loading " + url + ": " + e); }
+
+	return req;
+};
+
+Spry.Utils.loadURL.callback = function(req)
+{
+	if (!req || req.xhRequest.readyState != 4)
+		return;
+	if (req.successCallback && (req.xhRequest.status == 200 || req.xhRequest.status == 0))
+		req.successCallback(req);
+	else if (req.errorCallback)
+		req.errorCallback(req);
+};
+
+Spry.Utils.loadURL.Request = function()
+{
+	var props = Spry.Utils.loadURL.Request.props;
+	var numProps = props.length;
+
+	for (var i = 0; i < numProps; i++)
+		this[props[i]] = null;
+
+	this.method = "GET";
+	this.async = true;
+	this.headers = {};
+};
+
+Spry.Utils.loadURL.Request.props = [ "method", "url", "async", "username", "password", "postData", "successCallback", "errorCallback", "headers", "userData", "xhRequest" ];
+
+Spry.Utils.loadURL.Request.prototype.extractRequestOptions = function(opts, undefineRequestProps)
+{
+	if (!opts)
+		return;
+
+	var props = Spry.Utils.loadURL.Request.props;
+	var numProps = props.length;
+
+	for (var i = 0; i < numProps; i++)
+	{
+		var prop = props[i];
+		if (opts[prop] != undefined)
+		{
+			this[prop] = opts[prop];
+			if (undefineRequestProps)
+				opts[prop] = undefined;
+		}
+	}
+};
+
+Spry.Utils.loadURL.Request.prototype.clone = function()
+{
+	var props = Spry.Utils.loadURL.Request.props;
+	var numProps = props.length;
+	var req = new Spry.Utils.loadURL.Request;
+	for (var i = 0; i < numProps; i++)
+		req[props[i]] = this[props[i]];
+	if (this.headers)
+	{
+		req.headers = {};
+		Spry.Utils.setOptions(req.headers, this.headers);
+	}
+	return req;
+};
+
+Spry.Utils.setInnerHTML = function(ele, str, preventScripts)
+{
+	if (!ele)
+		return;
+	ele = $(ele);
+	var scriptExpr = "<script[^>]*>(.|\s|\n|\r)*?</script>";
+	ele.innerHTML = str.replace(new RegExp(scriptExpr, "img"), "");
+
+	if (preventScripts)
+		return;
+		
+	var matches = str.match(new RegExp(scriptExpr, "img"));
+	if (matches)
+	{
+		var numMatches = matches.length;
+		for (var i = 0; i < numMatches; i++)
+		{
+			var s = matches[i].replace(/<script[^>]*>[\s\r\n]*(<\!--)?|(-->)?[\s\r\n]*<\/script>/img, "");
+			Spry.Utils.eval(s);
+		}
+	}
+};
+
+Spry.Utils.updateContent = function (ele, url, finishFunc, opts)
+{
+	var method = (opts && opts.method) ? opts.method : "GET";
+	Spry.Utils.loadURL(method, url, false, function(req)
+	{
+		Spry.Utils.setInnerHTML(ele, req.xhRequest.responseText);
+		if (finishFunc)
+			finishFunc(ele, url);
+	}, opts);
+};
+
+Spry.Utils.addEventListener = function(element, eventType, handler, capture)
+{
+	try
+	{
+		element = $(element);
+		if (element.addEventListener)
+			element.addEventListener(eventType, handler, capture);
+		else if (element.attachEvent)
+			element.attachEvent("on" + eventType, handler);
+	}
+	catch (e) {}
+};
+
+Spry.Utils.removeEventListener = function(element, eventType, handler, capture)
+{
+	try
+	{
+		element = $(element);
+		if (element.removeEventListener)
+			element.removeEventListener(eventType, handler, capture);
+		else if (element.detachEvent)
+			element.detachEvent("on" + eventType, handler);
+	}
+	catch (e) {}
+};
+
+Spry.Utils.addLoadListener = function(handler)
+{
+	if (typeof window.addEventListener != 'undefined')
+		window.addEventListener('load', handler, false);
+	else if (typeof document.addEventListener != 'undefined')
+		document.addEventListener('load', handler, false);
+	else if (typeof window.attachEvent != 'undefined')
+		window.attachEvent('onload', handler);
+};
+
+Spry.Utils.eval = function(str)
+{
+	// Call this method from your JS function when
+	// you don't want the JS expression to access or
+	// interfere with any local variables in your JS
+	// function.
+
+	return eval(str);
+};
+
+Spry.Utils.escapeQuotesAndLineBreaks = function(str)
+{
+	if (str)
+	{
+		str = str.replace(/\\/g, "\\\\");
+		str = str.replace(/["']/g, "\\$&");
+		str = str.replace(/\n/g, "\\n");
+		str = str.replace(/\r/g, "\\r");
+	}
+	return str;
+};
+
+Spry.Utils.encodeEntities = function(str)
+{
+	if (str && str.search(/[&<>"]/) != -1)
+	{
+		str = str.replace(/&/g, "&amp;");
+		str = str.replace(/</g, "&lt;");
+		str = str.replace(/>/g, "&gt;");
+		str = str.replace(/"/g, "&quot;");
+	}
+	return str
+};
+
+Spry.Utils.decodeEntities = function(str)
+{
+	var d = Spry.Utils.decodeEntities.div;
+	if (!d)
+	{
+		d = document.createElement('div');
+		Spry.Utils.decodeEntities.div = d;
+		if (!d) return str;
+	}
+	d.innerHTML = str;
+	if (d.childNodes.length == 1 && d.firstChild.nodeType == 3 /* Node.TEXT_NODE */ && d.firstChild.nextSibling == null)
+		str = d.firstChild.data;
+	else
+	{
+		// Hmmm, innerHTML processing of str produced content
+		// we weren't expecting, so just replace entities we
+		// expect folks will use in node attributes that contain
+		// JavaScript.
+		str = str.replace(/&lt;/, "<");
+		str = str.replace(/&gt;/, ">");
+		str = str.replace(/&quot;/, "\"");
+		str = str.replace(/&amp;/, "&");
+	}
+	return str;
+};
+
+Spry.Utils.fixupIETagAttributes = function(inStr)
+{
+	var outStr = "";
+
+	// Break the tag string into 3 pieces.
+
+	var tagStart = inStr.match(/^<[^\s>]+\s*/)[0];
+	var tagEnd = inStr.match(/\s*\/?>$/)[0];
+	var tagAttrs = inStr.replace(/^<[^\s>]+\s*|\s*\/?>/g, "");
+
+	// Write out the start of the tag.
+	outStr += tagStart;
+
+	// If the tag has attributes, parse it out manually to avoid accidentally fixing up
+	// attributes that contain JavaScript expressions.
+
+	if (tagAttrs)
+	{
+		var startIndex = 0;
+		var endIndex = 0;
+
+		while (startIndex < tagAttrs.length)
+		{
+			// Find the '=' char of the attribute.
+			while (tagAttrs.charAt(endIndex) != '=' && endIndex < tagAttrs.length)
+				++endIndex;
+
+			// If we are at the end of the string, just write out what we've
+			// collected.
+
+			if (endIndex >= tagAttrs.length)
+			{
+				outStr += tagAttrs.substring(startIndex, endIndex);
+				break;
+			}
+
+			// Step past the '=' character and write out what we've
+			// collected so far.
+
+			++endIndex;
+			outStr += tagAttrs.substring(startIndex, endIndex);
+			startIndex = endIndex;
+
+			if (tagAttrs.charAt(endIndex) == '"' || tagAttrs.charAt(endIndex) == "'")
+			{
+				// Attribute is quoted. Advance us past the quoted value!
+				var savedIndex = endIndex++;
+				while (endIndex < tagAttrs.length)
+				{
+					if (tagAttrs.charAt(endIndex) == tagAttrs.charAt(savedIndex))
+					{
+						endIndex++;
+						break;
+					}
+					else if (tagAttrs.charAt(endIndex) == "\\")
+						endIndex++;
+					endIndex++;
+				}
+
+				outStr += tagAttrs.substring(startIndex, endIndex);
+				startIndex = endIndex;
+			}
+			else
+			{
+				// This attribute value wasn't quoted! Wrap it with quotes and
+				// write out everything till we hit a space, or the end of the
+				// string.
+
+				outStr += "\"";
+				
+				var sIndex = tagAttrs.slice(endIndex).search(/\s/);
+				endIndex = (sIndex != -1) ? (endIndex + sIndex) : tagAttrs.length;
+				outStr += tagAttrs.slice(startIndex, endIndex);				
+				outStr += "\"";				
+				startIndex = endIndex;
+			}
+		}
+	}
+
+	outStr += tagEnd;
+
+	// Write out the end of the tag.
+	return outStr;
+}
+
+Spry.Utils.fixUpIEInnerHTML = function(inStr)
+{
+	var outStr = "";
+
+	// Create a regular expression that will match:
+	//     <!--
+	//     <![CDATA[
+	//     <tag>
+	//     -->
+	//     ]]>
+	//     ]]&gt;   // Yet another workaround for an IE innerHTML bug.
+	//
+	// The idea here is that we only want to fix up attribute values on tags that
+	// are not in any comments or CDATA.
+
+	var regexp = new RegExp("<\\!--|<\\!\\[CDATA\\[|<\\w+[^<>]*>|-->|\\]\\](>|\&gt;)", "g");
+	var searchStartIndex = 0;
+	var skipFixUp = 0;
+	
+	while (inStr.length)
+	{
+		var results = regexp.exec(inStr);
+		if (!results || !results[0])
+		{
+			outStr += inStr.substr(searchStartIndex, inStr.length - searchStartIndex);
+			break;
+		}
+
+		if (results.index != searchStartIndex)
+		{
+			// We found a match but it's not at the start of the inStr.
+			// Create a string token for everything that precedes the match.
+			outStr += inStr.substr(searchStartIndex, results.index - searchStartIndex);
+		}
+
+		if (results[0] == "<!--" || results[0] == "<![CDATA[")
+		{
+			++skipFixUp;
+			outStr += results[0];
+		}
+		else if (results[0] == "-->" || results[0] == "]]>" || (skipFixUp && results[0] == "]]&gt;"))
+		{
+			--skipFixUp;
+			outStr += results[0];
+		}
+		else if (!skipFixUp && results[0].charAt(0) == '<')
+			outStr += Spry.Utils.fixupIETagAttributes(results[0]);
+		else
+			outStr += results[0];
+
+		searchStartIndex = regexp.lastIndex;
+	}
+	
+	return outStr;
+};
+
+Spry.Utils.stringToXMLDoc = function(str)
+{
+	var xmlDoc = null;
+
+	try
+	{
+		// Attempt to parse the string using the IE method.
+
+		var xmlDOMObj = new ActiveXObject("Microsoft.XMLDOM");
+		xmlDOMObj.async = false;
+		xmlDOMObj.loadXML(str);
+		xmlDoc = xmlDOMObj;
+	}
+	catch (e)
+	{
+		// The IE method didn't work. Try the Mozilla way.
+
+		try
+		{
+			var domParser = new DOMParser;
+			xmlDoc = domParser.parseFromString(str, 'text/xml');
+		}
+		catch (e)
+		{
+			Spry.Debug.reportError("Caught exception in Spry.Utils.stringToXMLDoc(): " + e + "\n");
+			xmlDoc = null;
+		}
+	}
+
+	return xmlDoc;
+};
+
+Spry.Utils.serializeObject = function(obj)
+{
+	// Create a JSON representation of a given object.
+
+	var str = "";
+	var firstItem = true;
+
+	if (obj == null || obj == undefined)
+		return str + obj;
+
+	var objType = typeof obj;
+
+	if (objType == "number" || objType == "boolean")
+		str += obj;
+	else if (objType == "string")
+		str += "\"" + Spry.Utils.escapeQuotesAndLineBreaks(obj) + "\"";
+	else if (obj.constructor == Array)
+	{
+		str += "[";
+		for (var i = 0; i < obj.length; i++)
+		{
+			if (!firstItem)
+				str += ", ";
+			str += Spry.Utils.serializeObject(obj[i]);
+			firstItem = false;
+		}
+		str += "]";
+	}
+	else if (objType == "object")
+	{
+		str += "{";
+		for (var p in obj)
+		{
+			if (!firstItem)
+				str += ", ";
+			str += "\"" + p + "\": " + Spry.Utils.serializeObject(obj[p]);
+			firstItem = false;
+		}
+		str += "}";
+	}
+	return str;
+};
+
+Spry.Utils.getNodesByFunc = function(root, func)
+{
+	var nodeStack = new Array;
+	var resultArr = new Array;
+	var node = root;
+
+	while (node)
+	{
+		if (func(node))
+			resultArr.push(node);
+
+		if (node.hasChildNodes())
+		{
+			nodeStack.push(node);
+			node = node.firstChild;
+		}
+		else
+		{
+			if (node == root)
+				node = null;
+			else
+				try { node = node.nextSibling; } catch (e) { node = null; };
+		}
+		
+		while (!node && nodeStack.length > 0)
+		{
+			node = nodeStack.pop();
+			if (node == root)
+				node = null;
+			else
+				try { node = node.nextSibling; } catch (e) { node = null; }
+		}
+	}
+	
+	if (nodeStack && nodeStack.length > 0)
+		Spry.Debug.trace("-- WARNING: Spry.Utils.getNodesByFunc() failed to traverse all nodes!\n");
+
+	return resultArr;
+};
+
+Spry.Utils.addClassName = function(ele, className)
+{
+	ele = $(ele);
+	if (!ele || !className || (ele.className && ele.className.search(new RegExp("\\b" + className + "\\b")) != -1))
+		return;
+	ele.className += (ele.className ? " " : "") + className;
+};
+
+Spry.Utils.removeClassName = function(ele, className)
+{
+	ele = $(ele);
+	if (!ele || !className || (ele.className && ele.className.search(new RegExp("\\b" + className + "\\b")) == -1))
+		return;
+	ele.className = ele.className.replace(new RegExp("\\s*\\b" + className + "\\b", "g"), "");
+};
+
+Spry.Utils.getFirstChildWithNodeName = function(node, nodeName)
+{
+	var child = node.firstChild;
+
+	while (child)
+	{
+		if (child.nodeName == nodeName)
+			return child;
+		child = child.nextSibling;
+	} 
+
+	return null;
+};
+
+Spry.Utils.nodeContainsElementNode = function(node)
+{
+	if (node)
+	{
+		node = node.firstChild;
+
+		while (node)
+		{
+			if (node.nodeType == 1 /* Node.ELEMENT_NODE */)
+				return true;
+
+			node = node.nextSibling;
+		}
+	}
+	return false;
+};
+
+Spry.Utils.getNodeText = function(node)
+{
+	var txt = "";
+  
+	if (!node)
+		return;
+
+	try
+	{
+		var child = node.firstChild;
+ 
+		while (child)
+		{
+			try
+			{
+				if (child.nodeType == 3 /* TEXT_NODE */)
+					txt += Spry.Utils.encodeEntities(child.data);
+				else if (child.nodeType == 4 /* CDATA_SECTION_NODE */)
+					txt += child.data;
+			} catch (e) { Spry.Debug.reportError("Spry.Utils.getNodeText() exception caught: " + e + "\n"); }
+
+			child = child.nextSibling;
+		}
+	}
+	catch (e) { Spry.Debug.reportError("Spry.Utils.getNodeText() exception caught: " + e + "\n"); }
+  
+	return txt;
+};
+
+Spry.Utils.CreateObjectForNode = function(node)
+{
+	if (!node)
+		return null;
+
+	var obj = null;
+	var i = 0;
+	var attr = null;
+
+	try
+	{
+		for (i = 0; i < node.attributes.length; i++)
+		{
+			attr = node.attributes[i];
+			if (attr && attr.nodeType == 2 /* Node.ATTRIBUTE_NODE */)
+			{
+				if (!obj)
+				{
+					obj = new Object();
+					if (!obj)
+					{
+						Spry.Debug.reportError("Spry.Utils.CreateObjectForNode(): Object creation failed!");
+						return null;
+					}
+				}
+		
+				obj["@" + attr.name] = attr.value;
+			}
+		}
+	}
+	catch (e)
+	{
+		Spry.Debug.reportError("Spry.Utils.CreateObjectForNode() caught exception while accessing attributes: " + e + "\n");
+	}
+  
+	var child = node.firstChild;
+	
+	if (child && !child.nextSibling && child.nodeType != 1 /* Node.ELEMENT_NODE */)
+	{
+		// We have a single child and it's not an element. It must
+		// be the text value for this node. Add it to the record set and
+		// give it the column the same name as the node.
+
+		if (!obj)
+		{
+			obj = new Object();
+			if (!obj)
+			{
+				Spry.Debug.reportError("Spry.Utils.CreateObjectForNode(): Object creation failed!");
+				return null;
+			}
+		}
+
+		obj[node.nodeName] = Spry.Utils.getNodeText(node);
+	}
+  
+	while (child)
+	{
+		// Add the text value for each child element. Note that
+		// We skip elements that have element children (sub-elements)
+		// because we don't handle multi-level data sets right now.
+	
+		if (child.nodeType == 1 /* Node.ELEMENT_NODE */)
+		{
+			if (!Spry.Utils.nodeContainsElementNode(child))
+			{
+				var txt = Spry.Utils.getNodeText(child);
+				if (!obj)
+				{
+					obj = new Object();
+					if (!obj)
+					{
+						Spry.Debug.reportError("Spry.Utils.CreateObjectForNode(): Object creation failed!");
+						return null;
+					}
+				}
+	  
+				obj[child.nodeName] = txt;
+
+				// Now add properties for any attributes on the child. The property
+				// name will be of the form "<child.nodeName>/@<attr.name>".
+				try
+				{
+					var namePrefix = child.nodeName + "/@";
+					
+					for (i = 0; i < child.attributes.length; i++)
+					{
+						attr = child.attributes[i];
+						if (attr && attr.nodeType == 2 /* Node.ATTRIBUTE_NODE */)
+							obj[namePrefix + attr.name] = attr.value;
+					}
+				}
+				catch (e)
+				{
+					Spry.Debug.reportError("Spry.Utils.CreateObjectForNode() caught exception while accessing attributes: " + e + "\n");
+				}
+        
+			}
+			// else Spry.Debug.trace("WARNING: Skipping '" + child.nodeName + "' node! Multi-level data sets are not supported right now!\n");
+		}
+
+		child = child.nextSibling;
+	}
+  
+	return obj;
+};
+
+Spry.Utils.getRecordSetFromXMLDoc = function(xmlDoc, path)
+{
+	if (!xmlDoc || !path)
+		return null;
+
+	var recordSet = new Object();
+	recordSet.xmlDoc = xmlDoc;
+	recordSet.xmlPath = path;
+	recordSet.dataHash = new Object;
+	recordSet.data = new Array;
+	recordSet.getData = function() { return this.data; };
+
+	// Use the XPath library to find the nodes that will
+	// make up our data set. The result should be an array
+	// of subtrees that we need to flatten.
+
+	var ctx = new ExprContext(xmlDoc);
+	var pathExpr = xpathParse(path);
+	var e = pathExpr.evaluate(ctx);
+
+	// XXX: Note that we should check the result type of the evaluation
+	// just in case it's a boolean, string, or number value instead of
+	// a node set.
+  
+	var nodeArray = e.nodeSetValue();
+
+	var isDOMNodeArray = true;
+
+	if (nodeArray && nodeArray.length > 0)
+		isDOMNodeArray = nodeArray[0].nodeType != 2 /* Node.ATTRIBUTE_NODE */;
+
+	var nextID = 0;
+
+	// We now have the set of nodes that make up our data set
+	// so process each one.
+
+	for (var i = 0; i < nodeArray.length; i++)
+	{
+		var rowObj = null;
+	
+		if (isDOMNodeArray)
+			rowObj = Spry.Utils.CreateObjectForNode(nodeArray[i]);
+		else // Must be a Node.ATTRIBUTE_NODE array.
+		{
+			rowObj = new Object;
+			rowObj["@" + nodeArray[i].name] = nodeArray[i].value;
+		}
+	
+		if (rowObj)
+		{
+			// We want to make sure that every row has a unique ID and since we
+			// we don't know which column, if any, in this recordSet is a unique
+			// identifier, we generate a unique ID ourselves and store it under
+			// the ds_RowID column in the row object.
+
+			rowObj['ds_RowID'] = nextID++;
+			recordSet.dataHash[rowObj['ds_RowID']] = rowObj;
+			recordSet.data.push(rowObj);
+		}
+	}
+  
+	return recordSet;
+};
+
+Spry.Utils.setOptions = function(obj, optionsObj, ignoreUndefinedProps)
+{
+	if (!optionsObj)
+		return;
+
+	for (var optionName in optionsObj)
+	{
+		if (ignoreUndefinedProps && optionsObj[optionName] == undefined)
+			continue;
+		obj[optionName] = optionsObj[optionName];
+	}
+};
+
+Spry.Utils.SelectionManager = {};
+Spry.Utils.SelectionManager.selectionGroups = new Object;
+
+Spry.Utils.SelectionManager.SelectionGroup = function()
+{
+	this.selectedElements = new Array;
+};
+
+Spry.Utils.SelectionManager.SelectionGroup.prototype.select = function(element, className, multiSelect)
+{
+	var selObj = null;
+
+	if (!multiSelect)
+	{
+		// Multiple selection is not enabled, so clear any
+		// selected elements from our list.
+
+		this.clearSelection();
+	}
+	else
+	{
+		// Multiple selection is enabled, so check to see if element
+		// is already in the array. If it is, make sure the className
+		// is the className that was passed in.
+
+		for (var i = 0; i < this.selectedElements.length; i++)
+		{
+			selObj = this.selectedElements[i].element;
+
+			if (selObj.element == element)
+			{
+				if (selObj.className != className)
+				{
+					Spry.Utils.removeClassName(element, selObj.className);
+					Spry.Utils.addClassName(element, className);
+				}
+				return;
+			}
+		}
+	}
+
+	// Add the element to our list of selected elements.
+
+	selObj = new Object;
+	selObj.element = element;
+	selObj.className = className;
+	this.selectedElements.push(selObj);
+	Spry.Utils.addClassName(element, className);
+};
+
+Spry.Utils.SelectionManager.SelectionGroup.prototype.unSelect = function(element)
+{
+	for (var i = 0; i < this.selectedElements.length; i++)
+	{
+		var selObj = this.selectedElements[i].element;
+	
+		if (selObj.element == element)
+		{
+			Spry.Utils.removeClassName(selObj.element, selObj.className);
+			return;
+		}
+	}
+};
+
+Spry.Utils.SelectionManager.SelectionGroup.prototype.clearSelection = function()
+{
+	var selObj = null;
+
+	do
+	{
+		selObj = this.selectedElements.shift();
+		if (selObj)
+			Spry.Utils.removeClassName(selObj.element, selObj.className);
+	}
+	while (selObj);
+};
+
+Spry.Utils.SelectionManager.getSelectionGroup = function(selectionGroupName)
+{
+	if (!selectionGroupName)
+		return null;
+
+	var groupObj = Spry.Utils.SelectionManager.selectionGroups[selectionGroupName];
+
+	if (!groupObj)
+	{
+		groupObj = new Spry.Utils.SelectionManager.SelectionGroup();
+		Spry.Utils.SelectionManager.selectionGroups[selectionGroupName] = groupObj;
+	}
+
+	return groupObj;
+};
+
+Spry.Utils.SelectionManager.select = function(selectionGroupName, element, className, multiSelect)
+{
+	var groupObj = Spry.Utils.SelectionManager.getSelectionGroup(selectionGroupName);
+
+	if (!groupObj)
+		return;
+
+	groupObj.select(element, className, multiSelect);
+};
+
+Spry.Utils.SelectionManager.unSelect = function(selectionGroupName, element)
+{
+	var groupObj = Spry.Utils.SelectionManager.getSelectionGroup(selectionGroupName);
+
+	if (!groupObj)
+		return;
+
+	groupObj.unSelect(element, className);
+};
+
+Spry.Utils.SelectionManager.clearSelection = function(selectionGroupName)
+{
+	var groupObj = Spry.Utils.SelectionManager.getSelectionGroup(selectionGroupName);
+
+	if (!groupObj)
+		return;
+
+	groupObj.clearSelection();
+};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Define Prototype's $() convenience function.
+//
+//////////////////////////////////////////////////////////////////////
+
+function $()
+{
+	var elements = new Array();
+	
+	for (var i = 0; i < arguments.length; i++)
+	{
+		var element = arguments[i];
+		if (typeof element == 'string')
+			element = document.getElementById(element);
+		
+		if (arguments.length == 1)
+			return element;
+		
+		elements.push(element);
+	}
+	
+	return elements;
+}
+
+Spry.Utils.Notifier = function()
+{
+	this.observers = [];
+	this.suppressNotifications = 0;
+};
+
+Spry.Utils.Notifier.prototype.addObserver = function(observer)
+{
+	if (!observer)
+		return;
+
+	// Make sure the observer isn't already on the list.
+
+	var len = this.observers.length;
+	for (var i = 0; i < len; i++)
+	{
+		if (this.observers[i] == observer)
+			return;
+	}
+	this.observers[len] = observer;
+};
+
+Spry.Utils.Notifier.prototype.removeObserver = function(observer)
+{
+	if (!observer)
+		return;
+
+	for (var i = 0; i < this.observers.length; i++)
+	{
+		if (this.observers[i] == observer)
+		{
+			this.observers.splice(i, 1);
+			break;
+		}
+	}
+};
+
+Spry.Utils.Notifier.prototype.notifyObservers = function(methodName, data)
+{
+	if (!methodName)
+		return;
+
+	if (!this.suppressNotifications)
+	{
+		var len = this.observers.length;
+		for (var i = 0; i < len; i++)
+		{
+			var obs = this.observers[i];
+			if (obs)
+			{
+				if (typeof obs == "function")
+					obs(methodName, this, data);
+				else if (obs[methodName])
+					obs[methodName](this, data);
+			}
+		}
+	}
+};
+
+Spry.Utils.Notifier.prototype.enableNotifications = function()
+{
+	if (--this.suppressNotifications < 0)
+	{
+		this.suppressNotifications = 0;
+		Spry.Debug.reportError("Unbalanced enableNotifications() call!\n");
+	}
+};
+
+Spry.Utils.Notifier.prototype.disableNotifications = function()
+{
+	++this.suppressNotifications;
+};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Debug
+//
+//////////////////////////////////////////////////////////////////////
+
+Spry.Debug = {};
+Spry.Debug.enableTrace = true;
+Spry.Debug.debugWindow = null;
+
+Spry.Debug.createDebugWindow = function()
+{
+	if (!Spry.Debug.enableTrace || Spry.Debug.debugWindow)
+		return;
+	try
+	{
+		Spry.Debug.debugWindow = document.createElement("div");
+		var div = Spry.Debug.debugWindow;
+		div.style.fontSize = "12px";
+		div.style.fontFamily = "console";
+		div.style.position = "absolute";
+		div.style.width = "400px";
+		div.style.height = "300px";
+		div.style.overflow = "auto";
+		div.style.border = "solid 1px black";
+		div.style.backgroundColor = "white";
+		div.style.color = "black";
+		div.style.bottom = "0px";
+		div.style.right = "0px";
+		// div.style.opacity = "0.5";
+		// div.style.filter = "alpha(opacity=50)";
+		div.setAttribute("id", "SpryDebugWindow");
+		document.body.appendChild(Spry.Debug.debugWindow);
+	}
+	catch (e) {}
+};
+
+Spry.Debug.debugOut = function(str, bgColor)
+{
+	if (!Spry.Debug.debugWindow)
+	{
+		Spry.Debug.createDebugWindow();
+		if (!Spry.Debug.debugWindow)
+			return;
+	}
+
+	var d = document.createElement("div");
+	if (bgColor)
+		d.style.backgroundColor = bgColor;
+	d.innerHTML = str;
+	Spry.Debug.debugWindow.appendChild(d);	
+};
+
+Spry.Debug.trace = function(str)
+{
+	Spry.Debug.debugOut(str);
+};
+
+Spry.Debug.reportError = function(str)
+{
+	Spry.Debug.debugOut(str, "red");
+};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Data
+//
+//////////////////////////////////////////////////////////////////////
+
+Spry.Data = {};
+Spry.Data.regionsArray = {};
+
+Spry.Data.initRegions = function(rootNode)
+{
+	if (!rootNode)
+		rootNode = document.body;
+
+	var lastRegionFound = null;
+
+	var regions = Spry.Utils.getNodesByFunc(rootNode, function(node)
+	{
+		try
+		{
+			if (node.nodeType != 1 /* Node.ELEMENT_NODE */)
+				return false;
+
+			// Region elements must have an spryregion attribute with a
+			// non-empty value. An id attribute is also required so we can
+			// reference the region by name if necessary.
+
+			var attrName = "spry:region";
+			var attr = node.attributes.getNamedItem(attrName);
+			if (!attr)
+			{
+				attrName = "spry:detailregion";
+				attr = node.attributes.getNamedItem(attrName);
+			}
+			if (attr)
+			{
+				if (lastRegionFound)
+				{
+					var parent = node.parentNode;
+					while (parent)
+					{
+						if (parent == lastRegionFound)
+						{
+							Spry.Debug.reportError("Found a nested " + attrName + " in the following markup. Nested regions are currently not supported.<br/><pre>" + Spry.Utils.encodeEntities(parent.innerHTML) + "</pre>");
+							return false;
+						}
+						parent = parent.parentNode;
+					}
+				}
+
+				if (attr.value)
+				{
+					attr = node.attributes.getNamedItem("id");
+					if (!attr || !attr.value)
+					{
+						// The node is missing an id attribute so add one.
+						node.setAttribute("id", "spryregion" + (++Spry.Data.initRegions.nextUniqueRegionID));
+					}
+
+					lastRegionFound = node;
+					return true;
+				}
+				else
+					Spry.Debug.reportError(attrName + " attributes require one or more data set names as values!");
+			}
+		}
+		catch(e) {}
+		return false;
+	});
+
+	var name, dataSets, i;
+  
+	for (i = 0; i < regions.length; i++)
+	{
+		var rgn = regions[i];
+
+		var isDetailRegion = false;
+
+		// Get the region name.
+		name = rgn.attributes.getNamedItem("id").value;
+
+		attr = rgn.attributes.getNamedItem("spry:region");
+		if (!attr)
+		{
+			attr = rgn.attributes.getNamedItem("spry:detailregion");
+			isDetailRegion = true;
+		}
+
+		if (!attr.value)
+		{
+			Spry.Debug.reportError("spry:region and spry:detailregion attributes require one or more data set names as values!");
+			continue;
+		}
+
+		// Remove the spry:region or spry:detailregion attribute so it doesn't appear in
+		// the output generated by our processing of the dynamic region.
+		rgn.attributes.removeNamedItem(attr.nodeName);
+
+		// Remove the hiddenRegionCSS class from the rgn.
+		Spry.Utils.removeClassName(rgn, Spry.Data.Region.hiddenRegionClassName);
+
+		// Get the DataSets that should be bound to the region.
+		dataSets = Spry.Data.Region.strToDataSetsArray(attr.value);
+
+		if (!dataSets.length)
+		{
+			Spry.Debug.reportError("spry:region or spry:detailregion attribute has no data set!");
+			continue;
+		}
+	
+		var hasBehaviorAttributes = false;
+		var hasSpryContent = false;
+		var dataStr = "";
+
+		var parent = null;
+		var regionStates = {};
+		var regionStateMap = {};
+
+		// Check if there are any attributes on the region node that remap
+		// the default states.
+
+		attr = rgn.attributes.getNamedItem("spry:readystate");
+		if (attr && attr.value)
+			regionStateMap["ready"] = attr.value;
+		attr = rgn.attributes.getNamedItem("spry:errorstate");
+		if (attr && attr.value)
+			regionStateMap["error"] = attr.value;
+		attr = rgn.attributes.getNamedItem("spry:loadingstate");
+		if (attr && attr.value)
+			regionStateMap["loading"] = attr.value;
+		
+		// Find all of the processing instruction regions in the region.
+		// Insert comments around the regions we find so we can identify them
+		// easily when tokenizing the region html string.
+
+		var piRegions = Spry.Utils.getNodesByFunc(rgn, function(node)
+		{
+			try
+			{
+				if (node.nodeType == 1 /* ELEMENT_NODE */)
+				{
+					var attributes = node.attributes;
+					var numPI = Spry.Data.Region.PI.orderedInstructions.length;
+					var lastStartComment = null;
+					var lastEndComment = null;
+
+					for (var i = 0; i < numPI; i++)
+					{
+						var piName = Spry.Data.Region.PI.orderedInstructions[i];
+						var attr = attributes.getNamedItem(piName);
+						if (!attr)
+							continue;
+	
+						var piDesc = Spry.Data.Region.PI.instructions[piName];
+						var childrenOnly = (node == rgn) ? true : piDesc.childrenOnly;
+						var openTag = piDesc.getOpenTag(node, piName);
+						var closeTag = piDesc.getCloseTag(node, piName);
+	
+						if (childrenOnly)
+						{
+								var oComment = document.createComment(openTag);
+								var cComment = document.createComment(closeTag)
+
+								if (!lastStartComment)
+									node.insertBefore(oComment, node.firstChild);
+								else
+									node.insertBefore(oComment, lastStartComment.nextSibling);
+								lastStartComment = oComment;
+
+								if (!lastEndComment)
+									node.appendChild(cComment);
+								else
+									node.insertBefore(cComment, lastEndComment);
+								lastEndComment = cComment;
+						}
+						else
+						{
+							var parent = node.parentNode;
+							parent.insertBefore(document.createComment(openTag), node);
+							parent.insertBefore(document.createComment(closeTag), node.nextSibling);
+						}
+
+						// If this is a spry:state processing instruction, record the state name
+						// so we know that we should re-generate the region if we ever see that state.
+
+						if (piName == "spry:state")
+							regionStates[attr.value] = true;
+
+						node.removeAttribute(piName);
+					}
+
+					if (Spry.Data.Region.enableBehaviorAttributes)
+					{
+						var bAttrs = Spry.Data.Region.behaviorAttrs;
+						for (var behaviorAttrName in bAttrs)
+						{
+							var bAttr = attributes.getNamedItem(behaviorAttrName);
+							if (bAttr)
+							{
+								hasBehaviorAttributes = true;
+								if (bAttrs[behaviorAttrName].setup)
+									bAttrs[behaviorAttrName].setup(node, bAttr.value);
+							}
+						}
+					}
+				}
+			}
+			catch(e) {}
+			return false;
+		});
+	
+		// Get the data in the region.
+		dataStr = rgn.innerHTML;
+
+		// Argh! IE has an innerHTML bug where it will remove the quotes around any
+		// attribute value that it thinks is a single word. This includes removing quotes
+		// around our data references which is problematic since a single data reference
+		// can be replaced with multiple words. If we are running in IE, we have to call
+		// fixUpIEInnerHTML to get around this problem.
+
+		if (window.ActiveXObject && !Spry.Data.Region.disableIEInnerHTMLFixUp && dataStr.search(/=\{/) != -1)
+		{
+			if (Spry.Data.Region.debug)
+				Spry.Debug.trace("<hr />Performing IE innerHTML fix up of Region: " + name + "<br /><br />" + Spry.Utils.encodeEntities(dataStr));
+
+			dataStr = Spry.Utils.fixUpIEInnerHTML(dataStr);
+		}
+
+		if (Spry.Data.Region.debug)
+			Spry.Debug.trace("<hr />Region template markup for '" + name + "':<br /><br />" + Spry.Utils.encodeEntities(dataStr));
+
+		if (!hasSpryContent)
+		{
+			// Clear the region.
+			rgn.innerHTML = "";
+		}
+
+		// Create a Spry.Data.Region object for this region.
+		var region = new Spry.Data.Region(rgn, name, isDetailRegion, dataStr, dataSets, regionStates, regionStateMap, hasBehaviorAttributes);
+		Spry.Data.regionsArray[region.name] = region;
+	}
+
+	Spry.Data.updateAllRegions();
+};
+
+Spry.Data.initRegions.nextUniqueRegionID = 0;
+
+Spry.Data.updateRegion = function(regionName)
+{
+	if (!regionName || !Spry.Data.regionsArray || !Spry.Data.regionsArray[regionName])
+		return;
+
+	try { Spry.Data.regionsArray[regionName].updateContent(); }
+	catch(e) { Spry.Debug.reportError("Spry.Data.updateRegion(" + regionName + ") caught an exception: " + e + "\n"); }
+};
+
+Spry.Data.getRegion = function(regionName)
+{
+	return Spry.Data.regionsArray[regionName];
+};
+
+
+Spry.Data.updateAllRegions = function()
+{
+	if (!Spry.Data.regionsArray)
+		return;
+
+	for (var regionName in Spry.Data.regionsArray)
+		Spry.Data.updateRegion(regionName);
+};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Data.DataSet
+//
+//////////////////////////////////////////////////////////////////////
+
+Spry.Data.DataSet = function()
+{
+	Spry.Utils.Notifier.call(this);
+
+	this.name = "";
+	this.internalID = Spry.Data.DataSet.nextDataSetID++;
+	this.curRowID = 0;
+	this.data = null;
+	this.unfilteredData = null;
+	this.dataHash = null;
+	this.columnTypes = new Object;
+	this.filterFunc = null;		// non-destructive filter function
+	this.filterDataFunc = null;	// destructive filter function
+
+	this.distinctOnLoad = false;
+	this.sortOnLoad = null;
+	this.sortOrderOnLoad = "ascending";
+	this.keepSorted = false;
+
+	this.dataWasLoaded = false;
+	this.pendingRequest = null;
+
+	this.lastSortColumns = [];
+	this.lastSortOrder = "";
+
+	this.loadIntervalID = 0;
+};
+
+Spry.Data.DataSet.prototype = new Spry.Utils.Notifier();
+Spry.Data.DataSet.prototype.constructor = Spry.Data.DataSet;
+
+Spry.Data.DataSet.prototype.getData = function(unfiltered)
+{
+	return (unfiltered && this.unfilteredData) ? this.unfilteredData : this.data;
+};
+
+Spry.Data.DataSet.prototype.getUnfilteredData = function()
+{
+	// XXX: Deprecated.
+	return this.getData(true);
+};
+
+Spry.Data.DataSet.prototype.getLoadDataRequestIsPending = function()
+{
+	return this.pendingRequest != null;
+};
+
+Spry.Data.DataSet.prototype.getDataWasLoaded = function()
+{
+	return this.dataWasLoaded;
+};
+
+Spry.Data.DataSet.prototype.loadData = function()
+{
+	// The idea here is that folks using the base class DataSet directly
+	// would change the data in the DataSet manually and then call loadData()
+	// to fire off an async notifications to say that it was ready for consumption.
+	//
+	// Firing off data changed notificataions synchronously from this method
+	// can wreak havoc with complicated master/detail regions that use data sets
+	// that have master/detail relationships with other data sets. Our data set
+	// logic already handles async data loading nicely so we use a timer to fire
+	// off the data changed notification to insure that it happens after this
+	// function is finished and the JS stack unwinds.
+	//
+	// Other classes that derive from this class and load data synchronously
+	// inside their loadData() implementation should also fire off an async
+	// notification in this same manner to avoid this same problem.
+
+	var self = this;
+
+	this.pendingRequest = new Object;
+	this.dataWasLoaded = false;
+	this.pendingRequest.timer = setTimeout(function()
+	{
+		self.pendingRequest = null;
+		self.dataWasLoaded = true;
+
+		if (self.filterDataFunc)
+			self.filterData(self.filterDataFunc, true);
+
+		if (self.distinctOnLoad)
+			self.distinct();
+
+		if (self.keepSorted && self.getSortColumn())
+			self.sort(self.lastSortColumns, self.lastSortOrder)
+		else if (self.sortOnLoad)
+			self.sort(self.sortOnLoad, self.sortOrderOnLoad);
+	
+		if (self.filterFunc)
+			self.filter(self.filterFunc, true);
+	
+		self.notifyObservers("onDataChanged");
+	}, 0);  
+};
+
+Spry.Data.DataSet.prototype.cancelLoadData = function()
+{
+	if (this.pendingRequest && this.pendingRequest.timer)
+		clearTimeout(this.pendingRequest.timer);
+	this.pendingRequest = null;
+};
+
+Spry.Data.DataSet.prototype.getRowCount = function(unfiltered)
+{
+	var rows = this.getData(unfiltered);
+	return rows ? rows.length : 0;
+};
+
+Spry.Data.DataSet.prototype.getRowByID = function(rowID)
+{
+	if (!this.data)
+		return null;
+	return this.dataHash[rowID];
+};
+
+Spry.Data.DataSet.prototype.getRowByRowNumber = function(rowNumber, unfiltered)
+{
+	var rows = this.getData(unfiltered);
+	if (rows && rowNumber >= 0 && rowNumber < rows.length)
+		return rows[rowNumber];
+	return null;
+};
+
+Spry.Data.DataSet.prototype.getCurrentRow = function()
+{
+	return this.getRowByID(this.curRowID);
+};
+
+Spry.Data.DataSet.prototype.setCurrentRow = function(rowID)
+{
+	if (this.curRowID == rowID)
+		return;
+
+	var nData = { oldRowID: this.curRowID, newRowID: rowID };
+	this.curRowID = rowID;
+	this.notifyObservers("onCurrentRowChanged", nData);
+};
+
+Spry.Data.DataSet.prototype.getRowNumber = function(row)
+{
+	if (row && this.data && this.data.length)
+	{
+		var numRows = this.data.length;
+		for (var i = 0; i < numRows; i++)
+		{
+			if (this.data[i] == row)
+				return i;
+		}
+	}
+
+	return 0;
+};
+
+Spry.Data.DataSet.prototype.getCurrentRowNumber = function()
+{
+	return this.getRowNumber(this.getCurrentRow());
+};
+
+Spry.Data.DataSet.prototype.setCurrentRowNumber = function(rowNumber)
+{
+	if (!this.data || rowNumber >= this.data.length)
+	{
+		Spry.Debug.trace("Invalid row number: " + rowNumber + "\n");
+		return;
+	}
+
+	var rowID = this.data[rowNumber]["ds_RowID"];
+
+	if (rowID == undefined || this.curRowID == rowID)
+		return;
+
+	this.setCurrentRow(rowID);
+};
+
+Spry.Data.DataSet.prototype.findRowsWithColumnValues = function(valueObj, firstMatchOnly, unfiltered)
+{
+	var results = [];
+	var rows = this.getData(unfiltered);
+	if (rows)
+	{
+		var numRows = rows.length;
+		for (var i = 0; i < numRows; i++)
+		{
+			var row = rows[i];
+			var matched = true;
+
+			for (var colName in valueObj)
+			{
+				if (valueObj[colName] != row[colName])
+				{
+					matched = false;
+					break;
+				}
+			}
+			
+			if (matched)
+			{
+				if (firstMatchOnly)
+					return row;
+				results.push(row);
+			}
+		}
+	}
+
+	return results;
+};
+
+Spry.Data.DataSet.prototype.setColumnType = function(columnName, columnType)
+{
+	if (columnName)
+		this.columnTypes[columnName] = columnType;
+};
+
+Spry.Data.DataSet.prototype.getColumnType = function(columnName)
+{
+	if (this.columnTypes[columnName])
+		return this.columnTypes[columnName];
+	return "string";
+};
+
+Spry.Data.DataSet.prototype.distinct = function()
+{
+	if (this.data)
+	{
+		var oldData = this.data;
+		this.data = [];
+		this.dataHash = {};
+
+		var alreadySeenHash = {};
+		var i = 0;
+
+		for (var i = 0; i < oldData.length; i++)
+		{
+			var rec = oldData[i];
+			var hashStr = "";
+			for (var recField in rec)
+			{
+				if (recField != "ds_RowID")
+				{
+					if (hashStr)
+						hashStr += ",";
+					hashStr += recField + ":" + "\"" + rec[recField] + "\"";
+				}
+			}
+			if (!alreadySeenHash[hashStr])
+			{
+				this.data.push(rec);
+				this.dataHash[rec['ds_RowID']] = rec;
+				alreadySeenHash[hashStr] = true;
+			}
+		}
+	}
+};
+
+Spry.Data.DataSet.prototype.getSortColumn = function() {
+	return (this.lastSortColumns && this.lastSortColumns.length > 0) ? this.lastSortColumns[0] : "";
+};
+
+Spry.Data.DataSet.prototype.getSortOrder = function() {
+	return this.lastSortOrder ? this.lastSortOrder : "";
+};
+
+Spry.Data.DataSet.prototype.sort = function(columnNames, sortOrder)
+{
+	// columnNames can be either the name of a column to
+	// sort on, or an array of column names, but it can't be
+	// null/undefined.
+
+	if (!columnNames)
+		return;
+
+	// If only one column name was specified for sorting, do a
+	// secondary sort on ds_RowID so we get a stable sort order.
+
+	if (typeof columnNames == "string")
+		columnNames = [ columnNames, "ds_RowID" ];
+	else if (columnNames.length < 2 && columnNames[0] != "ds_RowID")
+		columnNames.push("ds_RowID");
+
+	if (!sortOrder)
+		sortOrder = "toggle";
+
+	if (sortOrder == "toggle")
+	{
+		if (this.lastSortColumns.length > 0 && this.lastSortColumns[0] == columnNames[0] && this.lastSortOrder == "ascending")
+			sortOrder = "descending";
+		else
+			sortOrder = "ascending";
+	}
+
+	if (sortOrder != "ascending" && sortOrder != "descending")
+	{
+		Spry.Debug.reportError("Invalid sort order type specified: " + sortOrder + "\n");
+		return;
+	}
+
+	var nData = {
+		oldSortColumns: this.lastSortColumns,
+		oldSortOrder: this.lastSortOrder,
+		newSortColumns: columnNames,
+		newSortOrder: sortOrder
+	};
+	this.notifyObservers("onPreSort", nData);
+
+	var cname = columnNames[columnNames.length - 1];
+	var sortfunc = Spry.Data.DataSet.prototype.sort.getSortFunc(cname, this.getColumnType(cname), sortOrder);
+
+	for (var i = columnNames.length - 2; i >= 0; i--)
+	{
+		cname = columnNames[i];
+		sortfunc = Spry.Data.DataSet.prototype.sort.buildSecondarySortFunc(Spry.Data.DataSet.prototype.sort.getSortFunc(cname, this.getColumnType(cname), sortOrder), sortfunc);
+	}
+
+	if (this.unfilteredData)
+	{
+		this.unfilteredData.sort(sortfunc);
+		if (this.filterFunc)
+			this.filter(this.filterFunc, true);
+	}
+	else
+		this.data.sort(sortfunc);
+
+	this.lastSortColumns = columnNames.slice(0); // Copy the array.
+	this.lastSortOrder = sortOrder;
+
+	this.notifyObservers("onPostSort", nData);
+};
+
+Spry.Data.DataSet.prototype.sort.getSortFunc = function(prop, type, order)
+{
+	var sortfunc = null;
+	if (type == "number")
+	{
+		if (order == "ascending")
+			sortfunc = function(a, b){ return a[prop]-b[prop]; };
+		else // order == "descending"
+			sortfunc = function(a, b){ return b[prop]-a[prop]; };
+	}
+	else if (type == "date")
+	{
+		if (order == "ascending")
+			sortfunc = function(a, b)
+			{
+				var dA = a[prop];
+				var dB = b[prop];			
+				dA = dA ? (new Date(dA)) : 0;
+				dB = dB ? (new Date(dB)) : 0;
+				return dA - dB;
+			};
+		else // order == "descending"
+			sortfunc = function(a, b)
+			{
+				var dA = a[prop];
+				var dB = b[prop];			
+				dA = dA ? (new Date(dA)) : 0;
+				dB = dB ? (new Date(dB)) : 0;
+				return dB - dA;
+			};
+	}
+	else // type == "string"
+	{
+		if (order == "ascending")
+			sortfunc = function(a, b){
+				var tA = a[prop].toString();
+				var tB = b[prop].toString();
+				var tA_l = tA.toLowerCase();
+				var tB_l = tB.toLowerCase();
+				var min_len = tA.length > tB.length ? tB.length : tA.length;
+
+				for (var i=0; i < min_len; i++){
+					var a_l_c = tA_l.charAt(i);
+					var b_l_c = tB_l.charAt(i);
+					var a_c = tA.charAt(i);
+					var b_c = tB.charAt(i);
+					if (a_l_c > b_l_c){
+							return 1;
+					}else if (a_l_c < b_l_c){
+						 return -1;
+					}else if (a_c > b_c){
+						 return 1;
+					}else if (a_c < b_c){
+						 return -1;
+					}
+				}
+				if(tA.length == tB.length){
+					return 0;
+				}else if (tA.length > tB.length){
+					return 1;
+				}else{
+					return -1;	
+				}
+			};
+		else // order == "descending"
+			sortfunc = function(a, b){
+				var tA = a[prop].toString();
+				var tB = b[prop].toString();
+				var tA_l = tA.toLowerCase();
+				var tB_l = tB.toLowerCase();
+				var min_len = tA.length > tB.length ? tB.length : tA.length;
+				for (var i=0; i < min_len; i++){
+					var a_l_c = tA_l.charAt(i);
+					var b_l_c = tB_l.charAt(i);
+					var a_c = tA.charAt(i);
+					var b_c = tB.charAt(i);
+					if (a_l_c > b_l_c){
+							return -1;
+					}else if (a_l_c < b_l_c){
+						 return 1;
+					}else if (a_c > b_c){
+						 return -1;
+					}else if (a_c < b_c){
+						 return 1;
+					}
+				}
+				if(tA.length == tB.length){
+					return 0;
+				}else if (tA.length > tB.length){
+					return -1;
+				}else{
+					return 1;	
+				}
+			};	
+     }
+
+	return sortfunc;
+};
+
+Spry.Data.DataSet.prototype.sort.buildSecondarySortFunc = function(funcA, funcB)
+{
+	return function(a, b)
+	{
+		var ret = funcA(a, b);
+		if (ret == 0)
+			ret = funcB(a, b);
+		return ret;
+	};
+};
+
+Spry.Data.DataSet.prototype.filterData = function(filterFunc, filterOnly)
+{
+	// This is a destructive filter function.
+	
+	var dataChanged = false;
+
+	if (!filterFunc)
+	{
+		// Caller wants to remove the filter.
+
+		this.filterDataFunc = null;
+		dataChanged = true;
+	}
+	else
+	{
+		this.filterDataFunc = filterFunc;
+		
+		if (this.dataWasLoaded && ((this.unfilteredData && this.unfilteredData.length) || (this.data && this.data.length)))
+		{
+			if (this.unfilteredData)
+			{
+				this.data = this.unfilteredData;
+				this.unfilteredData = null;
+			}
+	
+			var oldData = this.data;
+			this.data = [];
+			this.dataHash = {};
+	
+			for (var i = 0; i < oldData.length; i++)
+			{
+				var newRow = filterFunc(this, oldData[i], i);
+				if (newRow)
+				{
+					this.data.push(newRow);
+					this.dataHash[newRow["ds_RowID"]] = newRow;
+				}
+			}
+	
+			dataChanged = true;
+		}
+	}
+
+	if (dataChanged)
+	{
+		if (!filterOnly)
+		{
+			this.disableNotifications();
+			if (this.filterFunc)
+				this.filter(this.filterFunc, true);
+			this.enableNotifications();
+		}
+
+		this.notifyObservers("onDataChanged");
+	}
+};
+
+Spry.Data.DataSet.prototype.filter = function(filterFunc, filterOnly)
+{
+	// This is a non-destructive filter function.
+
+	var dataChanged = false;
+
+	if (!filterFunc)
+	{
+		if (this.filterFunc && this.unfilteredData)
+		{
+			// Caller wants to remove the filter. Restore the unfiltered
+			// data and trigger a data changed notification.
+	
+			this.data = this.unfilteredData;
+			this.unfilteredData = null;
+			this.filterFunc = null;
+			dataChanged = true;
+		}
+	}
+	else
+	{
+		this.filterFunc = filterFunc;
+		
+		if (this.dataWasLoaded && (this.unfilteredData || (this.data && this.data.length)))
+		{
+			if (!this.unfilteredData)
+				this.unfilteredData = this.data;
+	
+			var udata = this.unfilteredData;
+			this.data = [];
+	
+			for (var i = 0; i < udata.length; i++)
+			{
+				var newRow = filterFunc(this, udata[i], i);
+	
+				if (newRow)
+					this.data.push(newRow);
+			}
+	
+			dataChanged = true;
+		}
+	}
+
+	if (dataChanged)
+		this.notifyObservers("onDataChanged");
+};
+
+Spry.Data.DataSet.prototype.startLoadInterval = function(interval)
+{
+	this.stopLoadInterval();
+	if (interval > 0)
+	{
+		var self = this;
+		this.loadInterval = interval;
+		this.loadIntervalID = setInterval(function() { self.loadData(); }, interval);
+	}
+};
+
+Spry.Data.DataSet.prototype.stopLoadInterval = function()
+{
+	if (this.loadIntervalID)
+		clearInterval(this.loadIntervalID);
+	this.loadInterval = 0;
+	this.loadIntervalID = null;
+};
+
+Spry.Data.DataSet.nextDataSetID = 0;
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Data.XMLDataSet
+//
+//////////////////////////////////////////////////////////////////////
+
+Spry.Data.XMLDataSet = function(dataSetURL, dataSetPath, dataSetOptions)
+{
+	// Call the constructor for our DataSet base class so that
+	// our base class properties get defined. We'll call setOptions
+	// manually after we set up our XMLDataSet properties.
+
+	Spry.Data.DataSet.call(this);
+	
+	// XMLDataSet Properties:
+
+	this.url = dataSetURL;
+	this.xpath = dataSetPath;
+	this.doc = null;
+	this.dataSetsForDataRefStrings = new Array;
+	this.hasDataRefStrings = false;
+	this.useCache = true;
+
+	// Create a loadURL request object to store any load options
+	// the caller specified. We'll fill in the URL at the last minute
+	// before we make the actual load request because our URL needs
+	// to be processed at the last possible minute in case it contains
+	// data references.
+
+	this.requestInfo = new Spry.Utils.loadURL.Request();
+	this.requestInfo.extractRequestOptions(dataSetOptions, true);
+
+	// If the caller wants to use "POST" to fetch the data, but didn't
+	// provide the content type, default to x-www-form-urlencoded.
+
+	if (this.requestInfo.method == "POST")
+	{
+		if (!this.requestInfo.headers)
+			this.requestInfo.headers = {};
+		if (!this.requestInfo.headers['Content-Type'])
+			this.requestInfo.headers['Content-Type'] = "application/x-www-form-urlencoded; charset=UTF-8";
+	}
+
+	Spry.Utils.setOptions(this, dataSetOptions, true);
+	
+	this.recalculateDataSetDependencies();
+
+	if (this.loadInterval > 0)
+		this.startLoadInterval(this.loadInterval);
+}; // End of Spry.Data.XMLDataSet() constructor.
+
+Spry.Data.XMLDataSet.prototype = new Spry.Data.DataSet();
+Spry.Data.XMLDataSet.prototype.constructor = Spry.Data.XMLDataSet;
+
+Spry.Data.XMLDataSet.prototype.recalculateDataSetDependencies = function()
+{
+	this.hasDataRefStrings = false;
+
+	if (!this.url)
+		return;
+
+	// Clear all old callbacks that may have been registered.
+
+	var i = 0;
+	for (i = 0; i < this.dataSetsForDataRefStrings.length; i++)
+	{
+		var ds = this.dataSetsForDataRefStrings[i];
+		if (ds)
+			ds.removeObserver(this);
+	}
+
+	// Now run through the strings that may contain data references and figure
+	// out what data sets they require. Note that the data references in these
+	// strings must be fully qualified with a data set name. (ex: {dsDataSetName::columnName})
+
+	this.dataSetsForDataRefStrings = new Array();
+
+	var regionStrs = [ this.url, this.xpath, this.requestInfo.postData ];
+
+	// If postData exists, and is a string, we want to check it for data refs.
+	var postData = this.requestInfo.postData;
+	if (postData && (typeof postData) == "string")
+		regionStrs.push(postData);
+
+	var dsCount = 0;
+
+	for (var n = 0; n < regionStrs.length; n++)
+	{
+		var tokens = Spry.Data.Region.getTokensFromStr(regionStrs[n]);
+
+		for (i = 0; tokens && i < tokens.length; i++)
+		{
+			if (tokens[i].search(/{[^}:]+::[^}]+}/) != -1)
+			{
+				var dsName = tokens[i].replace(/^\{|::.*\}/g, "");
+				var ds = null;
+				if (!this.dataSetsForDataRefStrings[dsName])
+				{
+					try { ds = eval(dsName); } catch (e) { ds = null; }
+	
+					if (dsName && ds)
+					{
+						// The dataSetsForDataRefStrings array serves as both an
+						// array of data sets and a hash lookup by name.
+
+						this.dataSetsForDataRefStrings[dsName] = ds;
+						this.dataSetsForDataRefStrings[dsCount++] = ds;
+						this.hasDataRefStrings = true;
+					}
+				}
+			}
+		}
+	}
+
+	// Set up observers on any data sets our URL depends on.
+
+	for (i = 0; i < this.dataSetsForDataRefStrings.length; i++)
+	{
+		var ds = this.dataSetsForDataRefStrings[i];
+		ds.addObserver(this);
+	}
+};
+
+Spry.Data.XMLDataSet.prototype.attemptLoadData = function()
+{
+	// We only want to trigger a load when all of our data sets have data!
+	for (var i = 0; i < this.dataSetsForDataRefStrings.length; i++)
+	{
+		var ds = this.dataSetsForDataRefStrings[i];
+		if (ds.getLoadDataRequestIsPending() || !ds.getDataWasLoaded())
+			return;
+	}
+
+	this.loadData();
+};
+
+Spry.Data.XMLDataSet.prototype.onCurrentRowChanged = function(ds, data)
+{
+	this.attemptLoadData();
+};
+
+Spry.Data.XMLDataSet.prototype.onPostSort = function(ds, data)
+{
+	this.attemptLoadData();
+};
+			
+Spry.Data.XMLDataSet.prototype.onDataChanged = function(ds, data)
+{
+	this.attemptLoadData();
+};
+			
+Spry.Data.XMLDataSet.prototype.loadData = function()
+{
+	if (!this.url || !this.xpath)
+		return;
+
+	this.cancelLoadData();
+
+	var url = this.url;
+	var postData = this.requestInfo.postData;
+
+	if (this.hasDataRefStrings)
+	{
+		var allDataSetsReady = true;
+
+		for (var i = 0; i < this.dataSetsForDataRefStrings.length; i++)
+		{
+			var ds = this.dataSetsForDataRefStrings[i];
+			if (ds.getLoadDataRequestIsPending())
+				allDataSetsReady = false;
+			else if (!ds.getDataWasLoaded())
+			{
+				// Kick off the load of this data set!
+				ds.loadData();
+				allDataSetsReady = false;
+			}
+		}
+
+		// If our data sets aren't ready, just return. We'll
+		// get called back to load our data when they are all
+		// done.
+
+		if (!allDataSetsReady)
+			return;
+
+		url = Spry.Data.Region.processDataRefString(null, this.url, this.dataSetsForDataRefStrings);
+		if (!url)
+			return;
+			
+		if (postData && (typeof postData) == "string")
+			postData = Spry.Data.Region.processDataRefString(null, postData, this.dataSetsForDataRefStrings);
+	}
+
+	this.notifyObservers("onPreLoad");
+
+	this.data = null;
+	this.dataWasLoaded = false;
+	this.unfilteredData = null;
+	this.dataHash = null;
+	this.curRowID = 0;
+
+	// At this point the url should've been processed if it contained any
+	// data references. Set the url of the requestInfo structure and pass it
+	// to LoadManager.loadData().
+
+	var req = this.requestInfo.clone();
+	req.url = url;
+	req.postData = postData;
+
+	this.pendingRequest = new Object;
+	this.pendingRequest.data = Spry.Data.XMLDataSet.LoadManager.loadData(req, this, this.useCache);
+};
+
+Spry.Data.XMLDataSet.prototype.cancelLoadData = function()
+{
+	if (this.pendingRequest)
+	{
+		Spry.Data.XMLDataSet.LoadManager.cancelLoadData(this.pendingRequest.data, this);
+		this.pendingRequest = null;
+	}
+};
+
+Spry.Data.XMLDataSet.prototype.getURL = function() { return this.url; };
+Spry.Data.XMLDataSet.prototype.setURL = function(url, requestOptions)
+{
+	if (this.url == url)
+		return;
+	this.url = url;
+
+	if (requestOptions)
+		this.requestInfo.extractRequestOptions(requestOptions);
+
+	this.cancelLoadData();
+	this.recalculateDataSetDependencies();
+	this.dataWasLoaded = false;
+};
+Spry.Data.XMLDataSet.prototype.getDocument = function() { return this.doc; };
+Spry.Data.XMLDataSet.prototype.getXPath = function() { return this.xpath; };
+Spry.Data.XMLDataSet.prototype.setXPath = function(path)
+{
+	if (this.xpath != path)
+	{
+		this.xpath = path;
+		if (this.dataWasLoaded && this.doc)
+			this.setDataFromDoc(this.doc);
+	}
+};
+
+Spry.Data.XMLDataSet.prototype.setDataFromDoc = function(doc)
+{
+	this.pendingRequest = null;
+
+	var rs = null;
+
+	rs = Spry.Utils.getRecordSetFromXMLDoc(doc, Spry.Data.Region.processDataRefString(null, this.xpath, this.dataSetsForDataRefStrings));
+
+	if (!rs)
+	{
+		Spry.Debug.reportError("Spry.Data.XMLDataSet.setDataFromDoc() failed to create dataSet '" + this.name + "'for '" + this.xpath + "' - " + this.url + "\n");
+		return;
+	}
+
+	this.doc = rs.xmlDoc;
+	this.data = rs.data;
+	this.dataHash = rs.dataHash;
+	this.dataWasLoaded = (this.doc != null);
+
+	// If there is a data filter installed, run it.
+
+	if (this.filterDataFunc)
+		this.filterData(this.filterDataFunc, true);
+
+	// If the distinct flag was set, run through all the records in the recordset
+	// and toss out any that are duplicates.
+
+	if (this.distinctOnLoad)
+		this.distinct();
+
+	// If sortOnLoad was set, sort the data based on the columns
+	// specified in sortOnLoad.
+
+	if (this.keepSorted && this.getSortColumn())
+		this.sort(this.lastSortColumns, this.lastSortOrder)
+	else if (this.sortOnLoad)
+		this.sort(this.sortOnLoad, this.sortOrderOnLoad);
+
+	// If there is a view filter installed, run it.
+
+	if (this.filterFunc)
+		this.filter(this.filterFunc, true);
+
+	// The default "current" row is the first row of the data set.
+	if (this.data && this.data.length > 0)
+		this.curRowID = this.data[0]['ds_RowID'];
+	else
+		this.curRowID = 0;
+
+	this.notifyObservers("onPostLoad");
+	this.notifyObservers("onDataChanged");
+};
+
+Spry.Data.XMLDataSet.prototype.onRequestResponse = function(cachedRequest, req)
+{
+	this.setDataFromDoc(cachedRequest.doc);
+};
+
+Spry.Data.XMLDataSet.prototype.onRequestError = function(cachedRequest, req)
+{
+	this.notifyObservers("onLoadError", req);
+	// Spry.Debug.reportError("Spry.Data.XMLDataSet.LoadManager.CachedRequest.loadDataCallback(" + req.xhRequest.status + ") failed to load: " + req.url + "\n");
+};
+
+Spry.Data.XMLDataSet.LoadManager = {};
+Spry.Data.XMLDataSet.LoadManager.cache = [];
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest = function(reqInfo)
+{
+	Spry.Utils.Notifier.call(this);
+
+	this.reqInfo = reqInfo;
+	this.doc = null;
+	this.timer = null;
+	this.state = Spry.Data.XMLDataSet.LoadManager.CachedRequest.NOT_LOADED;
+};
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.prototype = new Spry.Utils.Notifier();
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.prototype.constructor = Spry.Data.XMLDataSet.LoadManager.CachedRequest;
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.NOT_LOADED      = 1;
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_REQUESTED  = 2;
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_FAILED     = 3;
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL = 4;
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.prototype.loadDataCallback = function(req)
+{
+	if (req.xhRequest.readyState != 4)
+		return;
+
+	var xmlDoc = req.xhRequest.responseXML;
+
+	if (req.xhRequest.status != 200)
+	{
+		if (req.xhRequest.status == 0)
+		{
+			// The page that is attempting to load data was probably loaded with
+			// a file:// url. Mozilla based browsers will actually provide the complete DOM
+			// tree for the data, but IE provides an empty document node so try to parse
+			// the xml text manually to create a dom tree we can use.
+
+			if (req.xhRequest.responseText && (!xmlDoc || !xmlDoc.firstChild))
+				xmlDoc = Spry.Utils.stringToXMLDoc(req.xhRequest.responseText);
+		}
+	}
+
+	if (!xmlDoc  || !xmlDoc.firstChild || xmlDoc.firstChild.nodeName == "parsererror")
+	{
+		this.state = Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_FAILED;
+		this.notifyObservers("onRequestError", req);
+		this.observers.length = 0; // Clear the observers list.
+		return;
+	}
+
+	this.doc = xmlDoc;
+	this.state = Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL;
+
+	// Notify all of the cached request's observers!
+	this.notifyObservers("onRequestResponse", req);
+
+	// Clear the observers list.
+	this.observers.length = 0;
+};
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.prototype.loadData = function()
+{
+	// IE will synchronously fire our loadDataCallback() during the call
+	// to an async Spry.Utils.loadURL() if the data for the url is already
+	// in the browser's local cache. This can wreak havoc with complicated master/detail
+	// regions that use data sets that have master/detail relationships with other
+	// data sets. Our data set logic already handles async data loading nicely so we
+	// use a timer to fire off the async Spry.Utils.loadURL() call to insure that any
+	// data loading happens asynchronously after this function is finished.
+
+	var self = this;
+	this.cancelLoadData();
+	this.doc = null;
+	this.state = Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_REQUESTED;
+
+	var reqInfo = this.reqInfo.clone();
+	reqInfo.successCallback = function(req) { self.loadDataCallback(req); };
+	reqInfo.errorCallback = reqInfo.successCallback;
+
+	this.timer = setTimeout(function()
+	{
+		self.timer = null;
+		Spry.Utils.loadURL(reqInfo.method, reqInfo.url, reqInfo.async, reqInfo.successCallback, reqInfo);
+	}, 0);  
+};
+
+Spry.Data.XMLDataSet.LoadManager.CachedRequest.prototype.cancelLoadData = function()
+{
+	if (this.state == Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_REQUESTED)
+	{
+		if (this.timer)
+		{
+			this.timer.clearTimeout();
+			this.timer = null;
+		}
+
+		this.doc = null;
+		this.state = Spry.Data.XMLDataSet.LoadManager.CachedRequest.NOT_LOADED;
+	}
+};
+
+Spry.Data.XMLDataSet.LoadManager.getCacheKey = function(reqInfo)
+{
+	return reqInfo.method + "::" + reqInfo.url + "::" + reqInfo.postData + "::" + reqInfo.username;
+};
+
+Spry.Data.XMLDataSet.LoadManager.loadData = function(reqInfo, ds, useCache)
+{
+	if (!reqInfo)
+		return null;
+
+	var cacheObj = null;
+	var cacheKey = null;
+
+	if (useCache)
+	{
+		cacheKey = Spry.Data.XMLDataSet.LoadManager.getCacheKey(reqInfo);
+		cacheObj = Spry.Data.XMLDataSet.LoadManager.cache[cacheKey];
+	}
+
+	if (cacheObj)
+	{
+		if (cacheObj.state == Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_REQUESTED)
+		{
+			if (ds)
+				cacheObj.addObserver(ds);
+			return cacheObj;
+		}
+		else if (cacheObj.state == Spry.Data.XMLDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL)
+		{
+			// Data is already cached so if we have a data set, trigger an async call
+			// that tells it to load its data.
+			if (ds)
+				setTimeout(function() { ds.setDataFromDoc(cacheObj.doc); }, 0);
+			return cacheObj;
+		}
+	}
+
+	// We're either loading this url for the first time, or an error occurred when
+	// we last tried to load it, or the caller requested a forced load.
+
+	if (!cacheObj)
+	{
+		cacheObj = new Spry.Data.XMLDataSet.LoadManager.CachedRequest(reqInfo);
+		if (useCache)
+		{
+			Spry.Data.XMLDataSet.LoadManager.cache[cacheKey] = cacheObj;
+
+			// Add an observer that will remove the cacheObj from the cache
+			// if there is a load request failure.
+			cacheObj.addObserver({ onRequestError: function() { Spry.Data.XMLDataSet.LoadManager.cache[cacheKey] = undefined; }});
+		}
+	}
+
+	if (ds)
+		cacheObj.addObserver(ds);
+
+	cacheObj.loadData();
+
+	return cacheObj;
+};
+
+Spry.Data.XMLDataSet.LoadManager.cancelLoadData = function(cacheObj, ds)
+{
+	if (cacheObj)
+	{
+		if (ds)
+			cacheObj.removeObserver(ds);
+		else
+			cacheObj.cancelLoadData();
+	}
+};
+
+//////////////////////////////////////////////////////////////////////
+//
+// Spry.Data.Region
+//
+//////////////////////////////////////////////////////////////////////
+ 
+Spry.Data.Region = function(regionNode, name, isDetailRegion, data, dataSets, regionStates, regionStateMap, hasBehaviorAttributes)
+{
+	this.regionNode = regionNode;
+	this.name = name;
+	this.isDetailRegion = isDetailRegion;
+	this.data = data;
+	this.dataSets = dataSets;
+	this.hasBehaviorAttributes = hasBehaviorAttributes;
+	this.tokens = null;
+	this.currentState = null;
+	this.states = { ready: true };
+	this.stateMap = {};
+
+	Spry.Utils.setOptions(this.states, regionStates);
+	Spry.Utils.setOptions(this.stateMap, regionStateMap);
+
+	// Add the region as an observer to the dataSet!
+	for (var i = 0; i < this.dataSets.length; i++)
+	{
+		var ds = this.dataSets[i];
+
+		try 
+		{
+			if (ds)
+				ds.addObserver(this);
+		}
+		catch(e) { Spry.Debug.reportError("Failed to add '" + this.name + "' as a dataSet observer!\n"); }
+	}
+}; // End of Spry.Data.Region() constructor.
+
+Spry.Data.Region.hiddenRegionClassName = "SpryHiddenRegion";
+Spry.Data.Region.evenRowClassName = "even";
+Spry.Data.Region.oddRowClassName = "odd";
+Spry.Data.Region.notifiers = {};
+Spry.Data.Region.evalScripts = true;
+
+Spry.Data.Region.addObserver = function(regionID, observer)
+{
+	var n = Spry.Data.Region.notifiers[regionID];
+	if (!n)
+	{
+		n = new Spry.Utils.Notifier();
+		Spry.Data.Region.notifiers[regionID] = n;
+	}
+	n.addObserver(observer);
+};
+
+Spry.Data.Region.removeObserver = function(regionID, observer)
+{
+	var n = Spry.Data.Region.notifiers[regionID];
+	if (n)
+		n.removeObserver(observer);
+};
+
+Spry.Data.Region.notifyObservers = function(methodName, region, data)
+{
+	var n = Spry.Data.Region.notifiers[region.name];
+	if (n)
+	{
+		var dataObj = {};
+		if (data && typeof data == "object")
+			dataObj = data;
+		else
+			dataObj.data = data;
+
+		dataObj.region = region;
+		dataObj.regionID = region.name;
+		dataObj.regionNode = region.regionNode;
+
+		n.notifyObservers(methodName, dataObj);
+	}
+};
+
+Spry.Data.Region.RS_Error = 0x01;
+Spry.Data.Region.RS_LoadingData = 0x02;
+Spry.Data.Region.RS_PreUpdate = 0x04;
+Spry.Data.Region.RS_PostUpdate = 0x08;
+
+Spry.Data.Region.prototype.getState = function()
+{
+	return this.currentState;
+};
+
+Spry.Data.Region.prototype.mapState = function(stateName, newStateName)
+{
+	this.stateMap[stateName] = newStateName;
+};
+
+Spry.Data.Region.prototype.getMappedState = function(stateName)
+{
+	var mappedState = this.stateMap[stateName];
+	return mappedState ? mappedState : stateName;
+};
+
+Spry.Data.Region.prototype.setState = function(stateName, suppressNotfications)
+{
+	var stateObj = { state: stateName, mappedState: this.getMappedState(stateName) };
+	if (!suppressNotfications)
+		Spry.Data.Region.notifyObservers("onPreStateChange", this, stateObj);
+
+	this.currentState = stateObj.mappedState ? stateObj.mappedState : stateName;
+
+	// If the region has content that is specific to this
+	// state, regenerate the region so that its markup is updated.
+
+	if (this.states[stateName])
+	{
+		if (!suppressNotfications)
+			Spry.Data.Region.notifyObservers("onPreUpdate", this, { state: this.currentState });
+	
+		// Make the region transform the xml data. The result is
+		// a string that we need to parse and insert into the document.
+		var str = this.transform();
+	
+		// Clear out any previous transformed content.
+		// this.clearContent();
+	
+		if (Spry.Data.Region.debug)
+			Spry.Debug.trace("<hr />Generated region markup for '" + this.name + "':<br /><br />" + Spry.Utils.encodeEntities(str));
+
+		// Now insert the new transformed content into the document.
+		Spry.Utils.setInnerHTML(this.regionNode, str, !Spry.Data.Region.evalScripts);
+	
+		// Now run through the content looking for attributes
+		// that tell us what behaviors to attach to each element.
+		if (this.hasBehaviorAttributes)
+			this.attachBehaviors();
+	
+		if (!suppressNotfications)
+			Spry.Data.Region.notifyObservers("onPostUpdate", this, { state: this.currentState });
+	}
+
+	if (!suppressNotfications)
+		Spry.Data.Region.notifyObservers("onPostStateChange", this, stateObj);
+};
+
+Spry.Data.Region.prototype.getDataSets = function()
+{
+	return this.dataSets;
+};
+
+Spry.Data.Region.prototype.addDataSet = function(aDataSet)
+{
+	if (!aDataSet)
+		return;
+
+	if (!this.dataSets)
+		this.dataSets = new Array;
+
+	// Check to see if the data set is already in our list.
+
+	for (var i = 0; i < this.dataSets.length; i++)
+	{
+		if (this.dataSets[i] == aDataSet)
+			return; // It's already in our list!
+	}
+
+	this.dataSets.push(aDataSet);
+	aDataSet.addObserver(this);
+};
+
+Spry.Data.Region.prototype.removeDataSet = function(aDataSet)
+{
+	if (!aDataSet || this.dataSets)
+		return;
+
+	for (var i = 0; i < this.dataSets.length; i++)
+	{
+		if (this.dataSets[i] == aDataSet)
+		{
+			this.dataSets.splice(i, 1);
+			aDataSet.removeObserver(this);
+			return;
+		}
+	}
+};
+
+Spry.Data.Region.prototype.onPreLoad = function(dataSet)
+{
+	if (this.currentState != "loading")
+		this.setState("loading");
+};
+
+Spry.Data.Region.prototype.onLoadError = function(dataSet)
+{
+	if (this.currentState != "error")
+		this.setState("error");
+	Spry.Data.Region.notifyObservers("onError", this);
+};
+
+Spry.Data.Region.prototype.onCurrentRowChanged = function(dataSet, data)
+{
+	if (this.isDetailRegion)
+		this.updateContent();
+};
+
+Spry.Data.Region.prototype.onPostSort = function(dataSet, data)
+{
+	this.updateContent();
+};
+
+Spry.Data.Region.prototype.onDataChanged = function(dataSet, data)
+{
+	this.updateContent();
+};
+
+Spry.Data.Region.enableBehaviorAttributes = true;
+Spry.Data.Region.behaviorAttrs = {};
+
+Spry.Data.Region.behaviorAttrs["spry:select"] =
+{
+	attach: function(rgn, node, value)
+	{
+		var selectGroupName = null;
+		try { selectGroupName = node.attributes.getNamedItem("spry:selectgroup").value; } catch (e) {}
+		if (!selectGroupName)
+			selectGroupName = "default";
+
+		Spry.Utils.addEventListener(node, "click", function(event) { Spry.Utils.SelectionManager.select(selectGroupName, node, value); }, false);
+		
+		if (node.attributes.getNamedItem("spry:selected"))
+			Spry.Utils.SelectionManager.select(selectGroupName, node, value);
+	}
+};
+
+Spry.Data.Region.behaviorAttrs["spry:hover"] =
+{
+	attach: function(rgn, node, value)
+	{
+		Spry.Utils.addEventListener(node, "mouseover", function(event){ Spry.Utils.addClassName(node, value); }, false);
+		Spry.Utils.addEventListener(node, "mouseout", function(event){ Spry.Utils.removeClassName(node, value); }, false);
+	}
+};
+
+Spry.Data.Region.setUpRowNumberForEvenOddAttr = function(node, attr, value, rowNumAttrName)
+{
+	// The format for the spry:even and spry:odd attributes are as follows:
+	//
+	// <div spry:even="dataSetName cssEvenClassName" spry:odd="dataSetName cssOddClassName">
+	//
+	// The dataSetName is optional, and if not specified, the first data set
+	// listed for the region is used.
+	//
+	// cssEvenClassName and cssOddClassName are required and *must* be specified. They can be
+	// any user defined CSS class name.
+
+	if (!value)
+	{
+		Spry.Debug.showError("The " + attr + " attribute requires a CSS class name as its value!");
+		node.attributes.removeNamedItem(attr);
+		return;
+	}
+
+	var dsName = "";
+	var valArr = value.split(/\s/);
+	if (valArr.length > 1)
+	{
+		// Extract out the data set name and reset the attribute so
+		// that it only contains the CSS class name to use.
+
+		dsName = valArr[0];
+		node.setAttribute(attr, valArr[1]);
+	}
+
+	// Tag the node with an attribute that will allow us to fetch the row
+	// number used when it is written out during the re-generation process.
+
+	node.setAttribute(rowNumAttrName, "{" + (dsName ? (dsName + "::") : "") + "ds_RowNumber}");
+};
+
+Spry.Data.Region.behaviorAttrs["spry:even"] =
+{
+	setup: function(node, value)
+	{
+		Spry.Data.Region.setUpRowNumberForEvenOddAttr(node, "spry:even", value, "spryevenrownumber");
+	},
+
+	attach: function(rgn, node, value)
+	{
+		if (value)
+		{
+			rowNumAttr = node.attributes.getNamedItem("spryevenrownumber");
+			if (rowNumAttr && rowNumAttr.value)
+			{
+				var rowNum = parseInt(rowNumAttr.value);
+				if (rowNum % 2)
+					Spry.Utils.addClassName(node, value);
+			}
+		}
+		node.removeAttribute("spry:even");
+		node.removeAttribute("spryevenrownumber");
+	}
+};
+
+Spry.Data.Region.behaviorAttrs["spry:odd"] =
+{
+	setup: function(node, value)
+	{
+		Spry.Data.Region.setUpRowNumberForEvenOddAttr(node, "spry:odd", value, "spryoddrownumber");
+	},
+
+	attach: function(rgn, node, value)
+	{
+		if (value)
+		{
+			rowNumAttr = node.attributes.getNamedItem("spryoddrownumber");
+			if (rowNumAttr && rowNumAttr.value)
+			{
+				var rowNum = parseInt(rowNumAttr.value);
+				if (rowNum % 2 == 0)
+					Spry.Utils.addClassName(node, value);
+			}
+		}
+		node.removeAttribute("spry:odd");
+		node.removeAttribute("spryoddrownumber");
+	}
+};
+
+Spry.Data.Region.setRowAttrClickHandler = function(node, dsName, rowAttr, funcName)
+{
+		if (dsName)
+		{
+			var ds = null;
+			try { ds = Spry.Utils.eval(dsName); } catch(e) { ds = null; };
+			if (ds)
+			{
+				rowIDAttr = node.attributes.getNamedItem(rowAttr);
+				if (rowIDAttr)
+				{
+					var rowAttrVal = rowIDAttr.value;
+					if (rowAttrVal)
+						Spry.Utils.addEventListener(node, "click", function(event){ ds[funcName](rowAttrVal); }, false);
+				}
+			}
+		}
+};
+
+Spry.Data.Region.behaviorAttrs["spry:setrow"] =
+{
+	setup: function(node, value)
+	{
+		if (!value)
+		{
+			Spry.Debug.reportError("The spry:setrow attribute requires a data set name as its value!");
+			node.removeAttribute("spry:setrow");
+			return;
+		}
+
+		// Tag the node with an attribute that will allow us to fetch the id of the
+		// row used when it is written out during the re-generation process.
+
+		node.setAttribute("spryrowid", "{" + value + "::ds_RowID}");
+	},
+
+	attach: function(rgn, node, value)
+	{
+		Spry.Data.Region.setRowAttrClickHandler(node, value, "spryrowid", "setCurrentRow");
+		node.removeAttribute("spry:setrow");
+		node.removeAttribute("spryrowid");
+	}
+};
+
+Spry.Data.Region.behaviorAttrs["spry:setrownumber"] =
+{
+	setup: function(node, value)
+	{
+		if (!value)
+		{
+			Spry.Debug.reportError("The spry:setrownumber attribute requires a data set name as its value!");
+			node.removeAttribute("spry:setrownumber");
+			return;
+		}
+
+		// Tag the node with an attribute that will allow us to fetch the row number
+		// of the row used when it is written out during the re-generation process.
+
+		node.setAttribute("spryrownumber", "{" + value + "::ds_RowID}");
+	},
+
+	attach: function(rgn, node, value)
+	{
+		Spry.Data.Region.setRowAttrClickHandler(node, value, "spryrownumber", "setCurrentRowNumber");
+		node.removeAttribute("spry:setrownumber");
+		node.removeAttribute("spryrownumber");
+	}
+};
+
+Spry.Data.Region.behaviorAttrs["spry:sort"] =
+{
+	attach: function(rgn, node, value)
+	{
+		if (!value)
+			return;
+
+		// The format of a spry:sort attribute is as follows:
+		//
+		// <div spry:sort="dataSetName column1Name column2Name ... sortOrderName">
+		//
+		// The dataSetName and sortOrderName are optional, but when specified, they
+		// must appear in the order mentioned above. If the dataSetName is not specified,
+		// the first data set listed for the region is used. If the sortOrderName is not
+		// specified, the sort defaults to "toggle".
+		//
+		// The user *must* specify at least one column name.
+
+		var ds = rgn.getDataSets()[0];
+		var sortOrder = "toggle";
+
+		var colArray = value.split(/\s/);
+		if (colArray.length > 1)
+		{
+			// Check the first string in the attribute to see if a data set was
+			// specified. If so, make sure we use it for the sort.
+
+			try
+			{
+				var specifiedDS = eval(colArray[0]);
+				if (specifiedDS && (typeof specifiedDS) == "object")
+				{
+					ds = specifiedDS;
+					colArray.shift();
+				}
+
+			} catch(e) {}
+
+			// Check to see if the last string in the attribute is the name of
+			// a sort order. If so, use that sort order during the sort.
+
+			if (colArray.length > 1)
+			{
+				var str = colArray[colArray.length - 1];
+				if (str == "ascending" || str == "descending" || str == "toggle")
+				{
+					sortOrder = str;
+					colArray.pop();
+				}
+			}
+		}
+
+		// If we have a data set and some column names, add a non-destructive
+		// onclick handler that will perform a toggle sort on the data set.
+
+		if (ds && colArray.length > 0)
+			Spry.Utils.addEventListener(node, "click", function(event){ ds.sort(colArray, sortOrder); }, false);
+
+		node.removeAttribute("spry:sort");
+	}
+};
+
+Spry.Data.Region.prototype.attachBehaviors = function()
+{
+	var rgn = this;
+	Spry.Utils.getNodesByFunc(this.regionNode, function(node)
+	{
+		if (!node || node.nodeType != 1 /* Node.ELEMENT_NODE */)
+			return false;
+		try
+		{
+			var bAttrs = Spry.Data.Region.behaviorAttrs;
+			for (var bAttrName in bAttrs)
+			{
+				var attr = node.attributes.getNamedItem(bAttrName);
+				if (attr)
+				{
+					var behavior = bAttrs[bAttrName];
+					if (behavior && behavior.attach)
+						behavior.attach(rgn, node, attr.value);
+				}
+			}
+		} catch(e) {}
+
+		return false;
+	});
+};
+
+Spry.Data.Region.prototype.updateContent = function()
+{
+	var allDataSetsReady = true;
+
+	var dsArray = this.getDataSets();
+
+	if (!dsArray || dsArray.length < 1)
+	{
+		Spry.Debug.reportError("updateContent(): Region '" + this.name + "' has no data set!\n");
+		return;
+	}
+
+	for (var i = 0; i < dsArray.length; i++)
+	{
+		var ds = dsArray[i];
+
+		if (ds)
+		{
+			if (ds.getLoadDataRequestIsPending())
+				allDataSetsReady = false;
+			else if (!ds.getDataWasLoaded())
+			{
+				// Kick off the loading of the data if it hasn't happened yet.
+				ds.loadData();
+				allDataSetsReady = false;
+			}
+		}
+	}
+
+	if (!allDataSetsReady)
+	{
+		Spry.Data.Region.notifyObservers("onLoadingData", this);
+
+		// Just return, this method will get called again automatically
+		// as each data set load completes!
+		return;
+	}
+
+	this.setState("ready");
+};
+
+Spry.Data.Region.prototype.clearContent = function()
+{
+	this.regionNode.innerHTML = "";
+};
+
+Spry.Data.Region.processContentPI = function(inStr)
+{
+	var outStr = "";
+	var regexp = /<!--\s*<\/?spry:content\s*[^>]*>\s*-->/mg;
+	var searchStartIndex = 0;
+	var processingContentTag = 0;
+
+	while (inStr.length)
+	{
+		var results = regexp.exec(inStr);
+		if (!results || !results[0])
+		{
+			outStr += inStr.substr(searchStartIndex, inStr.length - searchStartIndex);
+			break;
+		}
+
+		if (!processingContentTag && results.index != searchStartIndex)
+		{
+			// We found a match but it's not at the start of the inStr.
+			// Create a string token for everything that precedes the match.
+			outStr += inStr.substr(searchStartIndex, results.index - searchStartIndex);
+		}
+
+		if (results[0].search(/<\//) != -1)
+		{
+			--processingContentTag;
+			if (processingContentTag)
+				Spry.Debug.reportError("Nested spry:content regions are not allowed!\n");
+		}
+		else
+		{
+			++processingContentTag;
+			var dataRefStr = results[0].replace(/.*\bdataref="/, "");
+			outStr += dataRefStr.replace(/".*$/, "");
+		}
+		
+		searchStartIndex = regexp.lastIndex;
+	}
+
+	return outStr;
+}
+
+Spry.Data.Region.prototype.tokenizeData = function(dataStr)
+{
+	// If there is no data, there's nothing to do.
+	if (!dataStr)
+		return null;
+
+	var rootToken = new Spry.Data.Region.Token(Spry.Data.Region.Token.LIST_TOKEN, null, null, null);
+	var tokenStack = new Array;
+	var parseStr = Spry.Data.Region.processContentPI(dataStr);
+
+	tokenStack.push(rootToken);
+
+	// Create a regular expression that will match one of the following:
+	//
+	//   <spry:repeat select="regionName" test="true">
+	//   </spry:repeat>
+	//   {valueReference}
+	var regexp = /((<!--\s*){0,1}<\/{0,1}spry:[^>]+>(\s*-->){0,1})|((\{|%7[bB])[^\}\s%]+(\}|%7[dD]))/mg;
+	var searchStartIndex = 0;
+
+	while(parseStr.length)
+	{
+		var results = regexp.exec(parseStr);
+		var token = null;
+		
+		if (!results || !results[0])
+		{
+			// If we get here, the rest of the parseStr should be
+			// just a plain string. Create a token for it and then
+			// break out of the list.
+			var str = parseStr.substr(searchStartIndex, parseStr.length - searchStartIndex);
+			token = new Spry.Data.Region.Token(Spry.Data.Region.Token.STRING_TOKEN, null, str, str);
+			tokenStack[tokenStack.length - 1].addChild(token);
+			break;
+		}
+
+		if (results.index != searchStartIndex)
+		{
+			// We found a match but it's not at the start of the parseStr.
+			// Create a string token for everything that precedes the match.
+			var str = parseStr.substr(searchStartIndex, results.index - searchStartIndex);
+			token = new Spry.Data.Region.Token(Spry.Data.Region.Token.STRING_TOKEN, null, str, str);
+			tokenStack[tokenStack.length - 1].addChild(token);
+		}
+
+		// We found a string that needs to be turned into a token. Create a token
+		// for it and then update parseStr for the next iteration.
+		if (results[0].search(/^({|%7[bB])/) != -1 /* results[0].charAt(0) == '{' */)
+		{
+			var valueName = results[0];
+			var regionStr = results[0];
+			
+			// Strip off brace and url encode brace chars inside the valueName.
+
+			valueName = valueName.replace(/^({|%7[bB])/, "");
+			valueName = valueName.replace(/(}|%7[dD])$/, "");
+
+			// Check to see if our value begins with the name of a data set.
+			// For example: {dataSet:tokenValue}. If it is, we need to save
+			// the data set name so we know which data set to use to get the
+			// value for the token during the region transform.
+
+			var dataSetName = null;
+			var splitArray = valueName.split(/::/);
+
+			if (splitArray.length > 1)
+			{
+				dataSetName = splitArray[0];
+				valueName = splitArray[1];
+			}
+
+			// Convert any url encoded braces to regular brace chars.
+
+			regionStr = regionStr.replace(/^%7[bB]/, "{");
+			regionStr = regionStr.replace(/%7[dD]$/, "}");
+
+			// Now create a token for the placeholder.
+
+			token = new Spry.Data.Region.Token(Spry.Data.Region.Token.VALUE_TOKEN, dataSetName, valueName, new String(regionStr));
+			tokenStack[tokenStack.length - 1].addChild(token);
+		}
+		else if (results[0].charAt(0) == '<')
+		{
+			// Extract out the name of the processing instruction.
+			var piName = results[0].replace(/^(<!--\s*){0,1}<\/?/, "");
+			piName = piName.replace(/>(\s*-->){0,1}|\s.*$/, "");
+			
+			if (results[0].search(/<\//) != -1 /* results[0].charAt(1) == '/' */)
+			{
+				// We found a processing instruction close tag. Pop the top of the
+				// token stack!
+				//
+				// XXX: We need to make sure that the close tag name matches the one
+				//      on the top of the token stack!
+				if (tokenStack[tokenStack.length - 1].tokenType != Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN)
+				{
+					Spry.Debug.reportError("Invalid processing instruction close tag: " + piName + " -- " + results[0] + "\n");
+					return null;
+				}
+
+				tokenStack.pop();
+			}
+			else
+			{
+				// Create the processing instruction token, add it as a child of the token
+				// at the top of the token stack, and then push it on the stack so that it
+				// becomes the parent of any tokens between it and its close tag.
+
+				var piDesc = Spry.Data.Region.PI.instructions[piName];
+
+				if (piDesc)
+				{
+					var dataSet = null;
+
+					var selectedDataSetName = "";
+					if (results[0].search(/^.*\bselect=\"/) != -1)
+					{
+						selectedDataSetName = results[0].replace(/^.*\bselect=\"/, "");
+						selectedDataSetName = selectedDataSetName.replace(/".*$/, "");
+	
+						if (selectedDataSetName)
+						{
+							try
+							{
+								dataSet = eval(selectedDataSetName);
+							}
+							catch (e)
+							{
+								Spry.Debug.reportError("Caught exception in tokenizeData() while trying to retrieve data set (" + selectedDataSetName + "): " + e + "\n");
+								dataSet = null;
+								selectedDataSetName = "";
+							}
+						}
+					}
+
+					// Check if the repeat has a test attribute.
+					var jsExpr = null;
+					if (results[0].search(/^.*\btest=\"/) != -1)
+					{
+						jsExpr = results[0].replace(/^.*\btest=\"/, "");
+						jsExpr = jsExpr.replace(/".*$/, "");
+						jsExpr = Spry.Utils.decodeEntities(jsExpr);
+					}
+
+					// Check if the instruction has a state name specified.
+					var regionState = null;
+					if (results[0].search(/^.*\bname=\"/) != -1)
+					{
+						regionState = results[0].replace(/^.*\bname=\"/, "");
+						regionState = regionState.replace(/".*$/, "");
+						regionState = Spry.Utils.decodeEntities(regionState);
+					}
+
+					var piData = new Spry.Data.Region.Token.PIData(piName, selectedDataSetName, jsExpr, regionState);
+
+					token = new Spry.Data.Region.Token(Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN, dataSet, piData, new String(results[0]));
+
+					tokenStack[tokenStack.length - 1].addChild(token);
+					tokenStack.push(token);
+				}
+				else
+				{
+					Spry.Debug.reportError("Unsupported region processing instruction: " + results[0] + "\n");
+					return null;
+				}
+			}
+		}
+		else
+		{
+			Spry.Debug.reportError("Invalid region token: " + results[0] + "\n");
+			return null;
+		}
+
+		searchStartIndex = regexp.lastIndex;
+	}
+
+	return rootToken;
+};
+
+Spry.Data.Region.prototype.processTokenChildren = function(token, processContext)
+{
+	// The use of an array to gather the strings returned from processing
+	// the child tokens is actually a performance enhancement for IE.
+	// The original code:
+	//
+	//     for (var i = 0; i < token.children.length; i++)
+	//       outputStr += this.processTokens(token.children[i], processContext);
+	//
+	// seemed to cause an n-square problem in IE. Using an array with
+	// a final join reduced one of our test cases (SelectExample.html) from over
+	// a minute to about 15 seconds.
+	
+	var strArr = [ "" ];
+	var len = token.children.length;
+	var children = token.children;
+	
+	for (var i = 0; i < len; i++)
+		strArr.push(this.processTokens(children[i], processContext));
+
+	return strArr.join("");
+};
+
+Spry.Data.Region.prototype.processTokens = function(token, processContext)
+{
+	if (!processContext)
+	{
+		processContext = new Spry.Data.Region.ProcessingContext(this);
+		if (!processContext)
+			return "";
+	}
+
+	var outputStr = "";
+	var i = 0;
+
+	switch(token.tokenType)
+	{
+		case Spry.Data.Region.Token.LIST_TOKEN:
+			outputStr += this.processTokenChildren(token, processContext);
+			break;
+		case Spry.Data.Region.Token.STRING_TOKEN:
+			outputStr += token.data;
+			break;
+		case Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN:
+			if (token.data.name == "spry:repeat")
+			{
+				var dataSet = null;
+
+				if (token.dataSet)
+					dataSet = token.dataSet;
+				else
+					dataSet = this.dataSets[0];
+
+				if (dataSet)
+				{
+					var dsContext = processContext.getDataSetContext(dataSet);
+					if (!dsContext)
+					{
+						Spry.Debug.reportError("processTokens() failed to get a data set context!\n");
+						break;
+					}
+
+					var numRows = dsContext.getNumRows();
+					var dataSetRows = dataSet.getData();
+					dsContext.pushState();
+
+					for (i = 0; i < numRows; i++)
+					{
+						dsContext.setRowIndex(i);
+						var testVal = true;
+						if (token.data.jsExpr)
+						{
+							var jsExpr = Spry.Data.Region.processDataRefString(processContext, token.data.jsExpr, null, true);
+							try { testVal = Spry.Utils.eval(jsExpr); }
+							catch(e)
+							{
+								Spry.Debug.trace("Caught exception in Spry.Data.Region.prototype.processTokens while evaluating: " + jsExpr + "\n    Exception:" + e + "\n");
+								testVal = true;
+							}
+						}
+
+						if (testVal)
+							outputStr += this.processTokenChildren(token, processContext);
+					}
+
+					dsContext.popState();
+				}
+			}
+			else if (token.data.name == "spry:if")
+			{
+				var testVal = true;
+				
+				if (token.data.jsExpr)
+				{
+					var jsExpr = Spry.Data.Region.processDataRefString(processContext, token.data.jsExpr, null, true);
+
+					try { testVal = Spry.Utils.eval(jsExpr); }
+					catch(e)
+					{
+						Spry.Debug.trace("Caught exception in Spry.Data.Region.prototype.processTokens while evaluating: " + jsExpr + "\n    Exception:" + e + "\n");
+						testVal = true;
+					}
+				}
+	
+				if (testVal)
+					outputStr += this.processTokenChildren(token, processContext);
+			}
+			else if (token.data.name == "spry:choose")
+			{
+				var defaultChild = null;
+				var childToProcess = null;
+				var testVal = false;
+				var j = 0;
+
+				// All of the children of the spry:choose token should be of the type spry:when or spry:default.
+				// Run through all of the spry:when children and see if any of their test expressions return true.
+				// If one does, then process its children tokens. If none of the test expressions return true,
+				// process the spry:default token's children, if it exists.
+
+				for (j = 0; j < token.children.length; j++)
+				{
+					var child = token.children[j];
+					if (child.tokenType == Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN)
+					{
+						if (child.data.name == "spry:when")
+						{
+							if (child.data.jsExpr)
+							{
+								var jsExpr = Spry.Data.Region.processDataRefString(processContext, child.data.jsExpr, null, true);
+								try { testVal = Spry.Utils.eval(jsExpr); }
+								catch(e)
+								{
+									Spry.Debug.trace("Caught exception in Spry.Data.Region.prototype.processTokens while evaluating: " + jsExpr + "\n    Exception:" + e + "\n");
+									testVal = false;
+								}
+
+								if (testVal)
+								{
+									childToProcess = child;
+									break;
+								}
+							}
+						}
+						else if (child.data.name == "spry:default")
+							defaultChild = child;
+					}
+				}
+
+				// If we didn't find a match, use the token for the default case.
+
+				if (!childToProcess && defaultChild)
+					childToProcess = defaultChild;
+
+				if (childToProcess)
+					outputStr += this.processTokenChildren(childToProcess, processContext);
+			}
+			else if (token.data.name == "spry:state")
+			{
+				var testVal = true;
+				
+				if (!token.data.regionState || token.data.regionState == this.currentState)
+					outputStr += this.processTokenChildren(token, processContext);
+			}
+			else
+			{
+				Spry.Debug.reportError("processTokens(): Unknown processing instruction: " + token.data.name + "\n");
+				return "";
+			}
+			break;
+		case Spry.Data.Region.Token.VALUE_TOKEN:
+
+			var dataSet = token.dataSet;
+			if (!dataSet && this.dataSets && this.dataSets.length > 0 && this.dataSets[0])
+			{
+				// No dataSet was specified by the token, so use whatever the first
+				// data set specified in the region.
+
+				dataSet = this.dataSets[0];
+			}
+			if (!dataSet)
+			{
+				Spry.Debug.reportError("processTokens(): Value reference has no data set specified: " + token.regionStr + "\n");
+				return "";
+			}
+
+			var dsContext = processContext.getDataSetContext(dataSet);
+			if (!dsContext)
+			{
+				Spry.Debug.reportError("processTokens: Failed to get a data set context!\n");
+				return "";
+			}
+
+			var ds = dsContext.getDataSet();
+
+			if (token.data == "ds_RowNumber")
+				outputStr += dsContext.getRowIndex();
+			else if (token.data == "ds_RowNumberPlus1")
+				outputStr += (dsContext.getRowIndex() + 1);
+			else if (token.data == "ds_RowCount")
+				outputStr += dsContext.getNumRows();
+			else if (token.data == "ds_UnfilteredRowCount")
+				outputStr += dsContext.getNumRows(true);
+			else if (token.data == "ds_CurrentRowNumber")
+				outputStr += ds.getRowNumber(ds.getCurrentRow());
+			else if (token.data == "ds_CurrentRowID")
+				outputStr += ds.curRowID;
+			else if (token.data == "ds_EvenOddRow")
+				outputStr += (dsContext.getRowIndex() % 2) ? Spry.Data.Region.evenRowClassName : Spry.Data.Region.oddRowClassName;
+			else if (token.data == "ds_SortOrder")
+				outputStr += ds.getSortOrder();
+			else if (token.data == "ds_SortColumn")
+				outputStr += ds.getSortColumn();
+			else
+			{
+				var curDataSetRow = dsContext.getCurrentRow();
+				if (curDataSetRow)
+					outputStr += curDataSetRow[token.data];
+			}
+			break;
+		default:
+			Spry.Debug.reportError("processTokens(): Invalid token type: " + token.regionStr + "\n");
+			break;
+	}
+
+	return outputStr;
+};
+
+Spry.Data.Region.prototype.transform = function()
+{
+	if (this.data && !this.tokens)
+		this.tokens = this.tokenizeData(this.data);
+
+	if (!this.tokens)
+		return "";
+
+	return this.processTokens(this.tokens, null);
+};
+
+Spry.Data.Region.PI = {};
+Spry.Data.Region.PI.instructions = {};
+
+Spry.Data.Region.PI.buildOpenTagForValueAttr = function(ele, piName, attrName)
+{
+	if (!ele || !piName)
+		return "";
+
+	var jsExpr = "";
+
+	try
+	{
+		var testAttr = ele.attributes.getNamedItem(piName);
+		if (testAttr && testAttr.value)
+			jsExpr = Spry.Utils.encodeEntities(testAttr.value);
+	}
+	catch (e) { jsExpr = ""; }
+
+	if (!jsExpr)
+	{
+		Spry.Debug.reportError(piName + " attribute requires a JavaScript expression that returns true or false!\n");
+		return "";
+	}
+
+	return "<" + Spry.Data.Region.PI.instructions[piName].tagName + " " + attrName +"=\"" + jsExpr + "\">";
+};
+
+Spry.Data.Region.PI.buildOpenTagForTest = function(ele, piName)
+{
+	return Spry.Data.Region.PI.buildOpenTagForValueAttr(ele, piName, "test");
+};
+
+Spry.Data.Region.PI.buildOpenTagForState = function(ele, piName)
+{
+	return Spry.Data.Region.PI.buildOpenTagForValueAttr(ele, piName, "name");
+};
+
+Spry.Data.Region.PI.buildOpenTagForRepeat = function(ele, piName)
+{
+	if (!ele || !piName)
+		return "";
+
+	var selectAttrStr = "";
+
+	try
+	{
+		var selectAttr = ele.attributes.getNamedItem(piName);
+		if (selectAttr && selectAttr.value)
+		{
+			selectAttrStr = selectAttr.value;
+			selectAttrStr = selectAttrStr.replace(/\s/g, "");
+		}
+	}
+	catch (e) { selectAttrStr = ""; }
+
+	if (!selectAttrStr)
+	{
+		Spry.Debug.reportError(piName + " attribute requires a data set name!\n");
+		return "";
+	}
+
+	var testAttrStr = "";
+
+	try
+	{
+		var testAttr = ele.attributes.getNamedItem("spry:test");
+		if (testAttr)
+		{
+			if (testAttr.value)
+				testAttrStr = " test=\"" + Spry.Utils.encodeEntities(testAttr.value) + "\"";
+			ele.attributes.removeNamedItem(testAttr.nodeName);
+		}
+	}
+	catch (e) { testAttrStr = ""; }
+
+	return "<" + Spry.Data.Region.PI.instructions[piName].tagName + " select=\"" + selectAttrStr + "\"" + testAttrStr + ">";
+};
+
+Spry.Data.Region.PI.buildOpenTagForContent = function(ele, piName)
+{
+	if (!ele || !piName)
+		return "";
+
+	var dataRefStr = "";
+
+	try
+	{
+		var contentAttr = ele.attributes.getNamedItem(piName);
+		if (contentAttr && contentAttr.value)
+			dataRefStr = Spry.Utils.encodeEntities(contentAttr.value);
+	}
+	catch (e) { dataRefStr = ""; }
+
+	if (!dataRefStr)
+	{
+		Spry.Debug.reportError(piName + " attribute requires a data reference!\n");
+		return "";
+	}
+
+	return "<" + Spry.Data.Region.PI.instructions[piName].tagName + " dataref=\"" + dataRefStr + "\">";
+};
+
+Spry.Data.Region.PI.buildOpenTag = function(ele, piName)
+{
+	return "<" + Spry.Data.Region.PI.instructions[piName].tagName + ">";
+};
+
+Spry.Data.Region.PI.buildCloseTag = function(ele, piName)
+{
+	return "</" + Spry.Data.Region.PI.instructions[piName].tagName + ">";
+};
+
+Spry.Data.Region.PI.instructions["spry:state"] = { tagName: "spry:state", childrenOnly: false, getOpenTag: Spry.Data.Region.PI.buildOpenTagForState, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:if"] = { tagName: "spry:if", childrenOnly: false, getOpenTag: Spry.Data.Region.PI.buildOpenTagForTest, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:repeat"] = { tagName: "spry:repeat", childrenOnly: false, getOpenTag: Spry.Data.Region.PI.buildOpenTagForRepeat, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:repeatchildren"] = { tagName: "spry:repeat", childrenOnly: true, getOpenTag: Spry.Data.Region.PI.buildOpenTagForRepeat, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:choose"] = { tagName: "spry:choose", childrenOnly: true, getOpenTag: Spry.Data.Region.PI.buildOpenTag, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:when"] = { tagName: "spry:when", childrenOnly: false, getOpenTag: Spry.Data.Region.PI.buildOpenTagForTest, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:default"] = { tagName: "spry:default", childrenOnly: false, getOpenTag: Spry.Data.Region.PI.buildOpenTag, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+Spry.Data.Region.PI.instructions["spry:content"] = { tagName: "spry:content", childrenOnly: true, getOpenTag: Spry.Data.Region.PI.buildOpenTagForContent, getCloseTag: Spry.Data.Region.PI.buildCloseTag };
+
+Spry.Data.Region.PI.orderedInstructions = [ "spry:state", "spry:if", "spry:repeat", "spry:repeatchildren", "spry:choose", "spry:when", "spry:default", "spry:content" ];
+
+Spry.Data.Region.getTokensFromStr = function(str)
+{
+	// XXX: This will need to be modified if we support
+	// tokens that use javascript between the braces!
+	if (!str)
+		return null;
+	return str.match(/{[^}]+}/g);
+};
+
+Spry.Data.Region.processDataRefString = function(processingContext, regionStr, dataSetsToUse, isJSExpr)
+{
+	if (!regionStr)
+		return "";
+
+	if (!processingContext && !dataSetsToUse)
+		return regionStr;
+
+	var resultStr = "";
+	var re = new RegExp("\\{([^\\}:]+::)?[^\\}]+\\}", "g");
+	var startSearchIndex = 0;
+
+	while (startSearchIndex < regionStr.length)
+	{
+		var reArray = re.exec(regionStr);
+		if (!reArray || !reArray[0])
+		{
+			resultStr += regionStr.substr(startSearchIndex, regionStr.length - startSearchIndex);
+			return resultStr;
+		}
+
+		if (reArray.index != startSearchIndex)
+			resultStr += regionStr.substr(startSearchIndex, reArray.index - startSearchIndex);
+
+		var dsName = "";
+		if (reArray[0].search(/^\{[^}:]+::/) != -1)
+			dsName = reArray[0].replace(/^\{|::.*/g, "");
+
+		var fieldName = reArray[0].replace(/^\{|.*::|\}/g, "");
+		var row = null;
+
+		if (processingContext)
+		{
+			var dsContext = processingContext.getDataSetContext(dsName);
+
+			if (fieldName == "ds_RowNumber")
+			{
+				resultStr += dsContext.getRowIndex();
+				row = null;
+			}
+			else if (fieldName == "ds_RowNumberPlus1")
+			{
+				resultStr += (dsContext.getRowIndex() + 1);
+				row = null;
+			}
+			else if (fieldName == "ds_RowCount")
+			{
+				resultStr += dsContext.getNumRows();
+				row = null;
+			}
+			else if (fieldName == "ds_UnfilteredRowCount")
+			{
+				resultStr += dsContext.getNumRows(true);
+				row = null;
+			}
+			else if (fieldName == "ds_CurrentRowNumber")
+			{
+				var ds = dsContext.getDataSet();
+				resultStr += ds.getRowNumber(ds.getCurrentRow());
+				row = null;
+			}
+			else if (fieldName == "ds_CurrentRowID")
+			{
+				var ds = dsContext.getDataSet();
+				resultStr += "" + ds.curRowID;
+				row = null;
+			}
+			else if (fieldName == "ds_EvenOddRow")
+			{
+				resultStr += (dsContext.getRowIndex() % 2) ? Spry.Data.Region.evenRowClassName : Spry.Data.Region.oddRowClassName;
+				row = null;
+			}
+			else if (fieldName == "ds_SortOrder")
+			{
+				resultStr += dsContext.getDataSet().getSortOrder();;
+				row = null;
+			}
+			else if (fieldName == "ds_SortColumn")
+			{
+				resultStr += dsContext.getDataSet().getSortColumn();
+				row = null;
+			}
+			else
+				row = processingContext.getCurrentRowForDataSet(dsName);
+		}
+		else
+		{
+			var ds = dsName ? dataSetsToUse[dsName] : dataSetsToUse[0];
+			if (ds)
+				row = ds.getCurrentRow();
+		}
+
+		if (row)
+			resultStr += isJSExpr ? Spry.Utils.escapeQuotesAndLineBreaks("" + row[fieldName]) : row[fieldName];
+
+		if (startSearchIndex == re.lastIndex)
+		{
+			// On IE if there was a match near the end of the string, it sometimes
+			// leaves re.lastIndex pointing to the value it had before the last time
+			// we called re.exec. We check for this case to prevent an infinite loop!
+			// We need to write out any text in regionStr that comes after the last
+			// match.
+
+			var leftOverIndex = reArray.index + reArray[0].length;
+			if (leftOverIndex < regionStr.length)
+				resultStr += regionStr.substr(leftOverIndex);
+
+			break;
+		}
+
+		startSearchIndex = re.lastIndex;
+	}
+
+	return resultStr;
+};
+
+Spry.Data.Region.strToDataSetsArray = function(str, returnRegionNames)
+{
+	var dataSetsArr = new Array;
+	var foundHash = {};
+
+	if (!str)
+		return dataSetsArr;
+
+	str = str.replace(/\s+/g, " ");
+	str = str.replace(/^\s|\s$/g, "");
+	var arr = str.split(/ /);
+
+
+	for (var i = 0; i < arr.length; i++)
+	{
+		if (arr[i] && !Spry.Data.Region.PI.instructions[arr[i]])
+		{
+			try {
+				var dataSet = eval(arr[i]);
+
+				if (!foundHash[arr[i]])
+				{
+					if (returnRegionNames)
+						dataSetsArr.push(arr[i]);
+					else
+						dataSetsArr.push(dataSet);
+					foundHash[arr[i]] = true;
+				}
+			}
+			catch (e) { /* Spry.Debug.trace("Caught exception: " + e + "\n"); */ }
+		}
+	}
+
+	return dataSetsArr;
+};
+
+Spry.Data.Region.DSContext = function(dataSet)
+{
+	var m_self = this;
+	var m_dataSet = dataSet;
+	var m_curRowIndexArray = [ -1 ]; // -1 means return whatever the current row is inside the data set.
+
+	// Private Methods:
+
+	function getInternalRowIndex() { return m_curRowIndexArray[m_curRowIndexArray.length - 1]; }
+
+	// Public Methods:
+	this.resetAll = function() { m_curRowIndexArray = [ m_dataSet.getCurrentRow() ] };
+	this.getDataSet = function() { return m_dataSet; };
+	this.getNumRows = function(unfiltered)
+	{
+		return m_dataSet.getRowCount(unfiltered);
+	};
+	this.getCurrentRow = function()
+	{
+		if (m_curRowIndexArray.length < 2 || getInternalRowIndex() < 0)
+			return m_dataSet.getCurrentRow();
+	
+		var data = m_dataSet.getData();
+		var curRowIndex = getInternalRowIndex();
+	
+		if (curRowIndex < 0 || curRowIndex > data.length)
+		{
+			Spry.Debug.reportError("Invalid index used in Spry.Data.Region.DSContext.getCurrentRow()!\n");
+			return null;
+		}
+	
+		return data[curRowIndex];
+	};
+	this.getRowIndex = function()
+	{
+		var curRowIndex = getInternalRowIndex();
+		if (curRowIndex >= 0)
+			return curRowIndex;
+
+		return m_dataSet.getRowNumber(m_dataSet.getCurrentRow());
+	};
+	this.setRowIndex = function(rowIndex) { m_curRowIndexArray[m_curRowIndexArray.length - 1] = rowIndex; };
+	this.pushState = function() { m_curRowIndexArray.push( getInternalRowIndex()); };
+	this.popState = function()
+	{
+		if (m_curRowIndexArray.length < 2)
+		{
+			// Our array should always have at least one element in it!
+			Spry.Debug.reportError("Stack underflow in Spry.Data.Region.DSContext.popState()!\n");
+			return;
+		}
+		m_curRowIndexArray.pop();
+	};
+};
+
+Spry.Data.Region.ProcessingContext = function(region)
+{
+	var m_self = this;
+	var m_region = region;
+	var m_dataSetContexts = [];
+	
+	if (region && region.dataSets)
+	{
+		for (var i = 0; i < region.dataSets.length; i++)
+			m_dataSetContexts.push(new Spry.Data.Region.DSContext(region.dataSets[i]));
+	}
+
+	this.getDataSetContext = function(dataSet)
+	{
+		if (!dataSet)
+		{
+			// We were called without a specified data set or
+			// data set name. Assume the caller wants the first
+			// data set in the processing context.
+
+			if (m_dataSetContexts.length > 0)
+				return m_dataSetContexts[0];
+			return null;
+		}
+
+		if (typeof dataSet == 'string')
+		{
+			try { dataSet = eval(dataSet); } catch (e) { dataSet = null; }
+			if (!dataSet)
+				return null;
+		}
+	
+		for (var i = 0; i < m_dataSetContexts.length; i++)
+		{
+			var dsc = m_dataSetContexts[i];
+			if (dsc.getDataSet() == dataSet)
+				return dsc;
+		}
+	
+		return null;
+	};
+
+	this.getCurrentRowForDataSet = function(dataSet)
+	{
+		var dsc = m_self.getDataSetContext(dataSet);
+		if (dsc)
+			return dsc.getCurrentRow();
+		return null;
+	};
+};
+
+Spry.Data.Region.Token = function(tokenType, dataSet, data, regionStr)
+{
+	var self = this;
+	this.tokenType = tokenType;
+	this.dataSet = dataSet;
+	this.data = data;
+	this.regionStr = regionStr;
+	this.parent = null;
+	this.children = null;
+};
+
+Spry.Data.Region.Token.prototype.addChild = function(child)
+{
+	if (!child)
+		return;
+	
+	if (!this.children)
+		this.children = new Array;
+	
+	this.children.push(child);
+	child.parent = this;
+};
+
+Spry.Data.Region.Token.LIST_TOKEN                   = 0;
+Spry.Data.Region.Token.STRING_TOKEN                 = 1;
+Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN = 2;
+Spry.Data.Region.Token.VALUE_TOKEN                  = 3;
+
+Spry.Data.Region.Token.PIData = function(piName, data, jsExpr, regionState)
+{
+	var self = this;
+	this.name = piName;
+	this.data = data;
+	this.jsExpr = jsExpr;
+	this.regionState = regionState;
+};
+
+Spry.Utils.addLoadListener(function() { setTimeout(function() { Spry.Data.initRegions(); }, 0); });

Added: YDFramework2.0/trunk/examples/adobe_spry/index.php
===================================================================
--- YDFramework2.0/trunk/examples/adobe_spry/index.php	2007-01-03 12:50:04 UTC (rev 2294)
+++ YDFramework2.0/trunk/examples/adobe_spry/index.php	2007-01-03 12:51:22 UTC (rev 2295)
@@ -0,0 +1,56 @@
+<?php
+
+    // Initialize the Yellow Duck Framework
+    include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
+
+    // Database setup
+    $db['type'] = 'mysql';
+    $db['name'] = 'mysql';
+    $db['user'] = 'root';
+    $db['pass'] = '';
+    $db['host'] = 'localhost';
+
+    // Includes
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDDatabase.php' );
+
+    // Class definition for the index request
+    class index extends YDRequest {
+
+        // Class constructor
+        function index() {
+
+            // Initialize the parent class
+            $this->YDRequest();
+
+            // Initialize the template object
+            $this->template = new YDTemplate();
+
+            // Make the database connection
+            $this->db = YDDatabase::getInstance(
+                $GLOBALS['db']['type'],
+                $GLOBALS['db']['name'],
+                $GLOBALS['db']['user'],
+                $GLOBALS['db']['pass'],
+                $GLOBALS['db']['host']
+            );
+
+        }
+
+        // Default action
+        function actionDefault() {
+            $this->template->display();
+        }
+
+        // Get the records as XML
+        function actionGetRecords() {
+            header( 'Content-type: text/xml' );
+            echo( YDArrayUtil::toXml( $this->db->getRecords( 'show status' ) ) );
+        }
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/adobe_spry/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/adobe_spry/index.tpl	2007-01-03 12:50:04 UTC (rev 2294)
+++ YDFramework2.0/trunk/examples/adobe_spry/index.tpl	2007-01-03 12:51:22 UTC (rev 2295)
@@ -0,0 +1,85 @@
+<html>
+
+<head>
+
+    <title>Adobe Spry + Yellow Duck Framework</title>
+
+    <script type="text/javascript" src="xpath.js"></script>
+    <script type="text/javascript" src="SpryData.js"></script>
+
+    {literal}<style>
+        .even {
+            background-color: #eee;
+        }
+        .odd {
+            background-color: #fff;
+        }
+        th {
+            text-align: left;
+            background-color: #ccc;
+        }
+    </style>
+
+    <script type="text/javascript">
+
+        var dsData = new Spry.Data.XMLDataSet( "?do=GetRecords", "root/row" );
+
+        function FilterData() {
+            var tf = document.getElementById( "filterTF" );
+            if ( ! tf.value ) {
+                dsData.filter(null);
+                return;
+            }
+            var regExpStr = tf.value;
+            if ( ! document.getElementById( "containsCB" ).checked ) {
+                regExpStr = "^" + regExpStr;
+            }
+            var regExp = new RegExp( regExpStr, "i" );
+            var filterFunc = function( ds, row, rowNumber ) {
+                var str = row["variable_name"];
+                if ( str && str.search( regExp ) != -1 ) {
+                    return row;
+                }
+                return null;
+            };
+            dsData.filter( filterFunc );
+        }
+
+        function StartFilterTimer() {
+            if ( StartFilterTimer.timerID ) {
+                clearTimeout( StartFilterTimer.timerID );
+            }
+            StartFilterTimer.timerID = setTimeout(
+                function() { StartFilterTimer.timerID = null; FilterData(); }, 100
+            );
+        }
+
+    </script>{/literal}
+
+</head>
+
+<body>
+
+    <h1>Adobe Spry + Yellow Duck Framework</h1>
+
+    <p>Enter the name of a variable: 
+        <input type="text" id="filterTF" onkeyup="StartFilterTimer();" /> 
+        Contains: <input type="checkbox" id="containsCB" />
+    </p>
+
+    {literal}<div spry:region="dsData">
+        <table border="0" width="100%" cellspacing="0" cellpadding="4">
+            <tr>
+                <th scope="col" onclick="dsData.sort('variable_name');">Variable</th>
+                <th scope="col" onclick="dsData.sort('value');">Value</th>
+            </tr>
+            <tr spry:repeat="dsData" class="{ds_EvenOddRow}">
+                <td>{variable_name}</td>
+                <td>{value}</td>
+            </tr>
+        </table>
+    </div>{/literal}
+
+</body>
+
+</html>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/adobe_spry/xpath.js
===================================================================
--- YDFramework2.0/trunk/examples/adobe_spry/xpath.js	2007-01-03 12:50:04 UTC (rev 2294)
+++ YDFramework2.0/trunk/examples/adobe_spry/xpath.js	2007-01-03 12:51:22 UTC (rev 2295)
@@ -0,0 +1,2499 @@
+/* xpath.js - Revision: Spry Preview Release 1.4 */
+
+// Copyright (c) 2005, Google Inc.
+// All rights reserved.
+// 
+// Redistribution and use in source and binary forms, with or without
+// modification, are permitted provided that the following conditions are
+// met:
+//         
+//  * Redistributions of source code must retain the above copyright
+//    notice, this list of conditions and the following disclaimer.
+// 
+//  * Redistributions in binary form must reproduce the above copyright
+//    notice, this list of conditions and the following disclaimer in the
+//    documentation and/or other materials provided with the
+//    distribution.
+// 
+//  * Neither the name of Google Inc. nor the names of its contributors
+//    may be used to endorse or promote products derived from this
+//    software without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+// An XPath parser and evaluator written in JavaScript. The
+// implementation is complete except for functions handling
+// namespaces.
+//
+// Reference: [XPATH] XPath Specification
+// <http://www.w3.org/TR/1999/REC-xpath-19991116>.
+//
+//
+// The API of the parser has several parts:
+//
+// 1. The parser function xpathParse() that takes a string and returns
+// an expession object.
+//
+// 2. The expression object that has an evaluate() method to evaluate the
+// XPath expression it represents. (It is actually a hierarchy of
+// objects that resembles the parse tree, but an application will call
+// evaluate() only on the top node of this hierarchy.)
+//
+// 3. The context object that is passed as an argument to the evaluate()
+// method, which represents the DOM context in which the expression is
+// evaluated.
+//
+// 4. The value object that is returned from evaluate() and represents
+// values of the different types that are defined by XPath (number,
+// string, boolean, and node-set), and allows to convert between them.
+//
+// These parts are near the top of the file, the functions and data
+// that are used internally follow after them.
+//
+//
+// TODO(mesch): add jsdoc comments. Use more coherent naming.
+//
+//
+// Author: Steffen Meschkat <mesch at google.com>
+
+
+// The entry point for the parser.
+//
+// @param expr a string that contains an XPath expression.
+// @return an expression object that can be evaluated with an
+// expression context.
+
+function xpathParse(expr) {
+  if (xpathdebug) {
+    Log.write('XPath parse ' + expr);
+  }
+  xpathParseInit();
+
+  var cached = xpathCacheLookup(expr);
+  if (cached) {
+    if (xpathdebug) {
+      Log.write(' ... cached');
+    }
+    return cached;
+  }
+
+  // Optimize for a few common cases: simple attribute node tests
+  // (@id), simple element node tests (page), variable references
+  // ($address), numbers (4), multi-step path expressions where each
+  // step is a plain element node test
+  // (page/overlay/locations/location).
+  
+  if (expr.match(/^(\$|@)?\w+$/i)) {
+    var ret = makeSimpleExpr(expr);
+    xpathParseCache[expr] = ret;
+    if (xpathdebug) {
+      Log.write(' ... simple');
+    }
+    return ret;
+  }
+
+  if (expr.match(/^\w+(\/\w+)*$/i)) {
+    var ret = makeSimpleExpr2(expr);
+    xpathParseCache[expr] = ret;
+    if (xpathdebug) {
+      Log.write(' ... simple 2');
+    }
+    return ret;
+  }
+
+  var cachekey = expr; // expr is modified during parse
+  if (xpathdebug) {
+    Timer.start('XPath parse', cachekey);
+  }
+
+  var stack = [];
+  var ahead = null;
+  var previous = null;
+  var done = false;
+
+  var parse_count = 0;
+  var lexer_count = 0;
+  var reduce_count = 0;
+  
+  while (!done) {
+    parse_count++;
+    expr = expr.replace(/^\s*/, '');
+    previous = ahead;
+    ahead = null;
+
+    var rule = null;
+    var match = '';
+    for (var i = 0; i < xpathTokenRules.length; ++i) {
+      var result = xpathTokenRules[i].re.exec(expr);
+      lexer_count++;
+      if (result && result.length > 0 && result[0].length > match.length) {
+        rule = xpathTokenRules[i];
+        match = result[0];
+        break;
+      }
+    }
+
+    // Special case: allow operator keywords to be element and
+    // variable names.
+
+    // NOTE(mesch): The parser resolves conflicts by looking ahead,
+    // and this is the only case where we look back to
+    // disambiguate. So this is indeed something different, and
+    // looking back is usually done in the lexer (via states in the
+    // general case, called "start conditions" in flex(1)). Also,the
+    // conflict resolution in the parser is not as robust as it could
+    // be, so I'd like to keep as much off the parser as possible (all
+    // these precedence values should be computed from the grammar
+    // rules and possibly associativity declarations, as in bison(1),
+    // and not explicitly set.
+
+    if (rule &&
+        (rule == TOK_DIV || 
+         rule == TOK_MOD ||
+         rule == TOK_AND || 
+         rule == TOK_OR) &&
+        (!previous || 
+         previous.tag == TOK_AT || 
+         previous.tag == TOK_DSLASH || 
+         previous.tag == TOK_SLASH ||
+         previous.tag == TOK_AXIS || 
+         previous.tag == TOK_DOLLAR)) {
+      rule = TOK_QNAME;
+    }
+
+    if (rule) {
+      expr = expr.substr(match.length);
+      if (xpathdebug) {
+        Log.write('token: ' + match + ' -- ' + rule.label);
+      }
+      ahead = {
+        tag: rule,
+        match: match,
+        prec: rule.prec ?  rule.prec : 0, // || 0 is removed by the compiler
+        expr: makeTokenExpr(match)
+      };
+
+    } else {
+      if (xpathdebug) {
+        Log.write('DONE');
+      }
+      done = true;
+    }
+
+    while (xpathReduce(stack, ahead)) {
+      reduce_count++;
+      if (xpathdebug) {
+        Log.write('stack: ' + stackToString(stack));
+      }
+    }
+  }
+
+  if (xpathdebug) {
+    Log.write(stackToString(stack));
+  }
+
+  if (stack.length != 1) {
+    throw 'XPath parse error ' + cachekey + ':\n' + stackToString(stack);
+  }
+
+  var result = stack[0].expr;
+  xpathParseCache[cachekey] = result;
+
+  if (xpathdebug) {
+    Timer.end('XPath parse', cachekey);
+  }
+
+  if (xpathdebug) {
+    Log.write('XPath parse: ' + parse_count + ' / ' + 
+              lexer_count + ' / ' + reduce_count);
+  }
+
+  return result;
+}
+
+var xpathParseCache = {};
+
+function xpathCacheLookup(expr) {
+  return xpathParseCache[expr];
+}
+
+function xpathReduce(stack, ahead) {
+  var cand = null;
+
+  if (stack.length > 0) {
+    var top = stack[stack.length-1];
+    var ruleset = xpathRules[top.tag.key];
+
+    if (ruleset) {
+      for (var i = 0; i < ruleset.length; ++i) {
+        var rule = ruleset[i];
+        var match = xpathMatchStack(stack, rule[1]);
+        if (match.length) {
+          cand = {
+            tag: rule[0],
+            rule: rule,
+            match: match
+          };
+          cand.prec = xpathGrammarPrecedence(cand);
+          break;
+        }
+      }
+    }
+  }
+
+  var ret;
+  if (cand && (!ahead || cand.prec > ahead.prec || 
+               (ahead.tag.left && cand.prec >= ahead.prec))) {
+    for (var i = 0; i < cand.match.matchlength; ++i) {
+      stack.pop();
+    }
+
+    if (xpathdebug) {
+      Log.write('reduce ' + cand.tag.label + ' ' + cand.prec +
+                ' ahead ' + (ahead ? ahead.tag.label + ' ' + ahead.prec + 
+                             (ahead.tag.left ? ' left' : '')
+                             : ' none '));
+    }
+
+    var matchexpr = mapExpr(cand.match, function(m) { return m.expr; });
+    cand.expr = cand.rule[3].apply(null, matchexpr);
+
+    stack.push(cand);
+    ret = true;
+
+  } else {
+    if (ahead) {
+      if (xpathdebug) {
+        Log.write('shift ' + ahead.tag.label + ' ' + ahead.prec + 
+                  (ahead.tag.left ? ' left' : '') +
+                  ' over ' + (cand ? cand.tag.label + ' ' + 
+                              cand.prec : ' none'));
+      }
+      stack.push(ahead);
+    }
+    ret = false;
+  }
+  return ret;
+}
+
+function xpathMatchStack(stack, pattern) {
+
+  // NOTE(mesch): The stack matches for variable cardinality are
+  // greedy but don't do backtracking. This would be an issue only
+  // with rules of the form A* A, i.e. with an element with variable
+  // cardinality followed by the same element. Since that doesn't
+  // occur in the grammar at hand, all matches on the stack are
+  // unambiguous.
+
+  var S = stack.length;
+  var P = pattern.length;
+  var p, s;
+  var match = [];
+  match.matchlength = 0;
+  var ds = 0;
+  for (p = P - 1, s = S - 1; p >= 0 && s >= 0; --p, s -= ds) {
+    ds = 0;
+    var qmatch = [];
+    if (pattern[p] == Q_MM) {
+      p -= 1;
+      match.push(qmatch);
+      while (s - ds >= 0 && stack[s - ds].tag == pattern[p]) {
+        qmatch.push(stack[s - ds]);
+        ds += 1;
+        match.matchlength += 1;
+      }
+
+    } else if (pattern[p] == Q_01) {
+      p -= 1;
+      match.push(qmatch);
+      while (s - ds >= 0 && ds < 2 && stack[s - ds].tag == pattern[p]) {
+        qmatch.push(stack[s - ds]);
+        ds += 1;
+        match.matchlength += 1;
+      }
+
+    } else if (pattern[p] == Q_1M) {
+      p -= 1;
+      match.push(qmatch);
+      if (stack[s].tag == pattern[p]) {
+        while (s - ds >= 0 && stack[s - ds].tag == pattern[p]) {
+          qmatch.push(stack[s - ds]);
+          ds += 1;
+          match.matchlength += 1;
+        }
+      } else {
+        return [];
+      }
+
+    } else if (stack[s].tag == pattern[p]) {
+      match.push(stack[s]);
+      ds += 1;
+      match.matchlength += 1;
+
+    } else {
+      return [];
+    }
+
+    reverseInplace(qmatch);
+    qmatch.expr = mapExpr(qmatch, function(m) { return m.expr; });
+  }
+
+  reverseInplace(match);
+
+  if (p == -1) {
+    return match;
+
+  } else {
+    return [];
+  }
+}
+
+function xpathTokenPrecedence(tag) {
+  return tag.prec || 2;
+}
+
+function xpathGrammarPrecedence(frame) {
+  var ret = 0;
+
+  if (frame.rule) { /* normal reduce */
+    if (frame.rule.length >= 3 && frame.rule[2] >= 0) {
+      ret = frame.rule[2];
+
+    } else {
+      for (var i = 0; i < frame.rule[1].length; ++i) {
+        var p = xpathTokenPrecedence(frame.rule[1][i]);
+        ret = Math.max(ret, p);
+      }
+    }
+  } else if (frame.tag) { /* TOKEN match */
+    ret = xpathTokenPrecedence(frame.tag);
+
+  } else if (frame.length) { /* Q_ match */
+    for (var j = 0; j < frame.length; ++j) {
+      var p = xpathGrammarPrecedence(frame[j]);
+      ret = Math.max(ret, p);
+    }
+  }
+
+  return ret;
+}
+
+function stackToString(stack) {
+  var ret = '';
+  for (var i = 0; i < stack.length; ++i) {
+    if (ret) {
+      ret += '\n';
+    }
+    ret += stack[i].tag.label;
+  }
+  return ret;
+}
+
+
+// XPath expression evaluation context. An XPath context consists of a
+// DOM node, a list of DOM nodes that contains this node, a number
+// that represents the position of the single node in the list, and a
+// current set of variable bindings. (See XPath spec.)
+//
+// The interface of the expression context:
+//
+//   Constructor -- gets the node, its position, the node set it
+//   belongs to, and a parent context as arguments. The parent context
+//   is used to implement scoping rules for variables: if a variable
+//   is not found in the current context, it is looked for in the
+//   parent context, recursively. Except for node, all arguments have
+//   default values: default position is 0, default node set is the
+//   set that contains only the node, and the default parent is null.
+//
+//     Notice that position starts at 0 at the outside interface;
+//     inside XPath expressions this shows up as position()=1.
+//
+//   clone() -- creates a new context with the current context as
+//   parent. If passed as argument to clone(), the new context has a
+//   different node, position, or node set. What is not passed is
+//   inherited from the cloned context.
+//
+//   setVariable(name, expr) -- binds given XPath expression to the
+//   name.
+//
+//   getVariable(name) -- what the name says.
+//
+//   setNode(node, position) -- sets the context to the new node and
+//   its corresponding position. Needed to implement scoping rules for
+//   variables in XPath. (A variable is visible to all subsequent
+//   siblings, not only to its children.)
+
+function ExprContext(node, position, nodelist, parent) {
+  this.node = node;
+  this.position = position || 0;
+  this.nodelist = nodelist || [ node ];
+  this.variables = {};
+  this.parent = parent || null;
+  this.root = parent ? parent.root : node.ownerDocument;
+}
+
+ExprContext.prototype.clone = function(node, position, nodelist) {
+  return new
+  ExprContext(node || this.node,
+              typeof position != 'undefined' ? position : this.position,
+              nodelist || this.nodelist, this);
+};
+
+ExprContext.prototype.setVariable = function(name, value) {
+  this.variables[name] = value;
+};
+
+ExprContext.prototype.getVariable = function(name) {
+  if (typeof this.variables[name] != 'undefined') {
+    return this.variables[name];
+
+  } else if (this.parent) {
+    return this.parent.getVariable(name);
+
+  } else {
+    return null;
+  }
+}
+
+ExprContext.prototype.setNode = function(node, position) {
+  this.node = node;
+  this.position = position;
+}
+
+
+// XPath expression values. They are what XPath expressions evaluate
+// to. Strangely, the different value types are not specified in the
+// XPath syntax, but only in the semantics, so they don't show up as
+// nonterminals in the grammar. Yet, some expressions are required to
+// evaluate to particular types, and not every type can be coerced
+// into every other type. Although the types of XPath values are
+// similar to the types present in JavaScript, the type coercion rules
+// are a bit peculiar, so we explicitly model XPath types instead of
+// mapping them onto JavaScript types. (See XPath spec.)
+//
+// The four types are:
+//
+//   StringValue
+//
+//   NumberValue
+//
+//   BooleanValue
+//
+//   NodeSetValue
+//
+// The common interface of the value classes consists of methods that
+// implement the XPath type coercion rules:
+//
+//   stringValue() -- returns the value as a JavaScript String,
+//
+//   numberValue() -- returns the value as a JavaScript Number,
+//
+//   booleanValue() -- returns the value as a JavaScript Boolean,
+//
+//   nodeSetValue() -- returns the value as a JavaScript Array of DOM
+//   Node objects.
+//
+
+function StringValue(value) {
+  this.value = value;
+  this.type = 'string';
+}
+
+StringValue.prototype.stringValue = function() {
+  return this.value;
+}
+
+StringValue.prototype.booleanValue = function() {
+  return this.value.length > 0;
+}
+
+StringValue.prototype.numberValue = function() {
+  return this.value - 0;
+}
+
+StringValue.prototype.nodeSetValue = function() {
+  throw this + ' ' + Error().stack;
+}
+
+function BooleanValue(value) {
+  this.value = value;
+  this.type = 'boolean';
+}
+
+BooleanValue.prototype.stringValue = function() {
+  return '' + this.value;
+}
+
+BooleanValue.prototype.booleanValue = function() {
+  return this.value;
+}
+
+BooleanValue.prototype.numberValue = function() {
+  return this.value ? 1 : 0;
+}
+
+BooleanValue.prototype.nodeSetValue = function() {
+  throw this + ' ' + Error().stack;
+}
+
+function NumberValue(value) {
+  this.value = value;
+  this.type = 'number';
+}
+
+NumberValue.prototype.stringValue = function() {
+  return '' + this.value;
+}
+
+NumberValue.prototype.booleanValue = function() {
+  return !!this.value;
+}
+
+NumberValue.prototype.numberValue = function() {
+  return this.value - 0;
+}
+
+NumberValue.prototype.nodeSetValue = function() {
+  throw this + ' ' + Error().stack;
+}
+
+function NodeSetValue(value) {
+  this.value = value;
+  this.type = 'node-set';
+}
+
+NodeSetValue.prototype.stringValue = function() {
+  if (this.value.length == 0) {
+    return '';
+  } else {
+    return xmlValue(this.value[0]);
+  }
+}
+
+NodeSetValue.prototype.booleanValue = function() {
+  return this.value.length > 0;
+}
+
+NodeSetValue.prototype.numberValue = function() {
+  return this.stringValue() - 0;
+}
+
+NodeSetValue.prototype.nodeSetValue = function() {
+  return this.value;
+};
+
+// XPath expressions. They are used as nodes in the parse tree and
+// possess an evaluate() method to compute an XPath value given an XPath
+// context. Expressions are returned from the parser. Teh set of
+// expression classes closely mirrors the set of non terminal symbols
+// in the grammar. Every non trivial nonterminal symbol has a
+// corresponding expression class.
+//
+// The common expression interface consists of the following methods:
+//
+// evaluate(context) -- evaluates the expression, returns a value.
+//
+// toString() -- returns the XPath text representation of the
+// expression (defined in xsltdebug.js).
+//
+// parseTree(indent) -- returns a parse tree representation of the
+// expression (defined in xsltdebug.js).
+
+function TokenExpr(m) {
+  this.value = m;
+}
+
+TokenExpr.prototype.evaluate = function() {
+  return new StringValue(this.value);
+};
+
+function LocationExpr() {
+  this.absolute = false;
+  this.steps = [];
+}
+
+LocationExpr.prototype.appendStep = function(s) {
+  this.steps.push(s);
+}
+
+LocationExpr.prototype.prependStep = function(s) {
+  var steps0 = this.steps;
+  this.steps = [ s ];
+  for (var i = 0; i < steps0.length; ++i) {
+    this.steps.push(steps0[i]);
+  }
+};
+
+LocationExpr.prototype.evaluate = function(ctx) {
+  var start;
+  if (this.absolute) {
+    start = ctx.root;
+
+  } else {
+    start = ctx.node;
+  }
+
+  var nodes = [];
+  xPathStep(nodes, this.steps, 0, start, ctx);
+  return new NodeSetValue(nodes);
+};
+
+function xPathStep(nodes, steps, step, input, ctx) {
+  var s = steps[step];
+  var ctx2 = ctx.clone(input);
+  var nodelist = s.evaluate(ctx2).nodeSetValue();
+
+  for (var i = 0; i < nodelist.length; ++i) {
+    if (step == steps.length - 1) {
+      nodes.push(nodelist[i]);
+    } else {
+      xPathStep(nodes, steps, step + 1, nodelist[i], ctx);
+    }
+  }
+}
+
+function StepExpr(axis, nodetest, predicate) {
+  this.axis = axis;
+  this.nodetest = nodetest;
+  this.predicate = predicate || [];
+}
+
+StepExpr.prototype.appendPredicate = function(p) {
+  this.predicate.push(p);
+}
+
+StepExpr.prototype.evaluate = function(ctx) {
+  var input = ctx.node;
+  var nodelist = [];
+
+  // NOTE(mesch): When this was a switch() statement, it didn't work
+  // in Safari/2.0. Not sure why though; it resulted in the JavaScript
+  // console output "undefined" (without any line number or so).
+
+  if (this.axis ==  xpathAxis.ANCESTOR_OR_SELF) {
+    nodelist.push(input);
+    for (var n = input.parentNode; n; n = input.parentNode) {
+      nodelist.push(n);
+    }
+
+  } else if (this.axis == xpathAxis.ANCESTOR) {
+    for (var n = input.parentNode; n; n = input.parentNode) {
+      nodelist.push(n);
+    }
+
+  } else if (this.axis == xpathAxis.ATTRIBUTE) {
+    copyArray(nodelist, input.attributes);
+
+  } else if (this.axis == xpathAxis.CHILD) {
+    copyArray(nodelist, input.childNodes);
+
+  } else if (this.axis == xpathAxis.DESCENDANT_OR_SELF) {
+    nodelist.push(input);
+    xpathCollectDescendants(nodelist, input);
+
+  } else if (this.axis == xpathAxis.DESCENDANT) {
+    xpathCollectDescendants(nodelist, input);
+
+  } else if (this.axis == xpathAxis.FOLLOWING) {
+    for (var n = input.parentNode; n; n = n.parentNode) {
+      for (var nn = n.nextSibling; nn; nn = nn.nextSibling) {
+        nodelist.push(nn);
+        xpathCollectDescendants(nodelist, nn);
+      }
+    }
+
+  } else if (this.axis == xpathAxis.FOLLOWING_SIBLING) {
+    for (var n = input.nextSibling; n; n = input.nextSibling) {
+      nodelist.push(n);
+    }
+
+  } else if (this.axis == xpathAxis.NAMESPACE) {
+    alert('not implemented: axis namespace');
+
+  } else if (this.axis == xpathAxis.PARENT) {
+    if (input.parentNode) {
+      nodelist.push(input.parentNode);
+    }
+
+  } else if (this.axis == xpathAxis.PRECEDING) {
+    for (var n = input.parentNode; n; n = n.parentNode) {
+      for (var nn = n.previousSibling; nn; nn = nn.previousSibling) {
+        nodelist.push(nn);
+        xpathCollectDescendantsReverse(nodelist, nn);
+      }
+    }
+
+  } else if (this.axis == xpathAxis.PRECEDING_SIBLING) {
+    for (var n = input.previousSibling; n; n = input.previousSibling) {
+      nodelist.push(n);
+    }
+
+  } else if (this.axis == xpathAxis.SELF) {
+    nodelist.push(input);
+
+  } else {
+    throw 'ERROR -- NO SUCH AXIS: ' + this.axis;
+  }
+
+  // process node test
+  var nodelist0 = nodelist;
+  nodelist = [];
+  for (var i = 0; i < nodelist0.length; ++i) {
+    var n = nodelist0[i];
+    if (this.nodetest.evaluate(ctx.clone(n, i, nodelist0)).booleanValue()) {
+      nodelist.push(n);
+    }
+  }
+
+  // process predicates
+  for (var i = 0; i < this.predicate.length; ++i) {
+    var nodelist0 = nodelist;
+    nodelist = [];
+    for (var ii = 0; ii < nodelist0.length; ++ii) {
+      var n = nodelist0[ii];
+      if (this.predicate[i].evaluate(ctx.clone(n, ii, nodelist0)).booleanValue()) {
+        nodelist.push(n);
+      }
+    }
+  }
+
+  return new NodeSetValue(nodelist);
+};
+
+function NodeTestAny() {
+  this.value = new BooleanValue(true);
+}
+
+NodeTestAny.prototype.evaluate = function(ctx) {
+  return this.value;
+};
+
+function NodeTestElement() {}
+
+NodeTestElement.prototype.evaluate = function(ctx) {
+  return new BooleanValue(ctx.node.nodeType == DOM_ELEMENT_NODE);
+}
+
+function NodeTestText() {}
+
+NodeTestText.prototype.evaluate = function(ctx) {
+  return new BooleanValue(ctx.node.nodeType == DOM_TEXT_NODE);
+}
+
+function NodeTestComment() {}
+
+NodeTestComment.prototype.evaluate = function(ctx) {
+  return new BooleanValue(ctx.node.nodeType == DOM_COMMENT_NODE);
+}
+
+function NodeTestPI(target) {
+  this.target = target;
+}
+
+NodeTestPI.prototype.evaluate = function(ctx) {
+  return new
+  BooleanValue(ctx.node.nodeType == DOM_PROCESSING_INSTRUCTION_NODE &&
+               (!this.target || ctx.node.nodeName == this.target));
+}
+
+function NodeTestNC(nsprefix) {
+  this.regex = new RegExp("^" + nsprefix + ":");
+  this.nsprefix = nsprefix;
+}
+
+NodeTestNC.prototype.evaluate = function(ctx) {
+  var n = ctx.node;
+  return new BooleanValue(this.regex.match(n.nodeName));
+}
+
+function NodeTestName(name) {
+  this.name = name;
+}
+
+NodeTestName.prototype.evaluate = function(ctx) {
+  var n = ctx.node;
+  return new BooleanValue(n.nodeName == this.name);
+}
+
+function PredicateExpr(expr) {
+  this.expr = expr;
+}
+
+PredicateExpr.prototype.evaluate = function(ctx) {
+  var v = this.expr.evaluate(ctx);
+  if (v.type == 'number') {
+    // NOTE(mesch): Internally, position is represented starting with
+    // 0, however in XPath position starts with 1. See functions
+    // position() and last().
+    return new BooleanValue(ctx.position == v.numberValue() - 1);
+  } else {
+    return new BooleanValue(v.booleanValue());
+  }
+};
+
+function FunctionCallExpr(name) {
+  this.name = name;
+  this.args = [];
+}
+
+FunctionCallExpr.prototype.appendArg = function(arg) {
+  this.args.push(arg);
+};
+
+FunctionCallExpr.prototype.evaluate = function(ctx) {
+  var fn = '' + this.name.value;
+  var f = this.xpathfunctions[fn];
+  if (f) {
+    return f.call(this, ctx);
+  } else {
+    Log.write('XPath NO SUCH FUNCTION ' + fn);
+    return new BooleanValue(false);
+  }
+};
+
+FunctionCallExpr.prototype.xpathfunctions = {
+  'last': function(ctx) {
+    assert(this.args.length == 0);
+    // NOTE(mesch): XPath position starts at 1.
+    return new NumberValue(ctx.nodelist.length);
+  },
+
+  'position': function(ctx) {
+    assert(this.args.length == 0);
+    // NOTE(mesch): XPath position starts at 1.
+    return new NumberValue(ctx.position + 1);
+  },
+
+  'count': function(ctx) {
+    assert(this.args.length == 1);
+    var v = this.args[0].evaluate(ctx);
+    return new NumberValue(v.nodeSetValue().length);
+  },
+
+  'id': function(ctx) {
+    assert(this.args.length == 1);
+    var e = this.args.evaluate(ctx);
+    var ret = [];
+    var ids;
+    if (e.type == 'node-set') {
+      ids = [];
+      for (var i = 0; i < e.length; ++i) {
+        var v = xmlValue(e[i]).split(/\s+/);
+        for (var ii = 0; ii < v.length; ++ii) {
+          ids.push(v[ii]);
+        }
+      }
+    } else {
+      ids = e.split(/\s+/);
+    }
+    var d = ctx.node.ownerDocument;
+    for (var i = 0; i < ids.length; ++i) {
+      var n = d.getElementById(ids[i]);
+      if (n) {
+        ret.push(n);
+      }
+    }
+    return new NodeSetValue(ret);
+  },
+
+  'local-name': function(ctx) {
+    alert('not implmented yet: XPath function local-name()');
+  },
+
+  'namespace-uri': function(ctx) {
+    alert('not implmented yet: XPath function namespace-uri()');
+  },
+
+  'name': function(ctx) {
+    assert(this.args.length == 1 || this.args.length == 0);
+    var n;
+    if (this.args.length == 0) {
+      n = [ ctx.node ];
+    } else {
+      n = this.args[0].evaluate(ctx).nodeSetValue();
+    }
+
+    if (n.length == 0) {
+      return new StringValue('');
+    } else {
+      return new StringValue(n[0].nodeName);
+    }
+  },
+
+  'string':  function(ctx) {
+    assert(this.args.length == 1 || this.args.length == 0);
+    if (this.args.length == 0) {
+      return new StringValue(new NodeSetValue([ ctx.node ]).stringValue());
+    } else {
+      return new StringValue(this.args[0].evaluate(ctx).stringValue());
+    }
+  },
+
+  'concat': function(ctx) {
+    var ret = '';
+    for (var i = 0; i < this.args.length; ++i) {
+      ret += this.args[i].evaluate(ctx).stringValue();
+    }
+    return new StringValue(ret);
+  },
+
+  'starts-with': function(ctx) {
+    assert(this.args.length == 2);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).stringValue();
+    return new BooleanValue(s0.indexOf(s1) == 0);
+  },
+
+  'contains': function(ctx) {
+    assert(this.args.length == 2);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).stringValue();
+    return new BooleanValue(s0.indexOf(s1) != -1);
+  },
+
+  'substring-before': function(ctx) {
+    assert(this.args.length == 2);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).stringValue();
+    var i = s0.indexOf(s1);
+    var ret;
+    if (i == -1) {
+      ret = '';
+    } else {
+      ret = s0.substr(0,i);
+    }
+    return new StringValue(ret);
+  },
+
+  'substring-after': function(ctx) {
+    assert(this.args.length == 2);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).stringValue();
+    var i = s0.indexOf(s1);
+    var ret;
+    if (i == -1) {
+      ret = '';
+    } else {
+      ret = s0.substr(i + s1.length);
+    }
+    return new StringValue(ret);
+  },
+
+  'substring': function(ctx) {
+    // NOTE: XPath defines the position of the first character in a
+    // string to be 1, in JavaScript this is 0 ([XPATH] Section 4.2).
+    assert(this.args.length == 2 || this.args.length == 3);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).numberValue();
+    var ret;
+    if (this.args.length == 2) {
+      var i1 = Math.max(0, Math.round(s1) - 1);
+      ret = s0.substr(i1);
+
+    } else {
+      var s2 = this.args[2].evaluate(ctx).numberValue();
+      var i0 = Math.round(s1) - 1;
+      var i1 = Math.max(0, i0);
+      var i2 = Math.round(s2) - Math.max(0, -i0);
+      ret = s0.substr(i1, i2);
+    }
+    return new StringValue(ret);
+  },
+
+  'string-length': function(ctx) {
+    var s;
+    if (this.args.length > 0) {
+      s = this.args[0].evaluate(ctx).stringValue();
+    } else {
+      s = new NodeSetValue([ ctx.node ]).stringValue();
+    }
+    return new NumberValue(s.length);
+  },
+
+  'normalize-space': function(ctx) {
+    var s;
+    if (this.args.length > 0) {
+      s = this.args[0].evaluate(ctx).stringValue();
+    } else {
+      s = new NodeSetValue([ ctx.node ]).stringValue();
+    }
+    s = s.replace(/^\s*/,'').replace(/\s*$/,'').replace(/\s+/g, ' ');
+    return new StringValue(s);
+  },
+
+  'translate': function(ctx) {
+    assert(this.args.length == 3);
+    var s0 = this.args[0].evaluate(ctx).stringValue();
+    var s1 = this.args[1].evaluate(ctx).stringValue();
+    var s2 = this.args[2].evaluate(ctx).stringValue();
+
+    for (var i = 0; i < s1.length; ++i) {
+      s0 = s0.replace(new RegExp(s1.charAt(i), 'g'), s2.charAt(i));
+    }
+    return new StringValue(s0);
+  },
+
+  'boolean': function(ctx) {
+    assert(this.args.length == 1);
+    return new BooleanValue(this.args[0].evaluate(ctx).booleanValue());
+  },
+
+  'not': function(ctx) {
+    assert(this.args.length == 1);
+    var ret = !this.args[0].evaluate(ctx).booleanValue();
+    return new BooleanValue(ret);
+  },
+
+  'true': function(ctx) {
+    assert(this.args.length == 0);
+    return new BooleanValue(true);
+  },
+
+  'false': function(ctx) {
+    assert(this.args.length == 0);
+    return new BooleanValue(false);
+  },
+
+  'lang': function(ctx) {
+    assert(this.args.length == 1);
+    var lang = this.args[0].evaluate(ctx).stringValue();
+    var xmllang;
+    var n = ctx.node;
+    while (n && n != n.parentNode /* just in case ... */) {
+      xmllang = n.getAttribute('xml:lang');
+      if (xmllang) {
+        break;
+      }
+      n = n.parentNode;
+    }
+    if (!xmllang) {
+      return new BooleanValue(false);
+    } else {
+      var re = new RegExp('^' + lang + '$', 'i');
+      return new BooleanValue(xmllang.match(re) ||
+                              xmllang.replace(/_.*$/,'').match(re));
+    }
+  },
+
+  'number': function(ctx) {
+    assert(this.args.length == 1 || this.args.length == 0);
+
+    if (this.args.length == 1) {
+      return new NumberValue(this.args[0].evaluate(ctx).numberValue());
+    } else {
+      return new NumberValue(new NodeSetValue([ ctx.node ]).numberValue());
+    }
+  },
+
+  'sum': function(ctx) {
+    assert(this.args.length == 1);
+    var n = this.args[0].evaluate(ctx).nodeSetValue();
+    var sum = 0;
+    for (var i = 0; i < n.length; ++i) {
+      sum += xmlValue(n[i]) - 0;
+    }
+    return new NumberValue(sum);
+  },
+
+  'floor': function(ctx) {
+    assert(this.args.length == 1);
+    var num = this.args[0].evaluate(ctx).numberValue();
+    return new NumberValue(Math.floor(num));
+  },
+
+  'ceiling': function(ctx) {
+    assert(this.args.length == 1);
+    var num = this.args[0].evaluate(ctx).numberValue();
+    return new NumberValue(Math.ceil(num));
+  },
+
+  'round': function(ctx) {
+    assert(this.args.length == 1);
+    var num = this.args[0].evaluate(ctx).numberValue();
+    return new NumberValue(Math.round(num));
+  },
+
+  // TODO(mesch): The following functions are custom. There is a
+  // standard that defines how to add functions, which should be
+  // applied here.
+
+  'ext-join': function(ctx) {
+    assert(this.args.length == 2);
+    var nodes = this.args[0].evaluate(ctx).nodeSetValue();
+    var delim = this.args[1].evaluate(ctx).stringValue();
+    var ret = '';
+    for (var i = 0; i < nodes.length; ++i) {
+      if (ret) {
+        ret += delim;
+      }
+      ret += xmlValue(nodes[i]);
+    }
+    return new StringValue(ret);
+  },
+
+  // ext-if() evaluates and returns its second argument, if the
+  // boolean value of its first argument is true, otherwise it
+  // evaluates and returns its third argument.
+
+  'ext-if': function(ctx) {
+    assert(this.args.length == 3);
+    if (this.args[0].evaluate(ctx).booleanValue()) {
+      return this.args[1].evaluate(ctx);
+    } else {
+      return this.args[2].evaluate(ctx);
+    }
+  },
+
+  'ext-sprintf': function(ctx) {
+    assert(this.args.length >= 1);
+    var args = [];
+    for (var i = 0; i < this.args.length; ++i) {
+      args.push(this.args[i].evaluate(ctx).stringValue());
+    }
+    return new StringValue(sprintf.apply(null, args));
+  },
+
+  // ext-cardinal() evaluates its single argument as a number, and
+  // returns the current node that many times. It can be used in the
+  // select attribute to iterate over an integer range.
+  
+  'ext-cardinal': function(ctx) {
+    assert(this.args.length >= 1);
+    var c = this.args[0].evaluate(ctx).numberValue();
+    var ret = [];
+    for (var i = 0; i < c; ++i) {
+      ret.push(ctx.node);
+    }
+    return new NodeSetValue(ret);
+  }
+};
+
+function UnionExpr(expr1, expr2) {
+  this.expr1 = expr1;
+  this.expr2 = expr2;
+}
+
+UnionExpr.prototype.evaluate = function(ctx) {
+  var nodes1 = this.expr1.evaluate(ctx).nodeSetValue();
+  var nodes2 = this.expr2.evaluate(ctx).nodeSetValue();
+  var I1 = nodes1.length;
+  for (var i2 = 0; i2 < nodes2.length; ++i2) {
+    for (var i1 = 0; i1 < I1; ++i1) {
+      if (nodes1[i1] == nodes2[i2]) {
+        // break inner loop and continue outer loop, labels confuse
+        // the js compiler, so we don't use them here.
+        i1 = I1;
+      }
+    }
+    nodes1.push(nodes2[i2]);
+  }
+  return new NodeSetValue(nodes2);
+};
+
+function PathExpr(filter, rel) {
+  this.filter = filter;
+  this.rel = rel;
+}
+
+PathExpr.prototype.evaluate = function(ctx) {
+  var nodes = this.filter.evaluate(ctx).nodeSetValue();
+  var nodes1 = [];
+  for (var i = 0; i < nodes.length; ++i) {
+    var nodes0 = this.rel.evaluate(ctx.clone(nodes[i], i, nodes)).nodeSetValue();
+    for (var ii = 0; ii < nodes0.length; ++ii) {
+      nodes1.push(nodes0[ii]);
+    }
+  }
+  return new NodeSetValue(nodes1);
+};
+
+function FilterExpr(expr, predicate) {
+  this.expr = expr;
+  this.predicate = predicate;
+}
+
+FilterExpr.prototype.evaluate = function(ctx) {
+  var nodes = this.expr.evaluate(ctx).nodeSetValue();
+  for (var i = 0; i < this.predicate.length; ++i) {
+    var nodes0 = nodes;
+    nodes = [];
+    for (var j = 0; j < nodes0.length; ++j) {
+      var n = nodes0[j];
+      if (this.predicate[i].evaluate(ctx.clone(n, j, nodes0)).booleanValue()) {
+        nodes.push(n);
+      }
+    }
+  }
+
+  return new NodeSetValue(nodes);
+}
+
+function UnaryMinusExpr(expr) {
+  this.expr = expr;
+}
+
+UnaryMinusExpr.prototype.evaluate = function(ctx) {
+  return new NumberValue(-this.expr.evaluate(ctx).numberValue());
+};
+
+function BinaryExpr(expr1, op, expr2) {
+  this.expr1 = expr1;
+  this.expr2 = expr2;
+  this.op = op;
+}
+
+BinaryExpr.prototype.evaluate = function(ctx) {
+  var ret;
+  switch (this.op.value) {
+    case 'or':
+      ret = new BooleanValue(this.expr1.evaluate(ctx).booleanValue() ||
+                             this.expr2.evaluate(ctx).booleanValue());
+      break;
+
+    case 'and':
+      ret = new BooleanValue(this.expr1.evaluate(ctx).booleanValue() &&
+                             this.expr2.evaluate(ctx).booleanValue());
+      break;
+
+    case '+':
+      ret = new NumberValue(this.expr1.evaluate(ctx).numberValue() +
+                            this.expr2.evaluate(ctx).numberValue());
+      break;
+
+    case '-':
+      ret = new NumberValue(this.expr1.evaluate(ctx).numberValue() -
+                            this.expr2.evaluate(ctx).numberValue());
+      break;
+
+    case '*':
+      ret = new NumberValue(this.expr1.evaluate(ctx).numberValue() *
+                            this.expr2.evaluate(ctx).numberValue());
+      break;
+
+    case 'mod':
+      ret = new NumberValue(this.expr1.evaluate(ctx).numberValue() %
+                            this.expr2.evaluate(ctx).numberValue());
+      break;
+
+    case 'div':
+      ret = new NumberValue(this.expr1.evaluate(ctx).numberValue() /
+                            this.expr2.evaluate(ctx).numberValue());
+      break;
+
+    case '=':
+      ret = this.compare(ctx, function(x1, x2) { return x1 == x2; });
+      break;
+
+    case '!=':
+      ret = this.compare(ctx, function(x1, x2) { return x1 != x2; });
+      break;
+
+    case '<':
+      ret = this.compare(ctx, function(x1, x2) { return x1 < x2; });
+      break;
+
+    case '<=':
+      ret = this.compare(ctx, function(x1, x2) { return x1 <= x2; });
+      break;
+
+    case '>':
+      ret = this.compare(ctx, function(x1, x2) { return x1 > x2; });
+      break;
+
+    case '>=':
+      ret = this.compare(ctx, function(x1, x2) { return x1 >= x2; });
+      break;
+
+    default:
+      alert('BinaryExpr.evaluate: ' + this.op.value);
+  }
+  return ret;
+};
+
+BinaryExpr.prototype.compare = function(ctx, cmp) {
+  var v1 = this.expr1.evaluate(ctx);
+  var v2 = this.expr2.evaluate(ctx);
+
+  var ret;
+  if (v1.type == 'node-set' && v2.type == 'node-set') {
+    var n1 = v1.nodeSetValue();
+    var n2 = v2.nodeSetValue();
+    ret = false;
+    for (var i1 = 0; i1 < n1.length; ++i1) {
+      for (var i2 = 0; i2 < n2.length; ++i2) {
+        if (cmp(xmlValue(n1[i1]), xmlValue(n2[i2]))) {
+          ret = true;
+          // Break outer loop. Labels confuse the jscompiler and we
+          // don't use them.
+          i2 = n2.length;
+          i1 = n1.length;
+        }
+      }
+    }
+
+  } else if (v1.type == 'node-set' || v2.type == 'node-set') {
+
+    if (v1.type == 'number') {
+      var s = v1.numberValue();
+      var n = v2.nodeSetValue();
+
+      ret = false;
+      for (var i = 0;  i < n.length; ++i) {
+        var nn = xmlValue(n[i]) - 0;
+        if (cmp(s, nn)) {
+          ret = true;
+          break;
+        }
+      }
+
+    } else if (v2.type == 'number') {
+      var n = v1.nodeSetValue();
+      var s = v2.numberValue();
+
+      ret = false;
+      for (var i = 0;  i < n.length; ++i) {
+        var nn = xmlValue(n[i]) - 0;
+        if (cmp(nn, s)) {
+          ret = true;
+          break;
+        }
+      }
+
+    } else if (v1.type == 'string') {
+      var s = v1.stringValue();
+      var n = v2.nodeSetValue();
+
+      ret = false;
+      for (var i = 0;  i < n.length; ++i) {
+        var nn = xmlValue(n[i]);
+        if (cmp(s, nn)) {
+          ret = true;
+          break;
+        }
+      }
+
+    } else if (v2.type == 'string') {
+      var n = v1.nodeSetValue();
+      var s = v2.stringValue();
+
+      ret = false;
+      for (var i = 0;  i < n.length; ++i) {
+        var nn = xmlValue(n[i]);
+        if (cmp(nn, s)) {
+          ret = true;
+          break;
+        }
+      }
+
+    } else {
+      ret = cmp(v1.booleanValue(), v2.booleanValue());
+    }
+
+  } else if (v1.type == 'boolean' || v2.type == 'boolean') {
+    ret = cmp(v1.booleanValue(), v2.booleanValue());
+
+  } else if (v1.type == 'number' || v2.type == 'number') {
+    ret = cmp(v1.numberValue(), v2.numberValue());
+
+  } else {
+    ret = cmp(v1.stringValue(), v2.stringValue());
+  }
+
+  return new BooleanValue(ret);
+}
+
+function LiteralExpr(value) {
+  this.value = value;
+}
+
+LiteralExpr.prototype.evaluate = function(ctx) {
+  return new StringValue(this.value);
+};
+
+function NumberExpr(value) {
+  this.value = value;
+}
+
+NumberExpr.prototype.evaluate = function(ctx) {
+  return new NumberValue(this.value);
+};
+
+function VariableExpr(name) {
+  this.name = name;
+}
+
+VariableExpr.prototype.evaluate = function(ctx) {
+  return ctx.getVariable(this.name);
+}
+
+// Factory functions for semantic values (i.e. Expressions) of the
+// productions in the grammar. When a production is matched to reduce
+// the current parse state stack, the function is called with the
+// semantic values of the matched elements as arguments, and returns
+// another semantic value. The semantic value is a node of the parse
+// tree, an expression object with an evaluate() method that evaluates the
+// expression in an actual context. These factory functions are used
+// in the specification of the grammar rules, below.
+
+function makeTokenExpr(m) {
+  return new TokenExpr(m);
+}
+
+function passExpr(e) {
+  return e;
+}
+
+function makeLocationExpr1(slash, rel) {
+  rel.absolute = true;
+  return rel;
+}
+
+function makeLocationExpr2(dslash, rel) {
+  rel.absolute = true;
+  rel.prependStep(makeAbbrevStep(dslash.value));
+  return rel;
+}
+
+function makeLocationExpr3(slash) {
+  var ret = new LocationExpr();
+  ret.appendStep(makeAbbrevStep('.'));
+  ret.absolute = true;
+  return ret;
+}
+
+function makeLocationExpr4(dslash) {
+  var ret = new LocationExpr();
+  ret.absolute = true;
+  ret.appendStep(makeAbbrevStep(dslash.value));
+  return ret;
+}
+
+function makeLocationExpr5(step) {
+  var ret = new LocationExpr();
+  ret.appendStep(step);
+  return ret;
+}
+
+function makeLocationExpr6(rel, slash, step) {
+  rel.appendStep(step);
+  return rel;
+}
+
+function makeLocationExpr7(rel, dslash, step) {
+  rel.appendStep(makeAbbrevStep(dslash.value));
+  return rel;
+}
+
+function makeStepExpr1(dot) {
+  return makeAbbrevStep(dot.value);
+}
+
+function makeStepExpr2(ddot) {
+  return makeAbbrevStep(ddot.value);
+}
+
+function makeStepExpr3(axisname, axis, nodetest) {
+  return new StepExpr(axisname.value, nodetest);
+}
+
+function makeStepExpr4(at, nodetest) {
+  return new StepExpr('attribute', nodetest);
+}
+
+function makeStepExpr5(nodetest) {
+  return new StepExpr('child', nodetest);
+}
+
+function makeStepExpr6(step, predicate) {
+  step.appendPredicate(predicate);
+  return step;
+}
+
+function makeAbbrevStep(abbrev) {
+  switch (abbrev) {
+  case '//':
+    return new StepExpr('descendant-or-self', new NodeTestAny);
+
+  case '.':
+    return new StepExpr('self', new NodeTestAny);
+
+  case '..':
+    return new StepExpr('parent', new NodeTestAny);
+  }
+}
+
+function makeNodeTestExpr1(asterisk) {
+  return new NodeTestElement;
+}
+
+function makeNodeTestExpr2(ncname, colon, asterisk) {
+  return new NodeTestNC(ncname.value);
+}
+
+function makeNodeTestExpr3(qname) {
+  return new NodeTestName(qname.value);
+}
+
+function makeNodeTestExpr4(typeo, parenc) {
+  var type = typeo.value.replace(/\s*\($/, '');
+  switch(type) {
+  case 'node':
+    return new NodeTestAny;
+
+  case 'text':
+    return new NodeTestText;
+
+  case 'comment':
+    return new NodeTestComment;
+
+  case 'processing-instruction':
+    return new NodeTestPI;
+  }
+}
+
+function makeNodeTestExpr5(typeo, target, parenc) {
+  var type = typeo.replace(/\s*\($/, '');
+  if (type != 'processing-instruction') {
+    throw type + ' ' + Error().stack;
+  }
+  return new NodeTestPI(target.value);
+}
+
+function makePredicateExpr(pareno, expr, parenc) {
+  return new PredicateExpr(expr);
+}
+
+function makePrimaryExpr(pareno, expr, parenc) {
+  return expr;
+}
+
+function makeFunctionCallExpr1(name, pareno, parenc) {
+  return new FunctionCallExpr(name);
+}
+
+function makeFunctionCallExpr2(name, pareno, arg1, args, parenc) {
+  var ret = new FunctionCallExpr(name);
+  ret.appendArg(arg1);
+  for (var i = 0; i < args.length; ++i) {
+    ret.appendArg(args[i]);
+  }
+  return ret;
+}
+
+function makeArgumentExpr(comma, expr) {
+  return expr;
+}
+
+function makeUnionExpr(expr1, pipe, expr2) {
+  return new UnionExpr(expr1, expr2);
+}
+
+function makePathExpr1(filter, slash, rel) {
+  return new PathExpr(filter, rel);
+}
+
+function makePathExpr2(filter, dslash, rel) {
+  rel.prependStep(makeAbbrevStep(dslash.value));
+  return new PathExpr(filter, rel);
+}
+
+function makeFilterExpr(expr, predicates) {
+  if (predicates.length > 0) {
+    return new FilterExpr(expr, predicates);
+  } else {
+    return expr;
+  }
+}
+
+function makeUnaryMinusExpr(minus, expr) {
+  return new UnaryMinusExpr(expr);
+}
+
+function makeBinaryExpr(expr1, op, expr2) {
+  return new BinaryExpr(expr1, op, expr2);
+}
+
+function makeLiteralExpr(token) {
+  // remove quotes from the parsed value:
+  var value = token.value.substring(1, token.value.length - 1);
+  return new LiteralExpr(value);
+}
+
+function makeNumberExpr(token) {
+  return new NumberExpr(token.value);
+}
+
+function makeVariableReference(dollar, name) {
+  return new VariableExpr(name.value);
+}
+
+// Used before parsing for optimization of common simple cases. See
+// the begin of xpathParse() for which they are.
+function makeSimpleExpr(expr) {
+  if (expr.charAt(0) == '$') {
+    return new VariableExpr(expr.substr(1));
+  } else if (expr.charAt(0) == '@') {
+    var a = new NodeTestName(expr.substr(1));
+    var b = new StepExpr('attribute', a);
+    var c = new LocationExpr();
+    c.appendStep(b);
+    return c;
+  } else if (expr.match(/^[0-9]+$/)) {
+    return new NumberExpr(expr);
+  } else {
+    var a = new NodeTestName(expr);
+    var b = new StepExpr('child', a);
+    var c = new LocationExpr();
+    c.appendStep(b);
+    return c;
+  }
+}
+
+function makeSimpleExpr2(expr) {
+  var steps = expr.split('/');
+  var c = new LocationExpr();
+  for (var i = 0; i < steps.length; i++) {
+    var a = new NodeTestName(steps[i]);
+    var b = new StepExpr('child', a);
+    c.appendStep(b);
+  }
+  return c;
+}
+
+// The axes of XPath expressions.
+
+var xpathAxis = {
+  ANCESTOR_OR_SELF: 'ancestor-or-self',
+  ANCESTOR: 'ancestor',
+  ATTRIBUTE: 'attribute',
+  CHILD: 'child',
+  DESCENDANT_OR_SELF: 'descendant-or-self',
+  DESCENDANT: 'descendant',
+  FOLLOWING_SIBLING: 'following-sibling',
+  FOLLOWING: 'following',
+  NAMESPACE: 'namespace',
+  PARENT: 'parent',
+  PRECEDING_SIBLING: 'preceding-sibling',
+  PRECEDING: 'preceding',
+  SELF: 'self'
+};
+
+var xpathAxesRe = [
+    xpathAxis.ANCESTOR_OR_SELF,
+    xpathAxis.ANCESTOR,
+    xpathAxis.ATTRIBUTE,
+    xpathAxis.CHILD,
+    xpathAxis.DESCENDANT_OR_SELF,
+    xpathAxis.DESCENDANT,
+    xpathAxis.FOLLOWING_SIBLING,
+    xpathAxis.FOLLOWING,
+    xpathAxis.NAMESPACE,
+    xpathAxis.PARENT,
+    xpathAxis.PRECEDING_SIBLING,
+    xpathAxis.PRECEDING,
+    xpathAxis.SELF
+].join('|');
+
+
+// The tokens of the language. The label property is just used for
+// generating debug output. The prec property is the precedence used
+// for shift/reduce resolution. Default precedence is 0 as a lookahead
+// token and 2 on the stack. TODO(mesch): this is certainly not
+// necessary and too complicated. Simplify this!
+
+// NOTE: tabular formatting is the big exception, but here it should
+// be OK.
+
+var TOK_PIPE =   { label: "|",   prec:   17, re: new RegExp("^\\|") };
+var TOK_DSLASH = { label: "//",  prec:   19, re: new RegExp("^//")  };
+var TOK_SLASH =  { label: "/",   prec:   30, re: new RegExp("^/")   };
+var TOK_AXIS =   { label: "::",  prec:   20, re: new RegExp("^::")  };
+var TOK_COLON =  { label: ":",   prec: 1000, re: new RegExp("^:")  };
+var TOK_AXISNAME = { label: "[axis]", re: new RegExp('^(' + xpathAxesRe + ')') };
+var TOK_PARENO = { label: "(",   prec:   34, re: new RegExp("^\\(") };
+var TOK_PARENC = { label: ")",               re: new RegExp("^\\)") };
+var TOK_DDOT =   { label: "..",  prec:   34, re: new RegExp("^\\.\\.") };
+var TOK_DOT =    { label: ".",   prec:   34, re: new RegExp("^\\.") };
+var TOK_AT =     { label: "@",   prec:   34, re: new RegExp("^@")   };
+
+var TOK_COMMA =  { label: ",",               re: new RegExp("^,") };
+
+var TOK_OR =     { label: "or",  prec:   10, re: new RegExp("^or\\b") };
+var TOK_AND =    { label: "and", prec:   11, re: new RegExp("^and\\b") };
+var TOK_EQ =     { label: "=",   prec:   12, re: new RegExp("^=")   };
+var TOK_NEQ =    { label: "!=",  prec:   12, re: new RegExp("^!=")  };
+var TOK_GE =     { label: ">=",  prec:   13, re: new RegExp("^>=")  };
+var TOK_GT =     { label: ">",   prec:   13, re: new RegExp("^>")   };
+var TOK_LE =     { label: "<=",  prec:   13, re: new RegExp("^<=")  };
+var TOK_LT =     { label: "<",   prec:   13, re: new RegExp("^<")   };
+var TOK_PLUS =   { label: "+",   prec:   14, re: new RegExp("^\\+"), left: true };
+var TOK_MINUS =  { label: "-",   prec:   14, re: new RegExp("^\\-"), left: true };
+var TOK_DIV =    { label: "div", prec:   15, re: new RegExp("^div\\b"), left: true };
+var TOK_MOD =    { label: "mod", prec:   15, re: new RegExp("^mod\\b"), left: true };
+
+var TOK_BRACKO = { label: "[",   prec:   32, re: new RegExp("^\\[") };
+var TOK_BRACKC = { label: "]",               re: new RegExp("^\\]") };
+var TOK_DOLLAR = { label: "$",               re: new RegExp("^\\$") };
+
+var TOK_NCNAME = { label: "[ncname]", re: new RegExp('^[a-z][-\\w]*','i') };
+
+var TOK_ASTERISK = { label: "*", prec: 15, re: new RegExp("^\\*"), left: true };
+var TOK_LITERALQ = { label: "[litq]", prec: 20, re: new RegExp("^'[^\\']*'") };
+var TOK_LITERALQQ = {
+  label: "[litqq]",
+  prec: 20,
+  re: new RegExp('^"[^\\"]*"')
+};
+
+var TOK_NUMBER  = {
+  label: "[number]",
+  prec: 35,
+  re: new RegExp('^\\d+(\\.\\d*)?') };
+
+var TOK_QNAME = {
+  label: "[qname]",
+  re: new RegExp('^([a-z][-\\w]*:)?[a-z][-\\w]*','i')
+};
+
+var TOK_NODEO = {
+  label: "[nodetest-start]",
+  re: new RegExp('^(processing-instruction|comment|text|node)\\(')
+};
+
+// The table of the tokens of our grammar, used by the lexer: first
+// column the tag, second column a regexp to recognize it in the
+// input, third column the precedence of the token, fourth column a
+// factory function for the semantic value of the token.
+//
+// NOTE: order of this list is important, because the first match
+// counts. Cf. DDOT and DOT, and AXIS and COLON.
+
+var xpathTokenRules = [
+    TOK_DSLASH,
+    TOK_SLASH,
+    TOK_DDOT,
+    TOK_DOT,
+    TOK_AXIS,
+    TOK_COLON,
+    TOK_AXISNAME,
+    TOK_NODEO,
+    TOK_PARENO,
+    TOK_PARENC,
+    TOK_BRACKO,
+    TOK_BRACKC,
+    TOK_AT,
+    TOK_COMMA,
+    TOK_OR,
+    TOK_AND,
+    TOK_NEQ,
+    TOK_EQ,
+    TOK_GE,
+    TOK_GT,
+    TOK_LE,
+    TOK_LT,
+    TOK_PLUS,
+    TOK_MINUS,
+    TOK_ASTERISK,
+    TOK_PIPE,
+    TOK_MOD,
+    TOK_DIV,
+    TOK_LITERALQ,
+    TOK_LITERALQQ,
+    TOK_NUMBER,
+    TOK_QNAME,
+    TOK_NCNAME,
+    TOK_DOLLAR
+];
+
+// All the nonterminals of the grammar. The nonterminal objects are
+// identified by object identity; the labels are used in the debug
+// output only.
+var XPathLocationPath = { label: "LocationPath" };
+var XPathRelativeLocationPath = { label: "RelativeLocationPath" };
+var XPathAbsoluteLocationPath = { label: "AbsoluteLocationPath" };
+var XPathStep = { label: "Step" };
+var XPathNodeTest = { label: "NodeTest" };
+var XPathPredicate = { label: "Predicate" };
+var XPathLiteral = { label: "Literal" };
+var XPathExpr = { label: "Expr" };
+var XPathPrimaryExpr = { label: "PrimaryExpr" };
+var XPathVariableReference = { label: "Variablereference" };
+var XPathNumber = { label: "Number" };
+var XPathFunctionCall = { label: "FunctionCall" };
+var XPathArgumentRemainder = { label: "ArgumentRemainder" };
+var XPathPathExpr = { label: "PathExpr" };
+var XPathUnionExpr = { label: "UnionExpr" };
+var XPathFilterExpr = { label: "FilterExpr" };
+var XPathDigits = { label: "Digits" };
+
+var xpathNonTerminals = [
+    XPathLocationPath,
+    XPathRelativeLocationPath,
+    XPathAbsoluteLocationPath,
+    XPathStep,
+    XPathNodeTest,
+    XPathPredicate,
+    XPathLiteral,
+    XPathExpr,
+    XPathPrimaryExpr,
+    XPathVariableReference,
+    XPathNumber,
+    XPathFunctionCall,
+    XPathArgumentRemainder,
+    XPathPathExpr,
+    XPathUnionExpr,
+    XPathFilterExpr,
+    XPathDigits
+];
+
+// Quantifiers that are used in the productions of the grammar.
+var Q_01 = { label: "?" };
+var Q_MM = { label: "*" };
+var Q_1M = { label: "+" };
+
+// Tag for left associativity (right assoc is implied by undefined).
+var ASSOC_LEFT = true;
+
+// The productions of the grammar. Columns of the table:
+//
+// - target nonterminal,
+// - pattern,
+// - precedence,
+// - semantic value factory
+//
+// The semantic value factory is a function that receives parse tree
+// nodes from the stack frames of the matched symbols as arguments and
+// returns an a node of the parse tree. The node is stored in the top
+// stack frame along with the target object of the rule. The node in
+// the parse tree is an expression object that has an evaluate() method
+// and thus evaluates XPath expressions.
+//
+// The precedence is used to decide between reducing and shifting by
+// comparing the precendence of the rule that is candidate for
+// reducing with the precedence of the look ahead token. Precedence of
+// -1 means that the precedence of the tokens in the pattern is used
+// instead. TODO: It shouldn't be necessary to explicitly assign
+// precedences to rules.
+
+var xpathGrammarRules =
+  [
+   [ XPathLocationPath, [ XPathRelativeLocationPath ], 18,
+     passExpr ],
+   [ XPathLocationPath, [ XPathAbsoluteLocationPath ], 18,
+     passExpr ],
+
+   [ XPathAbsoluteLocationPath, [ TOK_SLASH, XPathRelativeLocationPath ], 18, 
+     makeLocationExpr1 ],
+   [ XPathAbsoluteLocationPath, [ TOK_DSLASH, XPathRelativeLocationPath ], 18,
+     makeLocationExpr2 ],
+
+   [ XPathAbsoluteLocationPath, [ TOK_SLASH ], 0,
+     makeLocationExpr3 ],
+   [ XPathAbsoluteLocationPath, [ TOK_DSLASH ], 0,
+     makeLocationExpr4 ],
+
+   [ XPathRelativeLocationPath, [ XPathStep ], 31,
+     makeLocationExpr5 ],
+   [ XPathRelativeLocationPath,
+     [ XPathRelativeLocationPath, TOK_SLASH, XPathStep ], 31,
+     makeLocationExpr6 ],
+   [ XPathRelativeLocationPath,
+     [ XPathRelativeLocationPath, TOK_DSLASH, XPathStep ], 31,
+     makeLocationExpr7 ],
+
+   [ XPathStep, [ TOK_DOT ], 33,
+     makeStepExpr1 ],
+   [ XPathStep, [ TOK_DDOT ], 33,
+     makeStepExpr2 ],
+   [ XPathStep,
+     [ TOK_AXISNAME, TOK_AXIS, XPathNodeTest ], 33,
+     makeStepExpr3 ],
+   [ XPathStep, [ TOK_AT, XPathNodeTest ], 33,
+     makeStepExpr4 ],
+   [ XPathStep, [ XPathNodeTest ], 33,
+     makeStepExpr5 ],
+   [ XPathStep, [ XPathStep, XPathPredicate ], 33,
+     makeStepExpr6 ],
+
+   [ XPathNodeTest, [ TOK_ASTERISK ], 33,
+     makeNodeTestExpr1 ],
+   [ XPathNodeTest, [ TOK_NCNAME, TOK_COLON, TOK_ASTERISK ], 33,
+     makeNodeTestExpr2 ],
+   [ XPathNodeTest, [ TOK_QNAME ], 33,
+     makeNodeTestExpr3 ],
+   [ XPathNodeTest, [ TOK_NODEO, TOK_PARENC ], 33,
+     makeNodeTestExpr4 ],
+   [ XPathNodeTest, [ TOK_NODEO, XPathLiteral, TOK_PARENC ], 33,
+     makeNodeTestExpr5 ],
+
+   [ XPathPredicate, [ TOK_BRACKO, XPathExpr, TOK_BRACKC ], 33,
+     makePredicateExpr ],
+
+   [ XPathPrimaryExpr, [ XPathVariableReference ], 33,
+     passExpr ],
+   [ XPathPrimaryExpr, [ TOK_PARENO, XPathExpr, TOK_PARENC ], 33,
+     makePrimaryExpr ],
+   [ XPathPrimaryExpr, [ XPathLiteral ], 30,
+     passExpr ],
+   [ XPathPrimaryExpr, [ XPathNumber ], 30,
+     passExpr ],
+   [ XPathPrimaryExpr, [ XPathFunctionCall ], 30,
+     passExpr ],
+
+   [ XPathFunctionCall, [ TOK_QNAME, TOK_PARENO, TOK_PARENC ], -1,
+     makeFunctionCallExpr1 ],
+   [ XPathFunctionCall,
+     [ TOK_QNAME, TOK_PARENO, XPathExpr, XPathArgumentRemainder, Q_MM,
+       TOK_PARENC ], -1,
+     makeFunctionCallExpr2 ],
+   [ XPathArgumentRemainder, [ TOK_COMMA, XPathExpr ], -1,
+     makeArgumentExpr ],
+
+   [ XPathUnionExpr, [ XPathPathExpr ], 20,
+     passExpr ],
+   [ XPathUnionExpr, [ XPathUnionExpr, TOK_PIPE, XPathPathExpr ], 20,
+     makeUnionExpr ],
+
+   [ XPathPathExpr, [ XPathLocationPath ], 20, 
+     passExpr ], 
+   [ XPathPathExpr, [ XPathFilterExpr ], 19, 
+     passExpr ], 
+   [ XPathPathExpr, 
+     [ XPathFilterExpr, TOK_SLASH, XPathRelativeLocationPath ], 20,
+     makePathExpr1 ],
+   [ XPathPathExpr,
+     [ XPathFilterExpr, TOK_DSLASH, XPathRelativeLocationPath ], 20,
+     makePathExpr2 ],
+
+   [ XPathFilterExpr, [ XPathPrimaryExpr, XPathPredicate, Q_MM ], 20,
+     makeFilterExpr ], 
+
+   [ XPathExpr, [ XPathPrimaryExpr ], 16,
+     passExpr ],
+   [ XPathExpr, [ XPathUnionExpr ], 16,
+     passExpr ],
+
+   [ XPathExpr, [ TOK_MINUS, XPathExpr ], -1,
+     makeUnaryMinusExpr ],
+
+   [ XPathExpr, [ XPathExpr, TOK_OR, XPathExpr ], -1,
+     makeBinaryExpr ],
+   [ XPathExpr, [ XPathExpr, TOK_AND, XPathExpr ], -1,
+     makeBinaryExpr ],
+
+   [ XPathExpr, [ XPathExpr, TOK_EQ, XPathExpr ], -1,
+     makeBinaryExpr ],
+   [ XPathExpr, [ XPathExpr, TOK_NEQ, XPathExpr ], -1,
+     makeBinaryExpr ],
+
+   [ XPathExpr, [ XPathExpr, TOK_LT, XPathExpr ], -1,
+     makeBinaryExpr ],
+   [ XPathExpr, [ XPathExpr, TOK_LE, XPathExpr ], -1,
+     makeBinaryExpr ],
+   [ XPathExpr, [ XPathExpr, TOK_GT, XPathExpr ], -1,
+     makeBinaryExpr ],
+   [ XPathExpr, [ XPathExpr, TOK_GE, XPathExpr ], -1,
+     makeBinaryExpr ],
+
+   [ XPathExpr, [ XPathExpr, TOK_PLUS, XPathExpr ], -1,
+     makeBinaryExpr, ASSOC_LEFT ],
+   [ XPathExpr, [ XPathExpr, TOK_MINUS, XPathExpr ], -1,
+     makeBinaryExpr, ASSOC_LEFT ],
+
+   [ XPathExpr, [ XPathExpr, TOK_ASTERISK, XPathExpr ], -1,
+     makeBinaryExpr, ASSOC_LEFT ],
+   [ XPathExpr, [ XPathExpr, TOK_DIV, XPathExpr ], -1,
+     makeBinaryExpr, ASSOC_LEFT ],
+   [ XPathExpr, [ XPathExpr, TOK_MOD, XPathExpr ], -1,
+     makeBinaryExpr, ASSOC_LEFT ],
+
+   [ XPathLiteral, [ TOK_LITERALQ ], -1,
+     makeLiteralExpr ],
+   [ XPathLiteral, [ TOK_LITERALQQ ], -1,
+     makeLiteralExpr ],
+
+   [ XPathNumber, [ TOK_NUMBER ], -1,
+     makeNumberExpr ],
+
+   [ XPathVariableReference, [ TOK_DOLLAR, TOK_QNAME ], 200,
+     makeVariableReference ]
+   ];
+
+// That function computes some optimizations of the above data
+// structures and will be called right here. It merely takes the
+// counter variables out of the global scope.
+
+var xpathRules = [];
+
+function xpathParseInit() {
+  if (xpathRules.length) {
+    return;
+  }
+
+  // Some simple optimizations for the xpath expression parser: sort
+  // grammar rules descending by length, so that the longest match is
+  // first found.
+
+  xpathGrammarRules.sort(function(a,b) {
+    var la = a[1].length;
+    var lb = b[1].length;
+    if (la < lb) {
+      return 1;
+    } else if (la > lb) {
+      return -1;
+    } else {
+      return 0;
+    }
+  });
+
+  var k = 1;
+  for (var i = 0; i < xpathNonTerminals.length; ++i) {
+    xpathNonTerminals[i].key = k++;
+  }
+
+  for (i = 0; i < xpathTokenRules.length; ++i) {
+    xpathTokenRules[i].key = k++;
+  }
+
+  if (xpathdebug)
+  Log.write('XPath parse INIT: ' + k + ' rules');
+
+  // Another slight optimization: sort the rules into bins according
+  // to the last element (observing quantifiers), so we can restrict
+  // the match against the stack to the subest of rules that match the
+  // top of the stack.
+  //
+  // TODO(mesch): What we actually want is to compute states as in
+  // bison, so that we don't have to do any explicit and iterated
+  // match against the stack.
+
+  function push_(array, position, element) {
+    if (!array[position]) {
+      array[position] = [];
+    }
+    array[position].push(element);
+  }
+
+  for (i = 0; i < xpathGrammarRules.length; ++i) {
+    var rule = xpathGrammarRules[i];
+    var pattern = rule[1];
+
+    for (var j = pattern.length - 1; j >= 0; --j) {
+      if (pattern[j] == Q_1M) {
+        push_(xpathRules, pattern[j-1].key, rule);
+        break;
+        
+      } else if (pattern[j] == Q_MM || pattern[j] == Q_01) {
+        push_(xpathRules, pattern[j-1].key, rule);
+        --j;
+
+      } else {
+        push_(xpathRules, pattern[j].key, rule);
+        break;
+      }
+    }
+  }
+
+  if (xpathdebug)
+  Log.write('XPath parse INIT: ' + xpathRules.length + ' rule bins');
+  
+  var sum = 0;
+  mapExec(xpathRules, function(i) {
+    if (i) {
+      sum += i.length;
+    }
+  });
+  
+  if (xpathdebug)
+  Log.write('XPath parse INIT: ' + (sum / xpathRules.length) + ' average bin size');
+}
+
+// Local utility functions that are used by the lexer or parser.
+
+function xpathCollectDescendants(nodelist, node) {
+  for (var n = node.firstChild; n; n = n.nextSibling) {
+    nodelist.push(n);
+    arguments.callee(nodelist, n);
+  }
+}
+
+function xpathCollectDescendantsReverse(nodelist, node) {
+  for (var n = node.lastChild; n; n = n.previousSibling) {
+    nodelist.push(n);
+    arguments.callee(nodelist, n);
+  }
+}
+
+
+// The entry point for the library: match an expression against a DOM
+// node. Returns an XPath value.
+function xpathDomEval(expr, node) {
+  var expr1 = xpathParse(expr);
+  var ret = expr1.evaluate(new ExprContext(node));
+  return ret;
+}
+
+// Utility function to sort a list of nodes. Used by xsltSort() and
+// nxslSelect().
+function xpathSort(input, sort) {
+  if (sort.length == 0) {
+    return;
+  }
+
+  var sortlist = [];
+
+  for (var i = 0; i < input.nodelist.length; ++i) {
+    var node = input.nodelist[i];
+    var sortitem = { node: node, key: [] };
+    var context = input.clone(node, 0, [ node ]);
+    
+    for (var j = 0; j < sort.length; ++j) {
+      var s = sort[j];
+      var value = s.expr.evaluate(context);
+
+      var evalue;
+      if (s.type == 'text') {
+        evalue = value.stringValue();
+      } else if (s.type == 'number') {
+        evalue = value.numberValue();
+      }
+      sortitem.key.push({ value: evalue, order: s.order });
+    }
+
+    // Make the sort stable by adding a lowest priority sort by
+    // id. This is very convenient and furthermore required by the
+    // spec ([XSLT] - Section 10 Sorting).
+    sortitem.key.push({ value: i, order: 'ascending' });
+
+    sortlist.push(sortitem);
+  }
+
+  sortlist.sort(xpathSortByKey);
+
+  var nodes = [];
+  for (var i = 0; i < sortlist.length; ++i) {
+    nodes.push(sortlist[i].node);
+  }
+  input.nodelist = nodes;
+  input.setNode(nodes[0], 0);
+}
+
+
+// Sorts by all order criteria defined. According to the JavaScript
+// spec ([ECMA] Section 11.8.5), the compare operators compare strings
+// as strings and numbers as numbers.
+//
+// NOTE: In browsers which do not follow the spec, this breaks only in
+// the case that numbers should be sorted as strings, which is very
+// uncommon.
+
+function xpathSortByKey(v1, v2) {
+  // NOTE: Sort key vectors of different length never occur in
+  // xsltSort.
+
+  for (var i = 0; i < v1.key.length; ++i) {
+    var o = v1.key[i].order == 'descending' ? -1 : 1;
+    if (v1.key[i].value > v2.key[i].value) {
+      return +1 * o;
+    } else if (v1.key[i].value < v2.key[i].value) {
+      return -1 * o;
+    }
+  }
+
+  return 0;
+}
+
+
+// Copyright (c) 2005, Google Inc.
+// All rights reserved.
+// 
+// Redistribution and use in source and binary forms, with or without
+// modification, are permitted provided that the following conditions are
+// met:
+//         
+//  * Redistributions of source code must retain the above copyright
+//    notice, this list of conditions and the following disclaimer.
+// 
+//  * Redistributions in binary form must reproduce the above copyright
+//    notice, this list of conditions and the following disclaimer in the
+//    documentation and/or other materials provided with the
+//    distribution.
+// 
+//  * Neither the name of Google Inc. nor the names of its contributors
+//    may be used to endorse or promote products derived from this
+//    software without specific prior written permission.
+// 
+// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
+// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
+// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
+// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
+// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
+// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+//
+// Miscellania that support the ajaxslt implementation.
+//
+// Author: Steffen Meschkat <mesch at google.com>
+//
+
+function el(i) {
+  return document.getElementById(i);
+}
+
+function px(x) {
+  return x + 'px';
+}
+
+// Split a string s at all occurrences of character c. This is like
+// the split() method of the string object, but IE omits empty
+// strings, which violates the invariant (s.split(x).join(x) == s).
+function stringSplit(s, c) {
+  var a = s.indexOf(c);
+  if (a == -1) {
+    return [ s ];
+  }
+  
+  var parts = [];
+  parts.push(s.substr(0,a));
+  while (a != -1) {
+    var a1 = s.indexOf(c, a + 1);
+    if (a1 != -1) {
+      parts.push(s.substr(a + 1, a1 - a - 1));
+    } else {
+      parts.push(s.substr(a + 1));
+    } 
+    a = a1;
+  }
+
+  return parts;
+}
+
+// Returns the text value if a node; for nodes without children this
+// is the nodeValue, for nodes with children this is the concatenation
+// of the value of all children.
+function xmlValue(node) {
+  if (!node) {
+    return '';
+  }
+
+  var ret = '';
+  if (node.nodeType == DOM_TEXT_NODE ||
+      node.nodeType == DOM_CDATA_SECTION_NODE ||
+      node.nodeType == DOM_ATTRIBUTE_NODE) {
+    ret += node.nodeValue;
+
+  } else if (node.nodeType == DOM_ELEMENT_NODE ||
+             node.nodeType == DOM_DOCUMENT_NODE ||
+             node.nodeType == DOM_DOCUMENT_FRAGMENT_NODE) {
+    for (var i = 0; i < node.childNodes.length; ++i) {
+      ret += arguments.callee(node.childNodes[i]);
+    }
+  }
+  return ret;
+}
+
+// Returns the representation of a node as XML text.
+function xmlText(node) {
+  var ret = '';
+  if (node.nodeType == DOM_TEXT_NODE) {
+    ret += xmlEscapeText(node.nodeValue);
+    
+  } else if (node.nodeType == DOM_ELEMENT_NODE) {
+    ret += '<' + node.nodeName;
+    for (var i = 0; i < node.attributes.length; ++i) {
+      var a = node.attributes[i];
+      if (a && a.nodeName && a.nodeValue) {
+        ret += ' ' + a.nodeName;
+        ret += '="' + xmlEscapeAttr(a.nodeValue) + '"';
+      }
+    }
+
+    if (node.childNodes.length == 0) {
+      ret += '/>';
+
+    } else {
+      ret += '>';
+      for (var i = 0; i < node.childNodes.length; ++i) {
+        ret += arguments.callee(node.childNodes[i]);
+      }
+      ret += '</' + node.nodeName + '>';
+    }
+    
+  } else if (node.nodeType == DOM_DOCUMENT_NODE || 
+             node.nodeType == DOM_DOCUMENT_FRAGMENT_NODE) {
+    for (var i = 0; i < node.childNodes.length; ++i) {
+      ret += arguments.callee(node.childNodes[i]);
+    }
+  }
+  
+  return ret;
+}
+
+// Applies the given function to each element of the array.
+function mapExec(array, func) {
+  for (var i = 0; i < array.length; ++i) {
+    func(array[i]);
+  }
+}
+
+// Returns an array that contains the return value of the given
+// function applied to every element of the input array.
+function mapExpr(array, func) {
+  var ret = [];
+  for (var i = 0; i < array.length; ++i) {
+    ret.push(func(array[i]));
+  }
+  return ret;
+};
+
+// Reverses the given array in place.
+function reverseInplace(array) {
+  for (var i = 0; i < array.length / 2; ++i) {
+    var h = array[i];
+    var ii = array.length - i - 1;
+    array[i] = array[ii];
+    array[ii] = h;
+  }
+}
+
+// Shallow-copies an array.
+function copyArray(dst, src) { 
+  for (var i = 0; i < src.length; ++i) {
+    dst.push(src[i]);
+  }
+}
+
+function assert(b) {
+  if (!b) {
+    throw 'assertion failed';
+  }
+}
+
+// Based on
+// <http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247>
+var DOM_ELEMENT_NODE = 1;
+var DOM_ATTRIBUTE_NODE = 2;
+var DOM_TEXT_NODE = 3;
+var DOM_CDATA_SECTION_NODE = 4;
+var DOM_ENTITY_REFERENCE_NODE = 5;
+var DOM_ENTITY_NODE = 6;
+var DOM_PROCESSING_INSTRUCTION_NODE = 7;
+var DOM_COMMENT_NODE = 8;
+var DOM_DOCUMENT_NODE = 9;
+var DOM_DOCUMENT_TYPE_NODE = 10;
+var DOM_DOCUMENT_FRAGMENT_NODE = 11;
+var DOM_NOTATION_NODE = 12;
+
+
+var xpathdebug = false; // trace xpath parsing
+var xsltdebug = false; // trace xslt processing
+
+
+// Escape XML special markup chracters: tag delimiter < > and entity
+// reference start delimiter &. The escaped string can be used in XML
+// text portions (i.e. between tags).
+function xmlEscapeText(s) {
+  return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
+}
+
+// Escape XML special markup characters: tag delimiter < > entity
+// reference start delimiter & and quotes ". The escaped string can be
+// used in double quoted XML attribute value portions (i.e. in
+// attributes within start tags).
+function xmlEscapeAttr(s) {
+  return xmlEscapeText(s).replace(/\"/g, '&quot;');
+}
+
+// Escape markup in XML text, but don't touch entity references. The
+// escaped string can be used as XML text (i.e. between tags).
+function xmlEscapeTags(s) {
+  return s.replace(/</g, '&lt;').replace(/>/g, '&gt;');
+}
+
+// An implementation of the debug log. 
+
+var logging__ = true;
+
+function Log() {};
+
+Log.lines = [];
+
+Log.write = function(s) {
+  if (logging__) {
+    this.lines.push(xmlEscapeText(s));
+    this.show();
+  }
+};
+
+// Writes the given XML with every tag on a new line.
+Log.writeXML = function(xml) {
+  if (logging__) {
+    var s0 = xml.replace(/</g, '\n<');
+    var s1 = xmlEscapeText(s0);
+    var s2 = s1.replace(/\s*\n(\s|\n)*/g, '<br/>');
+    this.lines.push(s2);
+    this.show();
+  }
+}
+
+// Writes without any escaping
+Log.writeRaw = function(s) {
+  if (logging__) {
+    this.lines.push(s);
+    this.show();
+  }
+}
+
+Log.clear = function() {
+  if (logging__) {
+    var l = this.div();
+    l.innerHTML = '';
+    this.lines = [];
+  }
+}
+
+Log.show = function() {
+  var l = this.div();
+  l.innerHTML += this.lines.join('<br/>') + '<br/>';
+  this.lines = [];
+  l.scrollTop = l.scrollHeight;
+}
+
+Log.div = function() {
+  var l = document.getElementById('log');
+  if (!l) {
+    l = document.createElement('div');
+    l.id = 'log';
+    l.style.position = 'absolute';
+    l.style.right = '5px';
+    l.style.top = '5px';
+    l.style.width = '250px';
+    l.style.height = '150px';
+    l.style.overflow = 'auto';
+    l.style.backgroundColor = '#f0f0f0';
+    l.style.border = '1px solid gray';
+    l.style.fontSize = '10px';
+    l.style.padding = '5px';
+    document.body.appendChild(l);
+  }
+  return l;
+}
+
+
+function Timer() {}
+Timer.start = function() {}
+Timer.end = function() {}

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2007-01-03 12:50:04 UTC (rev 2294)
+++ YDFramework2.0/trunk/examples/index.tpl	2007-01-03 12:51:22 UTC (rev 2295)
@@ -732,7 +732,7 @@
             <td width="43%"><b>&nbsp;</b></td>
         </tr>
         <tr>
-            <td rowspan="16" valign="top">&nbsp;</td>
+            <td rowspan="17" valign="top">&nbsp;</td>
             <td valign="top"><a href="constants.php">YDFramework2 constants</a> </td>
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=constants.php">constants.php</a>
@@ -804,6 +804,13 @@
             <td valign="top">
                 <a href="{$YD_SELF_SCRIPT}?do=source&id=akismet.php">akismet.php</a>            </td>
         </tr>
+        <tr>
+            <td valign="top"><a href="adobe_spry/index.php">Using Adobe Spry</a></td>
+            <td valign="top">
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=adobe_spry/index.php">adobe_spry/index.php</a>
+                <a href="{$YD_SELF_SCRIPT}?do=source&id=adobe_spry/index.tpl">adobe_spry/index.tpl</a>
+            </td>
+        </tr>
         </table>
 
     {/if}



From pclaerhout at mail.berlios.de  Sat Jan  6 20:04:41 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sat, 6 Jan 2007 20:04:41 +0100
Subject: [ydf-devel] r2296 - in YDFramework2.0/trunk/YDFramework2: .
	YDClasses YDClasses/YDDatabaseDrivers
Message-ID: <200701061904.l06J4fJW028428@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-06 20:04:40 +0100 (Sat, 06 Jan 2007)
New Revision: 2296

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Made a number of improvements to the SQL log:
- The time that is spend for doing the query is now logged.
- The complete stack trace for each SQL statement is logged as well so that you can easily find where the query was executed.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-03 12:51:22 UTC (rev 2295)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-06 19:04:40 UTC (rev 2296)
@@ -1445,39 +1445,45 @@
          *  This function will log the SQL statement to the debug log and keep track of the number of queries that were
          *  executed. This will only happen if YD_DEBUG equals 1 or 2
          *
-         *  @param $sql The SQL statement to log.
+         *  @param $sql         The SQL statement to log.
+         *  @param $elapsed     (optional) The time the query needed to be executed.
          *
          *  @internal
          */
-        function _logSql( $sql ) {
+        function _logSql( $sql, $elapsed=null ) {
 
             // Show debugging info if needed
             if ( YDConfig::get( 'YD_DEBUG' ) == 1 || YDConfig::get( 'YD_DEBUG' ) == 2 ) {
 
                 // Split the SQL in different lines
-                $sql = str_ireplace( 'SELECT', 'SELECT', $sql );
-                $sql = str_ireplace( 'UPDATE', 'UPDATE', $sql );
-                $sql = str_ireplace( 'DELETE', 'DELETE', $sql );
-                $sql = str_ireplace( 'INSERT', 'INSERT', $sql );
-                $sql = str_ireplace( 'FROM', YD_CRLF . 'FROM', $sql );
-                $sql = str_ireplace( 'INTO', YD_CRLF . 'INTO', $sql );
-                $sql = str_ireplace( 'VALUES', YD_CRLF . 'VALUES', $sql );
-                $sql = str_ireplace( 'LEFT JOIN', YD_CRLF . 'LEFT JOIN', $sql );
-                $sql = str_ireplace( 'RIGHT JOIN', YD_CRLF . 'RIGHT JOIN', $sql );
-                $sql = str_ireplace( 'INNER JOIN', YD_CRLF . 'INNER JOIN', $sql );
-                $sql = str_ireplace( 'WHERE', YD_CRLF . 'WHERE', $sql );
-                $sql = str_ireplace( 'ORDER BY', YD_CRLF . 'ORDER BY', $sql );
-                $sql = str_ireplace( 'GROUP BY', YD_CRLF . 'GROUP BY', $sql );
-                $sql = str_ireplace( 'LIMIT', YD_CRLF . 'LIMIT', $sql );
+                $sql = str_ireplace( ' SELECT ', ' SELECT ', $sql );
+                $sql = str_ireplace( ' UPDATE ', ' UPDATE ', $sql );
+                $sql = str_ireplace( ' DELETE ', ' DELETE ', $sql );
+                $sql = str_ireplace( ' INSERT ', ' INSERT ', $sql );
+                $sql = str_ireplace( ' FROM ', YD_CRLF . 'FROM ', $sql );
+                $sql = str_ireplace( ' INTO ', YD_CRLF . 'INTO ', $sql );
+                $sql = str_ireplace( ' VALUES ', YD_CRLF . 'VALUES ', $sql );
+                $sql = str_ireplace( ' LEFT JOIN ', YD_CRLF . 'LEFT JOIN ', $sql );
+                $sql = str_ireplace( ' RIGHT JOIN ', YD_CRLF . 'RIGHT JOIN ', $sql );
+                $sql = str_ireplace( ' INNER JOIN ', YD_CRLF . 'INNER JOIN ', $sql );
+                $sql = str_ireplace( ' WHERE ', YD_CRLF . 'WHERE ', $sql );
+                $sql = str_ireplace( ' ORDER BY ', YD_CRLF . 'ORDER BY ', $sql );
+                $sql = str_ireplace( ' GROUP BY ', YD_CRLF . 'GROUP BY ', $sql );
+                $sql = str_ireplace( ' LIMIT ', YD_CRLF . 'LIMIT ', $sql );
 
                 // Get the backtrace
                 $trace = debug_backtrace();
 
                 // Format the SQL
                 $sql_final = '';
+                foreach ( explode( YD_CRLF, YDDebugUtil::getStackTrace() ) as $line ) {
+                    $sql_final .= $line . YD_CRLF;
+                }
+                $sql_final .= 'SQL Statement:' . YD_CRLF;
                 foreach ( explode( YD_CRLF, $sql ) as $line ) {
-                    $sql_final .= '[' . $trace[2]['file'] . ':' . $trace[2]['line'] . '] ' . $line . YD_CRLF;
+                    $sql_final .= '    ' . $line . YD_CRLF;
                 }
+                $sql_final .= YD_CRLF . 'SQL Query Time: ' . $elapsed . ' ms' . YD_CRLF;
 
                 // Add it to the query log
                 array_push( $GLOBALS['YD_SQL_QUERY'], $sql_final );
@@ -1710,9 +1716,6 @@
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
             $sql = str_replace( ' `#_', ' `' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
-            // Log the statement
-            $this->_logSql( $sql );
-
             // Connect
             $result = $this->connect();
 
@@ -1724,6 +1727,9 @@
                 trigger_error( mysql_error( $this->_conn ), YD_ERROR );
             }
 
+            // Record the start time
+            $timer = new YDTimer();
+
             // Execute the query
             $result = @mysql_query( $sql, $this->_conn );
 
@@ -1732,6 +1738,9 @@
                 trigger_error( '[' . mysql_errno( $this->_conn ) . '] ' . mysql_error( $this->_conn ), YD_ERROR );
             }
 
+            // Log the statement
+            $this->_logSql( $sql, $timer->getElapsed() );
+
             // Return the result
             return $result;
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-03 12:51:22 UTC (rev 2295)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-06 19:04:40 UTC (rev 2296)
@@ -264,9 +264,6 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
-            // Log the statement
-            $this->_logSql( $sql );
-
             // Connect
             $result = $this->connect();
 
@@ -276,6 +273,9 @@
                 trigger_error( $error['message'], YD_ERROR );
             }
 
+            // Record the start time
+            $timer = new YDTimer();
+
             // Create statement
             $stmt = OCIParse( $this->_conn, $sql );
 
@@ -297,6 +297,9 @@
                 trigger_error( $error['message'], YD_ERROR );
             }
 
+            // Log the statement
+            $this->_logSql( $sql, $timer->getElapsed() );
+
             // Return the result
             return $stmt;
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-03 12:51:22 UTC (rev 2295)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-06 19:04:40 UTC (rev 2296)
@@ -196,9 +196,6 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
-            // Log the SQL
-            $this->_logSql( $sql );
-
             // Connect
             $result = $this->connect();
 
@@ -207,6 +204,9 @@
                 trigger_error( pg_last_error(), YD_ERROR );
             }
 
+            // Record the start time
+            $timer = new YDTimer();
+
             // Perform the query
             $result = @pg_query( $this->_conn, $sql );
 
@@ -215,6 +215,9 @@
                 trigger_error( pg_last_error( $this->conn ), YD_ERROR );
             }
 
+            // Log the statement
+            $this->_logSql( $sql, $timer->getElapsed() );
+
             // Return the result
             return $result;
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-03 12:51:22 UTC (rev 2295)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-06 19:04:40 UTC (rev 2296)
@@ -204,17 +204,14 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
-            // Log the statement
-            $this->_logSql( $sql );
-
-            // Connect
-            $result = $this->connect();
-
             // Handle errors
             if ( ! $result && $this->_failOnError === true ) {
                 trigger_error( $GLOBALS['YD_SQLITE_error'], YD_ERROR );
             }
 
+            // Record the start time
+            $timer = new YDTimer();
+
             // Execute the query
             $result = @sqlite_query( $sql, $this->_conn );
 
@@ -223,6 +220,9 @@
                 trigger_error( sqlite_error_string( sqlite_last_error( $this->_conn ) ), YD_ERROR );
             }
 
+            // Log the statement
+            $this->_logSql( $sql, $timer->getElapsed() );
+
             // Return the result
             return $result;
 

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-03 12:51:22 UTC (rev 2295)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-06 19:04:40 UTC (rev 2296)
@@ -179,7 +179,7 @@
                     $debug .= 'EXECUTED SQL QUERIES (' . sizeof( $GLOBALS['YD_SQL_QUERY'] ) . ' queries)' . YD_CRLF . YD_CRLF;
                     foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
                         foreach ( explode( YD_CRLF, trim( $query ) ) as $line ) {
-                            $debug .= "\t" . ( $key+1 ) . ':' . "\t" . trim( $line ) . YD_CRLF;
+                            $debug .= "\t[" . ( $key+1 ) . ']' . "\t" . rtrim( $line ) . YD_CRLF;
                         }
                         $debug .= YD_CRLF;
                     }



From pclaerhout at mail.berlios.de  Sun Jan  7 14:37:27 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 7 Jan 2007 14:37:27 +0100
Subject: [ydf-devel] r2297 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDDatabaseDrivers
Message-ID: <200701071337.l07DbR3J007128@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-07 14:37:26 +0100 (Sun, 07 Jan 2007)
New Revision: 2297

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
Log:
Improved the database classes. They now properly report an error if something goes wrong, along with the SQL statement and debug stack trace.

Also added YDDatabase::formatSql which returns a formatted SQL statement.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-06 19:04:40 UTC (rev 2296)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-07 13:37:26 UTC (rev 2297)
@@ -781,6 +781,17 @@
 
         }
 
+        /**
+         *  This function formats an SQL statement.
+         *
+         *  @param $sql         The SQL statement to format.
+         *
+         *  @returns    The formatted SQL statement
+         */
+        function formatSql( $sql ) {
+            return YDDatabaseDriver::formatSql( $sql );
+        }
+
     }
 
     /**
@@ -1442,6 +1453,37 @@
         }
 
         /**
+         *  This function formats an SQL statement.
+         *
+         *  @param $sql         The SQL statement to format.
+         *
+         *  @returns    The formatted SQL statement
+         */
+        function formatSql( $sql ) {
+
+            // Split the SQL in different lines
+            $sql = str_ireplace( ' SELECT ', ' SELECT ', $sql );
+            $sql = str_ireplace( ' UPDATE ', ' UPDATE ', $sql );
+            $sql = str_ireplace( ' DELETE ', ' DELETE ', $sql );
+            $sql = str_ireplace( ' INSERT ', ' INSERT ', $sql );
+            $sql = str_ireplace( ' UNION ', YD_CRLF . 'UNION' . YD_CRLF, $sql );
+            $sql = str_ireplace( ' FROM ', YD_CRLF . 'FROM ', $sql );
+            $sql = str_ireplace( ' INTO ', YD_CRLF . 'INTO ', $sql );
+            $sql = str_ireplace( ' VALUES ', YD_CRLF . 'VALUES ', $sql );
+            $sql = str_ireplace( ' LEFT JOIN ', YD_CRLF . 'LEFT JOIN ', $sql );
+            $sql = str_ireplace( ' RIGHT JOIN ', YD_CRLF . 'RIGHT JOIN ', $sql );
+            $sql = str_ireplace( ' INNER JOIN ', YD_CRLF . 'INNER JOIN ', $sql );
+            $sql = str_ireplace( ' WHERE ', YD_CRLF . 'WHERE ', $sql );
+            $sql = str_ireplace( ' ORDER BY ', YD_CRLF . 'ORDER BY ', $sql );
+            $sql = str_ireplace( ' GROUP BY ', YD_CRLF . 'GROUP BY ', $sql );
+            $sql = str_ireplace( ' LIMIT ', YD_CRLF . 'LIMIT ', $sql );
+
+            // Return the formatted statement
+            return $sql;
+
+        }
+
+        /**
          *  This function will log the SQL statement to the debug log and keep track of the number of queries that were
          *  executed. This will only happen if YD_DEBUG equals 1 or 2
          *
@@ -1455,21 +1497,8 @@
             // Show debugging info if needed
             if ( YDConfig::get( 'YD_DEBUG' ) == 1 || YDConfig::get( 'YD_DEBUG' ) == 2 ) {
 
-                // Split the SQL in different lines
-                $sql = str_ireplace( ' SELECT ', ' SELECT ', $sql );
-                $sql = str_ireplace( ' UPDATE ', ' UPDATE ', $sql );
-                $sql = str_ireplace( ' DELETE ', ' DELETE ', $sql );
-                $sql = str_ireplace( ' INSERT ', ' INSERT ', $sql );
-                $sql = str_ireplace( ' FROM ', YD_CRLF . 'FROM ', $sql );
-                $sql = str_ireplace( ' INTO ', YD_CRLF . 'INTO ', $sql );
-                $sql = str_ireplace( ' VALUES ', YD_CRLF . 'VALUES ', $sql );
-                $sql = str_ireplace( ' LEFT JOIN ', YD_CRLF . 'LEFT JOIN ', $sql );
-                $sql = str_ireplace( ' RIGHT JOIN ', YD_CRLF . 'RIGHT JOIN ', $sql );
-                $sql = str_ireplace( ' INNER JOIN ', YD_CRLF . 'INNER JOIN ', $sql );
-                $sql = str_ireplace( ' WHERE ', YD_CRLF . 'WHERE ', $sql );
-                $sql = str_ireplace( ' ORDER BY ', YD_CRLF . 'ORDER BY ', $sql );
-                $sql = str_ireplace( ' GROUP BY ', YD_CRLF . 'GROUP BY ', $sql );
-                $sql = str_ireplace( ' LIMIT ', YD_CRLF . 'LIMIT ', $sql );
+                // Format the SQL statement
+                $sql = $this->formatSql( $sql );
 
                 // Get the backtrace
                 $trace = debug_backtrace();
@@ -1735,7 +1764,7 @@
 
             // Handle errors
             if ( $result === false && $this->_failOnError === true ) {
-                trigger_error( '[' . mysql_errno( $this->_conn ) . '] ' . mysql_error( $this->_conn ), YD_ERROR );
+                YDDebugUtil::error( '[' . mysql_errno( $this->_conn ) . '] ' . mysql_error( $this->_conn ), $sql );
             }
 
             // Log the statement

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-06 19:04:40 UTC (rev 2296)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-07 13:37:26 UTC (rev 2297)
@@ -294,6 +294,8 @@
                 if ( ! empty( $error['sqltext'] ) ) {
                     $error['message'] .= ' (SQL: ' . $error['sqltext'] . ')';
                 }
+                echo( '<b>Stacktrace:</b> <pre>' . YDDebugUtil::getStackTrace() . '</pre>' );
+                echo( '<b>SQL Statement:</b> <pre>' . $this->formatSql( $sql ) . '</pre>' );
                 trigger_error( $error['message'], YD_ERROR );
             }
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-06 19:04:40 UTC (rev 2296)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-07 13:37:26 UTC (rev 2297)
@@ -212,6 +212,8 @@
 
             // Handle errors
             if ( $result === false && $this->_failOnError === true ) {
+                echo( '<b>Stacktrace:</b> <pre>' . YDDebugUtil::getStackTrace() . '</pre>' );
+                echo( '<b>SQL Statement:</b> <pre>' . $this->formatSql( $sql ) . '</pre>' );
                 trigger_error( pg_last_error( $this->conn ), YD_ERROR );
             }
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-06 19:04:40 UTC (rev 2296)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-07 13:37:26 UTC (rev 2297)
@@ -217,6 +217,8 @@
 
             // Handle errors
             if ( $result === false && $this->_failOnError === true ) {
+                echo( '<b>Stacktrace:</b> <pre>' . YDDebugUtil::getStackTrace() . '</pre>' );
+                echo( '<b>SQL Statement:</b> <pre>' . $this->formatSql( $sql ) . '</pre>' );
                 trigger_error( sqlite_error_string( sqlite_last_error( $this->_conn ) ), YD_ERROR );
             }
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-06 19:04:40 UTC (rev 2296)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-07 13:37:26 UTC (rev 2297)
@@ -384,6 +384,22 @@
     class YDDebugUtil extends YDBase {
 
         /**
+         *  Trigger an error
+         *
+         *  @param  $error  The error to raise.
+         *  @param  $sql    (optional) The SQL statement to log with the error.
+         *  @param  $level  (optional) The type of error to be raised. Default is YD_ERROR.
+         */
+        function error( $msg, $sql=null, $level=YD_ERROR ) {
+            echo( '<p><b><font color="red">An error occured</font></b></p>' );
+            echo( '<b>Stacktrace:</b> <pre>' . YDDebugUtil::getStackTrace() . '</pre>' );
+            if ( ! empty( $sql ) ) {
+                echo( '<b>SQL Statement:</b> <pre>' . $this->formatSql( $sql ) . '</pre>' );
+            }
+            trigger_error( $msg, $level );
+        }
+
+        /**
          *	Function to output a debug message. These message are only shown if the constant YD_DEBUG is set to 1. You
          *	can turn on debugging by specifying the YD_DEBUG parameter in the url and assigning it the value 1.
          *



From pclaerhout at mail.berlios.de  Sun Jan  7 14:40:39 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 7 Jan 2007 14:40:39 +0100
Subject: [ydf-devel] r2298 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701071340.l07DedxD007480@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-07 14:40:38 +0100 (Sun, 07 Jan 2007)
New Revision: 2298

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Added a template modifier that converts and url to an absolute url.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-07 13:37:26 UTC (rev 2297)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-07 13:40:38 UTC (rev 2298)
@@ -80,6 +80,7 @@
                 $this->register_modifier( 'date_format', 'YDTemplate_modifier_date_format' );
                 $this->register_modifier( 'dump', 'YDTemplate_modifier_dump' );
                 $this->register_modifier( 'bbcode', 'YDTemplate_modifier_bbcode' );
+                $this->register_modifier( 'absoluteurl', 'YDTemplate_modifier_absoluteurl' );
 
                 // Register the custom functions
                 $this->register_function( 't', 'YDTemplate_function_t' );
@@ -560,6 +561,17 @@
     }
 
     /**
+     *	This template modifier converts an url to an absolute one
+     *
+     *  @param  $url   The url to convert
+     *
+     *  @returns    The url formatted as an absolute url.
+     */
+    function YDTemplate_modifier_absoluteurl( $url ) {
+        return YDUrl::makeLinkAbsolute( $url );
+    }
+
+    /**
      *	This template modifier formats a numeric value to a human readable file size.
      *
      *  @param  $size   The numeric value to format.



From pclaerhout at mail.berlios.de  Sun Jan  7 15:22:29 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 7 Jan 2007 15:22:29 +0100
Subject: [ydf-devel] r2299 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormRenderers
Message-ID: <200701071422.l07EMTH3013332@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-07 15:22:28 +0100 (Sun, 07 Jan 2007)
New Revision: 2299

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
Log:
The form array now includes a hidden_html attribute for each form element so that they can be shown as a normal html element or a hidden one.

Also added a check to the form class so that it would only assign the defaults to a GET request if no submit is done.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-07 13:40:38 UTC (rev 2298)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-07 14:22:28 UTC (rev 2299)
@@ -651,7 +651,7 @@
             }
 
             // Special treatment for GET forms
-            if ( $this->_method == 'get' ) {
+            if ( $this->_method == 'get' && ! $this->isSubmitted() ) {
                 if ( ! isset( $_GET[$this->_name . '_' . $name] ) && ! is_null( $element->_default ) ) {
                     $value = $element->getDefault();
                 }

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-07 13:40:38 UTC (rev 2298)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-07 14:22:28 UTC (rev 2299)
@@ -95,8 +95,15 @@
                 // Update the value
                 $element->_value = $this->_form->getValue( $name );
 
+                // Add the hidden_html value
+                $elementArray = $element->toArray();
+                $attribs = array(
+                    'type' => 'hidden', 'name' => $elementArray['id'], 'value' => $elementArray['value']
+                );
+                $elementArray['hidden_html'] = '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' />';
+
                 // Add the form element
-                $form[ $name ] = $element->toArray();
+                $form[ $name ] = $elementArray;
 
                 // Add errors if any
                 if ( array_key_exists( $name, $this->_form->_errors ) ) {



From pclaerhout at mail.berlios.de  Sun Jan  7 18:37:22 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 7 Jan 2007 18:37:22 +0100
Subject: [ydf-devel] r2300 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701071737.l07HbMGt021733@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-07 18:37:21 +0100 (Sun, 07 Jan 2007)
New Revision: 2300

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Improved the SQL formatter a little bit.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-07 14:22:28 UTC (rev 2299)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-07 17:37:21 UTC (rev 2300)
@@ -1468,6 +1468,11 @@
             $sql = str_ireplace( ' INSERT ', ' INSERT ', $sql );
             $sql = str_ireplace( ' UNION ', YD_CRLF . 'UNION' . YD_CRLF, $sql );
             $sql = str_ireplace( ' FROM ', YD_CRLF . 'FROM ', $sql );
+            $sql = str_ireplace( ' LEFT JOIN ', YD_CRLF . 'LEFT JOIN ', $sql );
+            $sql = str_ireplace( ' RIGHT JOIN ', YD_CRLF . 'RIGHT JOIN ', $sql );
+            $sql = str_ireplace( ' JOIN ', YD_CRLF . 'JOIN ', $sql );
+            $sql = str_ireplace( 'LEFT' . YD_CRLF . 'JOIN ', 'LEFT JOIN ', $sql );
+            $sql = str_ireplace( 'RIGHT' . YD_CRLF . 'JOIN ', 'RIGHT JOIN ', $sql );
             $sql = str_ireplace( ' INTO ', YD_CRLF . 'INTO ', $sql );
             $sql = str_ireplace( ' VALUES ', YD_CRLF . 'VALUES ', $sql );
             $sql = str_ireplace( ' LEFT JOIN ', YD_CRLF . 'LEFT JOIN ', $sql );



From pclaerhout at mail.berlios.de  Sun Jan  7 18:47:08 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 7 Jan 2007 18:47:08 +0100
Subject: [ydf-devel] r2301 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701071747.l07Hl8pM008381@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-07 18:47:07 +0100 (Sun, 07 Jan 2007)
New Revision: 2301

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Improved the output of YD_DEBUG a little bit by:
- Removing the include path
- Reformatting the way SQL queries are shown

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-07 17:37:21 UTC (rev 2300)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-07 17:47:07 UTC (rev 2301)
@@ -162,24 +162,13 @@
                 $debug .= 'INCLUDED FILES (' . sizeof( $includeFiles ) . ' files - ' . $includeFilesSize . ')' . YD_CRLF . YD_CRLF;
                 $debug .= "\t" . implode( "\n\t", $includeFiles ) . YD_CRLF . YD_CRLF;
 
-                // Create the list of include directories
-                $include_dirs = explode( YD_PATHDELIM, ini_get( 'include_path' ) );
-                $debug .= 'INCLUDES SEARCH PATH (' . sizeof( $include_dirs ) . ' directories)' . YD_CRLF . YD_CRLF;
-                foreach ( $include_dirs as $path ) {
-                    if ( realpath( $path ) ) {
-                        $debug .= "\t" . realpath( $path ) . YD_CRLF;
-                    } else {
-                        $debug .= "\t" . $path . YD_CRLF;
-                    }
-                }
-                $debug .= YD_CRLF;
-
                 // Add the queries if any
                 if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
                     $debug .= 'EXECUTED SQL QUERIES (' . sizeof( $GLOBALS['YD_SQL_QUERY'] ) . ' queries)' . YD_CRLF . YD_CRLF;
                     foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
+                        $debug .= "\t" . '---- SQL QUERY ' . ($key+1) . ' ----' . YD_CRLF;
                         foreach ( explode( YD_CRLF, trim( $query ) ) as $line ) {
-                            $debug .= "\t[" . ( $key+1 ) . ']' . "\t" . rtrim( $line ) . YD_CRLF;
+                            $debug .= "\t\t" . rtrim( $line ) . YD_CRLF;
                         }
                         $debug .= YD_CRLF;
                     }



From pclaerhout at mail.berlios.de  Mon Jan  8 12:21:57 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 8 Jan 2007 12:21:57 +0100
Subject: [ydf-devel] r2302 - in YDFramework2.0/trunk/YDFramework2: .
	YDClasses javascript
Message-ID: <200701081121.l08BLv6q013479@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-08 12:21:56 +0100 (Mon, 08 Jan 2007)
New Revision: 2302

Added:
   YDFramework2.0/trunk/YDFramework2/javascript/sh_main.min.js
   YDFramework2.0/trunk/YDFramework2/javascript/sh_sql.js
   YDFramework2.0/trunk/YDFramework2/javascript/sh_style.css
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Added supercool debug output with syntax coloring if you set YD_DEBUG to 2.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-08 11:21:56 UTC (rev 2302)
@@ -1502,25 +1502,15 @@
             // Show debugging info if needed
             if ( YDConfig::get( 'YD_DEBUG' ) == 1 || YDConfig::get( 'YD_DEBUG' ) == 2 ) {
 
-                // Format the SQL statement
-                $sql = $this->formatSql( $sql );
+                // Construct the array with the data for the SQL statement
+                $data = array(
+                    'trace' => YDDebugUtil::getStackTrace(),
+                    'sql'   => $sql = $this->formatSql( $sql ),
+                    'time'  => $elapsed
+                );
 
-                // Get the backtrace
-                $trace = debug_backtrace();
-
-                // Format the SQL
-                $sql_final = '';
-                foreach ( explode( YD_CRLF, YDDebugUtil::getStackTrace() ) as $line ) {
-                    $sql_final .= $line . YD_CRLF;
-                }
-                $sql_final .= 'SQL Statement:' . YD_CRLF;
-                foreach ( explode( YD_CRLF, $sql ) as $line ) {
-                    $sql_final .= '    ' . $line . YD_CRLF;
-                }
-                $sql_final .= YD_CRLF . 'SQL Query Time: ' . $elapsed . ' ms' . YD_CRLF;
-
                 // Add it to the query log
-                array_push( $GLOBALS['YD_SQL_QUERY'], $sql_final );
+                array_push( $GLOBALS['YD_SQL_QUERY'], $data );
 
             }
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-08 11:21:56 UTC (rev 2302)
@@ -615,8 +615,6 @@
         }
 
         /**
-         *  Action to include the JavaScript for the bbtextarea field.
-         *
          *  @internal
          */
         function actionJsBBTextArea() {
@@ -624,6 +622,30 @@
             die( readfile( dirname( __FILE__ ) . '/../javascript/bbtextarea.js' ) );
         }
 
+        /**
+         *  @internal
+         */
+        function actionJsShMain() {
+            header( 'Content-Type: application/x-javascript' );
+            die( readfile( dirname( __FILE__ ) . '/../javascript/sh_main.min.js' ) );
+        }
+
+        /**
+         *  @internal
+         */
+        function actionJsShSql() {
+            header( 'Content-Type: application/x-javascript' );
+            die( readfile( dirname( __FILE__ ) . '/../javascript/sh_sql.js' ) );
+        }
+
+        /**
+         *  @internal
+         */
+        function actionCssShStyle() {
+            header( 'Content-Type: text/css' );
+            die( readfile( dirname( __FILE__ ) . '/../javascript/sh_style.css' ) );
+        }
+
     }
 
 ?>

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-08 11:21:56 UTC (rev 2302)
@@ -120,8 +120,8 @@
             // Stop the timer
             $GLOBALS['timer']->finish();
 
-            // Show debugging info if needed
-            if ( YDConfig::get( 'YD_DEBUG' ) == 1 || YDConfig::get( 'YD_DEBUG' ) == 2 ) {
+            // Output visible debug info as a comment
+            if ( YDConfig::get( 'YD_DEBUG' ) == 1 ) {
 
                 // Total size of include files
                 $includeFiles = get_included_files();
@@ -147,29 +147,34 @@
                 }
 
                 // Create the debug messages
-                $debug = YD_CRLF . YD_CRLF;
+                $debug = YD_CRLF . YD_CRLF . YD_FW_NAMEVERS . ' DEBUG INFORMATION ' . YD_CRLF . YD_CRLF;
 
                 // Create the timings report
                 $debug .= 'PROCESSING TIME:' . YD_CRLF . YD_CRLF;
-                $debug .= "\tElapsed\t  Diff\t  Marker" . YD_CRLF;
+                $debug .= "    Elapsed\t  Diff\t  Marker" . YD_CRLF;
                 $timings = $GLOBALS['timer']->getReport();
                 foreach ( $timings as $timing ) {
-                    $debug .= "\t" . $timing[0] . ' ms' . "\t  " . $timing[1] . ' ms' . "\t  " .$timing[2] . YD_CRLF;
+                    $debug .= "    " . $timing[0] . ' ms' . "\t  " . $timing[1] . ' ms' . "\t  " .$timing[2] . YD_CRLF;
                 }
                 $debug .= YD_CRLF;
 
                 // Create the include file details
                 $debug .= 'INCLUDED FILES (' . sizeof( $includeFiles ) . ' files - ' . $includeFilesSize . ')' . YD_CRLF . YD_CRLF;
-                $debug .= "\t" . implode( "\n\t", $includeFiles ) . YD_CRLF . YD_CRLF;
+                $debug .= "    " . implode( "\n    ", $includeFiles ) . YD_CRLF . YD_CRLF;
 
                 // Add the queries if any
                 if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
                     $debug .= 'EXECUTED SQL QUERIES (' . sizeof( $GLOBALS['YD_SQL_QUERY'] ) . ' queries)' . YD_CRLF . YD_CRLF;
                     foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
-                        $debug .= "\t" . '---- SQL QUERY ' . ($key+1) . ' ----' . YD_CRLF;
-                        foreach ( explode( YD_CRLF, trim( $query ) ) as $line ) {
-                            $debug .= "\t\t" . rtrim( $line ) . YD_CRLF;
+                        $debug .= "    " . '---- SQL QUERY ' . ($key+1) . ' ----' . YD_CRLF;
+                        foreach ( explode( YD_CRLF, trim( $query['trace'] ) ) as $line ) {
+                            $debug .= "    " . rtrim( $line ) . YD_CRLF;
                         }
+                        $debug .= YD_CRLF . "    SQL Query:" . YD_CRLF;
+                        foreach ( explode( YD_CRLF, trim( $query['sql'] ) ) as $line ) {
+                            $debug .= "        " . rtrim( $line ) . YD_CRLF;
+                        }
+                        $debug .= YD_CRLF . "    Query Time: " . $query['time'] . ' ms' . YD_CRLF;
                         $debug .= YD_CRLF;
                     }
                 }
@@ -179,6 +184,99 @@
 
             }
 
+            // Output visible debug info
+            if ( YDConfig::get( 'YD_DEBUG' ) == 2 ) {
+
+                // Total size of include files
+                $includeFiles = get_included_files();
+
+                // Calculate the total size
+                $includeFilesSize = 0;
+                $includeFilesWithSize = array();
+                foreach ( $includeFiles as $key=>$includeFile ) {
+                    if ( is_file( $includeFile ) ) {
+                        $includeFilesSize += filesize( $includeFile );
+                        $includeFilesWithSize[ filesize( $includeFile ) ] = realpath( $includeFile );
+                    }
+                }
+                $includeFilesSize = YDStringUtil::formatFileSize( $includeFilesSize );
+
+                // Sort the list of include files by file size
+                krsort( $includeFilesWithSize );
+
+                // Get the timing report
+                $timings = $GLOBALS['timer']->getReport();
+
+                // The font to use for the debug output
+                $font = ' style="font-family: Arial, Helvetica, sans-serif; text-align: left; vertical-align: top;"';
+
+                // Include the needed libraries
+                $debug  = '';
+
+                // Create the output
+                $debug .= '<br clear="all"/><hr size="1"/>';
+                $debug .= '<p ' . $font . '><b>' . YD_FW_NAMEVERS . ' Debug Information</b></p>';
+
+                // Add the processing time
+                $debug .= '<p ' . $font . '><i>Processing time</i></p>';
+                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                $debug .= sprintf(
+                    '<tr><th %s>Elapsed</th><th %s>Diff</th><th %s>Marker</th></tr>',
+                    $font, $font, $font
+                );
+                foreach ( $timings as $timing ) {
+                    $debug .= sprintf(
+                        '<tr><td %s>%s ms</td><td %s>%s ms</td><td %s>%s</td></tr>',
+                        $font, $timing[0], $font, $timing[0], $font, $timing[2]
+                    );
+                }
+                $debug .= '</table></p></dd>';
+
+                // Add the included files
+                $debug .= '<p ' . $font . '><i>Included files</i></p>';
+                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                $debug .= sprintf( '<tr><th %s>File</th><th %s>Size</th></tr>', $font, $font );
+                foreach ( $includeFilesWithSize as $size=>$file ) {
+                    $debug .= sprintf(
+                        '<tr><td %s>%s ms</td><td %s>%s ms</td></tr>',
+                        $font, realpath( $file ), $font, YDStringUtil::formatFileSize( $size )
+                    );
+                }
+                $debug .= '</table></p></dd>';
+
+                // Add the query log
+                if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
+                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShMain"></script>';
+                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShSql"></script>';
+                    $debug .= '<link rel="stylesheet" href="' . YD_SELF_SCRIPT . '?do=CssShStyle" type="text/css" />';
+                    $debug .= sprintf(
+                        '<p ' . $font . '><i>SQL Query Log (%s queries)</i></p>',
+                        sizeof( $GLOBALS['YD_SQL_QUERY'] )
+                    );
+                    $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                    $debug .= sprintf(
+                        '<tr><th %s>Query #</th><th %s>Trace</th><th %s>SQL Statement</th><th %s>Elapsed</th></tr>',
+                        $font, $font, $font, $font );
+                    foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
+                        $debug .= sprintf(
+                            '<tr><td width="5%%" %s>%s</td><td width="15%%" %s>%s ms</td><td width="40%%" %s><pre>%s</pre></td><td width="40%%" %s><pre class="sh_sql">%s</pre></td></tr>',
+                            $font, $key, $font, $query['time'], $font, $query['trace'], $font, $query['sql']
+                        );
+                    }
+                    $debug .= '</table></p></dd>';
+                    $debug .= '<script>sh_highlightDocument();</script>';
+                    $debug .= '<script>sh_highlightDocument();</script>';
+                }
+
+                // Add the elapsed time
+                $debug .= '<p ' . $font . '><i>Elapsed Time</i></p>';
+                $debug .= '<dd><p>' . $GLOBALS['timer']->getElapsed() . ' ms</p></dd>';
+
+                // Output the debug message
+                echo( $debug );
+
+            }
+
             // Add the elapsed time
             die( YD_CRLF . '<!-- ' . $GLOBALS['timer']->getElapsed() . ' ms -->' );
 

Added: YDFramework2.0/trunk/YDFramework2/javascript/sh_main.min.js
===================================================================
--- YDFramework2.0/trunk/YDFramework2/javascript/sh_main.min.js	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/javascript/sh_main.min.js	2007-01-08 11:21:56 UTC (rev 2302)
@@ -0,0 +1,39 @@
+/* Copyright (C) 2007 gnombat at users.sourceforge.net */
+/* License: http://shjs.sourceforge.net/doc/license.html */
+
+function sh_highlightString(inputString,language,builder){var patternStack={_stack:[],getLength:function(){return this._stack.length;},getTop:function(){if(this._stack.length===0){return undefined;}
+return this._stack[this._stack.length-1];},push:function(state){this._stack.push(state);},pop:function(){if(this._stack.length===0){throw"pop on empty stack";}
+this._stack.pop();}};var i;var pos=0;var currentStyle=null;var output=function(s,style){if(s.length===0){return;}
+if(style===null){var pattern=patternStack.getTop();if(pattern!==undefined&&('style'in pattern)&&!('state'in pattern)){style=pattern.style;}}
+if(currentStyle!==style){if(currentStyle!==null){builder.endElement();}
+if(style!==null){builder.startElement(style);}}
+builder.text(s);pos+=s.length;currentStyle=style;};var endOfLinePattern=/\r\n|\r|\n/g;endOfLinePattern.lastIndex=0;while(pos<inputString.length){var start=pos;var endOfLineMatch=endOfLinePattern.exec(inputString);var end;var startOfNextLine;if(endOfLineMatch===null){end=inputString.length;startOfNextLine=inputString.length;}
+else{end=endOfLineMatch.index;startOfNextLine=endOfLinePattern.lastIndex;}
+var line=inputString.substring(start,end);for(;;){var pattern=patternStack.getTop();var stateIndex=pattern===undefined?0:pattern.next;var state=language[stateIndex];var bestMatch=null;var bestMatchIndex=-1;for(i=0;i<state.length;i++){var regex=state[i].regex;regex.lastIndex=pos-start;var match=regex.exec(line);if(match!==null&&(bestMatch===null||match.index<bestMatch.index)){bestMatch=match;bestMatchIndex=i;}}
+if(bestMatch===null){output(line.substring(pos-start),null);break;}
+else{if(bestMatch.index>pos-start){output(line.substring(pos-start,bestMatch.index),null);}
+pattern=state[bestMatchIndex];var newStyle=null;if('style'in pattern){newStyle=pattern.style;}
+var matchedString=bestMatch[0];output(matchedString,newStyle);if('next'in pattern){patternStack.push(pattern);}
+else{if('exit'in pattern){patternStack.pop();}
+if('exitall'in pattern){while(patternStack.getLength()>0){patternStack.pop();}}}}}
+if(currentStyle!==null){builder.endElement();}
+currentStyle=null;if(endOfLineMatch){builder.text(endOfLineMatch[0]);}
+pos=startOfNextLine;}}
+function sh_getClasses(element){var result=[];var htmlClass=element.className;if(htmlClass&&htmlClass.length>0){var htmlClasses=htmlClass.split(" ");for(var i=0;i<htmlClasses.length;i++){if(htmlClasses[i].length>0){result.push(htmlClasses[i]);}}}
+return result;}
+function sh_addClass(element,name){var htmlClasses=sh_getClasses(element);for(var i=0;i<htmlClasses.length;i++){if(name.toLowerCase()===htmlClasses[i].toLowerCase()){return;}}
+htmlClasses.push(name);element.className=htmlClasses.join(" ");}
+function sh_getText(element){if(element.nodeType===3||element.nodeType===4){return element.data;}
+else{var result='';for(var i=0;i<element.childNodes.length;i++){result+=sh_getText(element.childNodes.item(i));}
+return result;}}
+var sh_builder={init:function(element){while(element.hasChildNodes()){element.removeChild(element.firstChild);}
+var newTextNode=document.createTextNode("");element.appendChild(newTextNode);this._currentTextNode=newTextNode;this._element=element;},startElement:function(style){var span=document.createElement("span");span.className=style;var newTextNode=document.createTextNode("");span.appendChild(newTextNode);this._currentTextNode.parentNode.appendChild(span);this._currentTextNode=newTextNode;},endElement:function(){var newTextNode=document.createTextNode("");this._currentTextNode.parentNode.parentNode.appendChild(newTextNode);this._currentTextNode=newTextNode;},text:function(s){this._currentTextNode.appendData(s);},close:function(){this._element.normalize();}};function sh_highlightElement(element,language){sh_addClass(element,"sh_sourceCode");if(element.normalize){element.normalize();}
+var inputString;if(element.childNodes.length===0){return;}
+else if(element.childNodes.length===1){if(element.firstChild.nodeType===3||element.firstChild.nodeType===4){inputString=element.firstChild.data;}
+else{inputString=sh_getText(element);}}
+else{inputString=sh_getText(element);}
+sh_builder.init(element);sh_highlightString(inputString,language,sh_builder);sh_builder.close();}
+function sh_highlightDocument(){if(!window.sh_languages){return;}
+var nodeList=document.getElementsByTagName("pre");for(var i=0;i<nodeList.length;i++){var element=nodeList.item(i);var htmlClasses=sh_getClasses(element);for(var j=0;j<htmlClasses.length;j++){var htmlClass=htmlClasses[j].toLowerCase();if(htmlClass==="sh_sourcecode"){continue;}
+var prefix=htmlClass.substr(0,3);if(prefix==="sh_"){var language=htmlClass.substring(3);if(language in sh_languages){sh_highlightElement(element,sh_languages[language]);}
+else{throw"Found <pre> element with class='"+htmlClass+"', but no such language exists";}}}}}
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/javascript/sh_sql.js
===================================================================
--- YDFramework2.0/trunk/YDFramework2/javascript/sh_sql.js	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/javascript/sh_sql.js	2007-01-08 11:21:56 UTC (rev 2302)
@@ -0,0 +1,371 @@
+if (! this.sh_languages) {
+  this.sh_languages = {};
+}
+sh_languages['sql'] = [
+  [
+    {
+      'regex': /\b(?:[Vv][Aa][Rr][Cc][Hh][Aa][Rr]|[Tt][Ii][Nn][Yy][Ii][Nn][Tt]|[Tt][Ee][Xx][Tt]|[Dd][Aa][Tt][Ee]|[Ss][Mm][Aa][Ll][Ll][Ii][Nn][Tt]|[Mm][Ee][Dd][Ii][Uu][Mm][Ii][Nn][Tt]|[Ii][Nn][Tt]|[Bb][Ii][Gg][Ii][Nn][Tt]|[Ff][Ll][Oo][Aa][Tt]|[Dd][Oo][Uu][Bb][Ll][Ee]|[Dd][Ee][Cc][Ii][Mm][Aa][Ll]|[Dd][Aa][Tt][Ee][Tt][Ii][Mm][Ee]|[Tt][Ii][Mm][Ee][Ss][Tt][Aa][Mm][Pp]|[Tt][Ii][Mm][Ee]|[Yy][Ee][Aa][Rr]|[Uu][Nn][Ss][Ii][Gg][Nn][Ee][Dd]|[Cc][Hh][Aa][Rr]|[Tt][Ii][Nn][Yy][Bb][Ll][Oo][Bb]|[Tt][Ii][Nn][Yy][Tt][Ee][Xx][Tt]|[Bb][Ll][Oo][Bb]|[Mm][Ee][Dd][Ii][Uu][Mm][Bb][Ll][Oo][Bb]|[Mm][Ee][Dd][Ii][Uu][Mm][Tt][Ee][Xx][Tt]|[Ll][Oo][Nn][Gg][Bb][Ll][Oo][Bb]|[Ll][Oo][Nn][Gg][Tt][Ee][Xx][Tt]|[Ee][Nn][Uu][Mm]|[Bb][Oo][Oo][Ll]|[Bb][Ii][Nn][Aa][Rr][Yy]|[Vv][Aa][Rr][Bb][Ii][Nn][Aa][Rr][Yy])\b/g,
+      'style': 'sh_type'
+    },
+    {
+      'regex': /\b(?:[Aa][Ll][Ll]|[Aa][Ss][Cc]|[Aa][Ss]|[Aa][Ll][Tt][Ee][Rr]|[Aa][Nn][Dd]|[Aa][Dd][Dd]|[Aa][Uu][Tt][Oo]_[Ii][Nn][Cc][Rr][Ee][Mm][Ee][Nn][Tt]|[Bb][Ee][Tt][Ww][Ee][Ee][Nn]|[Bb][Ii][Nn][Aa][Rr][Yy]|[Bb][Oo][Tt][Hh]|[Bb][Yy]|[Bb][Oo][Oo][Ll][Ee][Aa][Nn]|[Cc][Hh][Aa][Nn][Gg][Ee]|[Cc][Hh][Ee][Cc][Kk]|[Cc][Oo][Ll][Uu][Mm][Nn][Ss]|[Cc][Oo][Ll][Uu][Mm][Nn]|[Cc][Rr][Oo][Ss][Ss]|[Cc][Rr][Ee][Aa][Tt][Ee]|[Dd][Aa][Tt][Aa][Bb][Aa][Ss][Ee][Ss]|[Dd][Aa][Tt][Aa][Bb][Aa][Ss][Ee]|[Dd][Aa][Tt][Aa]|[Dd][Ee][Ll][Aa][Yy][Ee][Dd]|[Dd][Ee][Ss][Cc][Rr][Ii][Bb][Ee]|[Dd][Ee][Ss][Cc]|[Dd][Ii][Ss][Tt][Ii][Nn][Cc][Tt]|[Dd][Ee][Ll][Ee][Tt][Ee]|[Dd][Rr][Oo][Pp]|[Dd][Ee][Ff][Aa][Uu][Ll][Tt]|[Ee][Nn][Cc][Ll][Oo][Ss][Ee][Dd]|[Ee][Ss][Cc][Aa][Pp][Ee][Dd]|[Ee][Xx][Ii][Ss][Tt][Ss]|[Ee][Xx][Pp][Ll][Aa][Ii][Nn]|[Ff][Ii][Ee][Ll][Dd][Ss]|[Ff][Ii][Ee][Ll][Dd]|[Ff][Ll][Uu][Ss][Hh]|[Ff][Oo][Rr]|[Ff][Oo][Rr][Ee][Ii][Gg][Nn]|[Ff][Uu][Nn][Cc][Tt][Ii][Oo][Nn]|[Ff][Rr][Oo][Mm]|[Gg][Rr][Oo][Uu][Pp]|[Gg][Rr][A!
 a][Nn][Tt]|[Hh][Aa][Vv][Ii][Nn][Gg]|[Ii][Gg][Nn][Oo][Rr][Ee]|[Ii][Nn][Dd][Ee][Xx]|[Ii][Nn][Ff][Ii][Ll][Ee]|[Ii][Nn][Ss][Ee][Rr][Tt]|[Ii][Nn][Nn][Ee][Rr]|[Ii][Nn][Tt][Oo]|[Ii][Dd][Ee][Nn][Tt][Ii][Ff][Ii][Ee][Dd]|[Ii][Nn]|[Ii][Ss]|[Ii][Ff]|[Jj][Oo][Ii][Nn]|[Kk][Ee][Yy][Ss]|[Kk][Ii][Ll][Ll]|[Kk][Ee][Yy]|[Ll][Ee][Aa][Dd][Ii][Nn][Gg]|[Ll][Ii][Kk][Ee]|[Ll][Ii][Mm][Ii][Tt]|[Ll][Ii][Nn][Ee][Ss]|[Ll][Oo][Aa][Dd]|[Ll][Oo][Cc][Aa][Ll]|[Ll][Oo][Cc][Kk]|[Ll][Oo][Ww]_[Pp][Rr][Ii][Oo][Rr][Ii][Tt][Yy]|[Ll][Ee][Ff][Tt]|[Ll][Aa][Nn][Gg][Uu][Aa][Gg][Ee]|[Mm][Oo][Dd][Ii][Ff][Yy]|[Nn][Aa][Tt][Uu][Rr][Aa][Ll]|[Nn][Oo][Tt]|[Nn][Uu][Ll][Ll]|[Nn][Ee][Xx][Tt][Vv][Aa][Ll]|[Oo][Pp][Tt][Ii][Mm][Ii][Zz][Ee]|[Oo][Pp][Tt][Ii][Oo][Nn]|[Oo][Pp][Tt][Ii][Oo][Nn][Aa][Ll][Ll][Yy]|[Oo][Rr][Dd][Ee][Rr]|[Oo][Uu][Tt][Ff][Ii][Ll][Ee]|[Oo][Rr]|[Oo][Uu][Tt][Ee][Rr]|[Oo][Nn]|[Pp][Rr][Oo][Cc][Ee][Ee][Dd][Uu][Rr][Ee]|[Pp][Rr][Oo][Cc][Ee][Dd][Uu][Rr][Aa][Ll]|[Pp][Rr][Ii][Mm][Aa][Rr][Yy]|[Rr][Ee][Aa][Dd]|[Rr][Ee][Ff][Ee][R!
 r][Ee][Nn][Cc][Ee][Ss]|[Rr][Ee][Gg][Ee][Xx][Pp]|[Rr][Ee][Nn][A!
 a][Mm][E
e]|[Rr][Ee][Pp][Ll][Aa][Cc][Ee]|[Rr][Ee][Tt][Uu][Rr][Nn]|[Rr][Ee][Vv][Oo][Kk][Ee]|[Rr][Ll][Ii][Kk][Ee]|[Rr][Ii][Gg][Hh][Tt]|[Ss][Hh][Oo][Ww]|[Ss][Oo][Nn][Aa][Mm][Ee]|[Ss][Tt][Aa][Tt][Uu][Ss]|[Ss][Tt][Rr][Aa][Ii][Gg][Hh][Tt]_[Jj][Oo][Ii][Nn]|[Ss][Ee][Ll][Ee][Cc][Tt]|[Ss][Ee][Tt][Vv][Aa][Ll]|[Ss][Ee][Tt]|[Tt][Aa][Bb][Ll][Ee][Ss]|[Tt][Ee][Mm][Ii][Nn][Aa][Tt][Ee][Dd]|[Tt][Oo]|[Tt][Rr][Aa][Ii][Ll][Ii][Nn][Gg]|[Tt][Rr][Uu][Nn][Cc][Aa][Tt][Ee]|[Tt][Aa][Bb][Ll][Ee]|[Tt][Ee][Mm][Pp][Oo][Rr][Aa][Rr][Yy]|[Tt][Rr][Ii][Gg][Gg][Ee][Rr]|[Tt][Rr][Uu][Ss][Tt][Ee][Dd]|[Uu][Nn][Ii][Qq][Uu][Ee]|[Uu][Nn][Ll][Oo][Cc][Kk]|[Uu][Ss][Ee]|[Uu][Ss][Ii][Nn][Gg]|[Uu][Pp][Dd][Aa][Tt][Ee]|[Vv][Aa][Ll][Uu][Ee][Ss]|[Vv][Aa][Rr][Ii][Aa][Bb][Ll][Ee][Ss]|[Vv][Ii][Ee][Ww]|[Ww][Ii][Tt][Hh]|[Ww][Rr][Ii][Tt][Ee]|[Ww][Hh][Ee][Rr][Ee]|[Zz][Ee][Rr][Oo][Ff][Ii][Ll][Ll]|[Tt][Yy][Pp][Ee]|[Xx][Oo][Rr])\b/g,
+      'style': 'sh_keyword'
+    },
+    {
+      'next': 1,
+      'regex': /"/g,
+      'style': 'sh_string'
+    },
+    {
+      'next': 2,
+      'regex': /'/g,
+      'style': 'sh_string'
+    },
+    {
+      'next': 3,
+      'regex': /`/g,
+      'style': 'sh_string'
+    },
+    {
+      'next': 4,
+      'regex': /#/g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 5,
+      'regex': /\/\/\//g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 11,
+      'regex': /\/\//g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 12,
+      'regex': /\/\*\*/g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 18,
+      'regex': /\/\*/g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 19,
+      'regex': /--/g,
+      'style': 'sh_comment'
+    },
+    {
+      'regex': /~|!|%|\^|\*|\(|\)|-|\+|=|\[|\]|\\|:|;|,|\.|\/|\?|&|<|>|\|/g,
+      'style': 'sh_symbol'
+    },
+    {
+      'regex': /\b[+-]?(?:(?:0x[A-Fa-f0-9]+)|(?:(?:[\d]*\.)?[\d]+(?:[eE][+-]?[\d]+)?))u?(?:(?:int(?:8|16|32|64))|L)?\b/g,
+      'style': 'sh_number'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /"/g,
+      'style': 'sh_string'
+    },
+    {
+      'regex': /\\./g,
+      'style': 'sh_specialchar'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /'/g,
+      'style': 'sh_string'
+    },
+    {
+      'regex': /\\./g,
+      'style': 'sh_specialchar'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /`/g,
+      'style': 'sh_string'
+    },
+    {
+      'regex': /\\./g,
+      'style': 'sh_specialchar'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /$/g
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /$/g
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_\.\/\-_]+@[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_]+:\/\/[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'next': 6,
+      'regex': /<!DOCTYPE/g,
+      'state': 1,
+      'style': 'sh_preproc'
+    },
+    {
+      'next': 8,
+      'regex': /<!--/g,
+      'style': 'sh_comment'
+    },
+    {
+      'regex': /<(?:\/)?[A-Za-z0-9]+(?:\/)?>/g,
+      'style': 'sh_keyword'
+    },
+    {
+      'next': 9,
+      'regex': /<(?:\/)?[A-Za-z0-9]+/g,
+      'state': 1,
+      'style': 'sh_keyword'
+    },
+    {
+      'regex': /&(?:[A-Za-z0-9]+);/g,
+      'style': 'sh_preproc'
+    },
+    {
+      'regex': /@[A-Za-z]+/g,
+      'style': 'sh_type'
+    },
+    {
+      'regex': /(?:TODO|FIXME)(?:[:]?)/g,
+      'style': 'sh_todo'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': />/g,
+      'style': 'sh_preproc'
+    },
+    {
+      'next': 7,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'regex': /\\"/g
+    },
+    {
+      'exit': true,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /-->/g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 8,
+      'regex': /<!--/g,
+      'style': 'sh_comment'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /(?:\/)?>/g,
+      'style': 'sh_keyword'
+    },
+    {
+      'regex': /[^=" \t>]+/g,
+      'style': 'sh_type'
+    },
+    {
+      'regex': /=/g,
+      'style': 'sh_symbol'
+    },
+    {
+      'next': 10,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'regex': /\\"/g
+    },
+    {
+      'exit': true,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /$/g
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /\*\//g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 12,
+      'regex': /\/\*\*/g,
+      'style': 'sh_comment'
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_\.\/\-_]+@[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_]+:\/\/[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'next': 13,
+      'regex': /<!DOCTYPE/g,
+      'state': 1,
+      'style': 'sh_preproc'
+    },
+    {
+      'next': 15,
+      'regex': /<!--/g,
+      'style': 'sh_comment'
+    },
+    {
+      'regex': /<(?:\/)?[A-Za-z0-9]+(?:\/)?>/g,
+      'style': 'sh_keyword'
+    },
+    {
+      'next': 16,
+      'regex': /<(?:\/)?[A-Za-z0-9]+/g,
+      'state': 1,
+      'style': 'sh_keyword'
+    },
+    {
+      'regex': /&(?:[A-Za-z0-9]+);/g,
+      'style': 'sh_preproc'
+    },
+    {
+      'regex': /@[A-Za-z]+/g,
+      'style': 'sh_type'
+    },
+    {
+      'regex': /(?:TODO|FIXME)(?:[:]?)/g,
+      'style': 'sh_todo'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': />/g,
+      'style': 'sh_preproc'
+    },
+    {
+      'next': 14,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'regex': /\\"/g
+    },
+    {
+      'exit': true,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /-->/g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 15,
+      'regex': /<!--/g,
+      'style': 'sh_comment'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /(?:\/)?>/g,
+      'style': 'sh_keyword'
+    },
+    {
+      'regex': /[^=" \t>]+/g,
+      'style': 'sh_type'
+    },
+    {
+      'regex': /=/g,
+      'style': 'sh_symbol'
+    },
+    {
+      'next': 17,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'regex': /\\"/g
+    },
+    {
+      'exit': true,
+      'regex': /"/g,
+      'style': 'sh_string'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /\*\//g,
+      'style': 'sh_comment'
+    },
+    {
+      'next': 18,
+      'regex': /\/\*/g,
+      'style': 'sh_comment'
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_\.\/\-_]+@[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'regex': /(?:<?)[A-Za-z0-9_]+:\/\/[A-Za-z0-9_\.\/\-_]+(?:>?)/g,
+      'style': 'sh_url'
+    },
+    {
+      'regex': /(?:TODO|FIXME)(?:[:]?)/g,
+      'style': 'sh_todo'
+    }
+  ],
+  [
+    {
+      'exit': true,
+      'regex': /$/g
+    }
+  ]
+];

Added: YDFramework2.0/trunk/YDFramework2/javascript/sh_style.css
===================================================================
--- YDFramework2.0/trunk/YDFramework2/javascript/sh_style.css	2007-01-07 17:47:07 UTC (rev 2301)
+++ YDFramework2.0/trunk/YDFramework2/javascript/sh_style.css	2007-01-08 11:21:56 UTC (rev 2302)
@@ -0,0 +1,136 @@
+pre.sh_sourceCode {
+  background-color: white;
+  color: black;
+  font-style: normal;
+  font-weight: normal;
+}
+
+pre.sh_sourceCode span.sh_keyword {
+  color: blue;
+}
+
+pre.sh_sourceCode span.sh_type {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_string {
+  color: red;
+}
+
+pre.sh_sourceCode span.sh_specialchar {
+  color: #FFC0CB;
+}
+
+pre.sh_sourceCode span.sh_comment {
+  color: #A52A2A;
+  font-style: italic;
+}
+
+pre.sh_sourceCode span.sh_number {
+  color: purple;
+}
+
+pre.sh_sourceCode span.sh_preproc {
+  color: #00008B;
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_symbol {
+  color: #8B0000;
+}
+
+pre.sh_sourceCode span.sh_function {
+  color: black;
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_cbracket {
+  color: red;
+}
+
+pre.sh_sourceCode span.sh_todo {
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_linenum {
+  color: black;
+}
+
+pre.sh_sourceCode span.sh_url {
+  color: blue;
+}
+
+pre.sh_sourceCode span.sh_date {
+  color: blue;
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_time {
+  color: #00008B;
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_ip {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_file {
+  color: #00008B;
+  font-weight: bold;
+}
+
+pre.sh_sourceCode span.sh_name {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_variable {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_italics {
+  color: #006400;
+  font-style: italic;
+}
+
+pre.sh_sourceCode span.sh_bold {
+  color: #006400;
+  font-weight: bold
+}
+
+pre.sh_sourceCode span.sh_underline {
+  color: #006400;
+  text-decoration: underline;
+}
+
+pre.sh_sourceCode span.sh_fixed {
+  color: green;
+  font-family: monospace;
+}
+
+pre.sh_sourceCode span.sh_argument {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_optionalargument {
+  color: purple;
+}
+
+pre.sh_sourceCode span.sh_math {
+  color: #FFA500;
+}
+
+pre.sh_sourceCode span.sh_bibtex {
+  color: blue;
+}
+
+pre.sh_sourceCode span.sh_oldfile {
+  color: #FFA500;
+}
+
+pre.sh_sourceCode span.sh_newfile {
+  color: #006400;
+}
+
+pre.sh_sourceCode span.sh_difflines {
+  color: blue;
+}



From ximian at mail.berlios.de  Sat Jan 13 18:47:37 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 18:47:37 +0100
Subject: [ydf-devel] r2303 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200701131747.l0DHlbFr032193@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 18:47:14 +0100 (Sat, 13 Jan 2007)
New Revision: 2303

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
on YDDatabaseObject:
 - fixed getResults comment typo
 - added date management on insertForm

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-08 11:21:56 UTC (rev 2302)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-13 17:47:14 UTC (rev 2303)
@@ -836,7 +836,7 @@
          *  @param $only_current (optional) Returns only the current object results. Default: false.
          *  @param $only_fields  (optional) Returns only defined fields. Default: false.
          *  @param $columns      (optional) Returns the columns names instead of the fields names.
-         *  @param $prefix       (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *  @param $prefix       (optional) Adds the relation's vars as prefixes to the keys. Default: true.
          *
          *  @returns  An array with the results.
          */
@@ -1048,11 +1048,13 @@
          *
          *  @param $forvalues  (optional) Custom form validation values
          *
+         *  @param $onDate     (optional) When element is a date (read: array ), we should convert to this format. Default: 'datetimesql'
+         *
          *  @returns  YDResult object with a message and a result
          *            On 'ok', result is the new id
          *            On 'form_err', result is array of form error messages
          */
-        function insertForm( & $form, $messages = array(), $formvalues = null ){
+        function insertForm( & $form, $messages = array(), $formvalues = null, $onDate = 'datetimesql' ){
 
             YDInclude( 'YDResult.php' );
 
@@ -1069,15 +1071,23 @@
             // reset all previous information
             $this->reset();
 
-            $this->setValues( $form->getValues() );
+			// get form values
+			$values = $form->getValues();
 
+			// convert dates
+			foreach( $values as $element => $value )
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $form->getValue( $element ), $onDate );
+
+			// apply values
+            $this->setValues( $values );
+
             // insert values and check result
             $result = $this->insert();
 
             if ( $result ){
                 return YDResult::ok( $msg_ok, $result );
             }else{
-                return YDResult::fatal( $msg_err, $result );
+                return YDResult::fatal( $msg_error, $result );
             }
         }
 



From ximian at mail.berlios.de  Sat Jan 13 18:52:26 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 18:52:26 +0100
Subject: [ydf-devel] r2304 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701131752.l0DHqQ5l008914@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 18:51:54 +0100 (Sat, 13 Jan 2007)
New Revision: 2304

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
 - all internal finds will now use possible relations defined in classes that extend YDDatabaseTree3
 - all ambiguity fixed: column names are exported with table name too ( 'YDDatabaseTree3.id' instead of just 'id' )

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-13 17:47:14 UTC (rev 2303)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-13 17:51:54 UTC (rev 2304)
@@ -92,8 +92,15 @@
 			$this->__level    = $levelField;
 			$this->__position = $positionField;
 
+			$this->__table_id       = $table . '.' . $idField;
+			$this->__table_parent   = $table . '.' . $parentField;
+			$this->__table_lineage  = $table . '.' . $lineageField;
+			$this->__table_level    = $table . '.' . $levelField;
+			$this->__table_position = $table . '.' . $positionField;
+
+
 			// define a generic tree order
-			$this->setOrder( $this->__parent . ' ASC, ' . $this->__position . ' ASC' );
+			$this->setOrder( $this->__table_parent . ' ASC, ' . $this->__table_position . ' ASC' );
 		}
 
 
@@ -111,8 +118,8 @@
         /**
          *  This function will overide the YDDatabaseObject to reset object but init order
          */
-		function reset(){
-			parent::reset();
+		function resetAll(){
+			parent::resetAll();
 			$this->order( $this->_tree_order );
 		}
 
@@ -138,7 +145,7 @@
          */
         function getNode( $id, $field = null ) {
 
-			$this->reset();
+			$this->resetAll();
 
 			// if field not defined, field is id
 			if ( is_null( $field ) ) $field = $this->__id;
@@ -159,7 +166,7 @@
         function _getNode() {
 
 			// check results
-			if ( $this->find() == 0 ) return false;
+			if ( $this->findAll() == 0 ) return false;
 
             // Execute the query and return the record
             return $this->getValues();
@@ -171,17 +178,19 @@
          *
          *  @param $id              The ID of the node to fetch descendant data for. 
          *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns The descendants of the passed now
          */
-        function getDescendants( $id, $includeSelf = false ) {
+        function getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
 
 			// check if we want an invalid id (like 0 or 1)
 			if ( $id < 2 ) return $this->getTreeElements();
 
-			$this->reset();
+			$this->resetAll();
 
-			return $this->_getDescendants( $id, $includeSelf );
+			return $this->_getDescendants( $id, $includeSelf, $maxLevel, $prefix );
 		}
 
 
@@ -190,20 +199,25 @@
          *
          *  @param $id              The ID of the node to fetch descendant data for. 
          *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns The descendants of id
          */
-        function _getDescendants( $id, $includeSelf = false ) {
+        function _getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
 
             // get just children
-			if ( $includeSelf == false ) $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
-			else                         $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->__id . ' = ' . intval( $id ) );
+			if ( $includeSelf == false ) $this->where(       $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			else                         $this->where( '(' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
 
+			// check max level to retrieve
+			if ( is_numeric( $maxLevel ) ) $this->where( $this->__table_level . '<' . intval( $maxLevel ) );
+
 			// find nodes
-			$this->find();
+			$this->findAll();
 
 			// return all nodes
-			return $this->getResults();
+			return $this->getResults( false, false, false, $prefix );
 		}
 
 
@@ -214,7 +228,7 @@
          */
         function getTreeElements() {
 
-			$this->reset();
+			$this->resetAll();
 
 			return $this->_getTreeElements();
 		}
@@ -228,10 +242,10 @@
         function _getTreeElements() {
 
 			// get all elements except root
-			$this->where( $this->__id . ' > 1' );
+			$this->where( $this->__table_id . ' > 1' );
 
 			// find elements
-			$this->find();
+			$this->findAll();
 
 			// return all nodes
 			return $this->getResults();
@@ -249,10 +263,10 @@
         function _getTreeElementsAsAssocArray( $columns = array(), $key = null ) {
 
 			// get all elements except root
-			$this->where( $this->__id . ' > 1' );
+			$this->where( $this->__table_id . ' > 1' );
 
 			// find elements
-			$this->find();
+			$this->findAll();
 
 			// compute key
 			if ( is_null( $key ) ) $key = $this->__id;
@@ -271,7 +285,7 @@
          */
         function getChildren( $id, $includeSelf = false ){
 
-			$this->reset();
+			$this->resetAll();
 			
 			return $this->_getChildren( $id, $includeSelf );
         }
@@ -287,10 +301,10 @@
         function _getChildren( $id, $includeSelf = false ){
 
             // get just children
-			if ( $includeSelf == false ) $this->where( $this->__parent . ' = ' . intval( $id ) );
-			else                         $this->where( $this->__parent . ' = ' . intval( $id ) . ' OR ' . $this->__parent . ' = ' . intval( $id ) );
+			if ( $includeSelf == false ) $this->where(       $this->__table_parent . ' = ' . intval( $id ) );
+			else                         $this->where( '(' . $this->__table_parent . ' = ' . intval( $id ) . ' OR ' . $this->__table_parent . ' = ' . intval( $id ) . ')' );
 
-			$this->find();
+			$this->findAll();
 
 			return $this->getResults();
         }
@@ -308,7 +322,7 @@
          */
         function getPath( $id, $includeSelf=false ) {
 
-			$this->reset();
+			$this->resetAll();
 
 			return $this->_getPath( $id, $includeSelf );
         }
@@ -325,10 +339,10 @@
         function _getPath( $id, $includeSelf = false ) {
 
             // Get the node
-            $node = $this->getNode( $id ) ;
+            $node = $this->getNode( intval($id) ) ;
 
 			// reset values of previous getNode()
-			$this->reset();
+			$this->resetAll();
 
             // No node, return empty array
             if ( ! $node ) return array();
@@ -336,10 +350,10 @@
 			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
 			$nodes = array_map( 'intval', explode( '/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) );
 
-            if ( $includeSelf == false ) $this->where( $this->getTable() . '.' . $this->__id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
-			else                         $this->where( $this->getTable() . '.' . $this->__id . ' IN (' . $this->escapeSqlArray( $nodes ) . ') OR ' . $this->__id . ' = ' . intval( $id ) );
+            if ( $includeSelf == false ) $this->where(       $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
+			else                         $this->where( '(' . $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ') OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
 
-			$this->find();
+			$this->findAll();
 
 			return $this->getResults();
         }
@@ -358,7 +372,7 @@
 			// if ancertor is root, element is descendant if exist
 			if ( $ancestor_id == 1 ) return ( $this->getNode( $descendant_id ) != false );
 
-			$this->reset();
+			$this->resetAll();
 			
 			return $this->_isDescendantOf( $descendant_id, $ancestor_id );
         }
@@ -378,10 +392,10 @@
 			$this->set( $this->__id, intval( $descendant_id ) );
 
 			// check if descendant has the ancestor in lineage ;)
-			$this->where( $this->__lineage . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' );
+			$this->where( $this->__table_lineage . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' );
 		
 			// get total of rows
-			return ( $this->find() == 1 );
+			return ( $this->findAll() == 1 );
         }
 
 
@@ -395,16 +409,16 @@
          */
         function isChildOf( $child_id, $parent_id ) {
 
-			$this->reset();
+			$this->resetAll();
 
 			// check if there is a id that equals $child_id
 			$this->set( $this->__id, intval( $child_id ) );
 
 			// check if there is a parent that equals $parent_id
-			$this->where( $this->__parent . ' = ' . intval( $parent_id ) );
+			$this->where( $this->__table_parent . ' = ' . intval( $parent_id ) );
 
 			// get total of rows
-			return ( $this->find() == 1 );
+			return ( $this->findAll() == 1 );
         }
 
 
@@ -417,7 +431,7 @@
          */
         function numDescendants( $id ) {
 
-			$this->reset();
+			$this->resetAll();
 
 			return $this->_numDescendants( $id );
         }
@@ -433,10 +447,10 @@
         function _numDescendants( $id ) {
 
 			// search all nodes that contains this id in lineage. if node is root, count all nodes
-			if ( $id > 1 ) $this->where( $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			if ( $id > 1 ) $this->where( $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
 
 			// find them
-			return $this->find();
+			return $this->findAll();
         }
 
 
@@ -449,13 +463,13 @@
          */
         function numChildren( $id ) {
 
-			$this->reset();
+			$this->resetAll();
 
 			// search all nodes that contains this id in lineage
-			$this->where( $this->__parent . ' = ' . intval( $id ) );
+			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
 
 			// find them
-			return $this->find();
+			return $this->findAll();
         }
 
 
@@ -474,12 +488,12 @@
             // No node, return empty array
             if ( ! $node ) return array();
 
-			$this->reset();
+			$this->resetAll();
 
 			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
-			$this->where( $this->__parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			$this->where( '(' . $this->__table_parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__table_id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' . ')' );
 
-			$this->find();
+			$this->findAll();
 
             // Execute the query and get the record
             return $this->getResults();
@@ -519,20 +533,20 @@
 			// create an empty position. To do this, if node is not added in the end, we must increment position of nodes that have the same parent and equal or bigger position 
 			if ( $position != $total_brothers + 1 ){
 	
-				$this->reset();
+				$this->resetAll();
 
 				// position field must increment
-				$this->set( $this->__position, $this->__position . ' + 1' );
+				$this->set( $this->__position, $this->__table_position . ' + 1' );
 
 				// only on new brothers with higher or equal position
-				$this->where( $this->__parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__position . ' >= ' . intval( $position ) );
+				$this->where( '(' . $this->__table_parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__table_position . ' >= ' . intval( $position ) . ')' );
 
 				// lets update.
 				$this->update( array(), $this->__position );
 			}
 
 			// reset any previous value to create insert
-			$this->reset();
+			$this->resetAll();
 
 			// apply custom values
 			$this->setValues( $values );
@@ -557,14 +571,8 @@
          */
         function updateNode( $values, $id ) {
 
-			$this->reset();
+			$this->resetAll();
 
-			// get reserved field names
-			$parent   = $this->__parent;
-			$lineage  = $this->__lineage;
-			$level    = $this->__level;
-			$position = $this->__position;
-
 			// apply custom values
 			$this->setValues( $values );
 			
@@ -572,10 +580,10 @@
 			$this->set( $this->__id, intval( $id ) );
 
 			// unset reserved fields
-			unset( $this->$parent );
-			unset( $this->$lineage );
-			unset( $this->$level );
-			unset( $this->$position );
+			$this->unsetVar( $this->__parent );
+			$this->unsetVar( $this->__lineage );
+			$this->unsetVar( $this->__level );
+			$this->unsetVar( $this->__position );
 
 			return $this->update();
         }
@@ -597,7 +605,7 @@
 	            // get node details before delete. we must know the position
 	            $node = $this->getNode( $id );
 
-				$this->reset();
+				$this->resetAll();
 
 				$this->set( $this->__id, intval( $id ) );
 
@@ -606,13 +614,13 @@
 				
 				if ( $total == 0 ) return 0;
 
-				$this->reset();
+				$this->resetAll();
 
 				// decrease positions
-				$this->set( $this->__position, $this->__position . ' - 1' );
+				$this->set( $this->__position, $this->__table_position . ' - 1' );
 
 				// in all elements with same parent AND position bigger than our
-				$this->where( $this->__parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__position . ' > ' . intval( $node[ $this->__position ] ) );
+				$this->where( '(' . $this->__table_parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__table_position . ' > ' . intval( $node[ $this->__position ] ) . ')' );
 
 				$this->update( array(), $this->__position );
 				
@@ -620,10 +628,10 @@
 			}
 
 			// here we want do delete child only
-			$this->reset();
+			$this->resetAll();
 
 			// we only need to delete children. Children of children will be deleted when mysql is InnoDB
-			$this->where( $this->__parent . ' = ' . intval( $id ) );
+			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
 
 			return $this->delete();
         }
@@ -666,15 +674,15 @@
 			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
 
 				// decrease positions of old brothers that have position bigger than this node position
-				$this->reset();
-				$this->set( $this->__position, $this->__position . ' - 1' );
-				$this->where( $this->__parent . ' = ' . $old_parent_id . ' AND ' . $this->__position . ' > ' . $old_position );
+				$this->resetAll();
+				$this->set( $this->__position, $this->__table_position . ' - 1' );
+				$this->where( '(' . $this->__table_parent . ' = ' . $old_parent_id . ' AND ' . $this->__table_position . ' > ' . $old_position . ')' );
 				$this->update( array(), $this->__position );
 
 				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
-				$this->reset();
-				$this->set( $this->__position, $this->__position . ' + 1' );
-				$this->where( $this->__parent . ' = ' . $new_parent_id . ' AND ' . $this->__position . ' >= ' . $new_position );
+				$this->resetAll();
+				$this->set( $this->__position, $this->__table_position . ' + 1' );
+				$this->where( '(' . $this->__table_parent . ' = ' . $new_parent_id . ' AND ' . $this->__table_position . ' >= ' . $new_position . ')' );
 				$this->update( array(), $this->__position );
 			}
 
@@ -683,7 +691,7 @@
 			else                       $new_lineage = $new_parent_node[ $this->__lineage ] . $new_parent_id . '/';
 
 			// update node
-			$this->reset();
+			$this->resetAll();
 			$this->set( $this->__id,       intval( $id ) );
 			$this->set( $this->__parent,   intval( $new_parent_id ) );
 			$this->set( $this->__lineage,  $new_lineage );
@@ -693,9 +701,9 @@
 			
 			// update lineages of node descendants ;)
 			if ( $new_parent_id != $old_parent_id ){
-				$this->reset();
-				$this->set( $this->__lineage, 'REPLACE(' . $this->__lineage . ',"' . $old_lineage . $id . '/","' . $new_lineage . $id . '/")' );
-				$this->where( $this->__id . ' > 1 ' );
+				$this->resetAll();
+				$this->set( $this->__lineage, 'REPLACE(' . $this->__table_lineage . ',"' . $old_lineage . $id . '/","' . $new_lineage . $id . '/")' );
+				$this->where( $this->__table_id . ' > 1 ' );
 				$this->update( array(), $this->__lineage );
 			}
 



From ximian at mail.berlios.de  Sat Jan 13 18:54:20 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 18:54:20 +0100
Subject: [ydf-devel] r2305 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701131754.l0DHsKBo011097@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 18:53:46 +0100 (Sat, 13 Jan 2007)
New Revision: 2305

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
added YDForm::setOptions

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-13 17:51:54 UTC (rev 2304)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-13 17:53:46 UTC (rev 2305)
@@ -1383,6 +1383,16 @@
         }
 
         /**
+         *  Function to set options of a form element
+         *
+         *  @param  $array    Associative array with options
+         */
+        function setOptions( $array ) {
+            foreach( $array as $key => $val )
+                $this->setOption( $key, $val );
+        }
+
+        /**
          *  Function to delete an option of a form element
          *
          *  @param  $key    The name of the option



From ximian at mail.berlios.de  Sat Jan 13 18:58:49 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 18:58:49 +0100
Subject: [ydf-devel] r2306 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701131758.l0DHwnFK016916@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 18:58:36 +0100 (Sat, 13 Jan 2007)
New Revision: 2306

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
- added YDBase::unsetVar that deletes a variable
- added gettext and array support to compatibility

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-13 17:53:46 UTC (rev 2305)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-13 17:58:36 UTC (rev 2306)
@@ -226,6 +226,8 @@
      */
     function YDIncludeCompatibility() {
         include_once( dirname( __FILE__ ) . '/3rdparty/upgrade/upgrade.php' );
+        include_once( dirname( __FILE__ ) . '/3rdparty/upgrade/ext/gettext.php' );
+        include_once( dirname( __FILE__ ) . '/3rdparty/upgrade/ext/array.php' );
     }
 
     /**
@@ -355,6 +357,15 @@
         } 
 
         /**
+         *  This function deletes a variable in the object.
+         *
+         *  @param  $name   The variable name.
+         */
+        function unsetVar( $name ) { 
+            if ( isset( $this->$name ) ) unset( $this->$name ); 
+        } 
+
+        /**
          *  This function indicates if a variable in the object exists or not.
          *
          *  @param  $name   The variable name.



From ximian at mail.berlios.de  Sat Jan 13 19:07:53 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 19:07:53 +0100
Subject: [ydf-devel] r2307 - in YDFramework2.0/trunk/YDFramework2/addons: .
	YDLoadconfig
Message-ID: <200701131807.l0DI7rRc024593@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 19:07:38 +0100 (Sat, 13 Jan 2007)
New Revision: 2307

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/
   YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
Log:
added new addon: YDLoadconfig
This simple addon reads db stored configurations to apply all YDConfig set.
In a future, maybe we could add support to db configuration saving and reading/saving from a php file too. This way, it could be possible to define a higher priority to a text file and, if a db is not online, generic file configs would be retrieve from that file.

Added: YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-13 17:58:36 UTC (rev 2306)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-13 18:07:38 UTC (rev 2307)
@@ -0,0 +1,127 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+
+    /**
+     *  This class reads a database table to apply correspondent YDConfig
+     */
+    class YDLoadconfig extends YDAddOnModule {
+
+        /**
+         *  Class constructor for the YDLoadconfig class.
+         *
+         *  @param $dbinstance      Database instance name or object.
+         */
+        function YDLoadconfig( $dbinstance = 'default' ) {
+
+            // Initializes YDBase
+            $this->YDAddOnModule();
+
+            // Setup the module
+            $this->_author = 'Francisco Azevedo';
+            $this->_version = '1.0b';
+            $this->_copyright = '(c) 2006 Francisco Azevedo, francisco at fusemail.com';
+            $this->_description = 'This class handles db configurations.';
+
+			// init DB object
+            $this->db = new YDDatabaseObject();
+
+			// register database as default
+            $this->db->registerDatabase( $dbinstance );
+
+            // init table information
+			$this->_tables = array();
+
+			// init results
+			$this->_results = array();
+        }
+
+
+        /**
+         *  This function adds a table and correspondent name and value columns
+         *
+         *  @param $tablename       Table name
+         *  @param $column_name     (Optional) Column name that have variable names. By default: 'name'.
+         *  @param $column_value    (Optional) Column name that have variable values. By default: 'value'.
+         *
+         */
+        function addTable( $tablename, $column_name = 'name', $column_value = 'value' ) {
+
+            // if table don't exist add it to tables array
+            if ( ! in_array( $tablename, $this->_tables ) ) $this->_tables[ $tablename ] = array( $column_name, $column_value );
+        }
+
+
+        /**
+         *  This function loads configuration from db
+         */
+        function load() {
+
+			// clean possible previous results
+			$this->_results = array();
+
+            // cycle all tables to get their column names
+			foreach( $this->_tables as $tablename => $columns ){
+
+				// copy default db object
+	            $db = $this->db;
+
+				// register table
+				$db->registerTable( $tablename );
+
+				// register fields
+				$db->registerField( $columns[0] );
+				$db->registerField( $columns[1] );
+
+				// find everything in db
+				$db->find();
+
+				// add results
+				$this->_results = array_merge( $this->_results, $db->getResultsAsAssocArray( $columns[0], $columns[1] ) );
+			}
+        }
+
+
+        /**
+         *  This function creates all YDF Configs
+         */
+        function apply() {
+
+			// if we don't have results maybe we should load them
+			if ( empty( $this->_results ) ) $this->load();
+
+            // cycle all results to apply YDConfig
+			foreach( $this->_results as $name => $value ){
+				YDConfig::set( $name, $value );
+			}
+        }
+
+
+    }
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Sat Jan 13 20:10:04 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 20:10:04 +0100
Subject: [ydf-devel] r2308 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701131910.l0DJA4ih015957@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 20:09:46 +0100 (Sat, 13 Jan 2007)
New Revision: 2308

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
on YDF2_process: fixed included files dump typo

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-13 18:07:38 UTC (rev 2307)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-13 19:09:46 UTC (rev 2308)
@@ -238,7 +238,7 @@
                 $debug .= sprintf( '<tr><th %s>File</th><th %s>Size</th></tr>', $font, $font );
                 foreach ( $includeFilesWithSize as $size=>$file ) {
                     $debug .= sprintf(
-                        '<tr><td %s>%s ms</td><td %s>%s ms</td></tr>',
+                        '<tr><td %s>%s</td><td %s>%s</td></tr>',
                         $font, realpath( $file ), $font, YDStringUtil::formatFileSize( $size )
                     );
                 }



From ximian at mail.berlios.de  Sat Jan 13 23:32:47 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 23:32:47 +0100
Subject: [ydf-devel] r2309 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701132232.l0DMWld7031951@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 23:32:07 +0100 (Sat, 13 Jan 2007)
New Revision: 2309

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
 - some cleanups
 - added support for prefixes

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-13 19:09:46 UTC (rev 2308)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-13 22:32:07 UTC (rev 2309)
@@ -140,36 +140,53 @@
          *  @param $id      The ID of the node to fetch.
          *  @param $field   (Optional) The unique field to select on. Defaults to id, which means that the ID field specified
          *                  when the object was instantiated will be used.
+         *  @param $class   (optional) Relation name
+         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns An object containing the node's data, or false if node not found
          */
-        function getNode( $id, $field = null ) {
+        function getNode( $id, $field = null, $class = null, $prefix = false ) {
 
 			$this->resetAll();
 
-			// if field not defined, field is id
-			if ( is_null( $field ) ) $field = $this->__id;
-	
-			// set field
-			$this->set( $field, $id );
-
             // get node
-            return $this->_getNode();
+            return $this->_getNode( $id, $field, $class, $prefix );
         }
 
 
         /**
          *  Helper method to fetch a node.
          *
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   (optional) The unique field to select on. Defaults to id, which means that the ID field specified
+         *                             when the object was instantiated will be used.
+         *  @param $class   (optional) Relation name
+         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: true.
+         *
          *  @returns An object containing the node's data, or false if node not found
          */
-        function _getNode() {
+        function _getNode( $id, $field = null, $class = null, $prefix = true ) {
 
+			// if field not defined, field is id
+			if ( is_null( $field ) ) $field = $this->__id;
+	
+			// set local field
+			if ( is_null( $class ) ){
+
+				// set field value
+				$this->set( $field, $id );
+			}else{
+
+				// load relation and set field
+				$this->load( $class );
+				$this->$class->set( $field, $id );
+			}
+
 			// check results
 			if ( $this->findAll() == 0 ) return false;
 
             // Execute the query and return the record
-            return $this->getValues();
+            return $this->getValues( false, false, false, $prefix );
         }
 
 
@@ -280,14 +297,16 @@
          *  Fetch the children of a node, or if no node is specified, fetch the top level items.
          *
          *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Include self node in results. Default: false.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns The children of the passed id
          */
-        function getChildren( $id, $includeSelf = false ){
+        function getChildren( $id, $includeSelf = false, $prefix = false ){
 
 			$this->resetAll();
 			
-			return $this->_getChildren( $id, $includeSelf );
+			return $this->_getChildren( $id, $includeSelf, $prefix );
         }
 
 
@@ -295,10 +314,12 @@
          *  Helper to fetch the children of a node, or if no node is specified, fetch the top level items.
          *
          *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Include self node in results. Default: false.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns The children of the passed id
          */
-        function _getChildren( $id, $includeSelf = false ){
+        function _getChildren( $id, $includeSelf = false, $prefix = false  ){
 
             // get just children
 			if ( $includeSelf == false ) $this->where(       $this->__table_parent . ' = ' . intval( $id ) );
@@ -306,7 +327,7 @@
 
 			$this->findAll();
 
-			return $this->getResults();
+			return $this->getResults( false, false, false, $prefix );
         }
 
 
@@ -317,14 +338,15 @@
          *
          *  @param $id             The ID of the node to fetch child data for.
          *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns An array of each node to passed node
          */
-        function getPath( $id, $includeSelf=false ) {
+        function getPath( $id, $includeSelf = false, $prefix = false ) {
 
 			$this->resetAll();
 
-			return $this->_getPath( $id, $includeSelf );
+			return $this->_getPath( $id, $includeSelf, $prefix );
         }
 
 
@@ -333,10 +355,11 @@
          *
          *  @param $id             The ID of the node to fetch child data for.
          *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
          *
          *  @returns An array of each node to passed node
          */
-        function _getPath( $id, $includeSelf = false ) {
+        function _getPath( $id, $includeSelf = false, $prefix = false ) {
 
             // Get the node
             $node = $this->getNode( intval($id) ) ;
@@ -355,7 +378,7 @@
 
 			$this->findAll();
 
-			return $this->getResults();
+			return $this->getResults( false, false, false, $prefix );
         }
 
 



From ximian at mail.berlios.de  Sat Jan 13 23:35:03 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 13 Jan 2007 23:35:03 +0100
Subject: [ydf-devel] r2310 -
	YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext
Message-ID: <200701132235.l0DMZ36N032330@sheep.berlios.de>

Author: ximian
Date: 2007-01-13 23:34:34 +0100 (Sat, 13 Jan 2007)
New Revision: 2310

Modified:
   YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php
Log:
added some comments on upgrade/ext/gettext.php to ignore notices

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php	2007-01-13 22:32:07 UTC (rev 2309)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php	2007-01-13 22:34:34 UTC (rev 2310)
@@ -1,381 +1,381 @@
-<?php
-/*
-   This include script simulates gettext() functionality.
-    - It could read translation data from .mo and .po files.
-    - Lookup of plural forms mostly work (but not 100% compliant,
-      no real interpreter for Plural-Forms: expression).
-    - Categories/codesets are ignored.
-
-   Besides using setlocale() you should change the $_ENV["LANG"] var
-   to the desired language manually. Additionally all your scripts
-   could contain following (may also work with standard gettext):
-     $_ENV["LANGUAGE"] = $_SERVER["HTTP_ACCEPT_LANGUAGE"];
-   What's often more user-friendly than hardwired server-side values.
-*/
-
-
-#-- emulate only if not present in current PHP interpreter
-if (!function_exists("gettext")) {
-
-
-   #-- all-in-one combined implementation
-   #   (in original API only the first parameter is present)
-   function gettext($msg, $msg2=NULL, $domain=NULL, $category=NULL, $plural=NULL) {
-      global $_GETTEXT;
-
-      #-- get default params if corresponding args are empty
-      if (!isset($domain)) {
-         $domain = $_GETTEXT["%domain"];
-      }
-      if (empty($_GETTEXT[$domain])) {
-         bindtextdomain($domain);  // auto load from system dirs
-      }
-
-      #-- plural array position
-      if (!isset($plural)) {
-         $pli = 0;
-      }
-      elseif ($ph = $_GETTEXT[$domain]["%plural-c"]) {
-         $pli = gettext___plural_guess($ph, $plural);
-      }
-      else {
-         $pli = ($plural != 1) ? 1 : 0;   // English
-      }
-
-      #-- look up string
-      if (($trans = $_GETTEXT[$domain][$msg])
-      or ($pli) and ($trans = $_GETTEXT[$domain][$msg2]))
-      {
-         // handle plural entries
-         if (is_array($trans)) {
-            if (!isset($trans[$pli])) {
-               $pli = 0;   // missing translation
-            }
-            $trans = $trans[$pli];
-         }
-         // only return, if something found
-         if (strlen($trans)) {
-            $msg = $trans;
-         }
-      }
-
-      #-- handle $category (???)
-      // recode() ...
-
-      #-- give out whatever we have
-      return($msg);
-   }
-   
-
-   #-- return plural form array index for algorithm type
-   #   (compacted from C expression string beforehand)
-   function gettext___plural_guess(&$type, $n) {
-   
-      #-- guess from string with C expression and set integer shorthand
-      if (is_string($type)) {
-         if (($type == "nplurals=1;plural=0;") || !strlen($type)) {
-            $type = -1; // no plurals
-         }
-         elseif ($type == "nplurals=2;plural=n!=1;") {
-            $type = 1;  // English
-         }
-         elseif ($type == "nplurals=2;plural=n>1;") {
-            $type = 2;  // French
-         }
-         // special cases
-         elseif (strpos($type, "n%100!=11")) {
-            if (strpos($type, "n!=0")) {
-               $type == 21;  // Latvian
-            }
-            if (strpos($type, "n%10<=4")) {
-               $type = 22;   // a few Slavic langs (code similar to Polish below)
-            }
-            if (strpos($type, "n%10>=2")) {  // Lithuanian
-               $type = 23;
-            }
-            $type = 0;
-         }
-         // specials, group 2
-         elseif (strpos($type, "n<=4")) {   // Slovak
-            $type = 25;
-         }
-         elseif (strpos($type, "n==2")) {   // Irish
-            $type = 31;
-         }
-         elseif (strpos($type, "n%10>=2")) {   // Polish
-            $type = 26;
-         }
-         elseif (strpos($type, "n%100==3")) {   // Slovenian
-            $type = 28;
-         }
-         // fallbacks
-         elseif (strpos($type, ";plural=n;")) {
-            $type = 7;  // unused
-         }
-         // first at this point a tokenizer/parser/interpreter would have made sense
-         else {
-            $type = 0;  // no plurals
-         }
-      }
-
-      #-- return plural index value from pre-set formulas
-      switch ($type) {
-         case -1:  // no plural forms
-            return(0);
-         case 1:   // English, and lots of others...
-            return($n != 1 ? 1 : 0);
-         case 2:   // French, Brazilian Protuguese
-            return($n > 1 ? 1 : 0);
-         case 7:   // unused
-            return($n);
-
-         case 21:  // Latvian
-            return  (($n%10==1) && ($n%100!=11)) ? (0) :  ($n!=0 ? 1 : 2)  ;
-         case 22:  // Slavic langs
-            return  ($n%10==1) && ($n%100!=11) ? 0 :
-               ( ($n%10>=2) && ($n%10<=4) && ($n%100<10 || $n%100>=20) ? 1 : 2  )  ;
-         case 23:  // Lithuanian
-            return  ($n%10==1) && ($n%100!=11) ? 0 :
-               ( ($n%10>=2) && ($n%100<10 || $n%100>=20) ? 1 : 2  )  ;
-         case 25:  // Slovak
-            return  $n==1 ? 0 : ($n>=2 && $n<=4 ? 1 : 2)  ;
-         case 26:  // Polish
-             return  $n==1 ? 0 : ( $n%10>=2 && $n%10<=4 && ($n%100<10 || $n%100>=20) ? 1 : 2 )  ;
-         case 28:  // Slovenian
-            return  $n%100==1 ? 0 : ($n%100==2 || $n%100==3 || $n%100==4 ? 2 : 3)  ;
-         case 31:  // Irish
-            return  ($n == 1) ? (0) : (($n == 2) ? 1 : 2)  ;
-
-         default:
-            $type = -1;
-      }   // unsupported, always return non-plural index [0]
-      return(0);
-   }
-
-
-   #-- wrappers around monster function above
-   function ngettext($msg1, $msg2, $plural) {
-      return gettext($msg1, $msg2, NULL, NULL, $plural);
-   }
-   function dngettext($domain, $msg1, $msg2, $plural) {
-      return gettext($msg1, $msg2, $domain, NULL, $plural);
-   }
-   function dcngettext($domain, $msg1, $msg2, $plural, $category) {
-      return gettext($msg1, $msg2, $domain, $category, $plural);
-   }
-   function dcgettext($domain, $msg, $category) {
-      return gettext($msg, NULL, $domain, $category);
-   }
-   function dgettext($domain, $msg) {
-      return gettext($msg, NULL, $domain);
-   }
-
-
-   #-- sets current translation data source
-   #   (must have been loaded beforehand)
-   function textdomain($default="NULL") {
-      global $_GETTEXT;
-      $prev = $_GETTEXT["%domain"];
-      if (isset($default)) {
-         $_GETTEXT["%domain"] = $default;
-      }
-      return $prev;
-   }
-
-
-   #-- loads data files
-   function bindtextdomain($domain, $directory="/usr/share/locale:/usr/local/share/locale:./locale") {
-      global $_GETTEXT;
-      if (isset($_GETTEXT["domain"]) && (count($_GETTEXT["domain"]) > 3)) {
-         return;  // don't load twice
-      }
-      $_GETTEXT[$domain]["%dir"] = $directory;
-      $_GETTEXT["%locale"] = setlocale(LC_CTYPE, 0);
-
-      #-- allowed languages
-      $langs = "$_ENV[LANGUAGE],$_ENV[LC_ALL],$_ENV[LC_MESSAGE],$_ENV[LANG],"
-             . $_GETTEXT["%locale"] . ",$_SERVER[HTTP_ACCEPT_LANGUAGE],C,en";
-          
-      #-- add shortened language codes (en_UK.UTF-8 -> + en_UK, en)
-      foreach (explode(",",$langs) as $d) {
-         $d = trim($d);
-         // $dir2[] = $d;
-         $d = strtok($d, "@.-+=%:; ");
-         if (strlen($d)) {
-            $dir2[] = $d;
-         }
-         if (strpos($d, "_")) {
-            $dir2[] = strtok($d, "_");
-         }
-      }
-      
-      #-- search for matching directory and load data file
-      foreach (explode(":", $directory) as $directory) {
-         foreach ($dir2 as $lang) {
-            $base_fn = "$directory/$lang/LC_MESSAGES/$domain";
-
-            #-- binary format
-            if (file_exists($fn = "$base_fn.mo") && ($f = fopen($fn, "rb")))
-            {
-               gettext___load_mo($f, $domain);
-               break 2;
-            }
-
-            #-- text file
-            elseif (function_exists("gettext___load_po")
-            and file_exists($fn = "$base_fn.po") && ($f = fopen($fn, "r")))
-            {
-               gettext___load_po($f, $domain);
-               break 2;
-            }
-         }
-      }//foreach
-      
-      #-- extract headers
-      if ($head = $_GETTEXT[$domain][""]) {
-         foreach (explode("\n", $head) as $line) {
-            $header = strtok(":", $line);
-            $line = trim(strtok("\n"));
-            $_GETTEXT[$domain]["%po-header"][strtolower($header)] = $line;
-         }
-      
-         #-- plural-forms header
-         if (function_exists("gettext___plural_guess")
-         and ($h = $_GETTEXT[$domain]["%po-header"]["plural-forms"]))
-         {
-            $h = preg_replace("/[(){}\[\]^\s*\\]+/", "", $h);  // rm whitespace
-            gettext___plural_guess($h, 0);  // pre-decode into algorithm type integer
-            $_GETTEXT[$domain]["%plural-c"] = $h;
-         }
-      }
-
-      #-- set as default textdomain
-      if (empty($_GETTEXT["%domain"])) {
-         textdomain($domain);
-      }
-      return($domain);
-   }
-
-
-   #-- load string data from binary .mo files (ign checksums)
-   function gettext___load_mo($f, $domain) {
-      global $_GETTEXT;
-
-      #-- read in data file completely
-      $data = fread($f, 1<<20);
-      fclose($f);
-
-      #-- extract header fields and check file magic
-      if ($data) {
-         $header = substr($data, 0, 20);
-         $header = unpack("L1magic/L1version/L1count/L1o_msg/L1o_trn", $header);
-         extract($header);
-         if ((dechex($magic) == "950412de") && ($version == 0)) {
-
-            #-- fetch all entries
-            for ($n=0; $n<$count; $n++) {
-
-               #-- msgid
-               $r = unpack("L1len/L1offs", substr($data, $o_msg + $n * 8, 8));
-               $msgid = substr($data, $r["offs"], $r["len"]);
-               unset($msgid_plural);
-               if (strpos($msgid, "\000")) {
-                  list($msgid, $msgid_plural) = explode("\000", $msgid);
-               }
-
-               #-- translation(s)
-               $r = unpack("L1len/L1offs", substr($data, $o_trn + $n * 8, 8));
-               $msgstr = substr($data, $r["offs"], $r["len"]);
-               if (strpos($msgstr, "\000")) {
-                  $msgstr = explode("\000", $msgstr);
-               }
-
-               #-- add
-               $_GETTEXT[$domain][$msgid] = $msgstr;
-               if (isset($msgid_plural)) {
-                  $_GETTEXT[$domain][$msgid_plural] = &$_GETTEXT[$domain][$msgid];
-               }
-            }
-
-         }
-      }
-   }
-
-
-   #-- read from textual .po source file (not fully correct, and redundant
-   #   because the original gettext/libintl doesn't support this at all)
-   function gettext___load_po($f, $domain) {
-      global $_GETTEXT;
-      $c_esc = array("\\n"=>"\n", "\\r"=>"\r", "\\\\"=>"\\", "\\f"=>"\f", "\\t"=>"\t", "\\"=>"");
-
-      #-- read line-wise from text file   
-      do {
-         $line = trim(fgets($f));
-
-         #-- check what's in the current line
-         $space = strpos($line, " ");
-         // comment
-         if ($line[0] == "#") {
-            //continue;
-         }
-         // msgid
-         elseif (strncmp($line, "msgid", 5)==0) {
-            $msgid[] = trim(substr($line, $space+1), '"');
-         }
-         // translation
-         elseif (strncmp($line, "msgstr", 6)==0) {
-            $msgstr[] = trim(substr($line, $space+1), '"');
-         }
-         // continued (could be _id or _str)
-         elseif ($line[0] == '"') {
-            $line = trim($line, '"');
-            if (isset($msggstr)) {
-               $msgstr[count($msgstr)] .= $line;
-            }
-            else {
-               $msgid[count($msgid)] .= $line;
-            }
-         }
-
-         #-- append to global $_GETTEXT hash as soon as we have a complete dataset
-         if (isset($msgid) && isset($msgstr) && (empty($line) || ($line[0]=="#") || feof($f)) )
-         {
-            $msgid[0] = strtr($msgid[0], $c_esc);
-            foreach ($msgstr as $v) {
-               $_GETTEXT[$domain][$msgid[0]] = strtr($v, $c_esc);
-            }
-            if ($msgid[1]) {
-               $msgid[1] = strtr($msgid[1], $c_esc);
-               $_GETTEXT[$domain][$msgid[1]] = &$_GETTEXT[$domain][$msgid[0]];
-            }
-
-            $msgid = array();
-            $msgstr = array();
-         }
-
-      } while (!feof($f));
-      fclose($f);
-   }
-
-
-   #-- ignored setting (no idea what it really should do)
-   function bind_textdomain_codeset($domain, $codeset) {
-      global $_GETTEXT;
-      $_GETTEXT[$domain]["%codeset"] = $codeset;
-      return($domain);
-   }
-
-
-}
-
-
-#-- define gettexts preferred function name _ separately
-if (!function_exists("_")) {
-   function _($str) {
-      return gettext($str);
-   }
-}
-
-
-
+<?php
+/*
+   This include script simulates gettext() functionality.
+    - It could read translation data from .mo and .po files.
+    - Lookup of plural forms mostly work (but not 100% compliant,
+      no real interpreter for Plural-Forms: expression).
+    - Categories/codesets are ignored.
+
+   Besides using setlocale() you should change the $_ENV["LANG"] var
+   to the desired language manually. Additionally all your scripts
+   could contain following (may also work with standard gettext):
+     $_ENV["LANGUAGE"] = $_SERVER["HTTP_ACCEPT_LANGUAGE"];
+   What's often more user-friendly than hardwired server-side values.
+*/
+
+
+#-- emulate only if not present in current PHP interpreter
+if (!function_exists("gettext")) {
+
+
+   #-- all-in-one combined implementation
+   #   (in original API only the first parameter is present)
+   function gettext($msg, $msg2=NULL, $domain=NULL, $category=NULL, $plural=NULL) {
+      global $_GETTEXT;
+
+      #-- get default params if corresponding args are empty
+      if (!isset($domain)) {
+         $domain = $_GETTEXT["%domain"];
+      }
+      if (empty($_GETTEXT[$domain])) {
+         bindtextdomain($domain);  // auto load from system dirs
+      }
+
+      #-- plural array position
+      if (!isset($plural)) {
+         $pli = 0;
+      }
+      elseif ($ph = $_GETTEXT[$domain]["%plural-c"]) {
+         $pli = gettext___plural_guess($ph, $plural);
+      }
+      else {
+         $pli = ($plural != 1) ? 1 : 0;   // English
+      }
+
+      #-- look up string
+      if (($trans = $_GETTEXT[$domain][$msg])
+      or ($pli) and ($trans = $_GETTEXT[$domain][$msg2]))
+      {
+         // handle plural entries
+         if (is_array($trans)) {
+            if (!isset($trans[$pli])) {
+               $pli = 0;   // missing translation
+            }
+            $trans = $trans[$pli];
+         }
+         // only return, if something found
+         if (strlen($trans)) {
+            $msg = $trans;
+         }
+      }
+
+      #-- handle $category (???)
+      // recode() ...
+
+      #-- give out whatever we have
+      return($msg);
+   }
+   
+
+   #-- return plural form array index for algorithm type
+   #   (compacted from C expression string beforehand)
+   function gettext___plural_guess(&$type, $n) {
+   
+      #-- guess from string with C expression and set integer shorthand
+      if (is_string($type)) {
+         if (($type == "nplurals=1;plural=0;") || !strlen($type)) {
+            $type = -1; // no plurals
+         }
+         elseif ($type == "nplurals=2;plural=n!=1;") {
+            $type = 1;  // English
+         }
+         elseif ($type == "nplurals=2;plural=n>1;") {
+            $type = 2;  // French
+         }
+         // special cases
+         elseif (strpos($type, "n%100!=11")) {
+            if (strpos($type, "n!=0")) {
+               $type == 21;  // Latvian
+            }
+            if (strpos($type, "n%10<=4")) {
+               $type = 22;   // a few Slavic langs (code similar to Polish below)
+            }
+            if (strpos($type, "n%10>=2")) {  // Lithuanian
+               $type = 23;
+            }
+            $type = 0;
+         }
+         // specials, group 2
+         elseif (strpos($type, "n<=4")) {   // Slovak
+            $type = 25;
+         }
+         elseif (strpos($type, "n==2")) {   // Irish
+            $type = 31;
+         }
+         elseif (strpos($type, "n%10>=2")) {   // Polish
+            $type = 26;
+         }
+         elseif (strpos($type, "n%100==3")) {   // Slovenian
+            $type = 28;
+         }
+         // fallbacks
+         elseif (strpos($type, ";plural=n;")) {
+            $type = 7;  // unused
+         }
+         // first at this point a tokenizer/parser/interpreter would have made sense
+         else {
+            $type = 0;  // no plurals
+         }
+      }
+
+      #-- return plural index value from pre-set formulas
+      switch ($type) {
+         case -1:  // no plural forms
+            return(0);
+         case 1:   // English, and lots of others...
+            return($n != 1 ? 1 : 0);
+         case 2:   // French, Brazilian Protuguese
+            return($n > 1 ? 1 : 0);
+         case 7:   // unused
+            return($n);
+
+         case 21:  // Latvian
+            return  (($n%10==1) && ($n%100!=11)) ? (0) :  ($n!=0 ? 1 : 2)  ;
+         case 22:  // Slavic langs
+            return  ($n%10==1) && ($n%100!=11) ? 0 :
+               ( ($n%10>=2) && ($n%10<=4) && ($n%100<10 || $n%100>=20) ? 1 : 2  )  ;
+         case 23:  // Lithuanian
+            return  ($n%10==1) && ($n%100!=11) ? 0 :
+               ( ($n%10>=2) && ($n%100<10 || $n%100>=20) ? 1 : 2  )  ;
+         case 25:  // Slovak
+            return  $n==1 ? 0 : ($n>=2 && $n<=4 ? 1 : 2)  ;
+         case 26:  // Polish
+             return  $n==1 ? 0 : ( $n%10>=2 && $n%10<=4 && ($n%100<10 || $n%100>=20) ? 1 : 2 )  ;
+         case 28:  // Slovenian
+            return  $n%100==1 ? 0 : ($n%100==2 || $n%100==3 || $n%100==4 ? 2 : 3)  ;
+         case 31:  // Irish
+            return  ($n == 1) ? (0) : (($n == 2) ? 1 : 2)  ;
+
+         default:
+            $type = -1;
+      }   // unsupported, always return non-plural index [0]
+      return(0);
+   }
+
+
+   #-- wrappers around monster function above
+   function ngettext($msg1, $msg2, $plural) {
+      return gettext($msg1, $msg2, NULL, NULL, $plural);
+   }
+   function dngettext($domain, $msg1, $msg2, $plural) {
+      return gettext($msg1, $msg2, $domain, NULL, $plural);
+   }
+   function dcngettext($domain, $msg1, $msg2, $plural, $category) {
+      return gettext($msg1, $msg2, $domain, $category, $plural);
+   }
+   function dcgettext($domain, $msg, $category) {
+      return gettext($msg, NULL, $domain, $category);
+   }
+   function dgettext($domain, $msg) {
+      return gettext($msg, NULL, $domain);
+   }
+
+
+   #-- sets current translation data source
+   #   (must have been loaded beforehand)
+   function textdomain($default="NULL") {
+      global $_GETTEXT;
+      $prev = @$_GETTEXT["%domain"];
+      if (isset($default)) {
+         $_GETTEXT["%domain"] = $default;
+      }
+      return $prev;
+   }
+
+
+   #-- loads data files
+   function bindtextdomain($domain, $directory="/usr/share/locale:/usr/local/share/locale:./locale") {
+      global $_GETTEXT;
+      if (isset($_GETTEXT["domain"]) && (count($_GETTEXT["domain"]) > 3)) {
+         return;  // don't load twice
+      }
+      $_GETTEXT[$domain]["%dir"] = $directory;
+      $_GETTEXT["%locale"] = setlocale(LC_CTYPE, 0);
+
+      #-- allowed languages
+      $langs = "$_ENV[LANGUAGE],$_ENV[LC_ALL],$_ENV[LC_MESSAGE],$_ENV[LANG],"
+             . $_GETTEXT["%locale"] . ",$_SERVER[HTTP_ACCEPT_LANGUAGE],C,en";
+          
+      #-- add shortened language codes (en_UK.UTF-8 -> + en_UK, en)
+      foreach (explode(",",$langs) as $d) {
+         $d = trim($d);
+         // $dir2[] = $d;
+         $d = strtok($d, "@.-+=%:; ");
+         if (strlen($d)) {
+            $dir2[] = $d;
+         }
+         if (strpos($d, "_")) {
+            $dir2[] = strtok($d, "_");
+         }
+      }
+      
+      #-- search for matching directory and load data file
+      foreach (explode(":", $directory) as $directory) {
+         foreach ($dir2 as $lang) {
+            $base_fn = "$directory/$lang/LC_MESSAGES/$domain";
+
+            #-- binary format
+            if (file_exists($fn = "$base_fn.mo") && ($f = fopen($fn, "rb")))
+            {
+               gettext___load_mo($f, $domain);
+               break 2;
+            }
+
+            #-- text file
+            elseif (function_exists("gettext___load_po")
+            and file_exists($fn = "$base_fn.po") && ($f = fopen($fn, "r")))
+            {
+               gettext___load_po($f, $domain);
+               break 2;
+            }
+         }
+      }//foreach
+      
+      #-- extract headers
+      if ($head = $_GETTEXT[$domain][""]) {
+         foreach (explode("\n", $head) as $line) {
+            $header = strtok(":", $line);
+            $line = trim(strtok("\n"));
+            $_GETTEXT[$domain]["%po-header"][strtolower($header)] = $line;
+         }
+      
+         #-- plural-forms header
+         if (function_exists("gettext___plural_guess")
+         and ($h = @$_GETTEXT[$domain]["%po-header"]["plural-forms"]))
+         {
+            $h = preg_replace("/[(){}\[\]^\s*\\]+/", "", $h);  // rm whitespace
+            gettext___plural_guess($h, 0);  // pre-decode into algorithm type integer
+            $_GETTEXT[$domain]["%plural-c"] = $h;
+         }
+      }
+
+      #-- set as default textdomain
+      if (empty($_GETTEXT["%domain"])) {
+         textdomain($domain);
+      }
+      return($domain);
+   }
+
+
+   #-- load string data from binary .mo files (ign checksums)
+   function gettext___load_mo($f, $domain) {
+      global $_GETTEXT;
+
+      #-- read in data file completely
+      $data = fread($f, 1<<20);
+      fclose($f);
+
+      #-- extract header fields and check file magic
+      if ($data) {
+         $header = substr($data, 0, 20);
+         $header = unpack("L1magic/L1version/L1count/L1o_msg/L1o_trn", $header);
+         extract($header);
+         if ((dechex($magic) == "950412de") && ($version == 0)) {
+
+            #-- fetch all entries
+            for ($n=0; $n<$count; $n++) {
+
+               #-- msgid
+               $r = unpack("L1len/L1offs", substr($data, $o_msg + $n * 8, 8));
+               $msgid = substr($data, $r["offs"], $r["len"]);
+               unset($msgid_plural);
+               if (strpos($msgid, "\000")) {
+                  list($msgid, $msgid_plural) = explode("\000", $msgid);
+               }
+
+               #-- translation(s)
+               $r = unpack("L1len/L1offs", substr($data, $o_trn + $n * 8, 8));
+               $msgstr = substr($data, $r["offs"], $r["len"]);
+               if (strpos($msgstr, "\000")) {
+                  $msgstr = explode("\000", $msgstr);
+               }
+
+               #-- add
+               $_GETTEXT[$domain][$msgid] = $msgstr;
+               if (isset($msgid_plural)) {
+                  $_GETTEXT[$domain][$msgid_plural] = &$_GETTEXT[$domain][$msgid];
+               }
+            }
+
+         }
+      }
+   }
+
+
+   #-- read from textual .po source file (not fully correct, and redundant
+   #   because the original gettext/libintl doesn't support this at all)
+   function gettext___load_po($f, $domain) {
+      global $_GETTEXT;
+      $c_esc = array("\\n"=>"\n", "\\r"=>"\r", "\\\\"=>"\\", "\\f"=>"\f", "\\t"=>"\t", "\\"=>"");
+
+      #-- read line-wise from text file   
+      do {
+         $line = trim(fgets($f));
+
+         #-- check what's in the current line
+         $space = strpos($line, " ");
+         // comment
+         if ($line[0] == "#") {
+            //continue;
+         }
+         // msgid
+         elseif (strncmp($line, "msgid", 5)==0) {
+            $msgid[] = trim(substr($line, $space+1), '"');
+         }
+         // translation
+         elseif (strncmp($line, "msgstr", 6)==0) {
+            $msgstr[] = trim(substr($line, $space+1), '"');
+         }
+         // continued (could be _id or _str)
+         elseif ($line[0] == '"') {
+            $line = trim($line, '"');
+            if (isset($msggstr)) {
+               $msgstr[count($msgstr)] .= $line;
+            }
+            else {
+               $msgid[count($msgid)] .= $line;
+            }
+         }
+
+         #-- append to global $_GETTEXT hash as soon as we have a complete dataset
+         if (isset($msgid) && isset($msgstr) && (empty($line) || ($line[0]=="#") || feof($f)) )
+         {
+            $msgid[0] = strtr($msgid[0], $c_esc);
+            foreach ($msgstr as $v) {
+               $_GETTEXT[$domain][$msgid[0]] = strtr($v, $c_esc);
+            }
+            if ($msgid[1]) {
+               $msgid[1] = strtr($msgid[1], $c_esc);
+               $_GETTEXT[$domain][$msgid[1]] = &$_GETTEXT[$domain][$msgid[0]];
+            }
+
+            $msgid = array();
+            $msgstr = array();
+         }
+
+      } while (!feof($f));
+      fclose($f);
+   }
+
+
+   #-- ignored setting (no idea what it really should do)
+   function bind_textdomain_codeset($domain, $codeset) {
+      global $_GETTEXT;
+      $_GETTEXT[$domain]["%codeset"] = $codeset;
+      return($domain);
+   }
+
+
+}
+
+
+#-- define gettexts preferred function name _ separately
+if (!function_exists("_")) {
+   function _($str) {
+      return gettext($str);
+   }
+}
+
+
+
 ?>
\ No newline at end of file



From ximian at mail.berlios.de  Sun Jan 14 19:24:16 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sun, 14 Jan 2007 19:24:16 +0100
Subject: [ydf-devel] r2311 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701141824.l0EIOGYJ025670@sheep.berlios.de>

Author: ximian
Date: 2007-01-14 19:24:01 +0100 (Sun, 14 Jan 2007)
New Revision: 2311

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
 - FIXED getChildren.. include self was not working
 - OPTIMIZED getPath to use only one query form type

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-13 22:34:34 UTC (rev 2310)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-14 18:24:01 UTC (rev 2311)
@@ -323,7 +323,7 @@
 
             // get just children
 			if ( $includeSelf == false ) $this->where(       $this->__table_parent . ' = ' . intval( $id ) );
-			else                         $this->where( '(' . $this->__table_parent . ' = ' . intval( $id ) . ' OR ' . $this->__table_parent . ' = ' . intval( $id ) . ')' );
+			else                         $this->where( '(' . $this->__table_parent . ' = ' . intval( $id ) . ' OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
 
 			$this->findAll();
 
@@ -373,9 +373,12 @@
 			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
 			$nodes = array_map( 'intval', explode( '/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) );
 
-            if ( $includeSelf == false ) $this->where(       $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
-			else                         $this->where( '(' . $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ') OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
+			// if we want current node too, lets add it to nodes array
+            if ( $includeSelf == true ) $nodes[] = intval( $id );
 
+			// apply where clause
+			$this->where( $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
+
 			$this->findAll();
 
 			return $this->getResults( false, false, false, $prefix );



From pclaerhout at mail.berlios.de  Tue Jan 16 13:11:29 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 13:11:29 +0100
Subject: [ydf-devel] r2312 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200701161211.l0GCBTCn008755@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 13:11:28 +0100 (Tue, 16 Jan 2007)
New Revision: 2312

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
Log:
Added the option to remove the request information from bad behaviour.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-14 18:24:01 UTC (rev 2311)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-16 12:11:28 UTC (rev 2312)
@@ -968,29 +968,31 @@
         function getBadBehaviorRequestsCount() {
             $settings = bb2_read_settings();
             return $this->db->getValueByName(
-                "SELECT COUNT(*) AS COUNT FROM " . $settings['log_table'] . " WHERE `key` NOT LIKE '00000000'"
+                "SELECT COUNT(*) AS COUNT FROM #_bad_behavior WHERE `key` NOT LIKE '00000000'"
                 , 'count'
             );
         }
 
         // Get the bad behavior requests
         function getBadBehaviorRequests() {
-            $settings = bb2_read_settings();
-            return $this->db->getRecords( "SELECT * FROM " . $settings['log_table'] . " WHERE `key` NOT LIKE '00000000' ORDER BY DATE DESC" );
+            return $this->db->getRecords( "SELECT * FROM #_bad_behavior WHERE `key` NOT LIKE '00000000' ORDER BY DATE DESC" );
         }
 
         // Get the bad behavior request by it's id
         function getBadBehaviorRequestById( $id ) {
-            $settings = bb2_read_settings();
-            return $this->db->getRecord( "SELECT * FROM " . $settings['log_table'] . " WHERE id = " . $this->str( $id ) );
+            return $this->db->getRecord( "SELECT * FROM #_bad_behavior WHERE id = " . $this->str( $id ) );
         }
 
         // Get the bad behavior post requests
         function getBadBehaviorPostRequests() {
-            $settings = bb2_read_settings();
-            return $this->db->getRecords( "SELECT * FROM " . $settings['log_table'] . " WHERE request_method = 'POST' ORDER BY DATE DESC" );
+            return $this->db->getRecords( "SELECT * FROM #_bad_behavior WHERE request_method = 'POST' ORDER BY DATE DESC" );
         }
 
+        // Delete the bad behavior requests
+        function emptyBadBehaviour() {
+            $this->db->executeSql( 'DELETE FROM #_bad_behavior' );
+        }
+
         // Function to resize an uploaded image. Takes a YDFSImage object as it's argument
         function resizeUploadedImage( $image ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-14 18:24:01 UTC (rev 2311)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-16 12:11:28 UTC (rev 2312)
@@ -392,5 +392,7 @@
 $GLOBALS['t']['user_agent'] = 'User Agent';
 $GLOBALS['t']['request_entity'] = 'Request Entity';
 $GLOBALS['t']['key'] = 'Key';
+$GLOBALS['t']['confirm_empty_bb'] = 'Are you sure you want to delete all request information?';
+$GLOBALS['t']['empty_bb_now'] = 'Delete all request information now.';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-14 18:24:01 UTC (rev 2311)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-16 12:11:28 UTC (rev 2312)
@@ -392,5 +392,7 @@
 $GLOBALS['t']['user_agent'] = 'User Agent';
 $GLOBALS['t']['request_entity'] = 'Request Entiteit';
 $GLOBALS['t']['key'] = 'Code';
+$GLOBALS['t']['confirm_empty_bb'] = 'Bent u zeker dat u alle request informatie wil verwijderen?';
+$GLOBALS['t']['empty_bb_now'] = 'Verwijder nu alle request informatie.';
 
 ?>

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-14 18:24:01 UTC (rev 2311)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-16 12:11:28 UTC (rev 2312)
@@ -54,6 +54,12 @@
 
         }
 
+        // Empty the request information
+        function actionEmptyBadBehaviour() {
+            $this->weblog->emptyBadBehaviour();
+            $this->redirect( YD_SELF_SCRIPT );
+        }
+
     }
 
     // Process the request

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-14 18:24:01 UTC (rev 2311)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-16 12:11:28 UTC (rev 2312)
@@ -19,6 +19,10 @@
                         &raquo; {t w="post_requests"}
                     </th>
                 </tr>
+                <tr><td class="adminRowL" colspan="5">
+                    <i><a href="{$YD_SELF_SCRIPT}?do=emptyBadBehaviour"
+                     onClick="return confirm( '{t w="confirm_empty_bb"}' );">{t w="empty_bb_now"}</a></i>
+                </td></tr>
                 <tr>
                     <th class="adminRowL">{t w="date"}</th>
                     <th class="adminRowL">{t w="ip"}</th>



From pclaerhout at mail.berlios.de  Tue Jan 16 13:15:48 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 13:15:48 +0100
Subject: [ydf-devel] r2313 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200701161215.l0GCFmZm012142@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 13:15:48 +0100 (Tue, 16 Jan 2007)
New Revision: 2313

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
   YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
Log:
The post request info is now automatically deleted after 7 days.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-16 12:11:28 UTC (rev 2312)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-16 12:15:48 UTC (rev 2313)
@@ -142,10 +142,14 @@
                 $this->db->executeSql( $sql );
             }
 
-            // Cleanup the bad behaviour table
+            // Cleanup the bad behaviour table part 1
             $sql = 'DELETE FROM #_bad_behavior WHERE DATE_SUB( `date`, INTERVAL 1 day ) < DATE_SUB( CURDATE(), INTERVAL 1 day ) AND request_method = \'GET\' AND `key` = \'00000000\'';
             $this->db->executeSql( $sql );
 
+            // Cleanup the bad behaviour table part 2
+            $sql = 'DELETE FROM #_bad_behavior WHERE DATE_SUB( `date`, INTERVAL 7 day ) < DATE_SUB( CURDATE(), INTERVAL 7 day )';
+            $this->db->executeSql( $sql );
+
             // Check against akismet if a key is there
             if ( YDConfig::get( 'akismet_key', '' ) != '' ) {
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-16 12:11:28 UTC (rev 2312)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-16 12:15:48 UTC (rev 2313)
@@ -392,6 +392,7 @@
 $GLOBALS['t']['user_agent'] = 'User Agent';
 $GLOBALS['t']['request_entity'] = 'Request Entity';
 $GLOBALS['t']['key'] = 'Key';
+$GLOBALS['t']['bb_delete_desc'] = 'Request information automatically deleted after 7 days.';
 $GLOBALS['t']['confirm_empty_bb'] = 'Are you sure you want to delete all request information?';
 $GLOBALS['t']['empty_bb_now'] = 'Delete all request information now.';
 

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-16 12:11:28 UTC (rev 2312)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-16 12:15:48 UTC (rev 2313)
@@ -392,6 +392,7 @@
 $GLOBALS['t']['user_agent'] = 'User Agent';
 $GLOBALS['t']['request_entity'] = 'Request Entiteit';
 $GLOBALS['t']['key'] = 'Code';
+$GLOBALS['t']['bb_delete_desc'] = 'Request informatie wordt automatisch verwijderd na 7 dagen.';
 $GLOBALS['t']['confirm_empty_bb'] = 'Bent u zeker dat u alle request informatie wil verwijderen?';
 $GLOBALS['t']['empty_bb_now'] = 'Verwijder nu alle request informatie.';
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-16 12:11:28 UTC (rev 2312)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.tpl	2007-01-16 12:15:48 UTC (rev 2313)
@@ -20,7 +20,7 @@
                     </th>
                 </tr>
                 <tr><td class="adminRowL" colspan="5">
-                    <i><a href="{$YD_SELF_SCRIPT}?do=emptyBadBehaviour"
+                    <i>{t w="bb_delete_desc"} <a href="{$YD_SELF_SCRIPT}?do=emptyBadBehaviour"
                      onClick="return confirm( '{t w="confirm_empty_bb"}' );">{t w="empty_bb_now"}</a></i>
                 </td></tr>
                 <tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/comments.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2007-01-16 12:11:28 UTC (rev 2312)
+++ YDFramework2.0/trunk/examples/weblog/manage/comments.tpl	2007-01-16 12:15:48 UTC (rev 2313)
@@ -68,13 +68,6 @@
                         {if $comment.item_is_draft eq '1'}</i>{/if}
                     </td>
                     <td class="adminRowL">
-                        {*{if $comment.item_is_draft eq '1'}<i>{/if}
-                        <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.comment|bbcode|strip_tags|truncate}</a>
-                        {if $comment.item_title}
-                            <br/>
-                            {t w="item"}: {$comment.item_title}
-                        {/if}
-                        {if $comment.item_is_draft eq '1'}</i>{/if}*}
                         {if $comment.item_is_draft eq '1'}<i>{/if}
                         <a href="{$YD_SELF_SCRIPT}?do=edit&id={$comment.id}">{$comment.item_title}</a>
                         <br/>
@@ -107,7 +100,7 @@
             </tr>
         {else}
             <tr><td class="adminRowL" colspan="5">
-                <i>{t w="spam_delete_desc"}. <a href="{$YD_SELF_SCRIPT}?do=emptySpam"
+                <i>{t w="spam_delete_desc"} <a href="{$YD_SELF_SCRIPT}?do=emptySpam"
                  onClick="return confirm( '{t w="confirm_empty_spam"}' );">{t w="empty_spam_now"}</a></i>
             </td></tr>
             <tr>



From pclaerhout at mail.berlios.de  Tue Jan 16 13:46:49 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 13:46:49 +0100
Subject: [ydf-devel] r2314 - in YDFramework2.0/trunk/examples/weblog:
	include include/languages manage
Message-ID: <200701161246.l0GCknwa031115@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 13:46:48 +0100 (Tue, 16 Jan 2007)
New Revision: 2314

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
   YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
   YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
   YDFramework2.0/trunk/examples/weblog/manage/cache.php
   YDFramework2.0/trunk/examples/weblog/manage/config.php
   YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php
   YDFramework2.0/trunk/examples/weblog/manage/index.tpl
   YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
   YDFramework2.0/trunk/examples/weblog/manage/users.php
   YDFramework2.0/trunk/examples/weblog/manage/users.tpl
Log:
Added the concept of user levels (admin or not). The non admin users only get a subset of the admin interface.

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -206,7 +206,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 7;
+            $current_schema = 8;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -227,10 +227,14 @@
                 $this->executeIfPresent( 'allow_comments', $fields, 'ALTER TABLE #_items DROP allow_comments' );
                 $this->executeIfPresent( 'auto_close', $fields, 'ALTER TABLE #_items DROP auto_close' );
 
-                // Add any missing pages field
+                // Add any missing pages fields
                 $fields = $this->dbmeta->getFields( '#_pages' );
                 $this->executeIfMissing( 'is_draft', $fields, 'ALTER TABLE #_pages ADD is_draft TINYINT(1) DEFAULT "0" NOT NULL AFTER body' );
 
+                // Add any missing users fields
+                $fields = $this->dbmeta->getFields( '#_users' );
+                $this->executeIfMissing( 'is_admin', $fields, 'ALTER TABLE #_users ADD is_admin TINYINT(1) DEFAULT "1" NOT NULL AFTER password' );
+
                 // Get the list of indexes for the items table
                 $indexes = $this->dbmeta->getIndexes( '#_items' );
                 $this->executeIfMissing( 'is_draft', $indexes, 'ALTER TABLE #_items ADD INDEX is_draft (is_draft)' );
@@ -243,6 +247,7 @@
                 $indexes = $this->dbmeta->getIndexes( '#_users' );
                 $this->executeIfPresent( 'email', $indexes, 'ALTER TABLE #_users DROP INDEX email' );
                 $this->executeIfMissing( 'name',  $indexes, 'ALTER TABLE #_users ADD UNIQUE name (name)' );
+                $this->executeIfMissing( 'is_admin',  $indexes, 'ALTER TABLE #_users ADD INDEX is_admin (is_admin)' );
 
                 // Fix the shemaversion table if needed
                 $this->db->executeSql( 'ALTER TABLE #_schemaversion CHANGE installed installed INT(11)' );

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogRequest.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -234,7 +234,7 @@
     class YDWeblogAdminRequest extends YDWeblogRequest {
 
         // Class constructor
-        function YDWeblogAdminRequest() {
+        function YDWeblogAdminRequest( $req_admin=false ) {
 
             // Initialize the parent
             $this->YDWeblogRequest();
@@ -258,6 +258,9 @@
                 $this->weblog->db->executeSql( 'optimize table ' . $table );
             }
 
+            // Check for admin access
+            $this->req_admin = $req_admin;
+
         }
 
         // Init the template
@@ -389,6 +392,16 @@
             return false;
         }
 
+        // Function when authentication has succeeded
+        function authenticationSucceeded() {
+
+            // Check if allowed
+            if ( $this->req_admin === true && $this->user['is_admin'] != '1' ) {
+                $this->redirect( 'index.php' );
+            }
+
+        }
+
         // Failed authentication, forwards to the login action
         function authenticationFailed() {
             $this->forward( 'login' );

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_en.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -215,6 +215,7 @@
 $GLOBALS['t']['req_loginpass'] = 'Password is required';
 $GLOBALS['t']['user_dup'] = 'User already exists';
 $GLOBALS['t']['change_user_desc'] = 'Changing user:';
+$GLOBALS['t']['is_admin_user'] = 'Administrator';
 
 // manage/images.tpl
 $GLOBALS['t']['upload_image'] = 'Upload image';

Modified: YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/include/languages/language_nl.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -215,6 +215,7 @@
 $GLOBALS['t']['req_loginpass'] = 'Paswoord is vereist';
 $GLOBALS['t']['user_dup'] = 'Gebruiker bestaat al';
 $GLOBALS['t']['change_user_desc'] = 'Wijzig gebruiker:';
+$GLOBALS['t']['is_admin_user'] = 'Administrator';
 
 // manage/images.tpl
 $GLOBALS['t']['upload_image'] = 'Upload beeld';

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2007-01-16 12:46:48 UTC (rev 2314)
@@ -123,26 +123,28 @@
                         &raquo; <a href="categories.php">{t w="a_categories"}</a><br/>
                     </td>
                 </tr>
-                <tr>
-                    <td class="adminRowL">
-                        <b>{t w="h_global_settings"}</b><br/>
-                        &raquo; <a href="users.php">{t w="a_users"}</a><br/>
-                        &raquo; <a href="config.php">{t w="a_settings"}</a><br/>
-                    </td>
-                </tr>
-                <tr>
-                    <td class="adminRowL">
-                        <b>{t w="h_diagtools"}</b><br/>
-                        &raquo; <a href="serverinfo.php">{t w="a_server_info"}</a><br/>
-                        &raquo; <a href="dbbackup.php">{t w="a_db_backup"}</a><br/>
-                        &raquo; <a href="cache.php">{t w="a_cleanup_cache"}</a><br/>
-                    </td>
-                </tr>
-                {if $google_analytics}
+                {if $user.is_admin}
                     <tr>
                         <td class="adminRowL">
+                            <b>{t w="h_global_settings"}</b><br/>
+                            &raquo; <a href="users.php">{t w="a_users"}</a><br/>
+                            &raquo; <a href="config.php">{t w="a_settings"}</a><br/>
+                        </td>
+                    </tr>
+                    <tr>
+                        <td class="adminRowL">
+                            <b>{t w="h_diagtools"}</b><br/>
+                            &raquo; <a href="serverinfo.php">{t w="a_server_info"}</a><br/>
+                            &raquo; <a href="dbbackup.php">{t w="a_db_backup"}</a><br/>
+                            &raquo; <a href="cache.php">{t w="a_cleanup_cache"}</a><br/>
+                        </td>
+                    </tr>
+                    <tr>
+                        <td class="adminRowL">
                             <b>{t w="h_statistics"}</b><br/>
-                            &raquo; <a href="https://www.google.com/analytics/home/" target="_blank">{t w="cfg_google_analytics"}</a><br/>
+                            {if $google_analytics}
+                                &raquo; <a href="https://www.google.com/analytics/home/" target="_blank">{t w="cfg_google_analytics"}</a><br/>
+                            {/if}
                             &raquo; <a href="bad_behavior.php">{t w="a_bad_behavior"}</a><br/>
                         </td>
                     </tr>

Modified: YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/bad_behavior.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -8,7 +8,10 @@
 
         // Class constructor
         function bad_behavior() {
-            $this->YDWeblogAdminRequest();
+
+            // Initialize parent
+            $this->YDWeblogAdminRequest( true );
+
         }
 
         // Default action

Modified: YDFramework2.0/trunk/examples/weblog/manage/cache.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/cache.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/cache.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -8,7 +8,10 @@
 
         // Class constructor
         function cache() {
-            $this->YDWeblogAdminRequest();
+
+            // Initialize parent
+            $this->YDWeblogAdminRequest( true );
+
         }
 
         // Default action

Modified: YDFramework2.0/trunk/examples/weblog/manage/config.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/config.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/config.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -13,7 +13,7 @@
         function config() {
 
             // Initialize the parent
-            $this->YDWeblogAdminRequest();
+            $this->YDWeblogAdminRequest( true );
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/dbbackup.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -13,7 +13,7 @@
         function dbbackup() {
 
             // Initialize the parent
-            $this->YDWeblogAdminRequest();
+            $this->YDWeblogAdminRequest( true );
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/index.tpl	2007-01-16 12:46:48 UTC (rev 2314)
@@ -55,41 +55,43 @@
     </table>
 {/if}
 
-<p class="title">&nbsp;<br/>{t w="a_admin_home"} &raquo; {t w="overview"}</p>
+{if $user.is_admin}
+    <p class="title">&nbsp;<br/>{t w="a_admin_home"} &raquo; {t w="overview"}</p>
 
-<table width="700" cellspacing="0" cellpadding="0" border="0">
-<tr><td width="350" align="left" valign="top">
+    <table width="700" cellspacing="0" cellpadding="0" border="0">
+    <tr><td width="350" align="left" valign="top">
 
-    <table width="340" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowLG">&raquo; <a href="serverinfo.php"><b>{t w="a_server_info"}</b></a></th>
-            <th class="adminRowLGR" colspan="2"><a href="serverinfo.php"><img src="images/more_details.gif" border="0" /></a></th>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL" width="300">{t w="username"}</td>
-            <td class="adminRowL" width="400" colspan="2">{$user.name|lower}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="server"}</td>
-            <td class="adminRowL" colspan="2">{$smarty.server.SERVER_NAME}{if $smarty.server.SERVER_PORT != '80'}:{$smarty.server.SERVER_PORT}{/if}</td>
-        </tr>
+        <table width="340" cellspacing="0" cellpadding="0" border="0">
+            <tr>
+                <th class="adminRowLG">&raquo; <a href="serverinfo.php"><b>{t w="a_server_info"}</b></a></th>
+                <th class="adminRowLGR" colspan="2"><a href="serverinfo.php"><img src="images/more_details.gif" border="0" /></a></th>
+            </tr>
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+                <td class="adminRowL" width="300">{t w="username"}</td>
+                <td class="adminRowL" width="400" colspan="2">{$user.name|lower}</td>
+            </tr>
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+                <td class="adminRowL">{t w="server"}</td>
+                <td class="adminRowL" colspan="2">{$smarty.server.SERVER_NAME}{if $smarty.server.SERVER_PORT != '80'}:{$smarty.server.SERVER_PORT}{/if}</td>
+            </tr>
+        </table>
+    </td>
+    <td width="350" align="right" valign="top">
+        <table width="340" cellspacing="0" cellpadding="0" border="0">
+            <tr>
+                <th class="adminRowLG" colspan="3">&raquo; {t w="a_statistics"}</th>
+            </tr>
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+                <td class="adminRowL">{t w="totalItems"}</td>
+                <td class="adminRowL" colspan="2">{$totalItems} {t w="items"}</td>
+            </tr>
+            <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
+                <td class="adminRowL">{t w="totalComments"}</td>
+                <td class="adminRowL" colspan="2">{$totalComments} {t w="comments" lower=true}</td>
+            </tr>
+        </table>
+    </td></tr>
     </table>
-</td>
-<td width="350" align="right" valign="top">
-    <table width="340" cellspacing="0" cellpadding="0" border="0">
-        <tr>
-            <th class="adminRowLG" colspan="3">&raquo; {t w="a_statistics"}</th>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="totalItems"}</td>
-            <td class="adminRowL" colspan="2">{$totalItems} {t w="items"}</td>
-        </tr>
-        <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
-            <td class="adminRowL">{t w="totalComments"}</td>
-            <td class="adminRowL" colspan="2">{$totalComments} {t w="comments" lower=true}</td>
-        </tr>
-    </table>
-</td></tr>
-</table>
+{/if}
 
 {include file="__mng_footer.tpl"}

Modified: YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/serverinfo.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -13,7 +13,7 @@
         function serverinfo() {
 
             // Initialize the parent
-            $this->YDWeblogAdminRequest();
+            $this->YDWeblogAdminRequest( true );
 
         }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/users.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/users.php	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/users.php	2007-01-16 12:46:48 UTC (rev 2314)
@@ -10,7 +10,7 @@
         function users() {
 
             // Initialize the parent
-            $this->YDWeblogAdminRequest();
+            $this->YDWeblogAdminRequest( true );
 
         }
 
@@ -118,6 +118,31 @@
 
         }
 
+        // Change the user level
+        function actionChangeUserLevel() {
+
+            // Get the ID from the query string
+            $id = $this->getIdFromQS();
+
+            // Get the user details
+            $user = $this->weblog->getUserByID( $id );
+            unset( $user['password'] );
+
+            // Redirect if we are changing ourselves
+            if ( $this->user['id'] == $user['id'] ) {
+                $this->redirectToAction();
+            }
+
+            // Change the values
+            $user['is_admin'] = ( $user['is_admin'] == '1' ) ? '0' : '1';
+
+            // Save the userdata
+            $this->weblog->saveUser( $user );
+
+            // Redirect to the default action
+            $this->redirectToAction();
+
+
         // Check the user credentials
         function checkUserCredentials( $params ) {
 
@@ -132,6 +157,7 @@
             }
 
         }
+        }
 
     }
 

Modified: YDFramework2.0/trunk/examples/weblog/manage/users.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/users.tpl	2007-01-16 12:15:48 UTC (rev 2313)
+++ YDFramework2.0/trunk/examples/weblog/manage/users.tpl	2007-01-16 12:46:48 UTC (rev 2314)
@@ -30,15 +30,29 @@
     {if $users}
         <tr>
             <th class="adminRowL" width="20%" style="vertical-align: bottom;">{t w="username"}</th>
-            <th class="adminRowL" width="30%" style="vertical-align: bottom;">{t w="useremail"}</th>
-            <th class="adminRowL" width="25%" style="vertical-align: bottom;">{t w="created"}</th>
+            <th class="adminRowL" width="35%" style="vertical-align: bottom;">{t w="useremail"}</th>
+            <th class="adminRowL" width="20%" style="vertical-align: bottom;">{t w="is_admin_user"}</th>
             <th class="adminRowR" width="25%" style="vertical-align: bottom;">{t w="actions"}</th>
         </tr>
         {foreach from=$users item="usr"}
             <tr onMouseOver="YDRowMouseOver(this);" onMouseOut="YDRowMouseOut(this);">
                 <td class="adminRowL">{$usr.name}</td>
                 <td class="adminRowL"><a href="mailto:{$usr.email}">{$usr.email}</a>&nbsp;</td>
-                <td class="adminRowL">{$usr.created|date|lower}</td>
+                <td class="adminRowL">
+                    {if strtolower( $usr.name ) neq strtolower( $user.name )}
+                        {if $usr.is_admin}
+                            <a style="color: green;" href="{$YD_SELF_SCRIPT}?do=changeUserLevel&id={$usr.id}">{t w="yes"}</a>
+                        {else}
+                            <a style="color: red;" href="{$YD_SELF_SCRIPT}?do=changeUserLevel&id={$usr.id}">{t w="no"}</a>
+                        {/if}
+                    {else}
+                        {if $usr.is_admin}
+                            <span class="disabled">{t w="yes"}</span>
+                        {else}
+                            <span class="disabled">{t w="no"}</span>
+                        {/if}
+                    {/if}
+                </td>
                 <td class="adminRowR">
                     <a href="{$YD_SELF_SCRIPT}?do=edit&id={$usr.id}">{t w="edit"}</a>
                     |



From pclaerhout at mail.berlios.de  Tue Jan 16 13:58:25 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 13:58:25 +0100
Subject: [ydf-devel] r2315 - YDFramework2.0/trunk/doc_src
Message-ID: <200701161258.l0GCwPhk032445@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 13:58:25 +0100 (Tue, 16 Jan 2007)
New Revision: 2315

Modified:
   YDFramework2.0/trunk/doc_src/changelog.xml
Log:
Updated the changelog.

Modified: YDFramework2.0/trunk/doc_src/changelog.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/changelog.xml	2007-01-16 12:46:48 UTC (rev 2314)
+++ YDFramework2.0/trunk/doc_src/changelog.xml	2007-01-16 12:58:25 UTC (rev 2315)
@@ -5,6 +5,15 @@
 
     <para>This is the overview of the different releases.</para>
 
+    <sect1 id="changelog_ydf_v2_2_final">
+
+        <title>Yellow Duck Framework 2.1 Final</title>
+
+        <para>Released on: 16 january 2007</para>
+        <para>Build number: 2316</para>
+
+    </sect1>
+
     <sect1 id="changelog_ydf_v2_0_final">
 
         <title>Yellow Duck Framework 2.0 Final</title>



From pclaerhout at mail.berlios.de  Tue Jan 16 13:59:08 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 13:59:08 +0100
Subject: [ydf-devel] r2316 - YDFramework2.0/tags
Message-ID: <200701161259.l0GCx8vt032755@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 13:59:08 +0100 (Tue, 16 Jan 2007)
New Revision: 2316

Added:
   YDFramework2.0/tags/2.1.0-final/
Log:
Released version 2.1.0 final.

Copied: YDFramework2.0/tags/2.1.0-final (from rev 2315, YDFramework2.0/trunk)



From pieter at yellowduck.be  Tue Jan 16 14:29:32 2007
From: pieter at yellowduck.be (Pieter Claerhout)
Date: Tue, 16 Jan 2007 14:29:32 +0100
Subject: [ydf-devel] Yellow Duck Framework 2.1 released
Message-ID: <4aef63030701160529w77439ecj5743a8bf363f57f4@mail.gmail.com>

Hi all,

after a long period of time, I decided to release Yellow Duck Framework and
Yellow Duck Weblog version 2.1 final.

Downloads are on:
http://developer.berlios.de/project/showfiles.php?group_id=3988

Cheers,


pieter

-- 
pieter claerhout . pieter at yellowduck.be . http://www.yellowduck.be/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20070116/929c4e5f/attachment.html>

From pclaerhout at mail.berlios.de  Tue Jan 16 21:09:54 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 21:09:54 +0100
Subject: [ydf-devel] r2317 - in YDFramework2.0/trunk: . YDFramework2
	YDFramework2/YDClasses YDFramework2/YDClasses/YDDatabaseDrivers
	YDFramework2/YDClasses/YDFormElements
	YDFramework2/YDClasses/YDFormRenderers
	YDFramework2/addons/YDAjax YDFramework2/addons/YDAjax/editors
	YDFramework2/addons/YDAkismet YDFramework2/addons/YDBBCode
	YDFramework2/addons/YDCMComponent
	YDFramework2/addons/YDCaptcha YDFramework2/addons/YDCart
	YDFramework2/addons/YDDatabaseObject
	YDFramework2/addons/YDDatabaseQuery
	YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers
	YDFramework2/addons/YDFeedCreator YDFramework2/addons/YDGraph
	YDFramework2/addons/YDGraphPie YDFramework2/addons/YDInstaller
	YDFramework2/addons/YDLoadconfig YDFramework2/addons/YDMysqlDump
	YDFramework2/addons/YDPdfReport doc doc_src examples/database
	examples/forum examples/weblog
Message-ID: <200701162009.l0GK9spT017219@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 21:09:38 +0100 (Tue, 16 Jan 2007)
New Revision: 2317

Added:
   YDFramework2.0/trunk/doc/build_api.sh
   YDFramework2.0/trunk/doc_src/build_html.sh
   YDFramework2.0/trunk/doc_src/build_pdf.sh
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
   YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php
   YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php
   YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
   YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php
   YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
   YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
   YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php
   YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/html2pdf.php
   YDFramework2.0/trunk/_default.htaccess
   YDFramework2.0/trunk/doc/docs_api.dxy
   YDFramework2.0/trunk/doc/docs_api_footer.html
   YDFramework2.0/trunk/doc/index.html
   YDFramework2.0/trunk/doc_src/_ydframework.xml
   YDFramework2.0/trunk/doc_src/build_html.bat
   YDFramework2.0/trunk/doc_src/build_pdf.bat
   YDFramework2.0/trunk/doc_src/fixfo.vbs
   YDFramework2.0/trunk/doc_src/installing.xml
   YDFramework2.0/trunk/examples/database/.htaccess
   YDFramework2.0/trunk/examples/forum/.htaccess
   YDFramework2.0/trunk/examples/weblog/.htaccess
   YDFramework2.0/trunk/index.php
Log:
Updated the copyrights and version notices (forgot to do that for 2.1.0-final). Will fix it in a 2.1.1-final).

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public
@@ -26,7 +26,7 @@
      *	The Yellow Duck Framework is web application framework created by Pieter Claerhout. More information can be
      *	found on http://ydframework.berlios.de/.
      *
-     *	(c) Copyright 2002-2005 Pieter Claerhout
+     *	(c) Copyright 2002-2007 Pieter Claerhout
      *
      *	Webpage: http://ydframework.berlios.de/
      *

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/editors/YDAjaxEditor.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public
@@ -45,7 +45,7 @@
             // Setup the module
             $this->_author = 'Pieter Claerhout';
             $this->_version = '1.0';
-            $this->_copyright = '(c) Copyright 2002-2005 Pieter Claerhout';
+            $this->_copyright = '(c) Copyright 2002-2007 Pieter Claerhout';
             $this->_description = 'This class is an interface to the Akismet comment spam checking webservice.';
 
             // Set the variables

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public
@@ -50,7 +50,7 @@
             // Setup the module
             $this->_author = 'Pieter Claerhout';
             $this->_version = '1.0';
-            $this->_copyright = '(c) Copyright 2002-2005 Pieter Claerhout';
+            $this->_copyright = '(c) Copyright 2002-2007 Pieter Claerhout';
             $this->_description = 'This class implements a BBCode parser. By default, it supports a number of standard '
                                . 'codes that can be implemented. The following codes are supported by default: img, '
                                . 'url, mail, email, color, b, i, u, code, quote, p, size';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
  
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public
@@ -49,7 +49,7 @@
             // Setup the module
             $this->_author = 'Pieter Claerhout';
             $this->_version = '1.0';
-            $this->_copyright = '(c) 2005 Pieter Claerhout, pieter at yellowduck.be';
+            $this->_copyright = '(c) 2002-2007 Pieter Claerhout, pieter at yellowduck.be';
             $this->_description = 'This addon class defines a RSS/ATOM feed. You can use this class to create RSS and '
                                . 'Atom feeds in a very easy and straightforward way. If you set up your class instance, '
                                . 'you can automatically output to the different versions of RSS and ATOM with the same '

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This program is free software; you can redistribute it and/or
         modify it under the terms of the GNU General Public License
@@ -140,8 +140,10 @@
          *                 A float value between 0 and 1. 
          *                 Default: 0.1
          */
-        function setPadding( $value = 0.1 ){
-            $this->up_padding = $value;
+        function setPadding( $value = 0.1 ){
+
+            $this->up_padding = $value;
+
         }
 
         /**
@@ -549,10 +551,13 @@
 
             // plot graph
             foreach($this->m_series as $series){
-                
-                $cnt = count($series->m_values);
-                if ($cnt == 0) continue;
                 
+
+                $cnt = count($series->m_values);
+
+                if ($cnt == 0) continue;
+
+                
                 // LINE PLOT
                 if($series->m_type == 'line'){
                     $this->_set_style($this->m_image,$series->m_style,$series->m_strokeColor, $this->m_fillColor);

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This program is free software; you can redistribute it and/or
         modify it under the terms of the GNU General Public License
@@ -32,15 +32,20 @@
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
-    }
+    }
+
     
     include_once( YD_DIR_HOME_ADD .'/YDGraph/YDGraph.php' );
-    
+    
+
     /**
      * This class implements an addon module that is able to draw pie graphs using the GD library.
-     */
-    class YDGraphPie extends YDAddOnModule {
-        
+     */
+
+    class YDGraphPie extends YDAddOnModule {
+
+        
+
         /**
          *  This is the class constructor for the YDGraphPie class.
          *
@@ -48,30 +53,42 @@
          *  @param  $height             (optional) the height of the graph in pixels
          *  @param  $margin             (optional) the margin to keep around the graph
          *  @param  $backgroundColor    (optional) the background color for the graph
-         */
-        function YDGraphPie( $width=400, $height=300, $margin=7, $backgroundColor='#ffffff' ) {
-            
+         */
+
+        function YDGraphPie( $width=400, $height=300, $margin=7, $backgroundColor='#ffffff' ) {
+
+            
+
             // Initialize the parent class
-            $this->YDAddOnModule();
-            
+            $this->YDAddOnModule();
+
+            
+
             // Setup the module
             $this->_author = "David Bittencourt";
             $this->_version = "1.3";
             $this->_copyright = "(c) 2005 David Bittencourt, muitocomplicado at hotmail.com";
-            $this->_description = "This class implements a pie chart rendering utility";
-            
+            $this->_description = "This class implements a pie chart rendering utility";
+
+            
+
             // Setup the defaults
             $this->m_title = "";
             $this->m_width = $width;
             $this->m_height = $height;
             $this->m_image = imagecreate ($this->m_width, $this->m_height);
             $this->m_margin = $margin;
-            $vBackColor = YDGraph::_decode_color($backgroundColor);
-            $this->m_backgroundColor = imagecolorallocate ($this->m_image, $vBackColor[0], $vBackColor[1], $vBackColor[2]);
-            
+            $vBackColor = YDGraph::_decode_color($backgroundColor);
+
+            $this->m_backgroundColor = imagecolorallocate ($this->m_image, $vBackColor[0], $vBackColor[1], $vBackColor[2]);
+
+            
+
             $this->m_strokeColor = imagecolorallocate ($this->m_image, $vBackColor[0], $vBackColor[1], $vBackColor[2]);
-            $this->m_fillColor = $this->m_backgroundColor;
-            
+            $this->m_fillColor = $this->m_backgroundColor;
+
+            
+
             $this->m_numberOfDecimals = 0;
             $this->m_thousandsSeparator = ',';
             $this->m_decimalSeparator = '.';
@@ -79,35 +96,54 @@
             $this->m_showtotal   = false;
             $this->m_total       = null;
             $this->m_formattotal = true;
-            $this->m_totalstring = 'Total: ';
-            
-        }
-        
+            $this->m_totalstring = 'Total: ';
+
+            
+
+        }
+
+        
+
         /**
-         *  This function creates the graph and either sends it to the browser
+         *  This function creates the graph and either sends it to the browser
+
          *  of saves it to a file.
          *
-         *  @param  $file   (optional) If specified, the graph will be saved to
-         *                  the indicated file. If left as default, the graph
+         *  @param  $file   (optional) If specified, the graph will be saved to
+
+         *                  the indicated file. If left as default, the graph
+
          *                  will be outputted to the browser.
-         */
-        function plot( $file='' ) {
-            
+         */
+
+        function plot( $file='' ) {
+
+            
+
             // margins
             $margin=$this->m_margin;
             $marginy = $margin;
-            $marginx = $margin+5;
-            
+            $marginx = $margin+5;
+
+            
+
             if($this->m_title){
                 $marginy += $this->m_fontHeight*1.5;
-            }
+            }
+
             
-            $marginbottom = $margin+5;
-            $height = $this->m_height - $marginy - $marginbottom;
-            $width = $this->m_width - $marginx - $margin;
-            
-            imagefilledrectangle($this->m_image, $marginx, $marginy, $marginx + $width, $marginy+$height , $this->m_fillColor);
-            
+            $marginbottom = $margin+5;
+
+            $height = $this->m_height - $marginy - $marginbottom;
+
+            $width = $this->m_width - $marginx - $margin;
+
+            
+
+            imagefilledrectangle($this->m_image, $marginx, $marginy, $marginx + $width, $marginy+$height , $this->m_fillColor);
+
+            
+
             // plot title
             if($this->m_title){
                 imagestring ($this->m_image,
@@ -116,116 +152,223 @@
                         $margin,
                         $this->m_title,
                         $this->m_textColor);
-            }
-            
-            YDGraph::_set_style( $this->m_image, SOLID, $this->m_strokeColor, $this->m_fillColor );
-            
-            $sum = array_sum( $this->m_values );
-                    
-            $colors = array( '#CC3232', '#70DBDB', '#66CD00', '#FF4040', '#8A2BE2', '#5F9F9F', '#EED2EE', '#E9967A', '#6666FF', '#A2C257', '#EEB4B4', '#8F5E99', '#EEC900',  '#EE799F', '#B2DFEE', '#70DB93', '#F4A460', '#AAAAFF',     '#CC3232', '#70DBDB', '#66CD00', '#FF4040', '#8A2BE2', '#5F9F9F', '#EED2EE', '#E9967A', '#6666FF', '#A2C257', '#EEB4B4', '#8F5E99', '#EEC900',  '#EE799F', '#B2DFEE', '#70DB93', '#F4A460', '#AAAAFF' );
-            
-            // pieces
-            $degrees = array();
-            for($i=0; $i<count( $this->m_values); $i++){
-                $value = ( $this->m_values[$i]/$sum ) * 360;
-                if( $value > 0 && floor( ( $value/360 ) * 100 ) > 0 ) {
-                    $degrees[$i] = $value;
-                }
-            }
-            
-            // sizes
-            $diamx = $width/2;
-            $diamy = $height;
-            
-            if ( $diamx > $diamy ) {
-                $diam = $diamy;
-            } else {
-                $diam = $diamx;
-            }
-            $radius = $diam/2;
-            
-            $x = $marginx + $radius;
-            $y = $marginy + $radius;
-            
-            imagearc( $this->m_image, $x, $y, $diam, $diam, 0, 360, $this->m_strokeColor );
-            
-            // lines
-            $last_angle = 0;
-            foreach ( $degrees as $i => $deg ) {
-                
-                $last_angle = $last_angle+$deg;
-                $end_x = floor($x + ($radius * cos($last_angle*pi()/180)));
-                $end_y = floor($y + ($radius * sin($last_angle*pi()/180)));
-                
-                imageline( $this->m_image, $x, $y, $end_x, $end_y, $this->m_strokeColor );
+            }
+
+            
+
+            YDGraph::_set_style( $this->m_image, SOLID, $this->m_strokeColor, $this->m_fillColor );
+
+            
+
+            $sum = array_sum( $this->m_values );
+
+                    
+
+            $colors = array( '#CC3232', '#70DBDB', '#66CD00', '#FF4040', '#8A2BE2', '#5F9F9F', '#EED2EE', '#E9967A', '#6666FF', '#A2C257', '#EEB4B4', '#8F5E99', '#EEC900',  '#EE799F', '#B2DFEE', '#70DB93', '#F4A460', '#AAAAFF',     '#CC3232', '#70DBDB', '#66CD00', '#FF4040', '#8A2BE2', '#5F9F9F', '#EED2EE', '#E9967A', '#6666FF', '#A2C257', '#EEB4B4', '#8F5E99', '#EEC900',  '#EE799F', '#B2DFEE', '#70DB93', '#F4A460', '#AAAAFF' );
+
+            
+
+            // pieces
+
+            $degrees = array();
+
+            for($i=0; $i<count( $this->m_values); $i++){
+
+                $value = ( $this->m_values[$i]/$sum ) * 360;
+
+                if( $value > 0 && floor( ( $value/360 ) * 100 ) > 0 ) {
+
+                    $degrees[$i] = $value;
+
+                }
+
+            }
+
+            
+
+            // sizes
+
+            $diamx = $width/2;
+
+            $diamy = $height;
+
+            
+
+            if ( $diamx > $diamy ) {
+
+                $diam = $diamy;
+
+            } else {
+
+                $diam = $diamx;
+
+            }
+
+            $radius = $diam/2;
+
+            
+
+            $x = $marginx + $radius;
+
+            $y = $marginy + $radius;
+
+            
+
+            imagearc( $this->m_image, $x, $y, $diam, $diam, 0, 360, $this->m_strokeColor );
+
+            
+
+            // lines
+
+            $last_angle = 0;
+
+            foreach ( $degrees as $i => $deg ) {
+
                 
-            }
-            // colors
-            $last_angle =0;
-            $pointer = 0;
-            $max_len = 0;
-            foreach ( $degrees as $i => $deg ) {
-                
-                $pointer = $last_angle + $deg;
-                $this_angle = ($last_angle + $pointer) / 2;
-                $last_angle = $pointer;
-                
-                $end_x = floor($x + ($radius * cos($this_angle*pi()/180)));
-                $end_y = floor($y + ($radius * sin($this_angle*pi()/180)));
-                
-                $mid_x = floor(($x+($end_x))/2);
-                $mid_y = floor(($y+($end_y))/2);
-                
-                $hex_split = YDGraph::_decode_color( $colors[$i] );
-                if ( isset( $this->m_colors[$i] ) ) {
-                    $hex_split = YDGraph::_decode_color( $this->m_colors[$i] );
-                }
-                $piece_color = imagecolorallocate( $this->m_image, $hex_split[0],$hex_split[1],$hex_split[2]);
-                imagefilltoborder( $this->m_image, $mid_x, $mid_y, $this->m_strokeColor, $piece_color );
-                
-                $percent = number_format( ( $deg/360 ) * 100, $this->m_numberOfDecimals, $this->m_decimalSeparator, $this->m_thousandsSeparator );
-                $max_len = strlen( $percent ) > $max_len ? strlen( $percent ) : $max_len;
-                
-            }
-            
-            // labels
-            $last_position = $marginy;
-            foreach ( $degrees as $i => $deg ) {
-                
-                $percent = number_format( ( $deg/360 ) * 100, $this->m_numberOfDecimals, $this->m_decimalSeparator, $this->m_thousandsSeparator );
-                
-                $align = 0;
-                switch ( $this->m_labelsFont ) {
-                    case 1: $align = 1; break;
-                    case 2: $align = -1; break;
-                    case 3:
-                    case 4: $align = -2; break;
-                    case 5:
-                    case 6:
-                    case 7:
-                    case 8: $align = -3; break;
-                }
-                
-                if ( $this->m_labelsFontHeight + 3 >= 15 ) {
-                    $last_position += $this->m_labelsFontHeight + 3;
-                } else {
-                    $last_position += 15;
-                }
-                
-                $hex_split = YDGraph::_decode_color( $colors[$i] );
-                if ( isset( $this->m_colors[$i] ) ) {
-                    $hex_split = YDGraph::_decode_color( $this->m_colors[$i] );
-                }
-                $piece_color = imagecolorallocate( $this->m_image, $hex_split[0],$hex_split[1],$hex_split[2]);
-                
-                $w = $x+$radius;
-                $h = $last_position;
-                
-                imagefilledrectangle( $this->m_image, $w+20, $h, $w+30, $h+10, $piece_color );
-                imagestring( $this->m_image, $this->m_labelsFont, $w+40, $h+$align, str_repeat( ' ', ( $max_len - strlen( $percent ) ) ) . $percent . "% " . $this->m_labels[$i], $this->m_labelsTextColor );
-                
+
+                $last_angle = $last_angle+$deg;
+
+                $end_x = floor($x + ($radius * cos($last_angle*pi()/180)));
+
+                $end_y = floor($y + ($radius * sin($last_angle*pi()/180)));
+
+                
+
+                imageline( $this->m_image, $x, $y, $end_x, $end_y, $this->m_strokeColor );
+
+                
             }
 
+            // colors
+
+            $last_angle =0;
+
+            $pointer = 0;
+
+            $max_len = 0;
+
+            foreach ( $degrees as $i => $deg ) {
+
+                
+
+                $pointer = $last_angle + $deg;
+
+                $this_angle = ($last_angle + $pointer) / 2;
+
+                $last_angle = $pointer;
+
+                
+
+                $end_x = floor($x + ($radius * cos($this_angle*pi()/180)));
+
+                $end_y = floor($y + ($radius * sin($this_angle*pi()/180)));
+
+                
+
+                $mid_x = floor(($x+($end_x))/2);
+
+                $mid_y = floor(($y+($end_y))/2);
+
+                
+
+                $hex_split = YDGraph::_decode_color( $colors[$i] );
+
+                if ( isset( $this->m_colors[$i] ) ) {
+
+                    $hex_split = YDGraph::_decode_color( $this->m_colors[$i] );
+
+                }
+
+                $piece_color = imagecolorallocate( $this->m_image, $hex_split[0],$hex_split[1],$hex_split[2]);
+
+                imagefilltoborder( $this->m_image, $mid_x, $mid_y, $this->m_strokeColor, $piece_color );
+
+                
+
+                $percent = number_format( ( $deg/360 ) * 100, $this->m_numberOfDecimals, $this->m_decimalSeparator, $this->m_thousandsSeparator );
+
+                $max_len = strlen( $percent ) > $max_len ? strlen( $percent ) : $max_len;
+
+                
+
+            }
+
+            
+
+            // labels
+
+            $last_position = $marginy;
+
+            foreach ( $degrees as $i => $deg ) {
+
+                
+
+                $percent = number_format( ( $deg/360 ) * 100, $this->m_numberOfDecimals, $this->m_decimalSeparator, $this->m_thousandsSeparator );
+
+                
+
+                $align = 0;
+
+                switch ( $this->m_labelsFont ) {
+
+                    case 1: $align = 1; break;
+
+                    case 2: $align = -1; break;
+
+                    case 3:
+
+                    case 4: $align = -2; break;
+
+                    case 5:
+
+                    case 6:
+
+                    case 7:
+
+                    case 8: $align = -3; break;
+
+                }
+
+                
+
+                if ( $this->m_labelsFontHeight + 3 >= 15 ) {
+
+                    $last_position += $this->m_labelsFontHeight + 3;
+
+                } else {
+
+                    $last_position += 15;
+
+                }
+
+                
+
+                $hex_split = YDGraph::_decode_color( $colors[$i] );
+
+                if ( isset( $this->m_colors[$i] ) ) {
+
+                    $hex_split = YDGraph::_decode_color( $this->m_colors[$i] );
+
+                }
+
+                $piece_color = imagecolorallocate( $this->m_image, $hex_split[0],$hex_split[1],$hex_split[2]);
+
+                
+
+                $w = $x+$radius;
+
+                $h = $last_position;
+
+                
+
+                imagefilledrectangle( $this->m_image, $w+20, $h, $w+30, $h+10, $piece_color );
+
+                imagestring( $this->m_image, $this->m_labelsFont, $w+40, $h+$align, str_repeat( ' ', ( $max_len - strlen( $percent ) ) ) . $percent . "% " . $this->m_labels[$i], $this->m_labelsTextColor );
+
+                
+
+            }
+
             if ( $this->m_showtotal ) {
                 if ( isset( $this->m_total ) ) {
                     $sum = $this->m_total;
@@ -235,7 +378,8 @@
                 }
                 imagestring( $this->m_image, $this->m_labelsFont, $w+20, $h+20, $this->m_totalstring . $sum, $this->m_labelsTextColor );
             }
-            
+            
+
             if( strlen($file) > 0 ){
                 switch ( YDConfig::get( 'YD_GRAPH_TYPE' ) ) {
                     case IMG_GIF:
@@ -266,10 +410,14 @@
                         break;
                 }
 
-            }
-            
-        }
-        
+            }
+
+            
+
+        }
+
+        
+
         /**
          *  This function sets the display format
          *
@@ -281,8 +429,10 @@
             $this->m_numberOfDecimals = $numberOfDecimals;
             $this->m_thousandsSeparator = $thousandsSeparator;
             $this->m_decimalSeparator = $decimalSeparator;
-        }
-        
+        }
+
+        
+
         /**
          *  This function sets labels
          *
@@ -297,17 +447,24 @@
             $this->m_labelsFont = $font;
             $this->m_labelsFontWidth = imagefontwidth($font);
             $this->m_labelsFontHeight = imagefontheight($font);
-        }
-        
+        }
+
+        
+
         /**
          *  This function sets the values
          *
          *  @param $values       Array of values
-         */
-        function setValues( & $values ) {
-            $this->m_values = & $values;
-        }
-        
+         */
+
+        function setValues( & $values ) {
+
+            $this->m_values = & $values;
+
+        }
+
+        
+
         /**
          *  This function sets the title
          *
@@ -323,15 +480,20 @@
             $this->m_font = $font;
             $this->m_fontWidth = imagefontwidth($font);
             $this->m_fontHeight = imagefontheight($font);
-        }
-        
+        }
+
+        
+
         /**
          *  This function sets the background colors of the pieces
          *
          *  @param $colors       An array with the colors
-         */
-        function setColors( & $colors ) {
-            $this->m_colors = & $colors;
+         */
+
+        function setColors( & $colors ) {
+
+            $this->m_colors = & $colors;
+
         }
         
         /**
@@ -355,8 +517,10 @@
         function showTotal( $string='Total: ', $show=true ) {
             $this->m_showtotal   = (boolean) $show;
             $this->m_totalstring = $string;
-        }
-        
+        }
+
+        
+
     }
 
 ?>

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This program is free software; you can redistribute it and/or
         modify it under the terms of the GNU General Public License

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        (c) Copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,7 +2,7 @@
  
     /*
 
-        Yellow Duck Framework version 2.0
+        Yellow Duck Framework version 2.1
         Copyright (C) (c) copyright 2004 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/html2pdf.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/html2pdf.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/html2pdf.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,7 +2,7 @@
  
     /*
 
-        Yellow Duck Framework version 2.0
+        Yellow Duck Framework version 2.1
         Copyright (C) (c) copyright 2004 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or

Modified: YDFramework2.0/trunk/_default.htaccess
===================================================================
--- YDFramework2.0/trunk/_default.htaccess	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/_default.htaccess	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,5 +1,5 @@
-# Yellow Duck Framework version 2.0
-# (c) copyright 2002-2005 Pieter Claerhout, pieter at yellowduck.be
+# Yellow Duck Framework version 2.1
+# (c) copyright 2002-2007 Pieter Claerhout, pieter at yellowduck.be
 
 # Denying direct access to the templates
 <FilesMatch "(.tpl|config.php)$">

Added: YDFramework2.0/trunk/doc/build_api.sh
===================================================================
--- YDFramework2.0/trunk/doc/build_api.sh	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc/build_api.sh	2007-01-16 20:09:38 UTC (rev 2317)
@@ -0,0 +1,5 @@
+#!/bin/bash
+rm -Rf ./api
+mkdir api
+doxygen ./docs_api.dxy
+open -a Safari api/index.html


Property changes on: YDFramework2.0/trunk/doc/build_api.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: YDFramework2.0/trunk/doc/docs_api.dxy
===================================================================
--- YDFramework2.0/trunk/doc/docs_api.dxy	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc/docs_api.dxy	2007-01-16 20:09:38 UTC (rev 2317)
@@ -4,7 +4,7 @@
 # General configuration options
 #---------------------------------------------------------------------------
 PROJECT_NAME           = "Yellow Duck Framework"
-PROJECT_NUMBER         = "version 2.0"
+PROJECT_NUMBER         = "version 2.1"
 OUTPUT_DIRECTORY       = 
 OUTPUT_LANGUAGE        = English
 #USE_WINDOWS_ENCODING   = YES

Modified: YDFramework2.0/trunk/doc/docs_api_footer.html
===================================================================
--- YDFramework2.0/trunk/doc/docs_api_footer.html	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc/docs_api_footer.html	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,7 +2,7 @@
 <hr size="1" noshade>
 <address>
     <small>
-        Yellow Duck Framework 2.0 by Pieter Claerhout,
+        Yellow Duck Framework 2.1 by Pieter Claerhout,
         <a href="ydframework.berlios.de">ydframework.berlios.de</a>
     </small>
 </address>

Modified: YDFramework2.0/trunk/doc/index.html
===================================================================
--- YDFramework2.0/trunk/doc/index.html	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc/index.html	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,7 +1,7 @@
 <html>
 
 <head>
-    <title>Yellow Duck Framework 2.0</title>
+    <title>Yellow Duck Framework 2.1</title>
     <style>
         td { border-bottom: 1px solid #FFCC00; }
         P,TD,LI,INPUT,SELECT,TEXTAREA{background-color:#FFE9A6;font:13px/1.3 Verdana}
@@ -30,15 +30,15 @@
 <body>
 
     <div class="header">
-        <h2>Yellow Duck Framework 2.0</h2>
+        <h2>Yellow Duck Framework 2.1</h2>
     </div>
 
     <div class="page">
         <h3>Documentation</h3>
         <br />
-        &gt; <a href="userguide/index.html">Yellow Duck Framework 2.0 User Guide</a> (HTML)
+        &gt; <a href="userguide/index.html">Yellow Duck Framework 2.1 User Guide</a> (HTML)
         <br />
-        &gt; <a href="api/index.html">Yellow Duck Framework 2.0 API</a> (HTML)
+        &gt; <a href="api/index.html">Yellow Duck Framework 2.1 API</a> (HTML)
         <br /><br /><br />
         <h3>License</h3>
         <br />
@@ -50,7 +50,7 @@
     </div>
 
     <div class="copyright">
-        (c) Copyright 2002-2005 by <a href="mailto:pieter at yellowduck.be">Pieter Claerhout</a>. All rights reserved.
+        (c) Copyright 2002-2007 by <a href="mailto:pieter at yellowduck.be">Pieter Claerhout</a>. All rights reserved.
     </div>
 
 </body>

Modified: YDFramework2.0/trunk/doc_src/_ydframework.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/_ydframework.xml	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/_ydframework.xml	2007-01-16 20:09:38 UTC (rev 2317)
@@ -50,7 +50,7 @@
 <book>
 
     <bookinfo>
-        <title>Yellow Duck Framework 2.0</title>
+        <title>Yellow Duck Framework 2.1</title>
         <subtitle>User Guide</subtitle>
         <authorgroup>
             <author>
@@ -59,11 +59,11 @@
             </author>
         </authorgroup>
         <copyright>
-            <year>2002</year><year>2005</year>
+            <year>2002</year><year>2007</year>
             <holder role="mailto:pieter at yellowduck.be">Pieter Claerhout</holder>
         </copyright>
         <abstract>
-            <para>This document contains the user guide for the Yellow Duck Framework version 2.0.</para>
+            <para>This document contains the user guide for the Yellow Duck Framework version 2.1.</para>
             <para>The Yellow Duck Framework is an object oriented framework written in <ulink url="http://www.php.net/">PHP</ulink> which makes it a lot easier and faster to create websites and web applications.</para>
         </abstract>
     </bookinfo>

Modified: YDFramework2.0/trunk/doc_src/build_html.bat
===================================================================
--- YDFramework2.0/trunk/doc_src/build_html.bat	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/build_html.bat	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,7 +1,7 @@
 @echo off
 
-rem Yellow Duck Framework version 2.0
-rem Copyright (c) copyright 2002-2005 Pieter Claerhout
+rem Yellow Duck Framework version 2.1
+rem Copyright (c) copyright 2002-2007 Pieter Claerhout
 rem
 rem This library is free software; you can redistribute it and/or
 rem modify it under the terms of the GNU Lesser General Public

Added: YDFramework2.0/trunk/doc_src/build_html.sh
===================================================================
--- YDFramework2.0/trunk/doc_src/build_html.sh	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/build_html.sh	2007-01-16 20:09:38 UTC (rev 2317)
@@ -0,0 +1,43 @@
+#!/bin/bash
+
+# Yellow Duck Framework version 2.1
+# Copyright (c) copyright 2002-2007 Pieter Claerhout
+# rem
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+# rem
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+# Lesser General Public License for more details.
+# rem
+# You should have received a copy of the GNU Lesser General Public
+# License along with this library; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+# Print some general info
+echo Yellow Duck Framework 2.1
+echo Building HTML version of the User Guide
+echo
+
+# Delete the previous directories
+rm -Rf html
+
+# Create the directories
+mkdir html
+
+# Copy the images
+cp images/*.gif html
+cp docbook/images/note.gif html
+cp docbook/images/warning.gif html
+
+# Copy the stylesheet
+cp style.css html
+
+# Create outputs
+xsltproc --xinclude --output html/index.html xsl_html.xsl _ydframework.xml
+
+# Open the result
+open -a Safari html/index.html


Property changes on: YDFramework2.0/trunk/doc_src/build_html.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: YDFramework2.0/trunk/doc_src/build_pdf.bat
===================================================================
--- YDFramework2.0/trunk/doc_src/build_pdf.bat	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/build_pdf.bat	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,7 +1,7 @@
 @echo off
 
-rem Yellow Duck Framework version 2.0
-rem Copyright (c) copyright 2002-2005 Pieter Claerhout
+rem Yellow Duck Framework version 2.1
+rem Copyright (c) copyright 2002-2007 Pieter Claerhout
 rem
 rem This library is free software; you can redistribute it and/or
 rem modify it under the terms of the GNU Lesser General Public

Added: YDFramework2.0/trunk/doc_src/build_pdf.sh
===================================================================
--- YDFramework2.0/trunk/doc_src/build_pdf.sh	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/build_pdf.sh	2007-01-16 20:09:38 UTC (rev 2317)
@@ -0,0 +1,57 @@
+#!/bin/bash
+
+# Yellow Duck Framework version 2.1
+# Copyright (c) copyright 2002-2007 Pieter Claerhout
+# rem
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+# rem
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+# Lesser General Public License for more details.
+# rem
+# You should have received a copy of the GNU Lesser General Public
+# License along with this library; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+# Print some general info
+echo Yellow Duck Framework 2.1
+echo Building PDF version of the User Guide
+echo
+
+# Delete the previous directories
+rm -Rf pdf
+
+# Create the directories
+mkdir pdf
+
+# Copy the images
+cp images/*.gif pdf
+cp images/*.svg pdf
+cp docbook/images/note.gif pdf
+cp docbook/images/warning.gif pdf
+
+# Create outputs
+echo Creating YDFramework2.fo
+xsltproc --xinclude --output pdf/YDFramework2.fo xsl_fo.xsl _ydframework.xml
+
+# Fix the FO document
+echo Fixing fontsizes
+python fixfo.py pdf/YDFramework2.fo
+
+# Create the PDF
+echo Converting YDFramework2.fo to PDF
+fop -q -c fop_config.xml pdf/YDFramework2.fo pdf/YDFramework2.pdf
+
+# Cleanup
+rm -f pdf/YDFramework2.fo
+rm -f pdf/*.gif
+rm -f pdf/*.svg
+
+# Open the result
+open -a Preview pdf/YDFramework2.pdf
+
+pause
\ No newline at end of file


Property changes on: YDFramework2.0/trunk/doc_src/build_pdf.sh
___________________________________________________________________
Name: svn:executable
   + *
Name: svn:eol-style
   + native

Modified: YDFramework2.0/trunk/doc_src/fixfo.vbs
===================================================================
--- YDFramework2.0/trunk/doc_src/fixfo.vbs	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/fixfo.vbs	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,5 +1,5 @@
-' Yellow Duck Framework version 2.0
-' Copyright (C) (c) copyright 2004 Pieter Claerhout
+' Yellow Duck Framework version 2.1
+' Copyright (C) (c) copyright 2002-2007 Pieter Claerhout
 ' 
 ' This library is free software; you can redistribute it and/or
 ' modify it under the terms of the GNU Lesser General Public

Modified: YDFramework2.0/trunk/doc_src/installing.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/installing.xml	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/doc_src/installing.xml	2007-01-16 20:09:38 UTC (rev 2317)
@@ -16,7 +16,7 @@
             <listitem>Webserver capable of executing PHP scripts, such as <ulink url="http://httpd.apache.org/">Apache</ulink> or <ulink url="http://www.microsoft.com/iis/">Microsoft IIS</ulink></listitem>
         </itemizedlist>
 
-        <para>The Yellow Duck Framework was primarily tested on the Windows platform and also has undergone extensive testing on Linux based systems. Currently, the Yellow Duck Framework is only supported with PHP version 4. PHP 5 works but the Yellow Duck Framework 2.0 will not take advantage of the new features provided with PHP 5 (such as exceptions and the new object model). The testing is mainly done using the Apache webserver.</para>
+        <para>The Yellow Duck Framework was primarily tested on the Windows platform and also has undergone extensive testing on Linux based systems. Currently, the Yellow Duck Framework is only supported with PHP version 4. PHP 5 works but the Yellow Duck Framework 2.1 will not take advantage of the new features provided with PHP 5 (such as exceptions and the new object model). The testing is mainly done using the Apache webserver.</para>
 
         <warning>It is preferred to run PHP as an Apache module or as an Microsft IIS ISAPI module for achieving the best performance. The Yellow Duck Framework works equally well under a CGI as well as under an mod_php environment.</warning>
 
@@ -32,7 +32,7 @@
 
         <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="examples/installing_001.xml" />
 
-        <para>The main directory of the framework, called <literal>YDFramework-2.0</literal> in this example, contains all the different files for the framework, including documentation, examples and license information. In this directory, there is a directory called <literal>YDFramework2</literal>, which contains the core framework files. There are a number of subdirectories in the <literal>YDFramework2</literal> directory which each have a specific function:</para>
+        <para>The main directory of the framework, called <literal>YDFramework2</literal> in this example, contains all the different files for the framework, including documentation, examples and license information. In this directory, there is a directory called <literal>YDFramework2</literal>, which contains the core framework files. There are a number of subdirectories in the <literal>YDFramework2</literal> directory which each have a specific function:</para>
 
         <itemizedlist spacing="compact">
             <listitem><emphasis role="bold"><literal>3rdparty</literal>:</emphasis> This directory contains the third party libraries that are needed for the Yellow Duck Framework to work properly. In here, you will find copies of <ulink url="http://smarty.php.net/">Smarty</ulink> and <ulink url="http://phpmailer.sourceforge.net/">PHP Mailer</ulink>.</listitem>

Modified: YDFramework2.0/trunk/examples/database/.htaccess
===================================================================
--- YDFramework2.0/trunk/examples/database/.htaccess	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/examples/database/.htaccess	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,5 +1,5 @@
-# Yellow Duck Framework version 2.0
-# (c) copyright 2004 Pieter Claerhout, pieter at yellowduck.be
+# Yellow Duck Framework version 2.1
+# (c) copyright 2002-2007 Pieter Claerhout, pieter at yellowduck.be
 
 # Denying direct access to the templates
 <FilesMatch "(tpl|config.php|includes|index.db)$">

Modified: YDFramework2.0/trunk/examples/forum/.htaccess
===================================================================
--- YDFramework2.0/trunk/examples/forum/.htaccess	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/examples/forum/.htaccess	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,5 +1,5 @@
-# Yellow Duck Framework version 2.0
-# (c) copyright 2004 Pieter Claerhout, pieter at yellowduck.be
+# Yellow Duck Framework version 2.1
+# (c) copyright 2002-2007 Pieter Claerhout, pieter at yellowduck.be
 
 # Denying direct access to the templates
 <FilesMatch "(.tpl|config.php)$">

Modified: YDFramework2.0/trunk/examples/weblog/.htaccess
===================================================================
--- YDFramework2.0/trunk/examples/weblog/.htaccess	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/examples/weblog/.htaccess	2007-01-16 20:09:38 UTC (rev 2317)
@@ -1,5 +1,5 @@
-# Yellow Duck Framework version 2.0
-# (c) copyright 2004 Pieter Claerhout, pieter at yellowduck.be
+# Yellow Duck Framework version 2.1
+# (c) copyright 2002-2007 Pieter Claerhout, pieter at yellowduck.be
 
 # Denying direct access to the templates
 <FilesMatch "(.tpl)$">

Modified: YDFramework2.0/trunk/index.php
===================================================================
--- YDFramework2.0/trunk/index.php	2007-01-16 12:59:08 UTC (rev 2316)
+++ YDFramework2.0/trunk/index.php	2007-01-16 20:09:38 UTC (rev 2317)
@@ -2,8 +2,8 @@
 
     /*
 
-        Yellow Duck Framework version 2.0
-        Copyright (c) copyright 2002-2005 Pieter Claerhout
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
 
         This library is free software; you can redistribute it and/or
         modify it under the terms of the GNU Lesser General Public



From pclaerhout at mail.berlios.de  Tue Jan 16 21:17:33 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 16 Jan 2007 21:17:33 +0100
Subject: [ydf-devel] r2318 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701162017.l0GKHXSq017854@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-16 21:17:32 +0100 (Tue, 16 Jan 2007)
New Revision: 2318

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Fixed a leftover copyright.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-16 20:09:38 UTC (rev 2317)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-16 20:17:32 UTC (rev 2318)
@@ -57,7 +57,7 @@
     @define( 'YD_FW_VERSION', '2.0 (build ' . YD_FW_REVISION . ')' );
     @define( 'YD_FW_NAMEVERS', YD_FW_NAME . ' ' . YD_FW_VERSION );
     @define( 'YD_FW_HOMEPAGE', 'http://ydframework.berlios.de/' );
-    @define( 'YD_FW_COPYRIGHT', '(c) 2002-2006 Pieter Claerhout, pieter at yellowduck.be' );
+    @define( 'YD_FW_COPYRIGHT', '(c) 2002-2007 Pieter Claerhout, pieter at yellowduck.be' );
 
     // Directory paths
     @define( 'YD_DIR_HOME', dirname( __FILE__ ) );



From pclaerhout at mail.berlios.de  Wed Jan 17 12:56:19 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 17 Jan 2007 12:56:19 +0100
Subject: [ydf-devel] r2319 - YDFramework2.0/trunk/doc_src
Message-ID: <200701171156.l0HBuJ4U021521@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-17 12:56:19 +0100 (Wed, 17 Jan 2007)
New Revision: 2319

Modified:
   YDFramework2.0/trunk/doc_src/build_html.bat
   YDFramework2.0/trunk/doc_src/build_pdf.bat
Log:
Fixed some leftovers of version numbers I didn't change yet.

Modified: YDFramework2.0/trunk/doc_src/build_html.bat
===================================================================
--- YDFramework2.0/trunk/doc_src/build_html.bat	2007-01-16 20:17:32 UTC (rev 2318)
+++ YDFramework2.0/trunk/doc_src/build_html.bat	2007-01-17 11:56:19 UTC (rev 2319)
@@ -18,7 +18,7 @@
 rem Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 
 rem Print some general info
-echo Yellow Duck Framework 2.0
+echo Yellow Duck Framework 2.1
 echo Building HTML version of the User Guide
 echo.
 

Modified: YDFramework2.0/trunk/doc_src/build_pdf.bat
===================================================================
--- YDFramework2.0/trunk/doc_src/build_pdf.bat	2007-01-16 20:17:32 UTC (rev 2318)
+++ YDFramework2.0/trunk/doc_src/build_pdf.bat	2007-01-17 11:56:19 UTC (rev 2319)
@@ -18,7 +18,7 @@
 rem Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 
 rem Print some general info
-echo Yellow Duck Framework 2.0
+echo Yellow Duck Framework 2.1
 echo Building PDF version of the User Guide
 echo.
 



From pclaerhout at mail.berlios.de  Wed Jan 17 12:57:07 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Wed, 17 Jan 2007 12:57:07 +0100
Subject: [ydf-devel] r2320 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701171157.l0HBv75a022075@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-17 12:57:06 +0100 (Wed, 17 Jan 2007)
New Revision: 2320

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
One other leftover version number.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-17 11:56:19 UTC (rev 2319)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-17 11:57:06 UTC (rev 2320)
@@ -54,7 +54,7 @@
     // Global framework constants
     @define( 'YD_FW_REVISION', 'unknown' );
     @define( 'YD_FW_NAME', 'Yellow Duck Framework' );
-    @define( 'YD_FW_VERSION', '2.0 (build ' . YD_FW_REVISION . ')' );
+    @define( 'YD_FW_VERSION', '2.1 (build ' . YD_FW_REVISION . ')' );
     @define( 'YD_FW_NAMEVERS', YD_FW_NAME . ' ' . YD_FW_VERSION );
     @define( 'YD_FW_HOMEPAGE', 'http://ydframework.berlios.de/' );
     @define( 'YD_FW_COPYRIGHT', '(c) 2002-2007 Pieter Claerhout, pieter at yellowduck.be' );



From pclaerhout at mail.berlios.de  Thu Jan 18 12:27:20 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 18 Jan 2007 12:27:20 +0100
Subject: [ydf-devel] r2321 - YDFramework2.0/trunk/examples
Message-ID: <200701181127.l0IBRKbv006368@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-18 12:27:19 +0100 (Thu, 18 Jan 2007)
New Revision: 2321

Modified:
   YDFramework2.0/trunk/examples/index.tpl
Log:
Updated another instance where it was still referring to version 2.0.

Modified: YDFramework2.0/trunk/examples/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/index.tpl	2007-01-17 11:57:06 UTC (rev 2320)
+++ YDFramework2.0/trunk/examples/index.tpl	2007-01-18 11:27:19 UTC (rev 2321)
@@ -33,7 +33,7 @@
 <body>
 
     <div class="header">
-        <h2>Yellow Duck Framework 2.0</h2>
+        <h2>{$YD_FW_NAME}</h2>
     </div>
 
     <div class="page">



From pclaerhout at mail.berlios.de  Thu Jan 18 16:12:35 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Thu, 18 Jan 2007 16:12:35 +0100
Subject: [ydf-devel] r2322 - in YDFramework2.0/trunk/YDFramework2: .
	YDClasses
Message-ID: <200701181512.l0IFCZ2T013141@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-18 16:12:34 +0100 (Thu, 18 Jan 2007)
New Revision: 2322

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Added a rudimentary timesince function to YDStringUtil.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-18 11:27:19 UTC (rev 2321)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-18 15:12:34 UTC (rev 2322)
@@ -81,6 +81,7 @@
                 $this->register_modifier( 'dump', 'YDTemplate_modifier_dump' );
                 $this->register_modifier( 'bbcode', 'YDTemplate_modifier_bbcode' );
                 $this->register_modifier( 'absoluteurl', 'YDTemplate_modifier_absoluteurl' );
+                $this->register_modifier( 'timesince', 'YDTemplate_modifier_timesince' );
 
                 // Register the custom functions
                 $this->register_function( 't', 'YDTemplate_function_t' );
@@ -652,4 +653,13 @@
         return;
     }
 
+    /*
+     *	This template modifier will dump the contents of the variable using var_dump.
+     *
+     *  @param  $obj    The object to dump.
+     */
+    function YDTemplate_modifier_timesince( $obj ) {
+        return YDStringUtil::timesince( $obj );
+    }
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-18 11:27:19 UTC (rev 2321)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-18 15:12:34 UTC (rev 2322)
@@ -989,6 +989,59 @@
             }
         }
 
+        /**
+         *  Show the time that has elapsed since a given time.
+         *
+         *  @param  $time   The time in seconds
+         *
+         *  @returns    The elapsed time
+         */
+        function timesince( $time ) {
+
+            // Convert to integer
+            if ( is_string( $time ) && is_numeric( $time ) ) {
+                $time = intval( $time );
+            }
+
+            // Array of time period chunks
+            $chunks = array(
+                array( 60 * 60 * 24 * 365 , t('years') ),
+                array( 60 * 60 * 24 * 30 , t('months') ),
+                array( 60 * 60 * 24 * 7, t('weeks') ),
+                array( 60 * 60 * 24 , t('days') ),
+                array( 60 * 60 , t('hours') ),
+                array( 60 , t('minutes') ),
+            );
+
+            // Difference in seconds
+            $since = time() - $time;
+
+            // The first chunk
+            for ( $i = 0, $j = sizeof( $chunks ); $i < $j; $i++ ) {
+                $seconds = $chunks[$i][0];
+                $name = $chunks[$i][1];
+                if ( ( $count = floor( $since / $seconds ) ) != 0 ) {
+                    break;
+                }
+            }
+
+            // Set output var
+            $output = ( $count == 1 ) ? '1 '.$name : $count . ' ' . $name;
+
+            // step two: the second chunk
+            if ( $i + 1 < $j ) {
+                $seconds2 = $chunks[$i + 1][0];
+                $name2 = $chunks[$i + 1][1];
+                if ( ( $count2 = floor( ( $since - ( $seconds * $count ) ) / $seconds2 ) ) != 0 ) {
+                    $output .= ($count2 == 1) ? ', 1 '.$name2 : ", $count2 {$name2}s";
+                }
+            }
+
+            // Return the output
+            return $output . ' ' . t('ago');
+
+        }
+
     }
 
     /**

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-18 11:27:19 UTC (rev 2321)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-18 15:12:34 UTC (rev 2322)
@@ -185,6 +185,17 @@
         'trk' => array( 'turkish', 'tr' ),
     );
 
+    // Default translations
+    $GLOBALS['t'] = array(
+        'years' => 'years',
+        'months' => 'months',
+        'weeks' => 'weeks',
+        'days' => 'days',
+        'hours' => 'hours',
+        'minutes' => 'minutes',
+        'ago' => 'ago',
+    );
+
     /**
      *	This function will include a file from the filesystem. It works similar to the require_once function but it
      *	knows about the include path for the Yellow Duck Framework.



From pclaerhout at mail.berlios.de  Fri Jan 19 10:07:11 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Fri, 19 Jan 2007 10:07:11 +0100
Subject: [ydf-devel] r2323 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701190907.l0J97BEG008419@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-19 10:07:11 +0100 (Fri, 19 Jan 2007)
New Revision: 2323

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Fixed a small "undefined variable $time" in the YDTemplate modifiers.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-18 15:12:34 UTC (rev 2322)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-19 09:07:11 UTC (rev 2323)
@@ -606,7 +606,7 @@
         if ( empty( $string ) ) {
             $string = "now";
         }
-        if ( is_numeric( $string ) && $time != -1 ) {
+        if ( is_numeric( $string ) && $string != -1 ) {
             return intval( $string );
         }
         if ( preg_match( '/^\d{14}$/', $string ) ) {



From pclaerhout at mail.berlios.de  Sun Jan 21 22:01:30 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 21 Jan 2007 22:01:30 +0100
Subject: [ydf-devel] r2324 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701212101.l0LL1UM6032222@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-21 22:01:29 +0100 (Sun, 21 Jan 2007)
New Revision: 2324

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Added the YD_FW_POWERED_BY constant.


Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-19 09:07:11 UTC (rev 2323)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-21 21:01:29 UTC (rev 2324)
@@ -57,6 +57,7 @@
     @define( 'YD_FW_VERSION', '2.1 (build ' . YD_FW_REVISION . ')' );
     @define( 'YD_FW_NAMEVERS', YD_FW_NAME . ' ' . YD_FW_VERSION );
     @define( 'YD_FW_HOMEPAGE', 'http://ydframework.berlios.de/' );
+    @define( 'YD_FW_POWERED_BY', sprintf( 'Powered by <a href="%s">%s</a>', YD_FW_HOMEPAGE, YD_FW_NAMEVERS ) );
     @define( 'YD_FW_COPYRIGHT', '(c) 2002-2007 Pieter Claerhout, pieter at yellowduck.be' );
 
     // Directory paths



From pclaerhout at mail.berlios.de  Sun Jan 21 22:02:15 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 21 Jan 2007 22:02:15 +0100
Subject: [ydf-devel] r2325 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701212102.l0LL2FJ8032343@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-21 22:02:14 +0100 (Sun, 21 Jan 2007)
New Revision: 2325

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Added the total size of the include files if YD_DEBUG = 2.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-21 21:01:29 UTC (rev 2324)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-21 21:02:14 UTC (rev 2325)
@@ -25,7 +25,7 @@
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
-    
+
     // Auto execute config value. Default: true.
     YDConfig::set( 'YD_AUTO_EXECUTE', true, false );
 
@@ -233,7 +233,7 @@
                 $debug .= '</table></p></dd>';
 
                 // Add the included files
-                $debug .= '<p ' . $font . '><i>Included files</i></p>';
+                $debug .= '<p ' . $font . '><i>Included files (' . $includeFilesSize . ')</i></p>';
                 $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
                 $debug .= sprintf( '<tr><th %s>File</th><th %s>Size</th></tr>', $font, $font );
                 foreach ( $includeFilesWithSize as $size=>$file ) {



From pclaerhout at mail.berlios.de  Sun Jan 21 22:02:49 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 21 Jan 2007 22:02:49 +0100
Subject: [ydf-devel] r2326 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701212102.l0LL2nIs032444@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-21 22:02:49 +0100 (Sun, 21 Jan 2007)
New Revision: 2326

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
Added the url template modifier.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-21 21:02:14 UTC (rev 2325)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-21 21:02:49 UTC (rev 2326)
@@ -82,6 +82,7 @@
                 $this->register_modifier( 'bbcode', 'YDTemplate_modifier_bbcode' );
                 $this->register_modifier( 'absoluteurl', 'YDTemplate_modifier_absoluteurl' );
                 $this->register_modifier( 'timesince', 'YDTemplate_modifier_timesince' );
+                $this->register_modifier( 'url', 'YDTemplate_modifier_url' );
 
                 // Register the custom functions
                 $this->register_function( 't', 'YDTemplate_function_t' );
@@ -139,6 +140,7 @@
                 $this->assign( 'YD_FW_VERSION', YD_FW_VERSION );
                 $this->assign( 'YD_FW_NAMEVERS', YD_FW_NAMEVERS );
                 $this->assign( 'YD_FW_HOMEPAGE', YD_FW_HOMEPAGE );
+                $this->assign( 'YD_FW_POWERED_BY', YD_FW_POWERED_BY );
                 $this->assign( 'YD_FW_COPYRIGHT', YD_FW_COPYRIGHT );
                 $this->assign( 'YD_SELF_SCRIPT', YD_SELF_SCRIPT );
                 $this->assign( 'YD_SELF_FILE', YD_SELF_FILE );
@@ -662,4 +664,19 @@
         return YDStringUtil::timesince( $obj );
     }
 
+    /**
+     *	This template modifier formats an url with an optional title.
+     *
+     *  @param  $url        The url to format as a HTML hyperlink
+     *  @param  $title      (optional) If null and no string is given, the url will be used.
+     *
+     *  @returns    The formatted url.
+     */
+    function YDTemplate_modifier_url( $url, $title=null ) {
+        if ( empty( $title ) ) {
+            $title = $url;
+        }
+        return sprintf( '<a href="%s">%s</a>', $url, $title );
+    }
+
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Sun Jan 21 22:04:24 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 21 Jan 2007 22:04:24 +0100
Subject: [ydf-devel] r2327 - in YDFramework2.0/trunk/examples: . simplecms
	simplecms/includes simplecms/includes/modules
	simplecms/includes/skins_admin simplecms/includes/skins_public
	simplecms/includes/skins_public/default
Message-ID: <200701212104.l0LL4ON6032581@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-21 22:04:23 +0100 (Sun, 21 Jan 2007)
New Revision: 2327

Added:
   YDFramework2.0/trunk/examples/simplecms/
   YDFramework2.0/trunk/examples/simplecms/admin.php
   YDFramework2.0/trunk/examples/simplecms/images/
   YDFramework2.0/trunk/examples/simplecms/includes/
   YDFramework2.0/trunk/examples/simplecms/includes/.htaccess
   YDFramework2.0/trunk/examples/simplecms/includes/YDSimpleCMSApp.php
   YDFramework2.0/trunk/examples/simplecms/includes/config.php
   YDFramework2.0/trunk/examples/simplecms/includes/modules/
   YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php
   YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/page.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/page.tpl
   YDFramework2.0/trunk/examples/simplecms/index.php
   YDFramework2.0/trunk/examples/simplecms/resources/
Log:
Added a very first stab at a very simple CMS (similar to YDCms from ages ago) that could help with building very simple websites. It's less powerful than the YDCMComponent but easier to use...

Added: YDFramework2.0/trunk/examples/simplecms/admin.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,9 @@
+<?php
+
+    // Include the CMS App module
+    include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
+
+    // Run the CMS request
+    YDSimpleCMSRunRequest( 'admin' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/.htaccess
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/.htaccess	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/.htaccess	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1 @@
+deny from all

Added: YDFramework2.0/trunk/examples/simplecms/includes/YDSimpleCMSApp.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/YDSimpleCMSApp.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/YDSimpleCMSApp.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,12 @@
+<?php
+
+    // Include the Yellow Duck Framework
+    include_once( dirname( __FILE__ ) . '/../../../YDFramework2/YDF2_init.php' );
+
+    // Include the config
+    include_once( dirname( __FILE__ ) . '/config.php' );
+
+    // Include the CMS
+    include_once( YD_DIR_HOME_ADD . '/YDSimpleCMS/YDSimpleCMS.php' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/config.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,13 @@
+<?php
+
+    YDConfig::set( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
+    YDConfig::set( 'YD_DEBUG', 2 );
+    YDConfig::set( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
+
+    YDConfig::set( 'db_host',   'localhost' );
+    YDConfig::set( 'db_name',   'ydsimplecms' );
+    YDConfig::set( 'db_user',   'root' );
+    YDConfig::set( 'db_pass',   '' );
+    YDConfig::set( 'db_prefix', 'cms_' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,23 @@
+<?php
+
+    // Class definition
+    class module_contactus extends YDSimpleCMSModule {
+
+        // Class variables
+        var $name        = 'SimpleCMS Contact Us Module';
+        var $description = 'SimpleCMS module to manage a contact form.';
+        var $version     = '1.0';
+        var $authorName  = 'Pieter Claerhout';
+        var $authorEmail = 'pieter at yellowduck.be';
+        var $authorUrl   = 'http://www.yellowduck.be';
+
+        // Main function
+        function action_public_show() {
+        }
+
+    }
+
+    // Add menu items
+    YDSimpleCMSAddAdminMenu( 'Content',    'Contact Us', 'contactus', 'show' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,24 @@
+<?php
+
+    // Class definition
+    class module_newsletter extends YDSimpleCMSModule {
+
+        // Class variables
+        var $name        = 'SimpleCMS Newsletter Module';
+        var $description = 'SimpleCMS module to manage newsletters.';
+        var $version     = '1.0';
+        var $authorName  = 'Pieter Claerhout';
+        var $authorEmail = 'pieter at yellowduck.be';
+        var $authorUrl   = 'http://www.yellowduck.be';
+
+        // Main function
+        function action_public_show() {
+        }
+
+    }
+
+    // Add menu items
+    YDSimpleCMSAddAdminMenu( 'Newsletters', 'Create Newsletter',    'newsletter', 'create' );
+    YDSimpleCMSAddAdminMenu( 'Newsletters', 'Archived Newsletters', 'newsletter', 'show' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,53 @@
+<html>
+
+<head>
+
+    <title>{$title}</title>
+
+    {literal}<style>
+        td { vertical-align: top; }
+    </style>{/literal}
+
+</head>
+
+<body>
+
+    <table width="100%" border="1">
+    {if $currentUser}
+        <tr>
+            <td colspan="2">
+                {$currentUser.name} | <a href="{$YD_SELF_SCRIPT}?module=admin&action=logout">{t w="logout"}</a>
+            </td>
+        </tr>
+    {/if}
+    <tr>
+        <td width="240">
+            {if $currentUser}
+                {foreach from=$adminMenu item="menuItem"}
+                    <p>
+                        {if $menuItem.url}
+                            <a href="{$menuItem.url}"><b>{$menuItem.title}</b></a>
+                        {else}
+                            <b>{$menuItem.title}</b>
+                        {/if}
+                        {foreach from=$menuItem.children item="menuSubItem"}
+                            <br/>
+                            {if $menuSubItem.url}
+                                <a href="{$menuSubItem.url}">{$menuSubItem.title}</a>
+                            {else}
+                                {$menuSubItem.title}
+                            {/if}
+                        {/foreach}
+                    </p>
+                {/foreach}
+            {/if}
+        </td>
+        <td>
+            ##content##
+        </td>
+    </tr>
+    </table>
+
+</body>
+
+</html>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,56 @@
+{if $currentAction == 'show'}
+    <h1>Admin Home</h1>
+    {foreach from=$adminMenu item="menuItem"}
+        <p>
+            {if $menuItem.url}
+                <a href="{$menuItem.url}"><b>{$menuItem.title}</b></a>
+            {else}
+                <b>{$menuItem.title}</b>
+            {/if}
+            {foreach from=$menuItem.children item="menuSubItem"}
+                <br/>
+                {if $menuSubItem.url}
+                    <a href="{$menuSubItem.url}">{$menuSubItem.title}</a>
+                {else}
+                    {$menuSubItem.title}
+                {/if}
+            {/foreach}
+        </p>
+    {/foreach}
+{/if}
+
+{if $currentAction == 'modules'}
+    <h1>Modules</h1>
+    <h2>Core Modules</h2>
+    <ul>
+        {foreach from=$modules item=module}
+            {if $module->isRequired()}
+                <li><p>
+                    <b>{$module->name} {t w="version"} {$module->version}</b>
+                    <br/>
+                    {t w="created_by"} {$module->authorName}, {$module->authorUrl|url}
+                    <br/>
+                    {$module->description}
+                </p></li>
+            {/if}
+        {/foreach}
+    </ul>
+    <h2>Optional Modules</h2>
+    <ul>
+        {foreach from=$modules item=module}
+            {if not $module->isRequired()}
+                <li><p>
+                    <b>{$module->name} {t w="version"} {$module->version}</b>
+                    <br/>
+                    {t w="created_by"} {$module->authorName}, {$module->authorUrl|url}
+                    <br/>
+                    {$module->description}
+                </p></li>
+            {/if}
+        {/foreach}
+    </ul>
+{/if}
+
+{if $currentAction == 'settings'}
+    <h1>Settings</h1>
+{/if}

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,29 @@
+<h1>{t w="please_login"}</h1>
+
+{if $form.errors}
+    <p style="color: red">
+        {foreach from=$form.errors item=error}
+            {$error}<br>
+        {/foreach}
+    </p>
+{/if}
+
+{$form.tag}
+    <p>
+        {$form.loginName.label}
+        <br>
+        {$form.loginName.html}
+    </p>
+    <p>
+        {$form.loginPass.label}
+        <br>
+        {$form.loginPass.html}
+    </p>
+    <p>
+        {$form.loginRememberMe.html}
+        {$form.loginRememberMe.label}
+    </p>
+    <p>
+        {$form.cmdSubmit.html}
+    </p>
+{$form.endtag}

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/page.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/page.tpl	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/page.tpl	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,3 @@
+{if $currentAction == 'show'}
+    <h1>Page</h1>
+{/if}

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,17 @@
+<html>
+
+<head>
+
+    <title>{$title}</title>
+
+</head>
+
+<body>
+
+    ##content##
+
+    <small>{$YD_FW_POWERED_BY}</small>
+
+</body>
+
+</html>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/page.tpl
===================================================================

Added: YDFramework2.0/trunk/examples/simplecms/index.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-21 21:02:49 UTC (rev 2326)
+++ YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-21 21:04:23 UTC (rev 2327)
@@ -0,0 +1,9 @@
+<?php
+
+    // Include the CMS App module
+    include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
+
+    // Run the CMS request
+    YDSimpleCMSRunRequest( 'public' );
+
+?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Sun Jan 21 22:06:02 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Sun, 21 Jan 2007 22:06:02 +0100
Subject: [ydf-devel] r2328 - in
	YDFramework2.0/trunk/examples/simplecms/includes: . database
Message-ID: <200701212106.l0LL62C5032739@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-21 22:06:01 +0100 (Sun, 21 Jan 2007)
New Revision: 2328

Added:
   YDFramework2.0/trunk/examples/simplecms/includes/database/
   YDFramework2.0/trunk/examples/simplecms/includes/database/ydsimplecms.sql
Log:
Added the YDSimpleCMS database schema.

Added: YDFramework2.0/trunk/examples/simplecms/includes/database/ydsimplecms.sql
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/database/ydsimplecms.sql	2007-01-21 21:04:23 UTC (rev 2327)
+++ YDFramework2.0/trunk/examples/simplecms/includes/database/ydsimplecms.sql	2007-01-21 21:06:01 UTC (rev 2328)
@@ -0,0 +1,21 @@
+# HeidiSQL Dump 
+#
+# --------------------------------------------------------
+# Host:                 localhost
+# Database:             ydsimplecms
+# Server version:       4.1.22-community-nt
+# Server OS:            Win32
+# max_allowed_packet:   1048576
+# HeidiSQL version:     3.0 RC4 Revision: 334
+# --------------------------------------------------------
+
+/*!40100 SET CHARACTER SET latin1;*/
+
+
+#
+# Database structure for database 'ydsimplecms'
+#
+
+CREATE DATABASE /*!32312 IF NOT EXISTS*/ ydsimplecms;
+
+USE ydsimplecms;



From pclaerhout at mail.berlios.de  Mon Jan 22 09:11:59 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 09:11:59 +0100
Subject: [ydf-devel] r2329 - YDFramework2.0/trunk/scripts
Message-ID: <200701220811.l0M8BxME021183@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 09:11:59 +0100 (Mon, 22 Jan 2007)
New Revision: 2329

Modified:
   YDFramework2.0/trunk/scripts/make_release.bat
   YDFramework2.0/trunk/scripts/make_weblog_release.bat
Log:
Changed the svn export to use anonymous HTTP as the protocol. This makes it easier to make a release from behind a corporate firewall.

Modified: YDFramework2.0/trunk/scripts/make_release.bat
===================================================================
--- YDFramework2.0/trunk/scripts/make_release.bat	2007-01-21 21:06:01 UTC (rev 2328)
+++ YDFramework2.0/trunk/scripts/make_release.bat	2007-01-22 08:11:59 UTC (rev 2329)
@@ -10,7 +10,7 @@
 rem   - sed
 
 :config_settings
-set SVN_HOME=svn://svn.berlios.de/ydframework/YDFramework2.0
+set SVN_HOME=http://svn.berlios.de/svnroot/repos/ydframework/YDFramework2.0
 set BLDTYPE=
 set SVN_URL=
 set SVN_REV=

Modified: YDFramework2.0/trunk/scripts/make_weblog_release.bat
===================================================================
--- YDFramework2.0/trunk/scripts/make_weblog_release.bat	2007-01-21 21:06:01 UTC (rev 2328)
+++ YDFramework2.0/trunk/scripts/make_weblog_release.bat	2007-01-22 08:11:59 UTC (rev 2329)
@@ -10,7 +10,7 @@
 rem   - sed
 
 :config_settings
-set SVN_HOME=svn://svn.berlios.de/ydframework/YDFramework2.0
+set SVN_HOME=http://svn.berlios.de/svnroot/repos/ydframework/YDFramework2.0
 set BLDTYPE=
 set SVN_URL=
 set SVN_REV=



From pclaerhout at mail.berlios.de  Mon Jan 22 12:21:34 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 12:21:34 +0100
Subject: [ydf-devel] r2330 - in YDFramework2.0/trunk/YDFramework2/addons: .
	YDSimpleCMS
Message-ID: <200701221121.l0MBLY8o006780@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 12:21:34 +0100 (Mon, 22 Jan 2007)
New Revision: 2330

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
Log:
Added some missing includes for YDSimpleCMS.

Added: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 08:11:59 UTC (rev 2329)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 11:21:34 UTC (rev 2330)
@@ -0,0 +1,465 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Constants
+    define( 'YD_SIMPLECMS_ACTION_PREFIX',  'action_' );
+    define( 'YD_SIMPLECMS_MODULE_PREFIX',  'module_' );
+    define( 'YD_SIMPLECMS_MODULE_EXT',     '.php' );
+    define( 'YD_SIMPLECMS_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
+    define( 'YD_SIMPLECMS_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
+    define( 'YD_SIMPLECMS_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
+
+    // Configuration
+    YDConfig::set( 'YD_AUTO_EXECUTE', false );
+
+    // Includes
+    YDInclude( 'YDForm.php' );
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDTemplate.php' );
+    YDInclude( 'YDFileSystem.php' );
+    YDInclude( 'YDF2_process.php' );
+    YDInclude( 'YDSimpleCMS_CoreModules.php' );
+
+    // Register the database instance and prefix
+    YDDatabase::registerInstance(
+        'default', 'mysql',
+        YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
+        YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
+    );
+    YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
+
+    // The global list with admin action
+    $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] = array();
+
+    // The database connection
+    $GLOBALS['db'] = YDDatabase::getNamedInstance();
+
+    // Override the template class
+    class YDSimpleCMSTemplate extends YDTemplate {
+
+        // The scope of the template
+        var $scope;
+
+        // The constructor
+        function YDSimpleCMSTemplate( $scope ) {
+
+            // Initialize the parent
+            $this->YDTemplate();
+
+            // Set the scope
+            $this->scope = $scope;
+
+        }
+
+        // Fetch the template using a master
+        function fetchWithMaster( $template='', $master='__master' ) {
+
+            // Set the variables
+            $this->template_dir = YD_SIMPLECMS_SKINS_DIR . $this->scope;
+            if ( $this->scope == 'public' ) {
+                $this->template_dir .= '/' . YDConfig::get( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
+            }
+
+            // Get the output
+            $output = $this->fetch( $template );
+
+            // Check if there is a __standard page
+            if ( is_file( $this->template_dir . '/' . $master . '.tpl' ) ) {
+                $standard = $this->fetch( $master );
+                $output = str_replace( '##content##', $output, $standard );
+            }
+
+            // Return the output
+            return $output;
+
+        }
+
+        // Fetch the template using a master
+        function displayWithMaster( $template='', $master='__master' ) {
+            echo( $this->fetchWithMaster( $template, $master ) );
+        }
+
+    }
+
+    // Define the CMS request class
+    class YDSimpleCMSPublicRequest extends YDRequest {
+
+        // Class variables
+        var $requestScope  = 'public';
+        var $defaultModule = 'page';
+
+        // Default action
+        function actionDefault() {
+
+            // Instantiate the module manager
+            YDGlobalTimerMarker( 'Instantiate module manager' );
+            $moduleManager = new YDSimpleCMSModuleManager();
+
+            // Load the modules
+            YDGlobalTimerMarker( 'Loading all modules' );
+            $moduleManager->loadAllModules();
+
+            // Get the parameters from the query string
+            $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
+            $action = $this->getQueryStringParameter( 'action', 'show' );
+
+            // Run the module
+            YDGlobalTimerMarker( 'Running module' );
+            $moduleManager->runModule( $this->requestScope, $module, $action );
+
+        }
+
+    }
+
+    // Define the CMS request class
+    class YDSimpleCMSAdminRequest extends YDSimpleCMSPublicRequest {
+
+        // Class variables
+        var $requestScope  = 'admin';
+        var $defaultModule = 'admin';
+
+        // Constructor
+        function YDSimpleCMSAdminRequest() {
+
+            // Initialize the parent
+            $this->YDSimpleCMSPublicRequest();
+
+            // Indicate we require login
+            $this->setRequiresAuthentication( true );
+
+            // Instantiate the template object
+            $this->tpl = new YDSimpleCMSTemplate( 'admin' );
+
+            // Get the site id
+            $this->siteId = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
+
+            // The names of the cookies
+            $this->cookieNameUser = 'YD_SIMPLECMS_' . $this->siteId . '_USER';
+            $this->cookieNamePass = 'YD_SIMPLECMS_' . $this->siteId . '_PASS';
+
+        }
+
+        // Login function
+        function actionLogin() {
+
+            // Redirect to default action if already logged in
+            if ( $this->isAuthenticated() === true ) {
+                $this->forward( 'default' );
+                return;
+            }
+
+            // Create the login form
+            $form = new YDForm( 'loginForm' );
+            $form->addElement( 'text', 'loginName', t('username') );
+            $form->addElement( 'password', 'loginPass', t('password') );
+            $form->addElement( 'checkbox', 'loginRememberMe', t('remember_me') );
+            $form->addElement( 'submit', 'cmdSubmit', 'Login' );
+            $form->setDefault( 'loginRememberMe', true );
+
+            // Add the rules
+            $form->addFormRule( array( & $this, 'checkLogin' ) );
+
+            // Process the form
+            if ( $form->validate() ) {
+
+                // Get the form values
+                $values = $form->getValues();
+
+                // Update the password
+                $values['loginPass'] = md5( $values['loginPass'] );
+
+                // Set the cookies
+                if ( $values['loginRememberMe'] === 1 ) {
+                    $this->setCookie( $this->cookieNameUser, $values['loginName'], false );
+                    $this->setCookie( $this->cookieNamePass, $values['loginPass'], false );
+                } else {
+                    $this->setCookie( $this->cookieNameUser, $values['loginName'], true );
+                    $this->setCookie( $this->cookieNamePass, $values['loginPass'], true );
+                }
+
+                // Forward to the main manage page
+                $this->redirectToAction();
+
+            }
+
+            // Add the form to the template
+            $this->tpl->assignForm( 'form', $form );
+
+            // Output the template
+            $this->tpl->displayWithMaster( 'login' );
+
+        }
+
+        // Logout action
+        function actionLogout() {
+            $this->setCookie( $this->cookieNamePass, null );
+            $this->redirectToAction( 'login' );
+        }
+
+        // Check for authentication
+        function isAuthenticated() {
+            $cookieUser = $this->getCookie( $this->cookieNameUser );
+            $cookiePass = $this->getCookie( $this->cookieNamePass );
+            if ( ! empty( $cookieUser ) && ! empty( $cookiePass ) ) {
+                $fields = array( 'loginName' => $cookieUser, 'loginPass' => $cookiePass );
+                if ( $this->checkLogin( $fields, true ) === true ) {
+                    $this->authenticationSucceeded();
+                    return true;
+                }
+            }
+            return false;
+        }
+
+        // Redirect to the login if the authentication failed
+        function authenticationFailed() {
+            $this->forward( 'login' );
+        }
+
+        // Function to check the login
+        function checkLogin( $fields, $md5=false ) {
+            if ( $md5 === false ) {
+                $fields['loginPass'] = md5( $fields['loginPass'] );
+            }
+            $db = YDDatabase::getNamedInstance();
+            $result = $db->getRecord(
+                'SELECT * FROM #_users WHERE name = \'' . $db->escape( $fields['loginName'] ) . '\' AND password = \'' . $db->escape( $fields['loginPass'] ) . '\''
+            );
+            if ( $result === false ) {
+                return array( '__ALL__' => t( 'err_login_all' ) );
+            } else {
+                $GLOBALS['user'] = $result;
+                return true;
+            }
+        }
+
+    }
+
+    // Define a CMS module
+    class YDSimpleCMSModule extends YDBase {
+
+        // Class variables
+        var $name          = 'SimpleCMS Generic Module';
+        var $description   = 'Base module for all the SimpleCMS modules.';
+        var $version       = '1.0';
+        var $authorName    = 'Pieter Claerhout';
+        var $authorEmail   = 'pieter at yellowduck.be';
+        var $authorUrl     = 'http://www.yellowduck.be';
+        var $manager       = null;
+        var $currentScope  = null;
+        var $currentAction = null;
+
+        // Constructor
+        function YDSimpleCMSModule( $manager ) {
+            $this->manager = & $manager;
+            $this->tpl = new YDSimpleCMSTemplate( 'public' );
+        }
+
+        // Check if the module is required or not
+        function isRequired() {
+            return ! is_file( YD_SIMPLECMS_MODULE_DIR . '/' . $this->getClassName() . YD_SIMPLECMS_MODULE_EXT );
+        }
+
+        // Get the module name
+        function getModuleName() {
+            return substr( $this->getClassName(), strlen( YD_SIMPLECMS_MODULE_PREFIX ) );
+        }
+
+        // Display the module
+        function display( $name='' ) {
+
+            // Assign the standard variables
+            $this->tpl->assign( 'currentAction', $this->currentAction );
+            $this->tpl->assign( 'currentScope',  $this->currentScope );
+            $this->tpl->assign( 'adminMenu',     $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
+            if ( isset( $GLOBALS['user'] ) ) {
+                $this->tpl->assign( 'currentUser', $GLOBALS['user'] );
+            }
+
+            // Get the template name
+            if ( $name == '' ) {
+                $name = $this->getModuleName();
+            }
+
+            // Display the template
+            $this->tpl->displayWithMaster( $name );
+
+        }
+
+        // Run an action in the module
+        function runAction( $scope, $action ) {
+
+            // Get the function name
+            $moduleFunctionName = YD_SIMPLECMS_ACTION_PREFIX . $scope . '_' . $action;
+
+            // Check if the function exists
+            if ( ! $this->hasMethod( $moduleFunctionName ) ) {
+                YDSimpleCMSShowError( 'Module %s function not found: %s', $this->getModuleName(), $moduleFunctionName );
+            }
+
+            // Set the variables
+            $this->currentScope  = $scope;
+            $this->currentAction = $action;
+
+            // Execute the function
+            call_user_func( array( $this, $moduleFunctionName ) );
+
+        }
+
+    }
+
+    // The module manager class
+    class YDSimpleCMSModuleManager extends YDBase {
+
+        // Load the plugins
+        function loadAllModules() {
+
+            // Include the modules if any
+            if ( is_dir( YD_SIMPLECMS_MODULE_DIR ) ) {
+
+                // Convert it to a directory object
+                $modulesDir = new YDFSDirectory( YD_SIMPLECMS_MODULE_DIR );
+
+                // Load the modules
+                foreach ( $modulesDir->getContents( YD_SIMPLECMS_MODULE_PATTERN ) as $module ) {
+                    include_once( $module->getAbsolutePath() );
+                }
+
+            }
+
+        }
+
+        // Run a module
+        function runModule( $scope, $module, $action ) {
+
+            // Convert everything to lowercase
+            $scope  = strtolower( $scope );
+            $module = strtolower( $module );
+            $action = strtolower( $action );
+
+            // Get the classname for the module
+            $moduleClassName = YD_SIMPLECMS_MODULE_PREFIX . $module;
+
+            // Check if the class exists
+            if ( ! class_exists( $moduleClassName ) ) {
+                YDSimpleCMSShowError( 'Module class not found: %s', $moduleClassName );
+            }
+
+            // Create the class instance
+            $moduleInstance = new $moduleClassName( $this );
+
+            // Set the correct template scope
+            $moduleInstance->tpl->scope = $scope;
+
+            // Sort the admin menu items
+            if ( $scope == 'admin' ) {
+                ksort( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
+                foreach ( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] as $key=>$val ) {
+                    if ( isset( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'][$key]['children'] ) ) {
+                        ksort( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'][$key]['children'] );
+                    }
+                }
+                $moduleInstance->tpl->assign( 'adminMenu', $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
+            }
+
+            // Create a link to ourselves
+            $moduleInstance->manager = & $this;
+
+            // Run the action
+            $moduleInstance->runAction( $scope, $action );
+
+        }
+
+        // Get the list of modules
+        function getModuleList() {
+            $modules = array();
+            foreach ( get_declared_classes() as $class ) {
+                if ( substr( $class, 0, strlen( YD_SIMPLECMS_MODULE_PREFIX ) ) == YD_SIMPLECMS_MODULE_PREFIX ) {
+                    $modules[$class] = new $class( $this );
+                }
+            }
+            return $modules;
+        }
+
+    }
+
+    // Function to show an error
+    function YDSimpleCMSShowError() {
+        $args = func_get_args();
+        if ( sizeof( $args > 0 ) ) {
+            $args[0] = '<font color="red"><b>ERROR:</b> ' . $args[0] . '</font>';
+        }
+        call_user_func_array( 'printf', $args );
+        die();
+    }
+
+    // Function to run a CMS app
+    function YDSimpleCMSRunRequest( $baseClass ) {
+        $baseClass = ( strtolower( $baseClass ) == 'public' ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
+        $clsInst = new YDExecutor( $baseClass . '.php' );
+        @session_start();
+        $clsInst->execute();
+    }
+
+    // Function to add an admin menu item
+    function YDSimpleCMSAddAdminMenu( $title, $subtitle, $module, $action ) {
+
+        // Link to the menu items
+        $menu = & $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'];
+
+        // Construct the URL
+        $url = YD_SELF_SCRIPT . '?module=' . $module . '&action=' . $action;
+
+        // Add the first level if needed
+        if ( ! isset( $menu[$title] ) ) {
+            $menu[$title] = array();
+            $menu[$title]['title']    = $title;
+            $menu[$title]['children'] = array();
+        }
+
+        // Check if we have a subname or not
+        if ( $subtitle == null ) {
+            $menu[$title]['url'] = $url;
+        } else {
+            if ( ! isset( $menu[$title][ $action ] ) ) {
+                $menu[$title]['children'][$subtitle] = array();
+                $menu[$title]['children'][$subtitle]['title'] = $subtitle;
+                $menu[$title]['children'][$subtitle]['url']   = $url;
+            }
+        }
+
+    }
+
+    // Add menu items
+    YDSimpleCMSAddAdminMenu( 'Admin',   null,       'admin', 'show' );
+    YDSimpleCMSAddAdminMenu( 'Admin',   'Logout',   'admin', 'logout' );
+    YDSimpleCMSAddAdminMenu( 'Content', 'Pages',    'page',  'show' );
+    YDSimpleCMSAddAdminMenu( 'Options', 'Modules',  'admin', 'modules' );
+    YDSimpleCMSAddAdminMenu( 'Options', 'Settings', 'admin', 'settings' );
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-22 08:11:59 UTC (rev 2329)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-22 11:21:34 UTC (rev 2330)
@@ -0,0 +1,60 @@
+<?php
+
+    // The page module
+    class module_page extends YDSimpleCMSModule {
+
+        // Class variables
+        var $name        = 'SimpleCMS Page Module';
+        var $description = 'SimpleCMS module to manage pages.';
+        var $version     = '1.0';
+        var $authorName  = 'Pieter Claerhout';
+        var $authorEmail = 'pieter at yellowduck.be';
+        var $authorUrl   = 'http://www.yellowduck.be';
+
+        // Public main function
+        function action_public_show() {
+            $this->display();
+        }
+
+        // Admin main function
+        function action_admin_show() {
+            $this->display();
+        }
+
+    }
+
+    // The admin module
+    class module_admin extends YDSimpleCMSModule {
+
+        // Class variables
+        var $name         = 'SimpleCMS Admin Module';
+        var $description  = 'SimpleCMS module to manage everything ;-)';
+        var $version      = '1.0';
+        var $authorName   = 'Pieter Claerhout';
+        var $authorEmail  = 'pieter at yellowduck.be';
+        var $authorUrl    = 'http://www.yellowduck.be';
+
+        // Admin main function
+        function action_admin_show() {
+            $this->display();
+        }
+
+        // Admin logout function
+        function action_admin_logout() {
+            YDRequest::redirect( YD_SELF_SCRIPT . '?do=logout' );
+        }
+
+        // List the plugins
+        function action_admin_modules() {
+            $this->tpl->assign( 'modules', $this->manager->getModuleList() );
+            $this->display();
+        }
+
+        // The settings action
+        function action_admin_settings() {
+            $this->display();
+        }
+
+    }
+
+?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Mon Jan 22 12:28:54 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 12:28:54 +0100
Subject: [ydf-devel] r2331 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDSimpleCMS examples/simplecms
	examples/simplecms/includes/modules
Message-ID: <200701221128.l0MBSs8Q007523@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 12:28:52 +0100 (Mon, 22 Jan 2007)
New Revision: 2331

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/examples/simplecms/admin.php
   YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php
   YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php
   YDFramework2.0/trunk/examples/simplecms/index.php
Log:
Did some refactoring and cleaning up of the YDSimpleCMS package.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 11:21:34 UTC (rev 2330)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 11:28:52 UTC (rev 2331)
@@ -60,6 +60,59 @@
     // The database connection
     $GLOBALS['db'] = YDDatabase::getNamedInstance();
 
+    // Global YDSimpleCMS class
+    class YDSimpleCMS extends YDBase {
+
+        // Run the request in the indicated scope
+        // @static
+        function run( $scope ) {
+            $baseClass = ( strtolower( $scope ) == 'public' ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
+            $clsInst = new YDExecutor( $baseClass . '.php' );
+            @session_start();
+            $clsInst->execute();
+        }
+
+        // Function to show an error
+        function showError() {
+            $args = func_get_args();
+            if ( sizeof( $args > 0 ) ) {
+                $args[0] = '<font color="red"><b>ERROR:</b> ' . $args[0] . '</font>';
+            }
+            call_user_func_array( 'printf', $args );
+            die();
+        }
+
+        // Function to add an admin menu item
+        function addAdminMenu( $title, $subtitle, $module, $action ) {
+
+            // Link to the menu items
+            $menu = & $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'];
+
+            // Construct the URL
+            $url = YD_SELF_SCRIPT . '?module=' . $module . '&action=' . $action;
+
+            // Add the first level if needed
+            if ( ! isset( $menu[$title] ) ) {
+                $menu[$title] = array();
+                $menu[$title]['title']    = $title;
+                $menu[$title]['children'] = array();
+            }
+
+            // Check if we have a subname or not
+            if ( $subtitle == null ) {
+                $menu[$title]['url'] = $url;
+            } else {
+                if ( ! isset( $menu[$title][ $action ] ) ) {
+                    $menu[$title]['children'][$subtitle] = array();
+                    $menu[$title]['children'][$subtitle]['title'] = $subtitle;
+                    $menu[$title]['children'][$subtitle]['url']   = $url;
+                }
+            }
+
+        }
+
+    }
+
     // Override the template class
     class YDSimpleCMSTemplate extends YDTemplate {
 
@@ -116,23 +169,11 @@
 
         // Default action
         function actionDefault() {
-
-            // Instantiate the module manager
-            YDGlobalTimerMarker( 'Instantiate module manager' );
             $moduleManager = new YDSimpleCMSModuleManager();
-
-            // Load the modules
-            YDGlobalTimerMarker( 'Loading all modules' );
             $moduleManager->loadAllModules();
-
-            // Get the parameters from the query string
             $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
             $action = $this->getQueryStringParameter( 'action', 'show' );
-
-            // Run the module
-            YDGlobalTimerMarker( 'Running module' );
             $moduleManager->runModule( $this->requestScope, $module, $action );
-
         }
 
     }
@@ -292,43 +333,27 @@
 
         // Display the module
         function display( $name='' ) {
-
-            // Assign the standard variables
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
             $this->tpl->assign( 'adminMenu',     $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
             if ( isset( $GLOBALS['user'] ) ) {
                 $this->tpl->assign( 'currentUser', $GLOBALS['user'] );
             }
-
-            // Get the template name
             if ( $name == '' ) {
                 $name = $this->getModuleName();
             }
-
-            // Display the template
             $this->tpl->displayWithMaster( $name );
-
         }
 
         // Run an action in the module
         function runAction( $scope, $action ) {
-
-            // Get the function name
             $moduleFunctionName = YD_SIMPLECMS_ACTION_PREFIX . $scope . '_' . $action;
-
-            // Check if the function exists
             if ( ! $this->hasMethod( $moduleFunctionName ) ) {
-                YDSimpleCMSShowError( 'Module %s function not found: %s', $this->getModuleName(), $moduleFunctionName );
+                YDSimpleCMS::showError( 'Module %s function not found: %s', $this->getModuleName(), $moduleFunctionName );
             }
-
-            // Set the variables
             $this->currentScope  = $scope;
             $this->currentAction = $action;
-
-            // Execute the function
             call_user_func( array( $this, $moduleFunctionName ) );
-
         }
 
     }
@@ -338,20 +363,12 @@
 
         // Load the plugins
         function loadAllModules() {
-
-            // Include the modules if any
             if ( is_dir( YD_SIMPLECMS_MODULE_DIR ) ) {
-
-                // Convert it to a directory object
                 $modulesDir = new YDFSDirectory( YD_SIMPLECMS_MODULE_DIR );
-
-                // Load the modules
                 foreach ( $modulesDir->getContents( YD_SIMPLECMS_MODULE_PATTERN ) as $module ) {
                     include_once( $module->getAbsolutePath() );
                 }
-
             }
-
         }
 
         // Run a module
@@ -367,7 +384,7 @@
 
             // Check if the class exists
             if ( ! class_exists( $moduleClassName ) ) {
-                YDSimpleCMSShowError( 'Module class not found: %s', $moduleClassName );
+                YDSimpleCMS::showError( 'Module class not found: %s', $moduleClassName );
             }
 
             // Create the class instance
@@ -408,58 +425,11 @@
 
     }
 
-    // Function to show an error
-    function YDSimpleCMSShowError() {
-        $args = func_get_args();
-        if ( sizeof( $args > 0 ) ) {
-            $args[0] = '<font color="red"><b>ERROR:</b> ' . $args[0] . '</font>';
-        }
-        call_user_func_array( 'printf', $args );
-        die();
-    }
-
-    // Function to run a CMS app
-    function YDSimpleCMSRunRequest( $baseClass ) {
-        $baseClass = ( strtolower( $baseClass ) == 'public' ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
-        $clsInst = new YDExecutor( $baseClass . '.php' );
-        @session_start();
-        $clsInst->execute();
-    }
-
-    // Function to add an admin menu item
-    function YDSimpleCMSAddAdminMenu( $title, $subtitle, $module, $action ) {
-
-        // Link to the menu items
-        $menu = & $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'];
-
-        // Construct the URL
-        $url = YD_SELF_SCRIPT . '?module=' . $module . '&action=' . $action;
-
-        // Add the first level if needed
-        if ( ! isset( $menu[$title] ) ) {
-            $menu[$title] = array();
-            $menu[$title]['title']    = $title;
-            $menu[$title]['children'] = array();
-        }
-
-        // Check if we have a subname or not
-        if ( $subtitle == null ) {
-            $menu[$title]['url'] = $url;
-        } else {
-            if ( ! isset( $menu[$title][ $action ] ) ) {
-                $menu[$title]['children'][$subtitle] = array();
-                $menu[$title]['children'][$subtitle]['title'] = $subtitle;
-                $menu[$title]['children'][$subtitle]['url']   = $url;
-            }
-        }
-
-    }
-
     // Add menu items
-    YDSimpleCMSAddAdminMenu( 'Admin',   null,       'admin', 'show' );
-    YDSimpleCMSAddAdminMenu( 'Admin',   'Logout',   'admin', 'logout' );
-    YDSimpleCMSAddAdminMenu( 'Content', 'Pages',    'page',  'show' );
-    YDSimpleCMSAddAdminMenu( 'Options', 'Modules',  'admin', 'modules' );
-    YDSimpleCMSAddAdminMenu( 'Options', 'Settings', 'admin', 'settings' );
+    YDSimpleCMS::addAdminMenu( 'Admin',   null,       'admin', 'show' );
+    YDSimpleCMS::addAdminMenu( 'Admin',   'Logout',   'admin', 'logout' );
+    YDSimpleCMS::addAdminMenu( 'Content', 'Pages',    'page',  'show' );
+    YDSimpleCMS::addAdminMenu( 'Options', 'Modules',  'admin', 'modules' );
+    YDSimpleCMS::addAdminMenu( 'Options', 'Settings', 'admin', 'settings' );
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/simplecms/admin.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-22 11:21:34 UTC (rev 2330)
+++ YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-22 11:28:52 UTC (rev 2331)
@@ -4,6 +4,6 @@
     include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
 
     // Run the CMS request
-    YDSimpleCMSRunRequest( 'admin' );
+    YDSimpleCMS::run( 'admin' );
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php	2007-01-22 11:21:34 UTC (rev 2330)
+++ YDFramework2.0/trunk/examples/simplecms/includes/modules/module_contactus.php	2007-01-22 11:28:52 UTC (rev 2331)
@@ -18,6 +18,6 @@
     }
 
     // Add menu items
-    YDSimpleCMSAddAdminMenu( 'Content',    'Contact Us', 'contactus', 'show' );
+    YDSimpleCMS::addAdminMenu( 'Content',    'Contact Us', 'contactus', 'show' );
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php	2007-01-22 11:21:34 UTC (rev 2330)
+++ YDFramework2.0/trunk/examples/simplecms/includes/modules/module_newsletter.php	2007-01-22 11:28:52 UTC (rev 2331)
@@ -18,7 +18,7 @@
     }
 
     // Add menu items
-    YDSimpleCMSAddAdminMenu( 'Newsletters', 'Create Newsletter',    'newsletter', 'create' );
-    YDSimpleCMSAddAdminMenu( 'Newsletters', 'Archived Newsletters', 'newsletter', 'show' );
+    YDSimpleCMS::addAdminMenu( 'Newsletters', 'Create Newsletter',    'newsletter', 'create' );
+    YDSimpleCMS::addAdminMenu( 'Newsletters', 'Archived Newsletters', 'newsletter', 'show' );
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/simplecms/index.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-22 11:21:34 UTC (rev 2330)
+++ YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-22 11:28:52 UTC (rev 2331)
@@ -4,6 +4,6 @@
     include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
 
     // Run the CMS request
-    YDSimpleCMSRunRequest( 'public' );
+    YDSimpleCMS::run( 'public' );
 
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Mon Jan 22 13:09:10 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 13:09:10 +0100
Subject: [ydf-devel] r2332 - in YDFramework2.0/trunk: YDFramework2
	YDFramework2/YDClasses YDFramework2/addons/YDAjax
	YDFramework2/addons/YDBBCode YDFramework2/addons/YDCMComponent
	YDFramework2/addons/YDDatabaseObject doc
Message-ID: <200701221209.l0MC9ARI000411@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 13:09:08 +0100 (Mon, 22 Jan 2007)
New Revision: 2332

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/doc/docs_api.dxy
Log:
Update the api documentation and added the missing documentation parts. YDSimpleCMS still needs to be done though.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -67,9 +67,6 @@
      *  - getPageUrl: the URL of the given page
      *
      *  All these options are available as class variables.
-     *
-     *  @todo
-     *      Improve performance with very large recordsets (millions of rows).
      */
     class YDRecordSet extends YDBase {
 
@@ -544,6 +541,8 @@
          *                          YD_BROWSEBAR_FULL. The full one shows all page numbers, the short one doesn't.
          *  @param  $currentLink    (optional) Boolean indicating if you should be able to click on the link for the
          *                          current page or not.
+         *  @param  $allLink        (optional) If not null or empty, a link to show all records is added. The contents
+         *                          of this variable is used as the title for the link.
          *
          *  @returns    The browsebar as formatted HTML.
          */
@@ -1071,9 +1070,6 @@
 
          *
          *  @returns    The records matching the SQL statement as a YDRecordSet object.
-         *
-         *  @todo
-         *      Performance needs to be improved. This is a quick and dirty solution right now.
          */
         function getRecordsAsSet( $sql, $page=-1, $pagesize=-1, $pagevar = 'page', $sizevar = 'size' ) {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -253,6 +253,8 @@
          *
          *  @param $id             The ID of the node to fetch child data for.
          *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *  @param $specificPart   (optional) Whether or not we want a specific column. Use the name of the column if
+         *                         want one, otherwise, set to null to get all columns.
          *
          *  @returns The children of the passed node
          */

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -107,7 +107,7 @@
         /**
          *  This function defines the order used in all SELECTS
          *
-         *  @param $string  The sql order string.
+         *  @param $sql  The sql order string.
          */
         function setOrder( $sql ){
 
@@ -666,9 +666,9 @@
         /**
          *  Move a node to a different parent node.
          *
-         *  @param  $id         	The ID of the node to move
+         *  @param  $id             The ID of the node to move
          *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
-         *  @param  $position   	(optional) The new position.
+         *  @param  $new_position   (optional) The new position.
          */
         function moveNode( $id, $new_parent_id = null, $new_position = null ) {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -122,7 +122,7 @@
          *  @param $columns		    The number of columns the table should have.
          *  @param $fillLastRow	    (optional) If true, the last row will be filled with null values so that it matches
          *						    the number of columns.
-         *  @param $horizontally	(optional) If true, rows will be filled first, then it will create an new row
+         *  @param $horizontal  	(optional) If true, rows will be filled first, then it will create an new row
          *
          *  @returns	A multi-dimension array with the contents of the original array converted to a table with the
          *				indicated number of colums.
@@ -386,7 +386,7 @@
         /**
          *  Trigger an error
          *
-         *  @param  $error  The error to raise.
+         *  @param  $msg    The error to raise.
          *  @param  $sql    (optional) The SQL statement to log with the error.
          *  @param  $level  (optional) The type of error to be raised. Default is YD_ERROR.
          */

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -280,7 +280,8 @@
     /**
      *  This function is used to load translations from a $GLOBALS['t'] array.
      *
-     *  @param  $t  The name of the translated string.
+     *  @param  $t      The name of the translated string.
+     *  @param  $params (optional) An array of parameters that are passed to the sprintf function.
      *
      *  @returns    The translated string.
      */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -652,6 +652,7 @@
          *	This is a helper method to compute all JS that is needed to get a form element
          *
          *	@param $formElement			Form element object
+         *  @param $options             The options for the form element
          */		
 		function __getJSFormElement( $formElement, $options ){
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -163,11 +163,11 @@
         /**
          *  Function to handle the code tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -186,11 +186,11 @@
         /**
          *  Function to handle the color tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -209,11 +209,11 @@
         /**
          *  Function to handle the size tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -232,11 +232,11 @@
         /**
          *  Function to handle the quote tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -254,11 +254,11 @@
         /**
          *  Function to handle the url tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -277,11 +277,11 @@
         /**
          *  Function to handle the email tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */
@@ -300,11 +300,11 @@
         /**
          *  Function to handle the img tag.
          *
-         *  @params $action         The action that is executed.
-         *  @params $attributes     The attributes specified in the tag
-         *  @params $content        The content value of the tag.
-         *  @params $params         The parameters for the tag
-         *  @params $node_object    A reference to the node object.
+         *  @param $action         The action that is executed.
+         *  @param $attributes     The attributes specified in the tag
+         *  @param $content        The content value of the tag.
+         *  @param $params         The parameters for the tag
+         *  @param $node_object    A reference to the node object.
          *
          *  @returns    The html version of the tag.
          */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -155,7 +155,7 @@
         /**
          *  This method return an element
          *
-         *  @param $is  Id to search for
+         *  @param $id  Id to search for
          *
          *  @returns    Element as array
          */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -112,6 +112,7 @@
          *  This method adds form elements for group editing
 		 *
 		 * @param $group_id     Group id to edit
+		 * @param $permObj    The permission object.
          */
 		function & addFormEdit( $group_id, $permObj = null ){
 
@@ -125,7 +126,8 @@
         /**
          *  This method adds form elements for addind a new group
 		 *
-		 * @param $parent_group_id    Parent id (a user id)
+		 * @param $user_id    User ID
+		 * @param $permObj    The permission object.
          */
 		function & addFormNew( $user_id, $permObj = null ){
 
@@ -143,6 +145,7 @@
          *                      If you will ADD a new group this is the parent id. Use NULL to add it to the root tree
          *
 		 * @param $edit         TRUE: We are editing a group, FALSE: we are creating a group
+		 * @param $permObj    The permission object.
          */
 		function & _addFormDetails( $id, $edit, $permObj ){
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -242,6 +242,7 @@
          *  This function returns a class description
          *
          *  @param     $class    Class name
+         *  @param     $title    The title for the class
          *
          *  @returns   description STRING
          */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -153,7 +153,7 @@
         /**
          *  This method deletes a user (and all children) or just the children
          *
-         *  @param $userobject_id  Userobject id
+         *  @param $user_id       Userobject id
          *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
          *
          *  @returns    YDResult object. OK      - user deleted

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -85,7 +85,7 @@
          *  This method returns an associative array of nodes that belogs to a specific type
          *
          *  @param $type       Node type (or array of types)
-         *  @param $attribute  (Optional) Attribute name or (array of attributes) to get only
+         *  @param $attributes (Optional) Attribute name or (array of attributes) to get only
          *
          *  @returns    Associative array
          */

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-22 12:09:08 UTC (rev 2332)
@@ -1046,7 +1046,7 @@
          *  @param $messages   (optional) Array with predefined messages:
          *                                'ok' for ok message, 'error' for fatal messages, 'form_err' for no validation
          *
-         *  @param $forvalues  (optional) Custom form validation values
+         *  @param $formvalues (optional) Custom form validation values
          *
          *  @param $onDate     (optional) When element is a date (read: array ), we should convert to this format. Default: 'datetimesql'
          *

Modified: YDFramework2.0/trunk/doc/docs_api.dxy
===================================================================
--- YDFramework2.0/trunk/doc/docs_api.dxy	2007-01-22 11:28:52 UTC (rev 2331)
+++ YDFramework2.0/trunk/doc/docs_api.dxy	2007-01-22 12:09:08 UTC (rev 2332)
@@ -12,32 +12,32 @@
 EXTRACT_PRIVATE        = NO
 EXTRACT_STATIC         = NO
 EXTRACT_LOCAL_CLASSES  = YES
-HIDE_UNDOC_MEMBERS     = YES
-HIDE_UNDOC_CLASSES     = YES
+HIDE_UNDOC_MEMBERS     = NO
+HIDE_UNDOC_CLASSES     = NO
 HIDE_FRIEND_COMPOUNDS  = NO
 #HIDE_IN_BODY_DOCS      = NO
 BRIEF_MEMBER_DESC      = NO
 REPEAT_BRIEF           = NO
 ALWAYS_DETAILED_SEC    = NO
 INLINE_INHERITED_MEMB  = YES
-FULL_PATH_NAMES        = NO
-STRIP_FROM_PATH        = 
+FULL_PATH_NAMES        = YES
+STRIP_FROM_PATH        = "C:/Program Files/Apache/htdocs/ydframework"
 INTERNAL_DOCS          = YES
 CASE_SENSE_NAMES       = YES
 SHORT_NAMES            = NO
 HIDE_SCOPE_NAMES       = YES
-SHOW_INCLUDE_FILES     = YES
+SHOW_INCLUDE_FILES     = NO
 JAVADOC_AUTOBRIEF      = NO
 MULTILINE_CPP_IS_BRIEF = NO
 DETAILS_AT_TOP         = NO
-INHERIT_DOCS           = YES
+INHERIT_DOCS           = NO
 INLINE_INFO            = YES
 SORT_MEMBER_DOCS       = YES
 DISTRIBUTE_GROUP_DOC   = NO
 TAB_SIZE               = 4
 GENERATE_TODOLIST      = YES
-GENERATE_TESTLIST      = YES
-GENERATE_BUGLIST       = YES
+GENERATE_TESTLIST      = NO
+GENERATE_BUGLIST       = NO
 GENERATE_DEPRECATEDLIST= YES
 ALIASES                = 
 ENABLED_SECTIONS       = 
@@ -68,7 +68,11 @@
                          "../YDFramework2/addons/YDPdfReport/html2pdf.php" \
                          "../YDFramework2/addons/YDPdfReport/font" \
                          "../YDFramework2/addons/YDXmlForm/xmlize.inc.php" \
-                         "../YDFramework2/addons/YDAjax/xajax.inc.php"
+                         "../YDFramework2/addons/YDBBCode/stringparser.class.php" \
+                         "../YDFramework2/addons/YDBBCode/stringparser_bbcode.class.php" \
+                         "../YDFramework2/addons/YDAjax/xajax.inc.php" \
+                         "../YDFramework2/addons/YDAjax/xajaxResponse.inc.php" \
+                         "../YDFramework2/addons/YDCMComponent/languages"
 EXCLUDE_SYMLINKS       = NO
 EXCLUDE_PATTERNS       = 
 EXAMPLE_PATH           = 



From pclaerhout at mail.berlios.de  Mon Jan 22 14:41:11 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 14:41:11 +0100
Subject: [ydf-devel] r2333 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701221341.l0MDfBXS026166@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 14:41:11 +0100 (Mon, 22 Jan 2007)
New Revision: 2333

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Added placeholder functions to YDSimpleCMSModule that will allow the install/uninstall of a module.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 12:09:08 UTC (rev 2332)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 13:41:11 UTC (rev 2333)
@@ -321,6 +321,14 @@
             $this->tpl = new YDSimpleCMSTemplate( 'public' );
         }
 
+        // Install the module
+        function install() {
+        }
+
+        // Uninstall the module
+        function uninstall() {
+        }
+
         // Check if the module is required or not
         function isRequired() {
             return ! is_file( YD_SIMPLECMS_MODULE_DIR . '/' . $this->getClassName() . YD_SIMPLECMS_MODULE_EXT );



From pclaerhout at mail.berlios.de  Mon Jan 22 17:05:40 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 17:05:40 +0100
Subject: [ydf-devel] r2334 - in YDFramework2.0/trunk/YDFramework2: .
	YDClasses YDClasses/YDDatabaseDrivers
	YDClasses/YDFormElements YDClasses/YDFormRenderers
	addons/YDAjax addons/YDAkismet addons/YDBBCode
	addons/YDCMComponent addons/YDCaptcha addons/YDCart
	addons/YDDatabaseObject addons/YDDatabaseQuery
	addons/YDDatabaseQuery/YDDatabaseQueryDrivers
	addons/YDFeedCreator addons/YDGraph addons/YDGraphPie
	addons/YDInstaller addons/YDLoadconfig addons/YDMysqlDump
	addons/YDPdfReport addons/YDSimpleCMS
Message-ID: <200701221605.l0MG5eEk004775@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 17:05:35 +0100 (Mon, 22 Jan 2007)
New Revision: 2334

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
   YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
   YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php
   YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php
   YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
   YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php
   YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
   YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
   YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
Log:
Added modules to API documentation to make it easier to browse through the API docs.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -67,6 +71,8 @@
      *  - getPageUrl: the URL of the given page
      *
      *  All these options are available as class variables.
+     *
+     *  @ingroup YDDatabase
      */
     class YDRecordSet extends YDBase {
 
@@ -614,6 +620,8 @@
 
     /**
      *  This class defines a database object.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabase extends YDBase {
 
@@ -795,6 +803,8 @@
 
     /**
      *  This class defines a database driver.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseDriver extends YDBase {
 
@@ -1552,6 +1562,8 @@
 
     /**
      *  This class defines a database driver for MySQL.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseDriver_mysql extends YDDatabaseDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This class defines a database driver for Oracle8i using the OCI8 interface.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseDriver_oracle extends YDDatabaseDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This class defines a database driver for PostgreSQL.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseDriver_postgres extends YDDatabaseDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This class defines a database driver for SQLite.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseDriver_sqlite extends YDDatabaseDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
     /**
      *  This class allows you to query the internal metadata from a database. It allows you to list tables, fields and
      *  indexes for all supported database engines in the Yellow Duck Framework.
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseMetaData extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
     /**
      *  This class implements a database tree as described on:
      *  http://www.phpriot.com/d/articles/php/application-design/nested-trees-2/
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseTree extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,36 +35,36 @@
 
     /**
      *  This class implements a database tree
-
-	    CREATE TABLE nested_tree (
-            id int NOT NULL auto_increment,
-            parent_id int NULL,
-			lineage varchar(255) NOT NULL default '//',
-            level int NOT NULL default '1',
-            position int NOT NULL default '1',
-            title varchar(255) NOT NULL default '',
-            PRIMARY KEY (id),
-			FOREIGN KEY (parent_id)
-                REFERENCES nested_tree(id)
-                     ON DELETE CASCADE
-                     ON UPDATE CASCADE
-        );
-
-
-        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
-        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
-        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
-        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
-        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
-        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
-        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-        INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
-        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
-        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-        INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
-        INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
+     *
+     *  CREATE TABLE nested_tree (
+     *      id int NOT NULL auto_increment,
+     *      parent_id int NULL,
+     *      lineage varchar(255) NOT NULL default '//',
+     *      level int NOT NULL default '1',
+     *      position int NOT NULL default '1',
+     *      title varchar(255) NOT NULL default '',
+     *      PRIMARY KEY (id),
+     *      FOREIGN KEY (parent_id)
+     *          REFERENCES nested_tree(id)
+     *               ON DELETE CASCADE
+     *               ON UPDATE CASCADE
+     *  );
+     *
+     *  INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+     *  INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+     *  INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+     *  INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+     *  INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+     *  INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+     *  INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+     *  INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
+     *  INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
+     *  INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+     *  INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
+     *  INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
+     *
+     *  @ingroup YDDatabase
      */
-
     class YDDatabaseTree2 extends YDBase {
 
         /**

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,23 +35,23 @@
 
 
     /** Database scheme example
-		
-	    CREATE TABLE nested_tree (
+        
+        CREATE TABLE nested_tree (
             id int NOT NULL auto_increment,
             parent_id int NULL,
-			lineage varchar(255) NOT NULL default '//',
+            lineage varchar(255) NOT NULL default '//',
             level int NOT NULL default '1',
             position int NOT NULL default '1',
             title varchar(255) NOT NULL default '',
             PRIMARY KEY (id),
-			FOREIGN KEY (parent_id)
+            FOREIGN KEY (parent_id)
                 REFERENCES nested_tree(id)
                      ON DELETE CASCADE
                      ON UPDATE CASCADE
         )TYPE=InnoDB;
-
-		Note: root node must have ID 1, PARENT null and LINEAGE '' !
-
+    
+        Note: root node must have ID 1, PARENT null and LINEAGE '' !
+       
         INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
         INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
         INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
@@ -64,6 +68,8 @@
 
     /**
      *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject
+     *
+     *  @ingroup YDDatabase
      */
     class YDDatabaseTree3 extends YDDatabaseObject {
     

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDate.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -33,6 +37,8 @@
      *  This class defines a YDDateFormat object.
      *
      *  @author  David Bittencourt <muitocomplicado at hotmail.com>
+     *
+     *  @ingroup YDFramework
      */
     class YDDateFormat extends YDBase {
         
@@ -159,6 +165,8 @@
      *  This class defines a YDDate object.
      *
      *  @author  David Bittencourt <muitocomplicado at hotmail.com>
+     *
+     *  @ingroup YDFramework
      */
     class YDDate extends YDBase {
         

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDEmail.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -37,6 +41,8 @@
 
     /**
      *	This class defines an email message.
+     *
+     *  @ingroup YDFramework
      */
     class YDEmail extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDEncryption.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -28,6 +32,8 @@
 
     /**
      *  This class is able to encrypt and decrypt data.
+     *
+     *  @ingroup YDFramework
      */
     class YDEncryption extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDError.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -57,6 +61,8 @@
 
     /**
      *  This class defines an YDError object.
+     *
+     *  @ingroup YDFramework
      */
     class YDError extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -126,6 +130,8 @@
 
     /**
      *	This class houses all different path related functions.
+     *
+     *  @ingroup YDFramework
      */
     class YDPath extends YDBase {
 
@@ -458,6 +464,8 @@
 
     /**
      *  This class defines a filesystem file.
+     *
+     *  @ingroup YDFramework
      */
     class YDFSFile extends YDBase {
 
@@ -855,6 +863,8 @@
 
     /**
      *	This class defines an image file.
+     *
+     *  @ingroup YDFramework
      */
     class YDFSImage extends YDFSFile {
 
@@ -1240,6 +1250,8 @@
 
     /**
      *  This class defines a filesystem directory.
+     *
+     *  @ingroup YDFramework
      */
     class YDFSDirectory extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -37,6 +41,8 @@
 
     /**
      *  This class defines an object oriented HTML form.
+     *
+     *  @ingroup YDForm
      */
     class YDForm extends YDBase {
 
@@ -1266,6 +1272,8 @@
 
     /**
      *  This is the base class for all form elements.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement extends YDBase {
 
@@ -1654,6 +1662,8 @@
 
     /**
      *  This is the class that is able to render a form object to whatever.
+     *
+     *  @ingroup YDForm
      */
     class YDFormRenderer extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Autocompleter.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a text form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Autocompleter extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_BBTextArea.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
     /**
      *	This is the class that define a textarea form element that has support for a toolbar which can insert BBCode
      *	style tags to the content.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_BBTextArea extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Button.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Button extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Captcha.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a captcha form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Captcha extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Checkbox.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a checkbox form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Checkbox extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a checkbox form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_CheckboxGroup extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *  This is the class that define a datetime select form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Date extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateSelect.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a datetime select form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_DateSelect extends YDFormElement_Date {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_DateTimeSelect.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a datetime select form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_DateTimeSelect extends YDFormElement_Date {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Div.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Div extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_File.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a file upload form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_File extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Grid.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *        This is the class that defines a simple ajax grid element
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Grid extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Hidden.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a hidden form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Hidden extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Image.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define an image form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Image extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Img.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Img extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Link.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Link extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Password.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a password form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Password extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a radio button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Radio extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Reset.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a reset button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Reset extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Select.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a select button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Select extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a select button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_SelectImage extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Span.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Span extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Submit.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that define a submit button form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Submit extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SwitchMenu.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a switch menu form element
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_SwitchMenu extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Text.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a text form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Text extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextArea.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a text area form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_TextArea extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TextAreaCounter.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a text area form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_TextAreaCounter extends YDFormElement {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_TimeSelect.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that define a datetime select form element.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_TimeSelect extends YDFormElement_Date {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Timezone.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that define a select timezone.
+     *
+     *  @ingroup YDForm
      */
     class YDFormElement_Timezone extends YDFormElement_Select {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This is the class that is able to render a form object to HTML.
+     *
+     *  @ingroup YDForm
      */
     class YDFormRenderer_array extends YDFormRenderer {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -30,7 +34,9 @@
     include_once( YD_DIR_HOME_CLS . '/YDForm.php');
 
     /**
-     *        This is the class that is able to render a form object to HTML.
+     *  This is the class that is able to render a form object to HTML.
+     *
+     *  @ingroup YDForm
      */
     class YDFormRenderer_html extends YDFormRenderer {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_xml.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *	This is the class that is able to render/import a form to/from XML.
+     *
+     *  @ingroup YDForm
      */
     class YDFormRenderer_xml extends YDFormRenderer {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDHttpClient.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -37,6 +41,8 @@
     /**
      *	This is the YDHttpClient class. It extends the HttpClient class and adds support for specifying the content
      *	type.
+     *
+     *  @ingroup YDFramework
      */
     class YDHttpClient extends HttpClient {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDLog.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -47,6 +51,8 @@
 
     /**
      *  This class defines the logging static functions.
+     *
+     *  @ingroup YDFramework
      */
     class YDLog extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -39,6 +43,8 @@
     /**
      *  This class is able to save and load persistent data. This data stay active between different requests and allows
      *  you to share data between different requests and different sessions.
+     *
+     *  @ingroup YDFramework
      */
     class YDPersistent extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -30,6 +34,8 @@
      *	This class implements a request. The request is the base class you can use to base your scripts on. The request
      *	class is the one taking care of the action dispatching when a script is executed. Also the authentication
      *	framework is implemented in this class.
+     *
+     *  @ingroup YDFramework
      */
     class YDRequest extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDResult.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -59,6 +63,8 @@
 
     /**
      *  This class defines an YDResult object.
+     *
+     *  @ingroup YDFramework
      */
     class YDResult extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -45,7 +49,9 @@
         include_once( SMARTY_DIR . '/Smarty.class.php' );
 
         /**
-         *	This class is a wrapper around Smarty. Documentation can be found on: http://smarty.php.net/
+         *  This class is a wrapper around Smarty. Documentation can be found on: http://smarty.php.net/
+         *
+         *  @ingroup YDFramework
          */
         class YDTemplate extends Smarty {
 
@@ -342,7 +348,9 @@
     } else {
 
         /**
-         *	This class is template engine based on PHP.
+         *  This class is template engine based on PHP.
+         *
+         *  @ingroup YDFramework
          */
         class YDTemplate extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -36,6 +40,8 @@
 
     /**
      *  This class defines a url.
+     *
+     *  @ingroup YDFramework
      */
     class YDUrl extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUtil.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -29,6 +33,8 @@
     /**
      *	This is a general timer class that starts counting when it's instantiated, and which returns the elapsed time as
      *	soon as the finish method is called.
+     *
+     *  @ingroup YDFramework
      */
     class YDTimer extends YDBase {
 
@@ -108,6 +114,8 @@
     /**
      *  This class houses all the array related utility functions. All the methods are implemented as static methods and
      *	do not require you to create a class instance in order to use them.
+     *
+     *  @ingroup YDFramework
      */
     class YDArrayUtil extends YDBase {
 
@@ -380,6 +388,8 @@
     /**
      *	This class houses all the debug related utility functions. All the methods are implemented as static methods and
      *	do not require you to create a class instance in order to use them.
+     *
+     *  @ingroup YDFramework
      */
     class YDDebugUtil extends YDBase {
 
@@ -515,6 +525,8 @@
     /**
      *	This class houses all the object and class related utility functions. All the methods are implemented as static
      *	methods and do not require you to create a class instance in order to use them.
+     *
+     *  @ingroup YDFramework
      */
     class YDObjectUtil extends YDBase {
 
@@ -600,6 +612,8 @@
     /**
      *	This class houses all the string related utility functions. All the methods are implemented as static methods
      *	and do not require you to create a class instance in order to use them.
+     *
+     *  @ingroup YDFramework
      */
     class YDStringUtil extends YDBase {
 
@@ -1047,6 +1061,8 @@
     /**
      *	This class uses the HTTP_USER_AGENT varaible to get information about the browser the visitor used to perform
      *	the request. We determine the browser name, the version and the platform it's running on.
+     *
+     *  @ingroup YDFramework
      */
     class YDBrowserInfo extends YDBase {
 
@@ -1230,6 +1246,8 @@
      *  This class allows you to generate GUIDs (global unique identifier).
      *
      *  More info: http://www.ietf.org/rfc/rfc4122.txt
+     *
+     *  @ingroup YDFramework
      */
     class YDGuidUtil extends YDBase {
 
@@ -1270,6 +1288,8 @@
 
     /**
      *  This class allows you to perform LDAP releated tasks.
+     *
+     *  @ingroup YDFramework
      */
     class YDLdapUtil extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDValidateRules.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -28,6 +32,8 @@
 
     /**
      *	This class contains abstract functions implementing the validation rules.
+     *
+     *  @ingroup YDFramework
      */
     class YDValidateRules extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDXml.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -38,6 +42,8 @@
     /**
      *  This class is a wrapper around phpdomxml. Documentation can be found on:
      *  http://phpdomxml.webtweakers.com/
+     *
+     *  @ingroup YDFramework
      */
     class YDXml extends _XML {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDXmlRpc.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -34,6 +38,8 @@
     /**
      *	This is the actual implementation of the YDXmlRpcClient class. It extends the IXR_Client class and adds support
      *	for GZip compressed communications based on the YDHttpClient class.
+     *
+     *  @ingroup YDFramework
      */
     class YDXmlRpcClientCore extends IXR_Client {
 
@@ -124,6 +130,8 @@
 
     /**
      *	This class defines an XML/RPC client.
+     *
+     *  @ingroup YDFramework
      */
     class YDXmlRpcClient extends YDBase {
 
@@ -183,6 +191,8 @@
      *	This class implements the actual XML/RPC server.
      *
      *	@internal
+     *
+     *  @ingroup YDFramework
      */
     class YDXmlRpcServerImpl extends IXR_IntrospectionServer {
 
@@ -249,6 +259,8 @@
      *		When raising errors in this class, make sure you raise the right kind or error. If you have an XML/RPC
      *		request that needs to return an error, you need to return an IXR_Error. If you are not serving an XML/RPC
      *		request, you need to return a YDError or YDFatalError.
+     *
+     *  @ingroup YDFramework
      */
     class YDXmlRpcServer extends YDRequest {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -33,6 +33,10 @@
      *	Author: Pieter Claerhout, pieter at yellowduck.be
      */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Set the error reporting correctly.
     error_reporting( E_ALL );
 
@@ -202,6 +206,8 @@
      *	knows about the include path for the Yellow Duck Framework.
      *
      *	@param $file	File to be included.
+     *
+     *  @ingroup YDFramework
      */
     function YDInclude( $file ) {
 
@@ -235,6 +241,8 @@
 
     /**
      *	This function will include a upgrade file that simulates php functions not present in this php system
+     *
+     *  @ingroup YDFramework
      */
     function YDIncludeCompatibility() {
         include_once( dirname( __FILE__ ) . '/3rdparty/upgrade/upgrade.php' );
@@ -246,6 +254,8 @@
      *	This function will add a marker to the global timer.
      *
      *	@param $name	The name of the marker.
+     *
+     *  @ingroup YDFramework
      */
     function YDGlobalTimerMarker( $name ) {
         if ( ! isset( $GLOBALS['timer'] ) ) {
@@ -261,6 +271,8 @@
      *	@param $value	The value to fix.
      *
      *	@returns	The fixed value.
+     *
+     *  @ingroup YDFramework
      */
     function YDRemoveMagicQuotes( & $value ) {
         if ( get_magic_quotes_gpc() == 1 ) {
@@ -284,19 +296,23 @@
      *  @param  $params (optional) An array of parameters that are passed to the sprintf function.
      *
      *  @returns    The translated string.
+     *
+     *  @ingroup YDFramework
      */
     function t( $t, $params=array() ) {
         if ( empty( $t ) ) {
             return '';
         }
         $t = strtolower( $t );
-        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "<font color=\"red\">%%$t%%</font>" );
+        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%%$t%%" );
         array_unshift( $params, $out );
         return call_user_func_array( 'sprintf', $params );
     }
 
     /**
      *  This is the base class for all other YD classes.
+     *
+     *  @ingroup YDFramework
      */
     class YDBase {
 
@@ -421,6 +437,8 @@
 
     /**
      *	This is the class that hold the global configuration.
+     *
+     *  @ingroup YDFramework
      */
     class YDConfig extends YDBase {
 
@@ -488,6 +506,8 @@
 
     /**
      *	This is the class that hold the locale information.
+     *
+     *  @ingroup YDFramework
      */
     class YDLocale extends YDBase {
 
@@ -558,6 +578,8 @@
 
     /**
      *	This is the base class for all other YD classes.
+     *
+     *  @ingroup YDFramework
      */
     class YDAddOnModule extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFramework Core
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
     /**
      *	This is the executor class that contains all the logic for executing requests. It will instantiate the request
      *	class and execute the right functions to get the request processed correctly.
+     *
+     *  @ingroup YDFramework
      */
     class YDExecutor extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDAjax Addons - Ajax
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -56,6 +60,8 @@
 
     /**
      *  Class definition for the YDAjax addon.
+     *
+     *  @ingroup YDAjax
      */
     class YDAjax extends xajax{
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAkismet/YDAkismet.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDAkismet Addons - Akismet
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *	This class is an interface to the Akismet comment spam checking webservice.
+     *
+     *  @ingroup YDAkismet
      */
     class YDAkismet extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDBBCode/YDBBCode.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDBBCode Addons - BBCode
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -36,6 +40,8 @@
     /**
      *	This class implements a BBCode parser. By default, it supports a number of standard codes that can be
      *	implemented. The following codes are supported by default: img, url, mail, email, color, b, i, u, code, quote, p
+     *
+     *  @ingroup YDBBCode
      */
     class YDBBCode extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,11 +21,18 @@
 
     */
 
+    /**
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMAudit extends YDDatabaseObject {
     
         function YDCMAudit() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -29,6 +33,9 @@
 	require_once( dirname( __FILE__ ) . '/YDCMTree.php' );
 	require_once( dirname( __FILE__ ) . '/YDCMLanguages.php' );
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMComp extends YDDatabaseObject {
     
         function YDCMComp( $type, $id ) {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,28 +21,35 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-	// include YDF libs
+    // include YDF libs
     YDInclude( 'YDDatabaseObject.php' );
-	YDInclude( 'YDDatabaseTree.php' );
-	YDInclude( 'YDUrl.php' );
-	YDInclude( 'YDResult.php' );
+    YDInclude( 'YDDatabaseTree.php' );
+    YDInclude( 'YDUrl.php' );
+    YDInclude( 'YDResult.php' );
 
-	// include YDCM libs
-	YDInclude( 'YDCMComp.php' );
+    // include YDCM libs
+    YDInclude( 'YDCMComp.php' );
 
-	// add generic translation directory
-	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+    // add generic translation directory
+    YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMComponent extends YDDatabaseObject {
 
         function YDCMComponent( $type, $id ) {
 
-			// init DB object
+            // init DB object
             $this->YDDatabaseObject();
 
             $this->_author = 'unknown author';

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -122,6 +126,9 @@
 	define( 'YD_FORUM_ANNOUNCEMENTS_ONHOMEPAGEANDFORUMS', 20 );
 	define( 'YD_FORUM_ANNOUNCEMENTS_ONHOMEPAGE',          10 );
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMForum_announcements extends YDDatabaseObject {
     
         function YDCMForum_announcements() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGroup.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -41,8 +45,9 @@
 	// add YDCM libs
 	YDInclude( 'YDCMUserobject.php' );
 
-
-	// user class
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMGroup extends YDDatabaseObject {
     
         function YDCMGroup() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMHelpdesk.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -51,7 +55,9 @@
                                                     'medium'       => array( 'color' => '#FF9900' ), 
 													'high'         => array( 'color' => '#FF9900' ) ), false );
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMHelpdesk extends YDCMComponent {
     
         function YDCMHelpdesk() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLanguages.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,12 +21,18 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMLanguages extends YDDatabaseObject {
 
         function YDCMLanguages() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -28,7 +32,9 @@
 
 	YDInclude( 'YDCMComponent.php' );
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMLink extends YDCMComponent {
     
         function YDCMLink() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLocks.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,11 +21,18 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMLocks extends YDDatabaseObject {
     
         function YDCMLocks() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -34,7 +38,9 @@
 	// set page form name
 	YDConfig::set( 'YDCMPAGE_FORMPAGE', 'YDCMPageForm', false );
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMPage extends YDCMComponent {
     
         function YDCMPage( $id = null ) {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPermission.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -36,7 +40,9 @@
 	// add translations directory for generic translations
 	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMPermission extends YDDatabaseObject {
     
         function YDCMPermission() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -28,7 +32,9 @@
 
 	YDInclude( 'YDCMComponent.php' );
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMRootmenu extends YDCMComponent {
     
         function YDCMRootmenu( $id = null ) {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,12 +21,18 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMStatistics {
 
         function YDCMStatistics() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,11 +21,18 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMStatistics_system {
     
         function YDCMStatistics_system() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,11 +21,18 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMStatistics_visits extends YDDatabaseObject {
     
         function YDCMStatistics_visits() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTemplates.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -43,7 +47,12 @@
 	YDConfig::set( 'YDCMTEMPLATES_PACK', false, false );
 
 
-	// this is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
+
+    /**
+     *  This is a very special component because don't have any DB table (that's way do not extends YDCMComponent)
+     *
+     *  @ingroup YDCMComponent
+     */
     class YDCMTemplates {
 
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -30,7 +34,9 @@
 	// add YD libs
 	YDInclude( 'YDDatabaseTree3.php' );
 
-	// userobject class
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMTree extends YDDatabaseTree3 {
     
         function YDCMTree() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -46,8 +50,9 @@
 	YDInclude( 'YDCMTemplates.php' );
 	YDInclude( 'YDCMUserobject.php' );
 
-
-	// user class
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMUser extends YDDatabaseObject {
     
         function YDCMUser() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /*
+     *  @addtogroup YDCMComponent Addons - CMComponent
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -30,7 +34,9 @@
 	// add YD libs
 	YDInclude( 'YDDatabaseTree3.php' );
 
-	// userobject class
+    /**
+     *  @ingroup YDCMComponent
+     */
     class YDCMUserobject extends YDDatabaseTree3 {
     
         function YDCMUserobject() {

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCaptcha/YDCaptcha.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,17 +21,22 @@
 
     */
 
+    /**
+     *  @addtogroup YDCaptcha Addons - Captcha
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-	// include antispam lib
+    // include antispam lib
     include_once( YD_DIR_HOME . '/3rdparty/captcha/php-captcha.inc.php' );
 
-
     /**
      *  This class handles a captcha image
+     *
+     *  @ingroup YDCaptcha
      */
     class YDCaptcha extends YDAddOnModule {
 
@@ -49,70 +54,66 @@
             $this->_copyright = '(c) 2006 Francisco Azevedo, francisco at fusemail.com';
             $this->_description = 'This class manages a captcha image system.';
 
-			// compute fonts directory
-			$fdir = YD_DIR_HOME . '/3rdparty/fonts/';
+            // compute fonts directory
+            $fdir = YD_DIR_HOME . '/3rdparty/fonts/';
 
-			// define fonts to use
-			$fonts = array( $fdir . 'VeraBd.ttf', $fdir . 'VeraIt.ttf', $fdir . 'Vera.ttf');
+            // define fonts to use
+            $fonts = array( $fdir . 'VeraBd.ttf', $fdir . 'VeraIt.ttf', $fdir . 'Vera.ttf');
 
-			// create image object
-			$this->_img = new PhpCaptcha( $fonts, 200, 40 );
-			
-			$this->_img->DisplayShadow( false );
-			$this->_img->UseColour( false );
-			$this->_img->SetNumChars( 5 );
+            // create image object
+            $this->_img = new PhpCaptcha( $fonts, 200, 40 );
+            
+            $this->_img->DisplayShadow( false );
+            $this->_img->UseColour( false );
+            $this->_img->SetNumChars( 5 );
 
-			// add simbols ;) 
-			// don't add possible character problems for user, eg, l <--> 1 (lower L or number ONE?), 0 <--> O (ZERO OR upper O?)
-			$this->_img->SetCharSet( "a-h,!,j-k,#,&,%,$,m-n,@,p-r,2-4,6,?,?,8-9,t-w,y-z,#,&,%,$,A-H,!,J-K,#,&,%,$,M-N,@,P-R,T-W,Y-Z,2-4,6,?,?,8-9" );
+            // add simbols ;) 
+            // don't add possible character problems for user, eg, l <--> 1 (lower L or number ONE?), 0 <--> O (ZERO OR upper O?)
+            $this->_img->SetCharSet( "a-h,!,j-k,#,&,%,$,m-n,@,p-r,2-4,6,?,?,8-9,t-w,y-z,#,&,%,$,A-H,!,J-K,#,&,%,$,M-N,@,P-R,T-W,Y-Z,2-4,6,?,?,8-9" );
+
         }
 
-
         /**
          *	This function set the number of characters to display
          *
          *	@param $num		Number of characters
          */
         function setNumChars( $num ){
-			$this->_img->setNumChars( $num );
-		}
+            $this->_img->setNumChars( $num );
+        }
 
-
         /**
          *	This function set the number of interference lines
          *
          *	@param $num		Number of lines
          */
         function setNumLines( $num ){
-			$this->_img->setNumLines( $num );
-		}
+            $this->_img->setNumLines( $num );
+        }
 
-
         /**
          *	This function defines use of shadows
          *
          *	@param $flag		True or false boolean
          */
         function displayShadow( $flag ){
-			$this->_img->displayShadow( $flag );
-		}
+            $this->_img->displayShadow( $flag );
+        }
 
-
         /**
          *	This function defines use of colours
          *
          *	@param $flag		True or false boolean
          */
         function useColour( $flag ){
-			$this->_img->useColour( $flag );
-		}
+            $this->_img->useColour( $flag );
+        }
 
-
         /**
          *  This function exports the image
          */
         function create() {
-			return $this->_img->Create();
+            return $this->_img->Create();
         }
 
   }

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCart/YDCart.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDCart Addons - Cart
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -34,6 +38,8 @@
 
     /**
      *	This class defines a shopping cart object.
+     *
+     *  @ingroup YDCart
      */
     class YDCart extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabaseObject Addons - DatabaseObject
+     */
+
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
     }
@@ -79,6 +83,8 @@
 
     /**
      *  This class defines a YDDatabaseObject object.
+     *
+     *  @ingroup YDDatabaseObject
      */
     class YDDatabaseObject extends YDAddOnModule {
 
@@ -2259,6 +2265,8 @@
 
     /**
      *  This class defines a YDDatabaseObject_Field object.
+     *
+     *  @ingroup YDDatabaseObject
      */
     class YDDatabaseObject_Field extends YDBase {
 
@@ -2468,6 +2476,8 @@
 
     /**
      *  This class defines a YDDatabaseObject_Relation object.
+     *
+     *  @ingroup YDDatabaseObject
      */
     class YDDatabaseObject_Relation extends YDBase {
 
@@ -2972,6 +2982,8 @@
 
     /**
      *  This class defines a YDDatabaseObject_Select object.
+     *
+     *  @ingroup YDDatabaseObject
      */
     class YDDatabaseObject_Select extends YDBase {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQuery.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabaseQuery Addons - DatabaseQuery
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -28,6 +32,8 @@
 
     /**
      *  The YDDatabaseQuery class defines an object-oriented interface to create SQL queries.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQuery extends YDAddOnModule {
 
@@ -106,6 +112,8 @@
 
     /**
      *  This class defines a YDSqlQueryDriver object.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQueryDriver extends YDBase {
 
@@ -1083,6 +1091,8 @@
     
     /**
      *  This class defines a YDSqlQueryDriver_mysql object.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQueryDriver_mysql extends YDDatabaseQueryDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_oracle.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabaseQuery Addons - DatabaseQuery
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *  This class defines a YDSqlQueryDriver_oracle object.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQueryDriver_oracle extends YDDatabaseQueryDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_postgres.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabaseQuery Addons - DatabaseQuery
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *  This class defines a YDSqlQueryDriver_postgres object.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQueryDriver_postgres extends YDDatabaseQueryDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseQuery/YDDatabaseQueryDrivers/YDDatabaseQueryDriver_sqlite.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDDatabaseQuery Addons - DatabaseQuery
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *  This class defines a YDSqlQueryDriver_sqlite object.
+     *
+     *  @ingroup YDDatabaseQuery
      */
     class YDDatabaseQueryDriver_sqlite extends YDDatabaseQueryDriver {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDFeedCreator Addons - FeedCreator
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -35,6 +39,8 @@
      *	This class defines a RSS/ATOM feed. You can use this class to create RSS and Atom feeds in a very easy and
      *	straightforward way. If you set up your class instance, you can automatically output to the different versions
      *	of RSS and ATOM with the same source data.
+     *
+     *  @ingroup YDFeedCreator
      */
     class YDFeedCreator extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDGraph/YDGraph.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -29,6 +29,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDGraph Addons - Graph
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -54,6 +58,8 @@
 
     /**
      *	This class implements an addon module that is able to draw graphs using the GD library.
+     *
+     *  @ingroup YDGraph
      */
     class YDGraph extends YDAddOnModule {
 
@@ -745,6 +751,8 @@
 
     /**
      *  @internal
+     *
+     *  @ingroup YDGraph
      */
     class series{
         var $m_values, $m_seriesTitle, $m_strokeColor, $m_fillColor;

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDGraphPie/YDGraphPie.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -29,6 +29,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDGraphPie Addons - GraphPie
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -40,8 +44,9 @@
 
     /**
      * This class implements an addon module that is able to draw pie graphs using the GD library.
+     *
+     *  @ingroup YDGraphPie
      */
-
     class YDGraphPie extends YDAddOnModule {
 
         

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -20,6 +20,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDInstaller Addons - Installer
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -35,6 +39,8 @@
 
     /**
      *  This class defines a YDInstaller object.
+     *
+     *  @ingroup YDInstaller
      */
     class YDInstaller extends YDRequest {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDInstaller/YDInstaller_renderer.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDInstaller Addons - Installer
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *        This is the class that is able to render a form object to HTML.
+     *
+     *  @ingroup YDInstaller
      */
     class YDInstaller_renderer extends YDFormRenderer {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDLoadconfig Addons - Loadconfig
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -29,6 +33,8 @@
 
     /**
      *  This class reads a database table to apply correspondent YDConfig
+     *
+     *  @ingroup YDLoadconfig
      */
     class YDLoadconfig extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDMysqlDump Addons - MysqlDump
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -32,6 +36,8 @@
 
     /**
      *  This class defines a mySql backup/restore system object.
+     *
+     *  @ingroup YDMysqlDump
      */
     class YDMysqlDump extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDPdfReport/YDPdfReport.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     *  @addtogroup YDPdfReport Addons - PdfReport
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -31,6 +35,8 @@
 
     /**
      *  This class defines a YDPdfProject object.
+     *
+     *  @ingroup YDPdfReport
      */
     class YDPdfReport extends YDAddOnModule {
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -21,6 +21,10 @@
 
     */
 
+    /**
+     * @addtogroup YDSimpleCMS Addons - Simple CMS
+     */
+
     // Check if the framework is loaded
     if ( ! defined( 'YD_FW_NAME' ) ) {
         die( 'Yellow Duck Framework is not loaded.' );
@@ -60,11 +64,24 @@
     // The database connection
     $GLOBALS['db'] = YDDatabase::getNamedInstance();
 
-    // Global YDSimpleCMS class
-    class YDSimpleCMS extends YDBase {
+    /**
+     *  This is the global YDSimpleCMS class that houses all cms related functions.
+     *
+     *  @ingroup YDSimpleCMS
+     */
+    class YDSimpleCMS {
 
-        // Run the request in the indicated scope
-        // @static
+        /**
+         *  This is a static function that will run a request.
+         *
+         *  @param  $scope  The scope in which the request needs to run. You can choose between public and admin. If you
+         *                  choose admin, authentication will be enforced, with public, it's not.
+         *
+         *  @static
+         *
+         *  @todo
+         *      Replace scope with a defined constant (YD_SIMPLECMS_SCOPE_PUBLIC and YD_SIMPLECMS_SCOPE_ADMIN)
+         */
         function run( $scope ) {
             $baseClass = ( strtolower( $scope ) == 'public' ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
             $clsInst = new YDExecutor( $baseClass . '.php' );
@@ -72,7 +89,13 @@
             $clsInst->execute();
         }
 
-        // Function to show an error
+        /**
+         *  This function will show an error for the CMS application.
+         *
+         *  The parameters that are supported are the same ones as the sprintf and printf functions.
+         *
+         *  @static
+         */
         function showError() {
             $args = func_get_args();
             if ( sizeof( $args > 0 ) ) {
@@ -82,7 +105,17 @@
             die();
         }
 
-        // Function to add an admin menu item
+        /**
+         *  This function will add an entry to the administration menu.
+         *
+         *  @param  $title      The title of the menu in which this needs to appear.
+         *  @param  $subtitle   The title of the submenu item that needs to be added. If you use a null value for this
+         *                      parameter, only the main menu item is created.
+         *  @param  $module     The module that is linked to this menu item.
+         *  @param  $action     The module action that is linked to this menu item.
+         *
+         *  @static
+         */
         function addAdminMenu( $title, $subtitle, $module, $action ) {
 
             // Link to the menu items
@@ -113,7 +146,11 @@
 
     }
 
-    // Override the template class
+    /**
+     *  Override the template class
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class YDSimpleCMSTemplate extends YDTemplate {
 
         // The scope of the template
@@ -160,7 +197,11 @@
 
     }
 
-    // Define the CMS request class
+    /**
+     *  Define the CMS request class.
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class YDSimpleCMSPublicRequest extends YDRequest {
 
         // Class variables
@@ -178,7 +219,11 @@
 
     }
 
-    // Define the CMS request class
+    /**
+     *  Define the CMS request class.
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class YDSimpleCMSAdminRequest extends YDSimpleCMSPublicRequest {
 
         // Class variables
@@ -301,7 +346,11 @@
 
     }
 
-    // Define a CMS module
+    /**
+     *  Define a CMS module
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class YDSimpleCMSModule extends YDBase {
 
         // Class variables
@@ -366,7 +415,11 @@
 
     }
 
-    // The module manager class
+    /**
+     *  The module manager class
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class YDSimpleCMSModuleManager extends YDBase {
 
         // Load the plugins

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-22 13:41:11 UTC (rev 2333)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-22 16:05:35 UTC (rev 2334)
@@ -1,6 +1,35 @@
 <?php
 
-    // The page module
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    /**
+     * @addtogroup YDSimpleCMS Addons - Simple CMS
+     */
+
+    /**
+     *  The page module
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class module_page extends YDSimpleCMSModule {
 
         // Class variables
@@ -23,7 +52,11 @@
 
     }
 
-    // The admin module
+    /**
+     *  The admin module
+     *
+     *  @ingroup YDSimpleCMS
+     */
     class module_admin extends YDSimpleCMSModule {
 
         // Class variables



From pclaerhout at mail.berlios.de  Mon Jan 22 21:23:51 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Mon, 22 Jan 2007 21:23:51 +0100
Subject: [ydf-devel] r2335 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701222023.l0MKNptw001250@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-22 21:23:49 +0100 (Mon, 22 Jan 2007)
New Revision: 2335

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Added more docstrings to the YDSimpleCMS package.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 16:05:35 UTC (rev 2334)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-22 20:23:49 UTC (rev 2335)
@@ -21,8 +21,40 @@
 
     */
 
+    /*! @page page_YDSimpleCMS Addons - Simple CMS
+
+      The Simple CMS addon can be used to build a basic content management system.
+
+      @section page_YDSimpleCMS_01 A generic overview
+
+      Not written yet...
+
+      @section page_YDSimpleCMS_02 The module approach
+
+      Not written yet...
+    */
+
     /**
-     * @addtogroup YDSimpleCMS Addons - Simple CMS
+     *  @addtogroup YDSimpleCMS Addons - Simple CMS
+     *
+     *  @ref page_YDSimpleCMS More information about the Simple CMS addon.
+     *
+     *  @todo
+     *      Consolidate the two request classes into one. Based on the scope, it should know if you need to force
+     *      authentication or not.
+     *
+     *  @todo
+     *      Make a link from the module to the request instance
+     *
+     *  @todo
+     *      Make a link from the template to the module instance and module manager (so that you can access these from
+     *      the template)
+     *
+     *  @todo
+     *      Make the run method a static method of the request class
+     *
+     *  @todo
+     *      make login module based?
      */
 
     // Check if the framework is loaded
@@ -41,6 +73,9 @@
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
 
+    // The global list with admin menu
+    $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] = array();
+
     // Includes
     YDInclude( 'YDForm.php' );
     YDInclude( 'YDRequest.php' );
@@ -50,20 +85,6 @@
     YDInclude( 'YDF2_process.php' );
     YDInclude( 'YDSimpleCMS_CoreModules.php' );
 
-    // Register the database instance and prefix
-    YDDatabase::registerInstance(
-        'default', 'mysql',
-        YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
-        YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
-    );
-    YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
-
-    // The global list with admin action
-    $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] = array();
-
-    // The database connection
-    $GLOBALS['db'] = YDDatabase::getNamedInstance();
-
     /**
      *  This is the global YDSimpleCMS class that houses all cms related functions.
      *
@@ -144,19 +165,59 @@
 
         }
 
+        /**
+         *  This function returns a database connection.
+         *
+         *  @returns    A database connection.
+         *
+         *  @static
+         */
+        function getDbConnection() {
+
+            // Register the database instance and prefix
+            YDDatabase::registerInstance(
+                'default', 'mysql',
+                YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
+                YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
+            );
+            YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
+        
+            // The database connection
+            return YDDatabase::getNamedInstance();
+
+        }
+
     }
 
     /**
-     *  Override the template class
+     *  Custom template class for the SimpleCMS package. This is a customization of the stock YDTemplate class.
      *
+     *  The main differences with the normal template class are:
+     *      - Support for masterpages
+     *      - Different handling of template directories
+     *
+     *  The template directories are determined as follows (depending of the scope of the template class:
+     *      - scope public:
+     *          - skins_{scope}/{currentSkinFromConfig}
+     *      - scope admin:
+     *          - skins_{scope}
+     *
      *  @ingroup YDSimpleCMS
      */
     class YDSimpleCMSTemplate extends YDTemplate {
 
-        // The scope of the template
+        /**
+         *  The scope which is going to be used for the template.
+         *
+         *  Can be either public or admin.
+         */
         var $scope;
 
-        // The constructor
+        /**
+         *  The class constructor the the YDSimpleCMSTemplate class.
+         *
+         *  @param  $scope  The scope which is going to be used for the template. Can be either public or admin.
+         */
         function YDSimpleCMSTemplate( $scope ) {
 
             // Initialize the parent
@@ -167,7 +228,18 @@
 
         }
 
-        // Fetch the template using a master
+        /**
+         *  This function will fetch the specified template, and surround it with the contents of the indicated master
+         *  page, which should be in the skins directory.
+         *
+         *  The placeholder you can use in the master page to place the contents is \#\#content\#\#
+         *
+         *  @param  $template   (optional) The name of the template to use. If empty, the name of the module will be
+         *                      used as the name of the template.
+         *  @param  $master     (optional) The name of the masterpage to use. Defaults to '__master'.
+         *
+         *  @returns    The result from the parsed template.
+         */
         function fetchWithMaster( $template='', $master='__master' ) {
 
             // Set the variables
@@ -190,7 +262,16 @@
 
         }
 
-        // Fetch the template using a master
+        /**
+         *  This function will output the specified template, and surround it with the contents of the indicated master
+         *  page, which should be in the skins directory.
+         *
+         *  The placeholder you can use in the master page to place the contents is \#\#content\#\#
+         *
+         *  @param  $template   (optional) The name of the template to use. If empty, the name of the module will be
+         *                      used as the name of the template.
+         *  @param  $master     (optional) The name of the masterpage to use. Defaults to '__master'.
+         */
         function displayWithMaster( $template='', $master='__master' ) {
             echo( $this->fetchWithMaster( $template, $master ) );
         }
@@ -198,17 +279,40 @@
     }
 
     /**
-     *  Define the CMS request class.
+     *  Define the CMS public request class.
      *
+     *  The public request class doesn't perform any user authentication.
+     *
      *  @ingroup YDSimpleCMS
      */
     class YDSimpleCMSPublicRequest extends YDRequest {
 
-        // Class variables
+        /**
+         *  The scope which is going to be used for the template.
+         *
+         *  Can be either public or admin.
+         */
         var $requestScope  = 'public';
+
+        /**
+         *  The default module for the request class.
+         *
+         *  Currently defaults to 'page' for the public request class.
+         */
         var $defaultModule = 'page';
 
-        // Default action
+        /**
+         *  The default action for the public request.
+         *
+         *  Currently, it does the following items:
+         *      - Creates an instance of YDSimpleCMSModuleManager
+         *      - Loads all the modules using the instance
+         *      - Runs the module and action specified by the query string
+         *
+         *  @todo
+         *      Needs to be implemented properly so that it can do all it's stuff based on the ID passed in the qeury
+         *      string of the request.
+         */
         function actionDefault() {
             $moduleManager = new YDSimpleCMSModuleManager();
             $moduleManager->loadAllModules();
@@ -220,17 +324,42 @@
     }
 
     /**
-     *  Define the CMS request class.
+     *  Define the CMS admin request class.
      *
+     *  This class forces authentication against the database (the \#_users table). Only if the authentication succeeds,
+     *  you will be able to access the request.
+     *
+     *  It also supports modules and action via specific query string parameters:
+     *      - module: the module to load (defaults to 'admin' )
+     *      - action: the action to load from the module (defaults to 'show')
+     *
+     *  The authentication credentials are stored in cookies with the following name:
+     *      - YD_SIMPLECMS_{siteId}_USER
+     *      - YD_SIMPLECMS_{siteId}_PASS
+     *
      *  @ingroup YDSimpleCMS
      */
     class YDSimpleCMSAdminRequest extends YDSimpleCMSPublicRequest {
 
-        // Class variables
+        /**
+         *  The scope which is going to be used for the template.
+         *
+         *  Can be either public or admin.
+         */
         var $requestScope  = 'admin';
+
+        /**
+         *  The default module for the request class.
+         *
+         *  Currently defaults to 'admin' for the admin request class.
+         */
         var $defaultModule = 'admin';
 
-        // Constructor
+        /**
+         *  The constructor for the admin CMS request.
+         *
+         *  This one forces authentication and requires a configuration variable called 'YD_SIMPLECMS_SITEID' to be set.
+         */
         function YDSimpleCMSAdminRequest() {
 
             // Initialize the parent
@@ -251,7 +380,10 @@
 
         }
 
-        // Login function
+        /**
+         *  This action takes care of handling the login form. It can show and validate a login form and redirects to
+         *  default action of the request class when the user is authenticated.
+         */
         function actionLogin() {
 
             // Redirect to default action if already logged in
@@ -302,13 +434,22 @@
 
         }
 
-        // Logout action
+        /**
+         *  This action takes care of logging out the current user. This is done by removing the authentication cookie.
+         *
+         *  After the logout, the user is redirected to the login page.
+         */
         function actionLogout() {
             $this->setCookie( $this->cookieNamePass, null );
             $this->redirectToAction( 'login' );
         }
 
-        // Check for authentication
+        /**
+         *  This function will check if the current user is authenticated or not. It will check this against the
+         *  authentication cookies.
+         *
+         *  @returns    True if the user is authenticated, false if the user is not authenticated.
+         */
         function isAuthenticated() {
             $cookieUser = $this->getCookie( $this->cookieNameUser );
             $cookiePass = $this->getCookie( $this->cookieNamePass );
@@ -322,17 +463,31 @@
             return false;
         }
 
-        // Redirect to the login if the authentication failed
+        /**
+         *  This function is executec if the authenticated failed. It redirects the user to the login page.
+         */
         function authenticationFailed() {
             $this->forward( 'login' );
         }
 
-        // Function to check the login
+        /**
+         *  This function verifies the user credentials against the database.
+         *
+         *  @param  $fields     The fields which are containing the loginName and loginPass attributes.
+         *  @param  $md5        (optional) If sett to false, it means that the password is passed as clear text. If set
+         *                      to true, the password is passed to this function as an MD5 checksum.
+         *
+         *  @returns    If the login is valid, this function will return true. If not, it will return an array with the
+         *              error message.
+         *
+         *  @todo
+         *      Need model class to encapsulate the database calls.
+         */
         function checkLogin( $fields, $md5=false ) {
             if ( $md5 === false ) {
                 $fields['loginPass'] = md5( $fields['loginPass'] );
             }
-            $db = YDDatabase::getNamedInstance();
+            $db = YDSimpleCMS::getDbConnection();
             $result = $db->getRecord(
                 'SELECT * FROM #_users WHERE name = \'' . $db->escape( $fields['loginName'] ) . '\' AND password = \'' . $db->escape( $fields['loginPass'] ) . '\''
             );
@@ -353,42 +508,109 @@
      */
     class YDSimpleCMSModule extends YDBase {
 
-        // Class variables
+        /**
+         *  The nice name of the CMS module.
+         */
         var $name          = 'SimpleCMS Generic Module';
+
+        /**
+         *  The full description of the CMS module.
+         */
         var $description   = 'Base module for all the SimpleCMS modules.';
+
+        /**
+         *  The version number of the CMS module.
+         */
         var $version       = '1.0';
+
+        /**
+         *  The name of the author of the CMS module.
+         */
         var $authorName    = 'Pieter Claerhout';
+
+        /**
+         *  The email address of the author of the CMS module.
+         */
         var $authorEmail   = 'pieter at yellowduck.be';
+
+        /**
+         *  The website address of the author of the CMS module.
+         */
         var $authorUrl     = 'http://www.yellowduck.be';
+
+        /**
+         *  A reference to the module manager instance that loaded this module.
+         */
         var $manager       = null;
+
+        /**
+         *  The current scope of the CMS module.
+         *
+         *  Currently, the value can only be public or admin.
+         */
         var $currentScope  = null;
+
+        /**
+         *  The name of the action that is currently being executed.
+         */
         var $currentAction = null;
 
-        // Constructor
+        /**
+         *  The class constructor the the YDSimpleCMSModule class.
+         *
+         *  @param  $manager    A reference to the module manager instance that loaded this module.
+         */
         function YDSimpleCMSModule( $manager ) {
             $this->manager = & $manager;
             $this->tpl = new YDSimpleCMSTemplate( 'public' );
         }
 
-        // Install the module
+        /**
+         *  Placeholder function that gets called if the module is installed.
+         *
+         *  @todo
+         *      Still needs to be implemented
+         */
         function install() {
         }
 
-        // Uninstall the module
+        /**
+         *  Placeholder function that gets called if the module is uninstalled.
+         *
+         *  @todo
+         *      Still needs to be implemented
+         */
         function uninstall() {
         }
 
-        // Check if the module is required or not
+        /**
+         *  This function will indicate if the module is a required one or not. The required modules are basically not
+         *  in the modules directory.
+         *
+         *  @returns    True if the module is required, false otherwise.
+         */
         function isRequired() {
             return ! is_file( YD_SIMPLECMS_MODULE_DIR . '/' . $this->getClassName() . YD_SIMPLECMS_MODULE_EXT );
         }
 
-        // Get the module name
+        /**
+         *  This function returns the short name of the module.
+         *
+         *  @returns    The short name of the module.
+         */
         function getModuleName() {
             return substr( $this->getClassName(), strlen( YD_SIMPLECMS_MODULE_PREFIX ) );
         }
 
-        // Display the module
+        /**
+         *  This function will output the template associated with this module. It will also assign the following
+         *  standard variables to the template instance:
+         *      - currentAction: the name of the current action
+         *      - currentScope: the current scope of the module ('public' or 'admin')
+         *      - adminMenu: an array containing all the menus and menu items for the admin section.
+         *      - currentUser: the full user details for the user which is currently logged in. If no user is logged in,
+         *                     this variable will contain a null value.
+         */
         function display( $name='' ) {
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
@@ -402,7 +624,14 @@
             $this->tpl->displayWithMaster( $name );
         }
 
-        // Run an action in the module
+        /**
+         *  This function triggers the indicated action in the indicated scope.
+         *
+         *  This function gets triggered by the module manager when this one wants to trigger an action.
+         *
+         *  @param  $scope  The scope in which to run the action.
+         *  @param  $action The action to run.
+         */
         function runAction( $scope, $action ) {
             $moduleFunctionName = YD_SIMPLECMS_ACTION_PREFIX . $scope . '_' . $action;
             if ( ! $this->hasMethod( $moduleFunctionName ) ) {
@@ -422,7 +651,12 @@
      */
     class YDSimpleCMSModuleManager extends YDBase {
 
-        // Load the plugins
+        /**
+         *  This function will load all modules from the modules directory. Loading a module only means that the file
+         *  containing the module is included.
+         *
+         *  @static
+         */
         function loadAllModules() {
             if ( is_dir( YD_SIMPLECMS_MODULE_DIR ) ) {
                 $modulesDir = new YDFSDirectory( YD_SIMPLECMS_MODULE_DIR );
@@ -432,7 +666,17 @@
             }
         }
 
-        // Run a module
+        /**
+         *  This function will run the specified module and action in the indicated scope.
+         *
+         *  @attention
+         *      This function should only be called after the loadAllModules function has been executed. If not, this
+         *      function will fail as the include files are not loaded yet.
+         *
+         *  @param  $scope  The scope in which to run the module and action. Can be 'public' or 'admin'.
+         *  @param  $module The name of the module to run.
+         *  @param  $action The name of the action to run.
+         */
         function runModule( $scope, $module, $action ) {
 
             // Convert everything to lowercase
@@ -473,7 +717,11 @@
 
         }
 
-        // Get the list of modules
+        /**
+         *  This function returns a list with an instance of each loaded module.
+         *
+         *  @returns    A list with an instance of each loaded module.
+         */
         function getModuleList() {
             $modules = array();
             foreach ( get_declared_classes() as $class ) {



From ximian at mail.berlios.de  Mon Jan 22 22:55:18 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 22 Jan 2007 22:55:18 +0100
Subject: [ydf-devel] r2336 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701222155.l0MLtI7K014918@sheep.berlios.de>

Author: ximian
Date: 2007-01-22 22:55:09 +0100 (Mon, 22 Jan 2007)
New Revision: 2336

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
- added gettext support

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 20:23:49 UTC (rev 2335)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-22 21:55:09 UTC (rev 2336)
@@ -303,8 +303,14 @@
         if ( empty( $t ) ) {
             return '';
         }
-        $t = strtolower( $t );
-        $out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%%$t%%" );
+
+		// check gettext patern
+		if ( ereg ( "^\_\([\'\"](.*)[\'\"]\)$", $t, $res ) ){
+			$out = gettext( $res[1] );
+		}else{
+			$t = strtolower( $t );
+			$out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%%$t%%" );
+		}
         array_unshift( $params, $out );
         return call_user_func_array( 'sprintf', $params );
     }
@@ -548,7 +554,33 @@
                     @include( $dir . '/' . YDLocale::get() . '.php' );
         }
 
+
         /**
+         *	This method will activate gettext support
+         *
+         *	@param	$filename	(Optional) Filename to search in locale directory
+         *	@param	$directory	(Optional) Directory name where language directories are stored
+         */
+		function useGettext( $filename = 'ydframework', $directory = null ){
+
+			// get current locale
+			$locale = YDConfig::get( YD_LOCALE_KEY, 'en' );
+
+			// set environment
+			$_ENV["LANG" ]      = $locale;
+			$_ENV["LANGUAGE"]   = $locale;
+			$_ENV["LC_MESSAGE"] = $locale;
+			$_ENV["LC_ALL"]     = $locale;
+
+			// check directory
+			if ( ! is_string( $directory ) ) $directory = YD_DIR_HOME . '/locale/';
+
+			bindtextdomain( $filename, $directory );
+			textdomain( $filename );
+		}
+
+
+        /**
          *	@returns	The current locale.
          */
         function get() {



From ximian at mail.berlios.de  Mon Jan 22 22:57:01 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 22 Jan 2007 22:57:01 +0100
Subject: [ydf-devel] r2337 - in YDFramework2.0/trunk/examples: . translation
	translation/locale translation/locale/en
	translation/locale/en/LC_MESSAGES translation/locale/fr
	translation/locale/fr/LC_MESSAGES translation/locale/pt
	translation/locale/pt/LC_MESSAGES
Message-ID: <200701222157.l0MLv1cw014997@sheep.berlios.de>

Author: ximian
Date: 2007-01-22 22:56:36 +0100 (Mon, 22 Jan 2007)
New Revision: 2337

Added:
   YDFramework2.0/trunk/examples/translation/
   YDFramework2.0/trunk/examples/translation/index.php
   YDFramework2.0/trunk/examples/translation/index.tpl
   YDFramework2.0/trunk/examples/translation/locale/
   YDFramework2.0/trunk/examples/translation/locale/en/
   YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/
   YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.mo
   YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.po
   YDFramework2.0/trunk/examples/translation/locale/fr/
   YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/
   YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.mo
   YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.po
   YDFramework2.0/trunk/examples/translation/locale/pt/
   YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/
   YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.mo
   YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.po
Log:
- added example on how to use the gettext engine in YDF

Added: YDFramework2.0/trunk/examples/translation/index.php
===================================================================
--- YDFramework2.0/trunk/examples/translation/index.php	2007-01-22 21:55:09 UTC (rev 2336)
+++ YDFramework2.0/trunk/examples/translation/index.php	2007-01-22 21:56:36 UTC (rev 2337)
@@ -0,0 +1,41 @@
+<?php
+
+	// Standard include
+	include_once( dirname( __FILE__ ) . '/../../YDFramework2/YDF2_init.php' );
+
+	// Include server compatibility support (useful if this server don't support gettext)
+	YDIncludeCompatibility();
+
+	// Includes
+	YDInclude( 'YDRequest.php' );
+	YDInclude( 'YDTemplate.php' );
+
+	// set locale: you can use 'en', 'pt' and 'fr'
+	YDLocale::set( 'pt' );
+
+	// use gettext engine. use 'test' filenames, language directories are in 'locale' sub directory
+	YDLocale::useGettext( 'test', dirname( __FILE__ ) . '/locale/' );
+
+
+	// Class definition
+	class index extends YDRequest {
+
+		function index() {
+
+			$this->YDRequest();
+			$this->tpl = new YDTemplate();
+		}
+
+
+		// Default action
+		function actionDefault() {
+
+			$this->tpl->assign( 'var',  'variable' );
+			$this->tpl->display();
+		}
+
+	}
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+?>

Added: YDFramework2.0/trunk/examples/translation/index.tpl
===================================================================
--- YDFramework2.0/trunk/examples/translation/index.tpl	2007-01-22 21:55:09 UTC (rev 2336)
+++ YDFramework2.0/trunk/examples/translation/index.tpl	2007-01-22 21:56:36 UTC (rev 2337)
@@ -0,0 +1,3 @@
+<p>This is a text with a smarty variable: {$var}</p>
+
+<p>This is a text with &quot;car&quot; in current language: {t w=_("car")}</p>

Added: YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.mo
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.mo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.po
===================================================================
--- YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.po	2007-01-22 21:55:09 UTC (rev 2336)
+++ YDFramework2.0/trunk/examples/translation/locale/en/LC_MESSAGES/test.po	2007-01-22 21:56:36 UTC (rev 2337)
@@ -0,0 +1,20 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: Yellow Duck Framework test\n"
+"POT-Creation-Date: \n"
+"PO-Revision-Date: 2007-01-22 21:37-0000\n"
+"Last-Translator: Francisco Azevedo <francisco at fusemail.com>\n"
+"Language-Team: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=iso-8859-15\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: Portuguese\n"
+"X-Poedit-Country: PORTUGAL\n"
+"X-Poedit-SourceCharset: iso-8859-15\n"
+"X-Poedit-Basepath: D:\\www\\main\\examples\\\n"
+"X-Poedit-SearchPath-0: translation\n"
+
+#: translation/index.tpl:3
+msgid "car"
+msgstr "super Car"
+

Added: YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.mo
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.mo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.po
===================================================================
--- YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.po	2007-01-22 21:55:09 UTC (rev 2336)
+++ YDFramework2.0/trunk/examples/translation/locale/fr/LC_MESSAGES/test.po	2007-01-22 21:56:36 UTC (rev 2337)
@@ -0,0 +1,20 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: Yellow Duck Framework test\n"
+"POT-Creation-Date: \n"
+"PO-Revision-Date: 2007-01-22 21:38-0000\n"
+"Last-Translator: Francisco Azevedo <francisco at fusemail.com>\n"
+"Language-Team: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=iso-8859-15\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: French\n"
+"X-Poedit-Country: FRANCE\n"
+"X-Poedit-SourceCharset: iso-8859-15\n"
+"X-Poedit-Basepath: D:\\www\\main\\examples\\\n"
+"X-Poedit-SearchPath-0: translation\n"
+
+#: translation/index.tpl:3
+msgid "car"
+msgstr "voiture"
+

Added: YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.mo
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.mo
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.po
===================================================================
--- YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.po	2007-01-22 21:55:09 UTC (rev 2336)
+++ YDFramework2.0/trunk/examples/translation/locale/pt/LC_MESSAGES/test.po	2007-01-22 21:56:36 UTC (rev 2337)
@@ -0,0 +1,20 @@
+msgid ""
+msgstr ""
+"Project-Id-Version: Yellow Duck Framework\n"
+"POT-Creation-Date: \n"
+"PO-Revision-Date: 2007-01-22 21:36-0000\n"
+"Last-Translator: Francisco Azevedo <francisco at fusemail.com>\n"
+"Language-Team: \n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=iso-8859-15\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: Portuguese\n"
+"X-Poedit-Country: PORTUGAL\n"
+"X-Poedit-SourceCharset: iso-8859-15\n"
+"X-Poedit-Basepath: D:\\www\\main\\examples\\\n"
+"X-Poedit-SearchPath-0: translation\n"
+
+#: translation/index.tpl:3
+msgid "car"
+msgstr "carro"
+



From ximian at mail.berlios.de  Mon Jan 22 23:03:25 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 22 Jan 2007 23:03:25 +0100
Subject: [ydf-devel] r2338 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701222203.l0MM3Pwb015349@sheep.berlios.de>

Author: ximian
Date: 2007-01-22 23:02:49 +0100 (Mon, 22 Jan 2007)
New Revision: 2338

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
on YDDatabaseTree3:
 - FEATURE: addNode and updateNode will convert date values before add/update a node

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 21:56:36 UTC (rev 2337)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 22:02:49 UTC (rev 2338)
@@ -538,11 +538,16 @@
          *  @param $values      The field values of the node. Do NOT define parent_id here!
          *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child (its parent will be 1)
          *  @param $position    (optional) Node position. If not set, node will be added at the end position
+         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
          *
          *  @returns    The ID of the newly inserted node.
          */
-        function addNode( $values, $parent_id = 1, $position = null ) {
+        function addNode( $values, $parent_id = 1, $position = null, $onDate = 'datetimesql' ) {
 
+			// check values
+			foreach( $values as $element => $value )
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
+
             // compute linege. to do that we must check if we want to add node to root
             if ( $parent_id == 1 ) { 
 
@@ -598,11 +603,16 @@
          *
          *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
          *  @param $id          (optional) The ID of the node to update.
+         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
          *
          *  @returns    Total of lines affected
          */
-        function updateNode( $values, $id ) {
+        function updateNode( $values, $id, $onDate = 'datetimesql' ) {
 
+			// check values
+			foreach( $values as $element => $value )
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
+
 			$this->resetAll();
 
 			// apply custom values



From ximian at mail.berlios.de  Mon Jan 22 23:19:59 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 22 Jan 2007 23:19:59 +0100
Subject: [ydf-devel] r2339 - in YDFramework2.0/trunk/YDFramework2: YDClasses
	addons addons/YDDatabaseObjectTree
Message-ID: <200701222219.l0MMJxUP016340@sheep.berlios.de>

Author: ximian
Date: 2007-01-22 23:19:44 +0100 (Mon, 22 Jan 2007)
New Revision: 2339

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
Removed:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
Log:
- deleted deprecated YDDatabaseTree2.php tree implementation
- moved and renamed YDDatabaseTree3.php to addons/YDDatabaseObjectTree.php

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 22:02:49 UTC (rev 2338)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree2.php	2007-01-22 22:19:44 UTC (rev 2339)
@@ -1,603 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /**
-     *  @addtogroup YDDatabase Core - Database
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-    // Includes
-    include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
-
-    /**
-     *  This class implements a database tree
-     *
-     *  CREATE TABLE nested_tree (
-     *      id int NOT NULL auto_increment,
-     *      parent_id int NULL,
-     *      lineage varchar(255) NOT NULL default '//',
-     *      level int NOT NULL default '1',
-     *      position int NOT NULL default '1',
-     *      title varchar(255) NOT NULL default '',
-     *      PRIMARY KEY (id),
-     *      FOREIGN KEY (parent_id)
-     *          REFERENCES nested_tree(id)
-     *               ON DELETE CASCADE
-     *               ON UPDATE CASCADE
-     *  );
-     *
-     *  INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
-     *  INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
-     *  INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
-     *  INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
-     *  INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
-     *  INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
-     *  INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-     *  INSERT INTO nested_tree VALUES ( 8,    5, '//2/4/',   3, 3, 'MySQL');
-     *  INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 1, 'Links');
-     *  INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-     *  INSERT INTO nested_tree VALUES (11,    9, '//2/10/',  3, 1, 'Generators');
-     *  INSERT INTO nested_tree VALUES (12,    9, '//2/10/',  3, 2, 'Portals');
-     *
-     *  @ingroup YDDatabase
-     */
-    class YDDatabaseTree2 extends YDBase {
-
-        /**
-         *  Constructor. Set the database table name and necessary field names
-         *
-         *  @param $table          Name of the tree database table
-         *  @param $db             (optional) The YDDatabase instance name or object pointing to the database
-         *  @param $idField        (optional) Name of the primary key ID field. Default is id.
-         *  @param $parentField    (optional) Name of the parent ID field. Default is parent_id.
-         *  @param $sortField      (optional) Name of the field to sort data.
-         */
-        function YDDatabaseTree2( $table, $db='default', $idField='id', $parentField='parent_id', $sortField='parent_id ASC, position ASC' ) {
-
-            $this->db = YDDatabase::getNamedInstance( $db );
-
-            $this->table = $table;
-            $this->fields = array( 'id' => $idField, 'parent' => $parentField, 'lineage' => 'lineage', 'level' => 'level', 'position' => 'position' );
-			$this->sortField = $sortField;
-        }
-
-
-        /*
-         *  Function to convert an object to a node array
-         *
-         *  @param $node    The node to convert to a node array.
-         *
-         *  @return The node as a node array.
-         */
-        function _toNodeArray( $node ) {
-            $arr = array();
-
-            foreach ( $this->fields as $f )
-                if ( isset( $node[ $f ] ) ) $arr[ $f ] = $node[ $f ];
-
-            return $arr;
-        }
-
-
-        /**
-         *  A utility function to return an array of the fields that need to be selected in SQL select queries.
-         *
-         *  @returns array   An indexed array of fields to select
-         *
-         *  @internal
-         */
-        function _getFields() {
-            return array_values( $this->fields );
-        }
-
-
-        /**
-         *  Get the fields joined as single string.
-         *
-         *  @returns A single string with the fields joined as a string
-         *
-         *  @internal
-         */
-        function _getFieldsAsString() {
-            return join( ',', $this->_getFields() );
-        }
-
-
-        /**
-         *  Add a field to the list of fields to will get returned by this class.
-         *
-         *  @param  $name   The name of the field that should be added.
-         */
-        function addField( $name ) {
-            if ( ! in_array( $name, $this->fields ) ) {
-                $this->fields[ $name ] = $name;
-            }
-        }
-
-
-        /**
-         *  Add a number of fields to the list of fields to will get returned by this class.
-         *
-         *  @param  $names   The name of the field that should be added.
-         */
-        function addFields( $names ) {
-            if ( is_array( $names ) ) {
-                foreach ( $names as $name ) {
-                    $this->addField( $name );
-                }
-            }
-        }
-
-
-        /**
-         *  Returns the level based on the lineage
-         *
-         *  @returns  level int value
-         */
-        function _getLevel( $lineage ) {
-			return substr_count( $lineage, '/' ) - 1;
-        }
-
-
-        /**
-         *  Set the sort field.
-         *
-         *  @param $sortField      (optional) Name of the field to sort data. Default is title.
-         */
-        function setSortField( $sortField='title' ) {
-            $this->sortField = $sortField;
-        }
-
-
-        /**
-         *  Returns orberby sql clause
-         *
-         *  @returns orderBy sql
-         */
-        function _getOrder() {
-            return ' order by ' . $this->sortField;
-        }
-
-
-        /**
-         *  Fetch the node data for the node identified by $id.
-         *
-         *  @param $id      The ID of the node to fetch.
-         *  @param $field   The unique field to select on. Defaults to id, which means that the ID field specified
-         *                  when the object was instantiated will be used.
-         *
-         *  @returns An object containing the node's data, or false if node not found
-         */
-        function getNode( $id, $field = 'id' ) {
-
-            // Get the name of the field
-			if ( ! isset( $this->fields[ $field ] ) ) trigger_error( 'YDDatabaseTree::getNode, Field ' . $field . ' is not set!', YD_ERROR );
-
-			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields[ $field ] . ' = ' . $this->db->escapeSql( $id );
-
-            // Execute the query and return the record
-            return $this->db->getRecord( $query );
-        }
-
-
-        /**
-         *  Fetch the descendants of a node. To get all elements use getTreeElements
-         *
-         *  @param $id              The ID of the node to fetch descendant data for. 
-         *  @param $includeSelf     (optional) Whether or not to include the passed node in the the results. 
-         *  @param $specificPart    (optional) Return array should be not-associative (using a specific key to filter)
-         *
-         *  @returns The descendants of the passed now
-         */
-        function getDescendants( $id, $includeSelf=false, $specificPart=null ) {
-
-            // get just children
-			if ( $includeSelf == false ){
-
-				// get elements where lineage has expression  /$id/
-				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"' . $this->_getOrder();
-
-			}else{
-
-				// get elements where lineage has expression  /$id/ or id is $id
-				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
-			}
-
-            // check if we want a specific column
-            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
-
-			return $this->db->getRecords( $query );
-		}
-
-
-        /**
-         *  Fetch all elements of a tree
-         *
-         *  @param $specificPart    (optional) Return array should be not-associative (using a specific key to filter)
-         *
-         *  @returns The descendants of the passed now
-         */
-        function getTreeElements( $specificPart=null ) {
-
-			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' != 1' . $this->_getOrder();
-
-            // check if we want a specific column
-            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
-
-			return $this->db->getRecords( $query );
-		}
-
-
-        /**
-         *  Fetch the children of a node, or if no node is specified, fetch the top level items.
-         *
-         *  @param $id             The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
-         *  @param $specificPart   (optional) Whether or not we want a specific column. Use the name of the column if
-         *                         want one, otherwise, set to null to get all columns.
-         *
-         *  @returns The children of the passed node
-         */
-        function getChildren( $id, $includeSelf = false, $specificPart = null ){
-
-            // get just children
-			if ( $includeSelf == false ){
-
-				// get elements where parent is $id
-				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id ) . $this->_getOrder();
-
-			}else{
-
-				// get elements where parent is $id or id is $id
-				$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id ) . ' OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
-			}
-
-            // check if we want a specific column
-            if ( is_string( $specificPart ) ) return $this->db->getValuesByName( $query, $specificPart );
-
-			return $this->db->getRecords( $query );
-        }
-
-
-        /**
-         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
-         *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
-         *  array).
-         *
-         *  @param $id             (optional) The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
-         *
-         *  @returns An array of each node to passed node
-         */
-        function getPath( $id, $includeSelf=false ) {
-
-            // Get the ID field
-            $idField = $this->fields['id'];
-
-            // Get the node lineage
-            $node = $this->getNode( $id ) ;
-
-            // No node, return empty array
-            if ( ! $node ) return array();
-
-			// compute parents of this node. delete first '//' and implode
-			$nodes = array_map( 'intval', explode('/', substr( $node[ $this->fields[ 'lineage' ] ], 2 ) ) );
-
-			// delete current id from nodes to get only parents
-			array_pop( $nodes );
-
-            if ( $includeSelf == false ) {
-
-				// get all elements that have an id that belongs to $nodes
-                $query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' IN ("' . implode( '","', $nodes ) . '")' . $this->_getOrder();
-
-            }else{
-
-				// get all elements that have an id that belongs to $nodes or is $id
-                $query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' IN ("' . implode( '","', $nodes ) . '") OR ' . $this->fields['id'] . ' = ' . intval( $id ) . $this->_getOrder();
-            }
-
-			return $this->db->getRecords( $query );
-        }
-
-
-        /**
-         *  Check if one node descends from another node. If either node is not found, then false is returned.
-         *
-         *  @param $descendant_id  The node that potentially descends
-         *  @param $ancestor_id    The node that is potentially descended from
-         *
-         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
-         */
-        function isDescendantOf( $descendant_id, $ancestor_id ) {
-
-			// count elements where id is $descendant_id and lineage has expression /$ancestor_id/
-			$query = 'SELECT count(*) as is_descendant FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $descendant_id ) . ' AND ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' . $this->_getOrder();
-
-            // Execute the query and get the record
-            $record = $this->db->getRecord( $query );
-
-            // Return the result
-            return $record[ 'is_descendant' ] == 1;
-        }
-
-
-        /**
-         *  Check if one node is a child of another node. If either node is not found, then false is returned.
-         *
-         * @param $child_id       The node that is possibly a child
-         * @param $parent_id      The node that is possibly a parent
-         *
-         * @returns True if $child_id is a child of $parent_id, false otherwise
-         */
-        function isChildOf( $child_id, $parent_id ) {
-
-
-			// count elements where id is $child_id and parent_id is $parent_id
-			$query = 'SELECT count(*) as is_child FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $child_id ) . ' AND ' . $this->fields['parent'] . ' = ' . intval( $parent_id );
-
-            // Execute the query and get the record
-            $record = $this->db->getRecord( $query );
-
-            // Return the result
-            return $record[ 'is_child' ] == 1;
-        }
-
-
-        /**
-         *  Find the number of descendants a node has
-         *
-         *  @param $id     The ID of the node to search for.
-         *
-         *  @returns The number of descendants the node has
-         */
-        function numDescendants( $id ) {
-
-			$query = 'SELECT count(*) as num_descendants FROM ' . $this->table . ' WHERE ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"';
-
-            // Execute the query and get the record
-            $record = $this->db->getRecord( $query );
-
-            // Return the result
-            return $record[ 'num_descendants' ];
-        }
-
-
-        /**
-         *  Find the number of children a node has
-         *
-         *  @param $id     The ID of the node to search for. Pass 0 to count the first level items
-         *
-         *  @returns The number of descendants the node has, or -1 if the node isn't found.
-         */
-        function numChildren( $id ) {
-
-			$query = 'SELECT count(*) as num_children FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . intval( $id );
-
-            // Execute the query and get the record
-            $record = $this->db->getRecord( $query );
-
-            // Return the result
-            return $record[ 'num_children' ];
-        }
-
-
-        /**
-         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. 
-         *
-         * @param $id   The ID of the node to fetch child data for.
-         *
-         * @returns An array of each node in the family
-         */
-        function getImmediateFamily( $id ) {
-
-            // Get the node parent
-            $node = $this->getNode( $id );
-
-            // No node, return empty array
-            if ( ! $node ) return array();
-
-			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
-			$query = 'SELECT ' . $this->_getFieldsAsString() . ' FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' . $node[ $this->fields['parent'] ] . ' OR ' . $this->fields['id'] . ' = ' . $node[ $this->fields['parent'] ] . ' OR ' . $this->fields['lineage'] . ' LIKE "%/' . intval( $id ) . '/%"' . $this->_getOrder();
-
-            // Execute the query and get the record
-            return $this->db->getRecords( $query );
-        }
-
-
-        /**
-         *  Fetch the tree data, nesting within each node references to the node's children
-         *
-         *  @returns The tree with the node's child data
-         */
-        function getTreeWithChildren() {
-        }
-
-
-        /**
-         *  This function adds a node to the database.
-         *
-         *  @param $values      The field values of the node. Do NOT define parent_id here!
-         *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child
-         *  @param $position    (optional) Node position. If not set, node will be added at the end position
-         *
-         *  @returns    The ID of the newly inserted node.
-         */
-        function addNode( $values, $parent_id = 1, $position = null ) {
-
-			// override parent in $values
-			$values[ $this->fields['parent'] ] = $parent_id;
-
-            // Check if we want to add a root child
-            if ( $parent_id == 1 ) { 
-
-				// compute lineage and level
-				$lineage = '//';
-			}else{
-
-				// get lineage from parent and compute its lineage
-				$parent_node = $this->getNode( $parent_id );
-				$lineage     = $parent_node[ $this->fields['lineage'] ] . $parent_id . '/';
-			}
-
-			$values[ $this->fields['lineage'] ] = $lineage;
-			$values[ $this->fields['level'] ]   = $this->_getLevel( $lineage );
-
-			// compute position. If passed in arg we check if really can be that value, otherwise get the total of brothers and place node at the end
-			$total_brothers = $this->numChildren( $parent_id );
-
-			if ( is_numeric( $position ) && intval( $position ) > 0 && intval( $position ) < 1 + $total_brothers ){
-				$values[ $this->fields['position'] ] = intval( $position );
-			}else{
-				$values[ $this->fields['position'] ] = 1 + $total_brothers;
-			}
-
-			// increment position of nodes that have the same parent AND have position bigger than $position
-			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' + 1 WHERE ' . $this->fields['parent'] . ' = ' . intval( $parent_id ) . ' AND ' .  $this->fields['position'] . ' > ' . $values[ $this->fields['position'] ] );
-
-			// insert node
-			$this->db->executeInsert( $this->table, $values );
-
-			return $this->db->getLastInsertID();
-        }
-
-
-        /**
-         *  This function updates a node in the database.
-         *
-         *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
-         *  @param $id          (optional) The ID of the node to update.
-         *
-         *  @returns    Total of lines affected
-         */
-        function updateNode( $values, $id ) {
-
-            // Convert the values from an ojbect to an array
-            $values = $this->_toNodeArray( $values );
-
-			// delete reserved fields. Any update on these could corrupt all information ;)
-			if ( isset( $values[ $this->fields['id'] ] ) )			unset( $values[ $this->fields['id'] ] );
-			if ( isset( $values[ $this->fields['parent'] ] ) )		unset( $values[ $this->fields['parent'] ] );
-			if ( isset( $values[ $this->fields['lineage'] ] ) )		unset( $values[ $this->fields['lineage'] ] );
-			if ( isset( $values[ $this->fields['level'] ] ) )		unset( $values[ $this->fields['level'] ] );
-			if ( isset( $values[ $this->fields['position'] ] ) )	unset( $values[ $this->fields['position'] ] );
-
-            // Perform the insert
-            return $this->db->executeUpdate( $this->table, $values, $this->fields['id'] . ' = ' . intval( $id ) );
-        }
-
-
-        /**
-         *  Delete the node and it's children.
-         *
-         *  @param $id             The ID of the node to delete.
-         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
-         *
-         *  @returns    Total of lines affected
-         */
-        function deleteNode( $id, $deleteAll = true ) {
-
-            // delete nodes
-			if ( $deleteAll ){
-
-	            // get the node details before delete
-	            $node = $this->getNode( $id );
-
-				// delete id. we must update brothers positions of this id
-	            $res = $this->db->executeSql( 'DELETE FROM ' . $this->table . ' WHERE ' . $this->fields['id'] . ' = ' . intval( $id ) );
-
-				// update positions. decrease position of nodes with same parent when position id bigger than $node[position]
-				$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' - 1 WHERE ' . $this->fields['parent'] . ' = ' . $node[ $this->fields['parent'] ] . ' AND ' . $this->fields['position'] . ' > ' . $node[ $this->fields['position'] ] );
-
-			// delete children of $id
-			}else{
-
-				// delete children of $id. we don't need to update position because all children will be deleted
-	            $res = $this->db->executeSql( 'DELETE FROM ' . $this->table . ' WHERE ' . $this->fields['parent'] . ' = ' .  intval( $id ) );
-			}
-
-			return $res;
-        }
-
-
-        /**
-         *  Move a node to a different parent node.
-         *
-         *  @param  $id         	The ID of the node to move-
-         *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
-         *  @param  $position   	(optional) The new position.
-         */
-        function moveNode( $id, $new_parent_id = null, $position = null ) {
-
-            // get old node details before move
-            $old_node      = $this->getNode( $id );
-            $old_parent_id = $old_node[ $this->fields['parent'] ];
-            $old_position  = $old_node[ $this->fields['position'] ];
-            $old_lineage   = $old_node[ $this->fields['lineage'] ];
-
-			// compute new parent id
-			if ( ! is_numeric( $new_parent_id ) ) $new_parent_id = $old_node[ $this->fields['parent'] ];
-
-			// if position not set, we will move node to the end of the new parent
-			$total_new_brothers = $this->numChildren( $new_parent_id );
-
-			if ( is_numeric( $position ) && intval( $position ) > 0 && intval( $position ) < 1 + $total_new_brothers ){
-				$new_position = intval( $position );
-			}else{
-				$new_position = 1 + $total_new_brothers;
-			}
-
-			// get information of old and new parents
-            $old_parent_node     = $this->getNode( $old_parent_id );
-            $new_parent_node     = $this->getNode( $new_parent_id );
-			$new_lineage         = $new_parent_node[ $this->fields['lineage'] ] . $new_parent_id . '/';
-
-			// compute node to add
-			$values[ $this->fields['parent'] ] = $new_parent_id;
-			$values[ $this->fields['lineage'] ]   = $new_lineage;
-			$values[ $this->fields['level'] ]     = $this->_getLevel( $new_lineage );
-			$values[ $this->fields['position'] ]  = $new_position;
-
-			// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
-			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' + 1 WHERE ' . $this->fields['parent'] . ' = ' . $new_parent_id . ' AND ' . $this->fields['position'] . ' > ' . $new_position );
-
-			// decrease positions of old brothers that have position bigger than this node position
-			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['position'] . ' = ' . $this->fields['position'] . ' - 1 WHERE ' . $this->fields['parent'] . ' = ' . $old_parent_id . ' AND ' . $this->fields['position'] . ' > ' . $old_position );
-
-			// update node
-            $res = $this->db->executeUpdate( $this->table, $values, $this->fields['id'] . ' = ' . $id );
-
-			// update lineage of all descendants of this node.
-			$this->db->executeSql( 'UPDATE ' . $this->table . ' SET ' . $this->fields['lineage'] . ' = REPLACE(' . $this->fields['lineage'] . ',"' . $old_lineage . '/' . $id . '/","' . $new_lineage . '/' . $id . '/")' );
-
-			return $res;
-        }
-
-
-    }
-
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 22:02:49 UTC (rev 2338)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree3.php	2007-01-22 22:19:44 UTC (rev 2339)
@@ -1,809 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /**
-     *  @addtogroup YDDatabase Core - Database
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-	// add YDF libs needed by this class
-	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
-
-
-    /** Database scheme example
-        
-        CREATE TABLE nested_tree (
-            id int NOT NULL auto_increment,
-            parent_id int NULL,
-            lineage varchar(255) NOT NULL default '//',
-            level int NOT NULL default '1',
-            position int NOT NULL default '1',
-            title varchar(255) NOT NULL default '',
-            PRIMARY KEY (id),
-            FOREIGN KEY (parent_id)
-                REFERENCES nested_tree(id)
-                     ON DELETE CASCADE
-                     ON UPDATE CASCADE
-        )TYPE=InnoDB;
-    
-        Note: root node must have ID 1, PARENT null and LINEAGE '' !
-       
-        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
-        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
-        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
-        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
-        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
-        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
-        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
-        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
-        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
-        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
-     */
-
-    /**
-     *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject
-     *
-     *  @ingroup YDDatabase
-     */
-    class YDDatabaseTree3 extends YDDatabaseObject {
-    
-        function YDDatabaseTree3( $table, $db = 'default', $idField = 'id', $parentField = 'parent_id', $lineageField = 'lineage', $levelField = 'level', $positionField = 'position' ) {
-        
-			// init DB object
-            $this->YDDatabaseObject();
-
-			// register database
-            $this->registerDatabase( $db );
-
-			// register table
-            $this->registerTable( $table );
-
-			// register reserved fields
-			$this->registerKey( $idField, true );
-			$this->registerField( $parentField );
-			$this->registerField( $lineageField );
-			$this->registerField( $levelField );
-			$this->registerField( $positionField );
-
-			// save field names for future use
-			$this->__id       = $idField;
-			$this->__parent   = $parentField;
-			$this->__lineage  = $lineageField;
-			$this->__level    = $levelField;
-			$this->__position = $positionField;
-
-			$this->__table_id       = $table . '.' . $idField;
-			$this->__table_parent   = $table . '.' . $parentField;
-			$this->__table_lineage  = $table . '.' . $lineageField;
-			$this->__table_level    = $table . '.' . $levelField;
-			$this->__table_position = $table . '.' . $positionField;
-
-
-			// define a generic tree order
-			$this->setOrder( $this->__table_parent . ' ASC, ' . $this->__table_position . ' ASC' );
-		}
-
-
-        /**
-         *  This function defines the order used in all SELECTS
-         *
-         *  @param $sql  The sql order string.
-         */
-        function setOrder( $sql ){
-
-			return $this->_tree_order = $sql;
-        }
-
-
-        /**
-         *  This function will overide the YDDatabaseObject to reset object but init order
-         */
-		function resetAll(){
-			parent::resetAll();
-			$this->order( $this->_tree_order );
-		}
-
-
-        /**
-         *  Returns the node level based on the lineage string
-         *
-         *  @returns  level int value
-         */
-        function _getLevel( $lineage ) {
-			return substr_count( $lineage, '/' ) - 1;
-        }
-
-
-        /**
-         *  Fetch the node data for the node identified by $id.
-         *
-         *  @param $id      The ID of the node to fetch.
-         *  @param $field   (Optional) The unique field to select on. Defaults to id, which means that the ID field specified
-         *                  when the object was instantiated will be used.
-         *  @param $class   (optional) Relation name
-         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns An object containing the node's data, or false if node not found
-         */
-        function getNode( $id, $field = null, $class = null, $prefix = false ) {
-
-			$this->resetAll();
-
-            // get node
-            return $this->_getNode( $id, $field, $class, $prefix );
-        }
-
-
-        /**
-         *  Helper method to fetch a node.
-         *
-         *  @param $id      The ID of the node to fetch.
-         *  @param $field   (optional) The unique field to select on. Defaults to id, which means that the ID field specified
-         *                             when the object was instantiated will be used.
-         *  @param $class   (optional) Relation name
-         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: true.
-         *
-         *  @returns An object containing the node's data, or false if node not found
-         */
-        function _getNode( $id, $field = null, $class = null, $prefix = true ) {
-
-			// if field not defined, field is id
-			if ( is_null( $field ) ) $field = $this->__id;
-	
-			// set local field
-			if ( is_null( $class ) ){
-
-				// set field value
-				$this->set( $field, $id );
-			}else{
-
-				// load relation and set field
-				$this->load( $class );
-				$this->$class->set( $field, $id );
-			}
-
-			// check results
-			if ( $this->findAll() == 0 ) return false;
-
-            // Execute the query and return the record
-            return $this->getValues( false, false, false, $prefix );
-        }
-
-
-        /**
-         *  Fetch the descendants of a node. NOTE: To get all elements use getTreeElements()
-         *
-         *  @param $id              The ID of the node to fetch descendant data for. 
-         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
-         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
-         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns The descendants of the passed now
-         */
-        function getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
-
-			// check if we want an invalid id (like 0 or 1)
-			if ( $id < 2 ) return $this->getTreeElements();
-
-			$this->resetAll();
-
-			return $this->_getDescendants( $id, $includeSelf, $maxLevel, $prefix );
-		}
-
-
-        /**
-         *  Helper to fetch the descendants of a node
-         *
-         *  @param $id              The ID of the node to fetch descendant data for. 
-         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
-         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
-         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns The descendants of id
-         */
-        function _getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
-
-            // get just children
-			if ( $includeSelf == false ) $this->where(       $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
-			else                         $this->where( '(' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
-
-			// check max level to retrieve
-			if ( is_numeric( $maxLevel ) ) $this->where( $this->__table_level . '<' . intval( $maxLevel ) );
-
-			// find nodes
-			$this->findAll();
-
-			// return all nodes
-			return $this->getResults( false, false, false, $prefix );
-		}
-
-
-        /**
-         *  Fetch all elements of a tree
-         *
-         *  @returns All tree nodes
-         */
-        function getTreeElements() {
-
-			$this->resetAll();
-
-			return $this->_getTreeElements();
-		}
-
-
-        /**
-         *  Helper to fetch all elements of a tree
-         *
-         *  @returns All tree nodes
-         */
-        function _getTreeElements() {
-
-			// get all elements except root
-			$this->where( $this->__table_id . ' > 1' );
-
-			// find elements
-			$this->findAll();
-
-			// return all nodes
-			return $this->getResults();
-		}
-
-
-        /**
-         *  Helper to fetch all elements of a tree as an assocArray
-         *
-         *  @param $columns             (Optional) Columns to retrieve. Default: add columns
-         *  @param $key                 (Optional) Key to use. Default: current table key
-         *
-         *  @returns All tree nodes
-         */
-        function _getTreeElementsAsAssocArray( $columns = array(), $key = null ) {
-
-			// get all elements except root
-			$this->where( $this->__table_id . ' > 1' );
-
-			// find elements
-			$this->findAll();
-
-			// compute key
-			if ( is_null( $key ) ) $key = $this->__id;
-
-			// return all nodes
-			return $this->getResultsAsAssocArray( $key, $columns );
-		}
-
-
-        /**
-         *  Fetch the children of a node, or if no node is specified, fetch the top level items.
-         *
-         *  @param $id             The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Include self node in results. Default: false.
-         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns The children of the passed id
-         */
-        function getChildren( $id, $includeSelf = false, $prefix = false ){
-
-			$this->resetAll();
-			
-			return $this->_getChildren( $id, $includeSelf, $prefix );
-        }
-
-
-        /**
-         *  Helper to fetch the children of a node, or if no node is specified, fetch the top level items.
-         *
-         *  @param $id             The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Include self node in results. Default: false.
-         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns The children of the passed id
-         */
-        function _getChildren( $id, $includeSelf = false, $prefix = false  ){
-
-            // get just children
-			if ( $includeSelf == false ) $this->where(       $this->__table_parent . ' = ' . intval( $id ) );
-			else                         $this->where( '(' . $this->__table_parent . ' = ' . intval( $id ) . ' OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
-
-			$this->findAll();
-
-			return $this->getResults( false, false, false, $prefix );
-        }
-
-
-        /**
-         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
-         *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
-         *  array).
-         *
-         *  @param $id             The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
-         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns An array of each node to passed node
-         */
-        function getPath( $id, $includeSelf = false, $prefix = false ) {
-
-			$this->resetAll();
-
-			return $this->_getPath( $id, $includeSelf, $prefix );
-        }
-
-
-        /**
-         *  Helper to fetch the path to a node. 
-         *
-         *  @param $id             The ID of the node to fetch child data for.
-         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
-         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
-         *
-         *  @returns An array of each node to passed node
-         */
-        function _getPath( $id, $includeSelf = false, $prefix = false ) {
-
-            // Get the node
-            $node = $this->getNode( intval($id) ) ;
-
-			// reset values of previous getNode()
-			$this->resetAll();
-
-            // No node, return empty array
-            if ( ! $node ) return array();
-
-			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
-			$nodes = array_map( 'intval', explode( '/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) );
-
-			// if we want current node too, lets add it to nodes array
-            if ( $includeSelf == true ) $nodes[] = intval( $id );
-
-			// apply where clause
-			$this->where( $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
-
-			$this->findAll();
-
-			return $this->getResults( false, false, false, $prefix );
-        }
-
-
-        /**
-         *  Check if one node descends from another node. If either node is not found, then false is returned.
-         *
-         *  @param $descendant_id  The node that potentially descends
-         *  @param $ancestor_id    The node that is potentially descended from
-         *
-         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
-         */
-        function isDescendantOf( $descendant_id, $ancestor_id ) {
-
-			// if ancertor is root, element is descendant if exist
-			if ( $ancestor_id == 1 ) return ( $this->getNode( $descendant_id ) != false );
-
-			$this->resetAll();
-			
-			return $this->_isDescendantOf( $descendant_id, $ancestor_id );
-        }
-
-
-        /**
-         *  Helper to check if one node descends from another node.
-         *
-         *  @param $descendant_id  The node that potentially descends
-         *  @param $ancestor_id    The node that is potentially descended from
-         *
-         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
-         */
-        function _isDescendantOf( $descendant_id, $ancestor_id ) {
-
-			// id must be the descendant
-			$this->set( $this->__id, intval( $descendant_id ) );
-
-			// check if descendant has the ancestor in lineage ;)
-			$this->where( $this->__table_lineage . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' );
-		
-			// get total of rows
-			return ( $this->findAll() == 1 );
-        }
-
-
-        /**
-         *  Check if one node is a child of another node. If either node is not found, then false is returned.
-         *
-         * @param $child_id       The node that is possibly a child
-         * @param $parent_id      The node that is possibly a parent
-         *
-         * @returns True if $child_id is a child of $parent_id, false otherwise
-         */
-        function isChildOf( $child_id, $parent_id ) {
-
-			$this->resetAll();
-
-			// check if there is a id that equals $child_id
-			$this->set( $this->__id, intval( $child_id ) );
-
-			// check if there is a parent that equals $parent_id
-			$this->where( $this->__table_parent . ' = ' . intval( $parent_id ) );
-
-			// get total of rows
-			return ( $this->findAll() == 1 );
-        }
-
-
-        /**
-         *  Find the number of descendants a node has
-         *
-         *  @param $id     The ID of the node to search for.
-         *
-         *  @returns The number of descendants the node has
-         */
-        function numDescendants( $id ) {
-
-			$this->resetAll();
-
-			return $this->_numDescendants( $id );
-        }
-
-
-        /**
-         *  Helper to find the number of descendants a node has
-         *
-         *  @param $id     The ID of the node to search for.
-         *
-         *  @returns The number of descendants the node has
-         */
-        function _numDescendants( $id ) {
-
-			// search all nodes that contains this id in lineage. if node is root, count all nodes
-			if ( $id > 1 ) $this->where( $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
-
-			// find them
-			return $this->findAll();
-        }
-
-
-        /**
-         *  Find the number of children a node has
-         *
-         *  @param $id     The ID of the node to search for. Pass 0 to count the first level items
-         *
-         *  @returns The number of descendants the node has, or -1 if the node isn't found.
-         */
-        function numChildren( $id ) {
-
-			$this->resetAll();
-
-			// search all nodes that contains this id in lineage
-			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
-
-			// find them
-			return $this->findAll();
-        }
-
-
-        /**
-         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. 
-         *
-         * @param $id   The ID of the node to fetch child data for.
-         *
-         * @returns An array of each node in the family
-         */
-        function getImmediateFamily( $id ) {
-
-            // Get the node parent
-            $node = $this->getNode( $id );
-
-            // No node, return empty array
-            if ( ! $node ) return array();
-
-			$this->resetAll();
-
-			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
-			$this->where( '(' . $this->__table_parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__table_id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' . ')' );
-
-			$this->findAll();
-
-            // Execute the query and get the record
-            return $this->getResults();
-        }
-
-
-        /**
-         *  This function adds a node to the database.
-         *
-         *  @param $values      The field values of the node. Do NOT define parent_id here!
-         *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child (its parent will be 1)
-         *  @param $position    (optional) Node position. If not set, node will be added at the end position
-         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
-         *
-         *  @returns    The ID of the newly inserted node.
-         */
-        function addNode( $values, $parent_id = 1, $position = null, $onDate = 'datetimesql' ) {
-
-			// check values
-			foreach( $values as $element => $value )
-				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
-
-            // compute linege. to do that we must check if we want to add node to root
-            if ( $parent_id == 1 ) { 
-
-				// compute lineage
-				$lineage = '//';
-			}else{
-
-				// get parent lineage and compute node lineage
-				$parent_node = $this->getNode( $parent_id );
-				$lineage     = $parent_node[ $this->__lineage ] . $parent_id . '/';
-			}
-
-			// get how much brothers we will have
-			$total_brothers = $this->numChildren( $parent_id );
-
-			// compute position. If passed in arg we check if really can be that value, otherwise place node at the end
-			if ( !is_numeric( $position ) || intval( $position ) < 1 || intval( $position ) > $total_brothers + 1 )
-				$position = $total_brothers + 1;
-
-			// create an empty position. To do this, if node is not added in the end, we must increment position of nodes that have the same parent and equal or bigger position 
-			if ( $position != $total_brothers + 1 ){
-	
-				$this->resetAll();
-
-				// position field must increment
-				$this->set( $this->__position, $this->__table_position . ' + 1' );
-
-				// only on new brothers with higher or equal position
-				$this->where( '(' . $this->__table_parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__table_position . ' >= ' . intval( $position ) . ')' );
-
-				// lets update.
-				$this->update( array(), $this->__position );
-			}
-
-			// reset any previous value to create insert
-			$this->resetAll();
-
-			// apply custom values
-			$this->setValues( $values );
-
-			// override reserved fields
-			$this->set( $this->__parent,   $parent_id );
-			$this->set( $this->__lineage,  $lineage );
-			$this->set( $this->__level,    $this->_getLevel( $lineage ) );
-			$this->set( $this->__position, $position );
-
-			return $this->insert();
-        }
-
-
-        /**
-         *  This function updates a node fields ( that are NOT RESERVED only )
-         *
-         *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
-         *  @param $id          (optional) The ID of the node to update.
-         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
-         *
-         *  @returns    Total of lines affected
-         */
-        function updateNode( $values, $id, $onDate = 'datetimesql' ) {
-
-			// check values
-			foreach( $values as $element => $value )
-				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
-
-			$this->resetAll();
-
-			// apply custom values
-			$this->setValues( $values );
-			
-			// overwrite id
-			$this->set( $this->__id, intval( $id ) );
-
-			// unset reserved fields
-			$this->unsetVar( $this->__parent );
-			$this->unsetVar( $this->__lineage );
-			$this->unsetVar( $this->__level );
-			$this->unsetVar( $this->__position );
-
-			return $this->update();
-        }
-
-
-        /**
-         *  Delete the node and it's children. NOTE: Make shure your table is in InnoDB !
-         *
-         *  @param $id             The ID of the node to delete.
-         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
-         *
-         *  @returns    Total of lines affected
-         */
-        function deleteNode( $id, $deleteAll = true ) {
-
-            // if we want to delete $id (and all children) we must update positions in all $id brothers after delete
-			if ( $deleteAll ){
-
-	            // get node details before delete. we must know the position
-	            $node = $this->getNode( $id );
-
-				$this->resetAll();
-
-				$this->set( $this->__id, intval( $id ) );
-
-				// if delete didn't affect any rows we don't need to update brothers
-				$total = $this->delete();
-				
-				if ( $total == 0 ) return 0;
-
-				$this->resetAll();
-
-				// decrease positions
-				$this->set( $this->__position, $this->__table_position . ' - 1' );
-
-				// in all elements with same parent AND position bigger than our
-				$this->where( '(' . $this->__table_parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__table_position . ' > ' . intval( $node[ $this->__position ] ) . ')' );
-
-				$this->update( array(), $this->__position );
-				
-				return $total;
-			}
-
-			// here we want do delete child only
-			$this->resetAll();
-
-			// we only need to delete children. Children of children will be deleted when mysql is InnoDB
-			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
-
-			return $this->delete();
-        }
-
-
-        /**
-         *  Move a node to a different parent node.
-         *
-         *  @param  $id             The ID of the node to move
-         *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
-         *  @param  $new_position   (optional) The new position.
-         */
-        function moveNode( $id, $new_parent_id = null, $new_position = null ) {
-
-            // get old node details before move
-            $old_node      = $this->getNode( $id );
-            $old_parent_id = $old_node[ $this->__parent ];
-            $old_position  = $old_node[ $this->__position ];
-            $old_lineage   = $old_node[ $this->__lineage ];
-
-			// compute new parent id
-			if ( ! is_numeric( $new_parent_id ) ) $new_parent_id = $old_parent_id;
-
-			// if position not set, we will move node to the end of the new parent
-			$total_new_brothers = $this->numChildren( $new_parent_id );
-
-			// if custom position is not valid add node at end
-			if ( ! is_numeric( $new_position ) || intval( $new_position ) < 1 || intval( $new_position ) > $total_new_brothers + 1 )
-				$new_position = 1 + $total_new_brothers;
-
-			// get information of old parent
-            $old_parent_node = $this->getNode( $old_parent_id );
-
-			// get information of new parent if diferent than old parent
-			if ( $new_parent_id == $old_parent_id ) $new_parent_node = $old_parent_node;
-            else                                    $new_parent_node = $this->getNode( $new_parent_id );
-
-
-			// only update positions if new parent and old parent are not the same OR if (they are same but) positions are not changed
-			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
-
-				// decrease positions of old brothers that have position bigger than this node position
-				$this->resetAll();
-				$this->set( $this->__position, $this->__table_position . ' - 1' );
-				$this->where( '(' . $this->__table_parent . ' = ' . $old_parent_id . ' AND ' . $this->__table_position . ' > ' . $old_position . ')' );
-				$this->update( array(), $this->__position );
-
-				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
-				$this->resetAll();
-				$this->set( $this->__position, $this->__table_position . ' + 1' );
-				$this->where( '(' . $this->__table_parent . ' = ' . $new_parent_id . ' AND ' . $this->__table_position . ' >= ' . $new_position . ')' );
-				$this->update( array(), $this->__position );
-			}
-
-			// compute lineage
-			if ( $new_parent_id == 1 ) $new_lineage = '//';
-			else                       $new_lineage = $new_parent_node[ $this->__lineage ] . $new_parent_id . '/';
-
-			// update node
-			$this->resetAll();
-			$this->set( $this->__id,       intval( $id ) );
-			$this->set( $this->__parent,   intval( $new_parent_id ) );
-			$this->set( $this->__lineage,  $new_lineage );
-			$this->set( $this->__level,    $this->_getLevel( $new_lineage ) );
-			$this->set( $this->__position, intval( $new_position ) );
-			$res = $this->update();
-			
-			// update lineages of node descendants ;)
-			if ( $new_parent_id != $old_parent_id ){
-				$this->resetAll();
-				$this->set( $this->__lineage, 'REPLACE(' . $this->__table_lineage . ',"' . $old_lineage . $id . '/","' . $new_lineage . $id . '/")' );
-				$this->where( $this->__table_id . ' > 1 ' );
-				$this->update( array(), $this->__lineage );
-			}
-
-			return $res;
-        }
-
-
-        /**
-         *  Fetch an array of tree nodes containing a traversal of the tree. 
-         *
-         * @param $id   (optional) The ID of the node to fetch child data for.
-         *
-         * @returns An array of each node in the tree
-         */
-		function getTraversedTree( $id = 1 ) {
-		
-			$this->_tree_data = $this->getTreeElements();
-			$this->_tree_data_keys = array_keys( $this->_tree_data );
-		
-			return $this->_getTraversedTree( $id );
-		}
-
-
-        /**
-         *  Helper function to get traversal of tree. 
-         *
-         * @param $id   (optional) The ID of the node to fetch child data for.
-         *
-         * @returns An array of each node in the tree
-         */
-		function _getTraversedTree( $id = 1 ) {
-		
-			$key_match = false;
-			
-			foreach ( $this->_tree_data_keys as $key ) {
-				if ( $this->_tree_data[$key]['id'] == $id ) {
-					$key_match = true;
-					$ref = & $this->_tree_data[$key];
-					break;
-				}
-			}
-			
-			if ( $key_match ) {
-				$result = array( $ref );
-			} else {
-				$result = array();
-			}
-			
-			$children = $this->getChildren ( $id, true );
-			
-			foreach ( $children as $child ) {			
-				$child_ids = $this->getTraversedTree( $child['id'] );				
-				$result = array_merge( $result, $child_ids );
-			}
-						
-			return $result;
-		}
-		
-
-    }
-?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-01-22 22:02:49 UTC (rev 2338)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-01-22 22:19:44 UTC (rev 2339)
@@ -0,0 +1,809 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    /**
+     *  @addtogroup YDDatabase Core - Database
+     */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// add YDF libs needed by this class
+	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
+
+
+    /** Database scheme example
+        
+        CREATE TABLE nested_tree (
+            id int NOT NULL auto_increment,
+            parent_id int NULL,
+            lineage varchar(255) NOT NULL default '//',
+            level int NOT NULL default '1',
+            position int NOT NULL default '1',
+            title varchar(255) NOT NULL default '',
+            PRIMARY KEY (id),
+            FOREIGN KEY (parent_id)
+                REFERENCES nested_tree(id)
+                     ON DELETE CASCADE
+                     ON UPDATE CASCADE
+        )TYPE=InnoDB;
+    
+        Note: root node must have ID 1, PARENT null and LINEAGE '' !
+       
+        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
+        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
+     */
+
+    /**
+     *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject
+     *
+     *  @ingroup YDDatabase
+     */
+    class YDDatabaseObjectTree extends YDDatabaseObject {
+    
+        function YDDatabaseObjectTree( $table, $db = 'default', $idField = 'id', $parentField = 'parent_id', $lineageField = 'lineage', $levelField = 'level', $positionField = 'position' ) {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database
+            $this->registerDatabase( $db );
+
+			// register table
+            $this->registerTable( $table );
+
+			// register reserved fields
+			$this->registerKey( $idField, true );
+			$this->registerField( $parentField );
+			$this->registerField( $lineageField );
+			$this->registerField( $levelField );
+			$this->registerField( $positionField );
+
+			// save field names for future use
+			$this->__id       = $idField;
+			$this->__parent   = $parentField;
+			$this->__lineage  = $lineageField;
+			$this->__level    = $levelField;
+			$this->__position = $positionField;
+
+			$this->__table_id       = $table . '.' . $idField;
+			$this->__table_parent   = $table . '.' . $parentField;
+			$this->__table_lineage  = $table . '.' . $lineageField;
+			$this->__table_level    = $table . '.' . $levelField;
+			$this->__table_position = $table . '.' . $positionField;
+
+
+			// define a generic tree order
+			$this->setOrder( $this->__table_parent . ' ASC, ' . $this->__table_position . ' ASC' );
+		}
+
+
+        /**
+         *  This function defines the order used in all SELECTS
+         *
+         *  @param $sql  The sql order string.
+         */
+        function setOrder( $sql ){
+
+			return $this->_tree_order = $sql;
+        }
+
+
+        /**
+         *  This function will overide the YDDatabaseObject to reset object but init order
+         */
+		function resetAll(){
+			parent::resetAll();
+			$this->order( $this->_tree_order );
+		}
+
+
+        /**
+         *  Returns the node level based on the lineage string
+         *
+         *  @returns  level int value
+         */
+        function _getLevel( $lineage ) {
+			return substr_count( $lineage, '/' ) - 1;
+        }
+
+
+        /**
+         *  Fetch the node data for the node identified by $id.
+         *
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   (Optional) The unique field to select on. Defaults to id, which means that the ID field specified
+         *                  when the object was instantiated will be used.
+         *  @param $class   (optional) Relation name
+         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns An object containing the node's data, or false if node not found
+         */
+        function getNode( $id, $field = null, $class = null, $prefix = false ) {
+
+			$this->resetAll();
+
+            // get node
+            return $this->_getNode( $id, $field, $class, $prefix );
+        }
+
+
+        /**
+         *  Helper method to fetch a node.
+         *
+         *  @param $id      The ID of the node to fetch.
+         *  @param $field   (optional) The unique field to select on. Defaults to id, which means that the ID field specified
+         *                             when the object was instantiated will be used.
+         *  @param $class   (optional) Relation name
+         *  @param $prefix  (optional) Adds the relation's vars as prefixes to the keys. Default: true.
+         *
+         *  @returns An object containing the node's data, or false if node not found
+         */
+        function _getNode( $id, $field = null, $class = null, $prefix = true ) {
+
+			// if field not defined, field is id
+			if ( is_null( $field ) ) $field = $this->__id;
+	
+			// set local field
+			if ( is_null( $class ) ){
+
+				// set field value
+				$this->set( $field, $id );
+			}else{
+
+				// load relation and set field
+				$this->load( $class );
+				$this->$class->set( $field, $id );
+			}
+
+			// check results
+			if ( $this->findAll() == 0 ) return false;
+
+            // Execute the query and return the record
+            return $this->getValues( false, false, false, $prefix );
+        }
+
+
+        /**
+         *  Fetch the descendants of a node. NOTE: To get all elements use getTreeElements()
+         *
+         *  @param $id              The ID of the node to fetch descendant data for. 
+         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns The descendants of the passed now
+         */
+        function getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
+
+			// check if we want an invalid id (like 0 or 1)
+			if ( $id < 2 ) return $this->getTreeElements();
+
+			$this->resetAll();
+
+			return $this->_getDescendants( $id, $includeSelf, $maxLevel, $prefix );
+		}
+
+
+        /**
+         *  Helper to fetch the descendants of a node
+         *
+         *  @param $id              The ID of the node to fetch descendant data for. 
+         *  @param $includeSelf     (optional) Whether or not to include the passed node in results. 
+         *  @param $maxLevel        (optional) Max level to retrieve. Eg: 10 returns all descendants with level smaller than 10; NULL retrieve all descendants.
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns The descendants of id
+         */
+        function _getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
+
+            // get just children
+			if ( $includeSelf == false ) $this->where(       $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+			else                         $this->where( '(' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%" OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
+
+			// check max level to retrieve
+			if ( is_numeric( $maxLevel ) ) $this->where( $this->__table_level . '<' . intval( $maxLevel ) );
+
+			// find nodes
+			$this->findAll();
+
+			// return all nodes
+			return $this->getResults( false, false, false, $prefix );
+		}
+
+
+        /**
+         *  Fetch all elements of a tree
+         *
+         *  @returns All tree nodes
+         */
+        function getTreeElements() {
+
+			$this->resetAll();
+
+			return $this->_getTreeElements();
+		}
+
+
+        /**
+         *  Helper to fetch all elements of a tree
+         *
+         *  @returns All tree nodes
+         */
+        function _getTreeElements() {
+
+			// get all elements except root
+			$this->where( $this->__table_id . ' > 1' );
+
+			// find elements
+			$this->findAll();
+
+			// return all nodes
+			return $this->getResults();
+		}
+
+
+        /**
+         *  Helper to fetch all elements of a tree as an assocArray
+         *
+         *  @param $columns             (Optional) Columns to retrieve. Default: add columns
+         *  @param $key                 (Optional) Key to use. Default: current table key
+         *
+         *  @returns All tree nodes
+         */
+        function _getTreeElementsAsAssocArray( $columns = array(), $key = null ) {
+
+			// get all elements except root
+			$this->where( $this->__table_id . ' > 1' );
+
+			// find elements
+			$this->findAll();
+
+			// compute key
+			if ( is_null( $key ) ) $key = $this->__id;
+
+			// return all nodes
+			return $this->getResultsAsAssocArray( $key, $columns );
+		}
+
+
+        /**
+         *  Fetch the children of a node, or if no node is specified, fetch the top level items.
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Include self node in results. Default: false.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns The children of the passed id
+         */
+        function getChildren( $id, $includeSelf = false, $prefix = false ){
+
+			$this->resetAll();
+			
+			return $this->_getChildren( $id, $includeSelf, $prefix );
+        }
+
+
+        /**
+         *  Helper to fetch the children of a node, or if no node is specified, fetch the top level items.
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Include self node in results. Default: false.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns The children of the passed id
+         */
+        function _getChildren( $id, $includeSelf = false, $prefix = false  ){
+
+            // get just children
+			if ( $includeSelf == false ) $this->where(       $this->__table_parent . ' = ' . intval( $id ) );
+			else                         $this->where( '(' . $this->__table_parent . ' = ' . intval( $id ) . ' OR ' . $this->__table_id . ' = ' . intval( $id ) . ')' );
+
+			$this->findAll();
+
+			return $this->getResults( false, false, false, $prefix );
+        }
+
+
+        /**
+         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
+         *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
+         *  array).
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns An array of each node to passed node
+         */
+        function getPath( $id, $includeSelf = false, $prefix = false ) {
+
+			$this->resetAll();
+
+			return $this->_getPath( $id, $includeSelf, $prefix );
+        }
+
+
+        /**
+         *  Helper to fetch the path to a node. 
+         *
+         *  @param $id             The ID of the node to fetch child data for.
+         *  @param $includeSelf    (optional) Whether or not to include the passed node in the the results.
+         *  @param $prefix         (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
+         *  @returns An array of each node to passed node
+         */
+        function _getPath( $id, $includeSelf = false, $prefix = false ) {
+
+            // Get the node
+            $node = $this->getNode( intval($id) ) ;
+
+			// reset values of previous getNode()
+			$this->resetAll();
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			// compute parents of this node. Read lineage, delete first '//', last '/', apply 'intval' to all elements and implode
+			$nodes = array_map( 'intval', explode( '/', substr( substr( $node[ $this->__lineage ], 2 ), 0, -1 ) ) );
+
+			// if we want current node too, lets add it to nodes array
+            if ( $includeSelf == true ) $nodes[] = intval( $id );
+
+			// apply where clause
+			$this->where( $this->__table_id . ' IN (' . $this->escapeSqlArray( $nodes ) . ')' );
+
+			$this->findAll();
+
+			return $this->getResults( false, false, false, $prefix );
+        }
+
+
+        /**
+         *  Check if one node descends from another node. If either node is not found, then false is returned.
+         *
+         *  @param $descendant_id  The node that potentially descends
+         *  @param $ancestor_id    The node that is potentially descended from
+         *
+         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
+         */
+        function isDescendantOf( $descendant_id, $ancestor_id ) {
+
+			// if ancertor is root, element is descendant if exist
+			if ( $ancestor_id == 1 ) return ( $this->getNode( $descendant_id ) != false );
+
+			$this->resetAll();
+			
+			return $this->_isDescendantOf( $descendant_id, $ancestor_id );
+        }
+
+
+        /**
+         *  Helper to check if one node descends from another node.
+         *
+         *  @param $descendant_id  The node that potentially descends
+         *  @param $ancestor_id    The node that is potentially descended from
+         *
+         *  @returns True if $descendant_id descends from $ancestor_id, false otherwise
+         */
+        function _isDescendantOf( $descendant_id, $ancestor_id ) {
+
+			// id must be the descendant
+			$this->set( $this->__id, intval( $descendant_id ) );
+
+			// check if descendant has the ancestor in lineage ;)
+			$this->where( $this->__table_lineage . ' LIKE "%/' . intval( $ancestor_id ) . '/%"' );
+		
+			// get total of rows
+			return ( $this->findAll() == 1 );
+        }
+
+
+        /**
+         *  Check if one node is a child of another node. If either node is not found, then false is returned.
+         *
+         * @param $child_id       The node that is possibly a child
+         * @param $parent_id      The node that is possibly a parent
+         *
+         * @returns True if $child_id is a child of $parent_id, false otherwise
+         */
+        function isChildOf( $child_id, $parent_id ) {
+
+			$this->resetAll();
+
+			// check if there is a id that equals $child_id
+			$this->set( $this->__id, intval( $child_id ) );
+
+			// check if there is a parent that equals $parent_id
+			$this->where( $this->__table_parent . ' = ' . intval( $parent_id ) );
+
+			// get total of rows
+			return ( $this->findAll() == 1 );
+        }
+
+
+        /**
+         *  Find the number of descendants a node has
+         *
+         *  @param $id     The ID of the node to search for.
+         *
+         *  @returns The number of descendants the node has
+         */
+        function numDescendants( $id ) {
+
+			$this->resetAll();
+
+			return $this->_numDescendants( $id );
+        }
+
+
+        /**
+         *  Helper to find the number of descendants a node has
+         *
+         *  @param $id     The ID of the node to search for.
+         *
+         *  @returns The number of descendants the node has
+         */
+        function _numDescendants( $id ) {
+
+			// search all nodes that contains this id in lineage. if node is root, count all nodes
+			if ( $id > 1 ) $this->where( $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' );
+
+			// find them
+			return $this->findAll();
+        }
+
+
+        /**
+         *  Find the number of children a node has
+         *
+         *  @param $id     The ID of the node to search for. Pass 0 to count the first level items
+         *
+         *  @returns The number of descendants the node has, or -1 if the node isn't found.
+         */
+        function numChildren( $id ) {
+
+			$this->resetAll();
+
+			// search all nodes that contains this id in lineage
+			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
+
+			// find them
+			return $this->findAll();
+        }
+
+
+        /**
+         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. 
+         *
+         * @param $id   The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the family
+         */
+        function getImmediateFamily( $id ) {
+
+            // Get the node parent
+            $node = $this->getNode( $id );
+
+            // No node, return empty array
+            if ( ! $node ) return array();
+
+			$this->resetAll();
+
+			// get elements that have parent $parent (this returns current element and brothers), that have id $parent (returns parent), and that have lineage like /$id/ (returns all children)
+			$this->where( '(' . $this->__table_parent . '=' . $node[ $this->__parent ] . ' OR ' . $this->__table_id . ' = ' . $node[ $this->__parent ] . ' OR ' . $this->__table_lineage . ' LIKE "%/' . intval( $id ) . '/%"' . ')' );
+
+			$this->findAll();
+
+            // Execute the query and get the record
+            return $this->getResults();
+        }
+
+
+        /**
+         *  This function adds a node to the database.
+         *
+         *  @param $values      The field values of the node. Do NOT define parent_id here!
+         *  @param $parent_id   The parent ID of the node. If not set, node will be added as a root child (its parent will be 1)
+         *  @param $position    (optional) Node position. If not set, node will be added at the end position
+         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
+         *
+         *  @returns    The ID of the newly inserted node.
+         */
+        function addNode( $values, $parent_id = 1, $position = null, $onDate = 'datetimesql' ) {
+
+			// check values
+			foreach( $values as $element => $value )
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
+
+            // compute linege. to do that we must check if we want to add node to root
+            if ( $parent_id == 1 ) { 
+
+				// compute lineage
+				$lineage = '//';
+			}else{
+
+				// get parent lineage and compute node lineage
+				$parent_node = $this->getNode( $parent_id );
+				$lineage     = $parent_node[ $this->__lineage ] . $parent_id . '/';
+			}
+
+			// get how much brothers we will have
+			$total_brothers = $this->numChildren( $parent_id );
+
+			// compute position. If passed in arg we check if really can be that value, otherwise place node at the end
+			if ( !is_numeric( $position ) || intval( $position ) < 1 || intval( $position ) > $total_brothers + 1 )
+				$position = $total_brothers + 1;
+
+			// create an empty position. To do this, if node is not added in the end, we must increment position of nodes that have the same parent and equal or bigger position 
+			if ( $position != $total_brothers + 1 ){
+	
+				$this->resetAll();
+
+				// position field must increment
+				$this->set( $this->__position, $this->__table_position . ' + 1' );
+
+				// only on new brothers with higher or equal position
+				$this->where( '(' . $this->__table_parent . ' = ' . intval( $parent_id ) . ' AND ' .  $this->__table_position . ' >= ' . intval( $position ) . ')' );
+
+				// lets update.
+				$this->update( array(), $this->__position );
+			}
+
+			// reset any previous value to create insert
+			$this->resetAll();
+
+			// apply custom values
+			$this->setValues( $values );
+
+			// override reserved fields
+			$this->set( $this->__parent,   $parent_id );
+			$this->set( $this->__lineage,  $lineage );
+			$this->set( $this->__level,    $this->_getLevel( $lineage ) );
+			$this->set( $this->__position, $position );
+
+			return $this->insert();
+        }
+
+
+        /**
+         *  This function updates a node fields ( that are NOT RESERVED only )
+         *
+         *  @param $values      The field values of the node. Do NOT update position, parent_id, lineage or level
+         *  @param $id          (optional) The ID of the node to update.
+         *  @param $onDate      (optional) When element of $values is a date (read: array ), we should convert to this format. Default: 'datetimesql'
+         *
+         *  @returns    Total of lines affected
+         */
+        function updateNode( $values, $id, $onDate = 'datetimesql' ) {
+
+			// check values
+			foreach( $values as $element => $value )
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
+
+			$this->resetAll();
+
+			// apply custom values
+			$this->setValues( $values );
+			
+			// overwrite id
+			$this->set( $this->__id, intval( $id ) );
+
+			// unset reserved fields
+			$this->unsetVar( $this->__parent );
+			$this->unsetVar( $this->__lineage );
+			$this->unsetVar( $this->__level );
+			$this->unsetVar( $this->__position );
+
+			return $this->update();
+        }
+
+
+        /**
+         *  Delete the node and it's children. NOTE: Make shure your table is in InnoDB !
+         *
+         *  @param $id             The ID of the node to delete.
+         *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
+         *
+         *  @returns    Total of lines affected
+         */
+        function deleteNode( $id, $deleteAll = true ) {
+
+            // if we want to delete $id (and all children) we must update positions in all $id brothers after delete
+			if ( $deleteAll ){
+
+	            // get node details before delete. we must know the position
+	            $node = $this->getNode( $id );
+
+				$this->resetAll();
+
+				$this->set( $this->__id, intval( $id ) );
+
+				// if delete didn't affect any rows we don't need to update brothers
+				$total = $this->delete();
+				
+				if ( $total == 0 ) return 0;
+
+				$this->resetAll();
+
+				// decrease positions
+				$this->set( $this->__position, $this->__table_position . ' - 1' );
+
+				// in all elements with same parent AND position bigger than our
+				$this->where( '(' . $this->__table_parent . ' = ' . intval( $node[ $this->__parent ] ) . ' AND ' . $this->__table_position . ' > ' . intval( $node[ $this->__position ] ) . ')' );
+
+				$this->update( array(), $this->__position );
+				
+				return $total;
+			}
+
+			// here we want do delete child only
+			$this->resetAll();
+
+			// we only need to delete children. Children of children will be deleted when mysql is InnoDB
+			$this->where( $this->__table_parent . ' = ' . intval( $id ) );
+
+			return $this->delete();
+        }
+
+
+        /**
+         *  Move a node to a different parent node.
+         *
+         *  @param  $id             The ID of the node to move
+         *  @param  $new_parent_id  (optional) The ID of the new parent node. If not set, will be moved in same parent
+         *  @param  $new_position   (optional) The new position.
+         */
+        function moveNode( $id, $new_parent_id = null, $new_position = null ) {
+
+            // get old node details before move
+            $old_node      = $this->getNode( $id );
+            $old_parent_id = $old_node[ $this->__parent ];
+            $old_position  = $old_node[ $this->__position ];
+            $old_lineage   = $old_node[ $this->__lineage ];
+
+			// compute new parent id
+			if ( ! is_numeric( $new_parent_id ) ) $new_parent_id = $old_parent_id;
+
+			// if position not set, we will move node to the end of the new parent
+			$total_new_brothers = $this->numChildren( $new_parent_id );
+
+			// if custom position is not valid add node at end
+			if ( ! is_numeric( $new_position ) || intval( $new_position ) < 1 || intval( $new_position ) > $total_new_brothers + 1 )
+				$new_position = 1 + $total_new_brothers;
+
+			// get information of old parent
+            $old_parent_node = $this->getNode( $old_parent_id );
+
+			// get information of new parent if diferent than old parent
+			if ( $new_parent_id == $old_parent_id ) $new_parent_node = $old_parent_node;
+            else                                    $new_parent_node = $this->getNode( $new_parent_id );
+
+
+			// only update positions if new parent and old parent are not the same OR if (they are same but) positions are not changed
+			if ( $new_parent_id != $old_parent_id || $new_position != $old_position ){
+
+				// decrease positions of old brothers that have position bigger than this node position
+				$this->resetAll();
+				$this->set( $this->__position, $this->__table_position . ' - 1' );
+				$this->where( '(' . $this->__table_parent . ' = ' . $old_parent_id . ' AND ' . $this->__table_position . ' > ' . $old_position . ')' );
+				$this->update( array(), $this->__position );
+
+				// add position space for this node in new parent: increase positions of new brothers that have position bigger than this node position
+				$this->resetAll();
+				$this->set( $this->__position, $this->__table_position . ' + 1' );
+				$this->where( '(' . $this->__table_parent . ' = ' . $new_parent_id . ' AND ' . $this->__table_position . ' >= ' . $new_position . ')' );
+				$this->update( array(), $this->__position );
+			}
+
+			// compute lineage
+			if ( $new_parent_id == 1 ) $new_lineage = '//';
+			else                       $new_lineage = $new_parent_node[ $this->__lineage ] . $new_parent_id . '/';
+
+			// update node
+			$this->resetAll();
+			$this->set( $this->__id,       intval( $id ) );
+			$this->set( $this->__parent,   intval( $new_parent_id ) );
+			$this->set( $this->__lineage,  $new_lineage );
+			$this->set( $this->__level,    $this->_getLevel( $new_lineage ) );
+			$this->set( $this->__position, intval( $new_position ) );
+			$res = $this->update();
+			
+			// update lineages of node descendants ;)
+			if ( $new_parent_id != $old_parent_id ){
+				$this->resetAll();
+				$this->set( $this->__lineage, 'REPLACE(' . $this->__table_lineage . ',"' . $old_lineage . $id . '/","' . $new_lineage . $id . '/")' );
+				$this->where( $this->__table_id . ' > 1 ' );
+				$this->update( array(), $this->__lineage );
+			}
+
+			return $res;
+        }
+
+
+        /**
+         *  Fetch an array of tree nodes containing a traversal of the tree. 
+         *
+         * @param $id   (optional) The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the tree
+         */
+		function getTraversedTree( $id = 1 ) {
+		
+			$this->_tree_data = $this->getTreeElements();
+			$this->_tree_data_keys = array_keys( $this->_tree_data );
+		
+			return $this->_getTraversedTree( $id );
+		}
+
+
+        /**
+         *  Helper function to get traversal of tree. 
+         *
+         * @param $id   (optional) The ID of the node to fetch child data for.
+         *
+         * @returns An array of each node in the tree
+         */
+		function _getTraversedTree( $id = 1 ) {
+		
+			$key_match = false;
+			
+			foreach ( $this->_tree_data_keys as $key ) {
+				if ( $this->_tree_data[$key]['id'] == $id ) {
+					$key_match = true;
+					$ref = & $this->_tree_data[$key];
+					break;
+				}
+			}
+			
+			if ( $key_match ) {
+				$result = array( $ref );
+			} else {
+				$result = array();
+			}
+			
+			$children = $this->getChildren ( $id, true );
+			
+			foreach ( $children as $child ) {			
+				$child_ids = $this->getTraversedTree( $child['id'] );				
+				$result = array_merge( $result, $child_ids );
+			}
+						
+			return $result;
+		}
+		
+
+    }
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Mon Jan 22 23:33:03 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 22 Jan 2007 23:33:03 +0100
Subject: [ydf-devel] r2340 - YDFramework2.0/trunk/examples
Message-ID: <200701222233.l0MMX34f017161@sheep.berlios.de>

Author: ximian
Date: 2007-01-22 23:32:27 +0100 (Mon, 22 Jan 2007)
New Revision: 2340

Added:
   YDFramework2.0/trunk/examples/database_objecttree.php
Removed:
   YDFramework2.0/trunk/examples/database_tree3.php
Log:
- replaced database_tree3.php with database_objecttree.php

Added: YDFramework2.0/trunk/examples/database_objecttree.php
===================================================================
--- YDFramework2.0/trunk/examples/database_objecttree.php	2007-01-22 22:19:44 UTC (rev 2339)
+++ YDFramework2.0/trunk/examples/database_objecttree.php	2007-01-22 22:32:27 UTC (rev 2340)
@@ -0,0 +1,260 @@
+<?php
+
+    // Standard include
+    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
+
+    /*
+
+	    CREATE TABLE nested_tree (
+            id int NOT NULL auto_increment,
+            parent_id int NULL,
+			lineage varchar(255) NOT NULL default '//',
+            level int NOT NULL default '1',
+            position int NOT NULL default '1',
+            title varchar(255) NOT NULL default '',
+            PRIMARY KEY (id),
+			FOREIGN KEY (parent_id)
+                REFERENCES nested_tree(id)
+                     ON DELETE CASCADE
+                     ON UPDATE CASCADE
+        )TYPE=InnoDB;
+
+		Note: root node must have ID 1, PARENT null and LINEAGE '' !
+
+        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
+        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
+        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
+        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
+
+        // ==== Sample data dump =======================================================================================
+		+----+-----------+---------+-------+----------+----------------------+
+		| id | parent_id | lineage | level | position | title                |
+		+----+-----------+---------+-------+----------+----------------------+
+		|  1 |      NULL |         |     0 |        1 |                      |
+		|  2 |         1 | //      |     1 |        1 | General Resources    |
+		|  3 |         2 | //2/    |     2 |        1 | Code Paste           |
+		|  4 |         2 | //2/    |     2 |        2 | Documentation        |
+		|  5 |         2 | //2/    |     2 |        3 | Books & Publications |
+		|  6 |         5 | //2/5/  |     3 |        1 | Apache               |
+		|  7 |         5 | //2/5/  |     3 |        2 | PostgreSQL           |
+		|  8 |         5 | //2/5/  |     3 |        3 | MySQL                |
+		|  9 |         2 | //2/    |     2 |        4 | Links                |
+		| 10 |         9 | //2/9/  |     3 |        1 | Databases            |
+		| 11 |         9 | //2/9/  |     3 |        2 | Generators           |
+		| 12 |         9 | //2/9/  |     3 |        3 | Portals              |
+		+----+-----------+---------+-------+----------+----------------------+
+
+        // =============================================================================================================
+
+    */
+
+    // Includes
+    YDInclude( 'YDRequest.php' );
+    YDInclude( 'YDDatabase.php' );
+    YDInclude( 'YDDatabaseObjectTree.php' );
+
+	YDConfig::set( 'YD_DEBUG', 2 );
+
+    // Class definition
+    class database_objecttree extends YDRequest {
+
+        // Class constructor
+        function database_objecttree() {
+
+            // Call the parent
+            $this->YDRequest();
+
+            // Get the database connection
+            $db = YDDatabase::getInstance( 'mysql', 'tree_test', 'root', '', 'localhost' );
+
+            // Get the tree instance
+            $this->tree = new YDDatabaseObjectTree( 'nested_tree', $db );
+			
+			// register extra column
+			$this->tree->registerField( 'title', true );
+
+        }
+
+        // Default action
+        function actionDefault() {
+
+            // Show the link to the sitemap action
+            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=1">Sitemap</a>' );
+
+            // Get a reference to the tree
+            $tree = & $this->tree;
+
+            // Get a single node
+            YDDebugUtil::dump( $tree->getNode( 2 ), '$tree->getNode( 2 )' );
+
+            // Get the children of a single node
+            YDDebugUtil::dump( $tree->getChildren( 2 ), '$tree->getChildren( 2 )' );
+            YDDebugUtil::dump( $tree->getChildren( 4 ), '$tree->getChildren( 4 )' );
+
+            // Get the descendants of a single node
+            YDDebugUtil::dump( $tree->getDescendants( 4, true ), '$tree->getDescendants( 4, true )' );
+            YDDebugUtil::dump( $tree->getDescendants( 0, true ), '$tree->getDescendants( 0, true )' );
+
+            // Get the path to a node
+            YDDebugUtil::dump( $tree->getPath( 5 ), '$tree->getPath( 5 )' );
+            YDDebugUtil::dump( $tree->getPath( 5, true ), '$tree->getPath( 5, true )' );
+
+            // Check if descendant
+            YDDebugUtil::dump( $tree->isDescendantOf( 9, 1 ), '$tree->isDescendantOf( 9, 1 )' );
+            YDDebugUtil::dump( $tree->isDescendantOf( 9999, 1 ), '$tree->isDescendantOf( 9999, 1 )' );
+            YDDebugUtil::dump( $tree->isDescendantOf( 10, 2 ), '$tree->isDescendantOf( 10, 2 )' );
+
+            // Check if child of
+            YDDebugUtil::dump( $tree->isChildOf( 9, 8 ), '$tree->isChildOf( 9, 8 )' );
+            YDDebugUtil::dump( $tree->isChildOf( 9, 2 ), '$tree->isChildOf( 9, 2 )' );
+
+            // Number of descendants
+            YDDebugUtil::dump( $tree->numDescendants( 9 ), '$tree->numDescendants( 9 )' );
+            YDDebugUtil::dump( $tree->numDescendants( 4 ), '$tree->numDescendants( 4 )' );
+            YDDebugUtil::dump( $tree->numDescendants( 1 ), '$tree->numDescendants( 1 )' );
+
+            // Number of children
+            YDDebugUtil::dump( $tree->numChildren( 9 ), '$tree->numChildren( 9 )' );
+            YDDebugUtil::dump( $tree->numChildren( 4 ), '$tree->numChildren( 4 )' );
+            YDDebugUtil::dump( $tree->numChildren( 1 ), '$tree->numChildren( 1 )' );
+
+            // Get the node's immediate family
+            YDDebugUtil::dump( $tree->getImmediateFamily( 4 ), '$tree->getImmediateFamily( 4 )' );
+
+        }
+		
+        // Add a number of nodes
+        function actionAdd() {
+
+            // Get the node ID
+            $id = ( isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
+
+            // Add an item
+            $values = array( 'title' => 'New Node - ' . time() );
+            
+			if ( isset( $_GET['position'] ) ) $this->tree->addNode( $values, $id, $_GET['position'] );
+			else                              $this->tree->addNode( $values, $id );
+
+            $this->actionExample( $id );
+        }
+
+
+        // Move node
+        function actionMove() {
+
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // get parent of this node
+			$node = $this->tree->getNode( $_GET['id'] );
+
+			// the delete debug is what we want
+  			YDConfig::set( 'YD_DEBUG', 2 );
+
+			if ( isset( $_GET['newparent'] ) ) $newparent = $_GET['newparent']; 
+			else                               $newparent = null;
+
+            // Move node
+			$this->tree->moveNode( $_GET['id'], $newparent, $_GET['position'] );
+
+			// show parent tree
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // Redirect to the sitemap
+            $this->actionExample( $node[ 'parent_id' ] );
+        }
+
+
+        // Delete a node and it's subnodes
+        function actionDelete() {
+
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // get parent of this node
+			$node = $this->tree->getNode( $_GET['id'] );
+
+			// the delete debug is what we want
+  			YDConfig::set( 'YD_DEBUG', 2 );
+
+            // Delete a node
+            if ( isset( $_GET['nodeandchildren'] ) ) $this->tree->deleteNode( $_GET['id'], true );
+			else                                     $this->tree->deleteNode( $_GET['id'], false );
+
+			// show parent tree
+  			YDConfig::set( 'YD_DEBUG', 0 );
+
+            // Redirect to the sitemap
+            $this->actionExample( $node[ 'parent_id' ] );
+        }
+
+
+        // Real life example
+        function actionExample( $id = false ) {
+
+  			YDConfig::set( 'YD_DEBUG', 0 );
+  
+            // Get node ID
+			if ( $id == false ) $id = $_GET['id'];
+
+            // compute root link
+            echo( '<p><b>Path:</b> <a href="' . YD_SELF_SCRIPT . '?do=example&id=1">ROOT</a> &raquo; ' );
+
+            foreach ( $this->tree->getPath( $id ) as $path_item ) {
+                echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $path_item['id'] . '">' . $path_item['title'] . '</a> &raquo; ' );
+            }
+
+			// compute node name
+            $node = $this->tree->getNode( $id );
+            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $node['id'] . '">' . $node['title'] . '</a>' );
+            echo( '</p>' );
+
+            // Show the children in a table
+			echo( '<table><tr><td><b>Children:</b></td><td>actions</td></tr>' );
+			$children = $this->tree->getChildren( $id );
+            foreach ( $children as $child ) {
+				echo( '<tr><td>' );
+
+					// show child action
+                	echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $child['id'] . '">' . $child['title'] . '</a>&nbsp;&nbsp;&nbsp;' );
+				echo( '</td><td>' );
+
+					// delete action element and nodes
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&nodeandchildren=1&id='  . $child['id'] . '">Delete ' . $child['title'] . ' and subnodes</a> | ' );
+
+					// delete action nodes only
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&id='  . $child['id'] . '">Delete nodes of ' . $child['title'] . ' </a> | ' );
+
+					// move up
+					if ( $child['position'] != 1 )
+		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] - 1) . '">Move up</a> | ' );
+
+					// move down
+					if ( $child['position'] != count( $children ) )
+		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] + 1) . '">Move down</a>' );
+
+				echo( '</td></tr>' );
+            }
+  
+  			// add node action
+			echo( '<tr><td></td><td>' );
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at bottom</a> | ' );
+	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&position=1&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at top</a>' );
+			echo( '</td></tr>' );
+
+            echo( '</table>' );
+        }
+
+
+    }
+
+    // Process the request
+    YDInclude( 'YDF2_process.php' );
+
+?>

Deleted: YDFramework2.0/trunk/examples/database_tree3.php
===================================================================
--- YDFramework2.0/trunk/examples/database_tree3.php	2007-01-22 22:19:44 UTC (rev 2339)
+++ YDFramework2.0/trunk/examples/database_tree3.php	2007-01-22 22:32:27 UTC (rev 2340)
@@ -1,260 +0,0 @@
-<?php
-
-    // Standard include
-    include_once( dirname( __FILE__ ) . '/../YDFramework2/YDF2_init.php' );
-
-    /*
-
-	    CREATE TABLE nested_tree (
-            id int NOT NULL auto_increment,
-            parent_id int NULL,
-			lineage varchar(255) NOT NULL default '//',
-            level int NOT NULL default '1',
-            position int NOT NULL default '1',
-            title varchar(255) NOT NULL default '',
-            PRIMARY KEY (id),
-			FOREIGN KEY (parent_id)
-                REFERENCES nested_tree(id)
-                     ON DELETE CASCADE
-                     ON UPDATE CASCADE
-        )TYPE=InnoDB;
-
-		Note: root node must have ID 1, PARENT null and LINEAGE '' !
-
-        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
-        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
-        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
-        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
-        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
-        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
-        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
-        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
-        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
-        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
-
-        // ==== Sample data dump =======================================================================================
-		+----+-----------+---------+-------+----------+----------------------+
-		| id | parent_id | lineage | level | position | title                |
-		+----+-----------+---------+-------+----------+----------------------+
-		|  1 |      NULL |         |     0 |        1 |                      |
-		|  2 |         1 | //      |     1 |        1 | General Resources    |
-		|  3 |         2 | //2/    |     2 |        1 | Code Paste           |
-		|  4 |         2 | //2/    |     2 |        2 | Documentation        |
-		|  5 |         2 | //2/    |     2 |        3 | Books & Publications |
-		|  6 |         5 | //2/5/  |     3 |        1 | Apache               |
-		|  7 |         5 | //2/5/  |     3 |        2 | PostgreSQL           |
-		|  8 |         5 | //2/5/  |     3 |        3 | MySQL                |
-		|  9 |         2 | //2/    |     2 |        4 | Links                |
-		| 10 |         9 | //2/9/  |     3 |        1 | Databases            |
-		| 11 |         9 | //2/9/  |     3 |        2 | Generators           |
-		| 12 |         9 | //2/9/  |     3 |        3 | Portals              |
-		+----+-----------+---------+-------+----------+----------------------+
-
-        // =============================================================================================================
-
-    */
-
-    // Includes
-    YDInclude( 'YDRequest.php' );
-    YDInclude( 'YDDatabase.php' );
-    YDInclude( 'YDDatabaseTree3.php' );
-
-	YDConfig::set( 'YD_DEBUG', 2 );
-
-    // Class definition
-    class database_tree3 extends YDRequest {
-
-        // Class constructor
-        function database_tree3() {
-
-            // Call the parent
-            $this->YDRequest();
-
-            // Get the database connection
-            $db = YDDatabase::getInstance( 'mysql', 'tree_test', 'root', '', 'localhost' );
-
-            // Get the tree instance
-            $this->tree = new YDDatabaseTree3( 'nested_tree', $db );
-			
-			// register extra column
-			$this->tree->registerField( 'title', true );
-
-        }
-
-        // Default action
-        function actionDefault() {
-
-            // Show the link to the sitemap action
-            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=1">Sitemap</a>' );
-
-            // Get a reference to the tree
-            $tree = & $this->tree;
-
-            // Get a single node
-            YDDebugUtil::dump( $tree->getNode( 2 ), '$tree->getNode( 2 )' );
-
-            // Get the children of a single node
-            YDDebugUtil::dump( $tree->getChildren( 2 ), '$tree->getChildren( 2 )' );
-            YDDebugUtil::dump( $tree->getChildren( 4 ), '$tree->getChildren( 4 )' );
-
-            // Get the descendants of a single node
-            YDDebugUtil::dump( $tree->getDescendants( 4, true ), '$tree->getDescendants( 4, true )' );
-            YDDebugUtil::dump( $tree->getDescendants( 0, true ), '$tree->getDescendants( 0, true )' );
-
-            // Get the path to a node
-            YDDebugUtil::dump( $tree->getPath( 5 ), '$tree->getPath( 5 )' );
-            YDDebugUtil::dump( $tree->getPath( 5, true ), '$tree->getPath( 5, true )' );
-
-            // Check if descendant
-            YDDebugUtil::dump( $tree->isDescendantOf( 9, 1 ), '$tree->isDescendantOf( 9, 1 )' );
-            YDDebugUtil::dump( $tree->isDescendantOf( 9999, 1 ), '$tree->isDescendantOf( 9999, 1 )' );
-            YDDebugUtil::dump( $tree->isDescendantOf( 10, 2 ), '$tree->isDescendantOf( 10, 2 )' );
-
-            // Check if child of
-            YDDebugUtil::dump( $tree->isChildOf( 9, 8 ), '$tree->isChildOf( 9, 8 )' );
-            YDDebugUtil::dump( $tree->isChildOf( 9, 2 ), '$tree->isChildOf( 9, 2 )' );
-
-            // Number of descendants
-            YDDebugUtil::dump( $tree->numDescendants( 9 ), '$tree->numDescendants( 9 )' );
-            YDDebugUtil::dump( $tree->numDescendants( 4 ), '$tree->numDescendants( 4 )' );
-            YDDebugUtil::dump( $tree->numDescendants( 1 ), '$tree->numDescendants( 1 )' );
-
-            // Number of children
-            YDDebugUtil::dump( $tree->numChildren( 9 ), '$tree->numChildren( 9 )' );
-            YDDebugUtil::dump( $tree->numChildren( 4 ), '$tree->numChildren( 4 )' );
-            YDDebugUtil::dump( $tree->numChildren( 1 ), '$tree->numChildren( 1 )' );
-
-            // Get the node's immediate family
-            YDDebugUtil::dump( $tree->getImmediateFamily( 4 ), '$tree->getImmediateFamily( 4 )' );
-
-        }
-		
-        // Add a number of nodes
-        function actionAdd() {
-
-            // Get the node ID
-            $id = ( isset( $_GET['id'] ) && is_numeric( $_GET['id'] ) ) ? $_GET['id'] : 1;
-
-            // Add an item
-            $values = array( 'title' => 'New Node - ' . time() );
-            
-			if ( isset( $_GET['position'] ) ) $this->tree->addNode( $values, $id, $_GET['position'] );
-			else                              $this->tree->addNode( $values, $id );
-
-            $this->actionExample( $id );
-        }
-
-
-        // Move node
-        function actionMove() {
-
-  			YDConfig::set( 'YD_DEBUG', 0 );
-
-            // get parent of this node
-			$node = $this->tree->getNode( $_GET['id'] );
-
-			// the delete debug is what we want
-  			YDConfig::set( 'YD_DEBUG', 2 );
-
-			if ( isset( $_GET['newparent'] ) ) $newparent = $_GET['newparent']; 
-			else                               $newparent = null;
-
-            // Move node
-			$this->tree->moveNode( $_GET['id'], $newparent, $_GET['position'] );
-
-			// show parent tree
-  			YDConfig::set( 'YD_DEBUG', 0 );
-
-            // Redirect to the sitemap
-            $this->actionExample( $node[ 'parent_id' ] );
-        }
-
-
-        // Delete a node and it's subnodes
-        function actionDelete() {
-
-  			YDConfig::set( 'YD_DEBUG', 0 );
-
-            // get parent of this node
-			$node = $this->tree->getNode( $_GET['id'] );
-
-			// the delete debug is what we want
-  			YDConfig::set( 'YD_DEBUG', 2 );
-
-            // Delete a node
-            if ( isset( $_GET['nodeandchildren'] ) ) $this->tree->deleteNode( $_GET['id'], true );
-			else                                     $this->tree->deleteNode( $_GET['id'], false );
-
-			// show parent tree
-  			YDConfig::set( 'YD_DEBUG', 0 );
-
-            // Redirect to the sitemap
-            $this->actionExample( $node[ 'parent_id' ] );
-        }
-
-
-        // Real life example
-        function actionExample( $id = false ) {
-
-  			YDConfig::set( 'YD_DEBUG', 0 );
-  
-            // Get node ID
-			if ( $id == false ) $id = $_GET['id'];
-
-            // compute root link
-            echo( '<p><b>Path:</b> <a href="' . YD_SELF_SCRIPT . '?do=example&id=1">ROOT</a> &raquo; ' );
-
-            foreach ( $this->tree->getPath( $id ) as $path_item ) {
-                echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $path_item['id'] . '">' . $path_item['title'] . '</a> &raquo; ' );
-            }
-
-			// compute node name
-            $node = $this->tree->getNode( $id );
-            echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $node['id'] . '">' . $node['title'] . '</a>' );
-            echo( '</p>' );
-
-            // Show the children in a table
-			echo( '<table><tr><td><b>Children:</b></td><td>actions</td></tr>' );
-			$children = $this->tree->getChildren( $id );
-            foreach ( $children as $child ) {
-				echo( '<tr><td>' );
-
-					// show child action
-                	echo( '<a href="' . YD_SELF_SCRIPT . '?do=example&id=' . $child['id'] . '">' . $child['title'] . '</a>&nbsp;&nbsp;&nbsp;' );
-				echo( '</td><td>' );
-
-					// delete action element and nodes
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&nodeandchildren=1&id='  . $child['id'] . '">Delete ' . $child['title'] . ' and subnodes</a> | ' );
-
-					// delete action nodes only
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=delete&id='  . $child['id'] . '">Delete nodes of ' . $child['title'] . ' </a> | ' );
-
-					// move up
-					if ( $child['position'] != 1 )
-		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] - 1) . '">Move up</a> | ' );
-
-					// move down
-					if ( $child['position'] != count( $children ) )
-		                echo( '<a href="' . YD_SELF_SCRIPT . '?do=move&id='  . $child['id'] . '&position=' . ($child['position'] + 1) . '">Move down</a>' );
-
-				echo( '</td></tr>' );
-            }
-  
-  			// add node action
-			echo( '<tr><td></td><td>' );
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at bottom</a> | ' );
-	                echo( '<a href="' . YD_SELF_SCRIPT . '?do=add&position=1&id='  . $node['id'] . '">Add new node to (' . $node['title'] . ') at top</a>' );
-			echo( '</td></tr>' );
-
-            echo( '</table>' );
-        }
-
-
-    }
-
-    // Process the request
-    YDInclude( 'YDF2_process.php' );
-
-?>



From pclaerhout at mail.berlios.de  Tue Jan 23 09:36:21 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 23 Jan 2007 09:36:21 +0100
Subject: [ydf-devel] r2341 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701230836.l0N8aLLd006596@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 09:36:20 +0100 (Tue, 23 Jan 2007)
New Revision: 2341

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Updated some of the docstrings.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-22 22:32:27 UTC (rev 2340)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-23 08:36:20 UTC (rev 2341)
@@ -72,6 +72,23 @@
      *
      *  All these options are available as class variables.
      *
+     *  @todo
+     *      Refactor this class so that it's easier to be subclasses to provide custom functionality. This way, we can
+     *      abstract the actual paging regardless of how the data is gathered. We only need to have the part of the data
+     *      we really need and the total size of the list of items to do the paging.
+     *
+     *  @todo
+     *      We should try to see if there is a way to make this work together directly with a database instance instead 
+     *      of using arrays. This would be the only way to improve the performance of this class with large arrays.
+     *
+     *  @todo
+     *      Evaluate if we need to change the persistent sorting from a persistent variable to a session variable. This
+     *      way, if the session expires, the default sorting is applied again.
+     *
+     *  @todo
+     *      Should we give or generate a name for the recordset so that different recordsets with the same fields still
+     *      can have different sortfields applied (which is currently not possible)?
+     *
      *  @ingroup YDDatabase
      */
     class YDRecordSet extends YDBase {
@@ -93,7 +110,10 @@
          *  @param  $sortdir    (optional) The name of the query string variable indicating the direction. Defaults to
          *                      "sortdir"
          */
-        function YDRecordSet( $records, $page=-1, $pagesize=null, $pagevar='page', $sizevar='size', $sortvar='sortfld', $sortdir='sortdir' ) {
+        function YDRecordSet(
+            $records, $page=-1, $pagesize=null, $pagevar='page', $sizevar='size',
+            $sortvar='sortfld', $sortdir='sortdir'
+        ) {
 
             // Include the YDPersistent library
             include_once( YD_DIR_HOME_CLS . '/YDPersistent.php');
@@ -617,7 +637,6 @@
 
     }
 
-
     /**
      *  This class defines a database object.
      *
@@ -642,16 +661,16 @@
             // Check if the global array exists
             YDDatabase::_initNamedInstances();
 
-			// Check if we are using a DSN string, e.g. "mysql://user:password at host/database"
-			if ( $db == '' ){
+            // Check if we are using a DSN string, e.g. "mysql://user:password at host/database"
+            if ( $db == '' ){
 
-				$dsn    = new YDUrl( $driver );
-				$driver = $dsn->getScheme();
-				$db     = substr( $dsn->getPath(), 1 );
-				$user   = $dsn->getUser();
-				$pass   = $dsn->getPassword();
-				$host   = $dsn->getHost();
-			}
+                $dsn    = new YDUrl( $driver );
+                $driver = $dsn->getScheme();
+                $db     = substr( $dsn->getPath(), 1 );
+                $user   = $dsn->getUser();
+                $pass   = $dsn->getPassword();
+                $host   = $dsn->getHost();
+            }
 
             // Register the instance
             $GLOBALS['YD_DB_INSTANCES'][ strtolower( $name ) ] = array( $driver, $db, $user, $pass, $host );
@@ -713,6 +732,11 @@
          *
          *  @returns    An instance of YDDatabaseDriver
          *
+         *  @todo
+         *      Doublecheck this piece of code as there seems to be a possible problem that you cannot have more than
+         *      one connection to a database. If you use two different database instances, it seems that they still
+         *      point to the same table, which should not be the case.
+         *
          *  @static
          */
         function getInstance( $driver, $db, $user='', $pass='', $host='' ) {

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-22 22:32:27 UTC (rev 2340)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-23 08:36:20 UTC (rev 2341)
@@ -37,6 +37,20 @@
      *  This class implements a database tree as described on:
      *  http://www.phpriot.com/d/articles/php/application-design/nested-trees-2/
      *
+     *  @todo
+     *      Add support for joins so that you can link in other tables in the tree. Without this functionality, this
+     *      class is rather limited. We might need to give the table with the tree itself a common prefix so that we
+     *      can differentiate between the fields that should be stored in the table and the fields that should not be
+     *      stored in the database (which are the ones from the join tables).
+     *
+     *  @todo
+     *      Check if using YDDatabaseQuery can make the queries easier to understand and change.
+     *
+     *  @todo
+     *      Add support for moving items up and down. The algorithm can be something like:
+     *          - Move up: currentItem+1, nextItem-1
+     *          - Move down: currentItem-1, previousItem+1
+     *
      *  @ingroup YDDatabase
      */
     class YDDatabaseTree extends YDBase {
@@ -51,9 +65,7 @@
          *  @param $sortField      (optional) Name of the field to sort data. Default is position, title.
          */
         function YDDatabaseTree( $db='default', $table, $idField='id', $parentField='parent_id', $sortField='position, title' ) {
-
             $this->db = YDDatabase::getNamedInstance( $db );
-
             $this->table = $table;
             $this->fields = array(
                 'id' => $idField, 'parent' => $parentField, 'sort' => $sortField,
@@ -629,6 +641,11 @@
 
         /**
          *  Rebuilds the tree data and saves it to the database
+         *
+         *  @todo
+         *      Check if there is any way of optimizing this part so that we don't have to issue and update statement
+         *      for each item in the table. If I understand the algorithm correctly, only part of the tree data should
+         *      be updated when we change an item.
          */
         function rebuild() {
 
@@ -642,8 +659,8 @@
             $data_ori = array_merge( $data );
 
             // Keep track of the number and level
-            $n     = 0; // Need a variable to hold the running n tally
-            $level = 0; // Need a variable to hold the running level tally
+            $n     = 0;
+            $level = 0;
 
             // Invoke the recursive function. Start it processing on the fake "root node" generated in 
             // getTreeWithChildren(). because this node doesn't really exist in the database, we give it an initial 
@@ -721,14 +738,6 @@
                 $values[ $parentField ] = 0;
             }
 
-            /*// Check if the parent node exists
-            if ( isset( $values[ $parentField ] ) && intval( $values[ $parentField ] ) != 0 ) {
-                $node = $this->getNode( $values[ $parentField ] );
-                if ( ! $node ) {
-                    trigger_error( 'Parent node (' . $values[ $parentField ] . ') does not exist in the tree!', YD_ERROR );
-                }
-            }*/
-
             // Perform the insert
             $this->db->executeInsert( $this->table, $values );
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-22 22:32:27 UTC (rev 2340)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDPersistent.php	2007-01-23 08:36:20 UTC (rev 2341)
@@ -44,6 +44,11 @@
      *  This class is able to save and load persistent data. This data stay active between different requests and allows
      *  you to share data between different requests and different sessions.
      *
+     *  @todo
+     *      The default scope of the persistent variable should be the current script in stead of the root of the site.
+     *      The problem is that if you use the variable for e.g. storing sorting data, and use different ones over
+     *      different pages, they clash with each other.
+     *
      *  @ingroup YDFramework
      */
     class YDPersistent extends YDBase {

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-22 22:32:27 UTC (rev 2340)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-01-23 08:36:20 UTC (rev 2341)
@@ -267,6 +267,13 @@
          *					the default action.
          *	@param $params	(optional) The $_GET parameters as an associative array that need to be added to the URL
          *					before redirecting. They will automatically get URL encoded.
+         *
+         *  @todo
+         *      Use the YDUrl class to construct the URL as it's easier to work with and will help with the todo item
+         *      that should strip the default action from the URL.
+         *
+         *  @todo
+         *      If the only query string parameter is the do parameter with the value default, we should omit it.
          */
         function redirectToAction( $action='default', $params=array() ) {
             if ( is_null( $action ) ) {
@@ -303,11 +310,7 @@
          *	@returns	Returns a boolean indicating if the request was initialized properly or not.
          */
         function isInitialized() {
-            if ( $this->__isInitialized == true ) {
-                return true;
-            } else {
-                return false;
-            };
+            return ( $this->__isInitialized == true );
         }
 
         /**
@@ -391,11 +394,7 @@
          *	@param $bool	Boolean indicating if this request requires authentication or not.
          */
         function setRequiresAuthentication( $bool ) {
-            if ( $bool == true ) {
-                $this->__requiresAuthentication = true;
-            } else {
-                $this->__requiresAuthentication = false;
-            }
+            $this->__requiresAuthentication = ( $bool == true ) ? true : false;
         }
 
         /**
@@ -404,11 +403,7 @@
          *	@returns	This function returns true or false to indicate if this requires authentication or not.
          */
         function getRequiresAuthentication() {
-            if ( $this->__requiresAuthentication == false ) {
-                return false;
-            } else {
-                return true;
-            }
+            return ( $this->__requiresAuthentication == false ) ? false : true;
         }
 
         /**
@@ -466,28 +461,37 @@
          *
          *  By default no YDRequest action callbacks are defined.
          *
-         *  Callbacks are disabled when an action forwards to another
-         *  action. This is to prevent duplicated processing of callbacks.
-         *  "redirectToAction" is a more compatible with callbacks.
+         *  Callbacks are disabled when an action forwards to another action. This is to prevent duplicated processing 
+         *  of callbacks. "redirectToAction" is a more compatible with callbacks.
          *
-         *  Processing of callbacks and actions in the context of a request
-         *  is executed in this order:
+         *  Processing of callbacks and actions in the context of a request is executed in this order:
          *
-         *    1. (optional) before 'action' callbacks - apply to all actions
-         *    2. (optional) before callback for the current action
-         *	  3. Current action
-         *    4. (optional) after callback for the current action
-         *    5. (optional) after 'action' callbacks - apply to all actions
+         *      -# (optional) before 'action' callbacks - apply to all actions
+         *      -# (optional) before callback for the current action
+         *      -# Current action
+         *      -# (optional) after callback for the current action
+         *      -# (optional) after 'action' callbacks - apply to all actions
          *
-         *	example 1: will execute my_before_callback() before each action
-         *		$this->registerCallback( 'my_before_callback', 'action', true );
+         *  Some usage examples:
          *
-         *	example 2: will execute my_after_callback() after each action
-         *		$this->registerCallback( 'my_after_callback', 'action', false );
+         *      - example 1:\n
+         *          will execute my_before_callback() before each action
+         *          @code
+         *  $this->registerCallback( 'my_before_callback', 'action', true );
+         *          @endcode
          *
-         *	example 3: will execute my_deafult_after_callback() after actionDefault
-         *		$this->registerCallback( 'my_deafult_after_callback', 'actionDefault', false );
+         *      - example 2:\n
+         *          will execute my_after_callback() after each action
+         *          @code
+         *  $this->registerCallback( 'my_after_callback', 'action', false );
+         *          @endcode
          *
+         *      - example 3:\n
+         *          will execute my_deafult_after_callback() after actionDefault
+         *          @code
+         *  $this->registerCallback( 'my_deafult_after_callback', 'actionDefault', false );
+         *          @endcode
+         *
          *  @param $method  The method name.
          *  @param $action  The action or array of actions that trigger the call.
          *  @param $before  (optional) Execute callback before the action. Default: false.



From pclaerhout at mail.berlios.de  Tue Jan 23 12:02:12 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 23 Jan 2007 12:02:12 +0100
Subject: [ydf-devel] r2342 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDSimpleCMS examples/simplecms
Message-ID: <200701231102.l0NB2C6x019545@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 12:02:11 +0100 (Tue, 23 Jan 2007)
New Revision: 2342

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/examples/simplecms/admin.php
   YDFramework2.0/trunk/examples/simplecms/index.php
Log:
Introduced the following new constants:
- YD_SIMPLECMS_SCOPE_PUBLIC
- YD_SIMPLECMS_SCOPE_ADMIN

Did some refactoring as well to use these constants on the code.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 08:36:20 UTC (rev 2341)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 11:02:11 UTC (rev 2342)
@@ -51,10 +51,7 @@
      *      the template)
      *
      *  @todo
-     *      Make the run method a static method of the request class
-     *
-     *  @todo
-     *      make login module based?
+     *      Make login module based?
      */
 
     // Check if the framework is loaded
@@ -69,6 +66,8 @@
     define( 'YD_SIMPLECMS_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
     define( 'YD_SIMPLECMS_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
     define( 'YD_SIMPLECMS_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
+    define( 'YD_SIMPLECMS_SCOPE_PUBLIC',   'public' );
+    define( 'YD_SIMPLECMS_SCOPE_ADMIN',    'admin' );
 
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
@@ -77,13 +76,13 @@
     $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] = array();
 
     // Includes
-    YDInclude( 'YDForm.php' );
-    YDInclude( 'YDRequest.php' );
-    YDInclude( 'YDDatabase.php' );
-    YDInclude( 'YDTemplate.php' );
-    YDInclude( 'YDFileSystem.php' );
-    YDInclude( 'YDF2_process.php' );
-    YDInclude( 'YDSimpleCMS_CoreModules.php' );
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php' );
+    include_once( YD_DIR_HOME_CLS . '/YDRequest.php' );
+    include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
+    include_once( YD_DIR_HOME_CLS . '/YDTemplate.php' );
+    include_once( YD_DIR_HOME_CLS . '/YDFileSystem.php' );
+    include_once( YD_DIR_HOME . '/YDF2_process.php' );
+    include_once( dirname( __FILE__ ) . '/YDSimpleCMS_CoreModules.php' );
 
     /**
      *  This is the global YDSimpleCMS class that houses all cms related functions.
@@ -95,22 +94,39 @@
         /**
          *  This is a static function that will run a request.
          *
-         *  @param  $scope  The scope in which the request needs to run. You can choose between public and admin. If you
-         *                  choose admin, authentication will be enforced, with public, it's not.
+         *  @param  $scope  The scope in which the request needs to run. You can choose between 
+         *                  YD_SIMPLECMS_SCOPE_PUBLIC and YD_SIMPLECMS_SCOPE_ADMIN. If you choose
+         *                  YD_SIMPLECMS_SCOPE_ADMIN, authentication will be enforced, with YD_SIMPLECMS_SCOPE_PUBLIC,
+         *                  it's not.
          *
          *  @static
-         *
-         *  @todo
-         *      Replace scope with a defined constant (YD_SIMPLECMS_SCOPE_PUBLIC and YD_SIMPLECMS_SCOPE_ADMIN)
          */
         function run( $scope ) {
-            $baseClass = ( strtolower( $scope ) == 'public' ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
+            $baseClass = ( strtolower( $scope ) == YD_SIMPLECMS_SCOPE_PUBLIC ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
             $clsInst = new YDExecutor( $baseClass . '.php' );
             @session_start();
             $clsInst->execute();
         }
 
         /**
+         *  This is a static function that will run a public request.
+         *
+         *  @static
+         */
+        function runPublicRequest() {
+            YDSimpleCMS::run( YD_SIMPLECMS_SCOPE_PUBLIC );
+        }
+
+        /**
+         *  This is a static function that will run an admin request.
+         *
+         *  @static
+         */
+        function runAdminRequest() {
+            YDSimpleCMS::run( YD_SIMPLECMS_SCOPE_ADMIN );
+        }
+
+        /**
          *  This function will show an error for the CMS application.
          *
          *  The parameters that are supported are the same ones as the sprintf and printf functions.
@@ -209,14 +225,15 @@
         /**
          *  The scope which is going to be used for the template.
          *
-         *  Can be either public or admin.
+         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
          */
         var $scope;
 
         /**
          *  The class constructor the the YDSimpleCMSTemplate class.
          *
-         *  @param  $scope  The scope which is going to be used for the template. Can be either public or admin.
+         *  @param  $scope  The scope which is going to be used for the template. Can be either
+         *                  YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
          */
         function YDSimpleCMSTemplate( $scope ) {
 
@@ -244,7 +261,7 @@
 
             // Set the variables
             $this->template_dir = YD_SIMPLECMS_SKINS_DIR . $this->scope;
-            if ( $this->scope == 'public' ) {
+            if ( $this->scope == YD_SIMPLECMS_SCOPE_PUBLIC ) {
                 $this->template_dir .= '/' . YDConfig::get( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
             }
 
@@ -290,9 +307,9 @@
         /**
          *  The scope which is going to be used for the template.
          *
-         *  Can be either public or admin.
+         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
          */
-        var $requestScope  = 'public';
+        var $requestScope  = YD_SIMPLECMS_SCOPE_PUBLIC;
 
         /**
          *  The default module for the request class.
@@ -344,9 +361,9 @@
         /**
          *  The scope which is going to be used for the template.
          *
-         *  Can be either public or admin.
+         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
          */
-        var $requestScope  = 'admin';
+        var $requestScope  = YD_SIMPLECMS_SCOPE_ADMIN;
 
         /**
          *  The default module for the request class.
@@ -369,7 +386,7 @@
             $this->setRequiresAuthentication( true );
 
             // Instantiate the template object
-            $this->tpl = new YDSimpleCMSTemplate( 'admin' );
+            $this->tpl = new YDSimpleCMSTemplate( YD_SIMPLECMS_SCOPE_ADMIN );
 
             // Get the site id
             $this->siteId = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
@@ -546,7 +563,7 @@
         /**
          *  The current scope of the CMS module.
          *
-         *  Currently, the value can only be public or admin.
+         *  Currently, the value can only be YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
          */
         var $currentScope  = null;
 
@@ -562,7 +579,7 @@
          */
         function YDSimpleCMSModule( $manager ) {
             $this->manager = & $manager;
-            $this->tpl = new YDSimpleCMSTemplate( 'public' );
+            $this->tpl = new YDSimpleCMSTemplate( YD_SIMPLECMS_SCOPE_PUBLIC );
         }
 
         /**
@@ -606,7 +623,7 @@
          *  This function will output the template associated with this module. It will also assign the following
          *  standard variables to the template instance:
          *      - currentAction: the name of the current action
-         *      - currentScope: the current scope of the module ('public' or 'admin')
+         *      - currentScope: the current scope of the module (YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN)
          *      - adminMenu: an array containing all the menus and menu items for the admin section.
          *      - currentUser: the full user details for the user which is currently logged in. If no user is logged in,
          *                     this variable will contain a null value.
@@ -629,7 +646,8 @@
          *
          *  This function gets triggered by the module manager when this one wants to trigger an action.
          *
-         *  @param  $scope  The scope in which to run the action.
+         *  @param  $scope  The scope in which to run the action. Can be YD_SIMPLECMS_SCOPE_PUBLIC or
+         *                  YD_SIMPLECMS_SCOPE_ADMIN
          *  @param  $action The action to run.
          */
         function runAction( $scope, $action ) {
@@ -673,7 +691,8 @@
          *      This function should only be called after the loadAllModules function has been executed. If not, this
          *      function will fail as the include files are not loaded yet.
          *
-         *  @param  $scope  The scope in which to run the module and action. Can be 'public' or 'admin'.
+         *  @param  $scope  The scope in which to run the module and action. Can be YD_SIMPLECMS_SCOPE_PUBLIC or
+         *                  YD_SIMPLECMS_SCOPE_ADMIN.
          *  @param  $module The name of the module to run.
          *  @param  $action The name of the action to run.
          */
@@ -699,7 +718,7 @@
             $moduleInstance->tpl->scope = $scope;
 
             // Sort the admin menu items
-            if ( $scope == 'admin' ) {
+            if ( $scope == YD_SIMPLECMS_SCOPE_ADMIN ) {
                 ksort( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
                 foreach ( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] as $key=>$val ) {
                     if ( isset( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'][$key]['children'] ) ) {

Modified: YDFramework2.0/trunk/examples/simplecms/admin.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-23 08:36:20 UTC (rev 2341)
+++ YDFramework2.0/trunk/examples/simplecms/admin.php	2007-01-23 11:02:11 UTC (rev 2342)
@@ -4,6 +4,6 @@
     include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
 
     // Run the CMS request
-    YDSimpleCMS::run( 'admin' );
+    YDSimpleCMS::runAdminRequest();
 
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/examples/simplecms/index.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-23 08:36:20 UTC (rev 2341)
+++ YDFramework2.0/trunk/examples/simplecms/index.php	2007-01-23 11:02:11 UTC (rev 2342)
@@ -4,6 +4,6 @@
     include_once( dirname( __FILE__ ) . '/includes/YDSimpleCMSApp.php' );
 
     // Run the CMS request
-    YDSimpleCMS::run( 'public' );
+    YDSimpleCMS::runPublicRequest();
 
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Tue Jan 23 15:49:13 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 23 Jan 2007 15:49:13 +0100
Subject: [ydf-devel] r2343 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701231449.l0NEnDU7014698@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 15:49:12 +0100 (Tue, 23 Jan 2007)
New Revision: 2343

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
Updated the docstrings of YDDatabaseTree.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-23 11:02:11 UTC (rev 2342)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-23 14:49:12 UTC (rev 2343)
@@ -37,6 +37,61 @@
      *  This class implements a database tree as described on:
      *  http://www.phpriot.com/d/articles/php/application-design/nested-trees-2/
      *
+     *  Schema description
+     *
+     *  @code
+     *  CREATE TABLE nested_tree (
+     *      id int(11) NOT NULL auto_increment,
+     *      parent_id int(11) NOT NULL default '0',
+     *      title varchar(255) NOT NULL default '',
+     *      nleft int(11) NOT NULL default '0',
+     *      nright int(11) NOT NULL default '0',
+     *      nlevel int(11) NOT NULL default '0',
+     *      position int(11) NOT NULL default '0',
+     *      PRIMARY KEY  (id),
+     *      KEY nested_tree_parent_id (parent_id),
+     *      KEY nested_tree_nleft (nleft),
+     *      KEY nested_tree_nright (nright),
+     *      KEY nested_tree_nlevel (nlevel)
+     *  );
+     *  @endcode
+     *
+     *  Default values for testing
+     *
+     *  @code
+     *  INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0);
+     *  INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0);
+     *  INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0);
+     *  INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0);
+     *  INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0);
+     *  INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0);
+     *  INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0);
+     *  INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0);
+     *  INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0);
+     *  INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0);
+     *  INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0);
+     *  @endcode
+     *
+     *  Sample data dump
+     *
+     *  @code
+     *  +----+-----------+----------------------+-------+--------+--------+----------+
+     *  | id | parent_id | title                | nleft | nright | nlevel | position |
+     *  +----+-----------+----------------------+-------+--------+--------+----------+
+     *  |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |
+     *  |  2 |         1 | Code Paste           |     2 |      3 |      2 |        0 |
+     *  |  3 |         1 | Documentation        |     4 |      5 |      2 |        0 |
+     *  |  4 |         1 | Books & Publications |     6 |     13 |      2 |        0 |
+     *  |  5 |         4 | Apache               |     7 |      8 |      3 |        0 |
+     *  |  6 |         4 | PostgreSQL           |     9 |     10 |      3 |        0 |
+     *  |  7 |         4 | MySQL                |    11 |     12 |      3 |        0 |
+     *  |  8 |         1 | Links                |    14 |     21 |      2 |        0 |
+     *  |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |
+     *  | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |
+     *  | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |
+     *  +----+-----------+----------------------+-------+--------+--------+----------+
+     *  @endcode
+     *
      *  @todo
      *      Add support for joins so that you can link in other tables in the tree. Without this functionality, this
      *      class is rather limited. We might need to give the table with the tree itself a common prefix so that we



From pclaerhout at mail.berlios.de  Tue Jan 23 15:49:37 2007
From: pclaerhout at mail.berlios.de (pclaerhout at BerliOS)
Date: Tue, 23 Jan 2007 15:49:37 +0100
Subject: [ydf-devel] r2344 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree
Message-ID: <200701231449.l0NEnbE8014758@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 15:49:37 +0100 (Tue, 23 Jan 2007)
New Revision: 2344

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
Log:
Updated the docstrings of YDDatabaseObjectTree.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-01-23 14:49:12 UTC (rev 2343)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-01-23 14:49:37 UTC (rev 2344)
@@ -22,7 +22,7 @@
     */
 
     /**
-     *  @addtogroup YDDatabase Core - Database
+     *  @addtogroup YDDatabaseObjectTree Addons - DatabaseObjectTree
      */
 
     // Check if the framework is loaded
@@ -33,43 +33,45 @@
 	// add YDF libs needed by this class
 	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
 
-
-    /** Database scheme example
-        
-        CREATE TABLE nested_tree (
-            id int NOT NULL auto_increment,
-            parent_id int NULL,
-            lineage varchar(255) NOT NULL default '//',
-            level int NOT NULL default '1',
-            position int NOT NULL default '1',
-            title varchar(255) NOT NULL default '',
-            PRIMARY KEY (id),
-            FOREIGN KEY (parent_id)
-                REFERENCES nested_tree(id)
-                     ON DELETE CASCADE
-                     ON UPDATE CASCADE
-        )TYPE=InnoDB;
-    
-        Note: root node must have ID 1, PARENT null and LINEAGE '' !
-       
-        INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
-        INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
-        INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
-        INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
-        INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
-        INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
-        INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
-        INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
-        INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
-        INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
-        INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
-        INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
-     */
-
     /**
-     *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject
+     *	This is the actual implementation of the lineage tree algorithm but as an YDDatabaseObject.
      *
-     *  @ingroup YDDatabase
+     *  The DatabaseObjectTree needs to have the following database schema.
+     *  
+     *  @code
+     *	CREATE TABLE nested_tree (
+     *	    id int NOT NULL auto_increment,
+     *	    parent_id int NULL,
+     *	    lineage varchar(255) NOT NULL default '//',
+     *	    level int NOT NULL default '1',
+     *	    position int NOT NULL default '1',
+     *	    title varchar(255) NOT NULL default '',
+     *	    PRIMARY KEY (id),
+     *	    FOREIGN KEY (parent_id)
+     *	        REFERENCES nested_tree(id)
+     *	             ON DELETE CASCADE
+     *	             ON UPDATE CASCADE
+     *	)TYPE=InnoDB;
+     *  @endcode
+     *
+     *  Note: root node must have ID 1, PARENT null and LINEAGE '' !
+     * 
+     *  @code
+     *  INSERT INTO nested_tree VALUES ( 1, null, '',         0, 1, '');
+     *  INSERT INTO nested_tree VALUES ( 2,    1, '//',       1, 1, 'General Resources');
+     *  INSERT INTO nested_tree VALUES ( 3,    2, '//2/',     2, 1, 'Code Paste');
+     *  INSERT INTO nested_tree VALUES ( 4,    2, '//2/',     2, 2, 'Documentation');
+     *  INSERT INTO nested_tree VALUES ( 5,    2, '//2/',     2, 3, 'Books & Publications');
+     *  INSERT INTO nested_tree VALUES ( 6,    5, '//2/5/',   3, 1, 'Apache');
+     *  INSERT INTO nested_tree VALUES ( 7,    5, '//2/5/',   3, 2, 'PostgreSQL');
+     *  INSERT INTO nested_tree VALUES ( 8,    5, '//2/5/',   3, 3, 'MySQL');
+     *  INSERT INTO nested_tree VALUES ( 9,    2, '//2/',     2, 4, 'Links');
+     *  INSERT INTO nested_tree VALUES (10,    9, '//2/9/',   3, 1, 'Databases');
+     *  INSERT INTO nested_tree VALUES (11,    9, '//2/9/',   3, 2, 'Generators');
+     *  INSERT INTO nested_tree VALUES (12,    9, '//2/9/',   3, 3, 'Portals');
+     *  @endcode
+     *
+     *  @ingroup YDDatabaseObjectTree
      */
     class YDDatabaseObjectTree extends YDDatabaseObject {
     



From pclaerhout at mail.berlios.de  Tue Jan 23 16:27:58 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 16:27:58 +0100
Subject: [ydf-devel] r2345 - YDFramework2.0/trunk/examples/weblog/include
Message-ID: <200701231527.l0NFRwsR018356@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 16:27:33 +0100 (Tue, 23 Jan 2007)
New Revision: 2345

Modified:
   YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
Log:
Made the weblog application install properly again. It was trying to delete from the bad_behaviour table before it was created.

PS: sometimes, creating a new working copy to test with can do miracles ;-)

Modified: YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-23 14:49:37 UTC (rev 2344)
+++ YDFramework2.0/trunk/examples/weblog/include/YDWeblogAPI.php	2007-01-23 15:27:33 UTC (rev 2345)
@@ -206,7 +206,7 @@
         function upgradeSchemaIfNeeded() {
 
             // The current weblog schema version
-            $current_schema = 8;
+            $current_schema = 9;
 
             // Get the schema version
             $installed_schema = $this->getSchemaVersion();
@@ -286,6 +286,27 @@
                     );
                 }
 
+                // Create the bad_behavior table
+                if ( ! $this->dbmeta->tableExists( '#_bad_behavior' ) ) {
+                    $this->db->executeSql(
+                          'CREATE TABLE #_bad_behavior ('
+                        . '  id INT(11) NOT NULL auto_increment,'
+                        . '  ip TEXT NOT NULL,'
+                        . '  date DATETIME NOT NULL default \'0000-00-00 00:00:00\','
+                        . '  request_method TEXT NOT NULL,'
+                        . '  request_uri TEXT NOT NULL,'
+                        . '  server_protocol TEXT NOT NULL,'
+                        . '  http_headers TEXT NOT NULL,'
+                        . '  user_agent TEXT NOT NULL,'
+                        . '  request_entity TEXT NULL,'
+                        . '  `key` TEXT NOT NULL,'
+                        . '  INDEX (ip(15)),'
+                        . '  INDEX (user_agent(10)),'
+                        . '  PRIMARY KEY (id)'
+                        . ')'
+                    );
+                }
+
                 // Update the schema information
                 $this->setSchemaVersion( $current_schema );
 



From pclaerhout at mail.berlios.de  Tue Jan 23 16:41:15 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 16:41:15 +0100
Subject: [ydf-devel] r2346 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701231541.l0NFfFf5019432@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 16:41:13 +0100 (Tue, 23 Jan 2007)
New Revision: 2346

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Did some initial refactoring:
- Added the YD_SIMPLECMS_PACKAGE_NAME constant
- Added YDSimpleCMS::initialize()


Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 15:27:33 UTC (rev 2345)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 15:41:13 UTC (rev 2346)
@@ -60,21 +60,19 @@
     }
 
     // Constants
-    define( 'YD_SIMPLECMS_ACTION_PREFIX',  'action_' );
-    define( 'YD_SIMPLECMS_MODULE_PREFIX',  'module_' );
-    define( 'YD_SIMPLECMS_MODULE_EXT',     '.php' );
-    define( 'YD_SIMPLECMS_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
-    define( 'YD_SIMPLECMS_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
-    define( 'YD_SIMPLECMS_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
-    define( 'YD_SIMPLECMS_SCOPE_PUBLIC',   'public' );
-    define( 'YD_SIMPLECMS_SCOPE_ADMIN',    'admin' );
+    define( 'YD_SIMPLECMS_PACKAGE_NAME',   'YD_SIMPLECMS' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_ACTION_PREFIX',  'action_' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_PREFIX',  'module_' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_EXT',     '.php' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_PUBLIC',   'public' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_ADMIN',    'admin' );
 
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
 
-    // The global list with admin menu
-    $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] = array();
-
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDForm.php' );
     include_once( YD_DIR_HOME_CLS . '/YDRequest.php' );
@@ -87,11 +85,70 @@
     /**
      *  This is the global YDSimpleCMS class that houses all cms related functions.
      *
+     *  @todo
+     *      Add the following functions:
+     *          - initialize(): checks against $GLOBALS['YD_SIMPLECMS'] to see if we are initialized. If not, we need
+     *             tostill initialize the cms package. Initializing means:
+     *              - Setup the database connection under $GLOBALS['YD_SIMPLECMS']['db']
+     *              - Negotiate the languages for public and admin under $GLOBALS['YD_SIMPLECMS']['languages']
+     *              - Initializes the module manager under $GLOBALS['YD_SIMPLECMS']['moduleManager']
+     *          - getLanguages(): returns $GLOBALS['YD_SIMPLECMS']['languages'], but issues initialize first if not done
+     *            yet (to make sure we are initialized properly).
+     *          - getDatabase(): returns $GLOBALS['YD_SIMPLECMS']['db'], but issues initialize first if not done yet (to
+     *            make sure we are initialized properly).
+     *          - getModuleManager(): returns $GLOBALS['YD_SIMPLECMS']['moduleManager'], but issues initialize first if
+     *            not done yet (to make sure we are initialized properly).
+     *          - isInitialized(): returns a boolean indicating if the CMS package was initialized or not.
+     *          - initializeIfNeeded(): shortcut for checking isInitialized and then doing initialize if needed.
+     *      \n
+     *      We could do all this in the request class, but that would mean the modules will not have access to it. This
+     *      way, we kind of make a pseudo singleton class that can be accessed from anywhere in the code.
+     *
      *  @ingroup YDSimpleCMS
      */
     class YDSimpleCMS {
 
         /**
+         *  This function initializes the SimpleCMS package. It performs the following items:
+         *      - Create a new global array under $GLOBALS['YD_SIMPLECMS']
+         *      - Adds a database connection under $GLOBALS['YD_SIMPLECMS']['db']
+         *      - Adds a language array under $GLOBALS['YD_SIMPLECMS']['languages']
+         *      - Adds a module manager instance under $GLOBALS['YD_SIMPLECMS']['moduleManager']
+         *      - Adds a array under $GLOBALS['YD_SIMPLECMS']['adminMenu'] to keep track of the admin menu
+         *      - Adds a null value under $GLOBALS['YD_SIMPLECMS']['user'] to keep track of the current user
+         *
+         *  Even if you call this function multiple times, the initialization will only be done once.
+         *
+         *  @todo
+         *      Negotiate the language and put it as an array under $GLOBALS['YD_SIMPLECMS']['languages']
+         */
+        function initialize() {
+
+            // Check if the initialization is already done or not
+            if ( ! isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME] ) || ! is_array( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME] ) ) {
+
+                // Create the array
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME] = array();
+
+                // Setup the database connection
+                YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['db'] = YDDatabase::getInstance(
+                    'mysql',
+                    YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
+                    YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
+                );
+
+                // The global list with admin menu
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] = array();
+
+                // The current user
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] = null;
+
+            }
+
+        }
+
+        /**
          *  This is a static function that will run a request.
          *
          *  @param  $scope  The scope in which the request needs to run. You can choose between 
@@ -156,7 +213,7 @@
         function addAdminMenu( $title, $subtitle, $module, $action ) {
 
             // Link to the menu items
-            $menu = & $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'];
+            $menu = & $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'];
 
             // Construct the URL
             $url = YD_SELF_SCRIPT . '?module=' . $module . '&action=' . $action;
@@ -189,18 +246,7 @@
          *  @static
          */
         function getDbConnection() {
-
-            // Register the database instance and prefix
-            YDDatabase::registerInstance(
-                'default', 'mysql',
-                YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
-                YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
-            );
-            YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
-        
-            // The database connection
-            return YDDatabase::getNamedInstance();
-
+            return $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['db'];
         }
 
     }
@@ -382,6 +428,9 @@
             // Initialize the parent
             $this->YDSimpleCMSPublicRequest();
 
+            // Make sure the CMS package is initialized
+            YDSimpleCMS::initialize();
+
             // Indicate we require login
             $this->setRequiresAuthentication( true );
 
@@ -511,7 +560,7 @@
             if ( $result === false ) {
                 return array( '__ALL__' => t( 'err_login_all' ) );
             } else {
-                $GLOBALS['user'] = $result;
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] = $result;
                 return true;
             }
         }
@@ -631,9 +680,9 @@
         function display( $name='' ) {
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
-            $this->tpl->assign( 'adminMenu',     $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
-            if ( isset( $GLOBALS['user'] ) ) {
-                $this->tpl->assign( 'currentUser', $GLOBALS['user'] );
+            $this->tpl->assign( 'adminMenu',     $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
+            if ( isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] ) ) {
+                $this->tpl->assign( 'currentUser', $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] );
             }
             if ( $name == '' ) {
                 $name = $this->getModuleName();
@@ -719,13 +768,13 @@
 
             // Sort the admin menu items
             if ( $scope == YD_SIMPLECMS_SCOPE_ADMIN ) {
-                ksort( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
-                foreach ( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] as $key=>$val ) {
-                    if ( isset( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'][$key]['children'] ) ) {
-                        ksort( $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'][$key]['children'] );
+                ksort( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
+                foreach ( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] as $key=>$val ) {
+                    if ( isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'][$key]['children'] ) ) {
+                        ksort( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'][$key]['children'] );
                     }
                 }
-                $moduleInstance->tpl->assign( 'adminMenu', $GLOBALS['YD_SIMPLECMS_ADMIN_MENU'] );
+                $moduleInstance->tpl->assign( 'adminMenu', $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
             }
 
             // Create a link to ourselves
@@ -753,7 +802,10 @@
 
     }
 
-    // Add menu items
+    // Initialize SimpleCMS
+    YDSimpleCMS::initialize();
+
+    // Add the default admin menu items
     YDSimpleCMS::addAdminMenu( 'Admin',   null,       'admin', 'show' );
     YDSimpleCMS::addAdminMenu( 'Admin',   'Logout',   'admin', 'logout' );
     YDSimpleCMS::addAdminMenu( 'Content', 'Pages',    'page',  'show' );



From ximian at mail.berlios.de  Tue Jan 23 17:38:31 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 23 Jan 2007 17:38:31 +0100
Subject: [ydf-devel] r2347 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701231638.l0NGcVcc023719@sheep.berlios.de>

Author: ximian
Date: 2007-01-23 17:38:20 +0100 (Tue, 23 Jan 2007)
New Revision: 2347

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
Log:
- added YDUrl::setQueryVars that cycle and array to set all vars

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-23 15:41:13 UTC (rev 2346)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDUrl.php	2007-01-23 16:38:20 UTC (rev 2347)
@@ -403,6 +403,18 @@
         }
 
         /**
+         *	This function will set an array of variables
+         *
+         *	@param	$arr	Associative array.
+         */
+        function setQueryVars( $arr ) {
+            foreach( $arr as $name => $val ){
+                $this->setQueryVar( $name, $val );
+            }
+        }
+
+
+        /**
          *	This function will delete the indicated query variable if it exists.
          *
          *	@param	$name	The name of the query variable to delete.



From ximian at mail.berlios.de  Tue Jan 23 17:41:49 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 23 Jan 2007 17:41:49 +0100
Subject: [ydf-devel] r2348 -
	YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext
Message-ID: <200701231641.l0NGfnbT023918@sheep.berlios.de>

Author: ximian
Date: 2007-01-23 17:41:38 +0100 (Tue, 23 Jan 2007)
New Revision: 2348

Modified:
   YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php
Log:
- FIXED: gettext compatibility shouldn't warn when translation don't exist.. just return the value as it's.

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php	2007-01-23 16:38:20 UTC (rev 2347)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/ext/gettext.php	2007-01-23 16:41:38 UTC (rev 2348)
@@ -43,7 +43,7 @@
       }
 
       #-- look up string
-      if (($trans = $_GETTEXT[$domain][$msg])
+      if (($trans = @$_GETTEXT[$domain][$msg])
       or ($pli) and ($trans = $_GETTEXT[$domain][$msg2]))
       {
          // handle plural entries



From ximian at mail.berlios.de  Tue Jan 23 17:42:58 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 23 Jan 2007 17:42:58 +0100
Subject: [ydf-devel] r2349 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200701231642.l0NGgwkE024024@sheep.berlios.de>

Author: ximian
Date: 2007-01-23 17:42:43 +0100 (Tue, 23 Jan 2007)
New Revision: 2349

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
- small speedup on YDDatabaseObject

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-23 16:41:38 UTC (rev 2348)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-01-23 16:42:43 UTC (rev 2349)
@@ -1082,7 +1082,7 @@
 
 			// convert dates
 			foreach( $values as $element => $value )
-				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $form->getValue( $element ), $onDate );
+				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
 
 			// apply values
             $this->setValues( $values );



From pclaerhout at mail.berlios.de  Tue Jan 23 20:08:07 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 20:08:07 +0100
Subject: [ydf-devel] r2350 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701231908.l0NJ876b014841@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 20:08:02 +0100 (Tue, 23 Jan 2007)
New Revision: 2350

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Added the following method to YDSimpleCMS:
- getDb
- getAdminMenu
- getModuleManager
- getVar

The YDSimpleCMSModule constructor now no longer needs any parameters.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 16:42:43 UTC (rev 2349)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 19:08:02 UTC (rev 2350)
@@ -21,24 +21,9 @@
 
     */
 
-    /*! @page page_YDSimpleCMS Addons - Simple CMS
-
-      The Simple CMS addon can be used to build a basic content management system.
-
-      @section page_YDSimpleCMS_01 A generic overview
-
-      Not written yet...
-
-      @section page_YDSimpleCMS_02 The module approach
-
-      Not written yet...
-    */
-
     /**
      *  @addtogroup YDSimpleCMS Addons - Simple CMS
      *
-     *  @ref page_YDSimpleCMS More information about the Simple CMS addon.
-     *
      *  @todo
      *      Consolidate the two request classes into one. Based on the scope, it should know if you need to force
      *      authentication or not.
@@ -144,6 +129,10 @@
                 // The current user
                 $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] = null;
 
+                // The module manager instance
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager'] = new YDSimpleCMSModuleManager();
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager']->loadAllModules();
+
             }
 
         }
@@ -213,7 +202,7 @@
         function addAdminMenu( $title, $subtitle, $module, $action ) {
 
             // Link to the menu items
-            $menu = & $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'];
+            $menu = & YDSimpleCMS::getAdminMenu();
 
             // Construct the URL
             $url = YD_SELF_SCRIPT . '?module=' . $module . '&action=' . $action;
@@ -245,10 +234,54 @@
          *
          *  @static
          */
-        function getDbConnection() {
-            return $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['db'];
+        function & getDb() {
+            return YDSimpleCMS::getVar( 'db' );
         }
 
+        /**
+         *  This function returns the array with the menu items for the admin menu.
+         *
+         *  @returns    The array with the admin menu.
+         *
+         *  @static
+         */
+        function & getAdminMenu() {
+            return YDSimpleCMS::getVar( 'adminMenu' );
+        }
+
+        /**
+         *  This function returns an instance of the module manager class.
+         *
+         *  @returns    An instance of the module manager class..
+         *
+         *  @static
+         */
+        function & getModuleManager() {
+            return YDSimpleCMS::getVar( 'moduleManager' );
+        }
+
+        /**
+         *  This function returns one of the named variables from the global CMS scope.
+         *
+         *  @param  $var    The name of the variable you want to retrieve.
+         *
+         *  @returns    The contents of that variable, false if the variable doesn't exist.
+         */
+        function & getVar( $var ) {
+
+            // Initialize the SimpleCMS package
+            YDSimpleCMS::initialize();
+
+            // Return the variable if it's set, otherwise return false
+            if ( ! isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var] ) ) {
+                return false;
+            }
+
+            // Return a reference to the variable
+            return $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var];
+
+        }
+
     }
 
     /**
@@ -377,10 +410,9 @@
          *      string of the request.
          */
         function actionDefault() {
-            $moduleManager = new YDSimpleCMSModuleManager();
-            $moduleManager->loadAllModules();
             $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
             $action = $this->getQueryStringParameter( 'action', 'show' );
+            $moduleManager = & YDSimpleCMS::getModuleManager();
             $moduleManager->runModule( $this->requestScope, $module, $action );
         }
 
@@ -428,9 +460,6 @@
             // Initialize the parent
             $this->YDSimpleCMSPublicRequest();
 
-            // Make sure the CMS package is initialized
-            YDSimpleCMS::initialize();
-
             // Indicate we require login
             $this->setRequiresAuthentication( true );
 
@@ -553,7 +582,7 @@
             if ( $md5 === false ) {
                 $fields['loginPass'] = md5( $fields['loginPass'] );
             }
-            $db = YDSimpleCMS::getDbConnection();
+            $db = YDSimpleCMS::getDb();
             $result = $db->getRecord(
                 'SELECT * FROM #_users WHERE name = \'' . $db->escape( $fields['loginName'] ) . '\' AND password = \'' . $db->escape( $fields['loginPass'] ) . '\''
             );
@@ -626,8 +655,8 @@
          *
          *  @param  $manager    A reference to the module manager instance that loaded this module.
          */
-        function YDSimpleCMSModule( $manager ) {
-            $this->manager = & $manager;
+        function YDSimpleCMSModule() {
+            $this->manager = & YDSimpleCMS::getModuleManager();
             $this->tpl = new YDSimpleCMSTemplate( YD_SIMPLECMS_SCOPE_PUBLIC );
         }
 
@@ -680,7 +709,7 @@
         function display( $name='' ) {
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
-            $this->tpl->assign( 'adminMenu',     $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
+            $this->tpl->assign( 'adminMenu',     YDSimpleCMS::getAdminMenu() );
             if ( isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] ) ) {
                 $this->tpl->assign( 'currentUser', $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] );
             }
@@ -761,20 +790,21 @@
             }
 
             // Create the class instance
-            $moduleInstance = new $moduleClassName( $this );
+            $moduleInstance = new $moduleClassName();
 
             // Set the correct template scope
             $moduleInstance->tpl->scope = $scope;
 
             // Sort the admin menu items
             if ( $scope == YD_SIMPLECMS_SCOPE_ADMIN ) {
-                ksort( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
-                foreach ( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] as $key=>$val ) {
-                    if ( isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'][$key]['children'] ) ) {
-                        ksort( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'][$key]['children'] );
+                $adminMenu = & YDSimpleCMS::getAdminMenu();
+                ksort( $adminMenu );
+                foreach ( $adminMenu as $key=>$val ) {
+                    if ( isset( $adminMenu[$key]['children'] ) ) {
+                        ksort( $adminMenu[$key]['children'] );
                     }
                 }
-                $moduleInstance->tpl->assign( 'adminMenu', $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] );
+                $moduleInstance->tpl->assign( 'adminMenu', $adminMenu );
             }
 
             // Create a link to ourselves



From pclaerhout at mail.berlios.de  Tue Jan 23 20:31:48 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 20:31:48 +0100
Subject: [ydf-devel] r2351 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701231931.l0NJVmJx016534@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 20:31:39 +0100 (Tue, 23 Jan 2007)
New Revision: 2351

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
Log:
Added the YDSimpleCMS::getScope() function and implemented in the different classes.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 19:08:02 UTC (rev 2350)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 19:31:39 UTC (rev 2351)
@@ -106,6 +106,8 @@
          *
          *  @todo
          *      Negotiate the language and put it as an array under $GLOBALS['YD_SIMPLECMS']['languages']
+         *
+         *  @static
          */
         function initialize() {
 
@@ -133,6 +135,9 @@
                 $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager'] = new YDSimpleCMSModuleManager();
                 $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager']->loadAllModules();
 
+                // Set the default scope
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['scope'] = YD_SIMPLECMS_SCOPE_PUBLIC;
+
             }
 
         }
@@ -148,6 +153,7 @@
          *  @static
          */
         function run( $scope ) {
+            YDSimpleCMS::setVar( 'scope', $scope );
             $baseClass = ( strtolower( $scope ) == YD_SIMPLECMS_SCOPE_PUBLIC ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
             $clsInst = new YDExecutor( $baseClass . '.php' );
             @session_start();
@@ -246,13 +252,20 @@
          *  @static
          */
         function & getAdminMenu() {
-            return YDSimpleCMS::getVar( 'adminMenu' );
+            $adminMenu = & YDSimpleCMS::getVar( 'adminMenu' );
+            ksort( $adminMenu );
+            foreach ( $adminMenu as $key=>$val ) {
+                if ( isset( $adminMenu[$key]['children'] ) ) {
+                    ksort( $adminMenu[$key]['children'] );
+                }
+            }
+            return $adminMenu;
         }
 
         /**
          *  This function returns an instance of the module manager class.
          *
-         *  @returns    An instance of the module manager class..
+         *  @returns    An instance of the module manager class.
          *
          *  @static
          */
@@ -261,11 +274,36 @@
         }
 
         /**
+         *  This function returns the current scope in which the request runs.
+         *
+         *  @returns    Returns YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
+         *
+         *  @static
+         */
+        function & getScope() {
+            return YDSimpleCMS::getVar( 'scope' );
+        }
+
+        /**
+         *  This function returns the details of the current user which is logged in. If no one is logged in, it will
+         *  return a null value.
+         *
+         *  @returns    Returns the details of the currently logged in user.
+         *
+         *  @static
+         */
+        function & getCurrentUser() {
+            return YDSimpleCMS::getVar( 'currentUser' );
+        }
+
+        /**
          *  This function returns one of the named variables from the global CMS scope.
          *
          *  @param  $var    The name of the variable you want to retrieve.
          *
          *  @returns    The contents of that variable, false if the variable doesn't exist.
+         *
+         *  @static
          */
         function & getVar( $var ) {
 
@@ -274,13 +312,26 @@
 
             // Return the variable if it's set, otherwise return false
             if ( ! isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var] ) ) {
-                return false;
+                $var = false;
+                return $var;
             }
 
             // Return a reference to the variable
             return $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var];
 
         }
+        
+        /**
+         *  This function sets a YDSimpleCMS variable.
+         *
+         *  @param  $var    The variable to set.
+         *  @param  $value  The value to set the variable to.
+         *
+         *  @static
+         */
+        function setVar( $var, $value ) {
+            $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var] = $value;
+        }
 
     }
 
@@ -302,29 +353,6 @@
     class YDSimpleCMSTemplate extends YDTemplate {
 
         /**
-         *  The scope which is going to be used for the template.
-         *
-         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
-         */
-        var $scope;
-
-        /**
-         *  The class constructor the the YDSimpleCMSTemplate class.
-         *
-         *  @param  $scope  The scope which is going to be used for the template. Can be either
-         *                  YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
-         */
-        function YDSimpleCMSTemplate( $scope ) {
-
-            // Initialize the parent
-            $this->YDTemplate();
-
-            // Set the scope
-            $this->scope = $scope;
-
-        }
-
-        /**
          *  This function will fetch the specified template, and surround it with the contents of the indicated master
          *  page, which should be in the skins directory.
          *
@@ -338,9 +366,12 @@
          */
         function fetchWithMaster( $template='', $master='__master' ) {
 
+            // Get the current scope
+            $scope = YDSimpleCMS::getScope();
+            
             // Set the variables
-            $this->template_dir = YD_SIMPLECMS_SKINS_DIR . $this->scope;
-            if ( $this->scope == YD_SIMPLECMS_SCOPE_PUBLIC ) {
+            $this->template_dir = YD_SIMPLECMS_SKINS_DIR . $scope;
+            if ( $scope == YD_SIMPLECMS_SCOPE_PUBLIC ) {
                 $this->template_dir .= '/' . YDConfig::get( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
             }
 
@@ -384,13 +415,6 @@
     class YDSimpleCMSPublicRequest extends YDRequest {
 
         /**
-         *  The scope which is going to be used for the template.
-         *
-         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
-         */
-        var $requestScope  = YD_SIMPLECMS_SCOPE_PUBLIC;
-
-        /**
          *  The default module for the request class.
          *
          *  Currently defaults to 'page' for the public request class.
@@ -413,7 +437,7 @@
             $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
             $action = $this->getQueryStringParameter( 'action', 'show' );
             $moduleManager = & YDSimpleCMS::getModuleManager();
-            $moduleManager->runModule( $this->requestScope, $module, $action );
+            $moduleManager->runModule( $module, $action );
         }
 
     }
@@ -437,13 +461,6 @@
     class YDSimpleCMSAdminRequest extends YDSimpleCMSPublicRequest {
 
         /**
-         *  The scope which is going to be used for the template.
-         *
-         *  Can be either YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
-         */
-        var $requestScope  = YD_SIMPLECMS_SCOPE_ADMIN;
-
-        /**
          *  The default module for the request class.
          *
          *  Currently defaults to 'admin' for the admin request class.
@@ -464,7 +481,7 @@
             $this->setRequiresAuthentication( true );
 
             // Instantiate the template object
-            $this->tpl = new YDSimpleCMSTemplate( YD_SIMPLECMS_SCOPE_ADMIN );
+            $this->tpl = new YDSimpleCMSTemplate();
 
             // Get the site id
             $this->siteId = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
@@ -589,7 +606,7 @@
             if ( $result === false ) {
                 return array( '__ALL__' => t( 'err_login_all' ) );
             } else {
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] = $result;
+                YDSimpleCMS::setVar( 'currentUser', $result );
                 return true;
             }
         }
@@ -634,18 +651,6 @@
         var $authorUrl     = 'http://www.yellowduck.be';
 
         /**
-         *  A reference to the module manager instance that loaded this module.
-         */
-        var $manager       = null;
-
-        /**
-         *  The current scope of the CMS module.
-         *
-         *  Currently, the value can only be YD_SIMPLECMS_SCOPE_PUBLIC or YD_SIMPLECMS_SCOPE_ADMIN.
-         */
-        var $currentScope  = null;
-
-        /**
          *  The name of the action that is currently being executed.
          */
         var $currentAction = null;
@@ -656,8 +661,7 @@
          *  @param  $manager    A reference to the module manager instance that loaded this module.
          */
         function YDSimpleCMSModule() {
-            $this->manager = & YDSimpleCMS::getModuleManager();
-            $this->tpl = new YDSimpleCMSTemplate( YD_SIMPLECMS_SCOPE_PUBLIC );
+            $this->tpl = new YDSimpleCMSTemplate();
         }
 
         /**
@@ -710,12 +714,10 @@
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
             $this->tpl->assign( 'adminMenu',     YDSimpleCMS::getAdminMenu() );
-            if ( isset( $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] ) ) {
-                $this->tpl->assign( 'currentUser', $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] );
+            if ( YDSimpleCMS::getCurrentUser() ) {
+                $this->tpl->assign( 'currentUser', YDSimpleCMS::getCurrentUser() );
             }
-            if ( $name == '' ) {
-                $name = $this->getModuleName();
-            }
+            $name = ( $name == '' ) ? $this->getModuleName() : $name;
             $this->tpl->displayWithMaster( $name );
         }
 
@@ -769,15 +771,13 @@
          *      This function should only be called after the loadAllModules function has been executed. If not, this
          *      function will fail as the include files are not loaded yet.
          *
-         *  @param  $scope  The scope in which to run the module and action. Can be YD_SIMPLECMS_SCOPE_PUBLIC or
-         *                  YD_SIMPLECMS_SCOPE_ADMIN.
          *  @param  $module The name of the module to run.
          *  @param  $action The name of the action to run.
          */
-        function runModule( $scope, $module, $action ) {
+        function runModule( $module, $action ) {
 
             // Convert everything to lowercase
-            $scope  = strtolower( $scope );
+            $scope  = YDSimpleCMS::getScope();
             $module = strtolower( $module );
             $action = strtolower( $action );
 
@@ -798,12 +798,6 @@
             // Sort the admin menu items
             if ( $scope == YD_SIMPLECMS_SCOPE_ADMIN ) {
                 $adminMenu = & YDSimpleCMS::getAdminMenu();
-                ksort( $adminMenu );
-                foreach ( $adminMenu as $key=>$val ) {
-                    if ( isset( $adminMenu[$key]['children'] ) ) {
-                        ksort( $adminMenu[$key]['children'] );
-                    }
-                }
                 $moduleInstance->tpl->assign( 'adminMenu', $adminMenu );
             }
 
@@ -823,7 +817,7 @@
         function getModuleList() {
             $modules = array();
             foreach ( get_declared_classes() as $class ) {
-                if ( substr( $class, 0, strlen( YD_SIMPLECMS_MODULE_PREFIX ) ) == YD_SIMPLECMS_MODULE_PREFIX ) {
+                if ( YDStringUtil::startsWith( $class, YD_SIMPLECMS_MODULE_PREFIX ) ) {
                     $modules[$class] = new $class( $this );
                 }
             }

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 19:08:02 UTC (rev 2350)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 19:31:39 UTC (rev 2351)
@@ -26,7 +26,7 @@
      */
 
     /**
-     *  The page module
+     *  The page module which handles a basic page object.
      *
      *  @ingroup YDSimpleCMS
      */
@@ -53,7 +53,7 @@
     }
 
     /**
-     *  The admin module
+     *  The admin module which implements most of the standard admin functions.
      *
      *  @ingroup YDSimpleCMS
      */
@@ -79,7 +79,8 @@
 
         // List the plugins
         function action_admin_modules() {
-            $this->tpl->assign( 'modules', $this->manager->getModuleList() );
+            $moduleManager = & YDSimpleCMS::getModuleManager();
+            $this->tpl->assign( 'modules', $moduleManager->getModuleList() );
             $this->display();
         }
 



From pclaerhout at mail.berlios.de  Tue Jan 23 20:48:48 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 20:48:48 +0100
Subject: [ydf-devel] r2352 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701231948.l0NJmm5U017578@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 20:48:46 +0100 (Tue, 23 Jan 2007)
New Revision: 2352

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
Log:
Consolidated YDSimpleCMSAdminRequest and YDSimpleCMSPublicRequest into YDSimpleCMSRequest.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 19:31:39 UTC (rev 2351)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 19:48:46 UTC (rev 2352)
@@ -23,20 +23,6 @@
 
     /**
      *  @addtogroup YDSimpleCMS Addons - Simple CMS
-     *
-     *  @todo
-     *      Consolidate the two request classes into one. Based on the scope, it should know if you need to force
-     *      authentication or not.
-     *
-     *  @todo
-     *      Make a link from the module to the request instance
-     *
-     *  @todo
-     *      Make a link from the template to the module instance and module manager (so that you can access these from
-     *      the template)
-     *
-     *  @todo
-     *      Make login module based?
      */
 
     // Check if the framework is loaded
@@ -154,8 +140,7 @@
          */
         function run( $scope ) {
             YDSimpleCMS::setVar( 'scope', $scope );
-            $baseClass = ( strtolower( $scope ) == YD_SIMPLECMS_SCOPE_PUBLIC ) ? 'YDSimpleCMSPublicRequest' : 'YDSimpleCMSAdminRequest';
-            $clsInst = new YDExecutor( $baseClass . '.php' );
+            $clsInst = new YDExecutor( 'YDSimpleCMSRequest.php' );
             @session_start();
             $clsInst->execute();
         }
@@ -404,50 +389,14 @@
         }
 
     }
-
+    
     /**
-     *  Define the CMS public request class.
+     *  Define the SimpleCMS request class. This is the base classes for all requests in the framework.
      *
-     *  The public request class doesn't perform any user authentication.
+     *  Depending on the current scope, authetication will be enforced or not. It works as follows:
+     *      - YD_SIMPLECMS_SCOPE_PUBLIC: authetication is performed but not enforced
+     *      - YD_SIMPLECMS_SCOPE_ADMIN: authetication is performed and enforced
      *
-     *  @ingroup YDSimpleCMS
-     */
-    class YDSimpleCMSPublicRequest extends YDRequest {
-
-        /**
-         *  The default module for the request class.
-         *
-         *  Currently defaults to 'page' for the public request class.
-         */
-        var $defaultModule = 'page';
-
-        /**
-         *  The default action for the public request.
-         *
-         *  Currently, it does the following items:
-         *      - Creates an instance of YDSimpleCMSModuleManager
-         *      - Loads all the modules using the instance
-         *      - Runs the module and action specified by the query string
-         *
-         *  @todo
-         *      Needs to be implemented properly so that it can do all it's stuff based on the ID passed in the qeury
-         *      string of the request.
-         */
-        function actionDefault() {
-            $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
-            $action = $this->getQueryStringParameter( 'action', 'show' );
-            $moduleManager = & YDSimpleCMS::getModuleManager();
-            $moduleManager->runModule( $module, $action );
-        }
-
-    }
-
-    /**
-     *  Define the CMS admin request class.
-     *
-     *  This class forces authentication against the database (the \#_users table). Only if the authentication succeeds,
-     *  you will be able to access the request.
-     *
      *  It also supports modules and action via specific query string parameters:
      *      - module: the module to load (defaults to 'admin' )
      *      - action: the action to load from the module (defaults to 'show')
@@ -458,24 +407,24 @@
      *
      *  @ingroup YDSimpleCMS
      */
-    class YDSimpleCMSAdminRequest extends YDSimpleCMSPublicRequest {
+    class YDSimpleCMSRequest extends YDRequest {
 
         /**
-         *  The default module for the request class.
-         *
-         *  Currently defaults to 'admin' for the admin request class.
-         */
-        var $defaultModule = 'admin';
-
-        /**
          *  The constructor for the admin CMS request.
          *
          *  This one forces authentication and requires a configuration variable called 'YD_SIMPLECMS_SITEID' to be set.
          */
-        function YDSimpleCMSAdminRequest() {
+        function YDSimpleCMSRequest() {
 
             // Initialize the parent
-            $this->YDSimpleCMSPublicRequest();
+            $this->YDRequest();
+            
+            // Setup the default module based on the current scope
+            if ( YDSimpleCMS::getScope() == YD_SIMPLECMS_SCOPE_PUBLIC ) {
+                $this->defaultModule = 'page';
+            } else {
+                $this->defaultModule = 'admin';
+            }
 
             // Indicate we require login
             $this->setRequiresAuthentication( true );
@@ -493,6 +442,25 @@
         }
 
         /**
+         *  The default action for the public request.
+         *
+         *  Currently, it does the following items:
+         *      - Creates an instance of YDSimpleCMSModuleManager
+         *      - Loads all the modules using the instance
+         *      - Runs the module and action specified by the query string
+         *
+         *  @todo
+         *      Needs to be implemented properly so that it can do all it's stuff based on the ID passed in the qeury
+         *      string of the request.
+         */
+        function actionDefault() {
+            $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
+            $action = $this->getQueryStringParameter( 'action', 'show' );
+            $moduleManager = & YDSimpleCMS::getModuleManager();
+            $moduleManager->runModule( $module, $action );
+        }
+
+        /**
          *  This action takes care of handling the login form. It can show and validate a login form and redirects to
          *  default action of the request class when the user is authenticated.
          */
@@ -572,7 +540,11 @@
                     return true;
                 }
             }
-            return false;
+            if ( YDSimpleCMS::getScope() == YD_SIMPLECMS_SCOPE_PUBLIC ) {
+                return true;
+            } else {
+                return false;
+            }
         }
 
         /**
@@ -726,20 +698,36 @@
          *
          *  This function gets triggered by the module manager when this one wants to trigger an action.
          *
-         *  @param  $scope  The scope in which to run the action. Can be YD_SIMPLECMS_SCOPE_PUBLIC or
-         *                  YD_SIMPLECMS_SCOPE_ADMIN
          *  @param  $action The action to run.
          */
-        function runAction( $scope, $action ) {
+        function runAction( $action ) {
+            $scope = YDSimpleCMS::getScope();
             $moduleFunctionName = YD_SIMPLECMS_ACTION_PREFIX . $scope . '_' . $action;
             if ( ! $this->hasMethod( $moduleFunctionName ) ) {
-                YDSimpleCMS::showError( 'Module %s function not found: %s', $this->getModuleName(), $moduleFunctionName );
+                YDSimpleCMS::showError(
+                    'Module "%s" does not have a function called "%s"',
+                    $this->getModuleName(), $moduleFunctionName
+                );
             }
             $this->currentScope  = $scope;
             $this->currentAction = $action;
             call_user_func( array( $this, $moduleFunctionName ) );
         }
 
+        /**
+         *  This function forces the user to logout.
+         */
+        function action_admin_logout() {
+            YDRequest::redirect( YD_SELF_SCRIPT . '?do=logout' );
+        }
+
+        /**
+         *  This function forces the user to logout.
+         */
+        function action_public_logout() {
+            $this->action_admin_logout();
+        }
+
     }
 
     /**
@@ -805,7 +793,7 @@
             $moduleInstance->manager = & $this;
 
             // Run the action
-            $moduleInstance->runAction( $scope, $action );
+            $moduleInstance->runAction( $action );
 
         }
 

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 19:31:39 UTC (rev 2351)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 19:48:46 UTC (rev 2352)
@@ -72,11 +72,6 @@
             $this->display();
         }
 
-        // Admin logout function
-        function action_admin_logout() {
-            YDRequest::redirect( YD_SELF_SCRIPT . '?do=logout' );
-        }
-
         // List the plugins
         function action_admin_modules() {
             $moduleManager = & YDSimpleCMS::getModuleManager();



From pclaerhout at mail.berlios.de  Tue Jan 23 21:00:17 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 21:00:17 +0100
Subject: [ydf-devel] r2353 -
	YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default
Message-ID: <200701232000.l0NK0H1c018548@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 21:00:13 +0100 (Tue, 23 Jan 2007)
New Revision: 2353

Modified:
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
Log:
Added a sample of using the user object with a public request.

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-23 19:48:46 UTC (rev 2352)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-23 20:00:13 UTC (rev 2353)
@@ -7,6 +7,11 @@
 </head>
 
 <body>
+    {if $currentUser}
+        <p>
+            {$currentUser.name} | <a href="{$YD_SELF_SCRIPT}?action=logout">{t w="logout"}</a>
+        </p>
+    {/if}
 
     ##content##
 



From pclaerhout at mail.berlios.de  Tue Jan 23 21:01:06 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 23 Jan 2007 21:01:06 +0100
Subject: [ydf-devel] r2354 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701232001.l0NK16Sn018606@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-23 21:01:03 +0100 (Tue, 23 Jan 2007)
New Revision: 2354

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
Log:
Cleaned up some documentation strings.


Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 20:00:13 UTC (rev 2353)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-23 20:01:03 UTC (rev 2354)
@@ -58,19 +58,8 @@
      *
      *  @todo
      *      Add the following functions:
-     *          - initialize(): checks against $GLOBALS['YD_SIMPLECMS'] to see if we are initialized. If not, we need
-     *             tostill initialize the cms package. Initializing means:
-     *              - Setup the database connection under $GLOBALS['YD_SIMPLECMS']['db']
-     *              - Negotiate the languages for public and admin under $GLOBALS['YD_SIMPLECMS']['languages']
-     *              - Initializes the module manager under $GLOBALS['YD_SIMPLECMS']['moduleManager']
      *          - getLanguages(): returns $GLOBALS['YD_SIMPLECMS']['languages'], but issues initialize first if not done
      *            yet (to make sure we are initialized properly).
-     *          - getDatabase(): returns $GLOBALS['YD_SIMPLECMS']['db'], but issues initialize first if not done yet (to
-     *            make sure we are initialized properly).
-     *          - getModuleManager(): returns $GLOBALS['YD_SIMPLECMS']['moduleManager'], but issues initialize first if
-     *            not done yet (to make sure we are initialized properly).
-     *          - isInitialized(): returns a boolean indicating if the CMS package was initialized or not.
-     *          - initializeIfNeeded(): shortcut for checking isInitialized and then doing initialize if needed.
      *      \n
      *      We could do all this in the request class, but that would mean the modules will not have access to it. This
      *      way, we kind of make a pseudo singleton class that can be accessed from anywhere in the code.
@@ -87,6 +76,7 @@
          *      - Adds a module manager instance under $GLOBALS['YD_SIMPLECMS']['moduleManager']
          *      - Adds a array under $GLOBALS['YD_SIMPLECMS']['adminMenu'] to keep track of the admin menu
          *      - Adds a null value under $GLOBALS['YD_SIMPLECMS']['user'] to keep track of the current user
+         *      - Stores the current scope in $GLOBALS['YD_SIMPLECMS']['scope']
          *
          *  Even if you call this function multiple times, the initialization will only be done once.
          *
@@ -164,10 +154,9 @@
         }
 
         /**
-         *  This function will show an error for the CMS application.
+         *  This function will show an error for the CMS application. The parameters that are supported are the same
+         *  ones as the sprintf and printf functions.
          *
-         *  The parameters that are supported are the same ones as the sprintf and printf functions.
-         *
          *  @static
          */
         function showError() {
@@ -629,8 +618,6 @@
 
         /**
          *  The class constructor the the YDSimpleCMSModule class.
-         *
-         *  @param  $manager    A reference to the module manager instance that loaded this module.
          */
         function YDSimpleCMSModule() {
             $this->tpl = new YDSimpleCMSTemplate();

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 20:00:13 UTC (rev 2353)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS_CoreModules.php	2007-01-23 20:01:03 UTC (rev 2354)
@@ -32,20 +32,46 @@
      */
     class module_page extends YDSimpleCMSModule {
 
-        // Class variables
+        /**
+         *  The nice name of the CMS module.
+         */
         var $name        = 'SimpleCMS Page Module';
+
+        /**
+         *  The full description of the CMS module.
+         */
         var $description = 'SimpleCMS module to manage pages.';
-        var $version     = '1.0';
-        var $authorName  = 'Pieter Claerhout';
-        var $authorEmail = 'pieter at yellowduck.be';
-        var $authorUrl   = 'http://www.yellowduck.be';
 
-        // Public main function
+        /**
+         *  The version number of the CMS module.
+         */
+        var $version       = '1.0';
+
+        /**
+         *  The name of the author of the CMS module.
+         */
+        var $authorName    = 'Pieter Claerhout';
+
+        /**
+         *  The email address of the author of the CMS module.
+         */
+        var $authorEmail   = 'pieter at yellowduck.be';
+
+        /**
+         *  The website address of the author of the CMS module.
+         */
+        var $authorUrl     = 'http://www.yellowduck.be';
+
+        /**
+         *  This is the default public action which currently just displays the template.
+         */
         function action_public_show() {
             $this->display();
         }
 
-        // Admin main function
+        /**
+         *  This is the default admin action for the page module.
+         */
         function action_admin_show() {
             $this->display();
         }
@@ -59,27 +85,55 @@
      */
     class module_admin extends YDSimpleCMSModule {
 
-        // Class variables
+        /**
+         *  The nice name of the CMS module.
+         */
         var $name         = 'SimpleCMS Admin Module';
+
+        /**
+         *  The full description of the CMS module.
+         */
         var $description  = 'SimpleCMS module to manage everything ;-)';
-        var $version      = '1.0';
-        var $authorName   = 'Pieter Claerhout';
-        var $authorEmail  = 'pieter at yellowduck.be';
-        var $authorUrl    = 'http://www.yellowduck.be';
 
-        // Admin main function
+        /**
+         *  The version number of the CMS module.
+         */
+        var $version       = '1.0';
+
+        /**
+         *  The name of the author of the CMS module.
+         */
+        var $authorName    = 'Pieter Claerhout';
+
+        /**
+         *  The email address of the author of the CMS module.
+         */
+        var $authorEmail   = 'pieter at yellowduck.be';
+
+        /**
+         *  The website address of the author of the CMS module.
+         */
+        var $authorUrl     = 'http://www.yellowduck.be';
+
+        /**
+         *  This is the default admin action for the admin module.
+         */
         function action_admin_show() {
             $this->display();
         }
 
-        // List the plugins
+        /**
+         *  This action will list all the plugins which are available on the system.
+         */
         function action_admin_modules() {
             $moduleManager = & YDSimpleCMS::getModuleManager();
             $this->tpl->assign( 'modules', $moduleManager->getModuleList() );
             $this->display();
         }
 
-        // The settings action
+        /**
+         *  This action will allow you to change the settings.
+         */
         function action_admin_settings() {
             $this->display();
         }



From ximian at mail.berlios.de  Wed Jan 24 12:56:54 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 24 Jan 2007 12:56:54 +0100
Subject: [ydf-devel] r2355 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701241156.l0OBus45014144@sheep.berlios.de>

Author: ximian
Date: 2007-01-24 12:56:38 +0100 (Wed, 24 Jan 2007)
New Revision: 2355

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
- FIX: YDLocale::useGettext() in a php5 with gettext built-in support was not working.. seems fixed now.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-23 20:01:03 UTC (rev 2354)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-24 11:56:38 UTC (rev 2355)
@@ -572,6 +572,9 @@
 			$_ENV["LC_MESSAGE"] = $locale;
 			$_ENV["LC_ALL"]     = $locale;
 
+			// added php5 environment flag
+			putenv( "LANGUAGE=" . $locale );
+
 			// check directory
 			if ( ! is_string( $directory ) ) $directory = YD_DIR_HOME . '/locale/';
 



From pclaerhout at mail.berlios.de  Wed Jan 24 15:12:59 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 15:12:59 +0100
Subject: [ydf-devel] r2356 - in YDFramework2.0/trunk: YDFramework2/YDClasses
	examples
Message-ID: <200701241412.l0OECxwY025746@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 15:12:42 +0100 (Wed, 24 Jan 2007)
New Revision: 2356

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
   YDFramework2.0/trunk/examples/database_tree.php
Log:
Added support for joining tables to YDDatabaseTree.

This commit also adds a standard table prefix to the table in the database tree called "t1" which should always be used as a reference in the field definitions.

It was particularly hard to get everything to work as I had to remove/add the table prefix in different parts of the code. Hopefully, I spotted all of them...

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-24 11:56:38 UTC (rev 2355)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-01-24 14:12:42 UTC (rev 2356)
@@ -33,6 +33,9 @@
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
 
+    // Configure the default for this class
+    YDConfig::set( 'YD_DBTREE_TABLEPREFIX', 't1', false );
+
     /**
      *  This class implements a database tree as described on:
      *  http://www.phpriot.com/d/articles/php/application-design/nested-trees-2/
@@ -40,6 +43,12 @@
      *  Schema description
      *
      *  @code
+     *  CREATE TABLE category (
+     *    id int(11) NOT NULL auto_increment,
+     *    category varchar(50) NOT NULL default '0',
+     *    PRIMARY KEY  (`id`)
+     *  );
+     *
      *  CREATE TABLE nested_tree (
      *      id int(11) NOT NULL auto_increment,
      *      parent_id int(11) NOT NULL default '0',
@@ -48,6 +57,7 @@
      *      nright int(11) NOT NULL default '0',
      *      nlevel int(11) NOT NULL default '0',
      *      position int(11) NOT NULL default '0',
+     *      cat_id int(11) NOT NULL default '0',
      *      PRIMARY KEY  (id),
      *      KEY nested_tree_parent_id (parent_id),
      *      KEY nested_tree_nleft (nleft),
@@ -59,49 +69,52 @@
      *  Default values for testing
      *
      *  @code
-     *  INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0);
-     *  INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0);
-     *  INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0);
-     *  INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0);
-     *  INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0);
-     *  INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0);
-     *  INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0);
-     *  INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0);
-     *  INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0);
-     *  INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0);
-     *  INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0);
+     *  INSERT INTO category VALUES (1,'cat1');
+     *
+     *  INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0,1);
+     *  INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0,1);
+     *  INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0,1);
+     *  INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0,1);
+     *  INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0,1);
+     *  INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0,1);
+     *  INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0,1);
+     *  INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0,1);
+     *  INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0,1);
+     *  INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0,1);
+     *  INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0,1);
      *  @endcode
      *
      *  Sample data dump
      *
      *  @code
-     *  +----+-----------+----------------------+-------+--------+--------+----------+
-     *  | id | parent_id | title                | nleft | nright | nlevel | position |
-     *  +----+-----------+----------------------+-------+--------+--------+----------+
-     *  |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |
-     *  |  2 |         1 | Code Paste           |     2 |      3 |      2 |        0 |
-     *  |  3 |         1 | Documentation        |     4 |      5 |      2 |        0 |
-     *  |  4 |         1 | Books & Publications |     6 |     13 |      2 |        0 |
-     *  |  5 |         4 | Apache               |     7 |      8 |      3 |        0 |
-     *  |  6 |         4 | PostgreSQL           |     9 |     10 |      3 |        0 |
-     *  |  7 |         4 | MySQL                |    11 |     12 |      3 |        0 |
-     *  |  8 |         1 | Links                |    14 |     21 |      2 |        0 |
-     *  |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |
-     *  | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |
-     *  | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |
-     *  +----+-----------+----------------------+-------+--------+--------+----------+
+     *  +----+----------+
+     *  | id | category |
+     *  +----+----------+
+     *  |  1 | cat1     |
+     *  +----+----------+
+     *
+     *  +----+-----------+----------------------+-------+--------+--------+----------+--------+
+     *  | id | parent_id | title                | nleft | nright | nlevel | position | cat_id |
+     *  +----+-----------+----------------------+-------+--------+--------+----------+--------+
+     *  |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |      1 |
+     *  |  2 |         1 | Code Paste           |    10 |     11 |      2 |        0 |      1 |
+     *  |  3 |         1 | Documentation        |    12 |     13 |      2 |        0 |      1 |
+     *  |  4 |         1 | Books & Publications |     2 |      9 |      2 |        0 |      1 |
+     *  |  5 |         4 | Apache               |     3 |      4 |      3 |        0 |      1 |
+     *  |  6 |         4 | PostgreSQL           |     7 |      8 |      3 |        0 |      1 |
+     *  |  7 |         4 | MySQL                |     5 |      6 |      3 |        0 |      1 |
+     *  |  8 |         1 | Links                |    14 |     21 |      2 |        0 |      1 |
+     *  |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |      1 |
+     *  | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |      1 |
+     *  | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |      1 |
+     *  +----+-----------+----------------------+-------+--------+--------+----------+--------+
      *  @endcode
      *
      *  @todo
-     *      Add support for joins so that you can link in other tables in the tree. Without this functionality, this
-     *      class is rather limited. We might need to give the table with the tree itself a common prefix so that we
-     *      can differentiate between the fields that should be stored in the table and the fields that should not be
-     *      stored in the database (which are the ones from the join tables).
+     *      Change the sort fields from a string separated list of fields to an array so that we can properly remove and
+     *      add the table prefix. Right now, it should work but there might be cases where it's failing.
      *
      *  @todo
-     *      Check if using YDDatabaseQuery can make the queries easier to understand and change.
-     *
-     *  @todo
      *      Add support for moving items up and down. The algorithm can be something like:
      *          - Move up: currentItem+1, nextItem-1
      *          - Move down: currentItem-1, previousItem+1
@@ -122,15 +135,61 @@
         function YDDatabaseTree( $db='default', $table, $idField='id', $parentField='parent_id', $sortField='position, title' ) {
             $this->db = YDDatabase::getNamedInstance( $db );
             $this->table = $table;
+            $this->tablePrefix = YDConfig::get( 'YD_DBTREE_TABLEPREFIX', 't1' );
+            $this->joins = array();
             $this->fields = array(
-                'id' => $idField, 'parent' => $parentField, 'sort' => $sortField,
-                'nleft' => 'nleft', 'nright' => 'nright', 'nlevel' => 'nlevel', 'position' => 'position'
+                'id'        => $this->_addTablePrefix( $idField ),
+                'parent'    => $this->_addTablePrefix( $parentField ),
+                'sort'      => $this->_addTablePrefix( $sortField ),
+                'nleft'     => $this->_addTablePrefix( 'nleft' ),
+                'nright'    => $this->_addTablePrefix( 'nright' ),
+                'nlevel'    => $this->_addTablePrefix( 'nlevel' ),
+                'position'  => $this->_addTablePrefix( 'position' ),
             );
             $this->_use_query_cache = true;
             $this->_query_cache = array();
         }
 
         /**
+         *  This function adds the default table prefix to the field name.
+         *
+         *  @param  $field  The name of the field to add the prefix to.
+         *
+         *  @returns    The name of the field with the prefix added to it.
+         */
+        function _addTablePrefix( $field ) {
+            $field = explode( ', ', $field );
+            foreach ( $field as $key=>$val ) {
+                if ( strpos( $val, '.' ) === false && ! YDStringUtil::startsWith( $val, $this->tablePrefix . '.' ) ) {
+                    $val = $this->tablePrefix . '.' . $val;
+                }
+                $field[$key] = $val;
+            }
+            return join( ', ', $field );
+        }
+
+        /**
+         *  This function removes the default table prefix to the field name.
+         *
+         *  @param  $field  The name of the field to remove the prefix from.
+         *
+         *  @returns    The name of the field with the prefix removed from it.
+         */
+        function _removeTablePrefix( $field ) {
+            $field = explode( ', ', $field );
+            foreach ( $field as $key=>$val ) {
+                if ( YDStringUtil::startsWith( $val, $this->tablePrefix . '.' ) ) {
+                    $field[$key] = substr( $val, strlen( $this->tablePrefix )+1 );
+                }
+                $pos = strpos( $val, '.' );
+                if ( $pos !== false ) {
+                    $field[$key] = substr( $val, $pos+1 );
+                }
+            }
+            return join( ', ', $field );
+        }
+
+        /**
          *  A utility function to return an array of the fields that need to be selected in SQL select queries.
          *
          *  @returns array   An indexed array of fields to select
@@ -149,9 +208,33 @@
          *  @internal
          */
         function _getFieldsAsString() {
-            return join( ',', $this->_getFields() );
+            return join( ', ', $this->_getFields() );
         }
 
+        /**
+         *  A utility function to return an array of the tables that need to be selected in SQL select queries.
+         *
+         *  @returns array   An indexed array of tables to select
+         *
+         *  @internal
+         */
+        function _getTables() {
+            $result = array_values( $this->joins );
+            array_unshift( $result, $this->table . ' ' . $this->tablePrefix );
+            return $result;
+        }
+
+        /**
+         *  Get the tables and joins joined as single string.
+         *
+         *  @returns A single string with the tables and joins joined as a string
+         *
+         *  @internal
+         */
+        function _getTablesAsString() {
+            return join( ' ', $this->_getTables() );
+        }
+
         /*
          *  Convert an array to an object.
          *
@@ -178,10 +261,14 @@
          */
         function _toNodeArray( $node ) {
             $arr = array();
-
-            foreach ( $this->fields as $f )
-                if ( isset( $node[ $f ] ) ) $arr[ $f ] = $node[ $f ];
-
+            foreach ( $this->fields as $fieldItem ) {
+                $fieldItem = explode( ', ', $this->_removeTablePrefix( $fieldItem ) );
+                foreach( $fieldItem as $f ) {
+                    if ( isset( $node[ $f ] ) ) {
+                        $arr[ $f ] = $node[ $f ];
+                    }
+                }
+            }
             return $arr;
         }
 
@@ -260,6 +347,17 @@
         }
 
         /**
+         *  Add a join table to the list of tables to will get returned by this class.
+         *
+         *  @param  $join   The full join statement such as LEFT JOIN x ON x = Z
+         */
+        function addJoinTable( $join ) {
+            if ( ! in_array( $join, $this->joins ) ) {
+                $this->joins[ $join ] = $join;
+            }
+        }
+
+        /**
          *  Set the sort field.
          *
          *  @param $sortField      (optional) Name of the field to sort data. Default is title.
@@ -282,15 +380,18 @@
             // Get the name of the field
             $field = is_null( $field ) ? $this->fields['id'] : $field;
             $field = empty( $field )   ? $this->fields['id'] : $field;
+            $field = $this->_addTablePrefix( $field );
 
             // The query to execute
             if ( is_int( $id ) ) {
                 $query = sprintf(
-                    'select %s from %s where %s = %d', $this->_getFieldsAsString(), $this->table, $field, $id
+                    'select %s from %s where %s = %d',
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(), $field, $id
                 );
             } else {
                 $query = sprintf(
-                    'select %s from %s where %s = \'%s\'', $this->_getFieldsAsString(), $this->table, $field, $id
+                    'select %s from %s where %s = \'%s\'',
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(), $field, $id
                 );
             }
 
@@ -315,7 +416,9 @@
          *
          *  @returns The descendants of the passed now
          */
-        function getDescendants( $id=0, $includeSelf=false, $childrenOnly=false, $max_level=null, $order=null, $specificPart=null ) {
+        function getDescendants(
+            $id=0, $includeSelf=false, $childrenOnly=false, $max_level=null, $order=null, $specificPart=null
+        ) {
 
             // Get the ID field
             $idField = $this->fields['id'];
@@ -331,7 +434,7 @@
             } else {
                 $nleft = $node['nleft'];
                 $nright = $node['nright'];
-                $parent_id = $node[$idField];
+                $parent_id = $node[$this->_removeTablePrefix($idField)];
             }
 
             // Get the order
@@ -348,39 +451,47 @@
                 if ( $includeSelf ) {
                     $query = sprintf(
                         'select %s from %s where %s = %d or %s = %d %s',
-                        $this->_getFieldsAsString(), $this->table, $this->fields['id'], $parent_id, $this->fields['parent'], $parent_id, $order
+                        $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                        $this->_addTablePrefix( $this->fields['id'] ), $parent_id,
+                        $this->_addTablePrefix( $this->fields['parent'] ), $parent_id, $order
                     );
                 } else {
                     $query = sprintf(
                         'select %s from %s where %s = %d %s',
-                        $this->_getFieldsAsString(), $this->table, $this->fields['parent'], $parent_id, $order
+                        $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                        $this->_addTablePrefix( $this->fields['parent'] ), $parent_id, $order
                     );
                 }
 
             } else {
-                
+
                 // Include all
                 if ( $nleft > 0 && $includeSelf ) {
                     $query = sprintf(
-                        'select %s from %s where nleft >= %d and nright <= %d %s',
-                         $this->_getFieldsAsString(), $this->table, $nleft, $nright, $order
+                        'select %s from %s where %s.nleft >= %d and %s.nright <= %d %s',
+                        $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                        $this->tablePrefix, $nleft, $this->tablePrefix, $nright, $order
                     );
                 } else if ( $nleft > 0 ) {
                     $query = sprintf(
-                        'select %s from %s where nleft > %d and nright < %d %s',
-                        $this->_getFieldsAsString(), $this->table, $nleft, $nright, $order
+                        'select %s from %s where %s.nleft > %d and %snright < %d %s',
+                        $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                        $this->tablePrefix, $nleft, $this->tablePrefix, $nright, $order
                     );
                 } else {
-                    $query = sprintf( 'select %s from %s where id > 0 %s', $this->_getFieldsAsString(), $this->table, $order );
+                    $query = sprintf(
+                        'select %s from %s where %s.id > 0 %s',
+                        $this->_getFieldsAsString(), $this->_getTablesAsString(), $this->tablePrefix, $order
+                    );
                 }
-                
+
             }
 
             // Add the level constraint
             if ( ! is_null( $max_level ) ) {
                 $max_level = ( $includeSelf ) ? $max_level : $max_level + 1;
                 $max_level = ( $includeSelf ) ? $node['nlevel'] + $max_level - 1 : $node['nlevel'] + $max_level;
-                $query = str_replace( 'where ', 'where nlevel <= ' . $max_level . ' and ', $query );
+                $query = str_replace( 'where ', 'where ' . $this->tablePrefix . '.nlevel <= ' . $max_level . ' and ', $query );
             }
 
             // Get the results as an array
@@ -389,7 +500,7 @@
             // Reformat the array
             $arr = array();
             foreach ( $records as $record ) {
-                $arr[ $record[$idField] ] = $this->_fromNodeArray( $record );
+                $arr[ $record[$this->_removeTablePrefix($idField)] ] = $this->_fromNodeArray( $record );
             }
 
             // check if we want a specific column
@@ -398,7 +509,7 @@
                 // init temporary array
                 $nodes = array();
                 foreach ( $arr as $node )
-                    array_push( $nodes, $node[ $specificPart ] );
+                    array_push( $nodes, $node[ $this->_removeTablePrefix($specificPart) ] );
 
                 return $nodes;
             }
@@ -422,7 +533,7 @@
         }
 
         /**
-         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is 
+         *  Fetch the path to a node. If an invalid node is passed, an empty array is returned. If a top level node is
          *  passed, an array containing on that node is included (if 'includeSelf' is set to true, otherwise an empty
          *  array).
          *
@@ -447,13 +558,15 @@
             // Include ourselves?
             if ( $includeSelf ) {
                 $query = sprintf(
-                    'select %s from %s where nleft <= %d and nright >= %d order by nlevel',
-                    $this->_getFieldsAsString(), $this->table, $node['nleft'], $node['nright']
+                    'select %s from %s where %s.nleft <= %d and %s.nright >= %d order by %s.nlevel',
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                    $this->tablePrefix, $node['nleft'], $this->tablePrefix, $node['nright'], $this->tablePrefix
                 );
             } else {
                 $query = sprintf(
-                    'select %s from %s where nleft < %d and nright > %d order by nlevel',
-                    $this->_getFieldsAsString(), $this->table, $node['nleft'], $node['nright']
+                    'select %s from %s where %s.nleft < %d and %s.nright > %d order by %s.nlevel',
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(),
+                    $this->tablePrefix, $node['nleft'], $this->tablePrefix, $node['nright'], $this->tablePrefix
                 );
             }
 
@@ -463,7 +576,7 @@
             // Reformat the array
             $arr = array();
             foreach ( $records as $record ) {
-                $arr[ $record[$idField] ] = $this->_fromNodeArray( $record );
+                $arr[ $record[$this->_removeTablePrefix($idField)] ] = $this->_fromNodeArray( $record );
             }
 
             // Return the result
@@ -491,8 +604,9 @@
 
             // The query
             $query = sprintf(
-                'select count(*) as is_descendant from %s where %s = %d and nleft > %d and nright < %d',
-                $this->table, $this->fields['id'], $descendant_id, $node['nleft'], $node['nright']
+                'select count(*) as is_descendant from %s where %s = %d and %s.nleft > %d and %s.nright < %d',
+                $this->_getTablesAsString(), $this->_addTablePrefix( $this->fields['id'] ), $descendant_id,
+                $this->tablePrefix, $node['nleft'], $this->tablePrefix, $node['nright']
             );
 
             // Execute the query and get the record
@@ -520,7 +634,8 @@
             // The query
             $query = sprintf(
                 'select count(*) as is_child from %s where %s = %d and %s = %d',
-                $this->table, $this->fields['id'], $child_id, $this->fields['parent'], $parent_id
+                $this->_getTablesAsString(), $this->_addTablePrefix( $this->fields['id'] ),
+                $child_id, $this->_addTablePrefix( $this->fields['parent'] ), $parent_id
             );
 
             // Execute the query and get the record
@@ -548,7 +663,7 @@
             if ( $id == 0 ) {
 
                 // The query
-                $query = sprintf('select count(*) as num_descendants from %s', $this->table );
+                $query = sprintf('select count(*) as num_descendants from %s', $this->_getTablesAsString() );
 
                 // Execute the query and get the record
                 $record = $this->_getRecord( $query );
@@ -586,7 +701,8 @@
 
             // The query
             $query = sprintf(
-                'select count(*) as num_children from %s where %s = %d', $this->table, $this->fields['parent'], $id
+                'select count(*) as num_children from %s where %s = %d',
+                $this->_getTablesAsString(), $this->_addTablePrefix( $this->fields['parent'] ), $id
             );
 
             // Execute the query and get the record
@@ -603,7 +719,7 @@
         }
 
         /**
-         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. If 
+         *  Fetch the immediately family of a node. More specifically, fetch a node's parent, siblings and children. If
          *  the node isn't valid, fetch the first level of nodes from the tree.
          *
          * @param $id   The ID of the node to fetch child data for.
@@ -616,21 +732,21 @@
             $node = $this->_toNodeArray( $this->getNode( $id ) );
 
             // The ID and parent field
-            $idField = $this->fields['id'];
-            $parentField = $this->fields['parent'];
+            $idField = $this->_addTablePrefix( $this->fields['id'] );
+            $parentField = $this->_addTablePrefix( $this->fields['parent'] );
 
             // Is the passed node valid?
-            if ( $node[$idField] > 0 ) {
+            if ( $node[$this->_removeTablePrefix($idField)] > 0 ) {
                 $query = sprintf(
                     'select %s from %s where %s = %s or %s = %s or %s = %s order by nleft',
-                    $this->_getFieldsAsString(), $this->table, $idField, $node[$parentField], $parentField,
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(), $idField, $node[$parentField], $parentField,
                     $node[$parentField], $parentField, $node[$idField]
                 );
 
             } else {
                 $query = sprintf(
                     'select %s from %s where %s = 0 order by nleft',
-                    $this->_getFieldsAsString(), $this->table, $parentField
+                    $this->_getFieldsAsString(), $this->_getTablesAsString(), $parentField
                 );
             }
 
@@ -641,7 +757,7 @@
             $arr = array();
             foreach ( $records as $record ) {
                 $record['num_descendants'] = ( $record['nright'] - $record['nleft'] - 1 ) / 2;
-                $arr[ $record[$idField] ] = $this->_fromNodeArray( $record );
+                $arr[ $record[$this->_removeTablePrefix($idField)] ] = $this->_fromNodeArray( $record );
             }
 
             // Return the result
@@ -658,12 +774,13 @@
         function getTreeWithChildren() {
 
             // The ID and parent field
-            $idField = $this->fields['id'];
-            $parentField = $this->fields['parent'];
+            $idField     = $this->_removeTablePrefix( $this->fields['id'] );
+            $parentField = $this->_removeTablePrefix( $this->fields['parent'] );
 
             // The query
             $query = sprintf(
-                'select %s from %s order by %s', $this->_getFieldsAsString(), $this->table, $this->fields['sort']
+                'select %s from %s order by %s',
+                $this->_getFieldsAsString(), $this->_getTablesAsString(), $this->_addTablePrefix( $this->fields['sort'] )
             );
 
             // Get the records
@@ -717,8 +834,8 @@
             $n     = 0;
             $level = 0;
 
-            // Invoke the recursive function. Start it processing on the fake "root node" generated in 
-            // getTreeWithChildren(). because this node doesn't really exist in the database, we give it an initial 
+            // Invoke the recursive function. Start it processing on the fake "root node" generated in
+            // getTreeWithChildren(). because this node doesn't really exist in the database, we give it an initial
             // nleft value of 0 and an nlevel of 0.
             $this->_generateTreeData( $data, 0, 0, $n );
 
@@ -729,7 +846,8 @@
                 }
                 @ $query = sprintf(
                     'update %s set nlevel = %d, nleft = %d, nright = %d where %s = %d',
-                    $this->table, $row->nlevel, $row->nleft, $row->nright, $this->fields['id'], $id
+                    $this->table, $row->nlevel, $row->nleft, $row->nright,
+                    $this->_removeTablePrefix( $this->fields['id'] ), $id
                 );
                 $this->db->executeSql( $query );
             }
@@ -737,7 +855,7 @@
         }
 
         /**
-         *  Generate the tree data. A single call to this generates the n-values for 1 node in the tree. This function 
+         *  Generate the tree data. A single call to this generates the n-values for 1 node in the tree. This function
          *  assigns the passed in n value as the node's nleft value. It then processes all the node's children (which in
          *  turn recursively processes that node's children and so on), and when it is finally done, it takes the update
          *  n-value and assigns it as its nright value. Because it is passed as a reference, the subsequent changes in
@@ -783,7 +901,7 @@
             $this->_clearCache();
 
             // Add the parent field if needed
-            $parentField = $this->fields['parent'];
+            $parentField = $this->_removeTablePrefix( $this->fields['parent'] );
             if ( ! is_null( $parent_id ) && ! isset( $values[ $parentField ] ) ) {
                 $values[ $parentField ] = $parent_id;
             }
@@ -793,6 +911,12 @@
                 $values[ $parentField ] = 0;
             }
 
+            // Remove the table prefixes from the values
+            foreach ( $values as $key=>$val ) {
+                unset( $values[ $key ] );
+                $values[ $this->_removeTablePrefix( $key ) ] = $val;
+            }
+
             // Perform the insert
             $this->db->executeInsert( $this->table, $values );
 
@@ -862,13 +986,16 @@
             }
 
             // Get the list of IDs to delete
-			$nodes_to_delete = $this->getDescendants( $id, $includeParent, false, null, null, $this->fields['id'] );
+            $nodes_to_delete = $this->getDescendants( $id, $includeParent, false, null, null, $this->fields['id'] );
 
             // Check if there is something to delete
             if ( sizeof( $nodes_to_delete ) > 0 ) {
 
                 // The query to execute
-                $query = 'delete from ' . $this->table . ' where ' . $this->fields['id'] . ' in ( ' . join( ', ', $nodes_to_delete ) . ' )';
+                $query = sprintf(
+                    'DELETE FROM %s WHERE %s IN ( %s )',
+                    $this->table, $this->_removeTablePrefix( $this->fields['id'] ), join( ', ', $nodes_to_delete )
+                );
 
                 // Delete the nodes
                 $this->db->executeSql( $query );

Modified: YDFramework2.0/trunk/examples/database_tree.php
===================================================================
--- YDFramework2.0/trunk/examples/database_tree.php	2007-01-24 11:56:38 UTC (rev 2355)
+++ YDFramework2.0/trunk/examples/database_tree.php	2007-01-24 14:12:42 UTC (rev 2356)
@@ -6,6 +6,12 @@
     /*
 
         // ==== Schema description =====================================================================================
+        CREATE TABLE category (
+          id int(11) NOT NULL auto_increment,
+          category varchar(50) NOT NULL default '0',
+          PRIMARY KEY  (`id`)
+        );
+
         CREATE TABLE nested_tree (
             id int(11) NOT NULL auto_increment,
             parent_id int(11) NOT NULL default '0',
@@ -23,35 +29,42 @@
         // =============================================================================================================
 
         // ==== Default values for testing =============================================================================
-        INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0);
-        INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0);
-        INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0);
-        INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0);
-        INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0);
-        INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0);
-        INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0);
-        INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0);
-        INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0);
-        INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0);
-        INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0);
+        INSERT INTO category VALUES (1,'cat1');
+        INSERT INTO nested_tree VALUES (1,0,'General Resources',1,22,1,0,1);
+        INSERT INTO nested_tree VALUES (2,1,'Code Paste',2,3,2,0,1);
+        INSERT INTO nested_tree VALUES (3,1,'Documentation',4,5,2,0,1);
+        INSERT INTO nested_tree VALUES (4,1,'Books & Publications',6,13,2,0,1);
+        INSERT INTO nested_tree VALUES (5,4,'Apache',7,8,3,0,1);
+        INSERT INTO nested_tree VALUES (6,4,'PostgreSQL',9,10,3,0,1);
+        INSERT INTO nested_tree VALUES (7,4,'MySQL',11,12,3,0,1);
+        INSERT INTO nested_tree VALUES (8,1,'Links',14,21,2,0,1);
+        INSERT INTO nested_tree VALUES (9,8,'Databases',15,16,3,0,1);
+        INSERT INTO nested_tree VALUES (10,8,'Generators',17,18,3,0,1);
+        INSERT INTO nested_tree VALUES (11,8,'Portals',19,20,3,0,1);
         // =============================================================================================================
 
         // ==== Sample data dump =======================================================================================
-        +----+-----------+----------------------+-------+--------+--------+----------+
-        | id | parent_id | title                | nleft | nright | nlevel | position |
-        +----+-----------+----------------------+-------+--------+--------+----------+
-        |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |
-        |  2 |         1 | Code Paste           |     2 |      3 |      2 |        0 |
-        |  3 |         1 | Documentation        |     4 |      5 |      2 |        0 |
-        |  4 |         1 | Books & Publications |     6 |     13 |      2 |        0 |
-        |  5 |         4 | Apache               |     7 |      8 |      3 |        0 |
-        |  6 |         4 | PostgreSQL           |     9 |     10 |      3 |        0 |
-        |  7 |         4 | MySQL                |    11 |     12 |      3 |        0 |
-        |  8 |         1 | Links                |    14 |     21 |      2 |        0 |
-        |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |
-        | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |
-        | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |
-        +----+-----------+----------------------+-------+--------+--------+----------+
+        +----+----------+
+        | id | category |
+        +----+----------+
+        |  1 | cat1     |
+        +----+----------+
+
+        +----+-----------+----------------------+-------+--------+--------+----------+--------+
+        | id | parent_id | title                | nleft | nright | nlevel | position | cat_id |
+        +----+-----------+----------------------+-------+--------+--------+----------+--------+
+        |  1 |         0 | General Resources    |     1 |     22 |      1 |        0 |      1 |
+        |  2 |         1 | Code Paste           |    10 |     11 |      2 |        0 |      1 |
+        |  3 |         1 | Documentation        |    12 |     13 |      2 |        0 |      1 |
+        |  4 |         1 | Books & Publications |     2 |      9 |      2 |        0 |      1 |
+        |  5 |         4 | Apache               |     3 |      4 |      3 |        0 |      1 |
+        |  6 |         4 | PostgreSQL           |     7 |      8 |      3 |        0 |      1 |
+        |  7 |         4 | MySQL                |     5 |      6 |      3 |        0 |      1 |
+        |  8 |         1 | Links                |    14 |     21 |      2 |        0 |      1 |
+        |  9 |         8 | Databases            |    15 |     16 |      3 |        0 |      1 |
+        | 10 |         8 | Generators           |    17 |     18 |      3 |        0 |      1 |
+        | 11 |         8 | Portals              |    19 |     20 |      3 |        0 |      1 |
+        +----+-----------+----------------------+-------+--------+--------+----------+--------+
         // =============================================================================================================
 
     */
@@ -76,6 +89,12 @@
             // Get the tree instance
             $this->tree = new YDDatabaseTree( $db, 'nested_tree' );
 
+            // Add some fields
+            $this->tree->addField( 't2.category' );
+
+            // Add a join table
+            $this->tree->addJoinTable( 'JOIN category t2 ON t1.cat_id = t2.id' );
+
         }
 
         // Default action
@@ -89,6 +108,7 @@
 
             // Get a single node
             YDDebugUtil::dump( $tree->getNode( 2 ), '$tree->getNode( 2 )' );
+            YDDebugUtil::dump( $tree->getNode( 2, 'id' ), '$tree->getNode( 2, \'id\' )' );
 
             // Get the children of a single node
             YDDebugUtil::dump( $tree->getChildren( 2 ), '$tree->getChildren( 2 )' );



From pclaerhout at mail.berlios.de  Wed Jan 24 15:13:41 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 15:13:41 +0100
Subject: [ydf-devel] r2357 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701241413.l0OEDfM3025944@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 15:13:33 +0100 (Wed, 24 Jan 2007)
New Revision: 2357

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Added some more docstrings to YDSimpleCMS.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 14:12:42 UTC (rev 2356)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 14:13:33 UTC (rev 2357)
@@ -22,6 +22,16 @@
     */
 
     /**
+     *  @todo
+     *      Add multiple levels of templates so that you can have default templates which can be overridden (ala cakephp)
+     *
+     *  @todo
+     *      Add configuration option to define the error handling function. By default, it should just render an _error
+     *      template with the debug stacktrace and so on. By overridding the template, you can customize it.
+     *
+     *  @todo
+     *      Add options to supply multiple templates for each object type (e.g. page.tpl, page_homepage.tpl, ...)
+     *
      *  @addtogroup YDSimpleCMS Addons - Simple CMS
      */
 
@@ -121,7 +131,7 @@
         /**
          *  This is a static function that will run a request.
          *
-         *  @param  $scope  The scope in which the request needs to run. You can choose between 
+         *  @param  $scope  The scope in which the request needs to run. You can choose between
          *                  YD_SIMPLECMS_SCOPE_PUBLIC and YD_SIMPLECMS_SCOPE_ADMIN. If you choose
          *                  YD_SIMPLECMS_SCOPE_ADMIN, authentication will be enforced, with YD_SIMPLECMS_SCOPE_PUBLIC,
          *                  it's not.
@@ -294,7 +304,7 @@
             return $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME][$var];
 
         }
-        
+
         /**
          *  This function sets a YDSimpleCMS variable.
          *
@@ -342,7 +352,7 @@
 
             // Get the current scope
             $scope = YDSimpleCMS::getScope();
-            
+
             // Set the variables
             $this->template_dir = YD_SIMPLECMS_SKINS_DIR . $scope;
             if ( $scope == YD_SIMPLECMS_SCOPE_PUBLIC ) {
@@ -378,7 +388,7 @@
         }
 
     }
-    
+
     /**
      *  Define the SimpleCMS request class. This is the base classes for all requests in the framework.
      *
@@ -407,7 +417,7 @@
 
             // Initialize the parent
             $this->YDRequest();
-            
+
             // Setup the default module based on the current scope
             if ( YDSimpleCMS::getScope() == YD_SIMPLECMS_SCOPE_PUBLIC ) {
                 $this->defaultModule = 'page';



From ximian at mail.berlios.de  Wed Jan 24 15:36:31 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 24 Jan 2007 15:36:31 +0100
Subject: [ydf-devel] r2358 -
	YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent
Message-ID: <200701241436.l0OEaVU4027774@sheep.berlios.de>

Author: ximian
Date: 2007-01-24 15:36:02 +0100 (Wed, 24 Jan 2007)
New Revision: 2358

Added:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGuestbook.php
Removed:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
   YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
Log:
- start rewritten process of YDCMComponent.. much better now.

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMAudit.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,121 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /**
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMAudit extends YDDatabaseObject {
-    
-        function YDCMAudit() {
-        
-			// init database object
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMAudit' );
-
-            // register custom key
-            $this->registerKey( 'audit_id', true );
-
-            // register custom fields
-			$this->registerField( 'user_id' );
-			$this->registerField( 'date' );
-			$this->registerField( 'object' );
-			$this->registerField( 'object_action' );
-			$this->registerField( 'object_id' );
-			$this->registerField( 'browser' );
-			$this->registerField( 'platform' );
-			$this->registerField( 'url' );
-
-			// register custom relation
-            $rel = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
-			$rel->setLocalKey( 'user_id' );
-            $rel->setForeignKey( 'user_id' );
-			$rel->setForeignJoin( 'LEFT' );
-		}
-
-
-        /**
-         *  This function counts visits of a object
-         *
-         *  @param $id       Object id (content_id)
-         *  @param $user_id  (Optional) User id (0 means visitors)
-         *  @param $period   (Optional) Period for count. Valid values: 'week', 'month', year'
-         *
-         *  @returns    an array of labels => values
-         */
-		function getObjectVisits( $id, $user_id = 0, $period = 'week' ){
-		
-			YDInclude( 'YDDate.php' );
-		
-			// compute start date
-			$date = new YDDate();
-
-			$labels = array();
-			
-			if ( $period == 'week' )
-				for( $i = 0; $i < 7; $i++ ){
-					$labels[] = $date->getDayName();
-					$date->addDay( -1 );
-				}
-
-			if ( $period == 'month' )
-				for( $i = 0; $i < 4; $i++ ){
-					$labels[] = $date->getMonthName();
-					$date->addMonth( -1 );
-				}
-
-			if ( $period == 'year' )
-				for( $i = 0; $i < 3; $i++ ){
-					$labels[] = $date->getYear();
-					$date->addYear( -1 );
-				}
-
-			
-			$labels = array_reverse( $labels );
-
-		
-			$this->resetAll();
-			
-			$this->user_id = intval( $user_id );
-			
-		
-		}
-		
-		
-		
-
-    }
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComp.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,283 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-	require_once( dirname( __FILE__ ) . '/YDCMTree.php' );
-	require_once( dirname( __FILE__ ) . '/YDCMLanguages.php' );
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMComp extends YDDatabaseObject {
-    
-        function YDCMComp( $type, $id ) {
-        
-			// init component as non default
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMComp' );
-
-            // register custom key
-            $this->registerKey( 'component_id', true );
-
-			// register fields	
-			$this->registerField( 'title' );
-			$this->registerField( 'version_default' );
-			$this->registerField( 'version_date' );
-
-			// add static relations to tree and language
-			$this->registerField( 'content_id' );
-       		$rel = & $this->registerRelation( 'YDCMTree', false, 'YDCMTree' );
-			$rel->setLocalKey( 'content_id' );
-			$rel->setForeignKey( 'content_id' );
-
-			$this->registerField( 'language_id' );
-       		$rel = & $this->registerRelation( 'YDCMLanguages', false, 'YDCMLanguages' );
-			$rel->setLocalKey( 'language_id' );
-			$rel->setForeignKey( 'language_id' );
-
-			$this->registerField( 'user_id' );
-       		$rel = & $this->registerRelation( 'YDCMUsers', false, 'YDCMUsers' );
-			$rel->setLocalKey( 'user_id' );
-			$rel->setForeignKey( 'user_id' );
-
-			// add dynamic relation
-       		$rel = & $this->registerRelation( $type, false, $type );
-			$rel->setLocalKey( 'component_id' );
-			$rel->setForeignKey( 'component_id' );
-			$rel->setForeignJoin( 'LEFT' );
-
-			// store component id
-			$this->_id = intval( $id );
-			
-			// store type for future use
-			$this->_type = $type;
-		}
-
-
-        /**
-         *  This function return an array of parent nodes giving an node id
-         *
-         *  @returns    An array with all parent nodes
-         */
-		function getPath(){
-		
-			// 1st step: GET nleft and nright of this node. yes, it's ugly.. 
-			// TODO: change it with a better tree implementation
-			$this->resetAll();
-			$this->content_id  = $this->_id;
-			$this->language_id = YDLocale::get();
-
-			if ( $this->find( 'ydcmtree' ) != 1 ) return array();
-
-			$node = $this->getValues( false, false, false, false );
-		
-			// 2nd step: GET parents (based on previous nleft and nright)
-			$this->resetAll();
-
-			$this->language_id = YDLocale::get();
-			$this->where( 'YDCMTree.nleft  <= ' . intval( $node[ 'nleft' ] ) );
-			$this->where( 'YDCMTree.nright >= ' . intval( $node[ 'nright' ] ) );
-			$this->orderBy( 'YDCMTree.nlevel' );
-			$this->find( 'ydcmtree' );
-
-			return $this->getResults( false, false, false,false );
-		}
-
-
-        /**
-         *  This function returns the path string to a node
-         *
-         *  @param $separator    Html separator string
-         *  @param $classParents Html class for html links of parents
-         *  @param $classCurrent Html class for span ( current element )
-         *
-         *  @returns    An html string
-         */
-		function getBreadcrum( $separator, $classParents, $classCurrent ){
-
-			// init array for results
-			$res = array();
-
-			// init url object
-			$url = new YDUrl( YD_SELF_SCRIPT );
-
-			// cycle elements to get titles
-			foreach( $this->getPath() as $elements ){
-			
-				// set url var ID to this element
-				$url->setQueryVar( 'id',        $elements[ 'component_id' ] );
-				$url->setQueryVar( 'component', $elements[ 'type' ] );
-
-				// compute class name
-				if ( $this->_id != $elements[ 'content_id' ] ) $res[] = '<a class="' . $classParents . '" href="' . $url->getUrl() . '">' . $elements[ 'title' ] . '</a>';
-				else                                           $res[] = '<span class="' . $classCurrent . '">' . $elements[ 'title' ] . '</span>';
-			}
-
-			// return html string
-			return implode( $separator, $res );
-		}
-		
-		
-        /**
-         *  This function returns an array with all direct children
-         *
-         *  @returns    An array with all direct children
-         */
-		function getMenu(){
-		
-			$this->resetAll();
-
-			$this->language_id = YDLocale::get();
-			$this->where( 'YDCMTree.parent_id  = ' . $this->_id );
-			$this->find( 'ydcmtree' );
-			
-			return $this->getResults( false, false, false, false );
-		}
-
-
-        /**
-         *  This function will render all menu elements
-         *
-         *  @returns    An array with all direct children
-         */
-		function renderMenu(){
-
-			$menu = array();
-
-			$url = new YDUrl( YD_SELF_SCRIPT );
-
-			// render each element
-			foreach( $this->getMenu() as $element ){
-
-				$el = new $element[ 'type' ];
-				$menu[] = $el->render( $element, $url );
-			}
-
-			return $menu;
-		}
-
-
-        /**
-         *  This function return node attributes
-         *
-         *  @returns    An array with all attributes
-         */
-		function getNode(){
-		
-			// delete previous stored values
-			$this->resetAll();
-
-			// define our id to find		
-			$this->content_id  = $this->_id;
-			$this->language_id = YDLocale::get();
-			
-			$this->limit( 1 );
-			
-			// find node
-			$this->findAll();
-			
-			// parse html
-			if ( isset( $this->html ) )  $this->html  = htmlentities( $this->html );
-			if ( isset( $this->xhtml ) ) $this->xhtml = htmlentities( $this->xhtml );
-
-			// return node attributes without relation prefixs
-			return $this->getValues( false, false, false, false );
-		}
-
-
-        /**
-         *  This function return node infomation
-         *
-         *  @returns    An array with all information: array( 'description' => .., 'versions' => .., 'versions_total' => .. )
-         */
-		function getInfo(){
-		
-			// delete previous stored values
-			$this->resetAll();
-
-			// define our id to find		
-			$this->content_id  = $this->_id;
-
-			// order versions by version date
-			$this->orderBy( 'version_date', 'desc' );
-			
-			// find node
-			$this->find( 'ydcmtree', 'ydcmusers', strtolower( $this->_type ) );
-
-			$versions = $this->getResultsAsAssocArray( array( 'language_id', 'version_date' ) );
-			
-			// init description and total of versions
-			$description    = array();
-			$versions_total = 0;
-
-			// cycle versions, count and get first description (they must be all the same)
-			foreach( $versions as $v => $arr ){
-			
-				$versions_total += count( $arr );
-			
-				if ( empty( $description ) ) $description = array_values( $arr );
-			}
-
-			// parse publish dates
-			if ( $description[0][ 'YDCMTree_state' ] != 2 ){
-				$description[0][ 'YDCMTree_published_date_start_trans' ] = t('not applicable');
-				$description[0][ 'YDCMTree_published_date_end_trans' ]   = t('not applicable');
-			}
-
-			// parse access
-			if ( $description[0][ 'YDCMTree_access' ] == 1 ) $description[0][ 'YDCMTree_access_trans' ] = t('public');
-			else                                             $description[0][ 'YDCMTree_access_trans' ] = t('private');
-
-			// parse state
-			switch ($description[0][ 'YDCMTree_state' ]){
-				case 0 : $description[0][ 'YDCMTree_state_trans' ] = t('not published'); break;
-				case 1 : $description[0][ 'YDCMTree_state_trans' ] = t('published');     break;
-				case 2 : $description[0][ 'YDCMTree_state_trans' ] = t('schedule');      break;
-			}
-
-			// parse searcheable
-			if ( $description[0][ 'YDCMTree_searcheable' ] == 1 ) $description[0][ 'YDCMTree_searcheable_trans' ] = t('yes');
-			else                                                  $description[0][ 'YDCMTree_searcheable_trans' ] = t('no');
-
-			// return the information array
-			return array(	'description'    => $description[0],
-							'versions'       => $versions,
-							'versions_total' => $versions_total );
-		}
-
-}
-
-?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMComponent.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -31,359 +31,190 @@
     }
 
     // include YDF libs
-    YDInclude( 'YDDatabaseObject.php' );
-    YDInclude( 'YDDatabaseTree.php' );
-    YDInclude( 'YDUrl.php' );
-    YDInclude( 'YDResult.php' );
+    require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
 
-    // include YDCM libs
-    YDInclude( 'YDCMComp.php' );
 
-    // add generic translation directory
-    YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+    class YDCMComponent extends YDDatabaseObject{
 
     /**
      *  @ingroup YDCMComponent
      */
-    class YDCMComponent extends YDDatabaseObject {
+        function YDCMComponent( $table ) {
 
-        function YDCMComponent( $type, $id ) {
-
             // init DB object
             $this->YDDatabaseObject();
 
-            $this->_author = 'unknown author';
-            $this->_version = 'unknown version';
-            $this->_copyright = 'no copyright';
-            $this->_description = 'no description';
-
 			// register database as default
             $this->registerDatabase();
 
 			// register table for this component
-            $this->registerTable( $type );
+            $this->registerTable( $table );
 
-			// add standard relation
-			$this->registerField( 'component_id' );
-       		$rel = & $this->registerRelation( 'YDCMComp', false, 'YDCMComp' );
-			$rel->setLocalKey( 'component_id' );
-			$rel->setForeignKey( 'component_id' );
+            $this->_author = 'unknown author';
+            $this->_version = 'unknown version';
+            $this->_copyright = 'no copyright';
+            $this->_description = 'no description';
 
-			// add comp object
-			$this->comp = new YDCMComp( $type, $id );
-			
-			$this->_id = intval( $id );
-		}
+			// init language code to be the current locale code	
+			$this->setLanguage( null );
 
+			// virtual relation with tree titles
+       		$rel = & $this->registerRelation( 'ydcmtree_titles', false, 'ydcmtree_titles' );
+			$rel->setLocalKey( $table . '.tree_id' );
+			$rel->setForeignKey( 'ydcmtree_titles.tree_id' );
+			$rel->setForeignConditions( 'ydcmtree_titles.language_id = ' . $this->escapeSQL( $this->_language_id ) . ' AND ydcmtree_titles.language_id = ' . $table . '.language_id' );
 
-        /**
-         *  This function sets a new id for this component
-         *
-         *  @param $id           Component id
-         */
-		function setId( $id ){
+			// virtual relation with ydcmtree
+       		$rel = & $this->registerRelation( 'ydcmtree', false, 'ydcmtree' );
+			$rel->setLocalKey( $table . '.tree_id' );
+			$rel->setForeignKey( 'ydcmtree.tree_id' );
+			$rel->setForeignConditions( 'ydcmtree.tree_state = 1' );
 
-			// set id for all operations in this class
-			$this->_id       = intval( $id );
+			// register key
+			$this->registerKey( 'tree_id', false );
 
-			// set id for internal YDComp object
-			$this->comp->_id = intval( $id );
-		}
+			// init form elements
+            $this->_form_elements = array();
 
-
-        /**
-         *  This function renders this element for menu
-         *
-         *  @returns    The YDDatabaseTree object for YDComponent static methods
-         */
-		function __getYDDatabaseTree(){
-		
-			// TODO: position is required and we must change order from 'parent_id' to 'parent_id ASC, position ASC'
-			$tree = new YDDatabaseTree( 'default', 'YDCMTree', 'content_id', 'parent_id', 'parent_id' );
-
-			// TODO: set sort by parent & position
-			// $tree->setSortField( 'parent_id ASC, position ASC' );
-
-			// add tree fields
-			$tree->addField( 'type' );
-			$tree->addField( 'state' );
-			$tree->addField( 'reference' );
-			$tree->addField( 'access' );
-			$tree->addField( 'searcheable' );
-			$tree->addField( 'published_date_start' );
-			$tree->addField( 'published_date_end' );
-			$tree->addField( 'candrag' );
-			$tree->addField( 'candrop' );
-			
-			return $tree;		
+			// init form
+            $this->_form = null;
 		}
 
 
         /**
-         *  This function renders this element for menu
+         *  This function registers a field.
          *
-         *  @param $id        Component id
-         *  @param $url       Url object
+         *  @param $name  The field name.
+         *  @param $null  (optional) The field can be null? Default: false.
          *
-         *  @returns    An html string
+         *  @returns      A reference to the field object.
          */
-		function render( $id, & $url ){
-		
-			return '';
-		}
+        function & registerField( $name, $null = false, $formelement_type = null, $formelement_caption = '', $formelement_attribs = array(), $formelement_options = array() ) {
 
+			// add form element
+			if ( ! is_null( $formelement_type ) )
+				$this->_form_elements[ $name ] = array( $formelement_type, $formelement_caption, $formelement_attribs, $formelement_options );
 
-        /**
-         *  This function will render a menu
-         *
-         *  @returns    An array with all direct children
-         */
-		function renderMenu(){
-		
-			return $this->comp->renderMenu();
-		}
+			return parent::registerField( $name, $null );
+        }
 
-
+        
         /**
-         *  This function returns all node attributes
+         *  This function registers a key.
          *
-         *  @returns    An array with node attributes
-         */
-		function getNode(){
-
-			// check if we have already node attributes (some sort of caching)
-			if ( !isset( $this->__nodeProperties ) ) 
-				$this->__nodeProperties = $this->comp->getNode();
-		
-			return $this->__nodeProperties;
-		}
-
-
-		function getInfo(){
-		
-			return $this->comp->getInfo();
-		}
-
-        /**
-         *  This function returns a node attribute
+         *  @param $name  The field name.
+         *  @param $auto  (optional) The key is a auto-increment field? Default: false.
          *
-         *  @param $attribute           Attribute name
-         *
-         *  @returns    The node attribute
+         *  @returns      A reference to the field object.
          */
-		function get( $attribute ){
+        function & registerKey( $name, $auto = false, $formelement_type = null, $formelement_caption = '', $formelement_attribs = array(), $formelement_options = array() ) {
 
-			$node = $this->getNode();
+			if ( ! is_null( $formelement_type ) )
+				$this->_form_elements[ $name ] = array( $formelement_type, $formelement_caption, $formelement_attribs, $formelement_options );
 
-			// return attribute if exists 
-			if ( isset( $node[ $attribute ] ) ) return $node[ $attribute ];
+			return parent::registerKey( $name, $auto );
+        }
 
-			return false;
-		}
 
-
         /**
-         *  This function returns all elements (except root)
+         *  This method returns the current form. If your form must have custom login, overwride this method with your getForm
          *
-         *  @returns    all tree elements 
-         *  @static
+         *  @returns 	A YDForm object
          */
-		function getTreeElements( $id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// check if we have a custom id
-			if( is_null( $id ) ) $id = $this->_id;
-
-			// TODO: check if return element is a array
-			return $tree->getDescendants( $id );
-		}
-
-
-        /**
-         *  This function checks if elements are valid drag&dropable
-         *
-         *  @param $x  Id of dragable node
-         *  @param $y  Id of dropable node
-         *
-         *  @returns    false if elements are invalid, an associative array with node types (eg: array( $x => 'PHCMPage', $y => 'PHCMRootmenu ))'
-         *  @static
-         */
-		function getDragDropElements( $x = null, $y = null ){
+		function & getForm( $add_tree_elements = true, $add_title_elements = true ){
 		
-			// get tree module
-			$treeObj = YDCMComponent::module( 'YDCMTree' );
+			// return form if already computed
+			if ( ! is_null( $this->_form ) ) return $this->_form;		
 
-			// check drop validation
-			return $treeObj->getDragDropElements( $x, $y );
-		}
+			// compute form object
+			$this->_form = new YDForm( $this->getTable() );
 
+			// add title form elements
+			if ( $add_title_elements ){
+		        $this->_form->addElement( 'text',           'title',                t('ydcmuser label title'),     array('size' => 70, 'maxlength' => 70) );
+			}
 
-        /**
-         *  This function returns the path to current node
-         *
-         *  @returns    An array with all parents
-         */
-		function getPath(){
+			// add node form elements
+			if ( $add_tree_elements ){
+		        $this->_form->addElement( 'text',           'reference',            t('ydcmuser label reference'), array('size' => 25, 'maxlength' => 35) );
+	    	    $this->_form->addElement( 'select',         'language',             t('ydcmuser label language') );
+		        $this->_form->addElement( 'select',         'access',               t('ydcmuser label access'),         array(), array( 0 => _('private'), 1 => _('public') ) );
+		        $this->_form->addElement( 'select',         'state',                t('ydcmuser label state'),          array(), array( 1 => _('yes'), 0 => _('no'), 2 => _('schedule') ) );
+		        $this->_form->addElement( 'datetimeselect', 'published_date_start', t('ydcmuser label published_date_start' ) );
+		        $this->_form->addElement( 'datetimeselect', 'published_date_end',   t('ydcmuser label published_date_end' ) );
+			}
 
-			return $this->comp->getPath();
-		}
+			// add custom form elements
+			foreach( $this->_form_elements as $name => $info )
+				$this->_form->addElement( $info[0], $name, $info[1], $info[2], $info[3] );
 
-
-        /**
-         *  This function returns all direct elements of a menu
-         *
-         *  @returns    An array with all direct children
-         */
-		function getMenu(){
-
-			return $this->comp->getMenu();
+			// return object
+			return $this->_form;
 		}
 
 
         /**
-         *  This function returns the path string to current node
+         *  This method defines the language code to use in all sql queries
          *
-         *  @param $separator    (Optional) Html separator string
-         *  @param $classParents (Optional) Html class for html links of parents
-         *  @param $classCurrent (Optional) Url object for element links
-         *
-         *  @returns    An html string
+         *  @param $language_id  (Optional) Language id code, eg 'en'. By default current locale is used
          */
-		function getBreadcrum( $separator = ' &gt; ', $classParents = 'breadParents', $classCurrent = 'breadCurrent' ){
-
-			// get breadcrum from component
-			return $this->comp->getBreadcrum( $separator, $classParents, $classCurrent );
+		function setLanguage( $language_id = null ){
+		
+			if ( ! is_string( $language_id ) ) $this->_language_id = YDLocale::get();
+			else                               $this->_language_id = $language_id;
 		}
 
 
         /**
-         *  This function returns the component author
+         *  This method returns an element searching by its reference
          *
-         *  @returns    component author
+         *  @param $reference  Reference string
          */
-		function getAuthor(){
+		function getElementByReference( $reference ){
 
-			return $this->_author;
-		}
+			$this->resetAll();
+			$this->load( 'ydcmtree_titles' );
+			$this->ydcmtree_titles->set( 'title_reference', $reference );
+			$this->findAll();
 
-
-        /**
-         *  This function returns the component version
-         *
-         *  @returns    component version
-         */
-		function getVersion(){
-
-			return $this->_version;
+			return $this->getValues( false, false, false, false );
 		}
 
 
-        /**
-         *  This function returns the component copyright
-         *
-         *  @returns    component copyright
-         */
-		function getCopyright(){
+		function getElementById( $id ){
 
-			return $this->_copyright;
-		}
+			$this->resetAll();
+			$this->set( 'tree_id', $id );
+			$this->findAll();
 
-
-        /**
-         *  This function returns the component description
-         *
-         *  @returns    component description
-         */
-		function getDescription(){
-
-			return $this->_description;
+			return $this->getValues( false, false, false, false );
 		}
 
+		
 
         /**
-         *  This function sets a node state
+         *  This method returns all elements of this table
          *
-         *  @param $state      The state code
-         *  @param $id         (optional) The ID of the node. Defaults to null.
-         *
-         *  @returns    1 if state changed, 0 otherwise
+         *  @returns 	An array with all table elements
          */
-		function setState( $state, $id = null ){
+		function getElements( $content_id = null, $prefix = false ){
 
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
+			$this->resetAll();
+	
+			if ( is_numeric( $content_id ) ){
+				$this->set( 'tree_id', intval( $content_id ) );
+			}
 
-			// check if static
-			if( is_null( $id ) ) $id = $this->_id;
+			$this->findAll();
 
-			return $tree->updateNode( array( 'state' => $state ), $id );
+			return $this->getResults( false, false, false, $prefix );
 		}
 
 
-        /**
-         *  This function deletes the tree part of a component only
-         *
-         */
-		function deleteNode(){
 
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
 
-			return $tree->deleteNode( $this->_id );
-		}
 
-
-        /**
-         *  This function adds a standard node in the tree. Experimental
-         *
-         *  @param $values      Node values
-         *  @param $parent_id   (optional) The parent id for the node. Defaults to null.
-         */
-		function addNode( $values, $parent_id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->addNode( $values, $parent_id );
-		}
-
-
-        /**
-         *  This function updates a node
-         *
-         *  @param $values      Node values
-         *  @param $node_id     (optional) The ID of the node. Defaults to null.
-         */
-		function updateNode( $values, $node_id = null ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->updateNode( $values, $node_id );
-		}
-
-
-        /**
-         *  This function moves a node
-         *
-         *  @param $x  X value
-         *  @param $y  Y value
-         */
-		function moveNode( $x, $y ){
-
-			// init db tree object
-			$tree = YDCMComponent::__getYDDatabaseTree();
-
-			// use YDDatabasetree method
-			return $tree->moveNode( $x, $y );
-		}
-
-
     }
 
 
-?>
\ No newline at end of file
+?>

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMForum.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -338,7 +338,7 @@
 
 
 	// last user login date.
-	YDConfig::set( 'YD_FORUM_LASTLOGINDATE', YDStringUtil::formatDate( time(), 'datetimesql' ), false );
+	YDConfig::set( 'YD_FORUM_LASTLOGINDATE', '1900-01-01 01:01:01', false );
 
 
     class YDCMForum_topics extends YDDatabaseObject {
@@ -445,7 +445,7 @@
          */
 		function getElementsAsRecordSet( $forum_id, $page = 1 ){
 		
-			return new YDRecordSet( $this->getElements( $forum_id ), $page, 20 );
+			return new YDRecordSet( $this->getElements( $forum_id ), $page, 1 );
 		}
 
 

Added: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGuestbook.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGuestbook.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMGuestbook.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -0,0 +1,173 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.0
+        (c) Copyright 2002-2005 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+	// include YDF libs
+    YDInclude( 'YDCMComponent.php' );
+
+
+    class YDCMGuestbook extends YDCMComponent{
+    
+        function YDCMGuestbook() {
+
+			// init parent
+            $this->YDCMComponent( 'YDCMGuestbook' );
+
+            // define fields
+			$this->registerField( 'guestbook_datecreation',  false );
+			$this->registerField( 'guestbook_description',   false, 'text',     _('Description') );
+			$this->registerField( 'guestbook_email_notify',  false, 'checkbox', _('Notify by email on new posts') );
+			$this->registerField( 'guestbook_email_from',    false, 'text',     _('Email from') );
+			$this->registerField( 'guestbook_email_subject', false, 'text',     _('Email subject') );
+			$this->registerField( 'guestbook_max_words',     false, 'text',     _('Maximum words') );
+			$this->registerField( 'guestbook_max_lines',     false, 'text',     _('Maximum lines') );
+			$this->registerField( 'guestbook_max_chars',     false, 'text',     _('Maximum caracters') );
+
+			$this->registerField( 'guestbook_use_name',          false, 'checkbox', _('Show name') );
+			$this->registerField( 'guestbook_use_email',         false, 'checkbox', _('Show email') );
+			$this->registerField( 'guestbook_use_website',       false, 'checkbox', _('Show website') );
+			$this->registerField( 'guestbook_use_country',       false, 'checkbox', _('Show country') );
+			$this->registerField( 'guestbook_use_websiterating', false, 'checkbox', _('Show website ranking') );
+
+			$this->registerField( 'guestbook_akismet',   false, 'checkbox', _('Use akismet engine') );
+			$this->registerField( 'guestbook_moderated', false, 'checkbox', _('Posts are moderated') );
+		}
+
+/*		
+		function getLatest(){
+		
+			$this->resetAll();
+	
+			$this->limit( 5 );
+			$this->findAll();
+
+			return $this->getResults( false, false, false, false );
+
+		}
+
+
+		function getElementsAsRecordSet( $id, $rows = 5 ){
+
+			$page = isset( $_GET['page'] ) ? intval( $_GET['page'] ) : 1;
+
+			return new YDRecordSet( $this->getElements( $id ), $page, $rows );
+		}
+*/
+
+		function getPostsAsRecordSet( $tree_id, $rows = 1 ){
+		
+			$posts = new YDCMGuestbook_posts();
+
+			return $posts->getElementsAsRecordSet( $tree_id, $rows );
+		}
+
+
+		function getPostForm( $tree_id ){
+		
+			// init posts object
+			$posts = new YDCMGuestbook_posts();
+			
+			// get the standard form without title and node elements
+			$form = & $posts->getForm( false, false );
+		
+			// get guestbook configuration
+			$gbook = $this->getElementById( $tree_id );
+
+			// remove fields
+			if ( $gbook[ 'guestbook_use_name' ] == 0 )          $form->removeElement( 'post_name' );
+			if ( $gbook[ 'guestbook_use_email' ] == 0 )         $form->removeElement( 'post_email' );
+			if ( $gbook[ 'guestbook_use_website' ] == 0 )       $form->removeElement( 'post_website' );
+			if ( $gbook[ 'guestbook_use_country' ] == 0 )       $form->removeElement( 'post_country' );
+			if ( $gbook[ 'guestbook_use_websiterating' ] == 0 ) $form->removeElement( 'post_websiterating' );
+
+			// delete 'active' element. this is for administration only
+			$form->removeElement( 'post_active' );
+
+			// add captcha element
+			$form->addElement( 'captcha', 'secur', _('Security code') );
+
+			// add send button
+			$form->addElement( 'button', 'send', _('Send') );
+
+			// set default
+			$form->setDefault( 'post_website', 'http://' );
+
+			return $form;
+		}
+    }
+
+
+
+
+    class YDCMGuestbook_posts extends YDCMComponent{
+    
+        function YDCMGuestbook_posts() {
+
+			// init parent
+            $this->YDCMComponent( 'YDCMGuestbook_posts' );
+
+            // define custom key
+			$this->registerKey( 'post_id', false );
+
+            // define fields
+			$this->registerField( 'post_name',          false, 'text',     _('Name') );
+			$this->registerField( 'post_email',         false, 'text',     _('Email') );
+			$this->registerField( 'post_message',       false, 'bbtextarea', _('Message') );
+			$this->registerField( 'post_active',        false, 'checkbox', _('Active') );
+			$this->registerField( 'post_website',       false, 'text',     _('Website') );
+			$this->registerField( 'post_ip',            false );
+			$this->registerField( 'post_country',       false, 'select',   _('Country') );
+			$this->registerField( 'post_websiterating', false, 'select',   _('Website rating') );
+		}
+
+		
+		function getLatest(){
+		
+			$this->resetAll();
+	
+			$this->limit( 5 );
+			$this->findAll();
+
+			return $this->getResults( false, false, false, false );
+
+		}
+
+
+		function getElementsAsRecordSet( $id, $rows ){
+
+			$page = isset( $_GET['page'] ) ? intval( $_GET['page'] ) : 1;
+
+			return new YDRecordSet( $this->getElements( $id ), $page, $rows );
+		}
+
+    }
+
+
+
+
+
+?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMLink.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,76 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-	YDInclude( 'YDCMComponent.php' );
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMLink extends YDCMComponent {
-    
-        function YDCMLink() {
-        
-			// init component
-            $this->YDCMComponent( 'YDCMLink' );
-
-            $this->_author = 'Francisco Azevedo';
-            $this->_version = '0.1';
-            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
-            $this->_description = 'This is a link component';
-
-			// register custom fields
-			$this->registerField( 'url' );
-			$this->registerField( 'num_visits' );
-
-			// we don't have custom relations
-		}
-
-
-        /**
-         *  This function will render this element (to be used in a menu)
-         *
-         *  @returns    Html link
-         */
-		function render( $component, & $url ){
-
-			$url->setQueryVar( 'component', $component[ 'type' ] );
-			$url->setQueryVar( 'id',        $component[ 'content_id' ] );
-
-			// get url properties from DB
-			$this->getNode( $component[ 'content_id' ] );
-
-			return '<a href="' . $this->url . '">' . $component[ 'title' ] . '</a>';
-		}
-
-
-    }
-?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMPage.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -30,49 +30,103 @@
         die( 'Yellow Duck Framework is not loaded.' );
     }
 
-	YDInclude( 'YDCMComponent.php' );
+//	YDInclude( 'YDCMComponent.php' );
 
+	// include YDF libs
+    YDInclude( 'YDCMComponent.php' );
+//    YDInclude( 'YDCMTree.php' );
+
 	// add local translation directory
-	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/' );
+//	YDLocale::addDirectory( dirname( __FILE__ ) . '/languages/YDCMPage/' );
 
 	// set page form name
-	YDConfig::set( 'YDCMPAGE_FORMPAGE', 'YDCMPageForm', false );
+//	YDConfig::set( 'YDCMPAGE_FORMPAGE', 'YDCMPageForm', false );
 
     /**
      *  @ingroup YDCMComponent
      */
-    class YDCMPage extends YDCMComponent {
+    class YDCMPage extends YDCMComponent{
     
-        function YDCMPage( $id = null ) {
+        function YDCMPage() {
 
-			// init component
-            $this->YDCMComponent( 'YDCMPage', $id );
+			// init DB object
+            $this->YDCMComponent( 'YDCMPage' );
 
+/*            $this->_author = 'unknown author';
+            $this->_version = 'unknown version';
+            $this->_copyright = 'no copyright';
+            $this->_description = 'no description';
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMPage' );
+
             $this->_author = 'Francisco Azevedo';
             $this->_version = '0.1';
             $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
             $this->_description = 'This is a page component';
-
+*/
             // define custom fields
-			$this->registerField( 'current_version' );
-			$this->registerField( 'html' );
-			$this->registerField( 'xhtml' );
-			$this->registerField( 'template_pack' );
-			$this->registerField( 'template' );
-			$this->registerField( 'metatags' );			
-			$this->registerField( 'description' );
-			$this->registerField( 'keywords' );			
+//			$this->registerKey( 'component_id', false );
+//			$this->registerField( 'current_version' );
+			$this->registerField( 'page_html',        false, 'textarea', _('ydcmuser label html'),        array( 'cols' => 50, 'rows' => 5 ) );
+//			$this->registerField( 'xhtml' );
+//			$this->registerField( 'template_pack' );
+			$this->registerField( 'page_template',    false, 'select',   _('ydcmuser label template') );
+			$this->registerField( 'page_metatags',    false, 'select',   _('ydcmuser label metatags'),    array(), array( 0 => _('no'), 1 => _('yes') ) );
+			$this->registerField( 'page_description', false, 'textarea', _('ydcmuser label description'), array( 'cols' => 50, 'rows' => 5 ) );
+			$this->registerField( 'page_keywords',    false, 'textarea', _('ydcmuser label keywords'),    array( 'cols' => 50, 'rows' => 5 ) );
 
-			// we don't have custom relations
+/*
+
+	        $form->addElement( 'text',           'reference',            t('ydcmuser label reference'),      array('size' => 25, 'maxlength' => 35) );
+	        $form->addElement( 'text',           'title',                t('ydcmuser label title'),          array('size' => 70, 'maxlength' => 70) );
+	        $form->addElement( 'textarea',       'content',              t('ydcmuser label content') );
+	        $form->addElement( 'select',         'access',               t('ydcmuser label access'),         array(), $access);
+	        $form->addElement( 'select',         'state',                t('ydcmuser label state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+	        $form->addElement( 'datetimeselect', 'published_date_start', t('ydcmuser label published_date_start') );
+	        $form->addElement( 'datetimeselect', 'published_date_end',   t('ydcmuser label published_date_end'));
+	        $form->addElement( 'select',         'template',             t('ydcmuser label template'),       array(), $templates->visitors_templates());
+	        $form->addElement( 'select',         'metatags',             t('ydcmuser label metatags'),       array(), array( 0 => t('no'), 1 => t('yes') ) );
+	        $form->addElement( 'textarea',       'description',          t('ydcmuser label description'),    array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'textarea',       'keywords',             t('ydcmuser label keywords'),       array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'select',         'searcheable',          t('ydcmuser label searcheable'),         array(), array( 0 => t('no'), 1 => t('yes') ) );
+*/
+
+
+			// virtual relation with ydcmcomp
+/*       		$rel = & $this->registerRelation( 'ydcmcomp', false, 'ydcmcomp' );
+			$rel->setLocalKey( 'ydcmpage.component_id' );
+			$rel->setForeignKey( 'ydcmcomp.component_id' );
+
+			// virtual relation with ydcmtree
+       		$rel = & $this->registerRelation( 'ydcmtree', false, 'ydcmtree' );
+			$rel->setLocalKey( 'ydcmpage.component_id' );
+			$rel->setForeignKey( 'ydcmtree.content_id' );
+*/
 		}
 
 		
+/*
+		function getElement( $id ){
+
+			$this->reset();
+			$this->load( 'ydcmcomp' );
+			$this->ydcmcomp->set( 'reference', $id );
+//			$this->set( 'component_id', intval( $id ) );
+			$this->findAll();
+			return $this->getValues( false, false, false, false );
+		}
+*/
+
         /**
          *  This function will render this element (to be used in a menu)
          *
          *  @returns    Html link
          */
-		function render( $component, & $url ){
+/*		function render( $component, & $url ){
 
 			$url->setQueryVar( 'component', $component[ 'type' ] );
 			$url->setQueryVar( 'id',        $component[ 'content_id' ] );
@@ -80,19 +134,26 @@
 			return '<a href="' . $url->getUrl() . '">' . $component[ 'title' ] . '</a>';
 		}
 
+		function renderContent( $id ){
+		
+			$element = $this->getElement( $id );
+		
+			return $element[ 'html' ];
+		}
+*/
 
         /**
          *  This function returns the page form (form admin edition)
          *
          *  @returns    YDForm object
          */
-		function getFormPage(){
+		function _getForm(){
 
 			YDInclude( 'YDForm.php' );
 
 			// get template and language object
-			$templates = YDCMComponent::module( 'YDCMTemplates' );
-			$languages = YDCMComponent::module( 'YDCMLanguages' );
+			$templates = new YDCMTemplates();
+			$languages = new YDCMLanguages();
 
 			// create access options
 			$access = array( 0 => t('public'), 1 => t('private') );
@@ -102,29 +163,22 @@
 									0	=> t('use custom template') );
 	
 			// create form object
-			$form = new YDForm( YDConfig::get( 'YDCMPAGE_FORMPAGE' ) );
+			$form = new YDForm( 'page' );
 
-	        $form->addElement( 'text',           'reference',            t('page_reference'),      array('size' => 25, 'maxlength' => 35) );
-	        $form->addElement( 'text',           'title',                t('page_title'),          array('size' => 70, 'maxlength' => 70) );
-	        $form->addElement( 'textarea',       'html',                 t('page_html') );
-	        $form->addElement( 'textarea',       'xhtml',                t('page_xhtml') );
-	        $form->addElement( 'select',         'access',               t('page_access'),         array(), $access);
-	        $form->addElement( 'select',         'state',                t('page_state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-	        $form->addElement( 'datetimeselect', 'published_date_start', t('page_startdate') );
-	        $form->addElement( 'datetimeselect', 'published_date_end',   t('page_enddate'));
-	        $form->addElement( 'select',         'template_pack',        '',                       array(), $template_pack );
-	        $form->addElement( 'select',         'template',             t('page_template'),       array(), $templates->visitors_templates());
-	        $form->addElement( 'select',         'metatags',             t('page_metatags'),       array(), array( 0 => t('no'), 1 => t('yes') ) );
-	        $form->addElement( 'textarea',       'description',          t('page_description'),    array( 'cols' => 50, 'rows' => 5 ) );
-	        $form->addElement( 'textarea',       'keywords',             t('page_keywords'),       array( 'cols' => 50, 'rows' => 5 ) );
-	        $form->addElement( 'select',         'searcheable',          t('page_search'),         array(), array( 0 => t('no'), 1 => t('yes') ) );
-	        $form->addElement( 'hidden',         'content_id' );
-	        $form->addElement( 'hidden',         'parent_id' );
-	        $form->addElement( 'hidden',         'language_id' );
+	        $form->addElement( 'text',           'reference',            t('ydcmuser label reference'),      array('size' => 25, 'maxlength' => 35) );
+	        $form->addElement( 'text',           'title',                t('ydcmuser label title'),          array('size' => 70, 'maxlength' => 70) );
+	        $form->addElement( 'textarea',       'content',              t('ydcmuser label content') );
+	        $form->addElement( 'select',         'access',               t('ydcmuser label access'),         array(), $access);
+	        $form->addElement( 'select',         'state',                t('ydcmuser label state'),          array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
+	        $form->addElement( 'datetimeselect', 'published_date_start', t('ydcmuser label published_date_start') );
+	        $form->addElement( 'datetimeselect', 'published_date_end',   t('ydcmuser label published_date_end'));
+	        $form->addElement( 'select',         'template',             t('ydcmuser label template'),       array(), $templates->visitors_templates());
+	        $form->addElement( 'select',         'metatags',             t('ydcmuser label metatags'),       array(), array( 0 => t('no'), 1 => t('yes') ) );
+	        $form->addElement( 'textarea',       'description',          t('ydcmuser label description'),    array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'textarea',       'keywords',             t('ydcmuser label keywords'),       array( 'cols' => 50, 'rows' => 5 ) );
+	        $form->addElement( 'select',         'searcheable',          t('ydcmuser label searcheable'),         array(), array( 0 => t('no'), 1 => t('yes') ) );
 
 			// parent of new page is 0 by default
-			$form->setDefault( 'content_id',  0 );
-			$form->setDefault( 'parent_id',   0 );
 			$form->setDefault( 'language_id', $languages->adminDefault() );
 
 			// add form rules

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMRootmenu.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,57 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-	YDInclude( 'YDCMComponent.php' );
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMRootmenu extends YDCMComponent {
-    
-        function YDCMRootmenu( $id = null ) {
-        
-			// init component
-            $this->YDCMComponent( 'YDCMRootmenu', $id );
-
-            $this->_author = 'Francisco Azevedo';
-            $this->_version = '0.1';
-            $this->_copyright = '(c) Copyright 2006 Francisco Azevedo';
-            $this->_description = 'This is a menu component';
-
-			// register custom fields
-			$this->registerField( 'title' );
-
-			// we don't have custom relations
-		}
-
-    }
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,117 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMStatistics {
-
-        function YDCMStatistics() {
-		}
-		
-
-        /**
-         *  This static function returns php informations
-         *
-         *  @returns    an array with php info
-         */
-		function php(){
-		
-            // Get the general PHP info
-            ob_start();
-            phpinfo( INFO_GENERAL );
-            $phpInfo .= ob_get_contents();
-            ob_end_clean();
-
-            // Get the right part
-            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
-            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
-
-            // Strip unneeded things
-            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
-            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
-            $phpInfo = trim( $phpInfo );
-
-            // Get the settings
-            $settings = array();
-            foreach ( explode( "\n", $phpInfo ) as $line ) {
-                $line = explode( ' </td><td class="v">', $line );
-                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
-                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
-            }
-
-			// export other values
-			$settings[ 'version' ]     = phpversion();
-			$settings[ 'modules' ]     = implode( get_loaded_extensions(), ', ' );
-			$settings[ 'os' ]          = PHP_OS;
-			$settings[ 'includePath' ] = $GLOBALS['YD_INCLUDE_PATH'];
-
-			return $settings;
-		}
-
-
-        /**
-         *  This static function returns the mail info
-         *
-         *  @returns    an array with mail info
-         */
-		function mailer(){
-
-		    // Includes
-		    require_once( dirname( __FILE__ ) . '/../3rdparty/phpmailer/class.phpmailer.php' );
-
-            // Get the version of phpMailer
-            $PHPMailer = new PHPMailer();
-
-			return array( 'version' => $PHPMailer->Version, 'complete' => 'PHPMailer [version ' . $PHPMailer->Version . ']' );
-		}
-
-
-        /**
-         *  This static function returns an YDCMStatistics module
-         *
-         *  @returns    an module object
-         */
-		function module( $name ){
-
-			// include lib
-			// TODO: check if name is a valid lib name
-			require_once( YDConfig::get( 'YD_DBOBJECT_PATH' ) . '/' . $name . '.php' );
-
-			// return class
-			return new $name();
-		}
-
-
-    }
-
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_system.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,94 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMStatistics_system {
-    
-        function YDCMStatistics_system() {
-		}
-
-
-		function getPHPInfo(){
-
-            // Get the general PHP info
-            ob_start();
-            phpinfo( INFO_GENERAL );
-            $phpInfo .= ob_get_contents();
-            ob_end_clean();
-
-            // Get the right part
-            $phpInfo = substr( $phpInfo, strpos( $phpInfo, '<tr>' ) );
-            $phpInfo = substr( $phpInfo, 0, strpos( $phpInfo, '</table>' ) );
-
-            // Strip unneeded things
-            $phpInfo = str_replace( '<tr><td class="e">', '', $phpInfo );
-            $phpInfo = str_replace( ' </td></tr>', '', $phpInfo );
-            $phpInfo = trim( $phpInfo );
-
-            // Get the settings
-            $settings = array();
-            foreach ( explode( "\n", $phpInfo ) as $line ) {
-                $line = explode( ' </td><td class="v">', $line );
-
-                if ( isset( $line[1] ) ) $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = $line[1];
-                else                     $settings[ strtolower( str_replace( ' ', '_', $line[0] ) ) ] = '';
-			}
-			
-			$settings[ 'version']  = phpversion();
-			$settings[ 'modules' ] = implode( get_loaded_extensions(), ', ' );
-			
-			ksort( $settings );
-			
-			return $settings;
-		}
-
-
-
-		function getMailInfo(){
-
-			// Includes
-			YDInclude( 'phpmailer/class.phpmailer.php' );
-		
-			$p = new PHPMailer();
-			
-			$settings = array( 'system' => 'PHPMailer',
-							   'version' => $p->Version );
-
-			ksort( $settings );
-			
-			return $settings;
-		}
-
-    }
-?>
\ No newline at end of file

Deleted: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMStatistics_visits.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -1,62 +0,0 @@
-<?php
-
-    /*
-
-        Yellow Duck Framework version 2.1
-        (c) Copyright 2002-2007 Pieter Claerhout
-
-        This library is free software; you can redistribute it and/or
-        modify it under the terms of the GNU Lesser General Public
-        License as published by the Free Software Foundation; either
-        version 2.1 of the License, or (at your option) any later version.
-
-        This library is distributed in the hope that it will be useful,
-        but WITHOUT ANY WARRANTY; without even the implied warranty of
-        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
-        Lesser General Public License for more details.
-
-        You should have received a copy of the GNU Lesser General Public
-        License along with this library; if not, write to the Free Software
-        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
-
-    */
-
-    /*
-     *  @addtogroup YDCMComponent Addons - CMComponent
-     */
-
-    // Check if the framework is loaded
-    if ( ! defined( 'YD_FW_NAME' ) ) {
-        die( 'Yellow Duck Framework is not loaded.' );
-    }
-
-    /**
-     *  @ingroup YDCMComponent
-     */
-    class YDCMStatistics_visits extends YDDatabaseObject {
-    
-        function YDCMStatistics_visits() {
-        
-			// init database object
-            $this->YDDatabaseObject();
-			
-			// register database as default
-            $this->registerDatabase();
-
-			// register table for this component
-            $this->registerTable( 'YDCMStatistics_visits' );
-
-            // register custom key
-            $this->registerKey( 'visit_id', true );
-
-            // register custom fields
-			$this->registerField( 'date' );
-			$this->registerField( 'browser' );
-			$this->registerField( 'platform' );
-			$this->registerField( 'url' );
-			$this->registerField( 'hits' );
-		}
-
-
-    }
-?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMTree.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -32,41 +32,84 @@
 
 
 	// add YD libs
-	YDInclude( 'YDDatabaseTree3.php' );
+	YDInclude( 'YDDatabaseObjectTree.php' );
 
     /**
      *  @ingroup YDCMComponent
      */
-    class YDCMTree extends YDDatabaseTree3 {
+    class YDCMTree extends YDDatabaseObjectTree {
     
         function YDCMTree() {
 
 			// init parent object
-			$this->YDDatabaseTree3( 'YDCMTree', 'default', 'content_id', 'parent_id', 'lineage', 'level', 'position' );
+			$this->YDDatabaseObjectTree( 'YDCMTree', 'default', 'tree_id', 'tree_parent_id', 'tree_lineage', 'tree_level', 'tree_position' );
 
-			// add custom tree fields
-			$this->registerField( 'type' );
-			$this->registerField( 'state' );
-			$this->registerField( 'reference' );
-			$this->registerField( 'access' );			
-			$this->registerField( 'searcheable' );			
-			$this->registerField( 'published_date_start' );
-			$this->registerField( 'published_date_end' );			
-			$this->registerField( 'candrag' );
-			$this->registerField( 'candrop' );
+			// add tree fields
+			$this->registerField( 'tree_type' );
+			$this->registerField( 'tree_access' );			
+			$this->registerField( 'tree_state' );
+			$this->registerField( 'tree_searcheable' );			
+			$this->registerField( 'tree_published_datestart' );
+			$this->registerField( 'tree_published_dateend' );			
+			$this->registerField( 'tree_candrag' );
+			$this->registerField( 'tree_candrop' );
+			$this->registerField( 'tree_inline' );
+			$this->registerField( 'tree_url' );
+			$this->registerField( 'tree_urltarget' );
 
-			// define tree order
-			$this->order( 'parent_id ASC, position ASC' );
+			// set relation with names table
+       		$rel = & $this->registerRelation( 'ydcmtree_titles', false, 'ydcmtree_titles' );
+			$rel->setLocalKey( 'ydcmtree.tree_id' );
+			$rel->setForeignKey( 'ydcmtree_titles.tree_id' );
+
+			// init language code to be the current locale code	
+			$this->setLanguage( null );
 		}
 
 
         /**
+         *  This reset overides the parent resetAll() because we must redefine the language code deleted by parent reset()
+         */
+		function resetAll(){
+		
+			// resets object stuff
+			parent::resetAll();
+
+			// apply the language code deleted in previous parent reset
+			$this->where( 'ydcmtree_titles.language_id = ' . $this->escapeSQL( $this->_language_id ) );
+		}
+		
+
+        /**
+         *  This method defines the language code to use in all sql queries
+         *
+         *  @param $language_id  (Optional) Language id code, eg 'en'. By default current locale is used
+         */
+		function setLanguage( $language_id = null ){
+		
+			if ( ! is_string( $language_id ) ) $this->_language_id = YDLocale::get();
+			else                               $this->_language_id = $language_id;
+		}
+
+
+		function getSubElements( $id, $inline = false ){
+
+			$this->resetAll();
+
+			if ( $inline ) $this->where( $this->getTable() . '.tree_inline = 1' );
+			else           $this->where( $this->getTable() . '.tree_inline = 0' );
+
+			return $this->_getChildren( $id, false, false );
+		}
+
+
+        /**
          *  This function checks if elements are valid drag&dropable
          *
          *  @param $x  Id of dragable node
          *
          *  @param $y  Id of dropable node
-
+         *
          *  @returns    false if elements are invalid, an associative array with node information
          */
 		function getDragDropElements( $x = null, $y = null){
@@ -91,4 +134,28 @@
 
 	}
 
+
+    class YDCMTree_titles extends YDDatabaseObject {
+    
+        function YDCMTree_titles() {
+        
+			// init component as non default
+            $this->YDDatabaseObject();
+			
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMTree_titles' );
+
+            // register key
+            $this->registerKey( 'tree_id', true );
+			$this->registerKey( 'language_id', false );
+
+			// register fields	
+			$this->registerField( 'title_html' );
+			$this->registerField( 'title_reference' );
+		}
+	}
+
 ?>
\ No newline at end of file

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUser.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -39,6 +39,9 @@
 
 	YDConfig::set( 'YDCMTEMPLATES_ADMIN_EXT', '/shot.png', false );
 
+	// set user logged and user details
+	YDConfig::set( 'YD_USER_LOGGED',  false,   false );
+
 	// add YDF libs needed by this class
 	YDInclude( 'YDDatabaseObject.php' );
 	YDInclude( 'YDValidateRules.php' );
@@ -50,6 +53,13 @@
 	YDInclude( 'YDCMTemplates.php' );
 	YDInclude( 'YDCMUserobject.php' );
 
+	// define forum levels
+	define( 'YD_FORUM_PERMISSION_1', 'Registered' );
+	define( 'YD_FORUM_PERMISSION_2', 'Moderator' );
+	define( 'YD_FORUM_PERMISSION_3', 'Administrator' );
+
+
+	// user class
     /**
      *  @ingroup YDCMComponent
      */
@@ -67,29 +77,52 @@
             $this->registerTable( 'YDCMUser' );
 
 			// register fields
-			$this->registerField( 'user_id' );
-			$this->registerField( 'username' );
-			$this->registerField( 'password' );
-			$this->registerField( 'name' );
-			$this->registerField( 'email' );			
-			$this->registerField( 'other' );	
-			$this->registerField( 'lang_id' );
-			$this->registerField( 'login_start' );
-			$this->registerField( 'login_end' );
-			$this->registerField( 'login_counter' );			
-			$this->registerField( 'login_last' );
-			$this->registerField( 'login_current' );
-			$this->registerField( 'template' );
+			$this->registerKey( 'userobject_id' );
+			$this->registerKey( 'language_id', false );
 
+			$this->registerField( 'user_username' );
+			$this->registerField( 'user_password' );
+			$this->registerField( 'user_name' );
+			$this->registerField( 'user_email' );			
+			$this->registerField( 'user_other' );	
+			$this->registerField( 'user_loginstart' );
+			$this->registerField( 'user_loginend' );
+			$this->registerField( 'user_logincounter' );			
+			$this->registerField( 'user_loginlast' );
+			$this->registerField( 'user_logincurrent' );
+			$this->registerField( 'user_template' );
+			$this->registerField( 'user_creationdate' );
+			$this->registerField( 'user_refreshdate' );
+			$this->registerField( 'user_country' );
+			$this->registerField( 'user_interests' );
+			$this->registerField( 'user_bio' );
+			$this->registerField( 'user_photo' );
+			$this->registerField( 'user_birthdate' );
+			$this->registerField( 'user_website' );
+			$this->registerField( 'user_im_icq' );
+			$this->registerField( 'user_im_msn' );
+			$this->registerField( 'user_im_yahoo' );
+			$this->registerField( 'user_im_aol' );
+
+			// forum extra fields
+			$this->registerField( 'user_forum_permission' );
+			$this->registerField( 'user_forum_signature' );
+			$this->registerField( 'user_forum_totalposts' );
+			$this->registerField( 'user_forum_totaltopics' );
+			$this->registerField( 'user_forum_avatar' );
+
 			// init relation with userobject
             $rel = & $this->registerRelation( 'ydcmuserobject', false, 'ydcmuserobject' );
-			$rel->setLocalKey( 'user_id' );
-            $rel->setForeignKey( 'userobject_id' );
+			$rel->setLocalKey( 'ydcmuser.userobject_id' );
+            $rel->setForeignKey( 'ydcmuserobject.userobject_id' );
 
 			// init relation with languages table
             $rel = & $this->registerRelation( 'ydcmlanguages', false, 'ydcmlanguages' );
-			$rel->setLocalKey( 'lang_id' );
-            $rel->setForeignKey( 'language_id' );
+			$rel->setLocalKey( 'ydcmuser.language_id' );
+            $rel->setForeignKey( 'ydcmlanguages.language_id' );
+
+			// init results cache
+			$this->_cache_activeusers = null;
 		}
 
 
@@ -101,7 +134,7 @@
          *
          *  @returns    ARRAY with user attributes, FALSE otherwise
          */
-		function valid( $username = '', $password = '' ){
+		function valid( $username = '', $password = '', $force_md5 = false ){
 
 			// test username and password
 			if ( !YDValidateRules::alphanumeric( $username ) )   return false;
@@ -113,20 +146,20 @@
 			$this->resetAll();
 
 			// set username
-			$this->set( 'username', $username );
+			$this->set( 'user_username', $username );
 
 			// if password is not in md5 format we must set it
-			if ( strlen( $password ) != 32 ) $password = md5( $password );
+			if ( $force_md5 ) $password = md5( $password );
 
 			// set password
-			$this->set( 'password', $password );
-			
+			$this->set( 'user_password', $password );
+
 			// check user state based on state and/or user login schedule
 			$now = YDStringUtil::formatDate( time(), 'datetimesql' );
 
 			// relation with userobject
 			$this->load( 'ydcmuserobject' );
-			$this->where( '(state = 1 OR (state = 2 AND login_start < "' . $now . '" AND login_end > "' . $now . '"))' );
+			$this->where( '(ydcmuserobject.userobject_state = 1 OR (ydcmuserobject.userobject_state = 2 AND ydcmuser.user_loginstart < "' . $now . '" AND ydcmuser.user_loginend > "' . $now . '"))' );
 
 			// test if we get just one user
 			if ( $this->find( 'ydcmuserobject' ) != 1 ) return false;
@@ -138,19 +171,19 @@
         /**
          *  This method checks if a user ID is valid ( will check if user_id is on its 3 tables )
          *
-         *  @param $user_id        User id
+         *  @param $userobject_id        User id
          *
          *  @returns    TRUE if valid, FALSE otherwise
          */
-		function validID( $user_id ){
+		function validID( $userobject_id ){
 		
 			// reset values
 			$this->resetAll();
 
 			// find all rows this user id
-			$this->where( 'user_id = ' . intval( $user_id ) );
+			$this->where( 'userobject_id = ' . intval( $userobject_id ) );
 
-			// join all tables when finding (to check if user_id really belongs to all 3 tables)
+			// join all tables when finding (to check if userobject_id really belongs to all 3 tables)
 			return ( $this->findAll() == 1 );
 		}
 
@@ -158,18 +191,18 @@
         /**
          *  This method deletes a user (and all children) or just the children
          *
-         *  @param $user_id       Userobject id
+         *  @param $userobject_id       Userobject id
          *  @param $deleteAll     (Optional) Delete id and all children (true by default. if false, deletes children only)
          *
          *  @returns    YDResult object. OK      - user deleted
 		 *                               WARNING - no deletes where made
          */
-		function deleteUser( $user_id, $deleteAll ){
+		function deleteUser( $userobject_id, $deleteAll ){
 		
 			$obj = new YDCMUserobject();
 			
 			// delete user and get result
-			if ( $obj->deleteNode( $user_id, $deleteAll ) ) return YDResult::ok( t('ydcmuser mess delete ok') );
+			if ( $obj->deleteNode( $userobject_id, $deleteAll ) ) return YDResult::ok( t('ydcmuser mess delete ok') );
 			else                                            return YDResult::fatal( t('ydcmuser mess delete empty') );
 		}
 
@@ -226,65 +259,65 @@
 			if ( !is_array( $noneditable ) ) $noneditable = array( $noneditable );
 
 			// add username
-			if ( in_array( 'username', $noneditable ) ){
-				$this->_form->addElement( 'span', 'username', t( 'ydcmuser label username' ) );
+			if ( in_array( 'user_username', $noneditable ) ){
+				$this->_form->addElement( 'span', 'user_username', t( 'ydcmuser label username' ) );
 			}else{
-				$this->_form->addElement( 'text', 'username', t( 'ydcmuser label username' ) );
+				$this->_form->addElement( 'text', 'user_username', t( 'ydcmuser label username' ) );
 				$this->_form->addFormRule( array( & $this, '_checkuser' ), array( $edit, $id ) );
 			}
 
 			// add password box for new users
 			if ( $edit == false ){
-				$this->_form->addElement( 'password', 'password', t( 'ydcmuser label password' ) );
-				$this->_form->addElement( 'password', 'password2', t( 'ydcmuser label password2' ) );
+				$this->_form->addElement( 'password', 'user_password', t( 'ydcmuser label password' ) );
+				$this->_form->addElement( 'password', 'user_password2', t( 'ydcmuser label password2' ) );
 			}
 
 			// add state
 			if ( in_array( 'state', $noneditable ) ){
 				$this->_form->addElement( 'span',           'state',       t( 'ydcmuser label state' ) );
-				$this->_form->addElement( 'span',           'login_start', t( 'ydcmuser label login_start' ) );
-				$this->_form->addElement( 'span',           'login_end',   t( 'ydcmuser label login_end' ) );
+				$this->_form->addElement( 'span',           'user_loginstart', t( 'ydcmuser label login_start' ) );
+				$this->_form->addElement( 'span',           'user_loginend',   t( 'ydcmuser label login_end' ) );
 			}else{
 				$this->_form->addElement( 'select',         'state',       t( 'ydcmuser label state' ), array(), array(1 => t('yes'), 0 => t('no'), 2 => t('schedule')) );
-				$this->_form->addElement( 'datetimeselect', 'login_start', t( 'ydcmuser label login_start' ) );
-				$this->_form->addElement( 'datetimeselect', 'login_end',   t( 'ydcmuser label login_end' ) );
+				$this->_form->addElement( 'datetimeselect', 'user_loginstart', t( 'ydcmuser label login_start' ) );
+				$this->_form->addElement( 'datetimeselect', 'user_loginend',   t( 'ydcmuser label login_end' ) );
 			}
 
 			// add common user details
 			if ( in_array( 'details', $noneditable ) ){
-				$this->_form->addElement( 'span',      'name',          t( 'ydcmuser label name' ) );
-				$this->_form->addElement( 'span',      'email',         t( 'ydcmuser label email' ) );
-				$this->_form->addElement( 'span',      'other',         t( 'ydcmuser label other' ) );
-				$this->_form->addElement( 'span',      'lang_id',       t( 'ydcmuser label language' ) );
-				$this->_form->addElement( 'span',      'template',      t( 'ydcmuser label template' ) );
+				$this->_form->addElement( 'span',      'user_name',          t( 'ydcmuser label name' ) );
+				$this->_form->addElement( 'span',      'user_email',         t( 'ydcmuser label email' ) );
+				$this->_form->addElement( 'span',      'user_other',         t( 'ydcmuser label other' ) );
+				$this->_form->addElement( 'span',      'user_language_id',       t( 'ydcmuser label language' ) );
+				$this->_form->addElement( 'span',      'user_template',      t( 'ydcmuser label template' ) );
 			}else{
-				$this->_form->addElement( 'text',      'name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
-				$this->_form->addElement( 'text',      'email',         t( 'ydcmuser label email' ) );
-				$this->_form->addElement( 'textarea',  'other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 40) );
+				$this->_form->addElement( 'text',      'user_name',          t( 'ydcmuser label name' ),     array('size' => 50, 'maxlength' => 255) );
+				$this->_form->addElement( 'text',      'user_email',         t( 'ydcmuser label email' ) );
+				$this->_form->addElement( 'textarea',  'user_other',         t( 'ydcmuser label other' ),    array('rows' => 15, 'cols' => 40) );
 
 				$languages = new YDCMLanguages();
 				$languages = $languages->active();
-				$this->_form->addElement( 'select',    'lang_id',       t( 'ydcmuser label language' ), array(), $languages );
+				$this->_form->addElement( 'select',    'user_language_id',       t( 'ydcmuser label language' ), array(), $languages );
 
 				$templates = YDCMTemplates::getNames();
 
 				// get url to templates and set shot.png as filename
 				$attributes = array( 'border' => 1, 'src' => YDConfig::get( 'YDCMTEMPLATES_ADMIN_URL' ), 'ext' => 	YDConfig::get( 'YDCMTEMPLATES_ADMIN_EXT' ) );
 
-    	        $this->_form->addElement( 'selectimage',    'template', t( 'ydcmuser label template' ), $attributes, $templates );
+    	        $this->_form->addElement( 'selectimage',    'user_template', t( 'ydcmuser label template' ), $attributes, $templates );
 
-				$this->_form->addRule( 'name',        'maxlength',      t( 'ydcmuser mess name too big' ),  255 );
-				$this->_form->addRule( 'email',       'email',          t( 'ydcmuser mess email not valid' ) );
-				$this->_form->addRule( 'other',       'maxlength',      t( 'ydcmuser mess other too big' ), 5000 );
-				$this->_form->addRule( 'language_id', 'in_array',       t( 'ydcmuser mess language not valid' ), array_keys( $languages ) );
-				$this->_form->addRule( 'template',    'in_array',       t( 'ydcmuser mess template not valid' ), array_keys( $templates ) );
+				$this->_form->addRule( 'user_name',        'maxlength',      t( 'ydcmuser mess name too big' ),  255 );
+				$this->_form->addRule( 'user_email',       'email',          t( 'ydcmuser mess email not valid' ) );
+				$this->_form->addRule( 'user_other',       'maxlength',      t( 'ydcmuser mess other too big' ), 5000 );
+				$this->_form->addRule( 'user_language_id', 'in_array',       t( 'ydcmuser mess language not valid' ), array_keys( $languages ) );
+				$this->_form->addRule( 'user_template',    'in_array',       t( 'ydcmuser mess template not valid' ), array_keys( $templates ) );
 			}
 
 			// add access information when editing
 			if ( $edit ) {
-				$this->_form->addElement( 'span', 'login_counter', t( 'ydcmuser label login_counter' ) );
-   	        	$this->_form->addElement( 'span', 'login_last',    t( 'ydcmuser label login_last' ) );
-   	        	$this->_form->addElement( 'span', 'login_current', t( 'ydcmuser label login_current' ) );
+				$this->_form->addElement( 'span', 'user_logincounter', t( 'ydcmuser label login_counter' ) );
+   	        	$this->_form->addElement( 'span', 'user_loginlast',    t( 'ydcmuser label login_last' ) );
+   	        	$this->_form->addElement( 'span', 'user_logincurrent', t( 'ydcmuser label login_current' ) );
 			}
 
 			// if we are editing a user it's a good idea to set form defaults with user node attributes
@@ -310,8 +343,8 @@
 				$this->_form->addElement( 'submit', '_cmdSubmit', t( 'ydcmuser label new' ) );
 
 				// when adding a user, if login_end date exists we setup 7 days interval
-				if ( $this->_form->isElement( 'login_end' ) )
-					$this->_form->setDefault( 'login_end', time() + 7 * 24 * 3600 );
+				if ( $this->_form->isElement( 'user_loginend' ) )
+					$this->_form->setDefault( 'user_loginend', time() + 7 * 24 * 3600 );
 			}
 
 
@@ -325,11 +358,11 @@
 
 			$this->resetAll();
 			
-			$this->set( 'username', $values[ 'username' ] );
+			$this->set( 'user_username', $values[ 'username' ] );
 
 			// check if we are editing. if yes, we should check if the username is already used only by another user than current
 			if ( $options[0] == true )
-				$this->where( 'user_id != ' . intval( $options[1] ) );
+				$this->where( 'userobject_id != ' . intval( $options[1] ) );
 			
 			if ( $this->find() == 0 ) return true;
 			
@@ -391,7 +424,7 @@
 				// create userobject node
 				$userobject = array();
 				$userobject['type']  = 'YDCMUser';
-				if ( isset( $values[ 'name' ] ) )  $userobject['reference'] = $values[ 'name' ];
+				if ( isset( $values[ 'user_name' ] ) )  $userobject['reference'] = $values[ 'user_name' ];
 				if ( isset( $values[ 'state' ] ) ) $userobject['state']     = $values[ 'state' ];
 
 				// update userobject
@@ -400,22 +433,22 @@
 
 				// create user row
 				$user = array();
-				if ( isset( $values[ 'password' ] ) ) $user['password'] = md5( $values[ 'password' ] );
-				if ( isset( $values[ 'username' ] ) ) $user['username'] = $values[ 'username' ];
-				if ( isset( $values[ 'name' ] ) )     $user['name']     = $values[ 'name' ];
-				if ( isset( $values[ 'email' ] ) )    $user['email']    = $values[ 'email' ];
-				if ( isset( $values[ 'other' ] ) )    $user['other']    = $values[ 'other' ];
-				if ( isset( $values[ 'lang_id' ] ) )  $user['lang_id']  = $values[ 'lang_id' ];
-				if ( isset( $values[ 'template' ] ) ) $user['template'] = $values[ 'template' ];
+				if ( isset( $values[ 'user_password' ] ) ) $user['user_password'] = md5( $values[ 'user_password' ] );
+				if ( isset( $values[ 'user_username' ] ) ) $user['user_username'] = $values[ 'user_username' ];
+				if ( isset( $values[ 'user_name' ] ) )     $user['user_name']     = $values[ 'user_name' ];
+				if ( isset( $values[ 'user_email' ] ) )    $user['user_email']    = $values[ 'user_email' ];
+				if ( isset( $values[ 'user_other' ] ) )    $user['user_other']    = $values[ 'user_other' ];
+				if ( isset( $values[ 'user_language_id' ] ) )  $user['user_language_id']  = $values[ 'user_language_id' ];
+				if ( isset( $values[ 'user_template' ] ) ) $user['user_template'] = $values[ 'user_template' ];
 
 				// check login schedule dates
-				if ( isset( $user['login_start'] ) ) $user[ 'login_start' ] = YDStringUtil::formatDate( $values[ 'login_start' ], 'datetimesql' );
-				if ( isset( $user['login_end'] ) )   $user[ 'login_end' ]   = YDStringUtil::formatDate( $values[ 'login_end' ], 'datetimesql' );
+				if ( isset( $user['user_loginstart'] ) ) $user[ 'user_loginstart' ] = YDStringUtil::formatDate( $values[ 'user_loginstart' ], 'datetimesql' );
+				if ( isset( $user['user_loginend'] ) )   $user[ 'user_loginend' ]   = YDStringUtil::formatDate( $values[ 'user_loginend' ], 'datetimesql' );
 
 				// update user
 				$this->resetValues();
 				$this->setValues( $user );
-				$this->where( 'user_id = '. $id ); 
+				$this->where( 'userobject_id = '. $id ); 
 
 				$res = $this->update();
 				
@@ -442,20 +475,20 @@
 				$user = array();
 
 				// add REQUIRED values
-				$user[ 'user_id' ]       = $res;
-				$user[ 'password' ]      = md5( $values[ 'password' ] );
-				$user[ 'username' ]      = $values[ 'username' ];
-				$user[ 'lang_id' ]       = $values[ 'lang_id' ];
-				$user[ 'template' ]      = $values[ 'template' ];
+				$user[ 'userobject_id' ]       = $res;
+				$user[ 'user_password' ]      = md5( $values[ 'user_password' ] );
+				$user[ 'user_username' ]      = $values[ 'user_username' ];
+				$user[ 'user_language_id' ]       = $values[ 'user_language_id' ];
+				$user[ 'user_template' ]      = $values[ 'user_template' ];
 
-				$user[ 'name' ]          = isset( $values[ 'name' ] )  ? $values[ 'name' ]  : '';
-				$user[ 'email' ]         = isset( $values[ 'email' ] ) ? $values[ 'email' ] : '';
-				$user[ 'other' ]         = isset( $values[ 'other' ] ) ? $values[ 'other' ] : '';
-				$user[ 'login_counter' ] = 0;
-				$user[ 'login_start' ]   = YDStringUtil::formatDate( 0, 'datetimesql' );
-				$user[ 'login_end' ]     = YDStringUtil::formatDate( 0, 'datetimesql' );
-				$user[ 'login_last' ]    = YDStringUtil::formatDate( 0, 'datetimesql' );
-				$user[ 'login_current' ] = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'user_name' ]          = isset( $values[ 'user_name' ] )  ? $values[ 'user_name' ]  : '';
+				$user[ 'user_email' ]         = isset( $values[ 'user_email' ] ) ? $values[ 'user_email' ] : '';
+				$user[ 'user_other' ]         = isset( $values[ 'user_other' ] ) ? $values[ 'user_other' ] : '';
+				$user[ 'user_logincounter' ] = 0;
+				$user[ 'user_loginstart' ]   = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'user_loginend' ]     = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'user_loginlast' ]    = YDStringUtil::formatDate( 0, 'datetimesql' );
+				$user[ 'user_logincurrent' ] = YDStringUtil::formatDate( 0, 'datetimesql' );
 
 				// reset object
 				$this->resetValues();
@@ -508,14 +541,14 @@
         /**
          *  This function updates a user password
          *
-         *  @param $user_id     User id to update password
+         *  @param $userobject_id     User id to update password
          *  @param $formvalues  (Otional) Custom array with 2 passwords (new and new_confirm)
          *
          *  @returns    YDResult object. OK      - password updated
 		 *                               WARNING - there are form errors
          *                               FATAL   - was not possible to update
          */
-		function saveFormPassword( $user_id, $formvalues = null ){
+		function saveFormPassword( $userobject_id, $formvalues = null ){
 
 			// check form validation
 			if ( !$this->_form->validate( $formvalues ) )
@@ -525,9 +558,9 @@
 			$this->resetAll();
 
 			// set new password
-			$this->set( 'password', md5( $this->_form->getValue( 'new' ) ) );
+			$this->set( 'user_password', md5( $this->_form->getValue( 'new' ) ) );
 
-			$this->where( 'user_id = ' . intval( $user_id ) );
+			$this->where( 'userobject_id = ' . intval( $userobject_id ) );
 
 			// update user and get result
 			if ( $this->update() == 1 ) return YDResult::ok( t('ydcmuser mess password updated') );
@@ -552,26 +585,43 @@
 
 
         /**
+         *  This method returns all user information
+         *  @returns    Array with users
+         */
+		function getUsers(){
+
+			$this->reset();
+			$this->findAll();
+			return $this->getResults();
+		}
+
+
+		function getUsersAsRecordSet( $page = 1 ){
+			return new YDRecordSet( $this->getUsers(), $page, 2 );
+		}
+
+
+        /**
          *  This method returns user attributes
          *
-         *  @param      $user_id     User id or username
+         *  @param      $userobject_id     User id or username
          *  @param      $translate   (Optional) Boolean that defines if result must be translated
          *
          *  @returns    FALSE if user not found, user details array otherwise
          */
-		function getUser( $user_id, $translate = false ){
+		function getUser( $userobject_id, $translate = false ){
 
 			$this->resetAll();
 
 			// set user id to search for
-			if ( is_numeric( $user_id ) ) $this->set( 'user_id',  intval( $user_id ) );
-			else                          $this->set( 'username', strval( $user_id ) );
+			if ( is_numeric( $userobject_id ) ) $this->set( 'userobject_id',  intval( $userobject_id ) );
+			else                          $this->set( 'user_username', strval( $userobject_id ) );
 
 			// get all attributes
 			if ( $this->findAll() != 1 ) return false;
 
 			// password should be NOT visible
-			$this->set( 'password', '' );
+			$this->set( 'user_password', '' );
 
 			// check if we want human readable elements
 			if ( $translate ){
@@ -579,12 +629,12 @@
 				// translate states
 				switch( intval( $this->get( 'ydcmuserobject_state' ) ) ){
 					case 0 : $this->set( 'ydcmuserobject_state', t('blocked') );
-							 $this->set( 'login_start',          t('not applicable') );
-							 $this->set( 'login_end',            t('not applicable') );
+							 $this->set( 'user_loginstart',          t('not applicable') );
+							 $this->set( 'user_loginend',            t('not applicable') );
 							 break;
 					case 1 : $this->set( 'ydcmuserobject_state', t('active') );
-							 $this->set( 'login_start',          t('not applicable') );
-							 $this->set( 'login_end',            t('not applicable') );
+							 $this->set( 'user_loginstart',          t('not applicable') );
+							 $this->set( 'user_loginend',            t('not applicable') );
 							 break;
 					case 2 : $this->set( 'ydcmuserobject_state', t('schedule') );
 							 break;
@@ -599,17 +649,17 @@
         /**
          *  This method returns a specific user attribute
          *
-         *  @param      $user_id     User id to use (instead of internal)
+         *  @param      $userobject_id     User id to use (instead of internal)
          *  @param      $attribute   Attribute name string
          *
          *  @returns    FALSE if attribute not found, attribute string otherwise
          */
-		function getUserAttribute( $user_id, $attribute ){
+		function getUserAttribute( $userobject_id, $attribute ){
 
 			$this->resetValues();
 
 			// set user id
-			$this->set( 'user_id', intval( $user_id ) );
+			$this->set( 'userobject_id', intval( $userobject_id ) );
 
 			// get all attributes
 			if ( $this->find() != 1 ) return false;
@@ -618,32 +668,101 @@
 		}
 
 
+
         /**
+         *  This method returns the newest users created
+         *
+         *  @returns    Array with latest users
+         */
+		function getNewestUsers(){
+
+			$this->reset();
+			
+			$this->limit( 5 );
+			$this->orderby( 'userobject_id DESC' );
+			$this->find();
+			
+			return $this->getResults();
+		}
+
+
+        /**
+         *  This method returns the latest active users
+         *
+         *  @returns    Array with latest users
+         */
+		function getActiveUsers( $minutes = 15, $use_cache = true ){
+
+			if ( $use_cache ){
+
+				if ( is_null( $this->_cache_activeusers ) ) $this->_cache_activeusers = $this->getActiveUsers( $minutes, false );
+
+				return $this->_cache_activeusers;
+			}
+
+			$this->reset();
+			
+			$this->limit( 100 );
+			$this->where( 'user_logincurrent > "' . YDStringUtil::formatDate( time() - 60 * intval( $minutes ), 'datetimesql' ) . '"' );
+			$this->orderby( 'user_logincurrent DESC' );
+			$this->find();
+			
+			return $this->getResults();
+		}
+
+
+        /**
+         *  This method returns the total of latest active users
+         *
+         *  @returns    Total of active users
+         */
+		function getTotalActiveUsers(){
+
+			if ( is_null( $this->_cache_activeusers ) ) $this->_cache_activeusers = $this->getActiveUsers( $minutes, false );
+
+			return count( $this->_cache_activeusers );
+		}
+
+
+        /**
+         *  This method returns the total of users
+         *
+         *  @returns    Total of users
+         */
+		function getTotals(){
+		
+			$this->reset();
+			return $this->_db->getValue( 'SELECT COUNT(*) as total FROM ' . $this->getTable() );
+		}
+
+
+        /**
          *  This function updates current user login details
          *
          *  @returns    true if user login details updated, false if user is not valid or details not updated
          */
-		function updateLogin(){
+		function updateLogin( $userobject_id = null ){
 
 			$this->resetAll();
 			
-			// set our user_id for search
-			$this->set( 'user_id', $this->currentID() );
+			// set our userobject_id for search
+			if ( is_numeric( $userobject_id ) ) $this->set( 'userobject_id', intval( $userobject_id ) );
+			else                          $this->set( 'userobject_id', $this->currentID() );
 
 			// get all attributes
 			$this->find();
 
 			// increase login counter value
-			$this->set( 'login_counter', 1 + $this->get( 'login_counter' ) );
+			$this->set( 'user_logincounter', 1 + $this->get( 'user_logincounter' ) );
 
 			// set last login date
-			$this->set( 'login_last', $this->get( 'login_current' ) );
+			$this->set( 'user_loginlast', $this->get( 'user_logincurrent' ) );
 
 			// set current login
-			$this->set( 'login_current', YDStringUtil::formatDate( time(), 'datetimesql' ) );
+			$this->set( 'user_logincurrent', YDStringUtil::formatDate( time(), 'datetimesql' ) );
 
 			// because we don't have a primary key we must do this
-			$this->where( 'user_id = ' . $this->get( 'user_id' ) );
+			$this->where( 'userobject_id = ' . $this->get( 'userobject_id' ) );
 			
 			// return update result
 			if ( $this->update() == 1 ) return true;
@@ -663,4 +782,79 @@
 
 
     }
-?>
\ No newline at end of file
+
+
+/*
+
+CREATE TABLE YDCMUser_guests (
+   guest_id mediumint(8) UNSIGNED NOT NULL auto_increment,
+   guest_ip varchar(15),
+   guest_date datetime NOT NULL,
+   PRIMARY KEY (guest_id)
+);
+
+INSERT INTO YDCMUser_guests VALUES ( 1, '127.0.0.1', '2006-12-14 22:20' );
+INSERT INTO YDCMUser_guests VALUES ( 2, '127.0.0.2', '2006-12-14 22:20' );
+INSERT INTO YDCMUser_guests VALUES ( 3, '127.0.0.3', '2006-12-14 22:20' );
+
+
+
+*/
+
+
+	// user class
+    class YDCMUser_guests extends YDDatabaseObject {
+    
+        function YDCMUser_guests() {
+        
+			// init DB object
+            $this->YDDatabaseObject();
+
+			// register database as default
+            $this->registerDatabase();
+
+			// register table for this component
+            $this->registerTable( 'YDCMUser_guests' );
+
+			// register fields
+			$this->registerKey( 'guest_id' );
+			$this->registerField( 'guest_ip' );
+			$this->registerField( 'guest_date' );
+		}
+
+
+        /**
+         *  This method adds a new guest entry
+         */
+		function addEntry(){
+		
+			// delete old and possible duplicated entries
+			$this->reset();
+			$this->where( $this->getTable() . '.guest_date < "' . YDStringUtil::formatDate( time() - 15 * 60, 'datetimesql' ) . '" OR ' . $this->getTable() . '.guest_ip = "' . $_SERVER['SERVER_ADDR'] . '"' );
+			$this->delete();
+
+			// add entry and get id added
+			$this->reset();
+			$this->set( 'guest_ip', $_SERVER['SERVER_ADDR'] );
+			$this->set( 'guest_date', YDStringUtil::formatDate( time(), 'datetimesql' ) );
+			return $this->insert();
+		}
+
+
+        /**
+         *  This method return total guests
+         *
+         *  @returns    Numeric value
+         */
+		function getTotal(){
+
+			$this->reset();
+			$this->where( $this->getTable() . '.guest_date > "' . YDStringUtil::formatDate( time() - 15 * 60, 'datetimesql' ) . '"' );
+			return $this->find();
+		}
+
+
+}
+
+
+?>

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-24 14:13:33 UTC (rev 2357)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDCMComponent/YDCMUserobject.php	2007-01-24 14:36:02 UTC (rev 2358)
@@ -32,25 +32,26 @@
 
 
 	// add YD libs
-	YDInclude( 'YDDatabaseTree3.php' );
+	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObjectTree/YDDatabaseObjectTree.php' );
 
+
     /**
      *  @ingroup YDCMComponent
      */
-    class YDCMUserobject extends YDDatabaseTree3 {
+    class YDCMUserobject extends YDDatabaseObjectTree {
     
         function YDCMUserobject() {
 
 			// init parent object
-			$this->YDDatabaseTree3( 'YDCMUserobject', 'default', 'userobject_id', 'parent_id', 'lineage', 'level', 'position' );
+			$this->YDDatabaseObjectTree( 'YDCMUserobject', 'default', 'userobject_id', 'userobject_parent_id', 'userobject_lineage', 'userobject_level', 'userobject_position' );
 
 			// add custom tree fields
-			$this->registerField( 'type' );
-			$this->registerField( 'reference' );			
-			$this->registerField( 'state' );
+			$this->registerField( 'userobject_type' );
+			$this->registerField( 'userobject_reference' );			
+			$this->registerField( 'userobject_state' );
 
 			// define tree order
-			$this->order( 'parent_id ASC, position ASC' );
+			$this->order( 'userobject_parent_id ASC, userobject_position ASC' );
 		}
 
 
@@ -73,14 +74,14 @@
 			if ( $this->find() != 1 ) return false;
 
 			// save parent_id for future use
-			$parent_id = $this->get( 'parent_id ' );
+			$parent_id = $this->get( 'userobject_parent_id ' );
 
 			// reset all previous class values
 			$this->resetValues();
 
 			// update all children to new parent_id
-			$this->set( 'parent_id', intval( $parent_id ) );
-			$this->where( 'parent_id', $userobject_id );
+			$this->set( 'userobject_parent_id', intval( $parent_id ) );
+			$this->where( 'userobject_parent_id', $userobject_id );
 
 			// update node
 			return $this->update();
@@ -101,7 +102,7 @@
 			$this->resetValues();
 
 			// set user id
-			$this->where( 'type IN (' . $this->_db->escapeSqlArray( $type ) . ')' );
+			$this->where( 'userobject_type IN (' . $this->_db->escapeSqlArray( $type ) . ')' );
 
 			// get all attributes
 			$this->find();



From ximian at mail.berlios.de  Wed Jan 24 17:05:22 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 24 Jan 2007 17:05:22 +0100
Subject: [ydf-devel] r2359 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701241605.l0OG5MNe000832@sheep.berlios.de>

Author: ximian
Date: 2007-01-24 17:05:11 +0100 (Wed, 24 Jan 2007)
New Revision: 2359

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
- small cleanup on YDLocale::useGettext

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-24 14:36:02 UTC (rev 2358)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-24 16:05:11 UTC (rev 2359)
@@ -564,7 +564,7 @@
 		function useGettext( $filename = 'ydframework', $directory = null ){
 
 			// get current locale
-			$locale = YDConfig::get( YD_LOCALE_KEY, 'en' );
+			$locale = YDLocale::get();
 
 			// set environment
 			$_ENV["LANG" ]      = $locale;



From ximian at mail.berlios.de  Wed Jan 24 17:07:28 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Wed, 24 Jan 2007 17:07:28 +0100
Subject: [ydf-devel] r2360 - in YDFramework2.0/trunk/YDFramework2: YDClasses
	addons/YDAjax
Message-ID: <200701241607.l0OG7SON000940@sheep.berlios.de>

Author: ximian
Date: 2007-01-24 17:07:17 +0100 (Wed, 24 Jan 2007)
New Revision: 2360

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
   YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
Log:
- javascript code added to window onload is better manage now.
  it also affects YDAjax

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-24 16:05:11 UTC (rev 2359)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-01-24 16:07:17 UTC (rev 2360)
@@ -95,7 +95,7 @@
 
                 // custom javascript code
                 $this->customJavascript       = '';
-                $this->customJavascriptOnload = '';
+                $this->customJavascriptOnload = array();
 
                 // custom Css code
                 $this->customCss = '';
@@ -234,12 +234,15 @@
                 }
 
                 // add onload code to custom javascript code
-                if ( $this->customJavascriptOnload != '' )
-                    $this->customJavascript .= "window.onload = function() {" . $this->customJavascriptOnload . "}\n";
-
+                if ( ! empty( $this->customJavascriptOnload ) ){ 
+					$onLoad = "window.onload = function() {" . implode( '', $this->customJavascriptOnload ) . "}\n"; 
+				}else{
+					$onLoad = '';
+				}
+				
                 // test if customJavascript is set
                 if ( $this->customJavascript != '' ) 
-                    $code .= "\n<script type=\"text/javascript\">\n" . $this->customJavascript . "</script>\n";
+                    $code .= "\n<script type=\"text/javascript\">\n" . $this->customJavascript . $onLoad . "</script>\n";
 
                 if ( $code == '' ) return $tpl_source;
 
@@ -257,16 +260,19 @@
              */
             function addJavascript( $jsCode, $prepend = false, $onload = false ) {
 
+				// check if we really have js code
+				if ( empty( $jsCode ) ) return;
+
                 if ( $onload ){
-                    if ( !$prepend ) $this->customJavascriptOnload = $this->customJavascriptOnload . $jsCode . "\n";
-                    else             $this->customJavascriptOnload = $jsCode . $this->customJavascriptOnload . "\n";
-                    return;
+                    if ( $prepend ) return array_unshift( $this->customJavascriptOnload, $jsCode );
+                    else            return array_push(    $this->customJavascriptOnload, $jsCode );
                 }
 
-                if (!$prepend) $this->customJavascript = $this->customJavascript . $jsCode . "\n";
-                else           $this->customJavascript = $jsCode . $this->customJavascript . "\n";
+                if ( $prepend ) return $this->customJavascript = $jsCode . $this->customJavascript . "\n";
+				else            return $this->customJavascript = $this->customJavascript . $jsCode . "\n";
             }
 
+
             /**
              *	This function will add custom javascript url to the template head
              *

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-24 16:05:11 UTC (rev 2359)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDAjax/YDAjax.php	2007-01-24 16:07:17 UTC (rev 2360)
@@ -174,22 +174,23 @@
 			$this->template->addJavascript( trim( $html ), true );
 
 			// compute ONLOAD code
-			$onload = '';
+			$onload = array();
 
 				// export effects js
 				foreach( $this->effects as $eff_name => $eff_code )
-					$onload  .= "\n\t" . $eff_code;
+					$onload[] = $eff_code;
 
 				// send js waiting message creation code
 				if( $this->waitingMessageCode != '' )
-					$onload  .= "\n\t" . $this->waitingMessageCode;
+					$onload[] = $this->waitingMessageCode;
 
 				// send autocompleter functions code
 				if( !empty( $this->autocompleterCodeFunctions ) )
-					$onload  .= "\n\t" . implode( "\n\t", $this->autocompleterCodeFunctions );
+					$onload[] = implode( "\n\t", $this->autocompleterCodeFunctions );
 
 			// add all code to template html
-			$this->template->addJavascript( $onload, false, true );
+			if ( ! empty( $onLoad ) )
+				$this->template->addJavascript( implode( '', $onload ), false, true );
 		}
 
 



From pclaerhout at mail.berlios.de  Wed Jan 24 19:38:26 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 19:38:26 +0100
Subject: [ydf-devel] r2361 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701241838.l0OIcQHf020474@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 19:38:23 +0100 (Wed, 24 Jan 2007)
New Revision: 2361

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Added support for a language index in the queries.


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-24 16:07:17 UTC (rev 2360)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-24 18:38:23 UTC (rev 2361)
@@ -866,10 +866,13 @@
             $this->_fmtTimeStamp = 'Y-m-d H:i:s';
             $this->_fmtQuote = "'";
 
+            // The language index to use
+            $this->_languageIndex = null;
+
         }
 
         /**
-         *  Functioo to indicate if an SQL error should die the script or not.
+         *  Function to indicate if an SQL error should die the script or not.
          *
          *  @param $val     (optional) True if you want the script to die on an error, false otherwise.
          */
@@ -878,6 +881,28 @@
         }
 
         /**
+         *  This function sets the language index which will be used to retrieve the fields. If you set this to a non
+         *  null value, it will replace all occurrences of "_@" with "_{$val}". This is very handy if you put the fields
+         *  in the database as follows:
+         *      - id
+         *      - title_1
+         *      - title_2
+         *      - title_3
+         *
+         *  If you then use the following query, provided you have set the correct language index, the right column will
+         *  be retrieved:
+         *
+         *  @code
+         *  SELECT id, title_@ FROM mytable;
+         *  @endcode
+         *
+         *  @param $val     (optional) True if you want the script to die on an error, false otherwise.
+         */
+        function setLanguageIndex( $val=null ) { 
+            $this->_languageIndex = $val; 
+        }
+
+        /**
          *  This funciton returns the database name.
          *
          *  @returns    The database name.
@@ -1235,7 +1260,6 @@
             return $string;
         }
 
-
         /**
          *  This function will escape all array elements with the quotes appropriate for the database backend.
          *
@@ -1244,31 +1268,29 @@
          *  @returns    The escaped string surrounded by quotes.
          */
         function escapeSqlArray( $arr ) {
+            return implode( ',', array_map( array( &$this, 'escapeSql' ), $arr ) );
+        }
 
-			return implode( ',', array_map( array( &$this, 'escapeSql' ), $arr ) );
-		}
-
-
         /**
          *  Function to prepare an SQL statement with parameters. The parameters start counting from 1.
          
          *  This works as follows:
          *
-         *  \code
+         *  @code
          *  $sql = 'SELECT * FROM comments WHERE id = :1 and author = :2'
-         *  \endcode
+         *  @endcode
          *
          *  After a function call as follows:
          *
-         *  \code
+         *  @code
          *  prepareSql( $sql, 1, 'Pieter Claerhout' );
-         *  \endcode
+         *  @endcode
          *
          *  The SQL statement becomes:
          *
-         *  \code
+         *  @code
          *  SELECT * FROM comments WHERE id = '1' and author = 'Pieter Claerhout'
-         *  \endcode
+         *  @endcode
          *
          *  All the arguments are automatically escaped.
          *
@@ -1296,6 +1318,11 @@
                 $sql = str_replace( ':' . ($key+1), $this->escapeSql( $arg ), $sql );
             }
 
+            // Update the language placeholders
+            if ( ! is_null( $this->_languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $this->_languageIndex, $sql );
+            }
+
             // Return the SQL statement
             return $sql;
 



From pclaerhout at mail.berlios.de  Wed Jan 24 19:39:03 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 19:39:03 +0100
Subject: [ydf-devel] r2362 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701241839.l0OId3JQ020557@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 19:38:57 +0100 (Wed, 24 Jan 2007)
New Revision: 2362

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
Log:
Updated the constructor docstring for the YDDatabaseMetaData class.


Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-24 18:38:23 UTC (rev 2361)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseMetaData.php	2007-01-24 18:38:57 UTC (rev 2362)
@@ -44,7 +44,8 @@
         /**
          *  Constructor. Set the database connection
          *
-         *  @param $db             The YDDatabase object pointing to the database
+         *  @param $db  (optional) The YDDatabase object pointing to the database. If you use a null value, the default
+         *              database instance will be used (using YDDatabase::getNamedInstance()).
          */
         function YDDatabaseMetaData( $db=null ) {
             if ( is_null( $db ) ) {



From pclaerhout at mail.berlios.de  Wed Jan 24 19:46:17 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 19:46:17 +0100
Subject: [ydf-devel] r2363 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701241846.l0OIkHFd021223@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 19:46:12 +0100 (Wed, 24 Jan 2007)
New Revision: 2363

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Decoupled the action handler in the YDSimpleCMSRequest class. Currently, the default action handler hands over to a different function depending on the current scope.

Currently, this does not make any difference, but it will once we implement the content tree and proper handling of the public requests.


Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 18:38:57 UTC (rev 2362)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 18:46:12 UTC (rev 2363)
@@ -453,6 +453,26 @@
          *      string of the request.
          */
         function actionDefault() {
+            if ( YDSimpleCMS::getScope() == YD_SIMPLECMS_SCOPE_PUBLIC ) {
+                $this->actionDefaultPublic();
+            } else {
+                $this->actionDefaultAdmin();
+            }
+        }
+
+        /**
+         *  This is the action handler for a public request. Currently, it does the same thing as the action handler
+         *  for an admin request.
+         */
+        function actionDefaultPublic() {
+            $this->actionDefaultAdmin();
+        }
+
+        /**
+         *  This is the action handler for an admin request. Currently, it does the same thing as the action handler
+         *  for a public request.
+         */
+        function actionDefaultAdmin() {
             $module = $this->getQueryStringParameter( 'module', $this->defaultModule );
             $action = $this->getQueryStringParameter( 'action', 'show' );
             $moduleManager = & YDSimpleCMS::getModuleManager();



From pclaerhout at mail.berlios.de  Wed Jan 24 19:58:09 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 19:58:09 +0100
Subject: [ydf-devel] r2364 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDSimpleCMS examples/simplecms/includes
Message-ID: <200701241858.l0OIw9a9021963@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 19:58:01 +0100 (Wed, 24 Jan 2007)
New Revision: 2364

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/examples/simplecms/includes/config.php
Log:
Added initial support for language checking, but it needs to be cleaned up and integrated with YDRequest if possible.


Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 18:46:12 UTC (rev 2363)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-24 18:58:01 UTC (rev 2364)
@@ -50,6 +50,7 @@
     define( YD_SIMPLECMS_PACKAGE_NAME . '_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
     define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_PUBLIC',   'public' );
     define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_ADMIN',    'admin' );
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE',  YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE' );
 
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
@@ -124,6 +125,50 @@
                 // Set the default scope
                 $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['scope'] = YD_SIMPLECMS_SCOPE_PUBLIC;
 
+                // Get the site Id
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['siteId'] = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
+
+                // Create a browser information object
+                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['browserInfo'] = new YDBrowserInfo();
+                $browserInfo = & $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['browserInfo'];
+
+                // -- Negotiate the language --
+                // Set the list of languages and the default language
+                $language = YDConfig::get( 'site_default_lang', '' );
+                $languages = array();
+
+                // Get the current URL
+                $url = new YDUrl( YDRequest::getNormalizedCurrentUrl() );
+
+                // Get the list of languages
+                foreach ( array_slice( YDConfig::get( 'site_languages', array() ), 0, 4 ) as $key=>$lang ) {
+                    if ( ! empty( $lang[0] ) ) {
+                        $lang[0] = strtolower( $lang[0] );
+                        $url->setQueryVar( 'lang', $lang[0] );
+                        $languages[ $lang[0] ] = array(
+                            'name' => $lang[1], 'idx' => $key + 1, 'code' => $lang[0], 'url' => $url->getUrl(),
+                        );
+                    }
+                }
+
+                // Get the current language
+                $languages = array_keys( $languages );
+                $lang = $browserInfo->getLanguage( $languages );
+                $languageCookieName = YD_SIMPLECMS_PACKAGE_NAME . '_' . YDSimpleCms::getSiteId() . '_LANG';
+                if ( YDRequest::getCookie( $languageCookieName, '', $languages ) != '' ) {
+                    $lang = YDRequest::getCookie( $languageCookieName, '', $languages );
+                }
+                //if ( $this->getQueryStringParameter( 'lang', '', $languages ) != '' ) {
+                //    $lang = $this->getQueryStringParameter( 'lang', '', $languages );
+                //}
+                $lang = strtolower( $lang );
+
+                // Set the right locale
+                YDLocale::set( $lang );
+
+                YDDebugUtil::dump( $language, 'language' );
+                YDDebugUtil::dump( $languages, 'languages' );
+
             }
 
         }
@@ -281,6 +326,17 @@
         }
 
         /**
+         *  This function returns a YDBrowserInfo object for the current request.
+         *
+         *  @returns    Returns a YDBrowserInfo object for the current request.
+         *
+         *  @static
+         */
+        function & getBrowserInfo() {
+            return YDSimpleCMS::getVar( 'browserInfo' );
+        }
+
+        /**
          *  This function returns one of the named variables from the global CMS scope.
          *
          *  @param  $var    The name of the variable you want to retrieve.
@@ -306,6 +362,17 @@
         }
 
         /**
+         *  This function returns the current site ID.
+         *
+         *  @returns    Returns the current site ID.
+         *
+         *  @static
+         */
+        function getSiteId() {
+            return YDSimpleCMS::getVar( 'siteId' );
+        }
+
+        /**
          *  This function sets a YDSimpleCMS variable.
          *
          *  @param  $var    The variable to set.
@@ -432,11 +499,11 @@
             $this->tpl = new YDSimpleCMSTemplate();
 
             // Get the site id
-            $this->siteId = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
+            $this->siteId = YDSimpleCMS::getSiteId();
 
             // The names of the cookies
-            $this->cookieNameUser = 'YD_SIMPLECMS_' . $this->siteId . '_USER';
-            $this->cookieNamePass = 'YD_SIMPLECMS_' . $this->siteId . '_PASS';
+            $this->cookieNameUser = YD_SIMPLECMS_PACKAGE_NAME . '_' . $this->siteId . '_USER';
+            $this->cookieNamePass = YD_SIMPLECMS_PACKAGE_NAME . '_' . $this->siteId . '_PASS';
 
         }
 

Modified: YDFramework2.0/trunk/examples/simplecms/includes/config.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-24 18:46:12 UTC (rev 2363)
+++ YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-24 18:58:01 UTC (rev 2364)
@@ -1,13 +1,27 @@
 <?php
 
+    // The generic settings
     YDConfig::set( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
     YDConfig::set( 'YD_DEBUG', 2 );
     YDConfig::set( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
 
+    // The database settings
     YDConfig::set( 'db_host',   'localhost' );
     YDConfig::set( 'db_name',   'ydsimplecms' );
     YDConfig::set( 'db_user',   'root' );
     YDConfig::set( 'db_pass',   '' );
     YDConfig::set( 'db_prefix', 'cms_' );
 
+    // The defintion of the languages for the website
+    YDConfig::set(
+        'site_languages',
+        array(
+            1 => array( 'nl', 'Nederlands' ),
+            2 => array( 'fr', 'Fran&ccedil;ais' ),
+            3 => array( 'en', 'English' ),
+            4 => array( '', '' ),
+        )
+    );
+    YDConfig::set( 'site_default_lang', 'en' );
+
 ?>
\ No newline at end of file



From pclaerhout at mail.berlios.de  Wed Jan 24 20:34:21 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Wed, 24 Jan 2007 20:34:21 +0100
Subject: [ydf-devel] r2365 - YDFramework2.0/trunk/doc_src
Message-ID: <200701241934.l0OJYLnV025190@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-24 20:34:12 +0100 (Wed, 24 Jan 2007)
New Revision: 2365

Added:
   YDFramework2.0/trunk/doc_src/ydsimplecms.xml
Modified:
   YDFramework2.0/trunk/doc_src/_ydframework.xml
Log:
Started writing some initial documentation on YDSimpleCMS.


Modified: YDFramework2.0/trunk/doc_src/_ydframework.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/_ydframework.xml	2007-01-24 18:58:01 UTC (rev 2364)
+++ YDFramework2.0/trunk/doc_src/_ydframework.xml	2007-01-24 19:34:12 UTC (rev 2365)
@@ -36,6 +36,7 @@
     <!ENTITY addon_ydmysqldump SYSTEM "ydmysqldump.xml">
     <!ENTITY addon_ydsqlquery SYSTEM "yddatabasequery.xml">
     <!ENTITY addon_ydpdfreport SYSTEM "ydpdfreport.xml">
+    <!ENTITY addon_ydsimplecms SYSTEM "ydsimplecms.xml">
     <!ENTITY bestpractices SYSTEM "bestpractices.xml">
     <!ENTITY faq SYSTEM "faq.xml">
     <!ENTITY config_vars SYSTEM "config_vars.xml">
@@ -103,6 +104,7 @@
     &addon_ydmysqldump;
     &addon_ydsqlquery;
     &addon_ydpdfreport;
+    &addon_ydsimplecms;
     &config_vars;
     &faq;
     &changelog;

Added: YDFramework2.0/trunk/doc_src/ydsimplecms.xml
===================================================================
--- YDFramework2.0/trunk/doc_src/ydsimplecms.xml	2007-01-24 18:58:01 UTC (rev 2364)
+++ YDFramework2.0/trunk/doc_src/ydsimplecms.xml	2007-01-24 19:34:12 UTC (rev 2365)
@@ -0,0 +1,100 @@
+<?xml version='1.0' encoding="ISO-8859-1"?>
+<chapter id="ydsimplecms">
+
+    <title>Addon: YDSimpleCMS, a content management framework</title>
+
+    <para>YDSimpleCMS is a content management framework inside the Yellow Duck Framework that makes it easy to build extensible and module content management systems.</para>
+
+    <sect1 id="ydsimplecms_introduction">
+
+        <title>Introduction</title>
+
+        <para>Currently, it's in the early stages of development, but the plan is to support the following features:</para>
+
+        <itemizedlist spacing="compact">
+            <listitem>All contents is stored in a hierarchy in the database.</listitem>
+            <listitem>Multilingual content and user interface.</listitem>
+            <listitem>Modular approach to make extending the CMS easy and straightforward.</listitem>
+            <listitem>Themeable user interface.</listitem>
+        </itemizedlist>
+
+    </sect1>
+
+    <sect1 id="ydsimplecms_overview">
+
+        <title>Overview</title>
+
+        <para>The YDSimpleCMS package uses different classes and items to do it's work. This chapter will try to give you a general overview of all the different classes that are used in the CMS framework.</para>
+
+        <sect2 id="ydsimplecms_overview_scope">
+
+            <title>YDSimpleCMS scopes</title>
+
+            <para>The YDSimpleCMS package uses the concept of "scopes" to define requests. We basically support two different request scope which are identified by the following constants:</para>
+
+            <itemizedlist spacing="compact">
+                <listitem>YD_SIMPLECMS_SCOPE_PUBLIC</listitem>
+                <listitem>YD_SIMPLECMS_SCOPE_ADMIN</listitem>
+            </itemizedlist>
+
+            <para>Whenever a SimpleCMS request is executed, it defines the scope for that request. Depending on the scope, different things happen with the request. In both scopes, a standard number of tasks are executed:</para>
+
+            <itemizedlist spacing="compact">
+                <listitem>A connection with the database will be established</listitem>
+                <listitem>An array which contains the menus and menu items for the administration menu is created and populated</listitem>
+                <listitem>An instance of a module manager is created</listitem>
+                <listitem>The ID of the site gets determined from the configuration</listitem>
+                <listitem>The details of the browser are captured in a YDBrowserInfo object</listitem>
+                <listitem>The language is negotiated with the browser</listitem>
+            </itemizedlist>
+
+            <para>However, after the initial setup, it depends on the scope to know how the request is going to be processed.</para>
+
+            <sect3 id="ydsimplecms_overview_scope_public">
+
+                <title>YD_SIMPLECMS_SCOPE_PUBLIC</title>
+
+                <para>The most important feature about the public scope is that authentication is not enforced. The user authentication does happen and the user details are populated, but if the authentication fails, the page will still be rendered.</para>
+
+            </sect3>
+
+            <sect3 id="ydsimplecms_overview_scope_admin">
+
+                <title>YD_SIMPLECMS_SCOPE_ADMIN</title>
+
+                <para>The admin scope enforces authentication and will present the user with a login screen if the authentication fails. The user credentials are checked against the the #_users database table.</para>
+
+            </sect3>
+
+        </sect2>
+
+        <sect2 id="ydsimplecms_overview_ydsimplecms">
+
+            <title>YDSimpleCMS class</title>
+
+            <para>This YDSimpleCMS class is the heart of the SimpleCMS package and is the one that kicks in everything. Using it's run functions, you can process a new request. Depending on the scope of the request, you will either use YDSimpleCMS::runPublicRequest() or YDSimpleCMS::runAdminRequest(). Calling this function starts the request processing.</para>
+
+            <para>The request processing happens in different steps and is always performed in the same manner.</para>
+
+            <para>The first step is that the YDSimpleCMS package is initialized. This will run the common initialization functions to get the YDSimpleCMS package into a ready state. The initialization performs the following steps:</para>
+
+            <itemizedlist spacing="compact">
+                <listitem>A connection with the database will be established</listitem>
+                <listitem>An array which contains the menus and menu items for the administration menu is created and populated</listitem>
+                <listitem>An instance of a module manager is created</listitem>
+                <listitem>The ID of the site gets determined from the configuration</listitem>
+                <listitem>The details of the browser are captured in a YDBrowserInfo object</listitem>
+                <listitem>The language is negotiated with the browser</listitem>
+            </itemizedlist>
+
+            <para>Once the initialization is done, an new instance of the YDSimpleCMSRequest class is created. This class will then take over the request processing and perform the login procedure.</para>
+
+            <para>After the login procedure, the query string variables called "module" and "action" are examined to find out which module and module action that needs to be run.</para>
+
+            <para>The YDSimpleCMSRequest class now hands over the request processing to the module which does it's thing and renders output.</para>
+
+        </sect2>
+
+    </sect1>
+
+</chapter>



From pclaerhout at mail.berlios.de  Thu Jan 25 10:13:07 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Thu, 25 Jan 2007 10:13:07 +0100
Subject: [ydf-devel] r2366 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200701250913.l0P9D7Df029755@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-25 10:13:05 +0100 (Thu, 25 Jan 2007)
New Revision: 2366

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Changed the language index to a YDConfig variable instead of as a class variable. This makes it much more convenient.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-24 19:34:12 UTC (rev 2365)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-25 09:13:05 UTC (rev 2366)
@@ -44,6 +44,7 @@
     YDConfig::set( 'YD_DB_DEFAULTPAGESIZE', 20, false );
     YDConfig::set( 'YD_DB_TABLEPREFIX', '', false );
     YDConfig::set( 'YD_DB_ALLOW_PERSISTENT_SORT', false, false );
+    YDConfig::set( 'YD_DB_LANGUAGE_INDEX', null, false );
 
     YDConfig::set( 'YD_DB_RS_CYCLENAVIGATION', false, false );
 
@@ -866,9 +867,6 @@
             $this->_fmtTimeStamp = 'Y-m-d H:i:s';
             $this->_fmtQuote = "'";
 
-            // The language index to use
-            $this->_languageIndex = null;
-
         }
 
         /**
@@ -881,28 +879,6 @@
         }
 
         /**
-         *  This function sets the language index which will be used to retrieve the fields. If you set this to a non
-         *  null value, it will replace all occurrences of "_@" with "_{$val}". This is very handy if you put the fields
-         *  in the database as follows:
-         *      - id
-         *      - title_1
-         *      - title_2
-         *      - title_3
-         *
-         *  If you then use the following query, provided you have set the correct language index, the right column will
-         *  be retrieved:
-         *
-         *  @code
-         *  SELECT id, title_@ FROM mytable;
-         *  @endcode
-         *
-         *  @param $val     (optional) True if you want the script to die on an error, false otherwise.
-         */
-        function setLanguageIndex( $val=null ) { 
-            $this->_languageIndex = $val; 
-        }
-
-        /**
          *  This funciton returns the database name.
          *
          *  @returns    The database name.
@@ -1319,8 +1295,9 @@
             }
 
             // Update the language placeholders
-            if ( ! is_null( $this->_languageIndex ) ) {
-                $sql = str_replace( '_@', '_' . $this->_languageIndex, $sql );
+            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
+            if ( ! is_null( $languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
             }
 
             // Return the SQL statement



From pclaerhout at mail.berlios.de  Thu Jan 25 14:02:40 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Thu, 25 Jan 2007 14:02:40 +0100
Subject: [ydf-devel] r2367 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDSimpleCMS
	examples/simplecms/includes/skins_admin
	examples/simplecms/includes/skins_public/default
	examples/simplecms/resources
Message-ID: <200701251302.l0PD2eF6023709@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-25 14:02:29 +0100 (Thu, 25 Jan 2007)
New Revision: 2367

Added:
   YDFramework2.0/trunk/examples/simplecms/resources/YDSimpleCMS.css
Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
Log:
Updated the master template for the admin site of the YDSimpleCMS package.

Also changed:
- Assignment of the generic variables now happens in the template class instead of in the request/module class.
- Added CSS classes to the login form.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-25 13:02:29 UTC (rev 2367)
@@ -52,6 +52,9 @@
     define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_ADMIN',    'admin' );
     define( YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE',  YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE' );
 
+    // Versions and numbers
+    define( YD_SIMPLECMS_PACKAGE_NAME . '_NAME', 'Yellow Duck Content Manager' );
+
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
 
@@ -166,8 +169,8 @@
                 // Set the right locale
                 YDLocale::set( $lang );
 
-                YDDebugUtil::dump( $language, 'language' );
-                YDDebugUtil::dump( $languages, 'languages' );
+                //YDDebugUtil::dump( $language, 'language' );
+                //YDDebugUtil::dump( $languages, 'languages' );
 
             }
 
@@ -233,6 +236,9 @@
          *  @param  $action     The module action that is linked to this menu item.
          *
          *  @static
+         *
+         *  @todo
+         *      Should become a member of the YDSimpleCMSModule class instead.
          */
         function addAdminMenu( $title, $subtitle, $module, $action ) {
 
@@ -417,6 +423,14 @@
          */
         function fetchWithMaster( $template='', $master='__master' ) {
 
+            // Add the standard variables
+            $this->assign( YD_SIMPLECMS_PACKAGE_NAME . '_NAME', YD_SIMPLECMS_NAME );
+            $this->assign( 'adminMenu',     YDSimpleCMS::getAdminMenu() );
+            if ( YDSimpleCMS::getCurrentUser() ) {
+                $this->assign( 'currentUser', YDSimpleCMS::getCurrentUser() );
+            }
+            $this->assign( 'currentScope', YDSimpleCMS::getScope() );
+
             // Get the current scope
             $scope = YDSimpleCMS::getScope();
 
@@ -560,10 +574,10 @@
 
             // Create the login form
             $form = new YDForm( 'loginForm' );
-            $form->addElement( 'text', 'loginName', t('username') );
-            $form->addElement( 'password', 'loginPass', t('password') );
+            $form->addElement( 'text', 'loginName', t('username'), array( 'class'=>'tfL' ) );
+            $form->addElement( 'password', 'loginPass', t('password'), array( 'class'=>'tfL' ) );
             $form->addElement( 'checkbox', 'loginRememberMe', t('remember_me') );
-            $form->addElement( 'submit', 'cmdSubmit', 'Login' );
+            $form->addElement( 'submit', 'cmdSubmit', 'Login', array( 'class'=>'button' ) );
             $form->setDefault( 'loginRememberMe', true );
 
             // Add the rules
@@ -769,10 +783,6 @@
         function display( $name='' ) {
             $this->tpl->assign( 'currentAction', $this->currentAction );
             $this->tpl->assign( 'currentScope',  $this->currentScope );
-            $this->tpl->assign( 'adminMenu',     YDSimpleCMS::getAdminMenu() );
-            if ( YDSimpleCMS::getCurrentUser() ) {
-                $this->tpl->assign( 'currentUser', YDSimpleCMS::getCurrentUser() );
-            }
             $name = ( $name == '' ) ? $this->getModuleName() : $name;
             $this->tpl->displayWithMaster( $name );
         }

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-25 13:02:29 UTC (rev 2367)
@@ -2,48 +2,80 @@
 
 <head>
 
-    <title>{$title}</title>
+    <title>{$YD_SIMPLECMS_NAME}</title>
 
-    {literal}<style>
-        td { vertical-align: top; }
-    </style>{/literal}
+    <link rel="stylesheet" type="text/css" href="resources/YDSimpleCMS.css" />
 
 </head>
 
-<body>
+<body marginwidth="0" marginheight="0" bgcolor="#FFFFFF" bottommargin="0" leftmargin="0" rightmargin="0" topmargin="0">
 
-    <table width="100%" border="1">
-    {if $currentUser}
-        <tr>
-            <td colspan="2">
-                {$currentUser.name} | <a href="{$YD_SELF_SCRIPT}?module=admin&action=logout">{t w="logout"}</a>
-            </td>
-        </tr>
-    {/if}
+    <table width="100%" height="100%" cellspacing="0" cellpadding="18" border="0">
     <tr>
-        <td width="240">
+        <td class="topRow" colspan="2">
+            <p class="title">{$YD_SIMPLECMS_NAME}</p>
+        </td>
+    </tr>
+    <tr>
+        <td class="langRowL">
+            <p class="langRow">
+                &nbsp;
+            </p>
+        </td>
+        <td class="langRowR">
+            <p class="langRow">
+                {if $currentUser}
+                    {$currentUser.name}
+                    [
+                    <a href="{$YD_SELF_SCRIPT}?do=logout" class="langRow">{t w="logout"}</a>
+                    |
+                    <a href="index.php" class="langRow">{t w="view_site"}</a>
+                    ]
+                {else}
+                    &nbsp;
+                {/if}
+            </p>
+        </td>
+    </tr>
+    <tr>
+        <td class="leftCol">
             {if $currentUser}
+                <table width="100%" cellspacing="0" cellpadding="0" border="0">
                 {foreach from=$adminMenu item="menuItem"}
-                    <p>
-                        {if $menuItem.url}
-                            <a href="{$menuItem.url}"><b>{$menuItem.title}</b></a>
-                        {else}
-                            <b>{$menuItem.title}</b>
-                        {/if}
-                        {foreach from=$menuItem.children item="menuSubItem"}
-                            <br/>
-                            {if $menuSubItem.url}
-                                <a href="{$menuSubItem.url}">{$menuSubItem.title}</a>
+                <tr>
+                    <td class="adminRowL">
+                        <p>
+                            {if $menuItem.url}
+                                <a href="{$menuItem.url}"><b>{$menuItem.title}</b></a>
                             {else}
-                                {$menuSubItem.title}
+                                <b>{$menuItem.title}</b>
                             {/if}
-                        {/foreach}
-                    </p>
+                            {foreach from=$menuItem.children item="menuSubItem"}
+                                <br/>
+                                {if $menuSubItem.url}
+                                    <a href="{$menuSubItem.url}">{$menuSubItem.title}</a>
+                                {else}
+                                    {$menuSubItem.title}
+                                {/if}
+                            {/foreach}
+                        </p>
+                    </td>
+                </tr>
                 {/foreach}
+                </table>
+            {else}
+                &nbsp;
             {/if}
         </td>
-        <td>
+        <td align="left" valign="top">
             ##content##
+            <p class="subline">
+                &nbsp<br/>
+                {t w="powered_by"} <a href="{$YD_FW_HOMEPAGE}" class="subline" target="_blank">{$YD_FW_NAME}</a>
+                {t w="version"} {$YD_FW_VERSION}.
+                <br/>
+                {$YD_FW_COPYRIGHT}
+            </p>
         </td>
     </tr>
     </table>

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/admin.tpl	2007-01-25 13:02:29 UTC (rev 2367)
@@ -1,22 +1,6 @@
 {if $currentAction == 'show'}
     <h1>Admin Home</h1>
-    {foreach from=$adminMenu item="menuItem"}
-        <p>
-            {if $menuItem.url}
-                <a href="{$menuItem.url}"><b>{$menuItem.title}</b></a>
-            {else}
-                <b>{$menuItem.title}</b>
-            {/if}
-            {foreach from=$menuItem.children item="menuSubItem"}
-                <br/>
-                {if $menuSubItem.url}
-                    <a href="{$menuSubItem.url}">{$menuSubItem.title}</a>
-                {else}
-                    {$menuSubItem.title}
-                {/if}
-            {/foreach}
-        </p>
-    {/foreach}
+    <p>Welcome</p>
 {/if}
 
 {if $currentAction == 'modules'}

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/login.tpl	2007-01-25 13:02:29 UTC (rev 2367)
@@ -1,7 +1,7 @@
 <h1>{t w="please_login"}</h1>
 
 {if $form.errors}
-    <p style="color: red">
+    <p class="error">
         {foreach from=$form.errors item=error}
             {$error}<br>
         {/foreach}
@@ -9,21 +9,24 @@
 {/if}
 
 {$form.tag}
-    <p>
-        {$form.loginName.label}
-        <br>
-        {$form.loginName.html}
-    </p>
-    <p>
-        {$form.loginPass.label}
-        <br>
-        {$form.loginPass.html}
-    </p>
-    <p>
-        {$form.loginRememberMe.html}
-        {$form.loginRememberMe.label}
-    </p>
-    <p>
-        {$form.cmdSubmit.html}
-    </p>
+    <table width="480" cellspacing="0" cellpadding="0" border="0">
+        <tr>
+            <th class="adminRowL" colspan="2">
+                {t w="please_login"}
+            </th>
+        </tr>
+        <tr>
+            <td class="adminRowL" width="160">{$form.loginName.label}</td>
+            <td class="adminRowL" width="320">{$form.loginName.html}</td>
+        </tr>
+        <tr>
+            <td class="adminRowL">{$form.loginPass.label}</td>
+            <td class="adminRowL">{$form.loginPass.html}</td>
+        </tr>
+        <tr>
+            <td class="adminRowL">&nbsp;</td>
+            <td class="adminRowL">{$form.loginRememberMe.html} {$form.loginRememberMe.label}</td>
+        </tr>
+    </table>
+    <p>{$form.cmdSubmit.html}</p>
 {$form.endtag}

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-25 13:02:29 UTC (rev 2367)
@@ -7,6 +7,9 @@
 </head>
 
 <body>
+    {if $currentScope eq YD_SIMPLECMS_SCOPE_PUBLIC}
+        <a href="admin.php" class="langRow">administer site</a>
+    {/if}
     {if $currentUser}
         <p>
             {$currentUser.name} | <a href="{$YD_SELF_SCRIPT}?action=logout">{t w="logout"}</a>

Added: YDFramework2.0/trunk/examples/simplecms/resources/YDSimpleCMS.css
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/resources/YDSimpleCMS.css	2007-01-25 09:13:05 UTC (rev 2366)
+++ YDFramework2.0/trunk/examples/simplecms/resources/YDSimpleCMS.css	2007-01-25 13:02:29 UTC (rev 2367)
@@ -0,0 +1,38 @@
+SELECT, INPUT, TEXTAREA, BODY, P, .normal, LI, TD	{
+	font-family: Georgia, Arial, Helvetica, Geneva, Swiss, Verdana;
+}
+body, p, .normal, li, td, th, h2	{ color: #000031; font-size: 10pt; line-height: 16pt; }
+h2 { font-weight: bold; }
+a			{ color: #000066; text-decoration: underline; font-weight: normal; cursor: pointer; }
+.image	{ border:1px; border-color: #000066; color: #000066; border-style: solid; }
+p.title, h1	{ font-size: 150%; font-weight: normal; color: darkred; }
+.subline	{ color: gray; font-size: 8pt; }
+.disabled	{ color: gray; }
+.error		{ color: red; font-weight: bold; }
+input.tfS	{ width: 30px; }
+input.tfL	{ width: 320px; }
+input.tfM	{ width: 100%; }
+textarea.taM	{ width: 100%; height: 200px; }
+textarea.bbtextarea	{ width: 660; height: 250px; font-family: "Lucida Sans Typewriter", "Andale Mono", "Courier New", "Courier"; font-size: 9pt; }
+td.bbtoolbar	{ background-color: #EEEEEE; }
+select.tfS	{ width: 200px; }
+select.tfM	{ width: 100%; }
+input.button	{ width: 120px; color: white; background-color: darkred; font-weight: bold; }
+td, th	{ vertical-align: top }
+th	{ font-weight: bold; }
+td.adminRowL, th.adminRowL	{ border-bottom: 1px solid #DDDDDD; padding-top: 4px; padding-bottom: 4px; text-align: left; }
+td.adminRowC, th.adminRowC	{ border-bottom: 1px solid #DDDDDD; padding-top: 4px; padding-bottom: 4px; text-align: center; }
+td.adminRowR, th.adminRowR	{ border-bottom: 1px solid #DDDDDD; padding-top: 4px; padding-bottom: 4px; text-align: right; }
+table	{ border-width: 0px; }
+td.topRow	{ background-color: #CCCCCC; padding-bottom: 8px; }
+p.langRow, a.langRow	{ color: white; }
+td.langRowL	{ background-color: darkred; padding-top: 2px; padding-bottom: 2px; padding-right: 0px; text-align: left; }
+td.langRowR	{ background-color: darkred; padding-top: 2px; padding-bottom: 2px; padding-left: 0px; text-align: right; }
+td.langRowE	{ background-color: #000066; padding: 2px; padding-left: 4px; }
+td.leftCol	{ background-color: #EEEEEE; width: 200px; height: 100%; }
+table.adminGraph	{ background-color: darkred; }
+a.leftColSelected	{ color: darkred; font-weight: bold; }
+a.leftColUnselected	{ font-weight: bold; }
+a.yes	{ color: green; }
+a.no	{ color: red; }
+a.helpLink	{ cursor: pointer; }



From pclaerhout at mail.berlios.de  Sat Jan 27 19:21:20 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sat, 27 Jan 2007 19:21:20 +0100
Subject: [ydf-devel] r2368 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200701271821.l0RILKA0016113@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-27 19:21:15 +0100 (Sat, 27 Jan 2007)
New Revision: 2368

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
   YDFramework2.0/trunk/YDFramework2/YDF2_process.php
Log:
Moved the YDExecutor class definition to YDF2_init.php.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-25 13:02:29 UTC (rev 2367)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-01-27 18:21:15 UTC (rev 2368)
@@ -630,6 +630,263 @@
 
     }
 
+    /**
+     *	This is the executor class that contains all the logic for executing requests. It will instantiate the request
+     *	class and execute the right functions to get the request processed correctly.
+     *
+     *  @ingroup YDFramework
+     */
+    class YDExecutor extends YDBase {
+
+        /**
+         *	The class constructor for the YDExecutor class.
+         *
+         *	@param $file	Full path to the file that contains the request.
+         */
+        function YDExecutor( $file ) {
+            $this->_file = $file;
+        }
+
+        /**
+         *	The execute function will start the YDExecutor class and process the request.
+         */
+        function execute() {
+
+            // Do nothing if we already processed a request
+            if ( defined( 'YD_REQ_PROCESSED' ) ) {
+                return;
+            }
+
+            // Construct the name of the request class
+            $clsName = basename( $this->_file, YD_SCR_EXT );
+            $this->clsInst = new $clsName();
+
+            // Check if the object a YDRequest object
+            if ( ! YDObjectUtil::isSubClass( $this->clsInst, 'YDRequest' ) ) {
+                $ancestors = YDObjectUtil::getAncestors( $this->clsInst );
+                trigger_error(
+                    'Class "' . $clsName . '" should be derived from the YDRequest class. Currently, this class has the '
+                    . 'following ancestors: ' . implode( ' -&gt; ', $ancestors ), YD_ERROR
+                );
+            }
+
+            // Check if the class is properly initialized
+            if ( $this->clsInst->isInitialized() != true ) {
+                trigger_error(
+                    'Class "' . $clsName . '" is not initialized properly. Make  sure loaded the base class YDRequest '
+                    . 'and initialized it.', YD_ERROR
+                );
+            }
+
+            // Only if authentication is required
+            if ( $this->clsInst->getRequiresAuthentication() ) {
+                $result = $this->clsInst->isAuthenticated();
+                if ( $result ) {
+                    $this->clsInst->authenticationSucceeded();
+                } else {
+                    $this->clsInst->authenticationFailed();
+                    $this->finish();
+                }
+            }
+
+            // Get the action name
+            $action = 'action' . $this->clsInst->getActionName();
+
+            // Check if the action exists
+            if ( ! $this->clsInst->hasMethod( $action ) ) {
+                $this->clsInst->errorMissingAction( $action );
+                $this->finish();
+            }
+
+            // Check if the current action is allowed or not and execute errorActionNotAllowed if failed
+            if ( ! $this->clsInst->isActionAllowed() ) {
+                $this->clsInst->errorActionNotAllowed();
+                $this->finish();
+            }
+
+            // Process the request
+            $this->clsInst->process();
+            $this->finish();
+
+        }
+
+        /**
+         *	This is the function we use for finishing the request.
+         *
+         *	@internal
+         */
+        function finish() {
+
+            // Mark that the request is processed
+            define( 'YD_REQ_PROCESSED', 1 );
+
+            // Stop the timer
+            $GLOBALS['timer']->finish();
+
+            // Output visible debug info as a comment
+            if ( YDConfig::get( 'YD_DEBUG' ) == 1 ) {
+
+                // Total size of include files
+                $includeFiles = get_included_files();
+
+                // Calculate the total size
+                $includeFilesSize = 0;
+                $includeFilesWithSize = array();
+                foreach ( $includeFiles as $key=>$includeFile ) {
+                    if ( is_file( $includeFile ) ) {
+                        $includeFilesSize += filesize( $includeFile );
+                        $includeFilesWithSize[ filesize( $includeFile ) ] = realpath( $includeFile );
+                    }
+                }
+                $includeFilesSize = YDStringUtil::formatFileSize( $includeFilesSize );
+
+                // Sort the list of include files by file size
+                krsort( $includeFilesWithSize );
+
+                // Convert to a string
+                $includeFiles = array();
+                foreach ( $includeFilesWithSize as $size=>$file ) {
+                    array_push( $includeFiles, YDStringUtil::formatFileSize( $size ) . "\t  " . realpath( $file ) );
+                }
+
+                // Create the debug messages
+                $debug = YD_CRLF . YD_CRLF . YD_FW_NAMEVERS . ' DEBUG INFORMATION ' . YD_CRLF . YD_CRLF;
+
+                // Create the timings report
+                $debug .= 'PROCESSING TIME:' . YD_CRLF . YD_CRLF;
+                $debug .= "    Elapsed\t  Diff\t  Marker" . YD_CRLF;
+                $timings = $GLOBALS['timer']->getReport();
+                foreach ( $timings as $timing ) {
+                    $debug .= "    " . $timing[0] . ' ms' . "\t  " . $timing[1] . ' ms' . "\t  " .$timing[2] . YD_CRLF;
+                }
+                $debug .= YD_CRLF;
+
+                // Create the include file details
+                $debug .= 'INCLUDED FILES (' . sizeof( $includeFiles ) . ' files - ' . $includeFilesSize . ')' . YD_CRLF . YD_CRLF;
+                $debug .= "    " . implode( "\n    ", $includeFiles ) . YD_CRLF . YD_CRLF;
+
+                // Add the queries if any
+                if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
+                    $debug .= 'EXECUTED SQL QUERIES (' . sizeof( $GLOBALS['YD_SQL_QUERY'] ) . ' queries)' . YD_CRLF . YD_CRLF;
+                    foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
+                        $debug .= "    " . '---- SQL QUERY ' . ($key+1) . ' ----' . YD_CRLF;
+                        foreach ( explode( YD_CRLF, trim( $query['trace'] ) ) as $line ) {
+                            $debug .= "    " . rtrim( $line ) . YD_CRLF;
+                        }
+                        $debug .= YD_CRLF . "    SQL Query:" . YD_CRLF;
+                        foreach ( explode( YD_CRLF, trim( $query['sql'] ) ) as $line ) {
+                            $debug .= "        " . rtrim( $line ) . YD_CRLF;
+                        }
+                        $debug .= YD_CRLF . "    Query Time: " . $query['time'] . ' ms' . YD_CRLF;
+                        $debug .= YD_CRLF;
+                    }
+                }
+
+                // Output the debug message
+                YDDebugUtil::debug( $debug );
+
+            }
+
+            // Output visible debug info
+            if ( YDConfig::get( 'YD_DEBUG' ) == 2 ) {
+
+                // Total size of include files
+                $includeFiles = get_included_files();
+
+                // Calculate the total size
+                $includeFilesSize = 0;
+                $includeFilesWithSize = array();
+                foreach ( $includeFiles as $key=>$includeFile ) {
+                    if ( is_file( $includeFile ) ) {
+                        $includeFilesSize += filesize( $includeFile );
+                        $includeFilesWithSize[ filesize( $includeFile ) ] = realpath( $includeFile );
+                    }
+                }
+                $includeFilesSize = YDStringUtil::formatFileSize( $includeFilesSize );
+
+                // Sort the list of include files by file size
+                krsort( $includeFilesWithSize );
+
+                // Get the timing report
+                $timings = $GLOBALS['timer']->getReport();
+
+                // The font to use for the debug output
+                $font = ' style="font-family: Arial, Helvetica, sans-serif; text-align: left; vertical-align: top;"';
+
+                // Include the needed libraries
+                $debug  = '';
+
+                // Create the output
+                $debug .= '<br clear="all"/><hr size="1"/>';
+                $debug .= '<p ' . $font . '><b>' . YD_FW_NAMEVERS . ' Debug Information</b></p>';
+
+                // Add the processing time
+                $debug .= '<p ' . $font . '><i>Processing time</i></p>';
+                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                $debug .= sprintf(
+                    '<tr><th %s>Elapsed</th><th %s>Diff</th><th %s>Marker</th></tr>',
+                    $font, $font, $font
+                );
+                foreach ( $timings as $timing ) {
+                    $debug .= sprintf(
+                        '<tr><td %s>%s ms</td><td %s>%s ms</td><td %s>%s</td></tr>',
+                        $font, $timing[0], $font, $timing[0], $font, $timing[2]
+                    );
+                }
+                $debug .= '</table></p></dd>';
+
+                // Add the included files
+                $debug .= '<p ' . $font . '><i>Included files (' . $includeFilesSize . ')</i></p>';
+                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                $debug .= sprintf( '<tr><th %s>File</th><th %s>Size</th></tr>', $font, $font );
+                foreach ( $includeFilesWithSize as $size=>$file ) {
+                    $debug .= sprintf(
+                        '<tr><td %s>%s</td><td %s>%s</td></tr>',
+                        $font, realpath( $file ), $font, YDStringUtil::formatFileSize( $size )
+                    );
+                }
+                $debug .= '</table></p></dd>';
+
+                // Add the query log
+                if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
+                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShMain"></script>';
+                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShSql"></script>';
+                    $debug .= '<link rel="stylesheet" href="' . YD_SELF_SCRIPT . '?do=CssShStyle" type="text/css" />';
+                    $debug .= sprintf(
+                        '<p ' . $font . '><i>SQL Query Log (%s queries)</i></p>',
+                        sizeof( $GLOBALS['YD_SQL_QUERY'] )
+                    );
+                    $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
+                    $debug .= sprintf(
+                        '<tr><th %s>Query #</th><th %s>Trace</th><th %s>SQL Statement</th><th %s>Elapsed</th></tr>',
+                        $font, $font, $font, $font );
+                    foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
+                        $debug .= sprintf(
+                            '<tr><td width="5%%" %s>%s</td><td width="15%%" %s>%s ms</td><td width="40%%" %s><pre>%s</pre></td><td width="40%%" %s><pre class="sh_sql">%s</pre></td></tr>',
+                            $font, $key, $font, $query['time'], $font, $query['trace'], $font, $query['sql']
+                        );
+                    }
+                    $debug .= '</table></p></dd>';
+                    $debug .= '<script>sh_highlightDocument();</script>';
+                    $debug .= '<script>sh_highlightDocument();</script>';
+                }
+
+                // Add the elapsed time
+                $debug .= '<p ' . $font . '><i>Elapsed Time</i></p>';
+                $debug .= '<dd><p>' . $GLOBALS['timer']->getElapsed() . ' ms</p></dd>';
+
+                // Output the debug message
+                echo( $debug );
+
+            }
+
+            // Add the elapsed time
+            die( YD_CRLF . '<!-- ' . $GLOBALS['timer']->getElapsed() . ' ms -->' );
+
+        }
+
+    }
+
     // Add if not exists yet
     if ( ! function_exists( 'str_ireplace' ) ) {
 

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_process.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-25 13:02:29 UTC (rev 2367)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_process.php	2007-01-27 18:21:15 UTC (rev 2368)
@@ -33,263 +33,6 @@
     // Auto execute config value. Default: true.
     YDConfig::set( 'YD_AUTO_EXECUTE', true, false );
 
-    /**
-     *	This is the executor class that contains all the logic for executing requests. It will instantiate the request
-     *	class and execute the right functions to get the request processed correctly.
-     *
-     *  @ingroup YDFramework
-     */
-    class YDExecutor extends YDBase {
-
-        /**
-         *	The class constructor for the YDExecutor class.
-         *
-         *	@param $file	Full path to the file that contains the request.
-         */
-        function YDExecutor( $file ) {
-            $this->_file = $file;
-        }
-
-        /**
-         *	The execute function will start the YDExecutor class and process the request.
-         */
-        function execute() {
-
-            // Do nothing if we already processed a request
-            if ( defined( 'YD_REQ_PROCESSED' ) ) {
-                return;
-            }
-
-            // Construct the name of the request class
-            $clsName = basename( $this->_file, YD_SCR_EXT );
-            $this->clsInst = new $clsName();
-
-            // Check if the object a YDRequest object
-            if ( ! YDObjectUtil::isSubClass( $this->clsInst, 'YDRequest' ) ) {
-                $ancestors = YDObjectUtil::getAncestors( $this->clsInst );
-                trigger_error(
-                    'Class "' . $clsName . '" should be derived from the YDRequest class. Currently, this class has the '
-                    . 'following ancestors: ' . implode( ' -&gt; ', $ancestors ), YD_ERROR
-                );
-            }
-
-            // Check if the class is properly initialized
-            if ( $this->clsInst->isInitialized() != true ) {
-                trigger_error(
-                    'Class "' . $clsName . '" is not initialized properly. Make  sure loaded the base class YDRequest '
-                    . 'and initialized it.', YD_ERROR
-                );
-            }
-
-            // Only if authentication is required
-            if ( $this->clsInst->getRequiresAuthentication() ) {
-                $result = $this->clsInst->isAuthenticated();
-                if ( $result ) {
-                    $this->clsInst->authenticationSucceeded();
-                } else {
-                    $this->clsInst->authenticationFailed();
-                    $this->finish();
-                }
-            }
-
-            // Get the action name
-            $action = 'action' . $this->clsInst->getActionName();
-
-            // Check if the action exists
-            if ( ! $this->clsInst->hasMethod( $action ) ) {
-                $this->clsInst->errorMissingAction( $action );
-                $this->finish();
-            }
-
-            // Check if the current action is allowed or not and execute errorActionNotAllowed if failed
-            if ( ! $this->clsInst->isActionAllowed() ) {
-                $this->clsInst->errorActionNotAllowed();
-                $this->finish();
-            }
-
-            // Process the request
-            $this->clsInst->process();
-            $this->finish();
-
-        }
-
-        /**
-         *	This is the function we use for finishing the request.
-         *
-         *	@internal
-         */
-        function finish() {
-
-            // Mark that the request is processed
-            define( 'YD_REQ_PROCESSED', 1 );
-
-            // Stop the timer
-            $GLOBALS['timer']->finish();
-
-            // Output visible debug info as a comment
-            if ( YDConfig::get( 'YD_DEBUG' ) == 1 ) {
-
-                // Total size of include files
-                $includeFiles = get_included_files();
-
-                // Calculate the total size
-                $includeFilesSize = 0;
-                $includeFilesWithSize = array();
-                foreach ( $includeFiles as $key=>$includeFile ) {
-                    if ( is_file( $includeFile ) ) {
-                        $includeFilesSize += filesize( $includeFile );
-                        $includeFilesWithSize[ filesize( $includeFile ) ] = realpath( $includeFile );
-                    }
-                }
-                $includeFilesSize = YDStringUtil::formatFileSize( $includeFilesSize );
-
-                // Sort the list of include files by file size
-                krsort( $includeFilesWithSize );
-
-                // Convert to a string
-                $includeFiles = array();
-                foreach ( $includeFilesWithSize as $size=>$file ) {
-                    array_push( $includeFiles, YDStringUtil::formatFileSize( $size ) . "\t  " . realpath( $file ) );
-                }
-
-                // Create the debug messages
-                $debug = YD_CRLF . YD_CRLF . YD_FW_NAMEVERS . ' DEBUG INFORMATION ' . YD_CRLF . YD_CRLF;
-
-                // Create the timings report
-                $debug .= 'PROCESSING TIME:' . YD_CRLF . YD_CRLF;
-                $debug .= "    Elapsed\t  Diff\t  Marker" . YD_CRLF;
-                $timings = $GLOBALS['timer']->getReport();
-                foreach ( $timings as $timing ) {
-                    $debug .= "    " . $timing[0] . ' ms' . "\t  " . $timing[1] . ' ms' . "\t  " .$timing[2] . YD_CRLF;
-                }
-                $debug .= YD_CRLF;
-
-                // Create the include file details
-                $debug .= 'INCLUDED FILES (' . sizeof( $includeFiles ) . ' files - ' . $includeFilesSize . ')' . YD_CRLF . YD_CRLF;
-                $debug .= "    " . implode( "\n    ", $includeFiles ) . YD_CRLF . YD_CRLF;
-
-                // Add the queries if any
-                if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
-                    $debug .= 'EXECUTED SQL QUERIES (' . sizeof( $GLOBALS['YD_SQL_QUERY'] ) . ' queries)' . YD_CRLF . YD_CRLF;
-                    foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
-                        $debug .= "    " . '---- SQL QUERY ' . ($key+1) . ' ----' . YD_CRLF;
-                        foreach ( explode( YD_CRLF, trim( $query['trace'] ) ) as $line ) {
-                            $debug .= "    " . rtrim( $line ) . YD_CRLF;
-                        }
-                        $debug .= YD_CRLF . "    SQL Query:" . YD_CRLF;
-                        foreach ( explode( YD_CRLF, trim( $query['sql'] ) ) as $line ) {
-                            $debug .= "        " . rtrim( $line ) . YD_CRLF;
-                        }
-                        $debug .= YD_CRLF . "    Query Time: " . $query['time'] . ' ms' . YD_CRLF;
-                        $debug .= YD_CRLF;
-                    }
-                }
-
-                // Output the debug message
-                YDDebugUtil::debug( $debug );
-
-            }
-
-            // Output visible debug info
-            if ( YDConfig::get( 'YD_DEBUG' ) == 2 ) {
-
-                // Total size of include files
-                $includeFiles = get_included_files();
-
-                // Calculate the total size
-                $includeFilesSize = 0;
-                $includeFilesWithSize = array();
-                foreach ( $includeFiles as $key=>$includeFile ) {
-                    if ( is_file( $includeFile ) ) {
-                        $includeFilesSize += filesize( $includeFile );
-                        $includeFilesWithSize[ filesize( $includeFile ) ] = realpath( $includeFile );
-                    }
-                }
-                $includeFilesSize = YDStringUtil::formatFileSize( $includeFilesSize );
-
-                // Sort the list of include files by file size
-                krsort( $includeFilesWithSize );
-
-                // Get the timing report
-                $timings = $GLOBALS['timer']->getReport();
-
-                // The font to use for the debug output
-                $font = ' style="font-family: Arial, Helvetica, sans-serif; text-align: left; vertical-align: top;"';
-
-                // Include the needed libraries
-                $debug  = '';
-
-                // Create the output
-                $debug .= '<br clear="all"/><hr size="1"/>';
-                $debug .= '<p ' . $font . '><b>' . YD_FW_NAMEVERS . ' Debug Information</b></p>';
-
-                // Add the processing time
-                $debug .= '<p ' . $font . '><i>Processing time</i></p>';
-                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
-                $debug .= sprintf(
-                    '<tr><th %s>Elapsed</th><th %s>Diff</th><th %s>Marker</th></tr>',
-                    $font, $font, $font
-                );
-                foreach ( $timings as $timing ) {
-                    $debug .= sprintf(
-                        '<tr><td %s>%s ms</td><td %s>%s ms</td><td %s>%s</td></tr>',
-                        $font, $timing[0], $font, $timing[0], $font, $timing[2]
-                    );
-                }
-                $debug .= '</table></p></dd>';
-
-                // Add the included files
-                $debug .= '<p ' . $font . '><i>Included files (' . $includeFilesSize . ')</i></p>';
-                $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
-                $debug .= sprintf( '<tr><th %s>File</th><th %s>Size</th></tr>', $font, $font );
-                foreach ( $includeFilesWithSize as $size=>$file ) {
-                    $debug .= sprintf(
-                        '<tr><td %s>%s</td><td %s>%s</td></tr>',
-                        $font, realpath( $file ), $font, YDStringUtil::formatFileSize( $size )
-                    );
-                }
-                $debug .= '</table></p></dd>';
-
-                // Add the query log
-                if ( sizeof( $GLOBALS['YD_SQL_QUERY'] ) > 0 ) {
-                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShMain"></script>';
-                    $debug .= '<script src="' . YD_SELF_SCRIPT . '?do=JsShSql"></script>';
-                    $debug .= '<link rel="stylesheet" href="' . YD_SELF_SCRIPT . '?do=CssShStyle" type="text/css" />';
-                    $debug .= sprintf(
-                        '<p ' . $font . '><i>SQL Query Log (%s queries)</i></p>',
-                        sizeof( $GLOBALS['YD_SQL_QUERY'] )
-                    );
-                    $debug .= '<dd><p><table width="90%" border="1" cellspacing="0" cellpadding="2">';
-                    $debug .= sprintf(
-                        '<tr><th %s>Query #</th><th %s>Trace</th><th %s>SQL Statement</th><th %s>Elapsed</th></tr>',
-                        $font, $font, $font, $font );
-                    foreach ( $GLOBALS['YD_SQL_QUERY'] as $key=>$query ) {
-                        $debug .= sprintf(
-                            '<tr><td width="5%%" %s>%s</td><td width="15%%" %s>%s ms</td><td width="40%%" %s><pre>%s</pre></td><td width="40%%" %s><pre class="sh_sql">%s</pre></td></tr>',
-                            $font, $key, $font, $query['time'], $font, $query['trace'], $font, $query['sql']
-                        );
-                    }
-                    $debug .= '</table></p></dd>';
-                    $debug .= '<script>sh_highlightDocument();</script>';
-                    $debug .= '<script>sh_highlightDocument();</script>';
-                }
-
-                // Add the elapsed time
-                $debug .= '<p ' . $font . '><i>Elapsed Time</i></p>';
-                $debug .= '<dd><p>' . $GLOBALS['timer']->getElapsed() . ' ms</p></dd>';
-
-                // Output the debug message
-                echo( $debug );
-
-            }
-
-            // Add the elapsed time
-            die( YD_CRLF . '<!-- ' . $GLOBALS['timer']->getElapsed() . ' ms -->' );
-
-        }
-
-    }
-
     // Check if we need to auto execute
     if ( YDConfig::get( 'YD_AUTO_EXECUTE', true ) == true ) { 
         $clsInst = new YDExecutor( YD_SELF_FILE );



From pclaerhout at mail.berlios.de  Sat Jan 27 19:32:15 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sat, 27 Jan 2007 19:32:15 +0100
Subject: [ydf-devel] r2369 - in YDFramework2.0/trunk:
	YDFramework2/addons/YDSimpleCMS examples/simplecms/includes
	examples/simplecms/includes/skins_admin
	examples/simplecms/includes/skins_public/default
Message-ID: <200701271832.l0RIWFWe016855@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-27 19:32:07 +0100 (Sat, 27 Jan 2007)
New Revision: 2369

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
   YDFramework2.0/trunk/examples/simplecms/includes/config.php
   YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
   YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
Log:
Did some code cleanup for YDSimpleCMS.
- The content of the masterpage is now inserted via a template variable.
- Cleaned up the names of the constants
- Disabled the language items for now
- Cleaned up the initialization code

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-27 18:21:15 UTC (rev 2368)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-27 18:32:07 UTC (rev 2369)
@@ -42,18 +42,18 @@
 
     // Constants
     define( 'YD_SIMPLECMS_PACKAGE_NAME',   'YD_SIMPLECMS' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_ACTION_PREFIX',  'action_' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_PREFIX',  'module_' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_EXT',     '.php' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_PUBLIC',   'public' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_SCOPE_ADMIN',    'admin' );
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE',  YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE' );
+    define( 'YD_SIMPLECMS_ACTION_PREFIX',  'action_' );
+    define( 'YD_SIMPLECMS_MODULE_PREFIX',  'module_' );
+    define( 'YD_SIMPLECMS_MODULE_EXT',     '.php' );
+    define( 'YD_SIMPLECMS_MODULE_PATTERN', YD_SIMPLECMS_MODULE_PREFIX . '*' . YD_SIMPLECMS_MODULE_EXT );
+    define( 'YD_SIMPLECMS_MODULE_DIR',     dirname( YD_SELF_FILE ) . '/includes/modules' );
+    define( 'YD_SIMPLECMS_SKINS_DIR',      dirname( YD_SELF_FILE ) . '/includes/skins_' );
+    define( 'YD_SIMPLECMS_SCOPE_PUBLIC',   'public' );
+    define( 'YD_SIMPLECMS_SCOPE_ADMIN',    'admin' );
+    define( 'YD_SIMPLECMS_SITE_LANGUAGE',  YD_SIMPLECMS_PACKAGE_NAME . '_SITE_LANGUAGE' );
 
     // Versions and numbers
-    define( YD_SIMPLECMS_PACKAGE_NAME . '_NAME', 'Yellow Duck Content Manager' );
+    define( 'YD_SIMPLECMS_NAME', 'Yellow Duck Content Manager' );
 
     // Configuration
     YDConfig::set( 'YD_AUTO_EXECUTE', false );
@@ -63,7 +63,6 @@
     include_once( YD_DIR_HOME_CLS . '/YDRequest.php' );
     include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
     include_once( YD_DIR_HOME_CLS . '/YDTemplate.php' );
-    include_once( YD_DIR_HOME_CLS . '/YDFileSystem.php' );
     include_once( YD_DIR_HOME . '/YDF2_process.php' );
     include_once( dirname( __FILE__ ) . '/YDSimpleCMS_CoreModules.php' );
 
@@ -106,70 +105,71 @@
 
                 // Create the array
                 $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME] = array();
+                $settings = & $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME];
 
                 // Setup the database connection
                 YDConfig::set( 'YD_DB_TABLEPREFIX', YDConfig::get( 'db_prefix' ) );
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['db'] = YDDatabase::getInstance(
+                $settings['db'] = YDDatabase::getInstance(
                     'mysql',
                     YDConfig::get( 'db_name' ), YDConfig::get( 'db_user' ),
                     YDConfig::get( 'db_pass' ), YDConfig::get( 'db_host' )
                 );
 
                 // The global list with admin menu
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['adminMenu'] = array();
+                $settings['adminMenu'] = array();
 
                 // The current user
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['currentUser'] = null;
+                $settings['currentUser'] = null;
 
                 // The module manager instance
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager'] = new YDSimpleCMSModuleManager();
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['moduleManager']->loadAllModules();
+                $settings['moduleManager'] = new YDSimpleCMSModuleManager();
+                $settings['moduleManager']->loadAllModules();
 
                 // Set the default scope
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['scope'] = YD_SIMPLECMS_SCOPE_PUBLIC;
+                $settings['scope'] = YD_SIMPLECMS_SCOPE_PUBLIC;
 
                 // Get the site Id
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['siteId'] = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
+                $settings['siteId'] = YDConfig::get( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
 
                 // Create a browser information object
-                $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['browserInfo'] = new YDBrowserInfo();
-                $browserInfo = & $GLOBALS[YD_SIMPLECMS_PACKAGE_NAME]['browserInfo'];
+                $settings['browserInfo'] = new YDBrowserInfo();
+                $browserInfo = & $settings['browserInfo'];
 
-                // -- Negotiate the language --
-                // Set the list of languages and the default language
-                $language = YDConfig::get( 'site_default_lang', '' );
-                $languages = array();
-
-                // Get the current URL
-                $url = new YDUrl( YDRequest::getNormalizedCurrentUrl() );
-
-                // Get the list of languages
-                foreach ( array_slice( YDConfig::get( 'site_languages', array() ), 0, 4 ) as $key=>$lang ) {
-                    if ( ! empty( $lang[0] ) ) {
-                        $lang[0] = strtolower( $lang[0] );
-                        $url->setQueryVar( 'lang', $lang[0] );
-                        $languages[ $lang[0] ] = array(
-                            'name' => $lang[1], 'idx' => $key + 1, 'code' => $lang[0], 'url' => $url->getUrl(),
-                        );
-                    }
-                }
-
-                // Get the current language
-                $languages = array_keys( $languages );
-                $lang = $browserInfo->getLanguage( $languages );
-                $languageCookieName = YD_SIMPLECMS_PACKAGE_NAME . '_' . YDSimpleCms::getSiteId() . '_LANG';
-                if ( YDRequest::getCookie( $languageCookieName, '', $languages ) != '' ) {
-                    $lang = YDRequest::getCookie( $languageCookieName, '', $languages );
-                }
-                //if ( $this->getQueryStringParameter( 'lang', '', $languages ) != '' ) {
-                //    $lang = $this->getQueryStringParameter( 'lang', '', $languages );
-                //}
-                $lang = strtolower( $lang );
-
-                // Set the right locale
-                YDLocale::set( $lang );
-
-                //YDDebugUtil::dump( $language, 'language' );
+//                // -- Negotiate the language --
+//                // Set the list of languages and the default language
+//                $language = YDConfig::get( 'site_default_lang', '' );
+//                $languages = array();
+//
+//                // Get the current URL
+//                $url = new YDUrl( YDRequest::getNormalizedCurrentUrl() );
+//
+//                // Get the list of languages
+//                foreach ( array_slice( YDConfig::get( 'site_languages', array() ), 0, 4 ) as $key=>$lang ) {
+//                    if ( ! empty( $lang[0] ) ) {
+//                        $lang[0] = strtolower( $lang[0] );
+//                        $url->setQueryVar( 'lang', $lang[0] );
+//                        $languages[ $lang[0] ] = array(
+//                            'name' => $lang[1], 'idx' => $key + 1, 'code' => $lang[0], 'url' => $url->getUrl(),
+//                        );
+//                    }
+//                }
+//
+//                // Get the current language
+//                $languages = array_keys( $languages );
+//                $lang = $browserInfo->getLanguage( $languages );
+//                $languageCookieName = YD_SIMPLECMS_PACKAGE_NAME . '_' . YDSimpleCms::getSiteId() . '_LANG';
+//                if ( YDRequest::getCookie( $languageCookieName, '', $languages ) != '' ) {
+//                    $lang = YDRequest::getCookie( $languageCookieName, '', $languages );
+//                }
+//                //if ( $this->getQueryStringParameter( 'lang', '', $languages ) != '' ) {
+//                //    $lang = $this->getQueryStringParameter( 'lang', '', $languages );
+//                //}
+//                $lang = strtolower( $lang );
+//
+//                // Set the right locale
+//                YDLocale::set( $lang );
+//
+//                //YDDebugUtil::dump( $language, 'language' );
                 //YDDebugUtil::dump( $languages, 'languages' );
 
             }
@@ -445,8 +445,9 @@
 
             // Check if there is a __standard page
             if ( is_file( $this->template_dir . '/' . $master . '.tpl' ) ) {
-                $standard = $this->fetch( $master );
-                $output = str_replace( '##content##', $output, $standard );
+                $this->assign( 'content', $output );
+                $output = $this->fetch( $master );
+                //$output = str_replace( '##content##', $output, $standard );
             }
 
             // Return the output
@@ -839,9 +840,8 @@
          */
         function loadAllModules() {
             if ( is_dir( YD_SIMPLECMS_MODULE_DIR ) ) {
-                $modulesDir = new YDFSDirectory( YD_SIMPLECMS_MODULE_DIR );
-                foreach ( $modulesDir->getContents( YD_SIMPLECMS_MODULE_PATTERN ) as $module ) {
-                    include_once( $module->getAbsolutePath() );
+                foreach ( glob( YD_SIMPLECMS_MODULE_DIR . '/' . YD_SIMPLECMS_MODULE_PATTERN ) as $module ) {
+                    include_once( $module );
                 }
             }
         }

Modified: YDFramework2.0/trunk/examples/simplecms/includes/config.php
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-27 18:21:15 UTC (rev 2368)
+++ YDFramework2.0/trunk/examples/simplecms/includes/config.php	2007-01-27 18:32:07 UTC (rev 2369)
@@ -2,7 +2,7 @@
 
     // The generic settings
     YDConfig::set( 'YD_SIMPLECMS_SITEID', 'SAMPLESITE' );
-    YDConfig::set( 'YD_DEBUG', 2 );
+    YDConfig::set( 'YD_DEBUG', 1 );
     YDConfig::set( 'YD_SIMPLECMS_PUBLIC_SKIN', 'default' );
 
     // The database settings

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-27 18:21:15 UTC (rev 2368)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_admin/__master.tpl	2007-01-27 18:32:07 UTC (rev 2369)
@@ -68,7 +68,7 @@
             {/if}
         </td>
         <td align="left" valign="top">
-            ##content##
+            {$content}
             <p class="subline">
                 &nbsp<br/>
                 {t w="powered_by"} <a href="{$YD_FW_HOMEPAGE}" class="subline" target="_blank">{$YD_FW_NAME}</a>

Modified: YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl
===================================================================
--- YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-27 18:21:15 UTC (rev 2368)
+++ YDFramework2.0/trunk/examples/simplecms/includes/skins_public/default/__master.tpl	2007-01-27 18:32:07 UTC (rev 2369)
@@ -16,7 +16,7 @@
         </p>
     {/if}
 
-    ##content##
+    {$content}
 
     <small>{$YD_FW_POWERED_BY}</small>
 



From pclaerhout at mail.berlios.de  Sat Jan 27 19:34:37 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sat, 27 Jan 2007 19:34:37 +0100
Subject: [ydf-devel] r2370 -
	YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS
Message-ID: <200701271834.l0RIYbIF017023@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-27 19:34:34 +0100 (Sat, 27 Jan 2007)
New Revision: 2370

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
Log:
Added an extra not to for the language stuff of YDSimpleCMS.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-27 18:32:07 UTC (rev 2369)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDSimpleCMS/YDSimpleCMS.php	2007-01-27 18:34:34 UTC (rev 2370)
@@ -96,6 +96,9 @@
          *  @todo
          *      Negotiate the language and put it as an array under $GLOBALS['YD_SIMPLECMS']['languages']
          *
+         *  @todo
+         *      Language settings should be specific for each scope
+         *
          *  @static
          */
         function initialize() {



From pclaerhout at mail.berlios.de  Sun Jan 28 19:46:39 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sun, 28 Jan 2007 19:46:39 +0100
Subject: [ydf-devel] r2371 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDDatabaseDrivers
Message-ID: <200701281846.l0SIkd2p005133@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-28 19:46:33 +0100 (Sun, 28 Jan 2007)
New Revision: 2371

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
Log:
Fixed the database drivers as they were not using the language prefix.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-27 18:34:34 UTC (rev 2370)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-01-28 18:46:33 UTC (rev 2371)
@@ -1294,12 +1294,6 @@
                 $sql = str_replace( ':' . ($key+1), $this->escapeSql( $arg ), $sql );
             }
 
-            // Update the language placeholders
-            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
-            if ( ! is_null( $languageIndex ) ) {
-                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
-            }
-
             // Return the SQL statement
             return $sql;
 
@@ -1776,6 +1770,12 @@
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
             $sql = str_replace( ' `#_', ' `' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
+            // Update the language placeholders
+            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
+            if ( ! is_null( $languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
+            }
+
             // Connect
             $result = $this->connect();
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-27 18:34:34 UTC (rev 2370)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_oracle.php	2007-01-28 18:46:33 UTC (rev 2371)
@@ -270,6 +270,12 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
+            // Update the language placeholders
+            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
+            if ( ! is_null( $languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
+            }
+
             // Connect
             $result = $this->connect();
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-27 18:34:34 UTC (rev 2370)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_postgres.php	2007-01-28 18:46:33 UTC (rev 2371)
@@ -202,6 +202,12 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
+            // Update the language placeholders
+            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
+            if ( ! is_null( $languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
+            }
+
             // Connect
             $result = $this->connect();
 

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-27 18:34:34 UTC (rev 2370)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseDrivers/YDDatabaseDriver_sqlite.php	2007-01-28 18:46:33 UTC (rev 2371)
@@ -210,6 +210,12 @@
             // Add the table prefix
             $sql = str_replace( ' #_', ' ' . YDConfig::get( 'YD_DB_TABLEPREFIX', '' ), $sql );
 
+            // Update the language placeholders
+            $languageIndex = YDConfig::get( 'YD_DB_LANGUAGE_INDEX', null );
+            if ( ! is_null( $languageIndex ) ) {
+                $sql = str_replace( '_@', '_' . $languageIndex, $sql );
+            }
+
             // Handle errors
             if ( ! $result && $this->_failOnError === true ) {
                 trigger_error( $GLOBALS['YD_SQLITE_error'], YD_ERROR );



From pclaerhout at mail.berlios.de  Sun Jan 28 20:14:15 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sun, 28 Jan 2007 20:14:15 +0100
Subject: [ydf-devel] r2372 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormRenderers
Message-ID: <200701281914.l0SJEFNn006443@sheep.berlios.de>

Author: pclaerhout
Date: 2007-01-28 20:14:11 +0100 (Sun, 28 Jan 2007)
New Revision: 2372

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
Log:
Added support for selecting the default form field.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-28 18:46:33 UTC (rev 2371)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-01-28 19:14:11 UTC (rev 2372)
@@ -70,6 +70,7 @@
             $this->_target = empty( $target ) ? '_self' : $target;
             $this->_attributes = $attributes;
             $this->_legend = null;
+            $this->_defaultItem = null;
 
             // The list of known elements, rules, filters and validators
             $this->_regElements = array();
@@ -362,6 +363,15 @@
         }
 
         /**
+         *  This function set the default item for the form.
+         *
+         *  @param $name   The name of the default form item.
+         */
+        function setDefaultItem( $name ) {
+            $this->_defaultItem = $name;
+        }
+
+        /**
          *  This function will add a new element to the form.
          *
          *  @param $type        The type of element to add.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-28 18:46:33 UTC (rev 2371)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_array.php	2007-01-28 19:14:11 UTC (rev 2372)
@@ -80,6 +80,18 @@
             $form['name']   = $this->_form->_name;
             $form['legend'] = $this->_form->_legend;
 
+            // Add a script for the default item
+            if (
+                ! empty( $this->_form->_defaultItem )
+                &&
+                array_key_exists( $this->_form->_defaultItem, $this->_form->_elements )
+            ) {
+                $form['endtag'] .= sprintf(
+                    '<script type="text/javascript">document.getElementById("%s").focus();</script>',
+                    addslashes( $this->_form->_name . '_' . $this->_form->_defaultItem )
+                 );
+            }
+
             // Add the fieldset and legend tag if any
             if ( ! empty( $this->_form->_legend ) ) {
 



From ximian at mail.berlios.de  Mon Jan 29 23:37:08 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Mon, 29 Jan 2007 23:37:08 +0100
Subject: [ydf-devel] r2373 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200701292237.l0TMb8oi014728@sheep.berlios.de>

Author: ximian
Date: 2007-01-29 23:36:59 +0100 (Mon, 29 Jan 2007)
New Revision: 2373

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
Log:
on form element RADIO
 - FIX: each radio element must have a unique id (and the the parent id)
 - FIX: each radio value is a html label of the previous unique id

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-28 19:14:11 UTC (rev 2372)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-29 22:36:59 UTC (rev 2373)
@@ -82,14 +82,15 @@
                 foreach ( $this->_options as $key=>$val ) {
                     $attribsElement = $attribs;
                     $attribsElement['value'] = $key;
+                    $attribsElement['id'] .= $key;
                     if ( $this->_value == strval( $key ) ) {
                         $attribsElement['checked'] = 'checked';
                     }
-                    $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' />' . $val;
+                    $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' /><label for="' . $attribsElement['id'] . '">' . $val . '</label>';
 
                 }
             } else {
-                $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' />' . $this->_value;
+                $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' /><label for="' . $attribs['id'] . '">' . $this->_value . '</label>';
             }
 
             // Return the HTML



From ximian at mail.berlios.de  Tue Jan 30 00:55:36 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 30 Jan 2007 00:55:36 +0100
Subject: [ydf-devel] r2374 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200701292355.l0TNtaS8021751@sheep.berlios.de>

Author: ximian
Date: 2007-01-30 00:55:21 +0100 (Tue, 30 Jan 2007)
New Revision: 2374

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
Log:
on form element RADIO:
 - FEATURE: radio elements can be rendered in vertical, like in a poll

 eg,
 $form->addElement( 'radio', 'poll', 'Question?', array( 'sep' => 'v' ), $answers ); 

 



Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-29 22:36:59 UTC (rev 2373)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-01-29 23:55:21 UTC (rev 2374)
@@ -52,6 +52,15 @@
          */
         function YDFormElement_Radio( $form, $name, $label='', $attributes=array(), $options=array() ) {
 
+            // set default separator
+            $this->_separator = '';
+
+            // parse separator
+            if ( isset ( $attributes['sep'] ) && $attributes['sep'] == 'v' ) {
+                $this->_separator = '<br />';
+                unset( $attributes[ 'sep' ] );
+            }
+
             // Initialize the parent
             $this->YDFormElement( $form, $name, $label, $attributes, $options );
 
@@ -77,7 +86,7 @@
             $attribs = array_merge( $this->_attributes, $attribs );
 
             // Create the HTML
-            $out = '';
+            $out = array();
             if ( sizeof( $this->_options ) > 0 ) {
                 foreach ( $this->_options as $key=>$val ) {
                     $attribsElement = $attribs;
@@ -86,15 +95,15 @@
                     if ( $this->_value == strval( $key ) ) {
                         $attribsElement['checked'] = 'checked';
                     }
-                    $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' /><label for="' . $attribsElement['id'] . '">' . $val . '</label>';
+                    $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' /><label for="' . $attribsElement['id'] . '">' . $val . '</label>';
 
                 }
             } else {
-                $out .= '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' /><label for="' . $attribs['id'] . '">' . $this->_value . '</label>';
+                $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' /><label for="' . $attribs['id'] . '">' . $this->_value . '</label>';
             }
 
             // Return the HTML
-            return $out;
+            return implode( $this->_separator, $out );
 
         }
 



From ximian at mail.berlios.de  Tue Jan 30 01:01:28 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Tue, 30 Jan 2007 01:01:28 +0100
Subject: [ydf-devel] r2375 -
	YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig
Message-ID: <200701300001.l0U01SDB029709@sheep.berlios.de>

Author: ximian
Date: 2007-01-30 01:01:03 +0100 (Tue, 30 Jan 2007)
New Revision: 2375

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
Log:
added required lib to YDLoadconfig

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-29 23:55:21 UTC (rev 2374)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDLoadconfig/YDLoadconfig.php	2007-01-30 00:01:03 UTC (rev 2375)
@@ -31,6 +31,10 @@
     }
 
 
+	// load YD libs
+	require_once( YD_DIR_HOME_ADD . '/YDDatabaseObject/YDDatabaseObject.php' );
+
+
     /**
      *  This class reads a database table to apply correspondent YDConfig
      *
@@ -91,11 +95,11 @@
 			// clean possible previous results
 			$this->_results = array();
 
-            // cycle all tables to get their column names
+			// cycle all tables to get their column names
 			foreach( $this->_tables as $tablename => $columns ){
 
 				// copy default db object
-	            $db = $this->db;
+				$db = $this->db;
 
 				// register table
 				$db->registerTable( $tablename );
@@ -110,6 +114,8 @@
 				// add results
 				$this->_results = array_merge( $this->_results, $db->getResultsAsAssocArray( $columns[0], $columns[1] ) );
 			}
+			
+			return $this->_results;
         }
 
 



