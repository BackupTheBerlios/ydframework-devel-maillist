From ximian at mail.berlios.de  Fri Feb  2 00:37:18 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 2 Feb 2007 00:37:18 +0100
Subject: [ydf-devel] r2376 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702012337.l11NbI23000557@sheep.berlios.de>

Author: ximian
Date: 2007-02-02 00:37:07 +0100 (Fri, 02 Feb 2007)
New Revision: 2376

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
FIX: crop info was not used in thumb saving/reading. Fixed now.
     http://ydframework.berlios.de/forum/index.php?topic=29.0

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-01-30 00:01:03 UTC (rev 2375)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-01 23:37:07 UTC (rev 2376)
@@ -1056,7 +1056,7 @@
             }
 
             // Get the cache filename
-            $cacheFName = YD_DIR_TEMP . '/' . $this->_createThumbnailName( $width, $height );
+            $cacheFName = YD_DIR_TEMP . '/' . $this->_createThumbnailName( $width, $height, $crop );
 
             // Check if caching is enabled
             if ( $cache === true ) {
@@ -1239,9 +1239,10 @@
          *
          *	@param $width	The maximum width of the thumbnail.
          *	@param $height	The maximum height of the thumbnail.
+         *	@param $crop	Indicate if is the cropped version.
          */
-        function _createThumbnailName( $width, $height ) {
-            $cacheFName = $this->getAbsolutePath() . '/' . $width . '/' . $height . '/' . $this->getLastModified();
+        function _createThumbnailName( $width, $height, $crop ) {
+            $cacheFName = $this->getAbsolutePath() . '/' . $width . '/' . $height . '/' . strval( $crop ) . $this->getLastModified();
             $cacheFName = YD_TMP_PRE . 'N_' . md5( $cacheFName ) . '.' . strtolower( $this->getExtension() );
             return $cacheFName;
         }



From pclaerhout at mail.berlios.de  Fri Feb  2 10:41:05 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 10:41:05 +0100
Subject: [ydf-devel] r2377 -
	YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/contrib
Message-ID: <200702020941.l129f5eK014682@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 10:41:02 +0100 (Fri, 02 Feb 2007)
New Revision: 2377

Modified:
   YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/contrib/xmlrpc.php
Log:
Commented out some unreachable code.

Modified: YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/contrib/xmlrpc.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/contrib/xmlrpc.php	2007-02-01 23:37:07 UTC (rev 2376)
+++ YDFramework2.0/trunk/YDFramework2/3rdparty/upgrade/contrib/xmlrpc.php	2007-02-02 09:41:02 UTC (rev 2377)
@@ -288,7 +288,7 @@
    else {
       return xmlrpc_error(-32600, "xml+rpc: invalid response", 0, "GLBLVRS");
    }
-   return(NULL);
+   //return(NULL);
 }
 
 



From pclaerhout at mail.berlios.de  Fri Feb  2 10:41:48 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 10:41:48 +0100
Subject: [ydf-devel] r2378 -
	YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump
Message-ID: <200702020941.l129fmvu014705@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 10:41:46 +0100 (Fri, 02 Feb 2007)
New Revision: 2378

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
Log:
Fixed the include statement for YDMySqlDump

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-02-02 09:41:02 UTC (rev 2377)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDMysqlDump/YDMysqlDump.php	2007-02-02 09:41:46 UTC (rev 2378)
@@ -31,7 +31,7 @@
     }
 
 	// include filesystem functions
-	include_once( 'YDFileSystem.php' );
+	include_once( YD_DIR_HOME_CLS . '/YDFileSystem.php' );
 
 
     /**



From pclaerhout at mail.berlios.de  Fri Feb  2 10:43:00 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 10:43:00 +0100
Subject: [ydf-devel] r2379 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702020943.l129h048014773@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 10:42:58 +0100 (Fri, 02 Feb 2007)
New Revision: 2379

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
Fixed an SQL statement in YDDatabaseTree->getPath().

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-02 09:41:46 UTC (rev 2378)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-02 09:42:58 UTC (rev 2379)
@@ -558,9 +558,10 @@
             // Include ourselves?
             if ( $includeSelf ) {
                 $query = sprintf(
-                    'select %s from %s where %s.nleft <= %d and %s.nright >= %d order by %s.nlevel',
+                    'select %s from %s where ( %s.nleft <= %d and %s.nright >= %d ) or %s.id = %d order by %s.nlevel',
                     $this->_getFieldsAsString(), $this->_getTablesAsString(),
-                    $this->tablePrefix, $node['nleft'], $this->tablePrefix, $node['nright'], $this->tablePrefix
+                    $this->tablePrefix, $node['nleft'], $this->tablePrefix, $node['nright'], $this->tablePrefix,
+                    $id, $this->tablePrefix
                 );
             } else {
                 $query = sprintf(



From pclaerhout at mail.berlios.de  Fri Feb  2 10:44:02 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 10:44:02 +0100
Subject: [ydf-devel] r2380 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702020944.l129i2kc014807@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 10:44:00 +0100 (Fri, 02 Feb 2007)
New Revision: 2380

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
Fixed a reference to an undefined variable.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-02 09:42:58 UTC (rev 2379)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-02 09:44:00 UTC (rev 2380)
@@ -779,7 +779,7 @@
                     // Check if we need to raise an error
                     if ( $failOnError == true ) {
                         trigger_error(
-                            'Failed deleting the file "' . $file . '" from the directory "' . $this->getPath() . '".',
+                            'Failed deleting the file "' . $filename . '" from the directory "' . $this->getPath() . '".',
                             YD_ERROR
                         );
                     }



From pclaerhout at mail.berlios.de  Fri Feb  2 10:44:50 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 10:44:50 +0100
Subject: [ydf-devel] r2381 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702020944.l129iowq014826@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 10:44:46 +0100 (Fri, 02 Feb 2007)
New Revision: 2381

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
Removed the check to see if the form rule is callable as it wasn't always working (on my system).

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-02 09:44:00 UTC (rev 2380)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-02 09:44:46 UTC (rev 2381)
@@ -1023,10 +1023,10 @@
             // Apply the form rules
             foreach ( $this->_formrules as $rule ) {
 
-                // Check if the callback is valid
-                if ( ! is_callable( $rule[0] ) ) {
-                    trigger_error( 'The callback specified for the form "' . $rule[0] . '" is not valid', YD_ERROR );
-                }
+//                // Check if the callback is valid
+//                if ( ! is_callable( $rule[0] ) ) {
+//                    trigger_error( 'The callback specified for the form "' . $rule[0] . '" is not valid', YD_ERROR );
+//                }
 
                 // Get the form values
                 $values = $this->getValues();



From pclaerhout at mail.berlios.de  Fri Feb  2 13:51:15 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 13:51:15 +0100
Subject: [ydf-devel] r2382 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702021251.l12CpFV9003800@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 13:51:10 +0100 (Fri, 02 Feb 2007)
New Revision: 2382

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
Log:
Made getQueryStringParameter a static function.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-02-02 09:44:46 UTC (rev 2381)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDRequest.php	2007-02-02 12:51:10 UTC (rev 2382)
@@ -97,6 +97,8 @@
          *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
          *
          *  @returns    The value of the query string variable as a string.
+         * 
+         *  @static
          */
         function getQueryStringParameter( $name, $default='', $values=null, $use_keys=false ) {
             if ( isset( $_GET[$name] ) ) {
@@ -124,9 +126,11 @@
          *  @param  $use_keys   (optional) Use the keys from the values array instead of the values. Defaults to false.
          *
          *  @returns    The value of the query string variable as an integer.
+         * 
+         *  @static
          */
         function getQueryStringParameterAsInt( $name, $default=null, $values=null, $use_keys=false ) {
-            $value = $this->getQueryStringParameter( $name, $default, $values, $use_keys );
+            $value = YDRequest::getQueryStringParameter( $name, $default, $values, $use_keys );
             return is_numeric( $value ) ? intval( $value ) : $default;
         }
 



From pclaerhout at mail.berlios.de  Fri Feb  2 15:47:45 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 2 Feb 2007 15:47:45 +0100
Subject: [ydf-devel] r2383 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702021447.l12Eljee009934@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-02 15:47:41 +0100 (Fri, 02 Feb 2007)
New Revision: 2383

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
The YDDatabaseTree module now uses the table name as the prefix, which is much more logical than using a convention such as t1.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-02 12:51:10 UTC (rev 2382)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-02 14:47:41 UTC (rev 2383)
@@ -33,9 +33,6 @@
     // Includes
     include_once( YD_DIR_HOME_CLS . '/YDDatabase.php' );
 
-    // Configure the default for this class
-    YDConfig::set( 'YD_DBTREE_TABLEPREFIX', 't1', false );
-
     /**
      *  This class implements a database tree as described on:
      *  http://www.phpriot.com/d/articles/php/application-design/nested-trees-2/
@@ -135,7 +132,7 @@
         function YDDatabaseTree( $db='default', $table, $idField='id', $parentField='parent_id', $sortField='position, title' ) {
             $this->db = YDDatabase::getNamedInstance( $db );
             $this->table = $table;
-            $this->tablePrefix = YDConfig::get( 'YD_DBTREE_TABLEPREFIX', 't1' );
+            $this->tablePrefix = $table;
             $this->joins = array();
             $this->fields = array(
                 'id'        => $this->_addTablePrefix( $idField ),



From ximian at mail.berlios.de  Sat Feb  3 01:37:22 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 3 Feb 2007 01:37:22 +0100
Subject: [ydf-devel] r2384 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200702030037.l130bM9d023832@sheep.berlios.de>

Author: ximian
Date: 2007-02-03 01:37:06 +0100 (Sat, 03 Feb 2007)
New Revision: 2384

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
Log:
FIX: selectimage form element should not add a '.' prefix. 
     Now it's possible to define any post pattern.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-02-02 14:47:41 UTC (rev 2383)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-02-03 00:37:06 UTC (rev 2384)
@@ -65,7 +65,7 @@
 
 			// check if ext exist
 			if ( isset( $attributes['ext'] ) ){
-				$this->_img_ext = "." . $attributes['ext'];
+				$this->_img_ext = $attributes['ext'];
 				unset( $attributes['ext'] );
 			}
 



From ximian at mail.berlios.de  Sat Feb  3 22:36:04 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 3 Feb 2007 22:36:04 +0100
Subject: [ydf-devel] r2385 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200702032136.l13La4al022109@sheep.berlios.de>

Author: ximian
Date: 2007-02-03 22:35:34 +0100 (Sat, 03 Feb 2007)
New Revision: 2385

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
integrated YDLocale::gettext in YDLocale::set.. it depends on it. Now only YDLocale::set is needed


Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-03 00:37:06 UTC (rev 2384)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-03 21:35:34 UTC (rev 2385)
@@ -518,9 +518,11 @@
     class YDLocale extends YDBase {
 
         /**
-         *	@param	$locale	Sets the current locale
+         *	@param	$locale		Sets the current locale
+         *	@param	$domain		(Optional) Filename to search in locale directory
+         *	@param	$directory	(Optional) Directory name where language directories are stored
          */
-        function set( $locale ) {
+        function set( $locale, $domain = null, $directory = null ) {
 
             // Check if the locale exists or not
             if ( ! array_key_exists( strtolower( $locale ), $GLOBALS[ 'YD_LANGUAGES' ] ) ) {
@@ -543,6 +545,24 @@
             // Set the locale
             YDConfig::set( YD_LOCALE_KEY, $locale );
 
+            // check if we want to use gettext
+            if ( is_string( $domain ) ){
+
+                // set environment
+                $_ENV["LANG" ]      = $locale;
+                $_ENV["LANGUAGE"]   = $locale;
+                $_ENV["LC_MESSAGE"] = $locale;
+                $_ENV["LC_ALL"]     = $locale;
+
+                // added php5 environment flag
+                putenv( "LANGUAGE=" . $locale );
+
+                // set gettext domain
+                bindtextdomain( $domain, $directory );
+                textdomain( $domain );
+                return;
+            }
+
             // initialize t array
             if ( ! isset( $GLOBALS['t'] ) ) {
                 $GLOBALS['t'] = array();
@@ -554,36 +574,7 @@
                     @include( $dir . '/' . YDLocale::get() . '.php' );
         }
 
-
         /**
-         *	This method will activate gettext support
-         *
-         *	@param	$filename	(Optional) Filename to search in locale directory
-         *	@param	$directory	(Optional) Directory name where language directories are stored
-         */
-		function useGettext( $filename = 'ydframework', $directory = null ){
-
-			// get current locale
-			$locale = YDLocale::get();
-
-			// set environment
-			$_ENV["LANG" ]      = $locale;
-			$_ENV["LANGUAGE"]   = $locale;
-			$_ENV["LC_MESSAGE"] = $locale;
-			$_ENV["LC_ALL"]     = $locale;
-
-			// added php5 environment flag
-			putenv( "LANGUAGE=" . $locale );
-
-			// check directory
-			if ( ! is_string( $directory ) ) $directory = YD_DIR_HOME . '/locale/';
-
-			bindtextdomain( $filename, $directory );
-			textdomain( $filename );
-		}
-
-
-        /**
          *	@returns	The current locale.
          */
         function get() {



From ximian at mail.berlios.de  Sat Feb  3 22:39:55 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 3 Feb 2007 22:39:55 +0100
Subject: [ydf-devel] r2386 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200702032139.l13LdtbL022268@sheep.berlios.de>

Author: ximian
Date: 2007-02-03 22:39:27 +0100 (Sat, 03 Feb 2007)
New Revision: 2386

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
Log:
FIX: on a date element, if we defined a default year like '1980' it was not displayed 
     (because the interval is always between currentYear-5 and currentYear+5).
     Now, if year is smaller or bigger than the options interval, will be added to the options.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-02-03 21:35:34 UTC (rev 2385)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Date.php	2007-02-03 21:39:27 UTC (rev 2386)
@@ -472,9 +472,26 @@
             foreach ( $elements as $element ) {
                 $this->$element->_value = isset( $this->_value[ $element ] ) ? $this->_value[ $element ] : '';
             }
-            
+
+            // Check year value if belongs to options. If not, prepend or append that value to options
+            if( ! in_array( $this->year->_value, $this->year->_options ) ){
+                $years = array_keys( $this->year->_options );
+
+                if ( $this->year->_value < $years[0] ){
+                    array_unshift( $years, $this->year->_value );
+                }
+                elseif ( $this->year->_value > $years[ count ( $years ) - 1 ] ){
+                    array_push( $years, $this->year->_value );
+                }
+
+                $this->year->_options = array();
+
+                foreach( $years as $year ){
+                    $this->year->_options[ $year ] = $year;
+                }
+            }
+
             // Convert to HTML
-            
             $dates = array( 'day', 'month', 'year' );
             $times = array( 'hours', 'minutes', 'seconds' );
             



From ximian at mail.berlios.de  Sat Feb  3 22:41:55 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 3 Feb 2007 22:41:55 +0100
Subject: [ydf-devel] r2387 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200702032141.l13LftZv022391@sheep.berlios.de>

Author: ximian
Date: 2007-02-03 22:41:37 +0100 (Sat, 03 Feb 2007)
New Revision: 2387

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
Log:
FIX: selectimage default value should be checked if exist.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-02-03 21:39:27 UTC (rev 2386)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectImage.php	2007-02-03 21:41:37 UTC (rev 2387)
@@ -131,12 +131,12 @@
 			// compute image source
 			$source = $this->_img_src;
 
-			// compute selected option. If default value was set and that value is valid, use it. Otherwise use 1st option
+			// compute selected option. If default value was set and that value is valid, use it. Otherwise use 1st option if exist
 			if ( ! empty( $this->_value ) && isset( $this->_options[ $this->_value ] ) ){
 				$source .= $this->_value;
 			}else{
 				$values  = array_keys( $this->_options );
-				$source .= $values[0];
+				$source .= isset( $values[0] ) ? $values[0] : '';
 			}
 
 			// add extension



From ximian at mail.berlios.de  Sat Feb  3 22:45:46 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Sat, 3 Feb 2007 22:45:46 +0100
Subject: [ydf-devel] r2388 - YDFramework2.0/trunk/examples/translation
Message-ID: <200702032145.l13Ljkxa022569@sheep.berlios.de>

Author: ximian
Date: 2007-02-03 22:45:21 +0100 (Sat, 03 Feb 2007)
New Revision: 2388

Modified:
   YDFramework2.0/trunk/examples/translation/index.php
Log:
FIX: updated gettext example

Modified: YDFramework2.0/trunk/examples/translation/index.php
===================================================================
--- YDFramework2.0/trunk/examples/translation/index.php	2007-02-03 21:41:37 UTC (rev 2387)
+++ YDFramework2.0/trunk/examples/translation/index.php	2007-02-03 21:45:21 UTC (rev 2388)
@@ -10,13 +10,10 @@
 	YDInclude( 'YDRequest.php' );
 	YDInclude( 'YDTemplate.php' );
 
-	// set locale: you can use 'en', 'pt' and 'fr'
-	YDLocale::set( 'pt' );
+	// set locale: you can use 'en', 'pt' and 'fr' and use gettext engine with 'test' filenames inside 'locale' language directory
+	YDLocale::set( 'pt', 'test', dirname( __FILE__ ) . '/locale/' );
 
-	// use gettext engine. use 'test' filenames, language directories are in 'locale' sub directory
-	YDLocale::useGettext( 'test', dirname( __FILE__ ) . '/locale/' );
 
-
 	// Class definition
 	class index extends YDRequest {
 



From rene at reneschmidt.de  Sun Feb  4 20:38:02 2007
From: rene at reneschmidt.de (Rene Schmidt)
Date: Sun, 04 Feb 2007 20:38:02 +0100
Subject: [ydf-devel] YDForm::addNote()
Message-ID: <45C6361A.1070908@reneschmidt.de>

Hello fellow developers,

I have created a patch that enables YDForm (and array/html renderer) to
add note texts to form elements via addNote(). In most projects I need
to have some words of explanation with form fields.

Unrelated proposal: it would be nice to have not only a html renderer
but also a renderer that would let CSS do the design part. And better
<fieldset> support would be great too. :) I already have a
CSS-compatible renderer (basically a stripped down html renderer) but I
consider it a bit crappy so I left that out of the patch.

-- 
Rene Schmidt
Berater f?r Web-Entwicklung und eCommerce
Lange Str. 15, 21614 Buxtehude
Tel. 04161.558363 - http://www.reneschmidt.de/
Steuernummer 43/141/09180, USt-IdNr 219014862
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: formfieldnotes.patch
URL: <https://lists.berlios.de/pipermail/ydframework-devel/attachments/20070204/3d1c9711/attachment.ksh>

From pclaerhout at mail.berlios.de  Mon Feb  5 08:40:19 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Mon, 5 Feb 2007 08:40:19 +0100
Subject: [ydf-devel] r2389 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702050740.l157eJBS003665@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-05 08:39:57 +0100 (Mon, 05 Feb 2007)
New Revision: 2389

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
Made some optimizations to the the YDDatabaseTree classes.

With most functions, you can now specify a node object or it's id (to minimize the amount of queries that need to be done).

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-03 21:45:21 UTC (rev 2388)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-05 07:39:57 UTC (rev 2389)
@@ -420,9 +420,12 @@
             // Get the ID field
             $idField = $this->fields['id'];
 
-            // Get the node
-            $node = $this->_toNodeArray( $this->getNode( $id ) );
+            // Get the node if it's not given by a numeric ID
+            $node = is_numeric( $id ) ? $this->getNode( $id ) : $id;
 
+            // Convert the node
+            $node = $this->_toNodeArray( $node );
+
             // Find nleft, nright and parent_id
             if ( ! $node ) {
                 $nleft = 0;
@@ -544,9 +547,12 @@
             // Get the ID field
             $idField = $this->fields['id'];
 
-            // Get the node
-            $node = $this->_toNodeArray( $this->getNode( $id ) );
+            // Get the node if it's not given by a numeric ID
+            $node = is_numeric( $id ) ? $this->getNode( $id ) : $id;
 
+            // Convert the node
+            $node = $this->_toNodeArray( $node );
+
             // No node, return empty array
             if ( ! $node ) {
                 return array();
@@ -592,9 +598,12 @@
          */
         function isDescendantOf( $descendant_id, $ancestor_id ) {
 
-            // Get the node
-            $node = $this->_toNodeArray( $this->getNode( $ancestor_id ) );
+            // Get the node if it's not given by a numeric ID
+            $node = is_numeric( $ancestor_id ) ? $this->getNode( $ancestor_id ) : $ancestor_id;
 
+            // Convert the node
+            $node = $this->_toNodeArray( $node );
+
             // No node, return empty array
             if ( ! $node ) {
                 return false;
@@ -726,9 +735,12 @@
          */
         function getImmediateFamily( $id ) {
 
-            // Get the node
-            $node = $this->_toNodeArray( $this->getNode( $id ) );
+            // Get the node if it's not given by a numeric ID
+            $node = is_numeric( $id ) ? $this->getNode( $id ) : $id;
 
+            // Convert the node
+            $node = $this->_toNodeArray( $node );
+
             // The ID and parent field
             $idField = $this->_addTablePrefix( $this->fields['id'] );
             $parentField = $this->_addTablePrefix( $this->fields['parent'] );



From pclaerhout at mail.berlios.de  Mon Feb  5 09:14:28 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Mon, 5 Feb 2007 09:14:28 +0100
Subject: [ydf-devel] r2390 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702050814.l158ESHl004529@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-05 09:14:23 +0100 (Mon, 05 Feb 2007)
New Revision: 2390

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
The SQL formatter now recognizes ON DUPLICATE KEY UPDATE statements.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-02-05 07:39:57 UTC (rev 2389)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-02-05 08:14:23 UTC (rev 2390)
@@ -1510,6 +1510,7 @@
             $sql = str_ireplace( ' ORDER BY ', YD_CRLF . 'ORDER BY ', $sql );
             $sql = str_ireplace( ' GROUP BY ', YD_CRLF . 'GROUP BY ', $sql );
             $sql = str_ireplace( ' LIMIT ', YD_CRLF . 'LIMIT ', $sql );
+            $sql = str_ireplace( ' ON DUPLICATE KEY UPDATE ', YD_CRLF . 'ON DUPLICATE KEY UPDATE ', $sql );
 
             // Return the formatted statement
             return $sql;



From pclaerhout at mail.berlios.de  Mon Feb  5 10:08:48 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Mon, 5 Feb 2007 10:08:48 +0100
Subject: [ydf-devel] r2391 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702050908.l1598mOO007166@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-05 10:08:45 +0100 (Mon, 05 Feb 2007)
New Revision: 2391

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
Log:
Added the option to return a default value in YDDatabase::getValue.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-02-05 08:14:23 UTC (rev 2390)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabase.php	2007-02-05 09:08:45 UTC (rev 2391)
@@ -975,14 +975,14 @@
          *
          *  @returns    A single value matching the SQL statement. False when no record was found.
          */
-        function getValue( $sql, $index=0 ) {
+        function getValue( $sql, $index=0, $default=false ) {
             $records = $this->getRecord( $sql );
             if (! $records ) {
-                return false;
+                return $default;
             }
             $record = array_values( $records );
             if ( ! isset( $record[ $index ] ) ) {
-                return false;
+                return $default;
             }
             return $record[ $index ];
         }



From pclaerhout at mail.berlios.de  Mon Feb  5 19:29:27 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Mon, 5 Feb 2007 19:29:27 +0100
Subject: [ydf-devel] r2392 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702051829.l15ITRMo031388@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-05 19:29:25 +0100 (Mon, 05 Feb 2007)
New Revision: 2392

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
Log:
Fixed an SQL statement in the YDDatabaseTree->getDescendants function.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-05 09:08:45 UTC (rev 2391)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDDatabaseTree.php	2007-02-05 18:29:25 UTC (rev 2392)
@@ -474,7 +474,7 @@
                     );
                 } else if ( $nleft > 0 ) {
                     $query = sprintf(
-                        'select %s from %s where %s.nleft > %d and %snright < %d %s',
+                        'select %s from %s where %s.nleft > %d and %s.nright < %d %s',
                         $this->_getFieldsAsString(), $this->_getTablesAsString(),
                         $this->tablePrefix, $nleft, $this->tablePrefix, $nright, $order
                     );
@@ -992,7 +992,7 @@
 
             // Return if unknown node
             if ( ! $node ) {
-                return;
+                return false;
             }
 
             // Get the list of IDs to delete



From pclaerhout at mail.berlios.de  Tue Feb  6 08:37:14 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 6 Feb 2007 08:37:14 +0100
Subject: [ydf-devel] r2393 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200702060737.l167bEAH006513@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-06 08:37:12 +0100 (Tue, 06 Feb 2007)
New Revision: 2393

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Fixed a small bug in the timings report when YD_DEBUG is set to 2.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-05 18:29:25 UTC (rev 2392)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-06 07:37:12 UTC (rev 2393)
@@ -821,7 +821,7 @@
                 foreach ( $timings as $timing ) {
                     $debug .= sprintf(
                         '<tr><td %s>%s ms</td><td %s>%s ms</td><td %s>%s</td></tr>',
-                        $font, $timing[0], $font, $timing[0], $font, $timing[2]
+                        $font, $timing[0], $font, $timing[1], $font, $timing[2]
                     );
                 }
                 $debug .= '</table></p></dd>';



From pclaerhout at mail.berlios.de  Tue Feb  6 16:54:03 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Tue, 6 Feb 2007 16:54:03 +0100
Subject: [ydf-devel] r2394 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200702061554.l16Fs3AO023194@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-06 16:53:51 +0100 (Tue, 06 Feb 2007)
New Revision: 2394

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
Replaced the percent signs for the missing translations of the t function to #, so that they are safer to use with the sprintf function.

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-06 07:37:12 UTC (rev 2393)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-06 15:53:51 UTC (rev 2394)
@@ -309,7 +309,7 @@
 			$out = gettext( $res[1] );
 		}else{
 			$t = strtolower( $t );
-			$out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "%%$t%%" );
+			$out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "#$t#" );
 		}
         array_unshift( $params, $out );
         return call_user_func_array( 'sprintf', $params );



From ximian at mail.berlios.de  Thu Feb  8 00:25:34 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 8 Feb 2007 00:25:34 +0100
Subject: [ydf-devel] r2395 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormElements
Message-ID: <200702072325.l17NPYjk007178@sheep.berlios.de>

Author: ximian
Date: 2007-02-08 00:25:12 +0100 (Thu, 08 Feb 2007)
New Revision: 2395

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Fieldset.php
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_HR.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
added 2 new form elements:
 - hr        ( a simple horizontal rule )
 - formfield ( a experimental formfield )

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-06 15:53:51 UTC (rev 2394)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-07 23:25:12 UTC (rev 2395)
@@ -141,6 +141,8 @@
             $this->registerElement( 'grid', 'YDFormElement_Grid', 'YDFormElement_Grid.php' );
             $this->registerElement( 'captcha', 'YDFormElement_Captcha', 'YDFormElement_Captcha.php' );
             $this->registerElement( 'timezone', 'YDFormElement_Timezone', 'YDFormElement_Timezone.php' );
+            $this->registerElement( 'fieldset', 'YDFormElement_Fieldset', 'YDFormElement_Fieldset.php' );
+            $this->registerElement( 'hr', 'YDFormElement_HR', 'YDFormElement_HR.php' );
 
             // Add the rules
             $this->registerRule( 'value', array( 'YDValidateRules', 'value' ), 'YDValidateRules.php' );

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Fieldset.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Fieldset.php	2007-02-06 15:53:51 UTC (rev 2394)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Fieldset.php	2007-02-07 23:25:12 UTC (rev 2395)
@@ -0,0 +1,93 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php');
+
+    /**
+     *        This is the class that define a fieldset.
+     *
+     *  @ingroup YDForm
+     */
+    class YDFormElement_FieldSet extends YDFormElement {
+
+        /**
+         *        This is the class constructor for the YDFormElement_FieldSet class.
+         *
+         *        @param $form              The name of the form to which this element is connected.
+         *        @param $name              The name of the form element.
+         *        @param $label             (optional) The label for the form element.
+         *        @param $attributes        (optional) The attributes for the form element.
+         *        @param $options           (optional) The options for the elment.
+         */
+        function YDFormElement_FieldSet( $form, $name, $label='', $attributes=array(), $options=array() ) {
+
+            // Initialize the parent
+            $this->YDFormElement( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'fieldset';
+
+            // Indicate if filters need to be applied
+            $this->_applyFilters = false;
+
+            // Indicate we are a button type
+            $this->_isButton = false;
+
+        }
+
+
+        /**
+         *      This function returns a boolean indicating if the element value was
+         *      modified from it's default value.
+         *
+         *      @returns        Boolean indicating if the element was modified.
+         */
+        function isModified() {
+            return false;
+        }
+
+
+        /**
+         *        This function will return the element as HTML.
+         *
+         *        @returns        The form element as HTML text.
+         */
+        function toHtml() {
+
+            // Get the HTML
+            return '<legend>' . $this->_name . '</legend>';
+        }
+
+    }
+
+?>
\ No newline at end of file

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_HR.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_HR.php	2007-02-06 15:53:51 UTC (rev 2394)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_HR.php	2007-02-07 23:25:12 UTC (rev 2395)
@@ -0,0 +1,104 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDForm.php');
+
+    /**
+     *        This is the class that define a horizontal rule form element.
+     *
+     *  @ingroup YDForm
+     */
+    class YDFormElement_HR extends YDFormElement {
+
+        /**
+         *        This is the class constructor for the YDFormElement_HR class.
+         *
+         *        @param $form              The name of the form to which this element is connected.
+         *        @param $name              The name of the form element.
+         *        @param $label             (optional) The label for the form element.
+         *        @param $attributes        (optional) The attributes for the form element.
+         *        @param $options           (optional) The options for the elment.
+         */
+        function YDFormElement_HR( $form, $name, $label='', $attributes=array(), $options=array() ) {
+
+            // Initialize the parent
+            $this->YDFormElement( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'hr';
+
+            // Indicate if filters need to be applied
+            $this->_applyFilters = false;
+
+            // Indicate we are a button type
+            $this->_isButton = false;
+
+        }
+
+
+        /**
+         *      This function returns a boolean indicating if the element value was
+         *      modified from it's default value.
+         *
+         *      @returns        Boolean indicating if the element was modified.
+         */
+        function isModified() {
+            return false;
+        }
+
+
+        /**
+         *      Gets the label of the form element.
+         *
+         *      @param  $html   (Optional) Return label as html
+         *      @returns        Just a space
+         */
+        function getLabel( $html = false ) {
+
+            return '&nbsp;';
+        }
+
+
+        /**
+         *        This function will return the element as HTML.
+         *
+         *        @returns        The form element as HTML text.
+         */
+        function toHtml() {
+
+            // Get the HTML
+            return '<hr />';
+        }
+    }
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Thu Feb  8 00:26:41 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 8 Feb 2007 00:26:41 +0100
Subject: [ydf-devel] r2396 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers
Message-ID: <200702072326.l17NQfTq007277@sheep.berlios.de>

Author: ximian
Date: 2007-02-08 00:26:30 +0100 (Thu, 08 Feb 2007)
New Revision: 2396

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
Log:
- added support for formfields in html form render

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-02-07 23:25:12 UTC (rev 2395)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormRenderers/YDFormRenderer_html.php	2007-02-07 23:26:30 UTC (rev 2396)
@@ -105,6 +105,17 @@
                 }
                 if ( $element['type'] == 'hidden' ) {
                     $html .= $element['html'] . YD_CRLF;
+                }
+                elseif ( $element['type'] == 'fieldset' ) {
+
+                    // if we had already a fieldset, we must close tag
+                    if ( isset( $this->_fsets ) ){
+                        $html .= '</fieldset>';
+                    }
+
+                    // add fieldset start and set fieldsets in use
+                    $html .= '<fieldset>' . $element['html'];
+                    $this->_fsets = true;
                 } else {
                     $html .= '<p>';
                     if ( $element['placeLabel'] == 'after' ) {
@@ -132,6 +143,11 @@
                 }
             }
 
+            // Close last fieldset, if exist
+            if ( isset( $this->_fsets ) ){
+                $html .= '</fieldset>';
+            }
+
             // Add the buttons
             $buttons = array();
             foreach ( $form as $name=>$element ) {



From ximian at mail.berlios.de  Thu Feb  8 00:28:05 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 8 Feb 2007 00:28:05 +0100
Subject: [ydf-devel] r2397 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702072328.l17NS5HW007368@sheep.berlios.de>

Author: ximian
Date: 2007-02-08 00:27:51 +0100 (Thu, 08 Feb 2007)
New Revision: 2397

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
Log:
FIX: YDTemplate:: addJavascript shouldn't add new line at code end

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-02-07 23:26:30 UTC (rev 2396)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDTemplate.php	2007-02-07 23:27:51 UTC (rev 2397)
@@ -268,8 +268,8 @@
                     else            return array_push(    $this->customJavascriptOnload, $jsCode );
                 }
 
-                if ( $prepend ) return $this->customJavascript = $jsCode . $this->customJavascript . "\n";
-				else            return $this->customJavascript = $this->customJavascript . $jsCode . "\n";
+                if ( $prepend ) return $this->customJavascript = $jsCode . $this->customJavascript;
+				else            return $this->customJavascript = $this->customJavascript . $jsCode;
             }
 
 



From ximian at mail.berlios.de  Thu Feb  8 00:31:12 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Thu, 8 Feb 2007 00:31:12 +0100
Subject: [ydf-devel] r2398 - YDFramework2.0/trunk/YDFramework2
Message-ID: <200702072331.l17NVCEY009286@sheep.berlios.de>

Author: ximian
Date: 2007-02-08 00:30:53 +0100 (Thu, 08 Feb 2007)
New Revision: 2398

Modified:
   YDFramework2.0/trunk/YDFramework2/YDF2_init.php
Log:
better gettext reg expression for t()

Modified: YDFramework2.0/trunk/YDFramework2/YDF2_init.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-07 23:27:51 UTC (rev 2397)
+++ YDFramework2.0/trunk/YDFramework2/YDF2_init.php	2007-02-07 23:30:53 UTC (rev 2398)
@@ -305,8 +305,8 @@
         }
 
 		// check gettext patern
-		if ( ereg ( "^\_\([\'\"](.*)[\'\"]\)$", $t, $res ) ){
-			$out = gettext( $res[1] );
+		if ( preg_match ( "/^\_\((\"|.{2})(.+)(\"|.{2})\)$/", $t, $res ) ){
+			$out = gettext( $res[2] );
 		}else{
 			$t = strtolower( $t );
 			$out = ( array_key_exists( $t, $GLOBALS['t'] ) ? $GLOBALS['t'][$t] : "#$t#" );



From ximian at mail.berlios.de  Fri Feb  9 00:36:55 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 9 Feb 2007 00:36:55 +0100
Subject: [ydf-devel] r2399 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree
Message-ID: <200702082336.l18NatFV027185@sheep.berlios.de>

Author: ximian
Date: 2007-02-09 00:36:30 +0100 (Fri, 09 Feb 2007)
New Revision: 2399

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
Log:
- added prefix feature to YDDatabaseObjectTree::getTreeElements()

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-02-07 23:30:53 UTC (rev 2398)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObjectTree/YDDatabaseObjectTree.php	2007-02-08 23:36:30 UTC (rev 2399)
@@ -211,7 +211,7 @@
         function getDescendants( $id, $includeSelf = false, $maxLevel = null, $prefix = false ) {
 
 			// check if we want an invalid id (like 0 or 1)
-			if ( $id < 2 ) return $this->getTreeElements();
+			if ( $id < 2 ) return $this->getTreeElements( $prefix );
 
 			$this->resetAll();
 
@@ -249,22 +249,26 @@
         /**
          *  Fetch all elements of a tree
          *
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
          *  @returns All tree nodes
          */
-        function getTreeElements() {
+        function getTreeElements( $prefix = false ) {
 
 			$this->resetAll();
 
-			return $this->_getTreeElements();
+			return $this->_getTreeElements( $prefix );
 		}
 
 
         /**
          *  Helper to fetch all elements of a tree
          *
+         *  @param $prefix          (optional) Adds the relation's vars as prefixes to the keys. Default: false.
+         *
          *  @returns All tree nodes
          */
-        function _getTreeElements() {
+        function _getTreeElements( $prefix = false ) {
 
 			// get all elements except root
 			$this->where( $this->__table_id . ' > 1' );
@@ -273,7 +277,7 @@
 			$this->findAll();
 
 			// return all nodes
-			return $this->getResults();
+			return $this->getResults( false, false, false, $prefix );
 		}
 
 



From ximian at mail.berlios.de  Fri Feb  9 00:38:08 2007
From: ximian at mail.berlios.de (ximian at mail.berlios.de)
Date: Fri, 9 Feb 2007 00:38:08 +0100
Subject: [ydf-devel] r2400 -
	YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject
Message-ID: <200702082338.l18Nc8nv028872@sheep.berlios.de>

Author: ximian
Date: 2007-02-09 00:38:00 +0100 (Fri, 09 Feb 2007)
New Revision: 2400

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
Log:
- deleted my previous YDDatabaseObject::insertForm(). it's too much specific.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-02-08 23:36:30 UTC (rev 2399)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDDatabaseObject/YDDatabaseObject.php	2007-02-08 23:38:00 UTC (rev 2400)
@@ -1045,60 +1045,6 @@
 
 
         /**
-         *  This function inserts a form in database
-         *
-         *  @param $form       YDForm object
-         *
-         *  @param $messages   (optional) Array with predefined messages:
-         *                                'ok' for ok message, 'error' for fatal messages, 'form_err' for no validation
-         *
-         *  @param $formvalues (optional) Custom form validation values
-         *
-         *  @param $onDate     (optional) When element is a date (read: array ), we should convert to this format. Default: 'datetimesql'
-         *
-         *  @returns  YDResult object with a message and a result
-         *            On 'ok', result is the new id
-         *            On 'form_err', result is array of form error messages
-         */
-        function insertForm( & $form, $messages = array(), $formvalues = null, $onDate = 'datetimesql' ){
-
-            YDInclude( 'YDResult.php' );
-
-            // check messages
-            $msg_ok       = isset( $messages[ 'ok' ] )       ? $messages[ 'ok' ]       : t( 'Element added' );
-            $msg_error    = isset( $messages[ 'error' ] )    ? $messages[ 'error' ]    : t( 'Impossible to add element' );
-            $msg_form_err = isset( $messages[ 'form_err' ] ) ? $messages[ 'form_err' ] : t( 'Form errors' );
-
-            // check form validation
-            if ( ! $form->validate( $formvalues ) ){
-                return YDResult::warning( $msg_form_err, $form->getErrors() );
-            }
-
-            // reset all previous information
-            $this->reset();
-
-			// get form values
-			$values = $form->getValues();
-
-			// convert dates
-			foreach( $values as $element => $value )
-				if ( is_array( $value ) ) $values[ $element ] = YDStringUtil::formatDate( $value, $onDate );
-
-			// apply values
-            $this->setValues( $values );
-
-            // insert values and check result
-            $result = $this->insert();
-
-            if ( $result ){
-                return YDResult::ok( $msg_ok, $result );
-            }else{
-                return YDResult::fatal( $msg_error, $result );
-            }
-        }
-
-
-        /**
          *  This function executes an UPDATE query based on the values of the object
          *  and any value set by where.
          *



From pclaerhout at mail.berlios.de  Sun Feb 11 15:30:30 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sun, 11 Feb 2007 15:30:30 +0100
Subject: [ydf-devel] r2401 -
	YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator
Message-ID: <200702111430.l1BEUUkh022630@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-11 15:30:28 +0100 (Sun, 11 Feb 2007)
New Revision: 2401

Modified:
   YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
Log:
The encoding of the feeds is now properly preserved.

Modified: YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-02-08 23:38:00 UTC (rev 2400)
+++ YDFramework2.0/trunk/YDFramework2/addons/YDFeedCreator/YDFeedCreator.php	2007-02-11 14:30:28 UTC (rev 2401)
@@ -339,6 +339,7 @@
             }
             
             $xml->loadArray( $feed );
+            $xml->encoding = $this->_encoding;
             return $xml->toString();
 
         }



From pclaerhout at mail.berlios.de  Fri Feb 16 20:57:26 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 16 Feb 2007 20:57:26 +0100
Subject: [ydf-devel] r2402 - YDFramework2.0/trunk/examples/weblog/manage
Message-ID: <200702161957.l1GJvQ6D005694@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-16 20:57:20 +0100 (Fri, 16 Feb 2007)
New Revision: 2402

Modified:
   YDFramework2.0/trunk/examples/weblog/manage/users.php
Log:
Fixed a small coding problem.

Modified: YDFramework2.0/trunk/examples/weblog/manage/users.php
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/users.php	2007-02-11 14:30:28 UTC (rev 2401)
+++ YDFramework2.0/trunk/examples/weblog/manage/users.php	2007-02-16 19:57:20 UTC (rev 2402)
@@ -142,6 +142,7 @@
             // Redirect to the default action
             $this->redirectToAction();
 
+        }
 
         // Check the user credentials
         function checkUserCredentials( $params ) {
@@ -157,7 +158,6 @@
             }
 
         }
-        }
 
     }
 



From pclaerhout at mail.berlios.de  Fri Feb 16 20:59:20 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 16 Feb 2007 20:59:20 +0100
Subject: [ydf-devel] r2403 - in YDFramework2.0/trunk/examples/weblog: manage
	tiny_mce/plugins tiny_mce/plugins/youtube
	tiny_mce/plugins/youtube/_notes tiny_mce/plugins/youtube/css
	tiny_mce/plugins/youtube/css/_notes tiny_mce/plugins/youtube/images
	tiny_mce/plugins/youtube/images/_notes
	tiny_mce/plugins/youtube/jscripts
	tiny_mce/plugins/youtube/jscripts/_notes
	tiny_mce/plugins/youtube/langs tiny_mce/plugins/youtube/langs/_notes
Message-ID: <200702161959.l1GJxKBA005735@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-16 20:59:08 +0100 (Fri, 16 Feb 2007)
New Revision: 2403

Added:
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/dwsync.xml
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/dwsync.xml
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/content.css
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/youtube.css
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/editor_plugin.js
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/dwsync.xml
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/youtube.gif
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/dwsync.xml
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/youtube.js
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/dwsync.xml
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/en.js
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/readme.txt
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/youtube.htm
Modified:
   YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
Log:
Added a youtube plugin to TinyMCE.

Modified: YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl
===================================================================
--- YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/manage/__mng_header.tpl	2007-02-16 19:59:08 UTC (rev 2403)
@@ -50,8 +50,8 @@
             editor_deselector : "tfMNoMCE",
             theme : "advanced",
             language: "{/literal}{$weblog_language}{literal}",
-            plugins : "imgselector,fullscreen",
-            theme_advanced_buttons1 : "bold,italic,separator,justifyleft,justifycenter,justifyright,separator,bullist,numlist,separator,undo,redo,separator,link,unlink,code,fullscreen,separator,imgselector",
+            plugins : "imgselector,fullscreen,youtube",
+            theme_advanced_buttons1 : "bold,italic,separator,justifyleft,justifycenter,justifyright,separator,bullist,numlist,separator,undo,redo,separator,link,unlink,code,fullscreen,separator,imgselector,youtube",
             theme_advanced_buttons2 : "",
             theme_advanced_buttons3 : "",
             theme_advanced_toolbar_location : "top",

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/dwsync.xml
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/dwsync.xml	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/dwsync.xml	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,6 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<dwsync>
+<file name="editor_plugin.js" local="128051174690000000" remote="128050925400000000" testing="0" />
+<file name="readme.txt" local="128050545470000000" remote="128050880400000000" testing="0" />
+<file name="youtube.htm" local="128051176520000000" remote="128050925400000000" testing="0" />
+</dwsync>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/dwsync.xml
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/dwsync.xml	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/dwsync.xml	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,5 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<dwsync>
+<file name="content.css" local="128050625070000000" remote="128050880400000000" testing="0" />
+<file name="youtube.css" local="128050545470000000" remote="128050880400000000" testing="0" />
+</dwsync>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/content.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/content.css	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/content.css	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,7 @@
+.mceItemYouTube {
+	border: 1px dotted #cc0000;
+	background-image: url(../images/youtube.gif);
+	background-position: center;
+	background-repeat: no-repeat;
+	background-color: #ffffcc;
+}

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/youtube.css
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/youtube.css	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/youtube.css	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,11 @@
+.panel_wrapper div.current {
+	height: 100px;
+}
+
+#width, #height {
+	width: 50px;
+}
+
+#file {
+	width: 250px;
+}

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/editor_plugin.js
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/editor_plugin.js	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/editor_plugin.js	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,219 @@
+tinyMCE.importPluginLanguagePack('youtube','en,tr,de,sv,zh_cn,cs,fa,fr_ca,fr,pl,pt_br,nl,da,he,nb,hu,ru,ru_KOI8-R,ru_UTF-8,nn,es,cy,is,zh_tw,zh_tw_utf8,sk,pt_br');
+var TinyMCE_YouTubePlugin={
+		getInfo:function(){
+			return{
+					longname:'YouTube',author:'Adrian Hope-Bailie',authorurl:'http://www.digitsolutions.co.za',infourl:'http://www.digitsolutions/tinymce/docs/plugin_youtube.html',version:tinyMCE.majorVersion+"."+tinyMCE.minorVersion};
+		},
+		initInstance:function(inst){
+			if(!tinyMCE.settings['youtube_skip_plugin_css'])
+					tinyMCE.importCSS(inst.getDoc(),tinyMCE.baseURL+"/plugins/youtube/css/content.css");
+		},
+		getControlHTML:function(cn){
+			switch(cn){
+				case"youtube":
+					return tinyMCE.getButtonHTML(cn,'lang_youtube_desc','{$pluginurl}/images/youtube.gif','mceYouTube');
+			}
+			return"";
+		},
+		execCommand:function(editor_id,element,command,user_interface,value){
+			switch(command){
+				case"mceYouTube":
+					var name="",swffile="",swfwidth="",swfheight="",action="insert";
+					var template=new Array();
+					var inst=tinyMCE.getInstanceById(editor_id);
+					var focusElm=inst.getFocusElement();
+					template['file']='../../plugins/youtube/youtube.htm';
+					template['width']=430;
+					template['height']=175;
+					template['width']+=tinyMCE.getLang('lang_youtube_delta_width',0);
+					template['height']+=tinyMCE.getLang('lang_youtube_delta_height',0);
+					
+					if(focusElm!=null&&focusElm.nodeName.toLowerCase()=="img"){
+						name=tinyMCE.getAttrib(focusElm,'class');
+						if(name.indexOf('mceItemYouTube')==-1)
+							return true;
+						swffile=tinyMCE.getAttrib(focusElm,'alt');
+						
+						//if(tinyMCE.getParam('convert_urls'))
+						//	swffile=eval(tinyMCE.settings['urlconverter_callback']+"(swffile, null, true);");
+						
+						swfwidth=tinyMCE.getAttrib(focusElm,'width');
+						swfheight=tinyMCE.getAttrib(focusElm,'height');
+						action="update";
+					}
+					
+					tinyMCE.openWindow(template,{
+									   editor_id:editor_id,
+									   inline:"yes",
+									   swffile:swffile,
+									   swfwidth:swfwidth,
+									   swfheight:swfheight,
+									   action:action});
+					return true;
+			}
+			return false;
+		},
+		cleanup:function(type,content){
+			switch(type){
+				case"insert_to_editor_dom":
+					if(tinyMCE.getParam('convert_urls')){
+						var imgs=content.getElementsByTagName("img");
+						for(var i=0; i<imgs.length; i++){
+							if(tinyMCE.getAttrib(imgs[i],"class")=="mceItemYouTube"){
+								var src=tinyMCE.getAttrib(imgs[i],"alt");
+								//if(tinyMCE.getParam('convert_urls'))
+								//	src=eval(tinyMCE.settings['urlconverter_callback']+"(src, null, true);");
+								imgs[i].setAttribute('alt',src);
+								imgs[i].setAttribute('title',src);
+							}
+						}
+					}
+					break;
+					
+				case"get_from_editor_dom":
+					var imgs=content.getElementsByTagName("img");
+					for(var i=0; i<imgs.length;i++){
+						if(tinyMCE.getAttrib(imgs[i],"class")=="mceItemYouTube"){
+							var src=tinyMCE.getAttrib(imgs[i],"alt");
+							//if(tinyMCE.getParam('convert_urls'))
+							//	src=eval(tinyMCE.settings['urlconverter_callback']+"(src, null, true);");
+							imgs[i].setAttribute('alt',src);
+							imgs[i].setAttribute('title',src);
+						}
+					}
+					break;
+					
+				case"insert_to_editor":
+					var startPos=0;
+					var embedList=new Array();
+					content=content.replace(new RegExp('<[ ]*embed','gi'),'<embed');
+					content=content.replace(new RegExp('<[ ]*/embed[ ]*>','gi'),'</embed>');
+					content=content.replace(new RegExp('<[ ]*object','gi'),'<object');
+					content=content.replace(new RegExp('<[ ]*/object[ ]*>','gi'),'</object>');
+					while((startPos=content.indexOf('<embed',startPos+1))!=-1){
+						var endPos=content.indexOf('>',startPos);
+						var attribs=TinyMCE_YouTubePlugin._parseAttributes(content.substring(startPos+6,endPos));
+						//Ensure this is a YouTube Video and not just a regular flash video
+						if(content.substring(startPos+6,endPos).indexOf(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'))!=-1)
+							embedList[embedList.length]=attribs;
+					}
+					var index=0;
+					while((startPos=content.indexOf('<object',startPos))!=-1){
+						if(index>=embedList.length)
+							break;
+					
+						var attribs=embedList[index];
+						endPos=content.indexOf('</object>',startPos);
+						
+						//Ensure this is a YouTube Video and not just a regular flash video
+						if(content.substring(startPos+7,endPos).indexOf(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'))!=-1){
+							endPos+=9;
+							var contentAfter=content.substring(endPos);
+							attribs["src"] = attribs["src"].replace(new RegExp(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'),'gi'),'');
+							content=content.substring(0,startPos);
+							content+='<img width="'+attribs["width"]+'" height="'+attribs["height"]+'"';
+							content+=' src="'+(tinyMCE.getParam("theme_href")+'/images/spacer.gif')+'" title="'+attribs["src"]+'"';
+							content+=' alt="'+attribs["src"]+'" class="mceItemYouTube" />'+content.substring(endPos);
+							content+=contentAfter;
+							index++;
+						}
+						startPos++;
+					}
+					
+					var index=0;
+					while((startPos=content.indexOf('<embed',startPos))!=-1){
+						if(index>=embedList.length)
+							break;
+						var attribs=embedList[index];
+						endPos=content.indexOf('>',startPos);
+						//Ensure this is a YouTube Video and not just a regular flash video
+						if(content.substring(startPos+7,endPos).indexOf(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'))!=-1){
+							endPos+=9;
+							var contentAfter=content.substring(endPos);
+							attribs["src"] = attribs["src"].replace(new RegExp(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'),'gi'),'');
+							content=content.substring(0,startPos);
+							content+='<img width="'+attribs["width"]+'" height="'+attribs["height"]+'"';
+							content+=' src="'+(tinyMCE.getParam("theme_href")+'/images/spacer.gif')+'" title="'+attribs["src"]+'"';
+							content+=' alt="'+attribs["src"]+'" class="mceItemYouTube" />'+content.substring(endPos);
+							content+=contentAfter;
+							index++;
+						}
+						startPos++;
+					}
+					break;
+					
+				case"get_from_editor":
+					var startPos=-1;
+					while((startPos=content.indexOf('<img',startPos+1))!=-1){
+						var endPos=content.indexOf('/>',startPos);
+						var attribs=TinyMCE_YouTubePlugin._parseAttributes(content.substring(startPos+4,endPos));
+						if(attribs['class']!="mceItemYouTube")
+							continue;
+						endPos+=2;
+						var embedHTML='';
+						var wmode=tinyMCE.getParam("youtube_wmode","");
+						var url_prefix = tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/');
+						embedHTML+='<object';
+						embedHTML+=' width="'+attribs["width"]+'" height="'+attribs["height"]+'">';
+						embedHTML+='<param name="movie" value="'+url_prefix+attribs["title"]+'" />';
+						embedHTML+='<param name="wmode" value="'+wmode+'" />';
+						embedHTML+='<embed src="'+url_prefix+attribs["title"]+'" wmode="'+wmode+'" type="application/x-shockwave-flash" width="'+attribs["width"]+'" height="'+attribs["height"]+'"></embed></object>';
+						chunkBefore=content.substring(0,startPos);
+						chunkAfter=content.substring(endPos);
+						content=chunkBefore+embedHTML+chunkAfter;
+					}
+					break;
+			}
+			return content;
+		},
+		handleNodeChange:function(editor_id,node,undo_index,undo_levels,visual_aid,any_selection){
+			if(node==null)
+				return;
+			do{
+				if(node.nodeName=="IMG"&&tinyMCE.getAttrib(node,'class').indexOf('mceItemYouTube')==0){
+					tinyMCE.switchClass(editor_id+'_youtube','mceButtonSelected');
+					return true;
+				}
+			}
+			while((node=node.parentNode));
+			
+			tinyMCE.switchClass(editor_id+'_youtube','mceButtonNormal');
+			return true;
+		},
+		_parseAttributes:function(attribute_string){
+			var attributeName="";
+			var attributeValue="";
+			var withInName;
+			var withInValue;
+			var attributes=new Array();
+			var whiteSpaceRegExp=new RegExp('^[ \n\r\t]+','g');
+			if(attribute_string==null||attribute_string.length<2)
+				return null;
+			withInName=withInValue=false;
+			for(var i=0; i<attribute_string.length; i++){
+				var chr=attribute_string.charAt(i);
+				if((chr=='"'||chr=="'")&&!withInValue)
+					withInValue=true;
+				else if((chr=='"'||chr=="'")&&withInValue){
+					withInValue=false;
+					var pos=attributeName.lastIndexOf(' ');
+					if(pos!=-1)
+						attributeName=attributeName.substring(pos+1);
+					attributes[attributeName.toLowerCase()]=attributeValue.substring(1);
+					attributeName="";
+					attributeValue="";
+				}
+				else if(!whiteSpaceRegExp.test(chr)&&!withInName&&!withInValue)
+					withInName=true;
+
+				if(chr=='='&&withInName)
+					withInName=false;
+				if(withInName)
+					attributeName+=chr;
+				if(withInValue)
+					attributeValue+=chr;
+			}
+			return attributes;
+		}
+	};
+tinyMCE.addPlugin("youtube",TinyMCE_YouTubePlugin);

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/dwsync.xml
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/dwsync.xml	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/dwsync.xml	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<dwsync>
+<file name="youtube.gif" local="128050547300000000" remote="128050880400000000" testing="0" />
+</dwsync>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/youtube.gif
===================================================================
(Binary files differ)


Property changes on: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/youtube.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/dwsync.xml
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/dwsync.xml	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/dwsync.xml	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<dwsync>
+<file name="youtube.js" local="128051181170000000" remote="128050925400000000" testing="0" />
+</dwsync>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/youtube.js
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/youtube.js	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/youtube.js	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,108 @@
+var url = tinyMCE.getParam("youtube_external_list_url");
+if (url != null) {
+	// Fix relative
+	if (url.charAt(0) != '/' && url.indexOf('://') == -1)
+		url = tinyMCE.documentBasePath + "/" + url;
+
+	document.write('<sc'+'ript language="javascript" type="text/javascript" src="' + url + '"></sc'+'ript>');
+}
+
+function init() {
+	tinyMCEPopup.resizeToInnerSize();
+
+	document.getElementById("filebrowsercontainer").innerHTML = getBrowserHTML('filebrowser','file','youtube','youtube');
+
+	// Image list outsrc
+	var html = getYouTubeListHTML('filebrowser','file','youtube','youtube');
+	if (html == "")
+		document.getElementById("linklistrow").style.display = 'none';
+	else
+		document.getElementById("linklistcontainer").innerHTML = html;
+
+	var formObj = document.forms[0];
+	var swffile   = tinyMCE.getWindowArg('swffile');
+	var swfwidth  = '' + tinyMCE.getWindowArg('swfwidth');
+	var swfheight = '' + tinyMCE.getWindowArg('swfheight');
+
+	if (swfwidth.indexOf('%')!=-1) {
+		formObj.width2.value = "%";
+		formObj.width.value  = swfwidth.substring(0,swfwidth.length-1);
+	} else {
+		formObj.width2.value = "px";
+		formObj.width.value  = swfwidth;
+	}
+
+	if (swfheight.indexOf('%')!=-1) {
+		formObj.height2.value = "%";
+		formObj.height.value  = swfheight.substring(0,swfheight.length-1);
+	} else {
+		formObj.height2.value = "px";
+		formObj.height.value  = swfheight;
+	}
+
+	swffile=swffile.replace(new RegExp(tinyMCE.getParam('youtube_url_prefix','http://www.youtube.com/v/'),'gi'),'');
+	formObj.file.value = swffile;
+	formObj.insert.value = tinyMCE.getLang('lang_' + tinyMCE.getWindowArg('action'), 'Insert', true);
+
+	selectByValue(formObj, 'linklist', swffile);
+
+	// Handle file browser
+	if (isVisible('filebrowser'))
+		document.getElementById('file').style.width = '230px';
+
+	// Auto select youtube in list
+	if (typeof(tinyMCEYouTubeList) != "undefined" && tinyMCEYouTubeList.length > 0) {
+		for (var i=0; i<formObj.linklist.length; i++) {
+			if (formObj.linklist.options[i].value == tinyMCE.getWindowArg('swffile'))
+				formObj.linklist.options[i].selected = true;
+		}
+	}
+}
+
+function getYouTubeListHTML() {
+	if (typeof(tinyMCEYouTubeList) != "undefined" && tinyMCEYouTubeList.length > 0) {
+		var html = "";
+
+		html += '<select id="linklist" name="linklist" style="width: 250px" onfocus="tinyMCE.addSelectAccessibility(event, this, window);" onchange="this.form.file.value=this.options[this.selectedIndex].value;">';
+		html += '<option value="">---</option>';
+
+		for (var i=0; i<tinyMCEYouTubeList.length; i++)
+			html += '<option value="' + tinyMCEYouTubeList[i][1] + '">' + tinyMCEYouTubeList[i][0] + '</option>';
+
+		html += '</select>';
+
+		return html;
+	}
+
+	return "";
+}
+
+function insertYouTube() {
+	var formObj = document.forms[0];
+	var html      = '';
+	var file      = formObj.file.value;
+	var width     = formObj.width.value;
+	var height    = formObj.height.value;
+	if (formObj.width2.value=='%') {
+		width = width + '%';
+	}
+	if (formObj.height2.value=='%') {
+		height = height + '%';
+	}
+
+	if (width == "")
+		width = 425;
+
+	if (height == "")
+		height = 350;
+
+	html += ''
+		+ '<img src="' + (tinyMCE.getParam("theme_href") + "/images/spacer.gif") + '" mce_src="' + (tinyMCE.getParam("theme_href") + "/images/spacer.gif") + '" '
+		+ 'width="' + width + '" height="' + height + '" '
+		+ 'border="0" alt="' + file + '" title="' + file + '" class="mceItemYouTube" />';
+
+	tinyMCEPopup.execCommand("mceInsertContent", true, html);
+	tinyMCE.selectedInstance.repaint();
+
+	tinyMCEPopup.close();
+}

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/dwsync.xml
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/dwsync.xml	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/dwsync.xml	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<dwsync>
+<file name="en.js" local="128051132610000000" remote="128050913400000000" testing="0" />
+</dwsync>
\ No newline at end of file

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/en.js
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/en.js	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/en.js	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,11 @@
+// UK lang variables
+
+tinyMCE.addToLang('youtube',{
+title : 'Insert / edit YouTube Movie',
+desc : 'Insert / edit YouTube Movie',
+file : 'Movie ID',
+size : 'Size',
+list : 'You Tube movies',
+props : 'YouTube properties',
+general : 'General'
+});

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/readme.txt
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/readme.txt	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/readme.txt	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,18 @@
+YouTube TinyMCE plugin v1.0
+Written by Adrian Hope-Bailie
+Based on Flash Plugin by Moxiecode
+
+Currently this plugin will NOT play nice with the flash plugin, but this should be resolved in v1.1
+
+INSTALL:
+To install simply place entire "youtube" folder in the "tinymce\jscripts\tiny_mce\plugins" folder.
+
+To add context menu support edit the file "tinymce\jscripts\tiny_mce\plugins\contextmenu\editor_plugin.js" 
+
+Find the code that reads:
+
+if(tinyMCE.getAttrib(elm,'class').indexOf('mceItemFlash')!=-1)contextMenu.addItem(tinyMCE.baseURL+"/plugins/flash/images/flash.gif","$lang_flash_props","mceFlash");
+
+Insert the following code immediately afterwards:
+
+else if (tinyMCE.getAttrib(elm, 'class').indexOf('mceItemYouTube') != -1)contextMenu.addItem(tinyMCE.baseURL + "/plugins/youtube/images/youtube.gif", "$lang_youtube_props", "mceYouTube");

Added: YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/youtube.htm
===================================================================
--- YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/youtube.htm	2007-02-16 19:57:20 UTC (rev 2402)
+++ YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/youtube.htm	2007-02-16 19:59:08 UTC (rev 2403)
@@ -0,0 +1,70 @@
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+	<title>{$lang_youtube_title}</title>
+	<script language="javascript" type="text/javascript" src="../../tiny_mce_popup.js"></script>
+	<script language="javascript" type="text/javascript" src="jscripts/youtube.js"></script>
+	<script language="javascript" type="text/javascript" src="../../utils/mctabs.js"></script>
+	<script language="javascript" type="text/javascript" src="../../utils/form_utils.js"></script>
+	<link href="css/youtube.css" rel="stylesheet" type="text/css" />
+	<base target="_self" />
+</head>
+<body onLoad="tinyMCEPopup.executeOnLoad('init();');" style="display: none">
+    <form onSubmit="insertYouTube();return false;" action="#">
+		<div class="tabs">
+			<ul>
+				<li id="general_tab" class="current"><span><a href="javascript:mcTabs.displayTab('general_tab','general_panel');" onMouseDown="return false;">{$lang_youtube_general}</a></span></li>
+			</ul>
+		</div>
+
+		<div class="panel_wrapper">
+			<div id="general_panel" class="panel current">
+				<fieldset>
+					<legend>{$lang_youtube_general}</legend>
+
+					<table border="0" cellpadding="4" cellspacing="0">
+							<tr>
+							<td nowrap="nowrap"><label for="file">{$lang_youtube_file}</label></td>
+							  <td nowrap="nowrap">
+									<table border="0" cellspacing="0" cellpadding="0">
+									  <tr>
+										<td><input id="file" name="file" type="text" value="" onFocus="this.select();" /></td>
+										<td id="filebrowsercontainer" style="visibility:hidden; display:none;" >&nbsp;</td>
+									  </tr>
+									</table>
+								</td>
+							</tr>
+							<tr id="linklistrow">
+								<td><label for="linklist">{$lang_youtube_list}</label></td>
+								<td id="linklistcontainer">&nbsp;</td>
+							</tr>
+							<tr>
+								<td nowrap="nowrap"><label>{$lang_youtube_size}</label></td>
+								<td nowrap="nowrap">
+									<input type="text" id="width" name="width" value="" onFocus="this.select();" />
+									<select name="width2" id="width2" style="width: 50px">
+										<option value="">px</option>
+										<option value="%">%</option>
+									</select>&nbsp;x&nbsp;<input id="height" name="height" type="text"  value="" onFocus="this.select();" />
+									<select name="height2" id="height2" style="width: 50px">
+										<option value="">px</option>
+										<option value="%">%</option>
+									</select>
+								</td>
+							</tr>
+					</table>
+				</fieldset>
+			</div>
+		</div>
+
+		<div class="mceActionPanel">
+			<div style="float: left">
+				<input type="button" id="insert" name="insert" value="{$lang_insert}" onClick="insertYouTube();" />
+			</div>
+
+			<div style="float: right">
+				<input type="button" id="cancel" name="cancel" value="{$lang_cancel}" onClick="tinyMCEPopup.close();" />
+			</div>
+		</div>
+	</form>
+</body>
+</html>



From pclaerhout at mail.berlios.de  Fri Feb 16 21:03:07 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Fri, 16 Feb 2007 21:03:07 +0100
Subject: [ydf-devel] r2404 - in
	YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube:
	. css images jscripts langs
Message-ID: <200702162003.l1GK373I005979@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-16 21:03:02 +0100 (Fri, 16 Feb 2007)
New Revision: 2404

Removed:
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/css/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/images/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/jscripts/_notes/
   YDFramework2.0/trunk/examples/weblog/tiny_mce/plugins/youtube/langs/_notes/
Log:
Removed some unneeded stuff.



From ximian at mail.berlios.de  Sat Feb 17 01:04:49 2007
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Sat, 17 Feb 2007 01:04:49 +0100
Subject: [ydf-devel] r2405 - in YDFramework2.0/trunk/YDFramework2/YDClasses:
	. YDFormElements
Message-ID: <200702170004.l1H04nWG012893@sheep.berlios.de>

Author: ximian
Date: 2007-02-17 01:04:48 +0100 (Sat, 17 Feb 2007)
New Revision: 2405

Added:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectNumeric.php
Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
added new form element 'selectnumeric' ( a numerical select box )

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-16 20:03:02 UTC (rev 2404)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-17 00:04:48 UTC (rev 2405)
@@ -143,6 +143,7 @@
             $this->registerElement( 'timezone', 'YDFormElement_Timezone', 'YDFormElement_Timezone.php' );
             $this->registerElement( 'fieldset', 'YDFormElement_Fieldset', 'YDFormElement_Fieldset.php' );
             $this->registerElement( 'hr', 'YDFormElement_HR', 'YDFormElement_HR.php' );
+            $this->registerElement( 'selectnumeric', 'YDFormElement_SelectNumeric', 'YDFormElement_SelectNumeric.php' );
 
             // Add the rules
             $this->registerRule( 'value', array( 'YDValidateRules', 'value' ), 'YDValidateRules.php' );

Added: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectNumeric.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectNumeric.php	2007-02-16 20:03:02 UTC (rev 2404)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_SelectNumeric.php	2007-02-17 00:04:48 UTC (rev 2405)
@@ -0,0 +1,77 @@
+<?php
+
+    /*
+
+        Yellow Duck Framework version 2.1
+        (c) Copyright 2002-2007 Pieter Claerhout
+
+        This library is free software; you can redistribute it and/or
+        modify it under the terms of the GNU Lesser General Public
+        License as published by the Free Software Foundation; either
+        version 2.1 of the License, or (at your option) any later version.
+
+        This library is distributed in the hope that it will be useful,
+        but WITHOUT ANY WARRANTY; without even the implied warranty of
+        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+        Lesser General Public License for more details.
+
+        You should have received a copy of the GNU Lesser General Public
+        License along with this library; if not, write to the Free Software
+        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
+
+    */
+
+    /**
+     *  @addtogroup YDForm Core - Form
+     */
+
+    // Check if the framework is loaded
+    if ( ! defined( 'YD_FW_NAME' ) ) {
+        die( 'Yellow Duck Framework is not loaded.' );
+    }
+
+    // Includes
+    include_once( YD_DIR_HOME_CLS . '/YDFormElements/YDFormElement_Select.php');
+
+    /**
+     *	This is the class that define a numerical select box form element.
+     *
+     *  @ingroup YDForm
+     */
+    class YDFormElement_SelectNumeric extends YDFormElement_Select {
+
+        /**
+         *	This is the class constructor for the YDFormElement_SelectNumeric class.
+         *
+         *	@param $form		The name of the form to which this element is connected.
+         *	@param $name		The name of the form element.
+         *	@param $label		(optional) The label for the form element.
+         *	@param $attributes	(optional) The attributes for the form element.
+         *	@param $options		(optional) Associative array with the values to show in the select box.
+         */
+        function YDFormElement_SelectNumeric( $form, $name, $label='', $attributes=array(), $options=array() ) {
+
+			// compute default values
+			$min = isset( $options[ 'min' ] ) ? $options[ 'min' ] : 1;
+			$max = isset( $options[ 'max' ] ) ? $options[ 'max' ] : 20;
+			$med = isset( $options[ 'med' ] ) ? $options[ 'med' ] : 5;
+			$interval = isset( $options[ 'interval' ] ) ? $options[ 'interval' ] : 2;
+
+			// compute real options array
+			$options = array();
+			for( ; $min < $med; $min ++ )
+				$options[ $min ] = $min;
+
+			for( ; $min <= $max; $min += $interval )
+				$options[ $min ] = $min;
+
+            // Initialize the parent
+            $this->YDFormElement_Select( $form, $name, $label, $attributes, $options );
+
+            // Set the type
+            $this->_type = 'selectnumeric';
+        }
+
+    }
+
+?>
\ No newline at end of file



From ximian at mail.berlios.de  Sat Feb 17 18:29:17 2007
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Sat, 17 Feb 2007 18:29:17 +0100
Subject: [ydf-devel] r2406 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702171729.l1HHTH1A007822@sheep.berlios.de>

Author: ximian
Date: 2007-02-17 18:29:16 +0100 (Sat, 17 Feb 2007)
New Revision: 2406

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
Log:
on ydform: fieldsets and horizontal rules are ignored on YDForm::getValues()

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-17 00:04:48 UTC (rev 2405)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDForm.php	2007-02-17 17:29:16 UTC (rev 2406)
@@ -705,7 +705,8 @@
         function getValues() {
             $vars = array();
             foreach ( $this->_elements as $name => $element ) {
-                if ( $element->getType() == 'span' ) {
+                $elType = $element->getType();
+                if ( $elType == 'span' || $elType == 'fieldset' || $elType == 'hr' ) {
                     continue;
                 }
                 $vars[ $name ] = $this->getValue( $name );



From pclaerhout at mail.berlios.de  Sun Feb 18 11:21:31 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Sun, 18 Feb 2007 11:21:31 +0100
Subject: [ydf-devel] r2407 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702181021.l1IALVx1001170@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-18 11:21:28 +0100 (Sun, 18 Feb 2007)
New Revision: 2407

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
The YDFSImage::outputThumbnail function now uses readfile to output data.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-17 17:29:16 UTC (rev 2406)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-18 10:21:28 UTC (rev 2407)
@@ -926,11 +926,8 @@
             header( 'Content-type: ' . $content_type );
 
             // Output the thumbnail
-            echo( $this->_createThumbnail( $width, $height, $cache, $crop ) );
+            die( $this->_createThumbnail( $width, $height, $cache, $crop ) );
 
-            // Stop the execution
-            die();
-
         }
 
         /**
@@ -1071,10 +1068,8 @@
                     header( 'Content-type: ' . $img->getMimeType() );
 
                     // Output the image
-                    $f = fopen( $cacheFName, 'rb' );
-                    $data = fread( $f, filesize( $cacheFName ) );
-                    fclose( $f );
-                    die( $data );
+                    readfile( $cacheFName );
+                    die();
 
                 }
 



From pclaerhout at mail.berlios.de  Mon Feb 19 16:18:13 2007
From: pclaerhout at mail.berlios.de (pclaerhout at mail.berlios.de)
Date: Mon, 19 Feb 2007 16:18:13 +0100
Subject: [ydf-devel] r2408 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702191518.l1JFIDkD016219@sheep.berlios.de>

Author: pclaerhout
Date: 2007-02-19 16:18:09 +0100 (Mon, 19 Feb 2007)
New Revision: 2408

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
Made some small improvements to YDFileSystem.

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-18 10:21:28 UTC (rev 2407)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-19 15:18:09 UTC (rev 2408)
@@ -432,15 +432,16 @@
             }
 
             // Check if we have an extension
-            if ( YDPath::getExtension( $path ) && strtolower( YDPath::getExtension( $path ) ) != 'tmn' ) {
-                if ( in_array( strtolower( YDPath::getExtension( $path ) ), array( 'jpg', 'png', 'gif', 'jpeg' ) ) ) {
-                    return strtolower( YDPath::getExtension( $path ) );
+            $extension = strtolower( YDPath::getExtension( $path ) );
+            if ( $extension && $extension != 'tmn' ) {
+                if ( in_array( $extension, array( 'jpg', 'png', 'gif', 'jpeg' ) ) ) {
+                    return $extension;
                 }
             }
 
             // No extension, read the file
             $fp = fopen( $path, 'rb' );
-            $header = fread( $fp, 32 );
+            $header = fread( $fp, 8 );
             fclose( $fp );
             if ( substr( $header, 0, 6 ) == 'GIF87a' || substr( $header, 0, 6 ) == 'GIF89a' ) {
                 return 'gif';
@@ -1060,17 +1061,8 @@
 
                 // Output the cached version if any
                 if ( is_file( $cacheFName ) ) {
-
-                    // Create a new image for the cache file
-                    $img = new YDFSImage( $cacheFName );
-
-                    // Set the content type
-                    header( 'Content-type: ' . $img->getMimeType() );
-
-                    // Output the image
                     readfile( $cacheFName );
                     die();
-
                 }
 
             }



From ximian at mail.berlios.de  Mon Feb 19 22:54:43 2007
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Mon, 19 Feb 2007 22:54:43 +0100
Subject: [ydf-devel] r2409 - YDFramework2.0/trunk/YDFramework2/YDClasses
Message-ID: <200702192154.l1JLshDL029200@sheep.berlios.de>

Author: ximian
Date: 2007-02-19 22:54:42 +0100 (Mon, 19 Feb 2007)
New Revision: 2409

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
Log:
new feature: on YDFSDirectory::getContents() and YDFSDirectory::getFilesRecursively(), 
             when retrieving the directory content, it's possible to define 2 new formats: 
                 * 'fullpath' to get array with full paths
                 * 'hash' return an associative array with basename as key and fillpath as value

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-19 15:18:09 UTC (rev 2408)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFileSystem.php	2007-02-19 21:54:42 UTC (rev 2409)
@@ -1371,7 +1371,9 @@
          *					match this pattern will not be included in the result.
          *	@param $class	(optional) If you specify a not null value for this option, this function will return the
          *					items in the directory as the indicated class. If an empty string is given, it will return
-         *					the list of filenames instead of objects.
+         *					the list of filenames instead of objects. If a string 'fullpath' is given, it will return
+         *					the list of filenames using the fullpath. If a string 'hash' is given, it will return a list 
+         *					of filenames as a associative array with filename basename has key and filename fullpath has value.
          *	@param $classes	(optional) An array with the classes to include. Standard, it includes YDFSImage, YDFSFile
          *					and YDFSDirectory classes. If you only need a single class, you can also specify it as a
          *					string.
@@ -1452,7 +1454,7 @@
             $fileList2 = array();
             foreach ( $fileList as $file ) {
                 $file = $this->getPath() . '/' . $file;
-                if ( ! is_null( $class ) && $class != '' ) {
+                if ( ! is_null( $class ) && $class != '' && $class != 'fullpath' && $class != 'hash' ) {
                     $fileObj = new $class( $file );
                 } else {
                     if ( is_dir( $file ) ) {
@@ -1497,14 +1499,20 @@
             }
 
             // Return a simple list if needed
-            if ( $class === '' ) {
+            if ( is_string( $class ) ) {
 
                 // Initialize a list for the files only
                 $fileOnlyList = array();
 
                 // Add the files
                 foreach ( $fileList2 as $file ) {
-                    array_push( $fileOnlyList, basename( $file->_path ) );
+                    $filename = $class === '' ? basename( $file->_path ) : realpath( $file->_path );
+
+                    if ( $class === 'hash' ){
+                        $fileOnlyList[ basename( $file->_path ) ] = $filename;
+                    }else{
+                        $fileOnlyList[] = $filename;
+                    }
                 }
 
                 // Return the fileOnlyList array
@@ -1525,7 +1533,9 @@
          *					match this pattern will not be included in the result.
          *	@param $class	(optional) If you specify a not null value for this option, this function will return the
          *					items in the directory as the indicated class. If an empty string is given, it will return
-         *					the list of filenames instead of objects.
+         *					the list of filenames instead of objects. If a string 'fullpath' is given, it will return
+         *					the list of filenames using the fullpath. If a string 'hash' is given, it will return a list 
+         *					of filenames as a associative array with filename basename has key and filename fullpath has value.
          *	@param $classes	(optional) An array with the classes to include. Standard, it includes YDFSImage and
          *					YDFSFile classes. If you only need a single class, you can also specify it as a string.
          *  @param $sort_by_date (optional) Sorts the items by date. Default is false.
@@ -1533,7 +1543,7 @@
          *
          *	@returns	Array of YDFile objects for the files that match the pattern.
          */
-        function getFilesRecursively( $pattern='', $class=null, $classes=array( 'YDFSFile', 'YDFSImage' ), $sort_by_date=false, $sort_order='asc'  ) {
+        function getFilesRecursively( $pattern='', $class=null, $classes=array( 'YDFSFile', 'YDFSImage' ), $sort_by_date=false, $sort_order='asc') {
             $files = array();
             foreach ( $this->_getSubdirectories( $this->_path ) as $dir ) {
                 $dir = new YDFSDirectory( $dir );



From ximian at mail.berlios.de  Tue Feb 20 21:27:23 2007
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Tue, 20 Feb 2007 21:27:23 +0100
Subject: [ydf-devel] r2410 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200702202027.l1KKRNru031271@sheep.berlios.de>

Author: ximian
Date: 2007-02-20 21:27:23 +0100 (Tue, 20 Feb 2007)
New Revision: 2410

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
Log:
- on radio form element: added a space between radio and label

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-02-19 21:54:42 UTC (rev 2409)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_Radio.php	2007-02-20 20:27:23 UTC (rev 2410)
@@ -95,11 +95,11 @@
                     if ( $this->_value == strval( $key ) ) {
                         $attribsElement['checked'] = 'checked';
                     }
-                    $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' /><label for="' . $attribsElement['id'] . '">' . $val . '</label>';
+                    $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribsElement ) . ' /> <label for="' . $attribsElement['id'] . '">' . $val . '</label>';
 
                 }
             } else {
-                $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' /><label for="' . $attribs['id'] . '">' . $this->_value . '</label>';
+                $out[] = '<input' . YDForm::_convertToHtmlAttrib( $attribs ) . ' /> <label for="' . $attribs['id'] . '">' . $this->_value . '</label>';
             }
 
             // Return the HTML



From ximian at mail.berlios.de  Wed Feb 28 00:07:13 2007
From: ximian at mail.berlios.de (ximian at BerliOS)
Date: Wed, 28 Feb 2007 00:07:13 +0100
Subject: [ydf-devel] r2411 -
	YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements
Message-ID: <200702272307.l1RN7Dtk020139@sheep.berlios.de>

Author: ximian
Date: 2007-02-28 00:07:13 +0100 (Wed, 28 Feb 2007)
New Revision: 2411

Modified:
   YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
Log:
on checkboxgroup: 
  *feature: it's possible to setValue using a integer. Is checks the correspondent key

Modified: YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php
===================================================================
--- YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-02-20 20:27:23 UTC (rev 2410)
+++ YDFramework2.0/trunk/YDFramework2/YDClasses/YDFormElements/YDFormElement_CheckboxGroup.php	2007-02-27 23:07:13 UTC (rev 2411)
@@ -120,11 +120,17 @@
         /**
          *	This function sets the value for the element.
          *
-         *	@param	$val	(optional) The value for this object.
+         *	@param	$val	(optional) The value for this object as array or a key integer for selection.
          */
         function setValue( $val=array() ) {
-            foreach ( $val as $k=>$v ) {
-                $this->_items[$k]->setValue( $v );
+
+            // check if is numeric
+            if ( is_integer( $val ) ){
+                $this->_items[ intval( $val ) ]->setValue( 1 );
+            }else{
+                foreach ( $val as $k=>$v ) {
+                    $this->_items[$k]->setValue( $v );
+                }
             }
         }
 



